{
    "version": "https://jsonfeed.org/version/1",
    "title": "Or0kit • All posts by \"listctrl\" tag",
    "description": "临渊羡鱼，不如退而结网",
    "home_page_url": "https://Or0kit.github.io",
    "items": [
        {
            "id": "https://or0kit.github.io/Programming/MFC/MFC-06ListCtrl%E9%AB%98%E7%BA%A7%E5%88%97%E8%A1%A8%E6%8E%A7%E4%BB%B6/",
            "url": "https://or0kit.github.io/Programming/MFC/MFC-06ListCtrl%E9%AB%98%E7%BA%A7%E5%88%97%E8%A1%A8%E6%8E%A7%E4%BB%B6/",
            "title": "MFC-06ListCtrl高级列表控件",
            "date_published": "2022-03-22T06:44:32.000Z",
            "content_html": "<h1 id=\"listctrl高级列表控件\"><a class=\"anchor\" href=\"#listctrl高级列表控件\">#</a> ListCtrl 高级列表控件</h1>\n<p>ListCtrl 高级列表控件也是我们平时编程过程中很常用的一个控件，一般涉及到报表展示、记录展示之类的，都需要 ListCtrl 高级列表控件。例如：任务管理器啊，文件列表啊，等等都是 ListCtrl 高级列表控件来实现的。</p>\n<h2 id=\"控件的风格样式\"><a class=\"anchor\" href=\"#控件的风格样式\">#</a> 控件的风格样式</h2>\n<p>LVS_ICON: 为每个 item 显示大图标<br />\n LVS_SMALLICON: 为每个 item 显示小图标<br />\n LVS_LIST: 显示一列带有小图标的 item<br />\nLVS_REPORT: 显示 item 详细资料</p>\n<p>直观的理解：Windows 资源管理器，“查看” 标签下的 “大图标，小图标，列表，详细资料”</p>\n<p><img data-src=\"image001.png\" alt=\"\" /><br />\n<img data-src=\"image002.png\" alt=\"\" /><br />\n<img data-src=\"image003.png\" alt=\"\" /><br />\n<img data-src=\"image004.png\" alt=\"\" /></p>\n<p>具体可以通过代码指定控件的风格样式：</p>\n<p>先创建一个  <code>CListCtrl</code>  类型的变量  <code>m_ListCtrl</code></p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>LONG lStyle<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>lStyle<span class=\"token operator\">=</span><span class=\"token function\">GetWindowLong</span><span class=\"token punctuation\">(</span>m_ListCtrl<span class=\"token punctuation\">.</span>m_hWnd<span class=\"token punctuation\">,</span> GWL_STYLE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 获取当前窗口 style</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>lStyle <span class=\"token operator\">&amp;=</span> <span class=\"token operator\">~</span>LVS_TYPEMASK<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 清除显示方式位</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>lStyle <span class=\"token operator\">|=</span> LVS_REPORT<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 设置 style</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">SetWindowLong</span><span class=\"token punctuation\">(</span>m_ListCtrl<span class=\"token punctuation\">.</span>m_hWnd<span class=\"token punctuation\">,</span> GWL_STYLE<span class=\"token punctuation\">,</span> lStyle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 设置 style</span></pre></td></tr></table></figure><p>也可以方便点，从控件的属性中直接修改：<br />\n对应控件的 View 属性：Icon、Small Icon、List、Report 四项。</p>\n<p><img data-src=\"image005.png\" alt=\"\" /></p>\n<p>我们主要学习 LVS_REPORT 格式，也就是报表样式。</p>\n<h2 id=\"扩展样式设置\"><a class=\"anchor\" href=\"#扩展样式设置\">#</a> 扩展样式设置</h2>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>DWORD dwStyle <span class=\"token operator\">=</span> m_ListCtrl<span class=\"token punctuation\">.</span><span class=\"token function\">GetExtendedStyle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 获取当前扩展样式</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>dwStyle <span class=\"token operator\">|=</span> LVS_EX_FULLROWSELECT<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 选中某行使整行高亮（report 风格时）</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>dwStyle <span class=\"token operator\">|=</span> LVS_EX_GRIDLINES<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 网格线（report 风格时）</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>dwStyle <span class=\"token operator\">|=</span> LVS_EX_CHECKBOXES<span class=\"token punctuation\">;</span> <span class=\"token comment\">//item 前生成 checkbox 控件</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>m_ListCtrl<span class=\"token punctuation\">.</span><span class=\"token function\">SetExtendedStyle</span><span class=\"token punctuation\">(</span>dwStyle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 设置扩展风格</span></pre></td></tr></table></figure><h2 id=\"数据插入\"><a class=\"anchor\" href=\"#数据插入\">#</a> 数据插入</h2>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 插入数据</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>m_ListCtrl<span class=\"token punctuation\">.</span><span class=\"token function\">InsertColumn</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ID\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> LVCFMT_LEFT<span class=\"token punctuation\">,</span> <span class=\"token number\">150</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 插入列</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>m_ListCtrl<span class=\"token punctuation\">.</span><span class=\"token function\">InsertColumn</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"名称\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> LVCFMT_LEFT<span class=\"token punctuation\">,</span> <span class=\"token number\">150</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// 直接插入</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">int</span> nRow <span class=\"token operator\">=</span> m_ListCtrl<span class=\"token punctuation\">.</span><span class=\"token function\">InsertItem</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"0\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 插入行</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>m_ListCtrl<span class=\"token punctuation\">.</span><span class=\"token function\">SetItemText</span><span class=\"token punctuation\">(</span>nRow<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"C++\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 设置数据</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">//LVITEM 结构插入</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>LVITEM item <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>item<span class=\"token punctuation\">.</span>iItem <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 行号</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>item<span class=\"token punctuation\">.</span>mask <span class=\"token operator\">=</span> LVIF_TEXT<span class=\"token punctuation\">;</span> <span class=\"token comment\">/*LVIF_IMAGE 支持图标 */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>item<span class=\"token punctuation\">.</span>cchTextMax <span class=\"token operator\">=</span> <span class=\"token number\">15</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 插入字符串长度</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>item<span class=\"token punctuation\">.</span>pszText <span class=\"token operator\">=</span> <span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>nRow <span class=\"token operator\">=</span> m_ListCtrl<span class=\"token punctuation\">.</span><span class=\"token function\">InsertItem</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>m_ListCtrl<span class=\"token punctuation\">.</span><span class=\"token function\">SetItemText</span><span class=\"token punctuation\">(</span>nRow<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MFC\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"选中和取消选中item\"><a class=\"anchor\" href=\"#选中和取消选中item\">#</a> 选中和取消选中 Item</h2>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">int</span> nIndex <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// 选中</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>m_ListCtrl<span class=\"token punctuation\">.</span><span class=\"token function\">SetItemState</span><span class=\"token punctuation\">(</span>nIndex<span class=\"token punctuation\">,</span>LVIS_SELECTED<span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>LVIS_FOCUSED<span class=\"token punctuation\">,</span>LVIS_SELECTED<span class=\"token operator\">|</span>LVIS_FOCUSED<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// 取消选中</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>m_ListCtrl<span class=\"token punctuation\">.</span><span class=\"token function\">SetItemState</span><span class=\"token punctuation\">(</span>nIndex<span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>LVIS_SELECTED<span class=\"token operator\">|</span>LVIS_FOCUSED<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>一直选中 Item: 选中  <code>style</code>  中的  <code>Show selection always</code> , 或者添加扩展样式  <code>LVS_SHOWSELALWAYS</code></p>\n<h2 id=\"得到clistctrl中所有行的checkbox的状态\"><a class=\"anchor\" href=\"#得到clistctrl中所有行的checkbox的状态\">#</a> 得到 CListCtrl 中所有行的 checkbox 的状态</h2>\n<p>要开启  <code>LVS_EX_CHECKBOXES</code>  样式。</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>CString str<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span>m_ListCtrl<span class=\"token punctuation\">.</span><span class=\"token function\">GetItemCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>m_ListCtrl<span class=\"token punctuation\">.</span><span class=\"token function\">GetItemState</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> LVIS_SELECTED<span class=\"token punctuation\">)</span><span class=\"token operator\">==</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  LVIS_SELECTED <span class=\"token operator\">||</span> m_ListCtrl<span class=\"token punctuation\">.</span><span class=\"token function\">GetCheck</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    str<span class=\"token punctuation\">.</span><span class=\"token function\">Format</span><span class=\"token punctuation\">(</span><span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"第%d行的checkbox为选中状态\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token function\">AfxMessageBox</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"得到clistctrl中所有选中行的序号\"><a class=\"anchor\" href=\"#得到clistctrl中所有选中行的序号\">#</a> 得到 CListCtrl 中所有选中行的序号</h2>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 方法一：</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>CString str<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span>m_ListCtrl<span class=\"token punctuation\">.</span><span class=\"token function\">GetItemCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>m_ListCtrl<span class=\"token punctuation\">.</span><span class=\"token function\">GetItemState</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> LVIS_SELECTED<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> LVIS_SELECTED <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    str<span class=\"token punctuation\">.</span><span class=\"token function\">Format</span><span class=\"token punctuation\">(</span><span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"选中了第%d行\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token function\">AfxMessageBox</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// 方法二：</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>POSITION pos<span class=\"token operator\">=</span>m_ListCtrl<span class=\"token punctuation\">.</span><span class=\"token function\">GetFirstSelectedItemPosition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>pos<span class=\"token operator\">==</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token function\">TRACE0</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"No items were selected!/n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>pos<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">int</span> nItem<span class=\"token operator\">=</span>m_ListCtrl<span class=\"token punctuation\">.</span><span class=\"token function\">GetNextSelectedItem</span><span class=\"token punctuation\">(</span>pos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token function\">TRACE1</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Item %d was selected!/n\"</span><span class=\"token punctuation\">,</span> nItem<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token comment\">// 添加其他操作</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"得到单击的clistctrl的行列号\"><a class=\"anchor\" href=\"#得到单击的clistctrl的行列号\">#</a> 得到单击的 CListCtrl 的行列号</h2>\n<p>添加 listctrl 控件的  <code>NM_CLICK</code>  消息相应函数</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token class-name\">CMFCCStringDlg</span><span class=\"token operator\">::</span><span class=\"token function\">OnNMClickList1</span><span class=\"token punctuation\">(</span>NMHDR<span class=\"token operator\">*</span> pNMHDR<span class=\"token punctuation\">,</span> LRESULT<span class=\"token operator\">*</span> pResult<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tLPNMITEMACTIVATE pNMItemActivate <span class=\"token operator\">=</span> <span class=\"token keyword\">reinterpret_cast</span><span class=\"token operator\">&lt;</span>LPNMITEMACTIVATE<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>pNMHDR<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token comment\">// TODO: 在此添加控件通知处理程序代码</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token comment\">//// 方法一:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token comment\">//DWORD dwPos = GetMessagePos();</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token comment\">//CPoint point(LOWORD(dwPos), HIWORD(dwPos));</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token comment\">//m_ListCtrl.ScreenToClient(&amp;point);</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token comment\">//LVHITTESTINFO lvinfo;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token comment\">//lvinfo.pt = point;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token comment\">//lvinfo.flags = LVHT_ABOVE;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token comment\">//int nItem = m_ListCtrl.SubItemHitTest(&amp;lvinfo);</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token comment\">//if (nItem != -1)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token comment\">//&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t<span class=\"token comment\">//\tCString strtemp;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t<span class=\"token comment\">//\tstrtemp.Format (_T (\"单击的是第 % d 行第 % d 列\"), lvinfo.iItem, lvinfo.iSubItem);</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t<span class=\"token comment\">//\tAfxMessageBox(strtemp);</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t<span class=\"token comment\">//&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t<span class=\"token comment\">// 方法二:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\tNM_LISTVIEW<span class=\"token operator\">*</span> pNMListView <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>NM_LISTVIEW<span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>pNMHDR<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pNMListView<span class=\"token operator\">-></span>iItem <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\tCString strtemp<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\tstrtemp<span class=\"token punctuation\">.</span><span class=\"token function\">Format</span><span class=\"token punctuation\">(</span><span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"单击的是第%d行第%d列\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> pNMListView<span class=\"token operator\">-></span>iItem<span class=\"token punctuation\">,</span> pNMListView<span class=\"token operator\">-></span>iSubItem<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t<span class=\"token function\">AfxMessageBox</span><span class=\"token punctuation\">(</span>strtemp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t<span class=\"token operator\">*</span>pResult <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"image009.png\" alt=\"\" /></p>\n<h2 id=\"右键点击clistctrl的item弹出菜单\"><a class=\"anchor\" href=\"#右键点击clistctrl的item弹出菜单\">#</a> 右键点击 CListCtrl 的 item 弹出菜单</h2>\n<p>添加一个菜单资源</p>\n<p><img data-src=\"image011.png\" alt=\"\" /></p>\n<p>对菜单进行编辑：</p>\n<p><img data-src=\"image012.png\" alt=\"\" /></p>\n<p>添加 CListCtrl 控件的 NM_RCLICK 消息相应函数。</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token class-name\">CMFCCStringDlg</span><span class=\"token operator\">::</span><span class=\"token function\">OnNMRClickList1</span><span class=\"token punctuation\">(</span>NMHDR<span class=\"token operator\">*</span> pNMHDR<span class=\"token punctuation\">,</span> LRESULT<span class=\"token operator\">*</span> pResult<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tLPNMITEMACTIVATE pNMItemActivate <span class=\"token operator\">=</span> <span class=\"token keyword\">reinterpret_cast</span><span class=\"token operator\">&lt;</span>LPNMITEMACTIVATE<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>pNMHDR<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token comment\">// TODO: 在此添加控件通知处理程序代码</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tNM_LISTVIEW<span class=\"token operator\">*</span> pNMListView <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>NM_LISTVIEW<span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>pNMHDR<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pNMListView<span class=\"token operator\">-></span>iItem <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\tDWORD dwPos <span class=\"token operator\">=</span> <span class=\"token function\">GetMessagePos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\tCPoint <span class=\"token function\">point</span><span class=\"token punctuation\">(</span><span class=\"token function\">LOWORD</span><span class=\"token punctuation\">(</span>dwPos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">HIWORD</span><span class=\"token punctuation\">(</span>dwPos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\tCMenu menu<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t<span class=\"token function\">VERIFY</span><span class=\"token punctuation\">(</span>menu<span class=\"token punctuation\">.</span><span class=\"token function\">LoadMenu</span><span class=\"token punctuation\">(</span>IDR_MENU1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\tCMenu<span class=\"token operator\">*</span> popup <span class=\"token operator\">=</span> menu<span class=\"token punctuation\">.</span><span class=\"token function\">GetSubMenu</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t<span class=\"token function\">ASSERT</span><span class=\"token punctuation\">(</span>popup <span class=\"token operator\">!=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\tpopup<span class=\"token operator\">-></span><span class=\"token function\">TrackPopupMenu</span><span class=\"token punctuation\">(</span>TPM_LEFTALIGN <span class=\"token operator\">|</span> TPM_RIGHTBUTTON<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\tpoint<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> point<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t<span class=\"token operator\">*</span>pResult <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"image013.png\" alt=\"\" /></p>\n<h3 id=\"添加右键响应函数\"><a class=\"anchor\" href=\"#添加右键响应函数\">#</a> 添加右键响应函数</h3>\n<p>为菜单添加消息事件处理函数：</p>\n<p><img data-src=\"image014.png\" alt=\"\" /></p>\n<p><img data-src=\"image015.png\" alt=\"\" /></p>\n<p><img data-src=\"image016.png\" alt=\"\" /></p>\n<h1 id=\"结尾\"><a class=\"anchor\" href=\"#结尾\">#</a> 结尾</h1>\n<p>ListControl 还有很多功能，等用到了再学了。</p>\n<h1 id=\"reference\"><a class=\"anchor\" href=\"#reference\">#</a> Reference</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xzaF8yMDEzL2FydGljbGUvZGV0YWlscy80NDYyNDIzOQ==\">https://blog.csdn.net/lsh_2013/article/details/44624239</span><br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDk4MjYxL2FydGljbGUvZGV0YWlscy8xMDg3MTkyMjg=\">https://blog.csdn.net/qq_41498261/article/details/108719228</span></p>\n",
            "tags": [
                "ListCtrl"
            ]
        }
    ]
}