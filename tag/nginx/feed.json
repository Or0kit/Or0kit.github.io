{
    "version": "https://jsonfeed.org/version/1",
    "title": "Or0kit • All posts by \"nginx\" tag",
    "description": "临渊羡鱼，不如退而结网",
    "home_page_url": "https://Or0kit.github.io",
    "items": [
        {
            "id": "https://or0kit.github.io/Linux/Linux%E9%85%8D%E7%BD%AENginx%E6%9C%8D%E5%8A%A1/",
            "url": "https://or0kit.github.io/Linux/Linux%E9%85%8D%E7%BD%AENginx%E6%9C%8D%E5%8A%A1/",
            "title": "Linux配置Nginx服务",
            "date_published": "2021-05-10T11:21:34.000Z",
            "content_html": "<h1 id=\"前言\"><a class=\"anchor\" href=\"#前言\">#</a> 前言</h1>\n<p>Linux 作业： 1. 配置能加载静态文件和图片  2.Nginx 能加载 php 文件</p>\n<h1 id=\"nginx简介\"><a class=\"anchor\" href=\"#nginx简介\">#</a> Nginx 简介</h1>\n<p>Nginx (engine x) 是一个高性能的 HTTP 和反向代理 web 服务器，同时也提供了 IMAP/POP3/SMTP 服务。Nginx 是由伊戈尔・赛索耶夫为俄罗斯访问量第二的 Rambler.ru 站点（俄文：Рамблер）开发的，第一个公开版本 0.1.0 发布于 2004 年 10 月 4 日。<br />\n其将源代码以类 BSD 许可证的形式发布，因它的稳定性、丰富的功能集、示例配置文件和低系统资源的消耗而闻名。2011 年 6 月 1 日，nginx 1.0.4 发布。<br />\nNginx 是一款轻量级的 Web 服务器 / 反向代理服务器及电子邮件（IMAP/POP3）代理服务器，在 BSD-like 协议下发行。其特点是占有内存少，并发能力强，事实上 nginx 的并发能力在同类型的网页服务器中表现较好，中国大陆使用 nginx 网站用户有：百度、京东、新浪、网易、腾讯、淘宝等</p>\n<h1 id=\"安装nginx\"><a class=\"anchor\" href=\"#安装nginx\">#</a> 安装 Nginx</h1>\n<p>因为上次作业是配置 LAMP 环境，所以先卸载一下 Apache 和 PHP。</p>\n<p><code>yum erase php* httpd*</code></p>\n<p>直接安装</p>\n<p><code>yum -y install nginx</code></p>\n<p>===========================================<br />\n 或者自己安装：</p>\n<p>pcre、pcre-devel 安装<br />\n pcre（Perl Compatible Regular Expressions）是一个 perl 库，包括 perl 兼容的正则表达式库。nginx 的 http 模块使用 pcre 来解析正则表达式，所以需要安装 pcre 库，pcre-devel 是使用 pcre 开发的一个二次开发库。nginx 也需要此库。执行以下命令进行安装：</p>\n<p><code>yum install -y pcre pcre-devel</code></p>\n<p>zlib 安装<br />\n zlib 库提供了很多种压缩和解压缩方式，nginx 使用 zlib 对 http 包的内容进行 gzip，所以需要在 centos 7 上安装 zlib 库。执行以下命令进行安装操作：</p>\n<p><code>yum install -y zlib zlib-devel</code></p>\n<p>openssl 安装</p>\n<p><code>yum install -y openssl openssl-devel</code></p>\n<p>从 http://nginx.org/download/ 上下载相应的版本</p>\n<p><code>wget http://nginx.org/download/nginx-1.20.0.tar.gz</code></p>\n<p>解压 <code>tar -zxvf nginx-1.20.0.tar.gz</code></p>\n<p>解压后移至目录 <code>cd nginx-1.20.0</code></p>\n<p>设置 Nginx 安装路径，如果没有指定，默认为 /usr/local/nginx<br />\n <code>[root@localhost nginx-1.5.9]# ./configure --prefix=/usr/local/nginx</code></p>\n<p>然后 make (make 的过程是把各种语言写的源码文件，变成可执行文件和各种库文件)<br />\n <code>make</code></p>\n<p>make install（make install 是把这些编译出来的可执行文件和库文件复制到合适的地方）<br />\n <code>make install</code></p>\n<p>启动命令一般在 /usr/local/nginx/sbin/ 目录下的 nginx</p>\n<p>可以先切换到 /usr/local/nginx/sbin/ 目录下，然后执行 ./nginx 也可启动</p>\n<h1 id=\"配置能回显图片\"><a class=\"anchor\" href=\"#配置能回显图片\">#</a> 配置能回显图片</h1>\n<p>在 nginx.conf 中这样配置</p>\n<pre><code class=\"language-conf\">server &#123;  \n    listen    80;#端口号  \n    server_name localhost;#本机  \n   \n    charset utf-8;  \n   \n    #access_log logs/host.access.log main;  \n   \n  location ~ .*\\.(gif|jpg|jpeg|png)$ &#123;  \n    expires 24h;  \n      root /home/images/;#指定图片存放路径  \n      access_log /usr/local/nginx/logs/images.log;#日志存放路径  \n      proxy_store on;  \n      proxy_store_access user:rw group:rw all:rw;  \n      proxy_temp_path     /home/images/;#图片访问路径  \n      proxy_redirect     off;  \n      proxy_set_header    Host 127.0.0.1;  \n      client_max_body_size  10m;  \n      client_body_buffer_size 1280k;  \n      proxy_connect_timeout  900;  \n      proxy_send_timeout   900;  \n      proxy_read_timeout   900;  \n      proxy_buffer_size    40k;  \n      proxy_buffers      40 320k;  \n      proxy_busy_buffers_size 640k;  \n      proxy_temp_file_write_size 640k;  \n      if ( !-e $request_filename)  \n      &#123;  \n         proxy_pass http://127.0.0.1;#默认80端口  \n      &#125;  \n  &#125;   \n   \n    location / &#123;  \n      root  /home/html; #html访问路径 \n      index index.html index2.htm; #html文件名称 \n  \n    &#125; \n</code></pre>\n<p>重启 Nginx，即可。</p>\n<h1 id=\"安装php-fpm\"><a class=\"anchor\" href=\"#安装php-fpm\">#</a> 安装 PHP-fpm</h1>\n<p>PHP<br />\n 使用 yum 方式安装 PHP 时，不能安装 php7, 只能安装 php5，我们安装 php5, 新版本和旧版本的区别不是很大，没有必要纠结。</p>\n<p>下载 php 相关的软件，php-fpm 是我们管理 php 的软件<br />\n <code>yum install -y php php-fpm php-curl php-gd* php-mysql</code></p>\n<h1 id=\"联合配置-nginx-php\"><a class=\"anchor\" href=\"#联合配置-nginx-php\">#</a> 联合配置 nginx + php</h1>\n<p>在前面我们分别安装好了 nginx 和 php，现在将 nginx 和 php 联合配置起来。</p>\n<p>将 nginx 和 php 设置为开机自启动。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl <span class=\"token builtin class-name\">enable</span> nginx.service</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>systemctl <span class=\"token builtin class-name\">enable</span> php-fpm.service</pre></td></tr></table></figure><p>更改 Nginx 的配置文件 nginx.conf, 使其能解析 php</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>location ~ <span class=\"token punctuation\">\\</span>.php$ <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>            <span class=\"token comment\"># 设置监听端口</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>            fastcgi_pass   <span class=\"token number\">127.0</span>.0.1:9000<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token comment\"># 设置脚本文件请求的路径</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            fastcgi_param  SCRIPT_FILENAME  <span class=\"token variable\">$document_root</span><span class=\"token variable\">$fastcgi_script_name</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token comment\"># 引入 fastcgi 的配置文件</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            include        fastcgi_params<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>不过这里我遇到了一个小问题：“找不到 PHP 文件”。</p>\n<p>解决方法  参考自<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5zaHVjaGVuZ3hpYW4uY29tL2FydGljbGUvNjU3Lmh0bWw=\"> http://www.shuchengxian.com/article/657.html</span><br />\n 先 nginx 网站配置文件 *.conf 中的修改下</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>fastcgi_param  SCRIPT_FILENAME  /scripts<span class=\"token variable\">$fastcgi_script_name</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>修改为</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>fastcgi_param  SCRIPT_FILENAME  <span class=\"token variable\">$document_root</span><span class=\"token variable\">$fastcgi_script_name</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>重启 nginx 服务器。</p>\n<p>大致流程就是这样了。</p>\n",
            "tags": [
                "Nginx"
            ]
        }
    ]
}