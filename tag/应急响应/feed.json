{
    "version": "https://jsonfeed.org/version/1",
    "title": "Or0kit • All posts by \"应急响应\" tag",
    "description": "临渊羡鱼，不如退而结网",
    "home_page_url": "https://Or0kit.github.io",
    "items": [
        {
            "id": "https://or0kit.github.io/PenetrationTest/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%80%9D%E8%B7%AF%E5%92%8C%E6%93%8D%E4%BD%9C/",
            "url": "https://or0kit.github.io/PenetrationTest/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%80%9D%E8%B7%AF%E5%92%8C%E6%93%8D%E4%BD%9C/",
            "title": "应急响应思路和操作",
            "date_published": "2022-05-18T07:39:54.000Z",
            "content_html": "<p><img data-src=\"%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94.png\" alt=\"应急响应\" /></p>\n<h1 id=\"思路\"><a class=\"anchor\" href=\"#思路\">#</a> 思路</h1>\n<h2 id=\"应急响应定义\"><a class=\"anchor\" href=\"#应急响应定义\">#</a> 应急响应定义</h2>\n<p>应急响应定义：组织为了应对突发 / 重大信息安全事件的发生所做的准备，以及在事件发生后所采取的措施。</p>\n<p>应急响应目标：采取紧急措施和行动，恢复业务到正常状态；调查安全事件发生的原因，避免同类事件再次发生；在需要司法机关介入时，提供法律认可的数字证据。</p>\n<h2 id=\"应急响应阶段\"><a class=\"anchor\" href=\"#应急响应阶段\">#</a> 应急响应阶段</h2>\n<p>从<strong>业务流程方式</strong>可以分为六个阶段：</p>\n<ol>\n<li><strong>准备</strong>：让我们严正以待，即在事件未发生时的准备工作，包括策略、计划、规范文档及具体的技术工具和平台，未雨绸膜</li>\n<li><strong>评估</strong>：对情况综合评估，初步判断是什么类型的问题，受影响的系统及严重程度</li>\n<li><strong>遏制</strong>：制止事态的扩大，限制攻击、破坏所波及的范围</li>\n<li><strong>根除</strong>：对事件发生的原因进行分析，彻底解决问题，避免再次在同一个问题上犯错</li>\n<li><strong>恢复</strong>：系统恢复常态</li>\n<li><strong>跟踪</strong>：针对事件的整改措施进行落实并监控是否有无异常，换句话叫安全运营中的持续改进，时刻保持危机感。</li>\n</ol>\n<h2 id=\"应急响应思路流程\"><a class=\"anchor\" href=\"#应急响应思路流程\">#</a> 应急响应思路流程</h2>\n<h3 id=\"收集信息\"><a class=\"anchor\" href=\"#收集信息\">#</a> 收集信息</h3>\n<p>在赶往出事地点的路上以及还没有接触到具体业务时，要提前向客户询问清楚事件情况，如发现时间以及大致发生时间、事件造成的破坏、受害主机情况 (如系统、版本、内外网)、客户的具体处置要求</p>\n<h3 id=\"事件预定性\"><a class=\"anchor\" href=\"#事件预定性\">#</a> 事件预定性</h3>\n<p>在初步了解情况后先做一个<strong>事件性质预判</strong>，判断下这个事件是个什么事件，是勒索还是挖矿还是其他事件。然后根据事件发生时间划定一个<strong>时间范围</strong>，重点排查这个时间段内的情况，从影响范围中确认一个<strong>排查范围</strong>。</p>\n<p><img data-src=\"2.png\" alt=\"2\" /></p>\n<h3 id=\"取证分析\"><a class=\"anchor\" href=\"#取证分析\">#</a> 取证分析</h3>\n<p>通过事件的初步定性取证，并且有选择的优先分析重点内容。</p>\n<p><img data-src=\"3.png\" alt=\"3\" /></p>\n<h3 id=\"取证注意事项\"><a class=\"anchor\" href=\"#取证注意事项\">#</a> 取证注意事项</h3>\n<p><strong>保护</strong></p>\n<blockquote>\n<p>保证数据的安全性：制作磁盘映像 —— 不在原始磁盘上操作<br />\n保证数据完整性：取证中不使用可能破坏完整性的操作<br />\n第三方监督：所有操作都有第三方在场监督</p>\n</blockquote>\n<p><strong>提取</strong></p>\n<blockquote>\n<p>优先提取易消失的证据：内存信息、系统进程、网络连接信息、路由信息、临时文件、缓存等<br />\n文件系统：数据恢复、隐藏文件、加密文件、回收站、注册表、系统日志等<br />\n应用系统：系统日志、中间件日志</p>\n</blockquote>\n<p><strong>分析</strong></p>\n<blockquote>\n<p>证据在什么地方：日志、删除的文件、临时文件、缓存<br />\n从证据中能发现什么？如何关联证据？</p>\n</blockquote>\n<h3 id=\"定向分析\"><a class=\"anchor\" href=\"#定向分析\">#</a> 定向分析</h3>\n<p>二次定性后，我们基本已经真正掌握了事件情况，这时就可以进行各种分析，对各种情况利用各种工具快速</p>\n<p><img data-src=\"4.png\" alt=\"4\" /></p>\n<p><img data-src=\"5.png\" alt=\"5\" /></p>\n<p><img data-src=\"6.png\" alt=\"6\" /></p>\n<p><img data-src=\"7.png\" alt=\"7\" /></p>\n<p><img data-src=\"8.png\" alt=\"8\" /></p>\n<p><img data-src=\"9.png\" alt=\"9\" /></p>\n<h1 id=\"实施思路\"><a class=\"anchor\" href=\"#实施思路\">#</a> 实施思路</h1>\n<p>大致可以分为五个部分：</p>\n<p><img data-src=\"%E5%A4%84%E7%BD%AE%E6%AD%A5%E9%AA%A4.png\" alt=\"处置步骤\" /></p>\n<ol>\n<li>\n<p>收集信息：收集客户信息和受害主机信息，如有病毒样本也收集</p>\n</li>\n<li>\n<p>判断类型：判断是否是安全事件，何种安全事件，勒索、挖矿、断网、DoS 等等。</p>\n</li>\n<li>\n<p>深入分析：日志分析、进程分析、启动项分析、样本分析。</p>\n</li>\n<li>\n<p>清理处置：直接杀掉进程，删除文件，打补丁，抑或是修复文件。</p>\n</li>\n<li>\n<p>产出报告：整理并输出完整的安全事件报告。</p>\n</li>\n</ol>\n<h2 id=\"收集信息-2\"><a class=\"anchor\" href=\"#收集信息-2\">#</a> 收集信息</h2>\n<h3 id=\"受害情况\"><a class=\"anchor\" href=\"#受害情况\">#</a> 受害情况</h3>\n<h4 id=\"客户主机情况\"><a class=\"anchor\" href=\"#客户主机情况\">#</a> 客户主机情况</h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">客户名称</th>\n<th style=\"text-align:left\">什么区域的什么客户</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">感染主机数</td>\n<td style=\"text-align:left\">感染了多数台主机</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">补丁情况</td>\n<td style=\"text-align:left\">打了哪些补丁，是否存在补丁漏打</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">中毒现象</td>\n<td style=\"text-align:left\">勒索 / 挖矿 / DoS / 僵尸网络 / 后门 / 木马</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">帐号密码</td>\n<td style=\"text-align:left\">确认是否有弱密码</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">对外开发端口</td>\n<td style=\"text-align:left\">对外开发了哪些端口</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">开启的服务</td>\n<td style=\"text-align:left\">开启了哪些服务</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">操作系统版本</td>\n<td style=\"text-align:left\">操作系统版本信息</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">客户需求</td>\n<td style=\"text-align:left\">确认客户具体需求</td>\n</tr>\n</tbody>\n</table>\n<hr />\n<p><img data-src=\"1.png\" alt=\"1\" /></p>\n<h2 id=\"取证\"><a class=\"anchor\" href=\"#取证\">#</a> 取证</h2>\n<p>取证并非毫无头绪的，病毒本身必然有网络行为，内存必然有其二进制代码，它要么是单独的进程模块，要么是进程的 dll/so 模块，通常，为了保活，它极可能还有自己的启动项、网络心跳包。</p>\n<p>可以归结为如下 4 点要素：<strong>流量、内存、模块、启动项。</strong></p>\n<p>流量分析可以使用 Wireshark，主要分析下当前主机访问了哪些域名、URL、服务，或者有哪些外网 IP 在访问本地主机的哪些端口、服务和目录，又使用了何种协议等等。</p>\n<h3 id=\"可疑域名\"><a class=\"anchor\" href=\"#可疑域名\">#</a> 可疑域名</h3>\n<p>如 asd333.2111.pw 这样的域名很明显是一个动态域名，极大可能就是一个恶意域名，有可能是 C2 服务器，</p>\n<h3 id=\"网络协议分析\"><a class=\"anchor\" href=\"#网络协议分析\">#</a> 网络协议分析</h3>\n<p>IRC 协议在日常中很少使用，但常被用来建立僵尸网络，所以可以过滤筛选 IRC</p>\n<h3 id=\"外连\"><a class=\"anchor\" href=\"#外连\">#</a> 外连</h3>\n<p>外连可以使用 TcpView 或者命令行下 netstat 命令排查</p>\n<p><img data-src=\"10.png\" alt=\"10\" /></p>\n<p>重点关注如下的外连和状态为 ESTABLISHED 的连接</p>\n<pre><code>chenyu-57068a53.localdomain.2674-&gt; amsterdam.nl.eu.undernet.org.6667\nTCP    127.0.0.1:8588         127.0.0.1:49856        ESTABLISHED     5004\n</code></pre>\n<h1 id=\"实施具体操作\"><a class=\"anchor\" href=\"#实施具体操作\">#</a> 实施具体操作</h1>\n<p>在简单做完定向分析并取证后，如果客户直接把系统重置了就不需要下一步了，如果客户要求从头到尾把系统排查一下那么就利用工具和手法进行排查。</p>\n<p>对账户、进程、端口、服务、启动项、计划任务、文件、日志进行逐个检测，</p>\n<h2 id=\"日志\"><a class=\"anchor\" href=\"#日志\">#</a> 日志</h2>\n<p>在取证那一步就做的工作，由于日志是最容易被删除或覆盖，所以一上去就要优先保存日志。</p>\n<p>windows 下可疑打开事件管理器或者使用 EventLogExplorer、Logparse 等工具。</p>\n<p>重要的事件日志 ID 如下：</p>\n<table>\n<thead>\n<tr>\n<th>Event ID(2000/XP/2003)</th>\n<th>Event ID(Vista/7/8/2008/2012)</th>\n<th>描述</th>\n<th>日志名称</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>528</td>\n<td>4624</td>\n<td>成功登录</td>\n<td>Security</td>\n</tr>\n<tr>\n<td>529</td>\n<td>4625</td>\n<td>失败登录</td>\n<td>Security</td>\n</tr>\n<tr>\n<td>680</td>\n<td>4776</td>\n<td>成功 / 失败的账户认证</td>\n<td>Security</td>\n</tr>\n<tr>\n<td>624</td>\n<td>4720</td>\n<td>创建用户</td>\n<td>Security</td>\n</tr>\n<tr>\n<td>636</td>\n<td>4732</td>\n<td>添加用户到启用安全性的本地组中</td>\n<td>Security</td>\n</tr>\n<tr>\n<td>632</td>\n<td>4728</td>\n<td>添加用户到启用安全性的全局组中</td>\n<td>Security</td>\n</tr>\n<tr>\n<td>2934</td>\n<td>7030</td>\n<td>服务创建错误</td>\n<td>System</td>\n</tr>\n<tr>\n<td>2944</td>\n<td>7040</td>\n<td>IPSEC 服务服务的启动类型已从禁用更改为自动启动</td>\n<td>System</td>\n</tr>\n<tr>\n<td>2949</td>\n<td>7045</td>\n<td>服务创建</td>\n<td>System</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"账户\"><a class=\"anchor\" href=\"#账户\">#</a> 账户</h2>\n<p>PChunter、D 盾</p>\n<p><img data-src=\"%E9%9A%90%E8%97%8F%E8%B4%A6%E6%88%B711-16494047086361.png\" alt=\"隐藏账户11\" /></p>\n<h2 id=\"端口\"><a class=\"anchor\" href=\"#端口\">#</a> 端口</h2>\n<p>注意以下状态的网络连接：<strong>ESTABLISHED：连接建立数据传输</strong>。<strong>LISTEN：监听中等待连接</strong></p>\n<p>Tcpview、火绒剑、命令行下 netstat -ano：</p>\n<p><img data-src=\"%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A51.png\" alt=\"网络连接1\" /></p>\n<p>DNSQuerySniffer：DNS 解析查询工具。可以通过此工具确定访问恶意域名的端口号，该工具还可以将主机访问过的所有域名记录下来。</p>\n<p><img data-src=\"%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A52DNS%E8%AE%B0%E5%BD%95.png\" alt=\"网络连接2DNS记录\" /></p>\n<h2 id=\"进程\"><a class=\"anchor\" href=\"#进程\">#</a> 进程</h2>\n<p>主要注意点大致就是：<strong>没有厂商名字</strong>、没有<strong>签名验证信息</strong>、没有<strong>描述信息</strong>的可疑进程。还有典型的挖矿现象 (CPU 或内存资源占用长时间过高) 的进程。</p>\n<p>Pchunter：黑色为微软官方进程，蓝色为外界安装软件进程，红色为可疑进程，同时注意进程参数。</p>\n<p><img data-src=\"PChunter1.png\" alt=\"\" /></p>\n<p>Process Explorer，进程浏览器。界面功能从左到右为：Process 进程、CPU 占比、Private Bytes 提交大小、Working Set (工作设置、内存)、PID、Description 描述、Company Name 公司名。</p>\n<p>小技巧：被注入的进程属性里会多出 **.NET Assemblies<strong> 和</strong>.NET Performance** 两个菜单</p>\n<p><img data-src=\"ProEXP%E8%BF%9B%E7%A8%8B.png\" alt=\"\" /></p>\n<h2 id=\"启动项-计划任务-服务\"><a class=\"anchor\" href=\"#启动项-计划任务-服务\">#</a> 启动项、计划任务、服务</h2>\n<p>autoruns: 检查启动项、计划任务、服务最推荐的工具。autoruns 可以看到启动项的可执行文件路径和启动命令。</p>\n<p><img data-src=\"autoruns1.png\" alt=\"\" /></p>\n<p><img data-src=\"autoruns1%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1.png\" alt=\"\" /></p>\n<p><img data-src=\"autoruns2DLL.png\" alt=\"\" /></p>\n<p><img data-src=\"autoruns3%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8.png\" alt=\"\" /></p>\n<p>WMI 后门：无文件，相对来说难以排查，但也可以使用 autoruns 排查。</p>\n<p><img data-src=\"autoruns4WMI%E6%8E%92%E6%9F%A5.png\" alt=\"\" /></p>\n<h2 id=\"文件\"><a class=\"anchor\" href=\"#文件\">#</a> 文件</h2>\n<h3 id=\"程序运行记录\"><a class=\"anchor\" href=\"#程序运行记录\">#</a> 程序运行记录</h3>\n<p>使用 WinPrefetchView 解析 Prefetch 文件夹中的.pf 文件取证。</p>\n<p><img data-src=\"%E6%96%87%E4%BB%B6%E6%9F%A5%E7%9C%8B19.png\" alt=\"\" /></p>\n<h3 id=\"可疑文件\"><a class=\"anchor\" href=\"#可疑文件\">#</a> 可疑文件</h3>\n<p>可疑文件的排查可疑根据预判时确定的<strong>时间范围和影响范围</strong>来缩小排查范围。</p>\n<p>筛选要排查的时间范围内的文件，尤其是创建时间、修改时间在此时间范围内的文件以及临时文件、快捷方式</p>\n<h2 id=\"rootkit病毒查杀\"><a class=\"anchor\" href=\"#rootkit病毒查杀\">#</a> Rootkit 病毒查杀</h2>\n<p>火绒恶性木马专杀工具 hrkill, 单独下载运行。</p>\n<p>官网：<span class=\"exturl\" data-url=\"aHR0cDovL2Jicy5odW9yb25nLmNuL3RocmVhZC0xODU3NS0xLTEuaHRtbA==\">http://bbs.huorong.cn/thread-18575-1-1.html</span></p>\n<p>或腾讯管家工具箱内下载 &quot;系统急救箱&quot; 运行扫描，过程中点击会重启两三次。</p>\n<p>也可以选择 360 顽固病毒查杀。</p>\n<h2 id=\"清理与加固\"><a class=\"anchor\" href=\"#清理与加固\">#</a> 清理与加固</h2>\n<p>漏洞和补丁，在应急响应中是不可或缺。如果黑客是通过某种漏洞入侵系统的，而在应急响应中，无法找出黑客所利用的漏洞，就会意味着，入侵行为可以反复发生。在终端侧，就会表现为病毒清理不干净，杀了又来，所以一定要找出漏洞。</p>\n<p>找到漏洞后，就需要打上相应的补丁，这样才是一次完整的处置。</p>\n<p>怎么查看系统补丁情况？以 Windows 为例，直接打开 cmd，输入命令 systeminfo 即可获取。</p>\n",
            "tags": [
                "应急响应"
            ]
        }
    ]
}